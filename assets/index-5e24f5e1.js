(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))l(d);new MutationObserver(d=>{for(const y of d)if(y.type==="childList")for(const A of y.addedNodes)A.tagName==="LINK"&&A.rel==="modulepreload"&&l(A)}).observe(document,{childList:!0,subtree:!0});function n(d){const y={};return d.integrity&&(y.integrity=d.integrity),d.referrerPolicy&&(y.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?y.credentials="include":d.crossOrigin==="anonymous"?y.credentials="omit":y.credentials="same-origin",y}function l(d){if(d.ep)return;d.ep=!0;const y=n(d);fetch(d.href,y)}})();var eV=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function tS(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var $3={exports:{}},X1={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var tV=Symbol.for("react.transitional.element"),iV=Symbol.for("react.fragment");function Z3(t,e,n){var l=null;if(n!==void 0&&(l=""+n),e.key!==void 0&&(l=""+e.key),"key"in e){n={};for(var d in e)d!=="key"&&(n[d]=e[d])}else n=e;return e=n.ref,{$$typeof:tV,type:t,key:l,ref:e!==void 0?e:null,props:n}}X1.Fragment=iV;X1.jsx=Z3;X1.jsxs=Z3;$3.exports=X1;var J=$3.exports,W3={exports:{}},sn={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var iS=Symbol.for("react.transitional.element"),nV=Symbol.for("react.portal"),rV=Symbol.for("react.fragment"),sV=Symbol.for("react.strict_mode"),aV=Symbol.for("react.profiler"),oV=Symbol.for("react.consumer"),lV=Symbol.for("react.context"),cV=Symbol.for("react.forward_ref"),uV=Symbol.for("react.suspense"),hV=Symbol.for("react.memo"),X3=Symbol.for("react.lazy"),PR=Symbol.iterator;function dV(t){return t===null||typeof t!="object"?null:(t=PR&&t[PR]||t["@@iterator"],typeof t=="function"?t:null)}var Y3={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},K3=Object.assign,Q3={};function km(t,e,n){this.props=t,this.context=e,this.refs=Q3,this.updater=n||Y3}km.prototype.isReactComponent={};km.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};km.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function J3(){}J3.prototype=km.prototype;function nS(t,e,n){this.props=t,this.context=e,this.refs=Q3,this.updater=n||Y3}var rS=nS.prototype=new J3;rS.constructor=nS;K3(rS,km.prototype);rS.isPureReactComponent=!0;var LR=Array.isArray,Pr={H:null,A:null,T:null,S:null},eL=Object.prototype.hasOwnProperty;function sS(t,e,n,l,d,y){return n=y.ref,{$$typeof:iS,type:t,key:e,ref:n!==void 0?n:null,props:y}}function fV(t,e){return sS(t.type,e,void 0,void 0,void 0,t.props)}function aS(t){return typeof t=="object"&&t!==null&&t.$$typeof===iS}function pV(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var zR=/\/+/g;function OT(t,e){return typeof t=="object"&&t!==null&&t.key!=null?pV(""+t.key):e.toString(36)}function OR(){}function mV(t){switch(t.status){case"fulfilled":return t.value;case"rejected":throw t.reason;default:switch(typeof t.status=="string"?t.then(OR,OR):(t.status="pending",t.then(function(e){t.status==="pending"&&(t.status="fulfilled",t.value=e)},function(e){t.status==="pending"&&(t.status="rejected",t.reason=e)})),t.status){case"fulfilled":return t.value;case"rejected":throw t.reason}}throw t}function Up(t,e,n,l,d){var y=typeof t;(y==="undefined"||y==="boolean")&&(t=null);var A=!1;if(t===null)A=!0;else switch(y){case"bigint":case"string":case"number":A=!0;break;case"object":switch(t.$$typeof){case iS:case nV:A=!0;break;case X3:return A=t._init,Up(A(t._payload),e,n,l,d)}}if(A)return d=d(t),A=l===""?"."+OT(t,0):l,LR(d)?(n="",A!=null&&(n=A.replace(zR,"$&/")+"/"),Up(d,e,n,"",function(j){return j})):d!=null&&(aS(d)&&(d=fV(d,n+(d.key==null||t&&t.key===d.key?"":(""+d.key).replace(zR,"$&/")+"/")+A)),e.push(d)),1;A=0;var s=l===""?".":l+":";if(LR(t))for(var N=0;N<t.length;N++)l=t[N],y=s+OT(l,N),A+=Up(l,e,n,y,d);else if(N=dV(t),typeof N=="function")for(t=N.call(t),N=0;!(l=t.next()).done;)l=l.value,y=s+OT(l,N++),A+=Up(l,e,n,y,d);else if(y==="object"){if(typeof t.then=="function")return Up(mV(t),e,n,l,d);throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.")}return A}function ix(t,e,n){if(t==null)return t;var l=[],d=0;return Up(t,l,"","",function(y){return e.call(n,y,d++)}),l}function gV(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var kR=typeof reportError=="function"?reportError:function(t){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var e=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof t=="object"&&t!==null&&typeof t.message=="string"?String(t.message):String(t),error:t});if(!window.dispatchEvent(e))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",t);return}console.error(t)};function _V(){}sn.Children={map:ix,forEach:function(t,e,n){ix(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return ix(t,function(){e++}),e},toArray:function(t){return ix(t,function(e){return e})||[]},only:function(t){if(!aS(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};sn.Component=km;sn.Fragment=rV;sn.Profiler=aV;sn.PureComponent=nS;sn.StrictMode=sV;sn.Suspense=uV;sn.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Pr;sn.act=function(){throw Error("act(...) is not supported in production builds of React.")};sn.cache=function(t){return function(){return t.apply(null,arguments)}};sn.cloneElement=function(t,e,n){if(t==null)throw Error("The argument must be a React element, but you passed "+t+".");var l=K3({},t.props),d=t.key,y=void 0;if(e!=null)for(A in e.ref!==void 0&&(y=void 0),e.key!==void 0&&(d=""+e.key),e)!eL.call(e,A)||A==="key"||A==="__self"||A==="__source"||A==="ref"&&e.ref===void 0||(l[A]=e[A]);var A=arguments.length-2;if(A===1)l.children=n;else if(1<A){for(var s=Array(A),N=0;N<A;N++)s[N]=arguments[N+2];l.children=s}return sS(t.type,d,void 0,void 0,y,l)};sn.createContext=function(t){return t={$$typeof:lV,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null},t.Provider=t,t.Consumer={$$typeof:oV,_context:t},t};sn.createElement=function(t,e,n){var l,d={},y=null;if(e!=null)for(l in e.key!==void 0&&(y=""+e.key),e)eL.call(e,l)&&l!=="key"&&l!=="__self"&&l!=="__source"&&(d[l]=e[l]);var A=arguments.length-2;if(A===1)d.children=n;else if(1<A){for(var s=Array(A),N=0;N<A;N++)s[N]=arguments[N+2];d.children=s}if(t&&t.defaultProps)for(l in A=t.defaultProps,A)d[l]===void 0&&(d[l]=A[l]);return sS(t,y,void 0,void 0,null,d)};sn.createRef=function(){return{current:null}};sn.forwardRef=function(t){return{$$typeof:cV,render:t}};sn.isValidElement=aS;sn.lazy=function(t){return{$$typeof:X3,_payload:{_status:-1,_result:t},_init:gV}};sn.memo=function(t,e){return{$$typeof:hV,type:t,compare:e===void 0?null:e}};sn.startTransition=function(t){var e=Pr.T,n={};Pr.T=n;try{var l=t(),d=Pr.S;d!==null&&d(n,l),typeof l=="object"&&l!==null&&typeof l.then=="function"&&l.then(_V,kR)}catch(y){kR(y)}finally{Pr.T=e}};sn.unstable_useCacheRefresh=function(){return Pr.H.useCacheRefresh()};sn.use=function(t){return Pr.H.use(t)};sn.useActionState=function(t,e,n){return Pr.H.useActionState(t,e,n)};sn.useCallback=function(t,e){return Pr.H.useCallback(t,e)};sn.useContext=function(t){return Pr.H.useContext(t)};sn.useDebugValue=function(){};sn.useDeferredValue=function(t,e){return Pr.H.useDeferredValue(t,e)};sn.useEffect=function(t,e){return Pr.H.useEffect(t,e)};sn.useId=function(){return Pr.H.useId()};sn.useImperativeHandle=function(t,e,n){return Pr.H.useImperativeHandle(t,e,n)};sn.useInsertionEffect=function(t,e){return Pr.H.useInsertionEffect(t,e)};sn.useLayoutEffect=function(t,e){return Pr.H.useLayoutEffect(t,e)};sn.useMemo=function(t,e){return Pr.H.useMemo(t,e)};sn.useOptimistic=function(t,e){return Pr.H.useOptimistic(t,e)};sn.useReducer=function(t,e,n){return Pr.H.useReducer(t,e,n)};sn.useRef=function(t){return Pr.H.useRef(t)};sn.useState=function(t){return Pr.H.useState(t)};sn.useSyncExternalStore=function(t,e,n){return Pr.H.useSyncExternalStore(t,e,n)};sn.useTransition=function(){return Pr.H.useTransition()};sn.version="19.0.0";W3.exports=sn;var ot=W3.exports;const Sh=tS(ot);var tL={exports:{}},Y1={},iL={exports:{}},nL={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(Qt,Ai){var Mi=Qt.length;Qt.push(Ai);e:for(;0<Mi;){var ai=Mi-1>>>1,pn=Qt[ai];if(0<d(pn,Ai))Qt[ai]=Ai,Qt[Mi]=pn,Mi=ai;else break e}}function n(Qt){return Qt.length===0?null:Qt[0]}function l(Qt){if(Qt.length===0)return null;var Ai=Qt[0],Mi=Qt.pop();if(Mi!==Ai){Qt[0]=Mi;e:for(var ai=0,pn=Qt.length,oi=pn>>>1;ai<oi;){var Wi=2*(ai+1)-1,$t=Qt[Wi],Nn=Wi+1,_n=Qt[Nn];if(0>d($t,Mi))Nn<pn&&0>d(_n,$t)?(Qt[ai]=_n,Qt[Nn]=Mi,ai=Nn):(Qt[ai]=$t,Qt[Wi]=Mi,ai=Wi);else if(Nn<pn&&0>d(_n,Mi))Qt[ai]=_n,Qt[Nn]=Mi,ai=Nn;else break e}}return Ai}function d(Qt,Ai){var Mi=Qt.sortIndex-Ai.sortIndex;return Mi!==0?Mi:Qt.id-Ai.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var y=performance;t.unstable_now=function(){return y.now()}}else{var A=Date,s=A.now();t.unstable_now=function(){return A.now()-s}}var N=[],j=[],K=1,se=null,ae=3,me=!1,Ue=!1,Xe=!1,it=typeof setTimeout=="function"?setTimeout:null,be=typeof clearTimeout=="function"?clearTimeout:null,Ee=typeof setImmediate<"u"?setImmediate:null;function Ce(Qt){for(var Ai=n(j);Ai!==null;){if(Ai.callback===null)l(j);else if(Ai.startTime<=Qt)l(j),Ai.sortIndex=Ai.expirationTime,e(N,Ai);else break;Ai=n(j)}}function We(Qt){if(Xe=!1,Ce(Qt),!Ue)if(n(N)!==null)Ue=!0,Or();else{var Ai=n(j);Ai!==null&&di(We,Ai.startTime-Qt)}}var Ct=!1,Ut=-1,we=5,Ae=-1;function Ve(){return!(t.unstable_now()-Ae<we)}function De(){if(Ct){var Qt=t.unstable_now();Ae=Qt;var Ai=!0;try{e:{Ue=!1,Xe&&(Xe=!1,be(Ut),Ut=-1),me=!0;var Mi=ae;try{t:{for(Ce(Qt),se=n(N);se!==null&&!(se.expirationTime>Qt&&Ve());){var ai=se.callback;if(typeof ai=="function"){se.callback=null,ae=se.priorityLevel;var pn=ai(se.expirationTime<=Qt);if(Qt=t.unstable_now(),typeof pn=="function"){se.callback=pn,Ce(Qt),Ai=!0;break t}se===n(N)&&l(N),Ce(Qt)}else l(N);se=n(N)}if(se!==null)Ai=!0;else{var oi=n(j);oi!==null&&di(We,oi.startTime-Qt),Ai=!1}}break e}finally{se=null,ae=Mi,me=!1}Ai=void 0}}finally{Ai?je():Ct=!1}}}var je;if(typeof Ee=="function")je=function(){Ee(De)};else if(typeof MessageChannel<"u"){var pt=new MessageChannel,Ye=pt.port2;pt.port1.onmessage=De,je=function(){Ye.postMessage(null)}}else je=function(){it(De,0)};function Or(){Ct||(Ct=!0,je())}function di(Qt,Ai){Ut=it(function(){Qt(t.unstable_now())},Ai)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(Qt){Qt.callback=null},t.unstable_continueExecution=function(){Ue||me||(Ue=!0,Or())},t.unstable_forceFrameRate=function(Qt){0>Qt||125<Qt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):we=0<Qt?Math.floor(1e3/Qt):5},t.unstable_getCurrentPriorityLevel=function(){return ae},t.unstable_getFirstCallbackNode=function(){return n(N)},t.unstable_next=function(Qt){switch(ae){case 1:case 2:case 3:var Ai=3;break;default:Ai=ae}var Mi=ae;ae=Ai;try{return Qt()}finally{ae=Mi}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(Qt,Ai){switch(Qt){case 1:case 2:case 3:case 4:case 5:break;default:Qt=3}var Mi=ae;ae=Qt;try{return Ai()}finally{ae=Mi}},t.unstable_scheduleCallback=function(Qt,Ai,Mi){var ai=t.unstable_now();switch(typeof Mi=="object"&&Mi!==null?(Mi=Mi.delay,Mi=typeof Mi=="number"&&0<Mi?ai+Mi:ai):Mi=ai,Qt){case 1:var pn=-1;break;case 2:pn=250;break;case 5:pn=1073741823;break;case 4:pn=1e4;break;default:pn=5e3}return pn=Mi+pn,Qt={id:K++,callback:Ai,priorityLevel:Qt,startTime:Mi,expirationTime:pn,sortIndex:-1},Mi>ai?(Qt.sortIndex=Mi,e(j,Qt),n(N)===null&&Qt===n(j)&&(Xe?(be(Ut),Ut=-1):Xe=!0,di(We,Mi-ai))):(Qt.sortIndex=pn,e(N,Qt),Ue||me||(Ue=!0,Or())),Qt},t.unstable_shouldYield=Ve,t.unstable_wrapCallback=function(Qt){var Ai=ae;return function(){var Mi=ae;ae=Ai;try{return Qt.apply(this,arguments)}finally{ae=Mi}}}})(nL);iL.exports=nL;var yV=iL.exports,rL={exports:{}},Ra={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vV=ot;function sL(t){var e="https://react.dev/errors/"+t;if(1<arguments.length){e+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function ch(){}var Ma={d:{f:ch,r:function(){throw Error(sL(522))},D:ch,C:ch,L:ch,m:ch,X:ch,S:ch,M:ch},p:0,findDOMNode:null},xV=Symbol.for("react.portal");function bV(t,e,n){var l=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:xV,key:l==null?null:""+l,children:t,containerInfo:e,implementation:n}}var oy=vV.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function K1(t,e){if(t==="font")return"";if(typeof e=="string")return e==="use-credentials"?e:""}Ra.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Ma;Ra.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)throw Error(sL(299));return bV(t,e,null,n)};Ra.flushSync=function(t){var e=oy.T,n=Ma.p;try{if(oy.T=null,Ma.p=2,t)return t()}finally{oy.T=e,Ma.p=n,Ma.d.f()}};Ra.preconnect=function(t,e){typeof t=="string"&&(e?(e=e.crossOrigin,e=typeof e=="string"?e==="use-credentials"?e:"":void 0):e=null,Ma.d.C(t,e))};Ra.prefetchDNS=function(t){typeof t=="string"&&Ma.d.D(t)};Ra.preinit=function(t,e){if(typeof t=="string"&&e&&typeof e.as=="string"){var n=e.as,l=K1(n,e.crossOrigin),d=typeof e.integrity=="string"?e.integrity:void 0,y=typeof e.fetchPriority=="string"?e.fetchPriority:void 0;n==="style"?Ma.d.S(t,typeof e.precedence=="string"?e.precedence:void 0,{crossOrigin:l,integrity:d,fetchPriority:y}):n==="script"&&Ma.d.X(t,{crossOrigin:l,integrity:d,fetchPriority:y,nonce:typeof e.nonce=="string"?e.nonce:void 0})}};Ra.preinitModule=function(t,e){if(typeof t=="string")if(typeof e=="object"&&e!==null){if(e.as==null||e.as==="script"){var n=K1(e.as,e.crossOrigin);Ma.d.M(t,{crossOrigin:n,integrity:typeof e.integrity=="string"?e.integrity:void 0,nonce:typeof e.nonce=="string"?e.nonce:void 0})}}else e==null&&Ma.d.M(t)};Ra.preload=function(t,e){if(typeof t=="string"&&typeof e=="object"&&e!==null&&typeof e.as=="string"){var n=e.as,l=K1(n,e.crossOrigin);Ma.d.L(t,n,{crossOrigin:l,integrity:typeof e.integrity=="string"?e.integrity:void 0,nonce:typeof e.nonce=="string"?e.nonce:void 0,type:typeof e.type=="string"?e.type:void 0,fetchPriority:typeof e.fetchPriority=="string"?e.fetchPriority:void 0,referrerPolicy:typeof e.referrerPolicy=="string"?e.referrerPolicy:void 0,imageSrcSet:typeof e.imageSrcSet=="string"?e.imageSrcSet:void 0,imageSizes:typeof e.imageSizes=="string"?e.imageSizes:void 0,media:typeof e.media=="string"?e.media:void 0})}};Ra.preloadModule=function(t,e){if(typeof t=="string")if(e){var n=K1(e.as,e.crossOrigin);Ma.d.m(t,{as:typeof e.as=="string"&&e.as!=="script"?e.as:void 0,crossOrigin:n,integrity:typeof e.integrity=="string"?e.integrity:void 0})}else Ma.d.m(t)};Ra.requestFormReset=function(t){Ma.d.r(t)};Ra.unstable_batchedUpdates=function(t,e){return t(e)};Ra.useFormState=function(t,e,n){return oy.H.useFormState(t,e,n)};Ra.useFormStatus=function(){return oy.H.useHostTransitionStatus()};Ra.version="19.0.0";function aL(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(aL)}catch(t){console.error(t)}}aL(),rL.exports=Ra;var wV=rL.exports;/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ys=yV,oL=ot,TV=wV;function Vt(t){var e="https://react.dev/errors/"+t;if(1<arguments.length){e+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function lL(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}var EV=Symbol.for("react.element"),nx=Symbol.for("react.transitional.element"),Y_=Symbol.for("react.portal"),Xp=Symbol.for("react.fragment"),cL=Symbol.for("react.strict_mode"),P2=Symbol.for("react.profiler"),SV=Symbol.for("react.provider"),uL=Symbol.for("react.consumer"),tu=Symbol.for("react.context"),oS=Symbol.for("react.forward_ref"),L2=Symbol.for("react.suspense"),z2=Symbol.for("react.suspense_list"),lS=Symbol.for("react.memo"),fh=Symbol.for("react.lazy"),hL=Symbol.for("react.offscreen"),AV=Symbol.for("react.memo_cache_sentinel"),NR=Symbol.iterator;function V_(t){return t===null||typeof t!="object"?null:(t=NR&&t[NR]||t["@@iterator"],typeof t=="function"?t:null)}var IV=Symbol.for("react.client.reference");function O2(t){if(t==null)return null;if(typeof t=="function")return t.$$typeof===IV?null:t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Xp:return"Fragment";case Y_:return"Portal";case P2:return"Profiler";case cL:return"StrictMode";case L2:return"Suspense";case z2:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case tu:return(t.displayName||"Context")+".Provider";case uL:return(t._context.displayName||"Context")+".Consumer";case oS:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case lS:return e=t.displayName||null,e!==null?e:O2(t.type)||"Memo";case fh:e=t._payload,t=t._init;try{return O2(t(e))}catch{}}return null}var nn=oL.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,yr=Object.assign,kT,FR;function K_(t){if(kT===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);kT=e&&e[1]||"",FR=-1<n.stack.indexOf(`
    at`)?" (<anonymous>)":-1<n.stack.indexOf("@")?"@unknown:0:0":""}return`
`+kT+t+FR}var NT=!1;function FT(t,e){if(!t||NT)return"";NT=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var l={DetermineComponentFrameRoot:function(){try{if(e){var se=function(){throw Error()};if(Object.defineProperty(se.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(se,[])}catch(me){var ae=me}Reflect.construct(t,[],se)}else{try{se.call()}catch(me){ae=me}t.call(se.prototype)}}else{try{throw Error()}catch(me){ae=me}(se=t())&&typeof se.catch=="function"&&se.catch(function(){})}}catch(me){if(me&&ae&&typeof me.stack=="string")return[me.stack,ae.stack]}return[null,null]}};l.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var d=Object.getOwnPropertyDescriptor(l.DetermineComponentFrameRoot,"name");d&&d.configurable&&Object.defineProperty(l.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var y=l.DetermineComponentFrameRoot(),A=y[0],s=y[1];if(A&&s){var N=A.split(`
`),j=s.split(`
`);for(d=l=0;l<N.length&&!N[l].includes("DetermineComponentFrameRoot");)l++;for(;d<j.length&&!j[d].includes("DetermineComponentFrameRoot");)d++;if(l===N.length||d===j.length)for(l=N.length-1,d=j.length-1;1<=l&&0<=d&&N[l]!==j[d];)d--;for(;1<=l&&0<=d;l--,d--)if(N[l]!==j[d]){if(l!==1||d!==1)do if(l--,d--,0>d||N[l]!==j[d]){var K=`
`+N[l].replace(" at new "," at ");return t.displayName&&K.includes("<anonymous>")&&(K=K.replace("<anonymous>",t.displayName)),K}while(1<=l&&0<=d);break}}}finally{NT=!1,Error.prepareStackTrace=n}return(n=t?t.displayName||t.name:"")?K_(n):""}function MV(t){switch(t.tag){case 26:case 27:case 5:return K_(t.type);case 16:return K_("Lazy");case 13:return K_("Suspense");case 19:return K_("SuspenseList");case 0:case 15:return t=FT(t.type,!1),t;case 11:return t=FT(t.type.render,!1),t;case 1:return t=FT(t.type,!0),t;default:return""}}function BR(t){try{var e="";do e+=MV(t),t=t.return;while(t);return e}catch(n){return`
Error generating stack: `+n.message+`
`+n.stack}}function Nm(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function dL(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function VR(t){if(Nm(t)!==t)throw Error(Vt(188))}function CV(t){var e=t.alternate;if(!e){if(e=Nm(t),e===null)throw Error(Vt(188));return e!==t?null:t}for(var n=t,l=e;;){var d=n.return;if(d===null)break;var y=d.alternate;if(y===null){if(l=d.return,l!==null){n=l;continue}break}if(d.child===y.child){for(y=d.child;y;){if(y===n)return VR(d),t;if(y===l)return VR(d),e;y=y.sibling}throw Error(Vt(188))}if(n.return!==l.return)n=d,l=y;else{for(var A=!1,s=d.child;s;){if(s===n){A=!0,n=d,l=y;break}if(s===l){A=!0,l=d,n=y;break}s=s.sibling}if(!A){for(s=y.child;s;){if(s===n){A=!0,n=y,l=d;break}if(s===l){A=!0,l=y,n=d;break}s=s.sibling}if(!A)throw Error(Vt(189))}}if(n.alternate!==l)throw Error(Vt(190))}if(n.tag!==3)throw Error(Vt(188));return n.stateNode.current===n?t:e}function fL(t){var e=t.tag;if(e===5||e===26||e===27||e===6)return t;for(t=t.child;t!==null;){if(e=fL(t),e!==null)return e;t=t.sibling}return null}var Q_=Array.isArray,_r=TV.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,hf={pending:!1,data:null,method:null,action:null},k2=[],Yp=-1;function fc(t){return{current:t}}function Ms(t){0>Yp||(t.current=k2[Yp],k2[Yp]=null,Yp--)}function Tr(t,e){Yp++,k2[Yp]=t.current,t.current=e}var nc=fc(null),Cy=fc(null),Ah=fc(null),Kx=fc(null);function Qx(t,e){switch(Tr(Ah,e),Tr(Cy,t),Tr(nc,null),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)&&(e=e.namespaceURI)?UD(e):0;break;default:if(t=t===8?e.parentNode:e,e=t.tagName,t=t.namespaceURI)t=UD(t),e=SO(t,e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}Ms(nc),Tr(nc,e)}function vm(){Ms(nc),Ms(Cy),Ms(Ah)}function N2(t){t.memoizedState!==null&&Tr(Kx,t);var e=nc.current,n=SO(e,t.type);e!==n&&(Tr(Cy,t),Tr(nc,n))}function Jx(t){Cy.current===t&&(Ms(nc),Ms(Cy)),Kx.current===t&&(Ms(Kx),Vy._currentValue=hf)}var F2=Object.prototype.hasOwnProperty,cS=ys.unstable_scheduleCallback,BT=ys.unstable_cancelCallback,RV=ys.unstable_shouldYield,DV=ys.unstable_requestPaint,rc=ys.unstable_now,PV=ys.unstable_getCurrentPriorityLevel,pL=ys.unstable_ImmediatePriority,mL=ys.unstable_UserBlockingPriority,e1=ys.unstable_NormalPriority,LV=ys.unstable_LowPriority,gL=ys.unstable_IdlePriority,zV=ys.log,OV=ys.unstable_setDisableYieldValue,t0=null,uo=null;function kV(t){if(uo&&typeof uo.onCommitFiberRoot=="function")try{uo.onCommitFiberRoot(t0,t,void 0,(t.current.flags&128)===128)}catch{}}function wh(t){if(typeof zV=="function"&&OV(t),uo&&typeof uo.setStrictMode=="function")try{uo.setStrictMode(t0,t)}catch{}}var ho=Math.clz32?Math.clz32:BV,NV=Math.log,FV=Math.LN2;function BV(t){return t>>>=0,t===0?32:31-(NV(t)/FV|0)|0}var rx=128,sx=4194304;function tf(t){var e=t&42;if(e!==0)return e;switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194176;case 4194304:case 8388608:case 16777216:case 33554432:return t&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return t}}function Q1(t,e){var n=t.pendingLanes;if(n===0)return 0;var l=0,d=t.suspendedLanes,y=t.pingedLanes,A=t.warmLanes;t=t.finishedLanes!==0;var s=n&134217727;return s!==0?(n=s&~d,n!==0?l=tf(n):(y&=s,y!==0?l=tf(y):t||(A=s&~A,A!==0&&(l=tf(A))))):(s=n&~d,s!==0?l=tf(s):y!==0?l=tf(y):t||(A=n&~A,A!==0&&(l=tf(A)))),l===0?0:e!==0&&e!==l&&!(e&d)&&(d=l&-l,A=e&-e,d>=A||d===32&&(A&4194176)!==0)?e:l}function i0(t,e){return(t.pendingLanes&~(t.suspendedLanes&~t.pingedLanes)&e)===0}function VV(t,e){switch(t){case 1:case 2:case 4:case 8:return e+250;case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function _L(){var t=rx;return rx<<=1,!(rx&4194176)&&(rx=128),t}function yL(){var t=sx;return sx<<=1,!(sx&62914560)&&(sx=4194304),t}function VT(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function n0(t,e){t.pendingLanes|=e,e!==268435456&&(t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0)}function UV(t,e,n,l,d,y){var A=t.pendingLanes;t.pendingLanes=n,t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0,t.expiredLanes&=n,t.entangledLanes&=n,t.errorRecoveryDisabledLanes&=n,t.shellSuspendCounter=0;var s=t.entanglements,N=t.expirationTimes,j=t.hiddenUpdates;for(n=A&~n;0<n;){var K=31-ho(n),se=1<<K;s[K]=0,N[K]=-1;var ae=j[K];if(ae!==null)for(j[K]=null,K=0;K<ae.length;K++){var me=ae[K];me!==null&&(me.lane&=-536870913)}n&=~se}l!==0&&vL(t,l,0),y!==0&&d===0&&t.tag!==0&&(t.suspendedLanes|=y&~(A&~e))}function vL(t,e,n){t.pendingLanes|=e,t.suspendedLanes&=~e;var l=31-ho(e);t.entangledLanes|=e,t.entanglements[l]=t.entanglements[l]|1073741824|n&4194218}function xL(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var l=31-ho(n),d=1<<l;d&e|t[l]&e&&(t[l]|=e),n&=~d}}function bL(t){return t&=-t,2<t?8<t?t&134217727?32:268435456:8:2}function wL(){var t=_r.p;return t!==0?t:(t=window.event,t===void 0?32:OO(t.type))}function jV(t,e){var n=_r.p;try{return _r.p=t,e()}finally{_r.p=n}}var Jh=Math.random().toString(36).slice(2),ca="__reactFiber$"+Jh,qa="__reactProps$"+Jh,Fm="__reactContainer$"+Jh,B2="__reactEvents$"+Jh,qV="__reactListeners$"+Jh,GV="__reactHandles$"+Jh,UR="__reactResources$"+Jh,Ry="__reactMarker$"+Jh;function uS(t){delete t[ca],delete t[qa],delete t[B2],delete t[qV],delete t[GV]}function of(t){var e=t[ca];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Fm]||n[ca]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=qD(t);t!==null;){if(n=t[ca])return n;t=qD(t)}return e}t=n,n=t.parentNode}return null}function Bm(t){if(t=t[ca]||t[Fm]){var e=t.tag;if(e===5||e===6||e===13||e===26||e===27||e===3)return t}return null}function J_(t){var e=t.tag;if(e===5||e===26||e===27||e===6)return t.stateNode;throw Error(Vt(33))}function om(t){var e=t[UR];return e||(e=t[UR]={hoistableStyles:new Map,hoistableScripts:new Map}),e}function As(t){t[Ry]=!0}var TL=new Set,EL={};function Mf(t,e){xm(t,e),xm(t+"Capture",e)}function xm(t,e){for(EL[t]=e,t=0;t<e.length;t++)TL.add(e[t])}var pu=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),HV=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),jR={},qR={};function $V(t){return F2.call(qR,t)?!0:F2.call(jR,t)?!1:HV.test(t)?qR[t]=!0:(jR[t]=!0,!1)}function Ax(t,e,n){if($V(e))if(n===null)t.removeAttribute(e);else{switch(typeof n){case"undefined":case"function":case"symbol":t.removeAttribute(e);return;case"boolean":var l=e.toLowerCase().slice(0,5);if(l!=="data-"&&l!=="aria-"){t.removeAttribute(e);return}}t.setAttribute(e,""+n)}}function ax(t,e,n){if(n===null)t.removeAttribute(e);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(e);return}t.setAttribute(e,""+n)}}function $c(t,e,n,l){if(l===null)t.removeAttribute(n);else{switch(typeof l){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(n);return}t.setAttributeNS(e,n,""+l)}}function No(t){switch(typeof t){case"bigint":case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function SL(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function ZV(t){var e=SL(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),l=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var d=n.get,y=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return d.call(this)},set:function(A){l=""+A,y.call(this,A)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return l},setValue:function(A){l=""+A},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function t1(t){t._valueTracker||(t._valueTracker=ZV(t))}function AL(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),l="";return t&&(l=SL(t)?t.checked?"true":"false":t.value),t=l,t!==n?(e.setValue(t),!0):!1}function i1(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}var WV=/[\n"\\]/g;function Vo(t){return t.replace(WV,function(e){return"\\"+e.charCodeAt(0).toString(16)+" "})}function V2(t,e,n,l,d,y,A,s){t.name="",A!=null&&typeof A!="function"&&typeof A!="symbol"&&typeof A!="boolean"?t.type=A:t.removeAttribute("type"),e!=null?A==="number"?(e===0&&t.value===""||t.value!=e)&&(t.value=""+No(e)):t.value!==""+No(e)&&(t.value=""+No(e)):A!=="submit"&&A!=="reset"||t.removeAttribute("value"),e!=null?U2(t,A,No(e)):n!=null?U2(t,A,No(n)):l!=null&&t.removeAttribute("value"),d==null&&y!=null&&(t.defaultChecked=!!y),d!=null&&(t.checked=d&&typeof d!="function"&&typeof d!="symbol"),s!=null&&typeof s!="function"&&typeof s!="symbol"&&typeof s!="boolean"?t.name=""+No(s):t.removeAttribute("name")}function IL(t,e,n,l,d,y,A,s){if(y!=null&&typeof y!="function"&&typeof y!="symbol"&&typeof y!="boolean"&&(t.type=y),e!=null||n!=null){if(!(y!=="submit"&&y!=="reset"||e!=null))return;n=n!=null?""+No(n):"",e=e!=null?""+No(e):n,s||e===t.value||(t.value=e),t.defaultValue=e}l=l??d,l=typeof l!="function"&&typeof l!="symbol"&&!!l,t.checked=s?t.checked:!!l,t.defaultChecked=!!l,A!=null&&typeof A!="function"&&typeof A!="symbol"&&typeof A!="boolean"&&(t.name=A)}function U2(t,e,n){e==="number"&&i1(t.ownerDocument)===t||t.defaultValue===""+n||(t.defaultValue=""+n)}function lm(t,e,n,l){if(t=t.options,e){e={};for(var d=0;d<n.length;d++)e["$"+n[d]]=!0;for(n=0;n<t.length;n++)d=e.hasOwnProperty("$"+t[n].value),t[n].selected!==d&&(t[n].selected=d),d&&l&&(t[n].defaultSelected=!0)}else{for(n=""+No(n),e=null,d=0;d<t.length;d++){if(t[d].value===n){t[d].selected=!0,l&&(t[d].defaultSelected=!0);return}e!==null||t[d].disabled||(e=t[d])}e!==null&&(e.selected=!0)}}function ML(t,e,n){if(e!=null&&(e=""+No(e),e!==t.value&&(t.value=e),n==null)){t.defaultValue!==e&&(t.defaultValue=e);return}t.defaultValue=n!=null?""+No(n):""}function CL(t,e,n,l){if(e==null){if(l!=null){if(n!=null)throw Error(Vt(92));if(Q_(l)){if(1<l.length)throw Error(Vt(93));l=l[0]}n=l}n==null&&(n=""),e=n}n=No(e),t.defaultValue=n,l=t.textContent,l===n&&l!==""&&l!==null&&(t.value=l)}function bm(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var XV=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function GR(t,e,n){var l=e.indexOf("--")===0;n==null||typeof n=="boolean"||n===""?l?t.setProperty(e,""):e==="float"?t.cssFloat="":t[e]="":l?t.setProperty(e,n):typeof n!="number"||n===0||XV.has(e)?e==="float"?t.cssFloat=n:t[e]=(""+n).trim():t[e]=n+"px"}function RL(t,e,n){if(e!=null&&typeof e!="object")throw Error(Vt(62));if(t=t.style,n!=null){for(var l in n)!n.hasOwnProperty(l)||e!=null&&e.hasOwnProperty(l)||(l.indexOf("--")===0?t.setProperty(l,""):l==="float"?t.cssFloat="":t[l]="");for(var d in e)l=e[d],e.hasOwnProperty(d)&&n[d]!==l&&GR(t,d,l)}else for(var y in e)e.hasOwnProperty(y)&&GR(t,y,e[y])}function hS(t){if(t.indexOf("-")===-1)return!1;switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var YV=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),KV=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Ix(t){return KV.test(""+t)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":t}var j2=null;function dS(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Kp=null,cm=null;function HR(t){var e=Bm(t);if(e&&(t=e.stateNode)){var n=t[qa]||null;e:switch(t=e.stateNode,e.type){case"input":if(V2(t,n.value,n.defaultValue,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll('input[name="'+Vo(""+e)+'"][type="radio"]'),e=0;e<n.length;e++){var l=n[e];if(l!==t&&l.form===t.form){var d=l[qa]||null;if(!d)throw Error(Vt(90));V2(l,d.value,d.defaultValue,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name)}}for(e=0;e<n.length;e++)l=n[e],l.form===t.form&&AL(l)}break e;case"textarea":ML(t,n.value,n.defaultValue);break e;case"select":e=n.value,e!=null&&lm(t,!!n.multiple,e,!1)}}}var UT=!1;function DL(t,e,n){if(UT)return t(e,n);UT=!0;try{var l=t(e);return l}finally{if(UT=!1,(Kp!==null||cm!==null)&&(lb(),Kp&&(e=Kp,t=cm,cm=Kp=null,HR(e),t)))for(e=0;e<t.length;e++)HR(t[e])}}function Dy(t,e){var n=t.stateNode;if(n===null)return null;var l=n[qa]||null;if(l===null)return null;n=l[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(l=!l.disabled)||(t=t.type,l=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!l;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(Vt(231,e,typeof n));return n}var q2=!1;if(pu)try{var U_={};Object.defineProperty(U_,"passive",{get:function(){q2=!0}}),window.addEventListener("test",U_,U_),window.removeEventListener("test",U_,U_)}catch{q2=!1}var Th=null,fS=null,Mx=null;function PL(){if(Mx)return Mx;var t,e=fS,n=e.length,l,d="value"in Th?Th.value:Th.textContent,y=d.length;for(t=0;t<n&&e[t]===d[t];t++);var A=n-t;for(l=1;l<=A&&e[n-l]===d[y-l];l++);return Mx=d.slice(t,1<l?1-l:void 0)}function Cx(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function ox(){return!0}function $R(){return!1}function Ga(t){function e(n,l,d,y,A){this._reactName=n,this._targetInst=d,this.type=l,this.nativeEvent=y,this.target=A,this.currentTarget=null;for(var s in t)t.hasOwnProperty(s)&&(n=t[s],this[s]=n?n(y):y[s]);return this.isDefaultPrevented=(y.defaultPrevented!=null?y.defaultPrevented:y.returnValue===!1)?ox:$R,this.isPropagationStopped=$R,this}return yr(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=ox)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=ox)},persist:function(){},isPersistent:ox}),e}var Cf={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},J1=Ga(Cf),r0=yr({},Cf,{view:0,detail:0}),QV=Ga(r0),jT,qT,j_,eb=yr({},r0,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:pS,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==j_&&(j_&&t.type==="mousemove"?(jT=t.screenX-j_.screenX,qT=t.screenY-j_.screenY):qT=jT=0,j_=t),jT)},movementY:function(t){return"movementY"in t?t.movementY:qT}}),ZR=Ga(eb),JV=yr({},eb,{dataTransfer:0}),e6=Ga(JV),t6=yr({},r0,{relatedTarget:0}),GT=Ga(t6),i6=yr({},Cf,{animationName:0,elapsedTime:0,pseudoElement:0}),n6=Ga(i6),r6=yr({},Cf,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),s6=Ga(r6),a6=yr({},Cf,{data:0}),WR=Ga(a6),o6={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},l6={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},c6={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function u6(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=c6[t])?!!e[t]:!1}function pS(){return u6}var h6=yr({},r0,{key:function(t){if(t.key){var e=o6[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Cx(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?l6[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:pS,charCode:function(t){return t.type==="keypress"?Cx(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Cx(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),d6=Ga(h6),f6=yr({},eb,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),XR=Ga(f6),p6=yr({},r0,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:pS}),m6=Ga(p6),g6=yr({},Cf,{propertyName:0,elapsedTime:0,pseudoElement:0}),_6=Ga(g6),y6=yr({},eb,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),v6=Ga(y6),x6=yr({},Cf,{newState:0,oldState:0}),b6=Ga(x6),w6=[9,13,27,32],mS=pu&&"CompositionEvent"in window,ly=null;pu&&"documentMode"in document&&(ly=document.documentMode);var T6=pu&&"TextEvent"in window&&!ly,LL=pu&&(!mS||ly&&8<ly&&11>=ly),YR=String.fromCharCode(32),KR=!1;function zL(t,e){switch(t){case"keyup":return w6.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function OL(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Qp=!1;function E6(t,e){switch(t){case"compositionend":return OL(e);case"keypress":return e.which!==32?null:(KR=!0,YR);case"textInput":return t=e.data,t===YR&&KR?null:t;default:return null}}function S6(t,e){if(Qp)return t==="compositionend"||!mS&&zL(t,e)?(t=PL(),Mx=fS=Th=null,Qp=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return LL&&e.locale!=="ko"?null:e.data;default:return null}}var A6={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function QR(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!A6[t.type]:e==="textarea"}function kL(t,e,n,l){Kp?cm?cm.push(l):cm=[l]:Kp=l,e=y1(e,"onChange"),0<e.length&&(n=new J1("onChange","change",null,n,l),t.push({event:n,listeners:e}))}var cy=null,Py=null;function I6(t){wO(t,0)}function tb(t){var e=J_(t);if(AL(e))return t}function JR(t,e){if(t==="change")return e}var NL=!1;if(pu){var HT;if(pu){var $T="oninput"in document;if(!$T){var eD=document.createElement("div");eD.setAttribute("oninput","return;"),$T=typeof eD.oninput=="function"}HT=$T}else HT=!1;NL=HT&&(!document.documentMode||9<document.documentMode)}function tD(){cy&&(cy.detachEvent("onpropertychange",FL),Py=cy=null)}function FL(t){if(t.propertyName==="value"&&tb(Py)){var e=[];kL(e,Py,t,dS(t)),DL(I6,e)}}function M6(t,e,n){t==="focusin"?(tD(),cy=e,Py=n,cy.attachEvent("onpropertychange",FL)):t==="focusout"&&tD()}function C6(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return tb(Py)}function R6(t,e){if(t==="click")return tb(e)}function D6(t,e){if(t==="input"||t==="change")return tb(e)}function P6(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var mo=typeof Object.is=="function"?Object.is:P6;function Ly(t,e){if(mo(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),l=Object.keys(e);if(n.length!==l.length)return!1;for(l=0;l<n.length;l++){var d=n[l];if(!F2.call(e,d)||!mo(t[d],e[d]))return!1}return!0}function iD(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function nD(t,e){var n=iD(t);t=0;for(var l;n;){if(n.nodeType===3){if(l=t+n.textContent.length,t<=e&&l>=e)return{node:n,offset:e-t};t=l}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=iD(n)}}function BL(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?BL(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function VL(t){t=t!=null&&t.ownerDocument!=null&&t.ownerDocument.defaultView!=null?t.ownerDocument.defaultView:window;for(var e=i1(t.document);e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=i1(t.document)}return e}function gS(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function L6(t,e){var n=VL(e);e=t.focusedElem;var l=t.selectionRange;if(n!==e&&e&&e.ownerDocument&&BL(e.ownerDocument.documentElement,e)){if(l!==null&&gS(e)){if(t=l.start,n=l.end,n===void 0&&(n=t),"selectionStart"in e)e.selectionStart=t,e.selectionEnd=Math.min(n,e.value.length);else if(n=(t=e.ownerDocument||document)&&t.defaultView||window,n.getSelection){n=n.getSelection();var d=e.textContent.length,y=Math.min(l.start,d);l=l.end===void 0?y:Math.min(l.end,d),!n.extend&&y>l&&(d=l,l=y,y=d),d=nD(e,y);var A=nD(e,l);d&&A&&(n.rangeCount!==1||n.anchorNode!==d.node||n.anchorOffset!==d.offset||n.focusNode!==A.node||n.focusOffset!==A.offset)&&(t=t.createRange(),t.setStart(d.node,d.offset),n.removeAllRanges(),y>l?(n.addRange(t),n.extend(A.node,A.offset)):(t.setEnd(A.node,A.offset),n.addRange(t)))}}for(t=[],n=e;n=n.parentNode;)n.nodeType===1&&t.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof e.focus=="function"&&e.focus(),e=0;e<t.length;e++)n=t[e],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var z6=pu&&"documentMode"in document&&11>=document.documentMode,Jp=null,G2=null,uy=null,H2=!1;function rD(t,e,n){var l=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;H2||Jp==null||Jp!==i1(l)||(l=Jp,"selectionStart"in l&&gS(l)?l={start:l.selectionStart,end:l.selectionEnd}:(l=(l.ownerDocument&&l.ownerDocument.defaultView||window).getSelection(),l={anchorNode:l.anchorNode,anchorOffset:l.anchorOffset,focusNode:l.focusNode,focusOffset:l.focusOffset}),uy&&Ly(uy,l)||(uy=l,l=y1(G2,"onSelect"),0<l.length&&(e=new J1("onSelect","select",null,e,n),t.push({event:e,listeners:l}),e.target=Jp)))}function ef(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var em={animationend:ef("Animation","AnimationEnd"),animationiteration:ef("Animation","AnimationIteration"),animationstart:ef("Animation","AnimationStart"),transitionrun:ef("Transition","TransitionRun"),transitionstart:ef("Transition","TransitionStart"),transitioncancel:ef("Transition","TransitionCancel"),transitionend:ef("Transition","TransitionEnd")},ZT={},UL={};pu&&(UL=document.createElement("div").style,"AnimationEvent"in window||(delete em.animationend.animation,delete em.animationiteration.animation,delete em.animationstart.animation),"TransitionEvent"in window||delete em.transitionend.transition);function Rf(t){if(ZT[t])return ZT[t];if(!em[t])return t;var e=em[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in UL)return ZT[t]=e[n];return t}var jL=Rf("animationend"),qL=Rf("animationiteration"),GL=Rf("animationstart"),O6=Rf("transitionrun"),k6=Rf("transitionstart"),N6=Rf("transitioncancel"),HL=Rf("transitionend"),$L=new Map,sD="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll scrollEnd toggle touchMove waiting wheel".split(" ");function Al(t,e){$L.set(t,e),Mf(e,[t])}var ko=[],tm=0,_S=0;function ib(){for(var t=tm,e=_S=tm=0;e<t;){var n=ko[e];ko[e++]=null;var l=ko[e];ko[e++]=null;var d=ko[e];ko[e++]=null;var y=ko[e];if(ko[e++]=null,l!==null&&d!==null){var A=l.pending;A===null?d.next=d:(d.next=A.next,A.next=d),l.pending=d}y!==0&&ZL(n,d,y)}}function nb(t,e,n,l){ko[tm++]=t,ko[tm++]=e,ko[tm++]=n,ko[tm++]=l,_S|=l,t.lanes|=l,t=t.alternate,t!==null&&(t.lanes|=l)}function yS(t,e,n,l){return nb(t,e,n,l),n1(t)}function Bh(t,e){return nb(t,null,null,e),n1(t)}function ZL(t,e,n){t.lanes|=n;var l=t.alternate;l!==null&&(l.lanes|=n);for(var d=!1,y=t.return;y!==null;)y.childLanes|=n,l=y.alternate,l!==null&&(l.childLanes|=n),y.tag===22&&(t=y.stateNode,t===null||t._visibility&1||(d=!0)),t=y,y=y.return;d&&e!==null&&t.tag===3&&(y=t.stateNode,d=31-ho(n),y=y.hiddenUpdates,t=y[d],t===null?y[d]=[e]:t.push(e),e.lane=n|536870912)}function n1(t){if(50<wy)throw wy=0,fE=null,Error(Vt(185));for(var e=t.return;e!==null;)t=e,e=t.return;return t.tag===3?t.stateNode:null}var im={},aD=new WeakMap;function Uo(t,e){if(typeof t=="object"&&t!==null){var n=aD.get(t);return n!==void 0?n:(e={value:t,source:e,stack:BR(e)},aD.set(t,e),e)}return{value:t,source:e,stack:BR(e)}}var nm=[],rm=0,r1=null,s1=0,Fo=[],Bo=0,df=null,iu=1,nu="";function nf(t,e){nm[rm++]=s1,nm[rm++]=r1,r1=t,s1=e}function WL(t,e,n){Fo[Bo++]=iu,Fo[Bo++]=nu,Fo[Bo++]=df,df=t;var l=iu;t=nu;var d=32-ho(l)-1;l&=~(1<<d),n+=1;var y=32-ho(e)+d;if(30<y){var A=d-d%5;y=(l&(1<<A)-1).toString(32),l>>=A,d-=A,iu=1<<32-ho(e)+d|n<<d|l,nu=y+t}else iu=1<<y|n<<d|l,nu=t}function vS(t){t.return!==null&&(nf(t,1),WL(t,1,0))}function xS(t){for(;t===r1;)r1=nm[--rm],nm[rm]=null,s1=nm[--rm],nm[rm]=null;for(;t===df;)df=Fo[--Bo],Fo[Bo]=null,nu=Fo[--Bo],Fo[Bo]=null,iu=Fo[--Bo],Fo[Bo]=null}var Ia=null,Us=null,Dn=!1,vl=null,tc=!1,$2=Error(Vt(519));function _f(t){var e=Error(Vt(418,""));throw zy(Uo(e,t)),$2}function oD(t){var e=t.stateNode,n=t.type,l=t.memoizedProps;switch(e[ca]=t,e[qa]=l,n){case"dialog":Tn("cancel",e),Tn("close",e);break;case"iframe":case"object":case"embed":Tn("load",e);break;case"video":case"audio":for(n=0;n<Ny.length;n++)Tn(Ny[n],e);break;case"source":Tn("error",e);break;case"img":case"image":case"link":Tn("error",e),Tn("load",e);break;case"details":Tn("toggle",e);break;case"input":Tn("invalid",e),IL(e,l.value,l.defaultValue,l.checked,l.defaultChecked,l.type,l.name,!0),t1(e);break;case"select":Tn("invalid",e);break;case"textarea":Tn("invalid",e),CL(e,l.value,l.defaultValue,l.children),t1(e)}n=l.children,typeof n!="string"&&typeof n!="number"&&typeof n!="bigint"||e.textContent===""+n||l.suppressHydrationWarning===!0||EO(e.textContent,n)?(l.popover!=null&&(Tn("beforetoggle",e),Tn("toggle",e)),l.onScroll!=null&&Tn("scroll",e),l.onScrollEnd!=null&&Tn("scrollend",e),l.onClick!=null&&(e.onclick=ub),e=!0):e=!1,e||_f(t)}function lD(t){for(Ia=t.return;Ia;)switch(Ia.tag){case 3:case 27:tc=!0;return;case 5:case 13:tc=!1;return;default:Ia=Ia.return}}function q_(t){if(t!==Ia)return!1;if(!Dn)return lD(t),Dn=!0,!1;var e=!1,n;if((n=t.tag!==3&&t.tag!==27)&&((n=t.tag===5)&&(n=t.type,n=!(n!=="form"&&n!=="button")||xE(t.type,t.memoizedProps)),n=!n),n&&(e=!0),e&&Us&&_f(t),lD(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(Vt(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8)if(n=t.data,n==="/$"){if(e===0){Us=xl(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++;t=t.nextSibling}Us=null}}else Us=Ia?xl(t.stateNode.nextSibling):null;return!0}function s0(){Us=Ia=null,Dn=!1}function zy(t){vl===null?vl=[t]:vl.push(t)}var hy=Error(Vt(460)),XL=Error(Vt(474)),Z2={then:function(){}};function cD(t){return t=t.status,t==="fulfilled"||t==="rejected"}function lx(){}function YL(t,e,n){switch(n=t[n],n===void 0?t.push(e):n!==e&&(e.then(lx,lx),e=n),e.status){case"fulfilled":return e.value;case"rejected":throw t=e.reason,t===hy?Error(Vt(483)):t;default:if(typeof e.status=="string")e.then(lx,lx);else{if(t=lr,t!==null&&100<t.shellSuspendCounter)throw Error(Vt(482));t=e,t.status="pending",t.then(function(l){if(e.status==="pending"){var d=e;d.status="fulfilled",d.value=l}},function(l){if(e.status==="pending"){var d=e;d.status="rejected",d.reason=l}})}switch(e.status){case"fulfilled":return e.value;case"rejected":throw t=e.reason,t===hy?Error(Vt(483)):t}throw dy=e,hy}}var dy=null;function uD(){if(dy===null)throw Error(Vt(459));var t=dy;return dy=null,t}var um=null,Oy=0;function cx(t){var e=Oy;return Oy+=1,um===null&&(um=[]),YL(um,t,e)}function G_(t,e){e=e.props.ref,t.ref=e!==void 0?e:null}function ux(t,e){throw e.$$typeof===EV?Error(Vt(525)):(t=Object.prototype.toString.call(e),Error(Vt(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)))}function hD(t){var e=t._init;return e(t._payload)}function KL(t){function e(be,Ee){if(t){var Ce=be.deletions;Ce===null?(be.deletions=[Ee],be.flags|=16):Ce.push(Ee)}}function n(be,Ee){if(!t)return null;for(;Ee!==null;)e(be,Ee),Ee=Ee.sibling;return null}function l(be){for(var Ee=new Map;be!==null;)be.key!==null?Ee.set(be.key,be):Ee.set(be.index,be),be=be.sibling;return Ee}function d(be,Ee){return be=Ch(be,Ee),be.index=0,be.sibling=null,be}function y(be,Ee,Ce){return be.index=Ce,t?(Ce=be.alternate,Ce!==null?(Ce=Ce.index,Ce<Ee?(be.flags|=33554434,Ee):Ce):(be.flags|=33554434,Ee)):(be.flags|=1048576,Ee)}function A(be){return t&&be.alternate===null&&(be.flags|=33554434),be}function s(be,Ee,Ce,We){return Ee===null||Ee.tag!==6?(Ee=s2(Ce,be.mode,We),Ee.return=be,Ee):(Ee=d(Ee,Ce),Ee.return=be,Ee)}function N(be,Ee,Ce,We){var Ct=Ce.type;return Ct===Xp?K(be,Ee,Ce.props.children,We,Ce.key):Ee!==null&&(Ee.elementType===Ct||typeof Ct=="object"&&Ct!==null&&Ct.$$typeof===fh&&hD(Ct)===Ee.type)?(Ee=d(Ee,Ce.props),G_(Ee,Ce),Ee.return=be,Ee):(Ee=zx(Ce.type,Ce.key,Ce.props,null,be.mode,We),G_(Ee,Ce),Ee.return=be,Ee)}function j(be,Ee,Ce,We){return Ee===null||Ee.tag!==4||Ee.stateNode.containerInfo!==Ce.containerInfo||Ee.stateNode.implementation!==Ce.implementation?(Ee=a2(Ce,be.mode,We),Ee.return=be,Ee):(Ee=d(Ee,Ce.children||[]),Ee.return=be,Ee)}function K(be,Ee,Ce,We,Ct){return Ee===null||Ee.tag!==7?(Ee=pf(Ce,be.mode,We,Ct),Ee.return=be,Ee):(Ee=d(Ee,Ce),Ee.return=be,Ee)}function se(be,Ee,Ce){if(typeof Ee=="string"&&Ee!==""||typeof Ee=="number"||typeof Ee=="bigint")return Ee=s2(""+Ee,be.mode,Ce),Ee.return=be,Ee;if(typeof Ee=="object"&&Ee!==null){switch(Ee.$$typeof){case nx:return Ce=zx(Ee.type,Ee.key,Ee.props,null,be.mode,Ce),G_(Ce,Ee),Ce.return=be,Ce;case Y_:return Ee=a2(Ee,be.mode,Ce),Ee.return=be,Ee;case fh:var We=Ee._init;return Ee=We(Ee._payload),se(be,Ee,Ce)}if(Q_(Ee)||V_(Ee))return Ee=pf(Ee,be.mode,Ce,null),Ee.return=be,Ee;if(typeof Ee.then=="function")return se(be,cx(Ee),Ce);if(Ee.$$typeof===tu)return se(be,hx(be,Ee),Ce);ux(be,Ee)}return null}function ae(be,Ee,Ce,We){var Ct=Ee!==null?Ee.key:null;if(typeof Ce=="string"&&Ce!==""||typeof Ce=="number"||typeof Ce=="bigint")return Ct!==null?null:s(be,Ee,""+Ce,We);if(typeof Ce=="object"&&Ce!==null){switch(Ce.$$typeof){case nx:return Ce.key===Ct?N(be,Ee,Ce,We):null;case Y_:return Ce.key===Ct?j(be,Ee,Ce,We):null;case fh:return Ct=Ce._init,Ce=Ct(Ce._payload),ae(be,Ee,Ce,We)}if(Q_(Ce)||V_(Ce))return Ct!==null?null:K(be,Ee,Ce,We,null);if(typeof Ce.then=="function")return ae(be,Ee,cx(Ce),We);if(Ce.$$typeof===tu)return ae(be,Ee,hx(be,Ce),We);ux(be,Ce)}return null}function me(be,Ee,Ce,We,Ct){if(typeof We=="string"&&We!==""||typeof We=="number"||typeof We=="bigint")return be=be.get(Ce)||null,s(Ee,be,""+We,Ct);if(typeof We=="object"&&We!==null){switch(We.$$typeof){case nx:return be=be.get(We.key===null?Ce:We.key)||null,N(Ee,be,We,Ct);case Y_:return be=be.get(We.key===null?Ce:We.key)||null,j(Ee,be,We,Ct);case fh:var Ut=We._init;return We=Ut(We._payload),me(be,Ee,Ce,We,Ct)}if(Q_(We)||V_(We))return be=be.get(Ce)||null,K(Ee,be,We,Ct,null);if(typeof We.then=="function")return me(be,Ee,Ce,cx(We),Ct);if(We.$$typeof===tu)return me(be,Ee,Ce,hx(Ee,We),Ct);ux(Ee,We)}return null}function Ue(be,Ee,Ce,We){for(var Ct=null,Ut=null,we=Ee,Ae=Ee=0,Ve=null;we!==null&&Ae<Ce.length;Ae++){we.index>Ae?(Ve=we,we=null):Ve=we.sibling;var De=ae(be,we,Ce[Ae],We);if(De===null){we===null&&(we=Ve);break}t&&we&&De.alternate===null&&e(be,we),Ee=y(De,Ee,Ae),Ut===null?Ct=De:Ut.sibling=De,Ut=De,we=Ve}if(Ae===Ce.length)return n(be,we),Dn&&nf(be,Ae),Ct;if(we===null){for(;Ae<Ce.length;Ae++)we=se(be,Ce[Ae],We),we!==null&&(Ee=y(we,Ee,Ae),Ut===null?Ct=we:Ut.sibling=we,Ut=we);return Dn&&nf(be,Ae),Ct}for(we=l(we);Ae<Ce.length;Ae++)Ve=me(we,be,Ae,Ce[Ae],We),Ve!==null&&(t&&Ve.alternate!==null&&we.delete(Ve.key===null?Ae:Ve.key),Ee=y(Ve,Ee,Ae),Ut===null?Ct=Ve:Ut.sibling=Ve,Ut=Ve);return t&&we.forEach(function(je){return e(be,je)}),Dn&&nf(be,Ae),Ct}function Xe(be,Ee,Ce,We){if(Ce==null)throw Error(Vt(151));for(var Ct=null,Ut=null,we=Ee,Ae=Ee=0,Ve=null,De=Ce.next();we!==null&&!De.done;Ae++,De=Ce.next()){we.index>Ae?(Ve=we,we=null):Ve=we.sibling;var je=ae(be,we,De.value,We);if(je===null){we===null&&(we=Ve);break}t&&we&&je.alternate===null&&e(be,we),Ee=y(je,Ee,Ae),Ut===null?Ct=je:Ut.sibling=je,Ut=je,we=Ve}if(De.done)return n(be,we),Dn&&nf(be,Ae),Ct;if(we===null){for(;!De.done;Ae++,De=Ce.next())De=se(be,De.value,We),De!==null&&(Ee=y(De,Ee,Ae),Ut===null?Ct=De:Ut.sibling=De,Ut=De);return Dn&&nf(be,Ae),Ct}for(we=l(we);!De.done;Ae++,De=Ce.next())De=me(we,be,Ae,De.value,We),De!==null&&(t&&De.alternate!==null&&we.delete(De.key===null?Ae:De.key),Ee=y(De,Ee,Ae),Ut===null?Ct=De:Ut.sibling=De,Ut=De);return t&&we.forEach(function(pt){return e(be,pt)}),Dn&&nf(be,Ae),Ct}function it(be,Ee,Ce,We){if(typeof Ce=="object"&&Ce!==null&&Ce.type===Xp&&Ce.key===null&&(Ce=Ce.props.children),typeof Ce=="object"&&Ce!==null){switch(Ce.$$typeof){case nx:e:{for(var Ct=Ce.key;Ee!==null;){if(Ee.key===Ct){if(Ct=Ce.type,Ct===Xp){if(Ee.tag===7){n(be,Ee.sibling),We=d(Ee,Ce.props.children),We.return=be,be=We;break e}}else if(Ee.elementType===Ct||typeof Ct=="object"&&Ct!==null&&Ct.$$typeof===fh&&hD(Ct)===Ee.type){n(be,Ee.sibling),We=d(Ee,Ce.props),G_(We,Ce),We.return=be,be=We;break e}n(be,Ee);break}else e(be,Ee);Ee=Ee.sibling}Ce.type===Xp?(We=pf(Ce.props.children,be.mode,We,Ce.key),We.return=be,be=We):(We=zx(Ce.type,Ce.key,Ce.props,null,be.mode,We),G_(We,Ce),We.return=be,be=We)}return A(be);case Y_:e:{for(Ct=Ce.key;Ee!==null;){if(Ee.key===Ct)if(Ee.tag===4&&Ee.stateNode.containerInfo===Ce.containerInfo&&Ee.stateNode.implementation===Ce.implementation){n(be,Ee.sibling),We=d(Ee,Ce.children||[]),We.return=be,be=We;break e}else{n(be,Ee);break}else e(be,Ee);Ee=Ee.sibling}We=a2(Ce,be.mode,We),We.return=be,be=We}return A(be);case fh:return Ct=Ce._init,Ce=Ct(Ce._payload),it(be,Ee,Ce,We)}if(Q_(Ce))return Ue(be,Ee,Ce,We);if(V_(Ce)){if(Ct=V_(Ce),typeof Ct!="function")throw Error(Vt(150));return Ce=Ct.call(Ce),Xe(be,Ee,Ce,We)}if(typeof Ce.then=="function")return it(be,Ee,cx(Ce),We);if(Ce.$$typeof===tu)return it(be,Ee,hx(be,Ce),We);ux(be,Ce)}return typeof Ce=="string"&&Ce!==""||typeof Ce=="number"||typeof Ce=="bigint"?(Ce=""+Ce,Ee!==null&&Ee.tag===6?(n(be,Ee.sibling),We=d(Ee,Ce),We.return=be,be=We):(n(be,Ee),We=s2(Ce,be.mode,We),We.return=be,be=We),A(be)):n(be,Ee)}return function(be,Ee,Ce,We){try{Oy=0;var Ct=it(be,Ee,Ce,We);return um=null,Ct}catch(we){if(we===hy)throw we;var Ut=qo(29,we,null,be.mode);return Ut.lanes=We,Ut.return=be,Ut}finally{}}}var yf=KL(!0),QL=KL(!1),wm=fc(null),a1=fc(0);function dD(t,e){t=_u,Tr(a1,t),Tr(wm,e),_u=t|e.baseLanes}function W2(){Tr(a1,_u),Tr(wm,wm.current)}function bS(){_u=a1.current,Ms(wm),Ms(a1)}var Xo=fc(null),sc=null;function mh(t){var e=t.alternate;Tr(gs,gs.current&1),Tr(Xo,t),sc===null&&(e===null||wm.current!==null||e.memoizedState!==null)&&(sc=t)}function JL(t){if(t.tag===22){if(Tr(gs,gs.current),Tr(Xo,t),sc===null){var e=t.alternate;e!==null&&e.memoizedState!==null&&(sc=t)}}else gh()}function gh(){Tr(gs,gs.current),Tr(Xo,Xo.current)}function ru(t){Ms(Xo),sc===t&&(sc=null),Ms(gs)}var gs=fc(0);function o1(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var F6=typeof AbortController<"u"?AbortController:function(){var t=[],e=this.signal={aborted:!1,addEventListener:function(n,l){t.push(l)}};this.abort=function(){e.aborted=!0,t.forEach(function(n){return n()})}},B6=ys.unstable_scheduleCallback,V6=ys.unstable_NormalPriority,ms={$$typeof:tu,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function wS(){return{controller:new F6,data:new Map,refCount:0}}function a0(t){t.refCount--,t.refCount===0&&B6(V6,function(){t.controller.abort()})}var fy=null,X2=0,Tm=0,hm=null;function U6(t,e){if(fy===null){var n=fy=[];X2=0,Tm=HS(),hm={status:"pending",value:void 0,then:function(l){n.push(l)}}}return X2++,e.then(fD,fD),e}function fD(){if(--X2===0&&fy!==null){hm!==null&&(hm.status="fulfilled");var t=fy;fy=null,Tm=0,hm=null;for(var e=0;e<t.length;e++)(0,t[e])()}}function j6(t,e){var n=[],l={status:"pending",value:null,reason:null,then:function(d){n.push(d)}};return t.then(function(){l.status="fulfilled",l.value=e;for(var d=0;d<n.length;d++)(0,n[d])(e)},function(d){for(l.status="rejected",l.reason=d,d=0;d<n.length;d++)(0,n[d])(void 0)}),l}var pD=nn.S;nn.S=function(t,e){typeof e=="object"&&e!==null&&typeof e.then=="function"&&U6(t,e),pD!==null&&pD(t,e)};var ff=fc(null);function TS(){var t=ff.current;return t!==null?t:lr.pooledCache}function Rx(t,e){e===null?Tr(ff,ff.current):Tr(ff,e.pool)}function ez(){var t=TS();return t===null?null:{parent:ms._currentValue,pool:t}}var Vh=0,cn=null,Xn=null,ts=null,l1=!1,dm=!1,vf=!1,c1=0,ky=0,fm=null,q6=0;function $r(){throw Error(Vt(321))}function ES(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!mo(t[n],e[n]))return!1;return!0}function SS(t,e,n,l,d,y){return Vh=y,cn=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,nn.H=t===null||t.memoizedState===null?Df:ed,vf=!1,y=n(l,d),vf=!1,dm&&(y=iz(e,n,l,d)),tz(t),y}function tz(t){nn.H=uc;var e=Xn!==null&&Xn.next!==null;if(Vh=0,ts=Xn=cn=null,l1=!1,ky=0,fm=null,e)throw Error(Vt(300));t===null||Is||(t=t.dependencies,t!==null&&d1(t)&&(Is=!0))}function iz(t,e,n,l){cn=t;var d=0;do{if(dm&&(fm=null),ky=0,dm=!1,25<=d)throw Error(Vt(301));if(d+=1,ts=Xn=null,t.updateQueue!=null){var y=t.updateQueue;y.lastEffect=null,y.events=null,y.stores=null,y.memoCache!=null&&(y.memoCache.index=0)}nn.H=Pf,y=e(n,l)}while(dm);return y}function G6(){var t=nn.H,e=t.useState()[0];return e=typeof e.then=="function"?o0(e):e,t=t.useState()[0],(Xn!==null?Xn.memoizedState:null)!==t&&(cn.flags|=1024),e}function AS(){var t=c1!==0;return c1=0,t}function IS(t,e,n){e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~n}function MS(t){if(l1){for(t=t.memoizedState;t!==null;){var e=t.queue;e!==null&&(e.pending=null),t=t.next}l1=!1}Vh=0,ts=Xn=cn=null,dm=!1,ky=c1=0,fm=null}function Ba(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ts===null?cn.memoizedState=ts=t:ts=ts.next=t,ts}function ns(){if(Xn===null){var t=cn.alternate;t=t!==null?t.memoizedState:null}else t=Xn.next;var e=ts===null?cn.memoizedState:ts.next;if(e!==null)ts=e,Xn=t;else{if(t===null)throw cn.alternate===null?Error(Vt(467)):Error(Vt(310));Xn=t,t={memoizedState:Xn.memoizedState,baseState:Xn.baseState,baseQueue:Xn.baseQueue,queue:Xn.queue,next:null},ts===null?cn.memoizedState=ts=t:ts=ts.next=t}return ts}var rb;rb=function(){return{lastEffect:null,events:null,stores:null,memoCache:null}};function o0(t){var e=ky;return ky+=1,fm===null&&(fm=[]),t=YL(fm,t,e),e=cn,(ts===null?e.memoizedState:ts.next)===null&&(e=e.alternate,nn.H=e===null||e.memoizedState===null?Df:ed),t}function sb(t){if(t!==null&&typeof t=="object"){if(typeof t.then=="function")return o0(t);if(t.$$typeof===tu)return ua(t)}throw Error(Vt(438,String(t)))}function CS(t){var e=null,n=cn.updateQueue;if(n!==null&&(e=n.memoCache),e==null){var l=cn.alternate;l!==null&&(l=l.updateQueue,l!==null&&(l=l.memoCache,l!=null&&(e={data:l.data.map(function(d){return d.slice()}),index:0})))}if(e==null&&(e={data:[],index:0}),n===null&&(n=rb(),cn.updateQueue=n),n.memoCache=e,n=e.data[e.index],n===void 0)for(n=e.data[e.index]=Array(t),l=0;l<t;l++)n[l]=AV;return e.index++,n}function mu(t,e){return typeof e=="function"?e(t):e}function Dx(t){var e=ns();return RS(e,Xn,t)}function RS(t,e,n){var l=t.queue;if(l===null)throw Error(Vt(311));l.lastRenderedReducer=n;var d=t.baseQueue,y=l.pending;if(y!==null){if(d!==null){var A=d.next;d.next=y.next,y.next=A}e.baseQueue=d=y,l.pending=null}if(y=t.baseState,d===null)t.memoizedState=y;else{e=d.next;var s=A=null,N=null,j=e,K=!1;do{var se=j.lane&-536870913;if(se!==j.lane?(Cn&se)===se:(Vh&se)===se){var ae=j.revertLane;if(ae===0)N!==null&&(N=N.next={lane:0,revertLane:0,action:j.action,hasEagerState:j.hasEagerState,eagerState:j.eagerState,next:null}),se===Tm&&(K=!0);else if((Vh&ae)===ae){j=j.next,ae===Tm&&(K=!0);continue}else se={lane:0,revertLane:j.revertLane,action:j.action,hasEagerState:j.hasEagerState,eagerState:j.eagerState,next:null},N===null?(s=N=se,A=y):N=N.next=se,cn.lanes|=ae,jh|=ae;se=j.action,vf&&n(y,se),y=j.hasEagerState?j.eagerState:n(y,se)}else ae={lane:se,revertLane:j.revertLane,action:j.action,hasEagerState:j.hasEagerState,eagerState:j.eagerState,next:null},N===null?(s=N=ae,A=y):N=N.next=ae,cn.lanes|=se,jh|=se;j=j.next}while(j!==null&&j!==e);if(N===null?A=y:N.next=s,!mo(y,t.memoizedState)&&(Is=!0,K&&(n=hm,n!==null)))throw n;t.memoizedState=y,t.baseState=A,t.baseQueue=N,l.lastRenderedState=y}return d===null&&(l.lanes=0),[t.memoizedState,l.dispatch]}function WT(t){var e=ns(),n=e.queue;if(n===null)throw Error(Vt(311));n.lastRenderedReducer=t;var l=n.dispatch,d=n.pending,y=e.memoizedState;if(d!==null){n.pending=null;var A=d=d.next;do y=t(y,A.action),A=A.next;while(A!==d);mo(y,e.memoizedState)||(Is=!0),e.memoizedState=y,e.baseQueue===null&&(e.baseState=y),n.lastRenderedState=y}return[y,l]}function nz(t,e,n){var l=cn,d=ns(),y=Dn;if(y){if(n===void 0)throw Error(Vt(407));n=n()}else n=e();var A=!mo((Xn||d).memoizedState,n);if(A&&(d.memoizedState=n,Is=!0),d=d.queue,DS(az.bind(null,l,d,t),[t]),d.getSnapshot!==e||A||ts!==null&&ts.memoizedState.tag&1){if(l.flags|=2048,Em(9,sz.bind(null,l,d,n,e),{destroy:void 0},null),lr===null)throw Error(Vt(349));y||Vh&60||rz(l,e,n)}return n}function rz(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=cn.updateQueue,e===null?(e=rb(),cn.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function sz(t,e,n,l){e.value=n,e.getSnapshot=l,oz(e)&&lz(t)}function az(t,e,n){return n(function(){oz(e)&&lz(t)})}function oz(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!mo(t,n)}catch{return!0}}function lz(t){var e=Bh(t,2);e!==null&&Ca(e,t,2)}function Y2(t){var e=Ba();if(typeof t=="function"){var n=t;if(t=n(),vf){wh(!0);try{n()}finally{wh(!1)}}}return e.memoizedState=e.baseState=t,e.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:mu,lastRenderedState:t},e}function cz(t,e,n,l){return t.baseState=n,RS(t,Xn,typeof l=="function"?l:mu)}function H6(t,e,n,l,d){if(ob(t))throw Error(Vt(485));if(t=e.action,t!==null){var y={payload:d,action:t,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(A){y.listeners.push(A)}};nn.T!==null?n(!0):y.isTransition=!1,l(y),n=e.pending,n===null?(y.next=e.pending=y,uz(e,y)):(y.next=n.next,e.pending=n.next=y)}}function uz(t,e){var n=e.action,l=e.payload,d=t.state;if(e.isTransition){var y=nn.T,A={};nn.T=A;try{var s=n(d,l),N=nn.S;N!==null&&N(A,s),mD(t,e,s)}catch(j){K2(t,e,j)}finally{nn.T=y}}else try{y=n(d,l),mD(t,e,y)}catch(j){K2(t,e,j)}}function mD(t,e,n){n!==null&&typeof n=="object"&&typeof n.then=="function"?n.then(function(l){gD(t,e,l)},function(l){return K2(t,e,l)}):gD(t,e,n)}function gD(t,e,n){e.status="fulfilled",e.value=n,hz(e),t.state=n,e=t.pending,e!==null&&(n=e.next,n===e?t.pending=null:(n=n.next,e.next=n,uz(t,n)))}function K2(t,e,n){var l=t.pending;if(t.pending=null,l!==null){l=l.next;do e.status="rejected",e.reason=n,hz(e),e=e.next;while(e!==l)}t.action=null}function hz(t){t=t.listeners;for(var e=0;e<t.length;e++)(0,t[e])()}function dz(t,e){return e}function fz(t,e){if(Dn){var n=lr.formState;if(n!==null){e:{var l=cn;if(Dn){if(Us){t:{for(var d=Us,y=tc;d.nodeType!==8;){if(!y){d=null;break t}if(d=xl(d.nextSibling),d===null){d=null;break t}}y=d.data,d=y==="F!"||y==="F"?d:null}if(d){Us=xl(d.nextSibling),l=d.data==="F!";break e}}_f(l)}l=!1}l&&(e=n[0])}}return n=Ba(),n.memoizedState=n.baseState=e,l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:dz,lastRenderedState:e},n.queue=l,n=Rz.bind(null,cn,l),l.dispatch=n,l=Y2(!1),y=OS.bind(null,cn,!1,l.queue),l=Ba(),d={state:e,dispatch:null,action:t,pending:null},l.queue=d,n=H6.bind(null,cn,d,y,n),d.dispatch=n,l.memoizedState=t,[e,n,!1]}function pz(t){var e=ns();return mz(e,Xn,t)}function mz(t,e,n){e=RS(t,e,dz)[0],t=Dx(mu)[0],e=typeof e=="object"&&e!==null&&typeof e.then=="function"?o0(e):e;var l=ns(),d=l.queue,y=d.dispatch;return n!==l.memoizedState&&(cn.flags|=2048,Em(9,$6.bind(null,d,n),{destroy:void 0},null)),[e,y,t]}function $6(t,e){t.action=e}function gz(t){var e=ns(),n=Xn;if(n!==null)return mz(e,n,t);ns(),e=e.memoizedState,n=ns();var l=n.queue.dispatch;return n.memoizedState=t,[e,l,!1]}function Em(t,e,n,l){return t={tag:t,create:e,inst:n,deps:l,next:null},e=cn.updateQueue,e===null&&(e=rb(),cn.updateQueue=e),n=e.lastEffect,n===null?e.lastEffect=t.next=t:(l=n.next,n.next=t,t.next=l,e.lastEffect=t),t}function _z(){return ns().memoizedState}function Px(t,e,n,l){var d=Ba();cn.flags|=t,d.memoizedState=Em(1|e,n,{destroy:void 0},l===void 0?null:l)}function ab(t,e,n,l){var d=ns();l=l===void 0?null:l;var y=d.memoizedState.inst;Xn!==null&&l!==null&&ES(l,Xn.memoizedState.deps)?d.memoizedState=Em(e,n,y,l):(cn.flags|=t,d.memoizedState=Em(1|e,n,y,l))}function _D(t,e){Px(8390656,8,t,e)}function DS(t,e){ab(2048,8,t,e)}function yz(t,e){return ab(4,2,t,e)}function vz(t,e){return ab(4,4,t,e)}function xz(t,e){if(typeof e=="function"){t=t();var n=e(t);return function(){typeof n=="function"?n():e(null)}}if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function bz(t,e,n){n=n!=null?n.concat([t]):null,ab(4,4,xz.bind(null,e,t),n)}function PS(){}function wz(t,e){var n=ns();e=e===void 0?null:e;var l=n.memoizedState;return e!==null&&ES(e,l[1])?l[0]:(n.memoizedState=[t,e],t)}function Tz(t,e){var n=ns();e=e===void 0?null:e;var l=n.memoizedState;if(e!==null&&ES(e,l[1]))return l[0];if(l=t(),vf){wh(!0);try{t()}finally{wh(!1)}}return n.memoizedState=[l,e],l}function LS(t,e,n){return n===void 0||Vh&1073741824?t.memoizedState=e:(t.memoizedState=n,t=hO(),cn.lanes|=t,jh|=t,n)}function Ez(t,e,n,l){return mo(n,e)?n:wm.current!==null?(t=LS(t,n,l),mo(t,e)||(Is=!0),t):Vh&42?(t=hO(),cn.lanes|=t,jh|=t,e):(Is=!0,t.memoizedState=n)}function Sz(t,e,n,l,d){var y=_r.p;_r.p=y!==0&&8>y?y:8;var A=nn.T,s={};nn.T=s,OS(t,!1,e,n);try{var N=d(),j=nn.S;if(j!==null&&j(s,N),N!==null&&typeof N=="object"&&typeof N.then=="function"){var K=j6(N,l);py(t,e,K,fo(t))}else py(t,e,l,fo(t))}catch(se){py(t,e,{then:function(){},status:"rejected",reason:se},fo())}finally{_r.p=y,nn.T=A}}function Z6(){}function Q2(t,e,n,l){if(t.tag!==5)throw Error(Vt(476));var d=Az(t).queue;Sz(t,d,e,hf,n===null?Z6:function(){return Iz(t),n(l)})}function Az(t){var e=t.memoizedState;if(e!==null)return e;e={memoizedState:hf,baseState:hf,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:mu,lastRenderedState:hf},next:null};var n={};return e.next={memoizedState:n,baseState:n,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:mu,lastRenderedState:n},next:null},t.memoizedState=e,t=t.alternate,t!==null&&(t.memoizedState=e),e}function Iz(t){var e=Az(t).next.queue;py(t,e,{},fo())}function zS(){return ua(Vy)}function Mz(){return ns().memoizedState}function Cz(){return ns().memoizedState}function W6(t){for(var e=t.return;e!==null;){switch(e.tag){case 24:case 3:var n=fo();t=Ih(n);var l=Mh(e,t,n);l!==null&&(Ca(l,e,n),gy(l,e,n)),e={cache:wS()},t.payload=e;return}e=e.return}}function X6(t,e,n){var l=fo();n={lane:l,revertLane:0,action:n,hasEagerState:!1,eagerState:null,next:null},ob(t)?Dz(e,n):(n=yS(t,e,n,l),n!==null&&(Ca(n,t,l),Pz(n,e,l)))}function Rz(t,e,n){var l=fo();py(t,e,n,l)}function py(t,e,n,l){var d={lane:l,revertLane:0,action:n,hasEagerState:!1,eagerState:null,next:null};if(ob(t))Dz(e,d);else{var y=t.alternate;if(t.lanes===0&&(y===null||y.lanes===0)&&(y=e.lastRenderedReducer,y!==null))try{var A=e.lastRenderedState,s=y(A,n);if(d.hasEagerState=!0,d.eagerState=s,mo(s,A))return nb(t,e,d,0),lr===null&&ib(),!1}catch{}finally{}if(n=yS(t,e,d,l),n!==null)return Ca(n,t,l),Pz(n,e,l),!0}return!1}function OS(t,e,n,l){if(l={lane:2,revertLane:HS(),action:l,hasEagerState:!1,eagerState:null,next:null},ob(t)){if(e)throw Error(Vt(479))}else e=yS(t,n,l,2),e!==null&&Ca(e,t,2)}function ob(t){var e=t.alternate;return t===cn||e!==null&&e===cn}function Dz(t,e){dm=l1=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function Pz(t,e,n){if(n&4194176){var l=e.lanes;l&=t.pendingLanes,n|=l,e.lanes=n,xL(t,n)}}var uc={readContext:ua,use:sb,useCallback:$r,useContext:$r,useEffect:$r,useImperativeHandle:$r,useLayoutEffect:$r,useInsertionEffect:$r,useMemo:$r,useReducer:$r,useRef:$r,useState:$r,useDebugValue:$r,useDeferredValue:$r,useTransition:$r,useSyncExternalStore:$r,useId:$r};uc.useCacheRefresh=$r;uc.useMemoCache=$r;uc.useHostTransitionStatus=$r;uc.useFormState=$r;uc.useActionState=$r;uc.useOptimistic=$r;var Df={readContext:ua,use:sb,useCallback:function(t,e){return Ba().memoizedState=[t,e===void 0?null:e],t},useContext:ua,useEffect:_D,useImperativeHandle:function(t,e,n){n=n!=null?n.concat([t]):null,Px(4194308,4,xz.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Px(4194308,4,t,e)},useInsertionEffect:function(t,e){Px(4,2,t,e)},useMemo:function(t,e){var n=Ba();e=e===void 0?null:e;var l=t();if(vf){wh(!0);try{t()}finally{wh(!1)}}return n.memoizedState=[l,e],l},useReducer:function(t,e,n){var l=Ba();if(n!==void 0){var d=n(e);if(vf){wh(!0);try{n(e)}finally{wh(!1)}}}else d=e;return l.memoizedState=l.baseState=d,t={pending:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:d},l.queue=t,t=t.dispatch=X6.bind(null,cn,t),[l.memoizedState,t]},useRef:function(t){var e=Ba();return t={current:t},e.memoizedState=t},useState:function(t){t=Y2(t);var e=t.queue,n=Rz.bind(null,cn,e);return e.dispatch=n,[t.memoizedState,n]},useDebugValue:PS,useDeferredValue:function(t,e){var n=Ba();return LS(n,t,e)},useTransition:function(){var t=Y2(!1);return t=Sz.bind(null,cn,t.queue,!0,!1),Ba().memoizedState=t,[!1,t]},useSyncExternalStore:function(t,e,n){var l=cn,d=Ba();if(Dn){if(n===void 0)throw Error(Vt(407));n=n()}else{if(n=e(),lr===null)throw Error(Vt(349));Cn&60||rz(l,e,n)}d.memoizedState=n;var y={value:n,getSnapshot:e};return d.queue=y,_D(az.bind(null,l,y,t),[t]),l.flags|=2048,Em(9,sz.bind(null,l,y,n,e),{destroy:void 0},null),n},useId:function(){var t=Ba(),e=lr.identifierPrefix;if(Dn){var n=nu,l=iu;n=(l&~(1<<32-ho(l)-1)).toString(32)+n,e=":"+e+"R"+n,n=c1++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=q6++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},useCacheRefresh:function(){return Ba().memoizedState=W6.bind(null,cn)}};Df.useMemoCache=CS;Df.useHostTransitionStatus=zS;Df.useFormState=fz;Df.useActionState=fz;Df.useOptimistic=function(t){var e=Ba();e.memoizedState=e.baseState=t;var n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return e.queue=n,e=OS.bind(null,cn,!0,n),n.dispatch=e,[t,e]};var ed={readContext:ua,use:sb,useCallback:wz,useContext:ua,useEffect:DS,useImperativeHandle:bz,useInsertionEffect:yz,useLayoutEffect:vz,useMemo:Tz,useReducer:Dx,useRef:_z,useState:function(){return Dx(mu)},useDebugValue:PS,useDeferredValue:function(t,e){var n=ns();return Ez(n,Xn.memoizedState,t,e)},useTransition:function(){var t=Dx(mu)[0],e=ns().memoizedState;return[typeof t=="boolean"?t:o0(t),e]},useSyncExternalStore:nz,useId:Mz};ed.useCacheRefresh=Cz;ed.useMemoCache=CS;ed.useHostTransitionStatus=zS;ed.useFormState=pz;ed.useActionState=pz;ed.useOptimistic=function(t,e){var n=ns();return cz(n,Xn,t,e)};var Pf={readContext:ua,use:sb,useCallback:wz,useContext:ua,useEffect:DS,useImperativeHandle:bz,useInsertionEffect:yz,useLayoutEffect:vz,useMemo:Tz,useReducer:WT,useRef:_z,useState:function(){return WT(mu)},useDebugValue:PS,useDeferredValue:function(t,e){var n=ns();return Xn===null?LS(n,t,e):Ez(n,Xn.memoizedState,t,e)},useTransition:function(){var t=WT(mu)[0],e=ns().memoizedState;return[typeof t=="boolean"?t:o0(t),e]},useSyncExternalStore:nz,useId:Mz};Pf.useCacheRefresh=Cz;Pf.useMemoCache=CS;Pf.useHostTransitionStatus=zS;Pf.useFormState=gz;Pf.useActionState=gz;Pf.useOptimistic=function(t,e){var n=ns();return Xn!==null?cz(n,Xn,t,e):(n.baseState=t,[t,n.queue.dispatch])};function XT(t,e,n,l){e=t.memoizedState,n=n(l,e),n=n==null?e:yr({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var J2={isMounted:function(t){return(t=t._reactInternals)?Nm(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var l=fo(),d=Ih(l);d.payload=e,n!=null&&(d.callback=n),e=Mh(t,d,l),e!==null&&(Ca(e,t,l),gy(e,t,l))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var l=fo(),d=Ih(l);d.tag=1,d.payload=e,n!=null&&(d.callback=n),e=Mh(t,d,l),e!==null&&(Ca(e,t,l),gy(e,t,l))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=fo(),l=Ih(n);l.tag=2,e!=null&&(l.callback=e),e=Mh(t,l,n),e!==null&&(Ca(e,t,n),gy(e,t,n))}};function yD(t,e,n,l,d,y,A){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(l,y,A):e.prototype&&e.prototype.isPureReactComponent?!Ly(n,l)||!Ly(d,y):!0}function vD(t,e,n,l){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,l),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,l),e.state!==t&&J2.enqueueReplaceState(e,e.state,null)}function xf(t,e){var n=e;if("ref"in e){n={};for(var l in e)l!=="ref"&&(n[l]=e[l])}if(t=t.defaultProps){n===e&&(n=yr({},n));for(var d in t)n[d]===void 0&&(n[d]=t[d])}return n}var u1=typeof reportError=="function"?reportError:function(t){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var e=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof t=="object"&&t!==null&&typeof t.message=="string"?String(t.message):String(t),error:t});if(!window.dispatchEvent(e))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",t);return}console.error(t)};function Lz(t){u1(t)}function zz(t){console.error(t)}function Oz(t){u1(t)}function h1(t,e){try{var n=t.onUncaughtError;n(e.value,{componentStack:e.stack})}catch(l){setTimeout(function(){throw l})}}function xD(t,e,n){try{var l=t.onCaughtError;l(n.value,{componentStack:n.stack,errorBoundary:e.tag===1?e.stateNode:null})}catch(d){setTimeout(function(){throw d})}}function eE(t,e,n){return n=Ih(n),n.tag=3,n.payload={element:null},n.callback=function(){h1(t,e)},n}function kz(t){return t=Ih(t),t.tag=3,t}function Nz(t,e,n,l){var d=n.type.getDerivedStateFromError;if(typeof d=="function"){var y=l.value;t.payload=function(){return d(y)},t.callback=function(){xD(e,n,l)}}var A=n.stateNode;A!==null&&typeof A.componentDidCatch=="function"&&(t.callback=function(){xD(e,n,l),typeof d!="function"&&(Rh===null?Rh=new Set([this]):Rh.add(this));var s=l.stack;this.componentDidCatch(l.value,{componentStack:s!==null?s:""})})}function Y6(t,e,n,l,d){if(n.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){if(e=n.alternate,e!==null&&l0(e,n,d,!0),n=Xo.current,n!==null){switch(n.tag){case 13:return sc===null?mE():n.alternate===null&&Br===0&&(Br=3),n.flags&=-257,n.flags|=65536,n.lanes=d,l===Z2?n.flags|=16384:(e=n.updateQueue,e===null?n.updateQueue=new Set([l]):e.add(l),l2(t,l,d)),!1;case 22:return n.flags|=65536,l===Z2?n.flags|=16384:(e=n.updateQueue,e===null?(e={transitions:null,markerInstances:null,retryQueue:new Set([l])},n.updateQueue=e):(n=e.retryQueue,n===null?e.retryQueue=new Set([l]):n.add(l)),l2(t,l,d)),!1}throw Error(Vt(435,n.tag))}return l2(t,l,d),mE(),!1}if(Dn)return e=Xo.current,e!==null?(!(e.flags&65536)&&(e.flags|=256),e.flags|=65536,e.lanes=d,l!==$2&&(t=Error(Vt(422),{cause:l}),zy(Uo(t,n)))):(l!==$2&&(e=Error(Vt(423),{cause:l}),zy(Uo(e,n))),t=t.current.alternate,t.flags|=65536,d&=-d,t.lanes|=d,l=Uo(l,n),d=eE(t.stateNode,l,d),t2(t,d),Br!==4&&(Br=2)),!1;var y=Error(Vt(520),{cause:l});if(y=Uo(y,n),xy===null?xy=[y]:xy.push(y),Br!==4&&(Br=2),e===null)return!0;l=Uo(l,n),n=e;do{switch(n.tag){case 3:return n.flags|=65536,t=d&-d,n.lanes|=t,t=eE(n.stateNode,l,t),t2(n,t),!1;case 1:if(e=n.type,y=n.stateNode,(n.flags&128)===0&&(typeof e.getDerivedStateFromError=="function"||y!==null&&typeof y.componentDidCatch=="function"&&(Rh===null||!Rh.has(y))))return n.flags|=65536,d&=-d,n.lanes|=d,d=kz(d),Nz(d,t,n,l),t2(n,d),!1}n=n.return}while(n!==null);return!1}var Fz=Error(Vt(461)),Is=!1;function Bs(t,e,n,l){e.child=t===null?QL(e,null,n,l):yf(e,t.child,n,l)}function bD(t,e,n,l,d){n=n.render;var y=e.ref;if("ref"in l){var A={};for(var s in l)s!=="ref"&&(A[s]=l[s])}else A=l;return bf(e),l=SS(t,e,n,A,y,d),s=AS(),t!==null&&!Is?(IS(t,e,d),gu(t,e,d)):(Dn&&s&&vS(e),e.flags|=1,Bs(t,e,l,d),e.child)}function wD(t,e,n,l,d){if(t===null){var y=n.type;return typeof y=="function"&&!VS(y)&&y.defaultProps===void 0&&n.compare===null?(e.tag=15,e.type=y,Bz(t,e,y,l,d)):(t=zx(n.type,null,l,e,e.mode,d),t.ref=e.ref,t.return=e,e.child=t)}if(y=t.child,!kS(t,d)){var A=y.memoizedProps;if(n=n.compare,n=n!==null?n:Ly,n(A,l)&&t.ref===e.ref)return gu(t,e,d)}return e.flags|=1,t=Ch(y,l),t.ref=e.ref,t.return=e,e.child=t}function Bz(t,e,n,l,d){if(t!==null){var y=t.memoizedProps;if(Ly(y,l)&&t.ref===e.ref)if(Is=!1,e.pendingProps=l=y,kS(t,d))t.flags&131072&&(Is=!0);else return e.lanes=t.lanes,gu(t,e,d)}return tE(t,e,n,l,d)}function Vz(t,e,n){var l=e.pendingProps,d=l.children,y=(e.stateNode._pendingVisibility&2)!==0,A=t!==null?t.memoizedState:null;if(my(t,e),l.mode==="hidden"||y){if(e.flags&128){if(l=A!==null?A.baseLanes|n:n,t!==null){for(d=e.child=t.child,y=0;d!==null;)y=y|d.lanes|d.childLanes,d=d.sibling;e.childLanes=y&~l}else e.childLanes=0,e.child=null;return TD(t,e,l,n)}if(n&536870912)e.memoizedState={baseLanes:0,cachePool:null},t!==null&&Rx(e,A!==null?A.cachePool:null),A!==null?dD(e,A):W2(),JL(e);else return e.lanes=e.childLanes=536870912,TD(t,e,A!==null?A.baseLanes|n:n,n)}else A!==null?(Rx(e,A.cachePool),dD(e,A),gh(),e.memoizedState=null):(t!==null&&Rx(e,null),W2(),gh());return Bs(t,e,d,n),e.child}function TD(t,e,n,l){var d=TS();return d=d===null?null:{parent:ms._currentValue,pool:d},e.memoizedState={baseLanes:n,cachePool:d},t!==null&&Rx(e,null),W2(),JL(e),t!==null&&l0(t,e,l,!0),null}function my(t,e){var n=e.ref;if(n===null)t!==null&&t.ref!==null&&(e.flags|=2097664);else{if(typeof n!="function"&&typeof n!="object")throw Error(Vt(284));(t===null||t.ref!==n)&&(e.flags|=2097664)}}function tE(t,e,n,l,d){return bf(e),n=SS(t,e,n,l,void 0,d),l=AS(),t!==null&&!Is?(IS(t,e,d),gu(t,e,d)):(Dn&&l&&vS(e),e.flags|=1,Bs(t,e,n,d),e.child)}function ED(t,e,n,l,d,y){return bf(e),e.updateQueue=null,n=iz(e,l,n,d),tz(t),l=AS(),t!==null&&!Is?(IS(t,e,y),gu(t,e,y)):(Dn&&l&&vS(e),e.flags|=1,Bs(t,e,n,y),e.child)}function SD(t,e,n,l,d){if(bf(e),e.stateNode===null){var y=im,A=n.contextType;typeof A=="object"&&A!==null&&(y=ua(A)),y=new n(l,y),e.memoizedState=y.state!==null&&y.state!==void 0?y.state:null,y.updater=J2,e.stateNode=y,y._reactInternals=e,y=e.stateNode,y.props=l,y.state=e.memoizedState,y.refs={},NS(e),A=n.contextType,y.context=typeof A=="object"&&A!==null?ua(A):im,y.state=e.memoizedState,A=n.getDerivedStateFromProps,typeof A=="function"&&(XT(e,n,A,l),y.state=e.memoizedState),typeof n.getDerivedStateFromProps=="function"||typeof y.getSnapshotBeforeUpdate=="function"||typeof y.UNSAFE_componentWillMount!="function"&&typeof y.componentWillMount!="function"||(A=y.state,typeof y.componentWillMount=="function"&&y.componentWillMount(),typeof y.UNSAFE_componentWillMount=="function"&&y.UNSAFE_componentWillMount(),A!==y.state&&J2.enqueueReplaceState(y,y.state,null),yy(e,l,y,d),_y(),y.state=e.memoizedState),typeof y.componentDidMount=="function"&&(e.flags|=4194308),l=!0}else if(t===null){y=e.stateNode;var s=e.memoizedProps,N=xf(n,s);y.props=N;var j=y.context,K=n.contextType;A=im,typeof K=="object"&&K!==null&&(A=ua(K));var se=n.getDerivedStateFromProps;K=typeof se=="function"||typeof y.getSnapshotBeforeUpdate=="function",s=e.pendingProps!==s,K||typeof y.UNSAFE_componentWillReceiveProps!="function"&&typeof y.componentWillReceiveProps!="function"||(s||j!==A)&&vD(e,y,l,A),ph=!1;var ae=e.memoizedState;y.state=ae,yy(e,l,y,d),_y(),j=e.memoizedState,s||ae!==j||ph?(typeof se=="function"&&(XT(e,n,se,l),j=e.memoizedState),(N=ph||yD(e,n,N,l,ae,j,A))?(K||typeof y.UNSAFE_componentWillMount!="function"&&typeof y.componentWillMount!="function"||(typeof y.componentWillMount=="function"&&y.componentWillMount(),typeof y.UNSAFE_componentWillMount=="function"&&y.UNSAFE_componentWillMount()),typeof y.componentDidMount=="function"&&(e.flags|=4194308)):(typeof y.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=l,e.memoizedState=j),y.props=l,y.state=j,y.context=A,l=N):(typeof y.componentDidMount=="function"&&(e.flags|=4194308),l=!1)}else{y=e.stateNode,oE(t,e),A=e.memoizedProps,K=xf(n,A),y.props=K,se=e.pendingProps,ae=y.context,j=n.contextType,N=im,typeof j=="object"&&j!==null&&(N=ua(j)),s=n.getDerivedStateFromProps,(j=typeof s=="function"||typeof y.getSnapshotBeforeUpdate=="function")||typeof y.UNSAFE_componentWillReceiveProps!="function"&&typeof y.componentWillReceiveProps!="function"||(A!==se||ae!==N)&&vD(e,y,l,N),ph=!1,ae=e.memoizedState,y.state=ae,yy(e,l,y,d),_y();var me=e.memoizedState;A!==se||ae!==me||ph||t!==null&&t.dependencies!==null&&d1(t.dependencies)?(typeof s=="function"&&(XT(e,n,s,l),me=e.memoizedState),(K=ph||yD(e,n,K,l,ae,me,N)||t!==null&&t.dependencies!==null&&d1(t.dependencies))?(j||typeof y.UNSAFE_componentWillUpdate!="function"&&typeof y.componentWillUpdate!="function"||(typeof y.componentWillUpdate=="function"&&y.componentWillUpdate(l,me,N),typeof y.UNSAFE_componentWillUpdate=="function"&&y.UNSAFE_componentWillUpdate(l,me,N)),typeof y.componentDidUpdate=="function"&&(e.flags|=4),typeof y.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof y.componentDidUpdate!="function"||A===t.memoizedProps&&ae===t.memoizedState||(e.flags|=4),typeof y.getSnapshotBeforeUpdate!="function"||A===t.memoizedProps&&ae===t.memoizedState||(e.flags|=1024),e.memoizedProps=l,e.memoizedState=me),y.props=l,y.state=me,y.context=N,l=K):(typeof y.componentDidUpdate!="function"||A===t.memoizedProps&&ae===t.memoizedState||(e.flags|=4),typeof y.getSnapshotBeforeUpdate!="function"||A===t.memoizedProps&&ae===t.memoizedState||(e.flags|=1024),l=!1)}return y=l,my(t,e),l=(e.flags&128)!==0,y||l?(y=e.stateNode,n=l&&typeof n.getDerivedStateFromError!="function"?null:y.render(),e.flags|=1,t!==null&&l?(e.child=yf(e,t.child,null,d),e.child=yf(e,null,n,d)):Bs(t,e,n,d),e.memoizedState=y.state,t=e.child):t=gu(t,e,d),t}function AD(t,e,n,l){return s0(),e.flags|=256,Bs(t,e,n,l),e.child}var YT={dehydrated:null,treeContext:null,retryLane:0};function KT(t){return{baseLanes:t,cachePool:ez()}}function QT(t,e,n){return t=t!==null?t.childLanes&~n:0,e&&(t|=Go),t}function Uz(t,e,n){var l=e.pendingProps,d=!1,y=(e.flags&128)!==0,A;if((A=y)||(A=t!==null&&t.memoizedState===null?!1:(gs.current&2)!==0),A&&(d=!0,e.flags&=-129),A=(e.flags&32)!==0,e.flags&=-33,t===null){if(Dn){if(d?mh(e):gh(),Dn){var s=Us,N;if(N=s){e:{for(N=s,s=tc;N.nodeType!==8;){if(!s){s=null;break e}if(N=xl(N.nextSibling),N===null){s=null;break e}}s=N}s!==null?(e.memoizedState={dehydrated:s,treeContext:df!==null?{id:iu,overflow:nu}:null,retryLane:536870912},N=qo(18,null,null,0),N.stateNode=s,N.return=e,e.child=N,Ia=e,Us=null,N=!0):N=!1}N||_f(e)}if(s=e.memoizedState,s!==null&&(s=s.dehydrated,s!==null))return s.data==="$!"?e.lanes=16:e.lanes=536870912,null;ru(e)}return s=l.children,l=l.fallback,d?(gh(),d=e.mode,s=nE({mode:"hidden",children:s},d),l=pf(l,d,n,null),s.return=e,l.return=e,s.sibling=l,e.child=s,d=e.child,d.memoizedState=KT(n),d.childLanes=QT(t,A,n),e.memoizedState=YT,l):(mh(e),iE(e,s))}if(N=t.memoizedState,N!==null&&(s=N.dehydrated,s!==null)){if(y)e.flags&256?(mh(e),e.flags&=-257,e=JT(t,e,n)):e.memoizedState!==null?(gh(),e.child=t.child,e.flags|=128,e=null):(gh(),d=l.fallback,s=e.mode,l=nE({mode:"visible",children:l.children},s),d=pf(d,s,n,null),d.flags|=2,l.return=e,d.return=e,l.sibling=d,e.child=l,yf(e,t.child,null,n),l=e.child,l.memoizedState=KT(n),l.childLanes=QT(t,A,n),e.memoizedState=YT,e=d);else if(mh(e),s.data==="$!"){if(A=s.nextSibling&&s.nextSibling.dataset,A)var j=A.dgst;A=j,l=Error(Vt(419)),l.stack="",l.digest=A,zy({value:l,source:null,stack:null}),e=JT(t,e,n)}else if(Is||l0(t,e,n,!1),A=(n&t.childLanes)!==0,Is||A){if(A=lr,A!==null){if(l=n&-n,l&42)l=1;else switch(l){case 2:l=1;break;case 8:l=4;break;case 32:l=16;break;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:l=64;break;case 268435456:l=134217728;break;default:l=0}if(l=l&(A.suspendedLanes|n)?0:l,l!==0&&l!==N.retryLane)throw N.retryLane=l,Bh(t,l),Ca(A,t,l),Fz}s.data==="$?"||mE(),e=JT(t,e,n)}else s.data==="$?"?(e.flags|=128,e.child=t.child,e=hU.bind(null,t),s._reactRetry=e,e=null):(t=N.treeContext,Us=xl(s.nextSibling),Ia=e,Dn=!0,vl=null,tc=!1,t!==null&&(Fo[Bo++]=iu,Fo[Bo++]=nu,Fo[Bo++]=df,iu=t.id,nu=t.overflow,df=e),e=iE(e,l.children),e.flags|=4096);return e}return d?(gh(),d=l.fallback,s=e.mode,N=t.child,j=N.sibling,l=Ch(N,{mode:"hidden",children:l.children}),l.subtreeFlags=N.subtreeFlags&31457280,j!==null?d=Ch(j,d):(d=pf(d,s,n,null),d.flags|=2),d.return=e,l.return=e,l.sibling=d,e.child=l,l=d,d=e.child,s=t.child.memoizedState,s===null?s=KT(n):(N=s.cachePool,N!==null?(j=ms._currentValue,N=N.parent!==j?{parent:j,pool:j}:N):N=ez(),s={baseLanes:s.baseLanes|n,cachePool:N}),d.memoizedState=s,d.childLanes=QT(t,A,n),e.memoizedState=YT,l):(mh(e),n=t.child,t=n.sibling,n=Ch(n,{mode:"visible",children:l.children}),n.return=e,n.sibling=null,t!==null&&(A=e.deletions,A===null?(e.deletions=[t],e.flags|=16):A.push(t)),e.child=n,e.memoizedState=null,n)}function iE(t,e){return e=nE({mode:"visible",children:e},t.mode),e.return=t,t.child=e}function nE(t,e){return cO(t,e,0,null)}function JT(t,e,n){return yf(e,t.child,null,n),t=iE(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function ID(t,e,n){t.lanes|=e;var l=t.alternate;l!==null&&(l.lanes|=e),sE(t.return,e,n)}function e2(t,e,n,l,d){var y=t.memoizedState;y===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:l,tail:n,tailMode:d}:(y.isBackwards=e,y.rendering=null,y.renderingStartTime=0,y.last=l,y.tail=n,y.tailMode=d)}function jz(t,e,n){var l=e.pendingProps,d=l.revealOrder,y=l.tail;if(Bs(t,e,l.children,n),l=gs.current,l&2)l=l&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&ID(t,n,e);else if(t.tag===19)ID(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}l&=1}switch(Tr(gs,l),d){case"forwards":for(n=e.child,d=null;n!==null;)t=n.alternate,t!==null&&o1(t)===null&&(d=n),n=n.sibling;n=d,n===null?(d=e.child,e.child=null):(d=n.sibling,n.sibling=null),e2(e,!1,d,n,y);break;case"backwards":for(n=null,d=e.child,e.child=null;d!==null;){if(t=d.alternate,t!==null&&o1(t)===null){e.child=d;break}t=d.sibling,d.sibling=n,n=d,d=t}e2(e,!0,n,null,y);break;case"together":e2(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function gu(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),jh|=e.lanes,!(n&e.childLanes))if(t!==null){if(l0(t,e,n,!1),(n&e.childLanes)===0)return null}else return null;if(t!==null&&e.child!==t.child)throw Error(Vt(153));if(e.child!==null){for(t=e.child,n=Ch(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Ch(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function kS(t,e){return t.lanes&e?!0:(t=t.dependencies,!!(t!==null&&d1(t)))}function K6(t,e,n){switch(e.tag){case 3:Qx(e,e.stateNode.containerInfo),_h(e,ms,t.memoizedState.cache),s0();break;case 27:case 5:N2(e);break;case 4:Qx(e,e.stateNode.containerInfo);break;case 10:_h(e,e.type,e.memoizedProps.value);break;case 13:var l=e.memoizedState;if(l!==null)return l.dehydrated!==null?(mh(e),e.flags|=128,null):n&e.child.childLanes?Uz(t,e,n):(mh(e),t=gu(t,e,n),t!==null?t.sibling:null);mh(e);break;case 19:var d=(t.flags&128)!==0;if(l=(n&e.childLanes)!==0,l||(l0(t,e,n,!1),l=(n&e.childLanes)!==0),d){if(l)return jz(t,e,n);e.flags|=128}if(d=e.memoizedState,d!==null&&(d.rendering=null,d.tail=null,d.lastEffect=null),Tr(gs,gs.current),l)break;return null;case 22:case 23:return e.lanes=0,Vz(t,e,n);case 24:_h(e,ms,t.memoizedState.cache)}return gu(t,e,n)}function qz(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps)Is=!0;else{if(!kS(t,n)&&!(e.flags&128))return Is=!1,K6(t,e,n);Is=!!(t.flags&131072)}else Is=!1,Dn&&e.flags&1048576&&WL(e,s1,e.index);switch(e.lanes=0,e.tag){case 16:e:{t=e.pendingProps;var l=e.elementType,d=l._init;if(l=d(l._payload),e.type=l,typeof l=="function")VS(l)?(t=xf(l,t),e.tag=1,e=SD(null,e,l,t,n)):(e.tag=0,e=tE(null,e,l,t,n));else{if(l!=null){if(d=l.$$typeof,d===oS){e.tag=11,e=bD(null,e,l,t,n);break e}else if(d===lS){e.tag=14,e=wD(null,e,l,t,n);break e}}throw e=O2(l)||l,Error(Vt(306,e,""))}}return e;case 0:return tE(t,e,e.type,e.pendingProps,n);case 1:return l=e.type,d=xf(l,e.pendingProps),SD(t,e,l,d,n);case 3:e:{if(Qx(e,e.stateNode.containerInfo),t===null)throw Error(Vt(387));var y=e.pendingProps;d=e.memoizedState,l=d.element,oE(t,e),yy(e,y,null,n);var A=e.memoizedState;if(y=A.cache,_h(e,ms,y),y!==d.cache&&aE(e,[ms],n,!0),_y(),y=A.element,d.isDehydrated)if(d={element:y,isDehydrated:!1,cache:A.cache},e.updateQueue.baseState=d,e.memoizedState=d,e.flags&256){e=AD(t,e,y,n);break e}else if(y!==l){l=Uo(Error(Vt(424)),e),zy(l),e=AD(t,e,y,n);break e}else for(Us=xl(e.stateNode.containerInfo.firstChild),Ia=e,Dn=!0,vl=null,tc=!0,n=QL(e,null,y,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(s0(),y===l){e=gu(t,e,n);break e}Bs(t,e,y,n)}e=e.child}return e;case 26:return my(t,e),t===null?(n=HD(e.type,null,e.pendingProps,null))?e.memoizedState=n:Dn||(n=e.type,t=e.pendingProps,l=v1(Ah.current).createElement(n),l[ca]=e,l[qa]=t,qs(l,n,t),As(l),e.stateNode=l):e.memoizedState=HD(e.type,t.memoizedProps,e.pendingProps,t.memoizedState),null;case 27:return N2(e),t===null&&Dn&&(l=e.stateNode=IO(e.type,e.pendingProps,Ah.current),Ia=e,tc=!0,Us=xl(l.firstChild)),l=e.pendingProps.children,t!==null||Dn?Bs(t,e,l,n):e.child=yf(e,null,l,n),my(t,e),e.child;case 5:return t===null&&Dn&&((d=l=Us)&&(l=IU(l,e.type,e.pendingProps,tc),l!==null?(e.stateNode=l,Ia=e,Us=xl(l.firstChild),tc=!1,d=!0):d=!1),d||_f(e)),N2(e),d=e.type,y=e.pendingProps,A=t!==null?t.memoizedProps:null,l=y.children,xE(d,y)?l=null:A!==null&&xE(d,A)&&(e.flags|=32),e.memoizedState!==null&&(d=SS(t,e,G6,null,null,n),Vy._currentValue=d),my(t,e),Bs(t,e,l,n),e.child;case 6:return t===null&&Dn&&((t=n=Us)&&(n=MU(n,e.pendingProps,tc),n!==null?(e.stateNode=n,Ia=e,Us=null,t=!0):t=!1),t||_f(e)),null;case 13:return Uz(t,e,n);case 4:return Qx(e,e.stateNode.containerInfo),l=e.pendingProps,t===null?e.child=yf(e,null,l,n):Bs(t,e,l,n),e.child;case 11:return bD(t,e,e.type,e.pendingProps,n);case 7:return Bs(t,e,e.pendingProps,n),e.child;case 8:return Bs(t,e,e.pendingProps.children,n),e.child;case 12:return Bs(t,e,e.pendingProps.children,n),e.child;case 10:return l=e.pendingProps,_h(e,e.type,l.value),Bs(t,e,l.children,n),e.child;case 9:return d=e.type._context,l=e.pendingProps.children,bf(e),d=ua(d),l=l(d),e.flags|=1,Bs(t,e,l,n),e.child;case 14:return wD(t,e,e.type,e.pendingProps,n);case 15:return Bz(t,e,e.type,e.pendingProps,n);case 19:return jz(t,e,n);case 22:return Vz(t,e,n);case 24:return bf(e),l=ua(ms),t===null?(d=TS(),d===null&&(d=lr,y=wS(),d.pooledCache=y,y.refCount++,y!==null&&(d.pooledCacheLanes|=n),d=y),e.memoizedState={parent:l,cache:d},NS(e),_h(e,ms,d)):(t.lanes&n&&(oE(t,e),yy(e,null,null,n),_y()),d=t.memoizedState,y=e.memoizedState,d.parent!==l?(d={parent:l,cache:l},e.memoizedState=d,e.lanes===0&&(e.memoizedState=e.updateQueue.baseState=d),_h(e,ms,l)):(l=y.cache,_h(e,ms,l),l!==d.cache&&aE(e,[ms],n,!0))),Bs(t,e,e.pendingProps.children,n),e.child;case 29:throw e.pendingProps}throw Error(Vt(156,e.tag))}var rE=fc(null),Lf=null,su=null;function _h(t,e,n){Tr(rE,e._currentValue),e._currentValue=n}function cu(t){t._currentValue=rE.current,Ms(rE)}function sE(t,e,n){for(;t!==null;){var l=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,l!==null&&(l.childLanes|=e)):l!==null&&(l.childLanes&e)!==e&&(l.childLanes|=e),t===n)break;t=t.return}}function aE(t,e,n,l){var d=t.child;for(d!==null&&(d.return=t);d!==null;){var y=d.dependencies;if(y!==null){var A=d.child;y=y.firstContext;e:for(;y!==null;){var s=y;y=d;for(var N=0;N<e.length;N++)if(s.context===e[N]){y.lanes|=n,s=y.alternate,s!==null&&(s.lanes|=n),sE(y.return,n,t),l||(A=null);break e}y=s.next}}else if(d.tag===18){if(A=d.return,A===null)throw Error(Vt(341));A.lanes|=n,y=A.alternate,y!==null&&(y.lanes|=n),sE(A,n,t),A=null}else A=d.child;if(A!==null)A.return=d;else for(A=d;A!==null;){if(A===t){A=null;break}if(d=A.sibling,d!==null){d.return=A.return,A=d;break}A=A.return}d=A}}function l0(t,e,n,l){t=null;for(var d=e,y=!1;d!==null;){if(!y){if(d.flags&524288)y=!0;else if(d.flags&262144)break}if(d.tag===10){var A=d.alternate;if(A===null)throw Error(Vt(387));if(A=A.memoizedProps,A!==null){var s=d.type;mo(d.pendingProps.value,A.value)||(t!==null?t.push(s):t=[s])}}else if(d===Kx.current){if(A=d.alternate,A===null)throw Error(Vt(387));A.memoizedState.memoizedState!==d.memoizedState.memoizedState&&(t!==null?t.push(Vy):t=[Vy])}d=d.return}t!==null&&aE(e,t,n,l),e.flags|=262144}function d1(t){for(t=t.firstContext;t!==null;){if(!mo(t.context._currentValue,t.memoizedValue))return!0;t=t.next}return!1}function bf(t){Lf=t,su=null,t=t.dependencies,t!==null&&(t.firstContext=null)}function ua(t){return Gz(Lf,t)}function hx(t,e){return Lf===null&&bf(t),Gz(t,e)}function Gz(t,e){var n=e._currentValue;if(e={context:e,memoizedValue:n,next:null},su===null){if(t===null)throw Error(Vt(308));su=e,t.dependencies={lanes:0,firstContext:e},t.flags|=524288}else su=su.next=e;return n}var ph=!1;function NS(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function oE(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,callbacks:null})}function Ih(t){return{lane:t,tag:0,payload:null,callback:null,next:null}}function Mh(t,e,n){var l=t.updateQueue;if(l===null)return null;if(l=l.shared,Lr&2){var d=l.pending;return d===null?e.next=e:(e.next=d.next,d.next=e),l.pending=e,e=n1(t),ZL(t,null,n),e}return nb(t,l,e,n),n1(t)}function gy(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194176)!==0)){var l=e.lanes;l&=t.pendingLanes,n|=l,e.lanes=n,xL(t,n)}}function t2(t,e){var n=t.updateQueue,l=t.alternate;if(l!==null&&(l=l.updateQueue,n===l)){var d=null,y=null;if(n=n.firstBaseUpdate,n!==null){do{var A={lane:n.lane,tag:n.tag,payload:n.payload,callback:null,next:null};y===null?d=y=A:y=y.next=A,n=n.next}while(n!==null);y===null?d=y=e:y=y.next=e}else d=y=e;n={baseState:l.baseState,firstBaseUpdate:d,lastBaseUpdate:y,shared:l.shared,callbacks:l.callbacks},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}var lE=!1;function _y(){if(lE){var t=hm;if(t!==null)throw t}}function yy(t,e,n,l){lE=!1;var d=t.updateQueue;ph=!1;var y=d.firstBaseUpdate,A=d.lastBaseUpdate,s=d.shared.pending;if(s!==null){d.shared.pending=null;var N=s,j=N.next;N.next=null,A===null?y=j:A.next=j,A=N;var K=t.alternate;K!==null&&(K=K.updateQueue,s=K.lastBaseUpdate,s!==A&&(s===null?K.firstBaseUpdate=j:s.next=j,K.lastBaseUpdate=N))}if(y!==null){var se=d.baseState;A=0,K=j=N=null,s=y;do{var ae=s.lane&-536870913,me=ae!==s.lane;if(me?(Cn&ae)===ae:(l&ae)===ae){ae!==0&&ae===Tm&&(lE=!0),K!==null&&(K=K.next={lane:0,tag:s.tag,payload:s.payload,callback:null,next:null});e:{var Ue=t,Xe=s;ae=e;var it=n;switch(Xe.tag){case 1:if(Ue=Xe.payload,typeof Ue=="function"){se=Ue.call(it,se,ae);break e}se=Ue;break e;case 3:Ue.flags=Ue.flags&-65537|128;case 0:if(Ue=Xe.payload,ae=typeof Ue=="function"?Ue.call(it,se,ae):Ue,ae==null)break e;se=yr({},se,ae);break e;case 2:ph=!0}}ae=s.callback,ae!==null&&(t.flags|=64,me&&(t.flags|=8192),me=d.callbacks,me===null?d.callbacks=[ae]:me.push(ae))}else me={lane:ae,tag:s.tag,payload:s.payload,callback:s.callback,next:null},K===null?(j=K=me,N=se):K=K.next=me,A|=ae;if(s=s.next,s===null){if(s=d.shared.pending,s===null)break;me=s,s=me.next,me.next=null,d.lastBaseUpdate=me,d.shared.pending=null}}while(1);K===null&&(N=se),d.baseState=N,d.firstBaseUpdate=j,d.lastBaseUpdate=K,y===null&&(d.shared.lanes=0),jh|=A,t.lanes=A,t.memoizedState=se}}function Hz(t,e){if(typeof t!="function")throw Error(Vt(191,t));t.call(e)}function $z(t,e){var n=t.callbacks;if(n!==null)for(t.callbacks=null,t=0;t<n.length;t++)Hz(n[t],e)}function c0(t,e){try{var n=e.updateQueue,l=n!==null?n.lastEffect:null;if(l!==null){var d=l.next;n=d;do{if((n.tag&t)===t){l=void 0;var y=n.create,A=n.inst;l=y(),A.destroy=l}n=n.next}while(n!==d)}}catch(s){nr(e,e.return,s)}}function Uh(t,e,n){try{var l=e.updateQueue,d=l!==null?l.lastEffect:null;if(d!==null){var y=d.next;l=y;do{if((l.tag&t)===t){var A=l.inst,s=A.destroy;if(s!==void 0){A.destroy=void 0,d=e;var N=n;try{s()}catch(j){nr(d,N,j)}}}l=l.next}while(l!==y)}}catch(j){nr(e,e.return,j)}}function Zz(t){var e=t.updateQueue;if(e!==null){var n=t.stateNode;try{$z(e,n)}catch(l){nr(t,t.return,l)}}}function Wz(t,e,n){n.props=xf(t.type,t.memoizedProps),n.state=t.memoizedState;try{n.componentWillUnmount()}catch(l){nr(t,e,l)}}function lf(t,e){try{var n=t.ref;if(n!==null){var l=t.stateNode;switch(t.tag){case 26:case 27:case 5:var d=l;break;default:d=l}typeof n=="function"?t.refCleanup=n(d):n.current=d}}catch(y){nr(t,e,y)}}function lo(t,e){var n=t.ref,l=t.refCleanup;if(n!==null)if(typeof l=="function")try{l()}catch(d){nr(t,e,d)}finally{t.refCleanup=null,t=t.alternate,t!=null&&(t.refCleanup=null)}else if(typeof n=="function")try{n(null)}catch(d){nr(t,e,d)}else n.current=null}function Xz(t){var e=t.type,n=t.memoizedProps,l=t.stateNode;try{e:switch(e){case"button":case"input":case"select":case"textarea":n.autoFocus&&l.focus();break e;case"img":n.src?l.src=n.src:n.srcSet&&(l.srcset=n.srcSet)}}catch(d){nr(t,t.return,d)}}function MD(t,e,n){try{var l=t.stateNode;wU(l,t.type,n,e),l[qa]=e}catch(d){nr(t,t.return,d)}}function Yz(t){return t.tag===5||t.tag===3||t.tag===26||t.tag===27||t.tag===4}function i2(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||Yz(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==27&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function cE(t,e,n){var l=t.tag;if(l===5||l===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=ub));else if(l!==4&&l!==27&&(t=t.child,t!==null))for(cE(t,e,n),t=t.sibling;t!==null;)cE(t,e,n),t=t.sibling}function f1(t,e,n){var l=t.tag;if(l===5||l===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(l!==4&&l!==27&&(t=t.child,t!==null))for(f1(t,e,n),t=t.sibling;t!==null;)f1(t,e,n),t=t.sibling}var Kc=!1,Fr=!1,n2=!1,CD=typeof WeakSet=="function"?WeakSet:Set,Ss=null,RD=!1;function Q6(t,e){if(t=t.containerInfo,yE=T1,t=VL(t),gS(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var l=n.getSelection&&n.getSelection();if(l&&l.rangeCount!==0){n=l.anchorNode;var d=l.anchorOffset,y=l.focusNode;l=l.focusOffset;try{n.nodeType,y.nodeType}catch{n=null;break e}var A=0,s=-1,N=-1,j=0,K=0,se=t,ae=null;t:for(;;){for(var me;se!==n||d!==0&&se.nodeType!==3||(s=A+d),se!==y||l!==0&&se.nodeType!==3||(N=A+l),se.nodeType===3&&(A+=se.nodeValue.length),(me=se.firstChild)!==null;)ae=se,se=me;for(;;){if(se===t)break t;if(ae===n&&++j===d&&(s=A),ae===y&&++K===l&&(N=A),(me=se.nextSibling)!==null)break;se=ae,ae=se.parentNode}se=me}n=s===-1||N===-1?null:{start:s,end:N}}else n=null}n=n||{start:0,end:0}}else n=null;for(vE={focusedElem:t,selectionRange:n},T1=!1,Ss=e;Ss!==null;)if(e=Ss,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,Ss=t;else for(;Ss!==null;){switch(e=Ss,y=e.alternate,t=e.flags,e.tag){case 0:break;case 11:case 15:break;case 1:if(t&1024&&y!==null){t=void 0,n=e,d=y.memoizedProps,y=y.memoizedState,l=n.stateNode;try{var Ue=xf(n.type,d,n.elementType===n.type);t=l.getSnapshotBeforeUpdate(Ue,y),l.__reactInternalSnapshotBeforeUpdate=t}catch(Xe){nr(n,n.return,Xe)}}break;case 3:if(t&1024){if(t=e.stateNode.containerInfo,n=t.nodeType,n===9)bE(t);else if(n===1)switch(t.nodeName){case"HEAD":case"HTML":case"BODY":bE(t);break;default:t.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if(t&1024)throw Error(Vt(163))}if(t=e.sibling,t!==null){t.return=e.return,Ss=t;break}Ss=e.return}return Ue=RD,RD=!1,Ue}function Kz(t,e,n){var l=n.flags;switch(n.tag){case 0:case 11:case 15:Wc(t,n),l&4&&c0(5,n);break;case 1:if(Wc(t,n),l&4)if(t=n.stateNode,e===null)try{t.componentDidMount()}catch(s){nr(n,n.return,s)}else{var d=xf(n.type,e.memoizedProps);e=e.memoizedState;try{t.componentDidUpdate(d,e,t.__reactInternalSnapshotBeforeUpdate)}catch(s){nr(n,n.return,s)}}l&64&&Zz(n),l&512&&lf(n,n.return);break;case 3:if(Wc(t,n),l&64&&(l=n.updateQueue,l!==null)){if(t=null,n.child!==null)switch(n.child.tag){case 27:case 5:t=n.child.stateNode;break;case 1:t=n.child.stateNode}try{$z(l,t)}catch(s){nr(n,n.return,s)}}break;case 26:Wc(t,n),l&512&&lf(n,n.return);break;case 27:case 5:Wc(t,n),e===null&&l&4&&Xz(n),l&512&&lf(n,n.return);break;case 12:Wc(t,n);break;case 13:Wc(t,n),l&4&&eO(t,n);break;case 22:if(d=n.memoizedState!==null||Kc,!d){e=e!==null&&e.memoizedState!==null||Fr;var y=Kc,A=Fr;Kc=d,(Fr=e)&&!A?dh(t,n,(n.subtreeFlags&8772)!==0):Wc(t,n),Kc=y,Fr=A}l&512&&(n.memoizedProps.mode==="manual"?lf(n,n.return):lo(n,n.return));break;default:Wc(t,n)}}function Qz(t){var e=t.alternate;e!==null&&(t.alternate=null,Qz(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&uS(e)),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}var Jr=null,ao=!1;function Zc(t,e,n){for(n=n.child;n!==null;)Jz(t,e,n),n=n.sibling}function Jz(t,e,n){if(uo&&typeof uo.onCommitFiberUnmount=="function")try{uo.onCommitFiberUnmount(t0,n)}catch{}switch(n.tag){case 26:Fr||lo(n,e),Zc(t,e,n),n.memoizedState?n.memoizedState.count--:n.stateNode&&(n=n.stateNode,n.parentNode.removeChild(n));break;case 27:Fr||lo(n,e);var l=Jr,d=ao;for(Jr=n.stateNode,Zc(t,e,n),n=n.stateNode,e=n.attributes;e.length;)n.removeAttributeNode(e[0]);uS(n),Jr=l,ao=d;break;case 5:Fr||lo(n,e);case 6:d=Jr;var y=ao;if(Jr=null,Zc(t,e,n),Jr=d,ao=y,Jr!==null)if(ao)try{t=Jr,l=n.stateNode,t.nodeType===8?t.parentNode.removeChild(l):t.removeChild(l)}catch(A){nr(n,e,A)}else try{Jr.removeChild(n.stateNode)}catch(A){nr(n,e,A)}break;case 18:Jr!==null&&(ao?(e=Jr,n=n.stateNode,e.nodeType===8?m2(e.parentNode,n):e.nodeType===1&&m2(e,n),qy(e)):m2(Jr,n.stateNode));break;case 4:l=Jr,d=ao,Jr=n.stateNode.containerInfo,ao=!0,Zc(t,e,n),Jr=l,ao=d;break;case 0:case 11:case 14:case 15:Fr||Uh(2,n,e),Fr||Uh(4,n,e),Zc(t,e,n);break;case 1:Fr||(lo(n,e),l=n.stateNode,typeof l.componentWillUnmount=="function"&&Wz(n,e,l)),Zc(t,e,n);break;case 21:Zc(t,e,n);break;case 22:Fr||lo(n,e),Fr=(l=Fr)||n.memoizedState!==null,Zc(t,e,n),Fr=l;break;default:Zc(t,e,n)}}function eO(t,e){if(e.memoizedState===null&&(t=e.alternate,t!==null&&(t=t.memoizedState,t!==null&&(t=t.dehydrated,t!==null))))try{qy(t)}catch(n){nr(e,e.return,n)}}function J6(t){switch(t.tag){case 13:case 19:var e=t.stateNode;return e===null&&(e=t.stateNode=new CD),e;case 22:return t=t.stateNode,e=t._retryCache,e===null&&(e=t._retryCache=new CD),e;default:throw Error(Vt(435,t.tag))}}function r2(t,e){var n=J6(t);e.forEach(function(l){var d=dU.bind(null,t,l);n.has(l)||(n.add(l),l.then(d,d))})}function zo(t,e){var n=e.deletions;if(n!==null)for(var l=0;l<n.length;l++){var d=n[l],y=t,A=e,s=A;e:for(;s!==null;){switch(s.tag){case 27:case 5:Jr=s.stateNode,ao=!1;break e;case 3:Jr=s.stateNode.containerInfo,ao=!0;break e;case 4:Jr=s.stateNode.containerInfo,ao=!0;break e}s=s.return}if(Jr===null)throw Error(Vt(160));Jz(y,A,d),Jr=null,ao=!1,y=d.alternate,y!==null&&(y.return=null),d.return=null}if(e.subtreeFlags&13878)for(e=e.child;e!==null;)tO(e,t),e=e.sibling}var yl=null;function tO(t,e){var n=t.alternate,l=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:zo(e,t),Oo(t),l&4&&(Uh(3,t,t.return),c0(3,t),Uh(5,t,t.return));break;case 1:zo(e,t),Oo(t),l&512&&(Fr||n===null||lo(n,n.return)),l&64&&Kc&&(t=t.updateQueue,t!==null&&(l=t.callbacks,l!==null&&(n=t.shared.hiddenCallbacks,t.shared.hiddenCallbacks=n===null?l:n.concat(l))));break;case 26:var d=yl;if(zo(e,t),Oo(t),l&512&&(Fr||n===null||lo(n,n.return)),l&4){var y=n!==null?n.memoizedState:null;if(l=t.memoizedState,n===null)if(l===null)if(t.stateNode===null){e:{l=t.type,n=t.memoizedProps,d=d.ownerDocument||d;t:switch(l){case"title":y=d.getElementsByTagName("title")[0],(!y||y[Ry]||y[ca]||y.namespaceURI==="http://www.w3.org/2000/svg"||y.hasAttribute("itemprop"))&&(y=d.createElement(l),d.head.insertBefore(y,d.querySelector("head > title"))),qs(y,l,n),y[ca]=t,As(y),l=y;break e;case"link":var A=ZD("link","href",d).get(l+(n.href||""));if(A){for(var s=0;s<A.length;s++)if(y=A[s],y.getAttribute("href")===(n.href==null?null:n.href)&&y.getAttribute("rel")===(n.rel==null?null:n.rel)&&y.getAttribute("title")===(n.title==null?null:n.title)&&y.getAttribute("crossorigin")===(n.crossOrigin==null?null:n.crossOrigin)){A.splice(s,1);break t}}y=d.createElement(l),qs(y,l,n),d.head.appendChild(y);break;case"meta":if(A=ZD("meta","content",d).get(l+(n.content||""))){for(s=0;s<A.length;s++)if(y=A[s],y.getAttribute("content")===(n.content==null?null:""+n.content)&&y.getAttribute("name")===(n.name==null?null:n.name)&&y.getAttribute("property")===(n.property==null?null:n.property)&&y.getAttribute("http-equiv")===(n.httpEquiv==null?null:n.httpEquiv)&&y.getAttribute("charset")===(n.charSet==null?null:n.charSet)){A.splice(s,1);break t}}y=d.createElement(l),qs(y,l,n),d.head.appendChild(y);break;default:throw Error(Vt(468,l))}y[ca]=t,As(y),l=y}t.stateNode=l}else WD(d,t.type,t.stateNode);else t.stateNode=$D(d,l,t.memoizedProps);else y!==l?(y===null?n.stateNode!==null&&(n=n.stateNode,n.parentNode.removeChild(n)):y.count--,l===null?WD(d,t.type,t.stateNode):$D(d,l,t.memoizedProps)):l===null&&t.stateNode!==null&&MD(t,t.memoizedProps,n.memoizedProps)}break;case 27:if(l&4&&t.alternate===null){d=t.stateNode,y=t.memoizedProps;try{for(var N=d.firstChild;N;){var j=N.nextSibling,K=N.nodeName;N[Ry]||K==="HEAD"||K==="BODY"||K==="SCRIPT"||K==="STYLE"||K==="LINK"&&N.rel.toLowerCase()==="stylesheet"||d.removeChild(N),N=j}for(var se=t.type,ae=d.attributes;ae.length;)d.removeAttributeNode(ae[0]);qs(d,se,y),d[ca]=t,d[qa]=y}catch(Ue){nr(t,t.return,Ue)}}case 5:if(zo(e,t),Oo(t),l&512&&(Fr||n===null||lo(n,n.return)),t.flags&32){d=t.stateNode;try{bm(d,"")}catch(Ue){nr(t,t.return,Ue)}}l&4&&t.stateNode!=null&&(d=t.memoizedProps,MD(t,d,n!==null?n.memoizedProps:d)),l&1024&&(n2=!0);break;case 6:if(zo(e,t),Oo(t),l&4){if(t.stateNode===null)throw Error(Vt(162));l=t.memoizedProps,n=t.stateNode;try{n.nodeValue=l}catch(Ue){nr(t,t.return,Ue)}}break;case 3:if(kx=null,d=yl,yl=x1(e.containerInfo),zo(e,t),yl=d,Oo(t),l&4&&n!==null&&n.memoizedState.isDehydrated)try{qy(e.containerInfo)}catch(Ue){nr(t,t.return,Ue)}n2&&(n2=!1,iO(t));break;case 4:l=yl,yl=x1(t.stateNode.containerInfo),zo(e,t),Oo(t),yl=l;break;case 12:zo(e,t),Oo(t);break;case 13:zo(e,t),Oo(t),t.child.flags&8192&&t.memoizedState!==null!=(n!==null&&n.memoizedState!==null)&&(qS=rc()),l&4&&(l=t.updateQueue,l!==null&&(t.updateQueue=null,r2(t,l)));break;case 22:if(l&512&&(Fr||n===null||lo(n,n.return)),N=t.memoizedState!==null,j=n!==null&&n.memoizedState!==null,K=Kc,se=Fr,Kc=K||N,Fr=se||j,zo(e,t),Fr=se,Kc=K,Oo(t),e=t.stateNode,e._current=t,e._visibility&=-3,e._visibility|=e._pendingVisibility&2,l&8192&&(e._visibility=N?e._visibility&-2:e._visibility|1,N&&(e=Kc||Fr,n===null||j||e||jp(t)),t.memoizedProps===null||t.memoizedProps.mode!=="manual"))e:for(n=null,e=t;;){if(e.tag===5||e.tag===26||e.tag===27){if(n===null){j=n=e;try{if(d=j.stateNode,N)y=d.style,typeof y.setProperty=="function"?y.setProperty("display","none","important"):y.display="none";else{A=j.stateNode,s=j.memoizedProps.style;var me=s!=null&&s.hasOwnProperty("display")?s.display:null;A.style.display=me==null||typeof me=="boolean"?"":(""+me).trim()}}catch(Ue){nr(j,j.return,Ue)}}}else if(e.tag===6){if(n===null){j=e;try{j.stateNode.nodeValue=N?"":j.memoizedProps}catch(Ue){nr(j,j.return,Ue)}}}else if((e.tag!==22&&e.tag!==23||e.memoizedState===null||e===t)&&e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;n===e&&(n=null),e=e.return}n===e&&(n=null),e.sibling.return=e.return,e=e.sibling}l&4&&(l=t.updateQueue,l!==null&&(n=l.retryQueue,n!==null&&(l.retryQueue=null,r2(t,n))));break;case 19:zo(e,t),Oo(t),l&4&&(l=t.updateQueue,l!==null&&(t.updateQueue=null,r2(t,l)));break;case 21:break;default:zo(e,t),Oo(t)}}function Oo(t){var e=t.flags;if(e&2){try{if(t.tag!==27){e:{for(var n=t.return;n!==null;){if(Yz(n)){var l=n;break e}n=n.return}throw Error(Vt(160))}switch(l.tag){case 27:var d=l.stateNode,y=i2(t);f1(t,y,d);break;case 5:var A=l.stateNode;l.flags&32&&(bm(A,""),l.flags&=-33);var s=i2(t);f1(t,s,A);break;case 3:case 4:var N=l.stateNode.containerInfo,j=i2(t);cE(t,j,N);break;default:throw Error(Vt(161))}}}catch(K){nr(t,t.return,K)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function iO(t){if(t.subtreeFlags&1024)for(t=t.child;t!==null;){var e=t;iO(e),e.tag===5&&e.flags&1024&&e.stateNode.reset(),t=t.sibling}}function Wc(t,e){if(e.subtreeFlags&8772)for(e=e.child;e!==null;)Kz(t,e.alternate,e),e=e.sibling}function jp(t){for(t=t.child;t!==null;){var e=t;switch(e.tag){case 0:case 11:case 14:case 15:Uh(4,e,e.return),jp(e);break;case 1:lo(e,e.return);var n=e.stateNode;typeof n.componentWillUnmount=="function"&&Wz(e,e.return,n),jp(e);break;case 26:case 27:case 5:lo(e,e.return),jp(e);break;case 22:lo(e,e.return),e.memoizedState===null&&jp(e);break;default:jp(e)}t=t.sibling}}function dh(t,e,n){for(n=n&&(e.subtreeFlags&8772)!==0,e=e.child;e!==null;){var l=e.alternate,d=t,y=e,A=y.flags;switch(y.tag){case 0:case 11:case 15:dh(d,y,n),c0(4,y);break;case 1:if(dh(d,y,n),l=y,d=l.stateNode,typeof d.componentDidMount=="function")try{d.componentDidMount()}catch(j){nr(l,l.return,j)}if(l=y,d=l.updateQueue,d!==null){var s=l.stateNode;try{var N=d.shared.hiddenCallbacks;if(N!==null)for(d.shared.hiddenCallbacks=null,d=0;d<N.length;d++)Hz(N[d],s)}catch(j){nr(l,l.return,j)}}n&&A&64&&Zz(y),lf(y,y.return);break;case 26:case 27:case 5:dh(d,y,n),n&&l===null&&A&4&&Xz(y),lf(y,y.return);break;case 12:dh(d,y,n);break;case 13:dh(d,y,n),n&&A&4&&eO(d,y);break;case 22:y.memoizedState===null&&dh(d,y,n),lf(y,y.return);break;default:dh(d,y,n)}e=e.sibling}}function FS(t,e){var n=null;t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(n=t.memoizedState.cachePool.pool),t=null,e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(t=e.memoizedState.cachePool.pool),t!==n&&(t!=null&&t.refCount++,n!=null&&a0(n))}function BS(t,e){t=null,e.alternate!==null&&(t=e.alternate.memoizedState.cache),e=e.memoizedState.cache,e!==t&&(e.refCount++,t!=null&&a0(t))}function uh(t,e,n,l){if(e.subtreeFlags&10256)for(e=e.child;e!==null;)nO(t,e,n,l),e=e.sibling}function nO(t,e,n,l){var d=e.flags;switch(e.tag){case 0:case 11:case 15:uh(t,e,n,l),d&2048&&c0(9,e);break;case 3:uh(t,e,n,l),d&2048&&(t=null,e.alternate!==null&&(t=e.alternate.memoizedState.cache),e=e.memoizedState.cache,e!==t&&(e.refCount++,t!=null&&a0(t)));break;case 12:if(d&2048){uh(t,e,n,l),t=e.stateNode;try{var y=e.memoizedProps,A=y.id,s=y.onPostCommit;typeof s=="function"&&s(A,e.alternate===null?"mount":"update",t.passiveEffectDuration,-0)}catch(N){nr(e,e.return,N)}}else uh(t,e,n,l);break;case 23:break;case 22:y=e.stateNode,e.memoizedState!==null?y._visibility&4?uh(t,e,n,l):vy(t,e):y._visibility&4?uh(t,e,n,l):(y._visibility|=4,qp(t,e,n,l,(e.subtreeFlags&10256)!==0)),d&2048&&FS(e.alternate,e);break;case 24:uh(t,e,n,l),d&2048&&BS(e.alternate,e);break;default:uh(t,e,n,l)}}function qp(t,e,n,l,d){for(d=d&&(e.subtreeFlags&10256)!==0,e=e.child;e!==null;){var y=t,A=e,s=n,N=l,j=A.flags;switch(A.tag){case 0:case 11:case 15:qp(y,A,s,N,d),c0(8,A);break;case 23:break;case 22:var K=A.stateNode;A.memoizedState!==null?K._visibility&4?qp(y,A,s,N,d):vy(y,A):(K._visibility|=4,qp(y,A,s,N,d)),d&&j&2048&&FS(A.alternate,A);break;case 24:qp(y,A,s,N,d),d&&j&2048&&BS(A.alternate,A);break;default:qp(y,A,s,N,d)}e=e.sibling}}function vy(t,e){if(e.subtreeFlags&10256)for(e=e.child;e!==null;){var n=t,l=e,d=l.flags;switch(l.tag){case 22:vy(n,l),d&2048&&FS(l.alternate,l);break;case 24:vy(n,l),d&2048&&BS(l.alternate,l);break;default:vy(n,l)}e=e.sibling}}var ey=8192;function Bp(t){if(t.subtreeFlags&ey)for(t=t.child;t!==null;)rO(t),t=t.sibling}function rO(t){switch(t.tag){case 26:Bp(t),t.flags&ey&&t.memoizedState!==null&&UU(yl,t.memoizedState,t.memoizedProps);break;case 5:Bp(t);break;case 3:case 4:var e=yl;yl=x1(t.stateNode.containerInfo),Bp(t),yl=e;break;case 22:t.memoizedState===null&&(e=t.alternate,e!==null&&e.memoizedState!==null?(e=ey,ey=16777216,Bp(t),ey=e):Bp(t));break;default:Bp(t)}}function sO(t){var e=t.alternate;if(e!==null&&(t=e.child,t!==null)){e.child=null;do e=t.sibling,t.sibling=null,t=e;while(t!==null)}}function H_(t){var e=t.deletions;if(t.flags&16){if(e!==null)for(var n=0;n<e.length;n++){var l=e[n];Ss=l,oO(l,t)}sO(t)}if(t.subtreeFlags&10256)for(t=t.child;t!==null;)aO(t),t=t.sibling}function aO(t){switch(t.tag){case 0:case 11:case 15:H_(t),t.flags&2048&&Uh(9,t,t.return);break;case 3:H_(t);break;case 12:H_(t);break;case 22:var e=t.stateNode;t.memoizedState!==null&&e._visibility&4&&(t.return===null||t.return.tag!==13)?(e._visibility&=-5,Lx(t)):H_(t);break;default:H_(t)}}function Lx(t){var e=t.deletions;if(t.flags&16){if(e!==null)for(var n=0;n<e.length;n++){var l=e[n];Ss=l,oO(l,t)}sO(t)}for(t=t.child;t!==null;){switch(e=t,e.tag){case 0:case 11:case 15:Uh(8,e,e.return),Lx(e);break;case 22:n=e.stateNode,n._visibility&4&&(n._visibility&=-5,Lx(e));break;default:Lx(e)}t=t.sibling}}function oO(t,e){for(;Ss!==null;){var n=Ss;switch(n.tag){case 0:case 11:case 15:Uh(8,n,e);break;case 23:case 22:if(n.memoizedState!==null&&n.memoizedState.cachePool!==null){var l=n.memoizedState.cachePool.pool;l!=null&&l.refCount++}break;case 24:a0(n.memoizedState.cache)}if(l=n.child,l!==null)l.return=n,Ss=l;else e:for(n=t;Ss!==null;){l=Ss;var d=l.sibling,y=l.return;if(Qz(l),l===n){Ss=null;break e}if(d!==null){d.return=y,Ss=d;break e}Ss=y}}}function eU(t,e,n,l){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=l,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function qo(t,e,n,l){return new eU(t,e,n,l)}function VS(t){return t=t.prototype,!(!t||!t.isReactComponent)}function Ch(t,e){var n=t.alternate;return n===null?(n=qo(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&31457280,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n.refCleanup=t.refCleanup,n}function lO(t,e){t.flags&=31457282;var n=t.alternate;return n===null?(t.childLanes=0,t.lanes=e,t.child=null,t.subtreeFlags=0,t.memoizedProps=null,t.memoizedState=null,t.updateQueue=null,t.dependencies=null,t.stateNode=null):(t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.subtreeFlags=0,t.deletions=null,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,t.type=n.type,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),t}function zx(t,e,n,l,d,y){var A=0;if(l=t,typeof t=="function")VS(t)&&(A=1);else if(typeof t=="string")A=BU(t,n,nc.current)?26:t==="html"||t==="head"||t==="body"?27:5;else e:switch(t){case Xp:return pf(n.children,d,y,e);case cL:A=8,d|=24;break;case P2:return t=qo(12,n,e,d|2),t.elementType=P2,t.lanes=y,t;case L2:return t=qo(13,n,e,d),t.elementType=L2,t.lanes=y,t;case z2:return t=qo(19,n,e,d),t.elementType=z2,t.lanes=y,t;case hL:return cO(n,d,y,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case SV:case tu:A=10;break e;case uL:A=9;break e;case oS:A=11;break e;case lS:A=14;break e;case fh:A=16,l=null;break e}A=29,n=Error(Vt(130,t===null?"null":typeof t,"")),l=null}return e=qo(A,n,e,d),e.elementType=t,e.type=l,e.lanes=y,e}function pf(t,e,n,l){return t=qo(7,t,l,e),t.lanes=n,t}function cO(t,e,n,l){t=qo(22,t,l,e),t.elementType=hL,t.lanes=n;var d={_visibility:1,_pendingVisibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null,_current:null,detach:function(){var y=d._current;if(y===null)throw Error(Vt(456));if(!(d._pendingVisibility&2)){var A=Bh(y,2);A!==null&&(d._pendingVisibility|=2,Ca(A,y,2))}},attach:function(){var y=d._current;if(y===null)throw Error(Vt(456));if(d._pendingVisibility&2){var A=Bh(y,2);A!==null&&(d._pendingVisibility&=-3,Ca(A,y,2))}}};return t.stateNode=d,t}function s2(t,e,n){return t=qo(6,t,null,e),t.lanes=n,t}function a2(t,e,n){return e=qo(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function Xc(t){t.flags|=4}function DD(t,e){if(e.type!=="stylesheet"||e.state.loading&4)t.flags&=-16777217;else if(t.flags|=16777216,!RO(e)){if(e=Xo.current,e!==null&&((Cn&4194176)===Cn?sc!==null:(Cn&62914560)!==Cn&&!(Cn&536870912)||e!==sc))throw dy=Z2,XL;t.flags|=8192}}function dx(t,e){e!==null&&(t.flags|=4),t.flags&16384&&(e=t.tag!==22?yL():536870912,t.lanes|=e,Sm|=e)}function $_(t,e){if(!Dn)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var l=null;n!==null;)n.alternate!==null&&(l=n),n=n.sibling;l===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:l.sibling=null}}function Dr(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,l=0;if(e)for(var d=t.child;d!==null;)n|=d.lanes|d.childLanes,l|=d.subtreeFlags&31457280,l|=d.flags&31457280,d.return=t,d=d.sibling;else for(d=t.child;d!==null;)n|=d.lanes|d.childLanes,l|=d.subtreeFlags,l|=d.flags,d.return=t,d=d.sibling;return t.subtreeFlags|=l,t.childLanes=n,e}function tU(t,e,n){var l=e.pendingProps;switch(xS(e),e.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Dr(e),null;case 1:return Dr(e),null;case 3:return n=e.stateNode,l=null,t!==null&&(l=t.memoizedState.cache),e.memoizedState.cache!==l&&(e.flags|=2048),cu(ms),vm(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(t===null||t.child===null)&&(q_(e)?Xc(e):t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,vl!==null&&(pE(vl),vl=null))),Dr(e),null;case 26:return n=e.memoizedState,t===null?(Xc(e),n!==null?(Dr(e),DD(e,n)):(Dr(e),e.flags&=-16777217)):n?n!==t.memoizedState?(Xc(e),Dr(e),DD(e,n)):(Dr(e),e.flags&=-16777217):(t.memoizedProps!==l&&Xc(e),Dr(e),e.flags&=-16777217),null;case 27:Jx(e),n=Ah.current;var d=e.type;if(t!==null&&e.stateNode!=null)t.memoizedProps!==l&&Xc(e);else{if(!l){if(e.stateNode===null)throw Error(Vt(166));return Dr(e),null}t=nc.current,q_(e)?oD(e):(t=IO(d,l,n),e.stateNode=t,Xc(e))}return Dr(e),null;case 5:if(Jx(e),n=e.type,t!==null&&e.stateNode!=null)t.memoizedProps!==l&&Xc(e);else{if(!l){if(e.stateNode===null)throw Error(Vt(166));return Dr(e),null}if(t=nc.current,q_(e))oD(e);else{switch(d=v1(Ah.current),t){case 1:t=d.createElementNS("http://www.w3.org/2000/svg",n);break;case 2:t=d.createElementNS("http://www.w3.org/1998/Math/MathML",n);break;default:switch(n){case"svg":t=d.createElementNS("http://www.w3.org/2000/svg",n);break;case"math":t=d.createElementNS("http://www.w3.org/1998/Math/MathML",n);break;case"script":t=d.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild);break;case"select":t=typeof l.is=="string"?d.createElement("select",{is:l.is}):d.createElement("select"),l.multiple?t.multiple=!0:l.size&&(t.size=l.size);break;default:t=typeof l.is=="string"?d.createElement(n,{is:l.is}):d.createElement(n)}}t[ca]=e,t[qa]=l;e:for(d=e.child;d!==null;){if(d.tag===5||d.tag===6)t.appendChild(d.stateNode);else if(d.tag!==4&&d.tag!==27&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===e)break e;for(;d.sibling===null;){if(d.return===null||d.return===e)break e;d=d.return}d.sibling.return=d.return,d=d.sibling}e.stateNode=t;e:switch(qs(t,n,l),n){case"button":case"input":case"select":case"textarea":t=!!l.autoFocus;break e;case"img":t=!0;break e;default:t=!1}t&&Xc(e)}}return Dr(e),e.flags&=-16777217,null;case 6:if(t&&e.stateNode!=null)t.memoizedProps!==l&&Xc(e);else{if(typeof l!="string"&&e.stateNode===null)throw Error(Vt(166));if(t=Ah.current,q_(e)){if(t=e.stateNode,n=e.memoizedProps,l=null,d=Ia,d!==null)switch(d.tag){case 27:case 5:l=d.memoizedProps}t[ca]=e,t=!!(t.nodeValue===n||l!==null&&l.suppressHydrationWarning===!0||EO(t.nodeValue,n)),t||_f(e)}else t=v1(t).createTextNode(l),t[ca]=e,e.stateNode=t}return Dr(e),null;case 13:if(l=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(d=q_(e),l!==null&&l.dehydrated!==null){if(t===null){if(!d)throw Error(Vt(318));if(d=e.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(Vt(317));d[ca]=e}else s0(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Dr(e),d=!1}else vl!==null&&(pE(vl),vl=null),d=!0;if(!d)return e.flags&256?(ru(e),e):(ru(e),null)}if(ru(e),e.flags&128)return e.lanes=n,e;if(n=l!==null,t=t!==null&&t.memoizedState!==null,n){l=e.child,d=null,l.alternate!==null&&l.alternate.memoizedState!==null&&l.alternate.memoizedState.cachePool!==null&&(d=l.alternate.memoizedState.cachePool.pool);var y=null;l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(y=l.memoizedState.cachePool.pool),y!==d&&(l.flags|=2048)}return n!==t&&n&&(e.child.flags|=8192),dx(e,e.updateQueue),Dr(e),null;case 4:return vm(),t===null&&$S(e.stateNode.containerInfo),Dr(e),null;case 10:return cu(e.type),Dr(e),null;case 19:if(Ms(gs),d=e.memoizedState,d===null)return Dr(e),null;if(l=(e.flags&128)!==0,y=d.rendering,y===null)if(l)$_(d,!1);else{if(Br!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(y=o1(t),y!==null){for(e.flags|=128,$_(d,!1),t=y.updateQueue,e.updateQueue=t,dx(e,t),e.subtreeFlags=0,t=n,n=e.child;n!==null;)lO(n,t),n=n.sibling;return Tr(gs,gs.current&1|2),e.child}t=t.sibling}d.tail!==null&&rc()>p1&&(e.flags|=128,l=!0,$_(d,!1),e.lanes=4194304)}else{if(!l)if(t=o1(y),t!==null){if(e.flags|=128,l=!0,t=t.updateQueue,e.updateQueue=t,dx(e,t),$_(d,!0),d.tail===null&&d.tailMode==="hidden"&&!y.alternate&&!Dn)return Dr(e),null}else 2*rc()-d.renderingStartTime>p1&&n!==536870912&&(e.flags|=128,l=!0,$_(d,!1),e.lanes=4194304);d.isBackwards?(y.sibling=e.child,e.child=y):(t=d.last,t!==null?t.sibling=y:e.child=y,d.last=y)}return d.tail!==null?(e=d.tail,d.rendering=e,d.tail=e.sibling,d.renderingStartTime=rc(),e.sibling=null,t=gs.current,Tr(gs,l?t&1|2:t&1),e):(Dr(e),null);case 22:case 23:return ru(e),bS(),l=e.memoizedState!==null,t!==null?t.memoizedState!==null!==l&&(e.flags|=8192):l&&(e.flags|=8192),l?n&536870912&&!(e.flags&128)&&(Dr(e),e.subtreeFlags&6&&(e.flags|=8192)):Dr(e),n=e.updateQueue,n!==null&&dx(e,n.retryQueue),n=null,t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(n=t.memoizedState.cachePool.pool),l=null,e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(l=e.memoizedState.cachePool.pool),l!==n&&(e.flags|=2048),t!==null&&Ms(ff),null;case 24:return n=null,t!==null&&(n=t.memoizedState.cache),e.memoizedState.cache!==n&&(e.flags|=2048),cu(ms),Dr(e),null;case 25:return null}throw Error(Vt(156,e.tag))}function iU(t,e){switch(xS(e),e.tag){case 1:return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return cu(ms),vm(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 26:case 27:case 5:return Jx(e),null;case 13:if(ru(e),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(Vt(340));s0()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Ms(gs),null;case 4:return vm(),null;case 10:return cu(e.type),null;case 22:case 23:return ru(e),bS(),t!==null&&Ms(ff),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 24:return cu(ms),null;case 25:return null;default:return null}}function uO(t,e){switch(xS(e),e.tag){case 3:cu(ms),vm();break;case 26:case 27:case 5:Jx(e);break;case 4:vm();break;case 13:ru(e);break;case 19:Ms(gs);break;case 10:cu(e.type);break;case 22:case 23:ru(e),bS(),t!==null&&Ms(ff);break;case 24:cu(ms)}}var nU={getCacheForType:function(t){var e=ua(ms),n=e.data.get(t);return n===void 0&&(n=t(),e.data.set(t,n)),n}},rU=typeof WeakMap=="function"?WeakMap:Map,Lr=0,lr=null,fn=null,Cn=0,or=0,oo=null,Qc=!1,Vm=!1,US=!1,_u=0,Br=0,jh=0,mf=0,jS=0,Go=0,Sm=0,xy=null,ic=null,uE=!1,qS=0,p1=1/0,m1=null,Rh=null,fx=!1,sf=null,by=0,hE=0,dE=null,wy=0,fE=null;function fo(){if(Lr&2&&Cn!==0)return Cn&-Cn;if(nn.T!==null){var t=Tm;return t!==0?t:HS()}return wL()}function hO(){Go===0&&(Go=!(Cn&536870912)||Dn?_L():536870912);var t=Xo.current;return t!==null&&(t.flags|=32),Go}function Ca(t,e,n){(t===lr&&or===2||t.cancelPendingCommit!==null)&&(Am(t,0),Jc(t,Cn,Go,!1)),n0(t,n),(!(Lr&2)||t!==lr)&&(t===lr&&(!(Lr&2)&&(mf|=n),Br===4&&Jc(t,Cn,Go,!1)),pc(t))}function dO(t,e,n){if(Lr&6)throw Error(Vt(327));var l=!n&&(e&60)===0&&(e&t.expiredLanes)===0||i0(t,e),d=l?oU(t,e):o2(t,e,!0),y=l;do{if(d===0){Vm&&!l&&Jc(t,e,0,!1);break}else if(d===6)Jc(t,e,0,!Qc);else{if(n=t.current.alternate,y&&!sU(n)){d=o2(t,e,!1),y=!1;continue}if(d===2){if(y=e,t.errorRecoveryDisabledLanes&y)var A=0;else A=t.pendingLanes&-536870913,A=A!==0?A:A&536870912?536870912:0;if(A!==0){e=A;e:{var s=t;d=xy;var N=s.current.memoizedState.isDehydrated;if(N&&(Am(s,A).flags|=256),A=o2(s,A,!1),A!==2){if(US&&!N){s.errorRecoveryDisabledLanes|=y,mf|=y,d=4;break e}y=ic,ic=d,y!==null&&pE(y)}d=A}if(y=!1,d!==2)continue}}if(d===1){Am(t,0),Jc(t,e,0,!0);break}e:{switch(l=t,d){case 0:case 1:throw Error(Vt(345));case 4:if((e&4194176)===e){Jc(l,e,Go,!Qc);break e}break;case 2:ic=null;break;case 3:case 5:break;default:throw Error(Vt(329))}if(l.finishedWork=n,l.finishedLanes=e,(e&62914560)===e&&(y=qS+300-rc(),10<y)){if(Jc(l,e,Go,!Qc),Q1(l,0)!==0)break e;l.timeoutHandle=AO(PD.bind(null,l,n,ic,m1,uE,e,Go,mf,Sm,Qc,2,-0,0),y);break e}PD(l,n,ic,m1,uE,e,Go,mf,Sm,Qc,0,-0,0)}}break}while(1);pc(t)}function pE(t){ic===null?ic=t:ic.push.apply(ic,t)}function PD(t,e,n,l,d,y,A,s,N,j,K,se,ae){var me=e.subtreeFlags;if((me&8192||(me&16785408)===16785408)&&(By={stylesheets:null,count:0,unsuspend:VU},rO(e),e=jU(),e!==null)){t.cancelPendingCommit=e(zD.bind(null,t,n,l,d,A,s,N,1,se,ae)),Jc(t,y,A,!j);return}zD(t,n,l,d,A,s,N,K,se,ae)}function sU(t){for(var e=t;;){var n=e.tag;if((n===0||n===11||n===15)&&e.flags&16384&&(n=e.updateQueue,n!==null&&(n=n.stores,n!==null)))for(var l=0;l<n.length;l++){var d=n[l],y=d.getSnapshot;d=d.value;try{if(!mo(y(),d))return!1}catch{return!1}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Jc(t,e,n,l){e&=~jS,e&=~mf,t.suspendedLanes|=e,t.pingedLanes&=~e,l&&(t.warmLanes|=e),l=t.expirationTimes;for(var d=e;0<d;){var y=31-ho(d),A=1<<y;l[y]=-1,d&=~A}n!==0&&vL(t,n,e)}function lb(){return Lr&6?!0:(u0(0,!1),!1)}function GS(){if(fn!==null){if(or===0)var t=fn.return;else t=fn,su=Lf=null,MS(t),um=null,Oy=0,t=fn;for(;t!==null;)uO(t.alternate,t),t=t.return;fn=null}}function Am(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;n!==-1&&(t.timeoutHandle=-1,EU(n)),n=t.cancelPendingCommit,n!==null&&(t.cancelPendingCommit=null,n()),GS(),lr=t,fn=n=Ch(t.current,null),Cn=e,or=0,oo=null,Qc=!1,Vm=i0(t,e),US=!1,Sm=Go=jS=mf=jh=Br=0,ic=xy=null,uE=!1,e&8&&(e|=e&32);var l=t.entangledLanes;if(l!==0)for(t=t.entanglements,l&=e;0<l;){var d=31-ho(l),y=1<<d;e|=t[d],l&=~y}return _u=e,ib(),n}function fO(t,e){cn=null,nn.H=uc,e===hy?(e=uD(),or=3):e===XL?(e=uD(),or=4):or=e===Fz?8:e!==null&&typeof e=="object"&&typeof e.then=="function"?6:1,oo=e,fn===null&&(Br=1,h1(t,Uo(e,t.current)))}function pO(){var t=nn.H;return nn.H=uc,t===null?uc:t}function mO(){var t=nn.A;return nn.A=nU,t}function mE(){Br=4,Qc||(Cn&4194176)!==Cn&&Xo.current!==null||(Vm=!0),!(jh&134217727)&&!(mf&134217727)||lr===null||Jc(lr,Cn,Go,!1)}function o2(t,e,n){var l=Lr;Lr|=2;var d=pO(),y=mO();(lr!==t||Cn!==e)&&(m1=null,Am(t,e)),e=!1;var A=Br;e:do try{if(or!==0&&fn!==null){var s=fn,N=oo;switch(or){case 8:GS(),A=6;break e;case 3:case 2:case 6:Xo.current===null&&(e=!0);var j=or;if(or=0,oo=null,sm(t,s,N,j),n&&Vm){A=0;break e}break;default:j=or,or=0,oo=null,sm(t,s,N,j)}}aU(),A=Br;break}catch(K){fO(t,K)}while(1);return e&&t.shellSuspendCounter++,su=Lf=null,Lr=l,nn.H=d,nn.A=y,fn===null&&(lr=null,Cn=0,ib()),A}function aU(){for(;fn!==null;)gO(fn)}function oU(t,e){var n=Lr;Lr|=2;var l=pO(),d=mO();lr!==t||Cn!==e?(m1=null,p1=rc()+500,Am(t,e)):Vm=i0(t,e);e:do try{if(or!==0&&fn!==null){e=fn;var y=oo;t:switch(or){case 1:or=0,oo=null,sm(t,e,y,1);break;case 2:if(cD(y)){or=0,oo=null,LD(e);break}e=function(){or===2&&lr===t&&(or=7),pc(t)},y.then(e,e);break e;case 3:or=7;break e;case 4:or=5;break e;case 7:cD(y)?(or=0,oo=null,LD(e)):(or=0,oo=null,sm(t,e,y,7));break;case 5:var A=null;switch(fn.tag){case 26:A=fn.memoizedState;case 5:case 27:var s=fn;if(!A||RO(A)){or=0,oo=null;var N=s.sibling;if(N!==null)fn=N;else{var j=s.return;j!==null?(fn=j,cb(j)):fn=null}break t}}or=0,oo=null,sm(t,e,y,5);break;case 6:or=0,oo=null,sm(t,e,y,6);break;case 8:GS(),Br=6;break e;default:throw Error(Vt(462))}}lU();break}catch(K){fO(t,K)}while(1);return su=Lf=null,nn.H=l,nn.A=d,Lr=n,fn!==null?0:(lr=null,Cn=0,ib(),Br)}function lU(){for(;fn!==null&&!RV();)gO(fn)}function gO(t){var e=qz(t.alternate,t,_u);t.memoizedProps=t.pendingProps,e===null?cb(t):fn=e}function LD(t){var e=t,n=e.alternate;switch(e.tag){case 15:case 0:e=ED(n,e,e.pendingProps,e.type,void 0,Cn);break;case 11:e=ED(n,e,e.pendingProps,e.type.render,e.ref,Cn);break;case 5:MS(e);default:uO(n,e),e=fn=lO(e,_u),e=qz(n,e,_u)}t.memoizedProps=t.pendingProps,e===null?cb(t):fn=e}function sm(t,e,n,l){su=Lf=null,MS(e),um=null,Oy=0;var d=e.return;try{if(Y6(t,d,e,n,Cn)){Br=1,h1(t,Uo(n,t.current)),fn=null;return}}catch(y){if(d!==null)throw fn=d,y;Br=1,h1(t,Uo(n,t.current)),fn=null;return}e.flags&32768?(Dn||l===1?t=!0:Vm||Cn&536870912?t=!1:(Qc=t=!0,(l===2||l===3||l===6)&&(l=Xo.current,l!==null&&l.tag===13&&(l.flags|=16384))),_O(e,t)):cb(e)}function cb(t){var e=t;do{if(e.flags&32768){_O(e,Qc);return}t=e.return;var n=tU(e.alternate,e,_u);if(n!==null){fn=n;return}if(e=e.sibling,e!==null){fn=e;return}fn=e=t}while(e!==null);Br===0&&(Br=5)}function _O(t,e){do{var n=iU(t.alternate,t);if(n!==null){n.flags&=32767,fn=n;return}if(n=t.return,n!==null&&(n.flags|=32768,n.subtreeFlags=0,n.deletions=null),!e&&(t=t.sibling,t!==null)){fn=t;return}fn=t=n}while(t!==null);Br=6,fn=null}function zD(t,e,n,l,d,y,A,s,N,j){var K=nn.T,se=_r.p;try{_r.p=2,nn.T=null,cU(t,e,n,l,se,d,y,A,s,N,j)}finally{nn.T=K,_r.p=se}}function cU(t,e,n,l,d,y,A,s){do pm();while(sf!==null);if(Lr&6)throw Error(Vt(327));var N=t.finishedWork;if(l=t.finishedLanes,N===null)return null;if(t.finishedWork=null,t.finishedLanes=0,N===t.current)throw Error(Vt(177));t.callbackNode=null,t.callbackPriority=0,t.cancelPendingCommit=null;var j=N.lanes|N.childLanes;if(j|=_S,UV(t,l,j,y,A,s),t===lr&&(fn=lr=null,Cn=0),!(N.subtreeFlags&10256)&&!(N.flags&10256)||fx||(fx=!0,hE=j,dE=n,fU(e1,function(){return pm(),null})),n=(N.flags&15990)!==0,N.subtreeFlags&15990||n?(n=nn.T,nn.T=null,y=_r.p,_r.p=2,A=Lr,Lr|=4,Q6(t,N),tO(N,t),L6(vE,t.containerInfo),T1=!!yE,vE=yE=null,t.current=N,Kz(t,N.alternate,N),DV(),Lr=A,_r.p=y,nn.T=n):t.current=N,fx?(fx=!1,sf=t,by=l):yO(t,j),j=t.pendingLanes,j===0&&(Rh=null),kV(N.stateNode),pc(t),e!==null)for(d=t.onRecoverableError,N=0;N<e.length;N++)j=e[N],d(j.value,{componentStack:j.stack});return by&3&&pm(),j=t.pendingLanes,l&4194218&&j&42?t===fE?wy++:(wy=0,fE=t):wy=0,u0(0,!1),null}function yO(t,e){(t.pooledCacheLanes&=e)===0&&(e=t.pooledCache,e!=null&&(t.pooledCache=null,a0(e)))}function pm(){if(sf!==null){var t=sf,e=hE;hE=0;var n=bL(by),l=nn.T,d=_r.p;try{if(_r.p=32>n?32:n,nn.T=null,sf===null)var y=!1;else{n=dE,dE=null;var A=sf,s=by;if(sf=null,by=0,Lr&6)throw Error(Vt(331));var N=Lr;if(Lr|=4,aO(A.current),nO(A,A.current,s,n),Lr=N,u0(0,!1),uo&&typeof uo.onPostCommitFiberRoot=="function")try{uo.onPostCommitFiberRoot(t0,A)}catch{}y=!0}return y}finally{_r.p=d,nn.T=l,yO(t,e)}}return!1}function OD(t,e,n){e=Uo(n,e),e=eE(t.stateNode,e,2),t=Mh(t,e,2),t!==null&&(n0(t,2),pc(t))}function nr(t,e,n){if(t.tag===3)OD(t,t,n);else for(;e!==null;){if(e.tag===3){OD(e,t,n);break}else if(e.tag===1){var l=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof l.componentDidCatch=="function"&&(Rh===null||!Rh.has(l))){t=Uo(n,t),n=kz(2),l=Mh(e,n,2),l!==null&&(Nz(n,l,e,t),n0(l,2),pc(l));break}}e=e.return}}function l2(t,e,n){var l=t.pingCache;if(l===null){l=t.pingCache=new rU;var d=new Set;l.set(e,d)}else d=l.get(e),d===void 0&&(d=new Set,l.set(e,d));d.has(n)||(US=!0,d.add(n),t=uU.bind(null,t,e,n),e.then(t,t))}function uU(t,e,n){var l=t.pingCache;l!==null&&l.delete(e),t.pingedLanes|=t.suspendedLanes&n,t.warmLanes&=~n,lr===t&&(Cn&n)===n&&(Br===4||Br===3&&(Cn&62914560)===Cn&&300>rc()-qS?!(Lr&2)&&Am(t,0):jS|=n,Sm===Cn&&(Sm=0)),pc(t)}function vO(t,e){e===0&&(e=yL()),t=Bh(t,e),t!==null&&(n0(t,e),pc(t))}function hU(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),vO(t,n)}function dU(t,e){var n=0;switch(t.tag){case 13:var l=t.stateNode,d=t.memoizedState;d!==null&&(n=d.retryLane);break;case 19:l=t.stateNode;break;case 22:l=t.stateNode._retryCache;break;default:throw Error(Vt(314))}l!==null&&l.delete(e),vO(t,n)}function fU(t,e){return cS(t,e)}var g1=null,Gp=null,gE=!1,_1=!1,c2=!1,gf=0;function pc(t){t!==Gp&&t.next===null&&(Gp===null?g1=Gp=t:Gp=Gp.next=t),_1=!0,gE||(gE=!0,mU(pU))}function u0(t,e){if(!c2&&_1){c2=!0;do for(var n=!1,l=g1;l!==null;){if(!e)if(t!==0){var d=l.pendingLanes;if(d===0)var y=0;else{var A=l.suspendedLanes,s=l.pingedLanes;y=(1<<31-ho(42|t)+1)-1,y&=d&~(A&~s),y=y&201326677?y&201326677|1:y?y|2:0}y!==0&&(n=!0,kD(l,y))}else y=Cn,y=Q1(l,l===lr?y:0),!(y&3)||i0(l,y)||(n=!0,kD(l,y));l=l.next}while(n);c2=!1}}function pU(){_1=gE=!1;var t=0;gf!==0&&(TU()&&(t=gf),gf=0);for(var e=rc(),n=null,l=g1;l!==null;){var d=l.next,y=xO(l,e);y===0?(l.next=null,n===null?g1=d:n.next=d,d===null&&(Gp=n)):(n=l,(t!==0||y&3)&&(_1=!0)),l=d}u0(t,!1)}function xO(t,e){for(var n=t.suspendedLanes,l=t.pingedLanes,d=t.expirationTimes,y=t.pendingLanes&-62914561;0<y;){var A=31-ho(y),s=1<<A,N=d[A];N===-1?(!(s&n)||s&l)&&(d[A]=VV(s,e)):N<=e&&(t.expiredLanes|=s),y&=~s}if(e=lr,n=Cn,n=Q1(t,t===e?n:0),l=t.callbackNode,n===0||t===e&&or===2||t.cancelPendingCommit!==null)return l!==null&&l!==null&&BT(l),t.callbackNode=null,t.callbackPriority=0;if(!(n&3)||i0(t,n)){if(e=n&-n,e===t.callbackPriority)return e;switch(l!==null&&BT(l),bL(n)){case 2:case 8:n=mL;break;case 32:n=e1;break;case 268435456:n=gL;break;default:n=e1}return l=bO.bind(null,t),n=cS(n,l),t.callbackPriority=e,t.callbackNode=n,e}return l!==null&&l!==null&&BT(l),t.callbackPriority=2,t.callbackNode=null,2}function bO(t,e){var n=t.callbackNode;if(pm()&&t.callbackNode!==n)return null;var l=Cn;return l=Q1(t,t===lr?l:0),l===0?null:(dO(t,l,e),xO(t,rc()),t.callbackNode!=null&&t.callbackNode===n?bO.bind(null,t):null)}function kD(t,e){if(pm())return null;dO(t,e,!0)}function mU(t){SU(function(){Lr&6?cS(pL,t):t()})}function HS(){return gf===0&&(gf=_L()),gf}function ND(t){return t==null||typeof t=="symbol"||typeof t=="boolean"?null:typeof t=="function"?t:Ix(""+t)}function FD(t,e){var n=e.ownerDocument.createElement("input");return n.name=e.name,n.value=e.value,t.id&&n.setAttribute("form",t.id),e.parentNode.insertBefore(n,e),t=new FormData(t),n.parentNode.removeChild(n),t}function gU(t,e,n,l,d){if(e==="submit"&&n&&n.stateNode===d){var y=ND((d[qa]||null).action),A=l.submitter;A&&(e=(e=A[qa]||null)?ND(e.formAction):A.getAttribute("formAction"),e!==null&&(y=e,A=null));var s=new J1("action","action",null,l,d);t.push({event:s,listeners:[{instance:null,listener:function(){if(l.defaultPrevented){if(gf!==0){var N=A?FD(d,A):new FormData(d);Q2(n,{pending:!0,data:N,method:d.method,action:y},null,N)}}else typeof y=="function"&&(s.preventDefault(),N=A?FD(d,A):new FormData(d),Q2(n,{pending:!0,data:N,method:d.method,action:y},y,N))},currentTarget:d}]})}}for(var u2=0;u2<sD.length;u2++){var h2=sD[u2],_U=h2.toLowerCase(),yU=h2[0].toUpperCase()+h2.slice(1);Al(_U,"on"+yU)}Al(jL,"onAnimationEnd");Al(qL,"onAnimationIteration");Al(GL,"onAnimationStart");Al("dblclick","onDoubleClick");Al("focusin","onFocus");Al("focusout","onBlur");Al(O6,"onTransitionRun");Al(k6,"onTransitionStart");Al(N6,"onTransitionCancel");Al(HL,"onTransitionEnd");xm("onMouseEnter",["mouseout","mouseover"]);xm("onMouseLeave",["mouseout","mouseover"]);xm("onPointerEnter",["pointerout","pointerover"]);xm("onPointerLeave",["pointerout","pointerover"]);Mf("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Mf("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Mf("onBeforeInput",["compositionend","keypress","textInput","paste"]);Mf("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Mf("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Mf("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ny="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),vU=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Ny));function wO(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var l=t[n],d=l.event;l=l.listeners;e:{var y=void 0;if(e)for(var A=l.length-1;0<=A;A--){var s=l[A],N=s.instance,j=s.currentTarget;if(s=s.listener,N!==y&&d.isPropagationStopped())break e;y=s,d.currentTarget=j;try{y(d)}catch(K){u1(K)}d.currentTarget=null,y=N}else for(A=0;A<l.length;A++){if(s=l[A],N=s.instance,j=s.currentTarget,s=s.listener,N!==y&&d.isPropagationStopped())break e;y=s,d.currentTarget=j;try{y(d)}catch(K){u1(K)}d.currentTarget=null,y=N}}}}function Tn(t,e){var n=e[B2];n===void 0&&(n=e[B2]=new Set);var l=t+"__bubble";n.has(l)||(TO(e,t,2,!1),n.add(l))}function d2(t,e,n){var l=0;e&&(l|=4),TO(n,t,l,e)}var px="_reactListening"+Math.random().toString(36).slice(2);function $S(t){if(!t[px]){t[px]=!0,TL.forEach(function(n){n!=="selectionchange"&&(vU.has(n)||d2(n,!1,t),d2(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[px]||(e[px]=!0,d2("selectionchange",!1,e))}}function TO(t,e,n,l){switch(OO(e)){case 2:var d=HU;break;case 8:d=$U;break;default:d=YS}n=d.bind(null,e,n,t),d=void 0,!q2||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(d=!0),l?d!==void 0?t.addEventListener(e,n,{capture:!0,passive:d}):t.addEventListener(e,n,!0):d!==void 0?t.addEventListener(e,n,{passive:d}):t.addEventListener(e,n,!1)}function f2(t,e,n,l,d){var y=l;if(!(e&1)&&!(e&2)&&l!==null)e:for(;;){if(l===null)return;var A=l.tag;if(A===3||A===4){var s=l.stateNode.containerInfo;if(s===d||s.nodeType===8&&s.parentNode===d)break;if(A===4)for(A=l.return;A!==null;){var N=A.tag;if((N===3||N===4)&&(N=A.stateNode.containerInfo,N===d||N.nodeType===8&&N.parentNode===d))return;A=A.return}for(;s!==null;){if(A=of(s),A===null)return;if(N=A.tag,N===5||N===6||N===26||N===27){l=y=A;continue e}s=s.parentNode}}l=l.return}DL(function(){var j=y,K=dS(n),se=[];e:{var ae=$L.get(t);if(ae!==void 0){var me=J1,Ue=t;switch(t){case"keypress":if(Cx(n)===0)break e;case"keydown":case"keyup":me=d6;break;case"focusin":Ue="focus",me=GT;break;case"focusout":Ue="blur",me=GT;break;case"beforeblur":case"afterblur":me=GT;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":me=ZR;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":me=e6;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":me=m6;break;case jL:case qL:case GL:me=n6;break;case HL:me=_6;break;case"scroll":case"scrollend":me=QV;break;case"wheel":me=v6;break;case"copy":case"cut":case"paste":me=s6;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":me=XR;break;case"toggle":case"beforetoggle":me=b6}var Xe=(e&4)!==0,it=!Xe&&(t==="scroll"||t==="scrollend"),be=Xe?ae!==null?ae+"Capture":null:ae;Xe=[];for(var Ee=j,Ce;Ee!==null;){var We=Ee;if(Ce=We.stateNode,We=We.tag,We!==5&&We!==26&&We!==27||Ce===null||be===null||(We=Dy(Ee,be),We!=null&&Xe.push(Fy(Ee,We,Ce))),it)break;Ee=Ee.return}0<Xe.length&&(ae=new me(ae,Ue,null,n,K),se.push({event:ae,listeners:Xe}))}}if(!(e&7)){e:{if(ae=t==="mouseover"||t==="pointerover",me=t==="mouseout"||t==="pointerout",ae&&n!==j2&&(Ue=n.relatedTarget||n.fromElement)&&(of(Ue)||Ue[Fm]))break e;if((me||ae)&&(ae=K.window===K?K:(ae=K.ownerDocument)?ae.defaultView||ae.parentWindow:window,me?(Ue=n.relatedTarget||n.toElement,me=j,Ue=Ue?of(Ue):null,Ue!==null&&(it=Nm(Ue),Xe=Ue.tag,Ue!==it||Xe!==5&&Xe!==27&&Xe!==6)&&(Ue=null)):(me=null,Ue=j),me!==Ue)){if(Xe=ZR,We="onMouseLeave",be="onMouseEnter",Ee="mouse",(t==="pointerout"||t==="pointerover")&&(Xe=XR,We="onPointerLeave",be="onPointerEnter",Ee="pointer"),it=me==null?ae:J_(me),Ce=Ue==null?ae:J_(Ue),ae=new Xe(We,Ee+"leave",me,n,K),ae.target=it,ae.relatedTarget=Ce,We=null,of(K)===j&&(Xe=new Xe(be,Ee+"enter",Ue,n,K),Xe.target=Ce,Xe.relatedTarget=it,We=Xe),it=We,me&&Ue)t:{for(Xe=me,be=Ue,Ee=0,Ce=Xe;Ce;Ce=Vp(Ce))Ee++;for(Ce=0,We=be;We;We=Vp(We))Ce++;for(;0<Ee-Ce;)Xe=Vp(Xe),Ee--;for(;0<Ce-Ee;)be=Vp(be),Ce--;for(;Ee--;){if(Xe===be||be!==null&&Xe===be.alternate)break t;Xe=Vp(Xe),be=Vp(be)}Xe=null}else Xe=null;me!==null&&BD(se,ae,me,Xe,!1),Ue!==null&&it!==null&&BD(se,it,Ue,Xe,!0)}}e:{if(ae=j?J_(j):window,me=ae.nodeName&&ae.nodeName.toLowerCase(),me==="select"||me==="input"&&ae.type==="file")var Ct=JR;else if(QR(ae))if(NL)Ct=D6;else{Ct=C6;var Ut=M6}else me=ae.nodeName,!me||me.toLowerCase()!=="input"||ae.type!=="checkbox"&&ae.type!=="radio"?j&&hS(j.elementType)&&(Ct=JR):Ct=R6;if(Ct&&(Ct=Ct(t,j))){kL(se,Ct,n,K);break e}Ut&&Ut(t,ae,j),t==="focusout"&&j&&ae.type==="number"&&j.memoizedProps.value!=null&&U2(ae,"number",ae.value)}switch(Ut=j?J_(j):window,t){case"focusin":(QR(Ut)||Ut.contentEditable==="true")&&(Jp=Ut,G2=j,uy=null);break;case"focusout":uy=G2=Jp=null;break;case"mousedown":H2=!0;break;case"contextmenu":case"mouseup":case"dragend":H2=!1,rD(se,n,K);break;case"selectionchange":if(z6)break;case"keydown":case"keyup":rD(se,n,K)}var we;if(mS)e:{switch(t){case"compositionstart":var Ae="onCompositionStart";break e;case"compositionend":Ae="onCompositionEnd";break e;case"compositionupdate":Ae="onCompositionUpdate";break e}Ae=void 0}else Qp?zL(t,n)&&(Ae="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(Ae="onCompositionStart");Ae&&(LL&&n.locale!=="ko"&&(Qp||Ae!=="onCompositionStart"?Ae==="onCompositionEnd"&&Qp&&(we=PL()):(Th=K,fS="value"in Th?Th.value:Th.textContent,Qp=!0)),Ut=y1(j,Ae),0<Ut.length&&(Ae=new WR(Ae,t,null,n,K),se.push({event:Ae,listeners:Ut}),we?Ae.data=we:(we=OL(n),we!==null&&(Ae.data=we)))),(we=T6?E6(t,n):S6(t,n))&&(Ae=y1(j,"onBeforeInput"),0<Ae.length&&(Ut=new WR("onBeforeInput","beforeinput",null,n,K),se.push({event:Ut,listeners:Ae}),Ut.data=we)),gU(se,t,j,n,K)}wO(se,e)})}function Fy(t,e,n){return{instance:t,listener:e,currentTarget:n}}function y1(t,e){for(var n=e+"Capture",l=[];t!==null;){var d=t,y=d.stateNode;d=d.tag,d!==5&&d!==26&&d!==27||y===null||(d=Dy(t,n),d!=null&&l.unshift(Fy(t,d,y)),d=Dy(t,e),d!=null&&l.push(Fy(t,d,y))),t=t.return}return l}function Vp(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5&&t.tag!==27);return t||null}function BD(t,e,n,l,d){for(var y=e._reactName,A=[];n!==null&&n!==l;){var s=n,N=s.alternate,j=s.stateNode;if(s=s.tag,N!==null&&N===l)break;s!==5&&s!==26&&s!==27||j===null||(N=j,d?(j=Dy(n,y),j!=null&&A.unshift(Fy(n,j,N))):d||(j=Dy(n,y),j!=null&&A.push(Fy(n,j,N)))),n=n.return}A.length!==0&&t.push({event:e,listeners:A})}var xU=/\r\n?/g,bU=/\u0000|\uFFFD/g;function VD(t){return(typeof t=="string"?t:""+t).replace(xU,`
`).replace(bU,"")}function EO(t,e){return e=VD(e),VD(t)===e}function ub(){}function Wn(t,e,n,l,d,y){switch(n){case"children":typeof l=="string"?e==="body"||e==="textarea"&&l===""||bm(t,l):(typeof l=="number"||typeof l=="bigint")&&e!=="body"&&bm(t,""+l);break;case"className":ax(t,"class",l);break;case"tabIndex":ax(t,"tabindex",l);break;case"dir":case"role":case"viewBox":case"width":case"height":ax(t,n,l);break;case"style":RL(t,l,y);break;case"data":if(e!=="object"){ax(t,"data",l);break}case"src":case"href":if(l===""&&(e!=="a"||n!=="href")){t.removeAttribute(n);break}if(l==null||typeof l=="function"||typeof l=="symbol"||typeof l=="boolean"){t.removeAttribute(n);break}l=Ix(""+l),t.setAttribute(n,l);break;case"action":case"formAction":if(typeof l=="function"){t.setAttribute(n,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof y=="function"&&(n==="formAction"?(e!=="input"&&Wn(t,e,"name",d.name,d,null),Wn(t,e,"formEncType",d.formEncType,d,null),Wn(t,e,"formMethod",d.formMethod,d,null),Wn(t,e,"formTarget",d.formTarget,d,null)):(Wn(t,e,"encType",d.encType,d,null),Wn(t,e,"method",d.method,d,null),Wn(t,e,"target",d.target,d,null)));if(l==null||typeof l=="symbol"||typeof l=="boolean"){t.removeAttribute(n);break}l=Ix(""+l),t.setAttribute(n,l);break;case"onClick":l!=null&&(t.onclick=ub);break;case"onScroll":l!=null&&Tn("scroll",t);break;case"onScrollEnd":l!=null&&Tn("scrollend",t);break;case"dangerouslySetInnerHTML":if(l!=null){if(typeof l!="object"||!("__html"in l))throw Error(Vt(61));if(n=l.__html,n!=null){if(d.children!=null)throw Error(Vt(60));t.innerHTML=n}}break;case"multiple":t.multiple=l&&typeof l!="function"&&typeof l!="symbol";break;case"muted":t.muted=l&&typeof l!="function"&&typeof l!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(l==null||typeof l=="function"||typeof l=="boolean"||typeof l=="symbol"){t.removeAttribute("xlink:href");break}n=Ix(""+l),t.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":l!=null&&typeof l!="function"&&typeof l!="symbol"?t.setAttribute(n,""+l):t.removeAttribute(n);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":l&&typeof l!="function"&&typeof l!="symbol"?t.setAttribute(n,""):t.removeAttribute(n);break;case"capture":case"download":l===!0?t.setAttribute(n,""):l!==!1&&l!=null&&typeof l!="function"&&typeof l!="symbol"?t.setAttribute(n,l):t.removeAttribute(n);break;case"cols":case"rows":case"size":case"span":l!=null&&typeof l!="function"&&typeof l!="symbol"&&!isNaN(l)&&1<=l?t.setAttribute(n,l):t.removeAttribute(n);break;case"rowSpan":case"start":l==null||typeof l=="function"||typeof l=="symbol"||isNaN(l)?t.removeAttribute(n):t.setAttribute(n,l);break;case"popover":Tn("beforetoggle",t),Tn("toggle",t),Ax(t,"popover",l);break;case"xlinkActuate":$c(t,"http://www.w3.org/1999/xlink","xlink:actuate",l);break;case"xlinkArcrole":$c(t,"http://www.w3.org/1999/xlink","xlink:arcrole",l);break;case"xlinkRole":$c(t,"http://www.w3.org/1999/xlink","xlink:role",l);break;case"xlinkShow":$c(t,"http://www.w3.org/1999/xlink","xlink:show",l);break;case"xlinkTitle":$c(t,"http://www.w3.org/1999/xlink","xlink:title",l);break;case"xlinkType":$c(t,"http://www.w3.org/1999/xlink","xlink:type",l);break;case"xmlBase":$c(t,"http://www.w3.org/XML/1998/namespace","xml:base",l);break;case"xmlLang":$c(t,"http://www.w3.org/XML/1998/namespace","xml:lang",l);break;case"xmlSpace":$c(t,"http://www.w3.org/XML/1998/namespace","xml:space",l);break;case"is":Ax(t,"is",l);break;case"innerText":case"textContent":break;default:(!(2<n.length)||n[0]!=="o"&&n[0]!=="O"||n[1]!=="n"&&n[1]!=="N")&&(n=YV.get(n)||n,Ax(t,n,l))}}function _E(t,e,n,l,d,y){switch(n){case"style":RL(t,l,y);break;case"dangerouslySetInnerHTML":if(l!=null){if(typeof l!="object"||!("__html"in l))throw Error(Vt(61));if(n=l.__html,n!=null){if(d.children!=null)throw Error(Vt(60));t.innerHTML=n}}break;case"children":typeof l=="string"?bm(t,l):(typeof l=="number"||typeof l=="bigint")&&bm(t,""+l);break;case"onScroll":l!=null&&Tn("scroll",t);break;case"onScrollEnd":l!=null&&Tn("scrollend",t);break;case"onClick":l!=null&&(t.onclick=ub);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!EL.hasOwnProperty(n))e:{if(n[0]==="o"&&n[1]==="n"&&(d=n.endsWith("Capture"),e=n.slice(2,d?n.length-7:void 0),y=t[qa]||null,y=y!=null?y[n]:null,typeof y=="function"&&t.removeEventListener(e,y,d),typeof l=="function")){typeof y!="function"&&y!==null&&(n in t?t[n]=null:t.hasAttribute(n)&&t.removeAttribute(n)),t.addEventListener(e,l,d);break e}n in t?t[n]=l:l===!0?t.setAttribute(n,""):Ax(t,n,l)}}}function qs(t,e,n){switch(e){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Tn("error",t),Tn("load",t);var l=!1,d=!1,y;for(y in n)if(n.hasOwnProperty(y)){var A=n[y];if(A!=null)switch(y){case"src":l=!0;break;case"srcSet":d=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(Vt(137,e));default:Wn(t,e,y,A,n,null)}}d&&Wn(t,e,"srcSet",n.srcSet,n,null),l&&Wn(t,e,"src",n.src,n,null);return;case"input":Tn("invalid",t);var s=y=A=d=null,N=null,j=null;for(l in n)if(n.hasOwnProperty(l)){var K=n[l];if(K!=null)switch(l){case"name":d=K;break;case"type":A=K;break;case"checked":N=K;break;case"defaultChecked":j=K;break;case"value":y=K;break;case"defaultValue":s=K;break;case"children":case"dangerouslySetInnerHTML":if(K!=null)throw Error(Vt(137,e));break;default:Wn(t,e,l,K,n,null)}}IL(t,y,s,N,j,A,d,!1),t1(t);return;case"select":Tn("invalid",t),l=A=y=null;for(d in n)if(n.hasOwnProperty(d)&&(s=n[d],s!=null))switch(d){case"value":y=s;break;case"defaultValue":A=s;break;case"multiple":l=s;default:Wn(t,e,d,s,n,null)}e=y,n=A,t.multiple=!!l,e!=null?lm(t,!!l,e,!1):n!=null&&lm(t,!!l,n,!0);return;case"textarea":Tn("invalid",t),y=d=l=null;for(A in n)if(n.hasOwnProperty(A)&&(s=n[A],s!=null))switch(A){case"value":l=s;break;case"defaultValue":d=s;break;case"children":y=s;break;case"dangerouslySetInnerHTML":if(s!=null)throw Error(Vt(91));break;default:Wn(t,e,A,s,n,null)}CL(t,l,d,y),t1(t);return;case"option":for(N in n)if(n.hasOwnProperty(N)&&(l=n[N],l!=null))switch(N){case"selected":t.selected=l&&typeof l!="function"&&typeof l!="symbol";break;default:Wn(t,e,N,l,n,null)}return;case"dialog":Tn("cancel",t),Tn("close",t);break;case"iframe":case"object":Tn("load",t);break;case"video":case"audio":for(l=0;l<Ny.length;l++)Tn(Ny[l],t);break;case"image":Tn("error",t),Tn("load",t);break;case"details":Tn("toggle",t);break;case"embed":case"source":case"link":Tn("error",t),Tn("load",t);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(j in n)if(n.hasOwnProperty(j)&&(l=n[j],l!=null))switch(j){case"children":case"dangerouslySetInnerHTML":throw Error(Vt(137,e));default:Wn(t,e,j,l,n,null)}return;default:if(hS(e)){for(K in n)n.hasOwnProperty(K)&&(l=n[K],l!==void 0&&_E(t,e,K,l,n,void 0));return}}for(s in n)n.hasOwnProperty(s)&&(l=n[s],l!=null&&Wn(t,e,s,l,n,null))}function wU(t,e,n,l){switch(e){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var d=null,y=null,A=null,s=null,N=null,j=null,K=null;for(me in n){var se=n[me];if(n.hasOwnProperty(me)&&se!=null)switch(me){case"checked":break;case"value":break;case"defaultValue":N=se;default:l.hasOwnProperty(me)||Wn(t,e,me,null,l,se)}}for(var ae in l){var me=l[ae];if(se=n[ae],l.hasOwnProperty(ae)&&(me!=null||se!=null))switch(ae){case"type":y=me;break;case"name":d=me;break;case"checked":j=me;break;case"defaultChecked":K=me;break;case"value":A=me;break;case"defaultValue":s=me;break;case"children":case"dangerouslySetInnerHTML":if(me!=null)throw Error(Vt(137,e));break;default:me!==se&&Wn(t,e,ae,me,l,se)}}V2(t,A,s,N,j,K,y,d);return;case"select":me=A=s=ae=null;for(y in n)if(N=n[y],n.hasOwnProperty(y)&&N!=null)switch(y){case"value":break;case"multiple":me=N;default:l.hasOwnProperty(y)||Wn(t,e,y,null,l,N)}for(d in l)if(y=l[d],N=n[d],l.hasOwnProperty(d)&&(y!=null||N!=null))switch(d){case"value":ae=y;break;case"defaultValue":s=y;break;case"multiple":A=y;default:y!==N&&Wn(t,e,d,y,l,N)}e=s,n=A,l=me,ae!=null?lm(t,!!n,ae,!1):!!l!=!!n&&(e!=null?lm(t,!!n,e,!0):lm(t,!!n,n?[]:"",!1));return;case"textarea":me=ae=null;for(s in n)if(d=n[s],n.hasOwnProperty(s)&&d!=null&&!l.hasOwnProperty(s))switch(s){case"value":break;case"children":break;default:Wn(t,e,s,null,l,d)}for(A in l)if(d=l[A],y=n[A],l.hasOwnProperty(A)&&(d!=null||y!=null))switch(A){case"value":ae=d;break;case"defaultValue":me=d;break;case"children":break;case"dangerouslySetInnerHTML":if(d!=null)throw Error(Vt(91));break;default:d!==y&&Wn(t,e,A,d,l,y)}ML(t,ae,me);return;case"option":for(var Ue in n)if(ae=n[Ue],n.hasOwnProperty(Ue)&&ae!=null&&!l.hasOwnProperty(Ue))switch(Ue){case"selected":t.selected=!1;break;default:Wn(t,e,Ue,null,l,ae)}for(N in l)if(ae=l[N],me=n[N],l.hasOwnProperty(N)&&ae!==me&&(ae!=null||me!=null))switch(N){case"selected":t.selected=ae&&typeof ae!="function"&&typeof ae!="symbol";break;default:Wn(t,e,N,ae,l,me)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Xe in n)ae=n[Xe],n.hasOwnProperty(Xe)&&ae!=null&&!l.hasOwnProperty(Xe)&&Wn(t,e,Xe,null,l,ae);for(j in l)if(ae=l[j],me=n[j],l.hasOwnProperty(j)&&ae!==me&&(ae!=null||me!=null))switch(j){case"children":case"dangerouslySetInnerHTML":if(ae!=null)throw Error(Vt(137,e));break;default:Wn(t,e,j,ae,l,me)}return;default:if(hS(e)){for(var it in n)ae=n[it],n.hasOwnProperty(it)&&ae!==void 0&&!l.hasOwnProperty(it)&&_E(t,e,it,void 0,l,ae);for(K in l)ae=l[K],me=n[K],!l.hasOwnProperty(K)||ae===me||ae===void 0&&me===void 0||_E(t,e,K,ae,l,me);return}}for(var be in n)ae=n[be],n.hasOwnProperty(be)&&ae!=null&&!l.hasOwnProperty(be)&&Wn(t,e,be,null,l,ae);for(se in l)ae=l[se],me=n[se],!l.hasOwnProperty(se)||ae===me||ae==null&&me==null||Wn(t,e,se,ae,l,me)}var yE=null,vE=null;function v1(t){return t.nodeType===9?t:t.ownerDocument}function UD(t){switch(t){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function SO(t,e){if(t===0)switch(e){case"svg":return 1;case"math":return 2;default:return 0}return t===1&&e==="foreignObject"?0:t}function xE(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.children=="bigint"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var p2=null;function TU(){var t=window.event;return t&&t.type==="popstate"?t===p2?!1:(p2=t,!0):(p2=null,!1)}var AO=typeof setTimeout=="function"?setTimeout:void 0,EU=typeof clearTimeout=="function"?clearTimeout:void 0,jD=typeof Promise=="function"?Promise:void 0,SU=typeof queueMicrotask=="function"?queueMicrotask:typeof jD<"u"?function(t){return jD.resolve(null).then(t).catch(AU)}:AO;function AU(t){setTimeout(function(){throw t})}function m2(t,e){var n=e,l=0;do{var d=n.nextSibling;if(t.removeChild(n),d&&d.nodeType===8)if(n=d.data,n==="/$"){if(l===0){t.removeChild(d),qy(e);return}l--}else n!=="$"&&n!=="$?"&&n!=="$!"||l++;n=d}while(n);qy(e)}function bE(t){var e=t.firstChild;for(e&&e.nodeType===10&&(e=e.nextSibling);e;){var n=e;switch(e=e.nextSibling,n.nodeName){case"HTML":case"HEAD":case"BODY":bE(n),uS(n);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(n.rel.toLowerCase()==="stylesheet")continue}t.removeChild(n)}}function IU(t,e,n,l){for(;t.nodeType===1;){var d=n;if(t.nodeName.toLowerCase()!==e.toLowerCase()){if(!l&&(t.nodeName!=="INPUT"||t.type!=="hidden"))break}else if(l){if(!t[Ry])switch(e){case"meta":if(!t.hasAttribute("itemprop"))break;return t;case"link":if(y=t.getAttribute("rel"),y==="stylesheet"&&t.hasAttribute("data-precedence"))break;if(y!==d.rel||t.getAttribute("href")!==(d.href==null?null:d.href)||t.getAttribute("crossorigin")!==(d.crossOrigin==null?null:d.crossOrigin)||t.getAttribute("title")!==(d.title==null?null:d.title))break;return t;case"style":if(t.hasAttribute("data-precedence"))break;return t;case"script":if(y=t.getAttribute("src"),(y!==(d.src==null?null:d.src)||t.getAttribute("type")!==(d.type==null?null:d.type)||t.getAttribute("crossorigin")!==(d.crossOrigin==null?null:d.crossOrigin))&&y&&t.hasAttribute("async")&&!t.hasAttribute("itemprop"))break;return t;default:return t}}else if(e==="input"&&t.type==="hidden"){var y=d.name==null?null:""+d.name;if(d.type==="hidden"&&t.getAttribute("name")===y)return t}else return t;if(t=xl(t.nextSibling),t===null)break}return null}function MU(t,e,n){if(e==="")return null;for(;t.nodeType!==3;)if((t.nodeType!==1||t.nodeName!=="INPUT"||t.type!=="hidden")&&!n||(t=xl(t.nextSibling),t===null))return null;return t}function xl(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?"||e==="F!"||e==="F")break;if(e==="/$")return null}}return t}function qD(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}function IO(t,e,n){switch(e=v1(n),t){case"html":if(t=e.documentElement,!t)throw Error(Vt(452));return t;case"head":if(t=e.head,!t)throw Error(Vt(453));return t;case"body":if(t=e.body,!t)throw Error(Vt(454));return t;default:throw Error(Vt(451))}}var Yo=new Map,GD=new Set;function x1(t){return typeof t.getRootNode=="function"?t.getRootNode():t.ownerDocument}var wu=_r.d;_r.d={f:CU,r:RU,D:DU,C:PU,L:LU,m:zU,X:kU,S:OU,M:NU};function CU(){var t=wu.f(),e=lb();return t||e}function RU(t){var e=Bm(t);e!==null&&e.tag===5&&e.type==="form"?Iz(e):wu.r(t)}var Um=typeof document>"u"?null:document;function MO(t,e,n){var l=Um;if(l&&typeof e=="string"&&e){var d=Vo(e);d='link[rel="'+t+'"][href="'+d+'"]',typeof n=="string"&&(d+='[crossorigin="'+n+'"]'),GD.has(d)||(GD.add(d),t={rel:t,crossOrigin:n,href:e},l.querySelector(d)===null&&(e=l.createElement("link"),qs(e,"link",t),As(e),l.head.appendChild(e)))}}function DU(t){wu.D(t),MO("dns-prefetch",t,null)}function PU(t,e){wu.C(t,e),MO("preconnect",t,e)}function LU(t,e,n){wu.L(t,e,n);var l=Um;if(l&&t&&e){var d='link[rel="preload"][as="'+Vo(e)+'"]';e==="image"&&n&&n.imageSrcSet?(d+='[imagesrcset="'+Vo(n.imageSrcSet)+'"]',typeof n.imageSizes=="string"&&(d+='[imagesizes="'+Vo(n.imageSizes)+'"]')):d+='[href="'+Vo(t)+'"]';var y=d;switch(e){case"style":y=Im(t);break;case"script":y=jm(t)}Yo.has(y)||(t=yr({rel:"preload",href:e==="image"&&n&&n.imageSrcSet?void 0:t,as:e},n),Yo.set(y,t),l.querySelector(d)!==null||e==="style"&&l.querySelector(h0(y))||e==="script"&&l.querySelector(d0(y))||(e=l.createElement("link"),qs(e,"link",t),As(e),l.head.appendChild(e)))}}function zU(t,e){wu.m(t,e);var n=Um;if(n&&t){var l=e&&typeof e.as=="string"?e.as:"script",d='link[rel="modulepreload"][as="'+Vo(l)+'"][href="'+Vo(t)+'"]',y=d;switch(l){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":y=jm(t)}if(!Yo.has(y)&&(t=yr({rel:"modulepreload",href:t},e),Yo.set(y,t),n.querySelector(d)===null)){switch(l){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(n.querySelector(d0(y)))return}l=n.createElement("link"),qs(l,"link",t),As(l),n.head.appendChild(l)}}}function OU(t,e,n){wu.S(t,e,n);var l=Um;if(l&&t){var d=om(l).hoistableStyles,y=Im(t);e=e||"default";var A=d.get(y);if(!A){var s={loading:0,preload:null};if(A=l.querySelector(h0(y)))s.loading=5;else{t=yr({rel:"stylesheet",href:t,"data-precedence":e},n),(n=Yo.get(y))&&ZS(t,n);var N=A=l.createElement("link");As(N),qs(N,"link",t),N._p=new Promise(function(j,K){N.onload=j,N.onerror=K}),N.addEventListener("load",function(){s.loading|=1}),N.addEventListener("error",function(){s.loading|=2}),s.loading|=4,Ox(A,e,l)}A={type:"stylesheet",instance:A,count:1,state:s},d.set(y,A)}}}function kU(t,e){wu.X(t,e);var n=Um;if(n&&t){var l=om(n).hoistableScripts,d=jm(t),y=l.get(d);y||(y=n.querySelector(d0(d)),y||(t=yr({src:t,async:!0},e),(e=Yo.get(d))&&WS(t,e),y=n.createElement("script"),As(y),qs(y,"link",t),n.head.appendChild(y)),y={type:"script",instance:y,count:1,state:null},l.set(d,y))}}function NU(t,e){wu.M(t,e);var n=Um;if(n&&t){var l=om(n).hoistableScripts,d=jm(t),y=l.get(d);y||(y=n.querySelector(d0(d)),y||(t=yr({src:t,async:!0,type:"module"},e),(e=Yo.get(d))&&WS(t,e),y=n.createElement("script"),As(y),qs(y,"link",t),n.head.appendChild(y)),y={type:"script",instance:y,count:1,state:null},l.set(d,y))}}function HD(t,e,n,l){var d=(d=Ah.current)?x1(d):null;if(!d)throw Error(Vt(446));switch(t){case"meta":case"title":return null;case"style":return typeof n.precedence=="string"&&typeof n.href=="string"?(e=Im(n.href),n=om(d).hoistableStyles,l=n.get(e),l||(l={type:"style",instance:null,count:0,state:null},n.set(e,l)),l):{type:"void",instance:null,count:0,state:null};case"link":if(n.rel==="stylesheet"&&typeof n.href=="string"&&typeof n.precedence=="string"){t=Im(n.href);var y=om(d).hoistableStyles,A=y.get(t);if(A||(d=d.ownerDocument||d,A={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},y.set(t,A),(y=d.querySelector(h0(t)))&&!y._p&&(A.instance=y,A.state.loading=5),Yo.has(t)||(n={rel:"preload",as:"style",href:n.href,crossOrigin:n.crossOrigin,integrity:n.integrity,media:n.media,hrefLang:n.hrefLang,referrerPolicy:n.referrerPolicy},Yo.set(t,n),y||FU(d,t,n,A.state))),e&&l===null)throw Error(Vt(528,""));return A}if(e&&l!==null)throw Error(Vt(529,""));return null;case"script":return e=n.async,n=n.src,typeof n=="string"&&e&&typeof e!="function"&&typeof e!="symbol"?(e=jm(n),n=om(d).hoistableScripts,l=n.get(e),l||(l={type:"script",instance:null,count:0,state:null},n.set(e,l)),l):{type:"void",instance:null,count:0,state:null};default:throw Error(Vt(444,t))}}function Im(t){return'href="'+Vo(t)+'"'}function h0(t){return'link[rel="stylesheet"]['+t+"]"}function CO(t){return yr({},t,{"data-precedence":t.precedence,precedence:null})}function FU(t,e,n,l){t.querySelector('link[rel="preload"][as="style"]['+e+"]")?l.loading=1:(e=t.createElement("link"),l.preload=e,e.addEventListener("load",function(){return l.loading|=1}),e.addEventListener("error",function(){return l.loading|=2}),qs(e,"link",n),As(e),t.head.appendChild(e))}function jm(t){return'[src="'+Vo(t)+'"]'}function d0(t){return"script[async]"+t}function $D(t,e,n){if(e.count++,e.instance===null)switch(e.type){case"style":var l=t.querySelector('style[data-href~="'+Vo(n.href)+'"]');if(l)return e.instance=l,As(l),l;var d=yr({},n,{"data-href":n.href,"data-precedence":n.precedence,href:null,precedence:null});return l=(t.ownerDocument||t).createElement("style"),As(l),qs(l,"style",d),Ox(l,n.precedence,t),e.instance=l;case"stylesheet":d=Im(n.href);var y=t.querySelector(h0(d));if(y)return e.state.loading|=4,e.instance=y,As(y),y;l=CO(n),(d=Yo.get(d))&&ZS(l,d),y=(t.ownerDocument||t).createElement("link"),As(y);var A=y;return A._p=new Promise(function(s,N){A.onload=s,A.onerror=N}),qs(y,"link",l),e.state.loading|=4,Ox(y,n.precedence,t),e.instance=y;case"script":return y=jm(n.src),(d=t.querySelector(d0(y)))?(e.instance=d,As(d),d):(l=n,(d=Yo.get(y))&&(l=yr({},n),WS(l,d)),t=t.ownerDocument||t,d=t.createElement("script"),As(d),qs(d,"link",l),t.head.appendChild(d),e.instance=d);case"void":return null;default:throw Error(Vt(443,e.type))}else e.type==="stylesheet"&&!(e.state.loading&4)&&(l=e.instance,e.state.loading|=4,Ox(l,n.precedence,t));return e.instance}function Ox(t,e,n){for(var l=n.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),d=l.length?l[l.length-1]:null,y=d,A=0;A<l.length;A++){var s=l[A];if(s.dataset.precedence===e)y=s;else if(y!==d)break}y?y.parentNode.insertBefore(t,y.nextSibling):(e=n.nodeType===9?n.head:n,e.insertBefore(t,e.firstChild))}function ZS(t,e){t.crossOrigin==null&&(t.crossOrigin=e.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=e.referrerPolicy),t.title==null&&(t.title=e.title)}function WS(t,e){t.crossOrigin==null&&(t.crossOrigin=e.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=e.referrerPolicy),t.integrity==null&&(t.integrity=e.integrity)}var kx=null;function ZD(t,e,n){if(kx===null){var l=new Map,d=kx=new Map;d.set(n,l)}else d=kx,l=d.get(n),l||(l=new Map,d.set(n,l));if(l.has(t))return l;for(l.set(t,null),n=n.getElementsByTagName(t),d=0;d<n.length;d++){var y=n[d];if(!(y[Ry]||y[ca]||t==="link"&&y.getAttribute("rel")==="stylesheet")&&y.namespaceURI!=="http://www.w3.org/2000/svg"){var A=y.getAttribute(e)||"";A=t+A;var s=l.get(A);s?s.push(y):l.set(A,[y])}}return l}function WD(t,e,n){t=t.ownerDocument||t,t.head.insertBefore(n,e==="title"?t.querySelector("head > title"):null)}function BU(t,e,n){if(n===1||e.itemProp!=null)return!1;switch(t){case"meta":case"title":return!0;case"style":if(typeof e.precedence!="string"||typeof e.href!="string"||e.href==="")break;return!0;case"link":if(typeof e.rel!="string"||typeof e.href!="string"||e.href===""||e.onLoad||e.onError)break;switch(e.rel){case"stylesheet":return t=e.disabled,typeof e.precedence=="string"&&t==null;default:return!0}case"script":if(e.async&&typeof e.async!="function"&&typeof e.async!="symbol"&&!e.onLoad&&!e.onError&&e.src&&typeof e.src=="string")return!0}return!1}function RO(t){return!(t.type==="stylesheet"&&!(t.state.loading&3))}var By=null;function VU(){}function UU(t,e,n){if(By===null)throw Error(Vt(475));var l=By;if(e.type==="stylesheet"&&(typeof n.media!="string"||matchMedia(n.media).matches!==!1)&&!(e.state.loading&4)){if(e.instance===null){var d=Im(n.href),y=t.querySelector(h0(d));if(y){t=y._p,t!==null&&typeof t=="object"&&typeof t.then=="function"&&(l.count++,l=b1.bind(l),t.then(l,l)),e.state.loading|=4,e.instance=y,As(y);return}y=t.ownerDocument||t,n=CO(n),(d=Yo.get(d))&&ZS(n,d),y=y.createElement("link"),As(y);var A=y;A._p=new Promise(function(s,N){A.onload=s,A.onerror=N}),qs(y,"link",n),e.instance=y}l.stylesheets===null&&(l.stylesheets=new Map),l.stylesheets.set(e,t),(t=e.state.preload)&&!(e.state.loading&3)&&(l.count++,e=b1.bind(l),t.addEventListener("load",e),t.addEventListener("error",e))}}function jU(){if(By===null)throw Error(Vt(475));var t=By;return t.stylesheets&&t.count===0&&wE(t,t.stylesheets),0<t.count?function(e){var n=setTimeout(function(){if(t.stylesheets&&wE(t,t.stylesheets),t.unsuspend){var l=t.unsuspend;t.unsuspend=null,l()}},6e4);return t.unsuspend=e,function(){t.unsuspend=null,clearTimeout(n)}}:null}function b1(){if(this.count--,this.count===0){if(this.stylesheets)wE(this,this.stylesheets);else if(this.unsuspend){var t=this.unsuspend;this.unsuspend=null,t()}}}var w1=null;function wE(t,e){t.stylesheets=null,t.unsuspend!==null&&(t.count++,w1=new Map,e.forEach(qU,t),w1=null,b1.call(t))}function qU(t,e){if(!(e.state.loading&4)){var n=w1.get(t);if(n)var l=n.get(null);else{n=new Map,w1.set(t,n);for(var d=t.querySelectorAll("link[data-precedence],style[data-precedence]"),y=0;y<d.length;y++){var A=d[y];(A.nodeName==="LINK"||A.getAttribute("media")!=="not all")&&(n.set(A.dataset.precedence,A),l=A)}l&&n.set(null,l)}d=e.instance,A=d.getAttribute("data-precedence"),y=n.get(A)||l,y===l&&n.set(null,d),n.set(A,d),this.count++,l=b1.bind(this),d.addEventListener("load",l),d.addEventListener("error",l),y?y.parentNode.insertBefore(d,y.nextSibling):(t=t.nodeType===9?t.head:t,t.insertBefore(d,t.firstChild)),e.state.loading|=4}}var Vy={$$typeof:tu,Provider:null,Consumer:null,_currentValue:hf,_currentValue2:hf,_threadCount:0};function GU(t,e,n,l,d,y,A,s){this.tag=1,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=VT(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.finishedLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=VT(0),this.hiddenUpdates=VT(null),this.identifierPrefix=l,this.onUncaughtError=d,this.onCaughtError=y,this.onRecoverableError=A,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=s,this.incompleteTransitions=new Map}function DO(t,e,n,l,d,y,A,s,N,j,K,se){return t=new GU(t,e,n,A,s,N,j,se),e=1,y===!0&&(e|=24),y=qo(3,null,null,e),t.current=y,y.stateNode=t,e=wS(),e.refCount++,t.pooledCache=e,e.refCount++,y.memoizedState={element:l,isDehydrated:n,cache:e},NS(y),t}function PO(t){return t?(t=im,t):im}function LO(t,e,n,l,d,y){d=PO(d),l.context===null?l.context=d:l.pendingContext=d,l=Ih(e),l.payload={element:n},y=y===void 0?null:y,y!==null&&(l.callback=y),n=Mh(t,l,e),n!==null&&(Ca(n,t,e),gy(n,t,e))}function XD(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function XS(t,e){XD(t,e),(t=t.alternate)&&XD(t,e)}function zO(t){if(t.tag===13){var e=Bh(t,67108864);e!==null&&Ca(e,t,67108864),XS(t,67108864)}}var T1=!0;function HU(t,e,n,l){var d=nn.T;nn.T=null;var y=_r.p;try{_r.p=2,YS(t,e,n,l)}finally{_r.p=y,nn.T=d}}function $U(t,e,n,l){var d=nn.T;nn.T=null;var y=_r.p;try{_r.p=8,YS(t,e,n,l)}finally{_r.p=y,nn.T=d}}function YS(t,e,n,l){if(T1){var d=TE(l);if(d===null)f2(t,e,l,E1,n),YD(t,l);else if(WU(d,t,e,n,l))l.stopPropagation();else if(YD(t,l),e&4&&-1<ZU.indexOf(t)){for(;d!==null;){var y=Bm(d);if(y!==null)switch(y.tag){case 3:if(y=y.stateNode,y.current.memoizedState.isDehydrated){var A=tf(y.pendingLanes);if(A!==0){var s=y;for(s.pendingLanes|=2,s.entangledLanes|=2;A;){var N=1<<31-ho(A);s.entanglements[1]|=N,A&=~N}pc(y),!(Lr&6)&&(p1=rc()+500,u0(0,!1))}}break;case 13:s=Bh(y,2),s!==null&&Ca(s,y,2),lb(),XS(y,2)}if(y=TE(l),y===null&&f2(t,e,l,E1,n),y===d)break;d=y}d!==null&&l.stopPropagation()}else f2(t,e,l,null,n)}}function TE(t){return t=dS(t),KS(t)}var E1=null;function KS(t){if(E1=null,t=of(t),t!==null){var e=Nm(t);if(e===null)t=null;else{var n=e.tag;if(n===13){if(t=dL(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null)}}return E1=t,null}function OO(t){switch(t){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(PV()){case pL:return 2;case mL:return 8;case e1:case LV:return 32;case gL:return 268435456;default:return 32}default:return 32}}var EE=!1,Dh=null,Ph=null,Lh=null,Uy=new Map,jy=new Map,yh=[],ZU="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function YD(t,e){switch(t){case"focusin":case"focusout":Dh=null;break;case"dragenter":case"dragleave":Ph=null;break;case"mouseover":case"mouseout":Lh=null;break;case"pointerover":case"pointerout":Uy.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":jy.delete(e.pointerId)}}function Z_(t,e,n,l,d,y){return t===null||t.nativeEvent!==y?(t={blockedOn:e,domEventName:n,eventSystemFlags:l,nativeEvent:y,targetContainers:[d]},e!==null&&(e=Bm(e),e!==null&&zO(e)),t):(t.eventSystemFlags|=l,e=t.targetContainers,d!==null&&e.indexOf(d)===-1&&e.push(d),t)}function WU(t,e,n,l,d){switch(e){case"focusin":return Dh=Z_(Dh,t,e,n,l,d),!0;case"dragenter":return Ph=Z_(Ph,t,e,n,l,d),!0;case"mouseover":return Lh=Z_(Lh,t,e,n,l,d),!0;case"pointerover":var y=d.pointerId;return Uy.set(y,Z_(Uy.get(y)||null,t,e,n,l,d)),!0;case"gotpointercapture":return y=d.pointerId,jy.set(y,Z_(jy.get(y)||null,t,e,n,l,d)),!0}return!1}function kO(t){var e=of(t.target);if(e!==null){var n=Nm(e);if(n!==null){if(e=n.tag,e===13){if(e=dL(n),e!==null){t.blockedOn=e,jV(t.priority,function(){if(n.tag===13){var l=fo(),d=Bh(n,l);d!==null&&Ca(d,n,l),XS(n,l)}});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Nx(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=TE(t.nativeEvent);if(n===null){n=t.nativeEvent;var l=new n.constructor(n.type,n);j2=l,n.target.dispatchEvent(l),j2=null}else return e=Bm(n),e!==null&&zO(e),t.blockedOn=n,!1;e.shift()}return!0}function KD(t,e,n){Nx(t)&&n.delete(e)}function XU(){EE=!1,Dh!==null&&Nx(Dh)&&(Dh=null),Ph!==null&&Nx(Ph)&&(Ph=null),Lh!==null&&Nx(Lh)&&(Lh=null),Uy.forEach(KD),jy.forEach(KD)}function mx(t,e){t.blockedOn===e&&(t.blockedOn=null,EE||(EE=!0,ys.unstable_scheduleCallback(ys.unstable_NormalPriority,XU)))}var gx=null;function QD(t){gx!==t&&(gx=t,ys.unstable_scheduleCallback(ys.unstable_NormalPriority,function(){gx===t&&(gx=null);for(var e=0;e<t.length;e+=3){var n=t[e],l=t[e+1],d=t[e+2];if(typeof l!="function"){if(KS(l||n)===null)continue;break}var y=Bm(n);y!==null&&(t.splice(e,3),e-=3,Q2(y,{pending:!0,data:d,method:n.method,action:l},l,d))}}))}function qy(t){function e(N){return mx(N,t)}Dh!==null&&mx(Dh,t),Ph!==null&&mx(Ph,t),Lh!==null&&mx(Lh,t),Uy.forEach(e),jy.forEach(e);for(var n=0;n<yh.length;n++){var l=yh[n];l.blockedOn===t&&(l.blockedOn=null)}for(;0<yh.length&&(n=yh[0],n.blockedOn===null);)kO(n),n.blockedOn===null&&yh.shift();if(n=(t.ownerDocument||t).$$reactFormReplay,n!=null)for(l=0;l<n.length;l+=3){var d=n[l],y=n[l+1],A=d[qa]||null;if(typeof y=="function")A||QD(n);else if(A){var s=null;if(y&&y.hasAttribute("formAction")){if(d=y,A=y[qa]||null)s=A.formAction;else if(KS(d)!==null)continue}else s=A.action;typeof s=="function"?n[l+1]=s:(n.splice(l,3),l-=3),QD(n)}}}function QS(t){this._internalRoot=t}hb.prototype.render=QS.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(Vt(409));var n=e.current,l=fo();LO(n,l,t,e,null,null)};hb.prototype.unmount=QS.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;t.tag===0&&pm(),LO(t.current,2,null,t,null,null),lb(),e[Fm]=null}};function hb(t){this._internalRoot=t}hb.prototype.unstable_scheduleHydration=function(t){if(t){var e=wL();t={blockedOn:null,target:t,priority:e};for(var n=0;n<yh.length&&e!==0&&e<yh[n].priority;n++);yh.splice(n,0,t),n===0&&kO(t)}};var JD=oL.version;if(JD!=="19.0.0")throw Error(Vt(527,JD,"19.0.0"));_r.findDOMNode=function(t){var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(Vt(188)):(t=Object.keys(t).join(","),Error(Vt(268,t)));return t=CV(e),t=t!==null?fL(t):null,t=t===null?null:t.stateNode,t};var YU={bundleType:0,version:"19.0.0",rendererPackageName:"react-dom",currentDispatcherRef:nn,findFiberByHostInstance:of,reconcilerVersion:"19.0.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var _x=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!_x.isDisabled&&_x.supportsFiber)try{t0=_x.inject(YU),uo=_x}catch{}}Y1.createRoot=function(t,e){if(!lL(t))throw Error(Vt(299));var n=!1,l="",d=Lz,y=zz,A=Oz,s=null;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(l=e.identifierPrefix),e.onUncaughtError!==void 0&&(d=e.onUncaughtError),e.onCaughtError!==void 0&&(y=e.onCaughtError),e.onRecoverableError!==void 0&&(A=e.onRecoverableError),e.unstable_transitionCallbacks!==void 0&&(s=e.unstable_transitionCallbacks)),e=DO(t,1,!1,null,null,n,l,d,y,A,s,null),t[Fm]=e.current,$S(t.nodeType===8?t.parentNode:t),new QS(e)};Y1.hydrateRoot=function(t,e,n){if(!lL(t))throw Error(Vt(299));var l=!1,d="",y=Lz,A=zz,s=Oz,N=null,j=null;return n!=null&&(n.unstable_strictMode===!0&&(l=!0),n.identifierPrefix!==void 0&&(d=n.identifierPrefix),n.onUncaughtError!==void 0&&(y=n.onUncaughtError),n.onCaughtError!==void 0&&(A=n.onCaughtError),n.onRecoverableError!==void 0&&(s=n.onRecoverableError),n.unstable_transitionCallbacks!==void 0&&(N=n.unstable_transitionCallbacks),n.formState!==void 0&&(j=n.formState)),e=DO(t,1,!0,e,n??null,l,d,y,A,s,N,j),e.context=PO(null),n=e.current,l=fo(),d=Ih(l),d.callback=null,Mh(n,d,l),e.current.lanes=l,n0(e,l),pc(e),t[Fm]=e.current,$S(t),new hb(e)};Y1.version="19.0.0";function NO(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(NO)}catch(t){console.error(t)}}NO(),tL.exports=Y1;var KU=tL.exports;const QU=tS(KU),JU="modulepreload",ej=function(t){return"/swiftdrop_uc/"+t},eP={},tj=function(e,n,l){if(!n||n.length===0)return e();const d=document.getElementsByTagName("link");return Promise.all(n.map(y=>{if(y=ej(y),y in eP)return;eP[y]=!0;const A=y.endsWith(".css"),s=A?'[rel="stylesheet"]':"";if(!!l)for(let K=d.length-1;K>=0;K--){const se=d[K];if(se.href===y&&(!A||se.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${y}"]${s}`))return;const j=document.createElement("link");if(j.rel=A?"stylesheet":JU,A||(j.as="script",j.crossOrigin=""),j.href=y,document.head.appendChild(j),A)return new Promise((K,se)=>{j.addEventListener("load",K),j.addEventListener("error",()=>se(new Error(`Unable to preload CSS for ${y}`)))})})).then(()=>e()).catch(y=>{const A=new Event("vite:preloadError",{cancelable:!0});if(A.payload=y,window.dispatchEvent(A),!A.defaultPrevented)throw y})};var JS={};Object.defineProperty(JS,"__esModule",{value:!0});JS.parse=lj;JS.serialize=cj;const ij=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,nj=/^[\u0021-\u003A\u003C-\u007E]*$/,rj=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,sj=/^[\u0020-\u003A\u003D-\u007E]*$/,aj=Object.prototype.toString,oj=(()=>{const t=function(){};return t.prototype=Object.create(null),t})();function lj(t,e){const n=new oj,l=t.length;if(l<2)return n;const d=(e==null?void 0:e.decode)||uj;let y=0;do{const A=t.indexOf("=",y);if(A===-1)break;const s=t.indexOf(";",y),N=s===-1?l:s;if(A>N){y=t.lastIndexOf(";",A-1)+1;continue}const j=tP(t,y,A),K=iP(t,A,j),se=t.slice(j,K);if(n[se]===void 0){let ae=tP(t,A+1,N),me=iP(t,N,ae);const Ue=d(t.slice(ae,me));n[se]=Ue}y=N+1}while(y<l);return n}function tP(t,e,n){do{const l=t.charCodeAt(e);if(l!==32&&l!==9)return e}while(++e<n);return n}function iP(t,e,n){for(;e>n;){const l=t.charCodeAt(--e);if(l!==32&&l!==9)return e+1}return n}function cj(t,e,n){const l=(n==null?void 0:n.encode)||encodeURIComponent;if(!ij.test(t))throw new TypeError(`argument name is invalid: ${t}`);const d=l(e);if(!nj.test(d))throw new TypeError(`argument val is invalid: ${e}`);let y=t+"="+d;if(!n)return y;if(n.maxAge!==void 0){if(!Number.isInteger(n.maxAge))throw new TypeError(`option maxAge is invalid: ${n.maxAge}`);y+="; Max-Age="+n.maxAge}if(n.domain){if(!rj.test(n.domain))throw new TypeError(`option domain is invalid: ${n.domain}`);y+="; Domain="+n.domain}if(n.path){if(!sj.test(n.path))throw new TypeError(`option path is invalid: ${n.path}`);y+="; Path="+n.path}if(n.expires){if(!hj(n.expires)||!Number.isFinite(n.expires.valueOf()))throw new TypeError(`option expires is invalid: ${n.expires}`);y+="; Expires="+n.expires.toUTCString()}if(n.httpOnly&&(y+="; HttpOnly"),n.secure&&(y+="; Secure"),n.partitioned&&(y+="; Partitioned"),n.priority)switch(typeof n.priority=="string"?n.priority.toLowerCase():void 0){case"low":y+="; Priority=Low";break;case"medium":y+="; Priority=Medium";break;case"high":y+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${n.priority}`)}if(n.sameSite)switch(typeof n.sameSite=="string"?n.sameSite.toLowerCase():n.sameSite){case!0:case"strict":y+="; SameSite=Strict";break;case"lax":y+="; SameSite=Lax";break;case"none":y+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${n.sameSite}`)}return y}function uj(t){if(t.indexOf("%")===-1)return t;try{return decodeURIComponent(t)}catch{return t}}function hj(t){return aj.call(t)==="[object Date]"}var nP="popstate";function dj(t={}){function e(l,d){let{pathname:y,search:A,hash:s}=l.location;return SE("",{pathname:y,search:A,hash:s},d.state&&d.state.usr||null,d.state&&d.state.key||"default")}function n(l,d){return typeof d=="string"?d:Gy(d)}return pj(e,n,null,t)}function Er(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function wl(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function fj(){return Math.random().toString(36).substring(2,10)}function rP(t,e){return{usr:t.state,key:t.key,idx:e}}function SE(t,e,n=null,l){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof e=="string"?qm(e):e,state:n,key:e&&e.key||l||fj()}}function Gy({pathname:t="/",search:e="",hash:n=""}){return e&&e!=="?"&&(t+=e.charAt(0)==="?"?e:"?"+e),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function qm(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substring(n),t=t.substring(0,n));let l=t.indexOf("?");l>=0&&(e.search=t.substring(l),t=t.substring(0,l)),t&&(e.pathname=t)}return e}function pj(t,e,n,l={}){let{window:d=document.defaultView,v5Compat:y=!1}=l,A=d.history,s="POP",N=null,j=K();j==null&&(j=0,A.replaceState({...A.state,idx:j},""));function K(){return(A.state||{idx:null}).idx}function se(){s="POP";let it=K(),be=it==null?null:it-j;j=it,N&&N({action:s,location:Xe.location,delta:be})}function ae(it,be){s="PUSH";let Ee=SE(Xe.location,it,be);n&&n(Ee,it),j=K()+1;let Ce=rP(Ee,j),We=Xe.createHref(Ee);try{A.pushState(Ce,"",We)}catch(Ct){if(Ct instanceof DOMException&&Ct.name==="DataCloneError")throw Ct;d.location.assign(We)}y&&N&&N({action:s,location:Xe.location,delta:1})}function me(it,be){s="REPLACE";let Ee=SE(Xe.location,it,be);n&&n(Ee,it),j=K();let Ce=rP(Ee,j),We=Xe.createHref(Ee);A.replaceState(Ce,"",We),y&&N&&N({action:s,location:Xe.location,delta:0})}function Ue(it){let be=d.location.origin!=="null"?d.location.origin:d.location.href,Ee=typeof it=="string"?it:Gy(it);return Ee=Ee.replace(/ $/,"%20"),Er(be,`No window.location.(origin|href) available to create URL for href: ${Ee}`),new URL(Ee,be)}let Xe={get action(){return s},get location(){return t(d,A)},listen(it){if(N)throw new Error("A history only accepts one active listener");return d.addEventListener(nP,se),N=it,()=>{d.removeEventListener(nP,se),N=null}},createHref(it){return e(d,it)},createURL:Ue,encodeLocation(it){let be=Ue(it);return{pathname:be.pathname,search:be.search,hash:be.hash}},push:ae,replace:me,go(it){return A.go(it)}};return Xe}function FO(t,e,n="/"){return mj(t,e,n,!1)}function mj(t,e,n,l){let d=typeof e=="string"?qm(e):e,y=qh(d.pathname||"/",n);if(y==null)return null;let A=BO(t);gj(A);let s=null;for(let N=0;s==null&&N<A.length;++N){let j=Ij(y);s=Sj(A[N],j,l)}return s}function BO(t,e=[],n=[],l=""){let d=(y,A,s)=>{let N={relativePath:s===void 0?y.path||"":s,caseSensitive:y.caseSensitive===!0,childrenIndex:A,route:y};N.relativePath.startsWith("/")&&(Er(N.relativePath.startsWith(l),`Absolute route path "${N.relativePath}" nested under path "${l}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),N.relativePath=N.relativePath.slice(l.length));let j=uu([l,N.relativePath]),K=n.concat(N);y.children&&y.children.length>0&&(Er(y.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${j}".`),BO(y.children,e,K,j)),!(y.path==null&&!y.index)&&e.push({path:j,score:Tj(j,y.index),routesMeta:K})};return t.forEach((y,A)=>{var s;if(y.path===""||!((s=y.path)!=null&&s.includes("?")))d(y,A);else for(let N of VO(y.path))d(y,A,N)}),e}function VO(t){let e=t.split("/");if(e.length===0)return[];let[n,...l]=e,d=n.endsWith("?"),y=n.replace(/\?$/,"");if(l.length===0)return d?[y,""]:[y];let A=VO(l.join("/")),s=[];return s.push(...A.map(N=>N===""?y:[y,N].join("/"))),d&&s.push(...A),s.map(N=>t.startsWith("/")&&N===""?"/":N)}function gj(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:Ej(e.routesMeta.map(l=>l.childrenIndex),n.routesMeta.map(l=>l.childrenIndex)))}var _j=/^:[\w-]+$/,yj=3,vj=2,xj=1,bj=10,wj=-2,sP=t=>t==="*";function Tj(t,e){let n=t.split("/"),l=n.length;return n.some(sP)&&(l+=wj),e&&(l+=vj),n.filter(d=>!sP(d)).reduce((d,y)=>d+(_j.test(y)?yj:y===""?xj:bj),l)}function Ej(t,e){return t.length===e.length&&t.slice(0,-1).every((l,d)=>l===e[d])?t[t.length-1]-e[e.length-1]:0}function Sj(t,e,n=!1){let{routesMeta:l}=t,d={},y="/",A=[];for(let s=0;s<l.length;++s){let N=l[s],j=s===l.length-1,K=y==="/"?e:e.slice(y.length)||"/",se=S1({path:N.relativePath,caseSensitive:N.caseSensitive,end:j},K),ae=N.route;if(!se&&j&&n&&!l[l.length-1].route.index&&(se=S1({path:N.relativePath,caseSensitive:N.caseSensitive,end:!1},K)),!se)return null;Object.assign(d,se.params),A.push({params:d,pathname:uu([y,se.pathname]),pathnameBase:Dj(uu([y,se.pathnameBase])),route:ae}),se.pathnameBase!=="/"&&(y=uu([y,se.pathnameBase]))}return A}function S1(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,l]=Aj(t.path,t.caseSensitive,t.end),d=e.match(n);if(!d)return null;let y=d[0],A=y.replace(/(.)\/+$/,"$1"),s=d.slice(1);return{params:l.reduce((j,{paramName:K,isOptional:se},ae)=>{if(K==="*"){let Ue=s[ae]||"";A=y.slice(0,y.length-Ue.length).replace(/(.)\/+$/,"$1")}const me=s[ae];return se&&!me?j[K]=void 0:j[K]=(me||"").replace(/%2F/g,"/"),j},{}),pathname:y,pathnameBase:A,pattern:t}}function Aj(t,e=!1,n=!0){wl(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let l=[],d="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(A,s,N)=>(l.push({paramName:s,isOptional:N!=null}),N?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(l.push({paramName:"*"}),d+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?d+="\\/*$":t!==""&&t!=="/"&&(d+="(?:(?=\\/|$))"),[new RegExp(d,e?void 0:"i"),l]}function Ij(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return wl(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),t}}function qh(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,l=t.charAt(n);return l&&l!=="/"?null:t.slice(n)||"/"}function Mj(t,e="/"){let{pathname:n,search:l="",hash:d=""}=typeof t=="string"?qm(t):t;return{pathname:n?n.startsWith("/")?n:Cj(n,e):e,search:Pj(l),hash:Lj(d)}}function Cj(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(d=>{d===".."?n.length>1&&n.pop():d!=="."&&n.push(d)}),n.length>1?n.join("/"):"/"}function g2(t,e,n,l){return`Cannot include a '${t}' character in a manually specified \`to.${e}\` field [${JSON.stringify(l)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function Rj(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function eA(t){let e=Rj(t);return e.map((n,l)=>l===e.length-1?n.pathname:n.pathnameBase)}function tA(t,e,n,l=!1){let d;typeof t=="string"?d=qm(t):(d={...t},Er(!d.pathname||!d.pathname.includes("?"),g2("?","pathname","search",d)),Er(!d.pathname||!d.pathname.includes("#"),g2("#","pathname","hash",d)),Er(!d.search||!d.search.includes("#"),g2("#","search","hash",d)));let y=t===""||d.pathname==="",A=y?"/":d.pathname,s;if(A==null)s=n;else{let se=e.length-1;if(!l&&A.startsWith("..")){let ae=A.split("/");for(;ae[0]==="..";)ae.shift(),se-=1;d.pathname=ae.join("/")}s=se>=0?e[se]:"/"}let N=Mj(d,s),j=A&&A!=="/"&&A.endsWith("/"),K=(y||A===".")&&n.endsWith("/");return!N.pathname.endsWith("/")&&(j||K)&&(N.pathname+="/"),N}var uu=t=>t.join("/").replace(/\/\/+/g,"/"),Dj=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),Pj=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,Lj=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function zj(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}var UO=["POST","PUT","PATCH","DELETE"];new Set(UO);var Oj=["GET",...UO];new Set(Oj);var Gm=ot.createContext(null);Gm.displayName="DataRouter";var db=ot.createContext(null);db.displayName="DataRouterState";var jO=ot.createContext({isTransitioning:!1});jO.displayName="ViewTransition";var kj=ot.createContext(new Map);kj.displayName="Fetchers";var Nj=ot.createContext(null);Nj.displayName="Await";var Il=ot.createContext(null);Il.displayName="Navigation";var f0=ot.createContext(null);f0.displayName="Location";var mc=ot.createContext({outlet:null,matches:[],isDataRoute:!1});mc.displayName="Route";var iA=ot.createContext(null);iA.displayName="RouteError";function Fj(t,{relative:e}={}){Er(Hm(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:l}=ot.useContext(Il),{hash:d,pathname:y,search:A}=p0(t,{relative:e}),s=y;return n!=="/"&&(s=y==="/"?n:uu([n,y])),l.createHref({pathname:s,search:A,hash:d})}function Hm(){return ot.useContext(f0)!=null}function Tu(){return Er(Hm(),"useLocation() may be used only in the context of a <Router> component."),ot.useContext(f0).location}var qO="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function GO(t){ot.useContext(Il).static||ot.useLayoutEffect(t)}function $m(){let{isDataRoute:t}=ot.useContext(mc);return t?Kj():Bj()}function Bj(){Er(Hm(),"useNavigate() may be used only in the context of a <Router> component.");let t=ot.useContext(Gm),{basename:e,navigator:n}=ot.useContext(Il),{matches:l}=ot.useContext(mc),{pathname:d}=Tu(),y=JSON.stringify(eA(l)),A=ot.useRef(!1);return GO(()=>{A.current=!0}),ot.useCallback((N,j={})=>{if(wl(A.current,qO),!A.current)return;if(typeof N=="number"){n.go(N);return}let K=tA(N,JSON.parse(y),d,j.relative==="path");t==null&&e!=="/"&&(K.pathname=K.pathname==="/"?e:uu([e,K.pathname])),(j.replace?n.replace:n.push)(K,j.state,j)},[e,n,y,d,t])}ot.createContext(null);function p0(t,{relative:e}={}){let{matches:n}=ot.useContext(mc),{pathname:l}=Tu(),d=JSON.stringify(eA(n));return ot.useMemo(()=>tA(t,JSON.parse(d),l,e==="path"),[t,d,l,e])}function Vj(t,e){return HO(t,e)}function HO(t,e,n,l){var Ee;Er(Hm(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:d,static:y}=ot.useContext(Il),{matches:A}=ot.useContext(mc),s=A[A.length-1],N=s?s.params:{},j=s?s.pathname:"/",K=s?s.pathnameBase:"/",se=s&&s.route;{let Ce=se&&se.path||"";$O(j,!se||Ce.endsWith("*")||Ce.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${j}" (under <Route path="${Ce}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${Ce}"> to <Route path="${Ce==="/"?"*":`${Ce}/*`}">.`)}let ae=Tu(),me;if(e){let Ce=typeof e=="string"?qm(e):e;Er(K==="/"||((Ee=Ce.pathname)==null?void 0:Ee.startsWith(K)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${K}" but pathname "${Ce.pathname}" was given in the \`location\` prop.`),me=Ce}else me=ae;let Ue=me.pathname||"/",Xe=Ue;if(K!=="/"){let Ce=K.replace(/^\//,"").split("/");Xe="/"+Ue.replace(/^\//,"").split("/").slice(Ce.length).join("/")}let it=!y&&n&&n.matches&&n.matches.length>0?n.matches:FO(t,{pathname:Xe});wl(se||it!=null,`No routes matched location "${me.pathname}${me.search}${me.hash}" `),wl(it==null||it[it.length-1].route.element!==void 0||it[it.length-1].route.Component!==void 0||it[it.length-1].route.lazy!==void 0,`Matched leaf route at location "${me.pathname}${me.search}${me.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let be=Hj(it&&it.map(Ce=>Object.assign({},Ce,{params:Object.assign({},N,Ce.params),pathname:uu([K,d.encodeLocation?d.encodeLocation(Ce.pathname).pathname:Ce.pathname]),pathnameBase:Ce.pathnameBase==="/"?K:uu([K,d.encodeLocation?d.encodeLocation(Ce.pathnameBase).pathname:Ce.pathnameBase])})),A,n,l);return e&&be?ot.createElement(f0.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...me},navigationType:"POP"}},be):be}function Uj(){let t=Yj(),e=zj(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,l="rgba(200,200,200, 0.5)",d={padding:"0.5rem",backgroundColor:l},y={padding:"2px 4px",backgroundColor:l},A=null;return console.error("Error handled by React Router default ErrorBoundary:",t),A=ot.createElement(ot.Fragment,null,ot.createElement("p",null,"💿 Hey developer 👋"),ot.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",ot.createElement("code",{style:y},"ErrorBoundary")," or"," ",ot.createElement("code",{style:y},"errorElement")," prop on your route.")),ot.createElement(ot.Fragment,null,ot.createElement("h2",null,"Unexpected Application Error!"),ot.createElement("h3",{style:{fontStyle:"italic"}},e),n?ot.createElement("pre",{style:d},n):null,A)}var jj=ot.createElement(Uj,null),qj=class extends ot.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||e.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){console.error("React Router caught the following error during render",t,e)}render(){return this.state.error!==void 0?ot.createElement(mc.Provider,{value:this.props.routeContext},ot.createElement(iA.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function Gj({routeContext:t,match:e,children:n}){let l=ot.useContext(Gm);return l&&l.static&&l.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(l.staticContext._deepestRenderedBoundaryId=e.route.id),ot.createElement(mc.Provider,{value:t},n)}function Hj(t,e=[],n=null,l=null){if(t==null){if(!n)return null;if(n.errors)t=n.matches;else if(e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let d=t,y=n==null?void 0:n.errors;if(y!=null){let N=d.findIndex(j=>j.route.id&&(y==null?void 0:y[j.route.id])!==void 0);Er(N>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(y).join(",")}`),d=d.slice(0,Math.min(d.length,N+1))}let A=!1,s=-1;if(n)for(let N=0;N<d.length;N++){let j=d[N];if((j.route.HydrateFallback||j.route.hydrateFallbackElement)&&(s=N),j.route.id){let{loaderData:K,errors:se}=n,ae=j.route.loader&&!K.hasOwnProperty(j.route.id)&&(!se||se[j.route.id]===void 0);if(j.route.lazy||ae){A=!0,s>=0?d=d.slice(0,s+1):d=[d[0]];break}}}return d.reduceRight((N,j,K)=>{let se,ae=!1,me=null,Ue=null;n&&(se=y&&j.route.id?y[j.route.id]:void 0,me=j.route.errorElement||jj,A&&(s<0&&K===0?($O("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),ae=!0,Ue=null):s===K&&(ae=!0,Ue=j.route.hydrateFallbackElement||null)));let Xe=e.concat(d.slice(0,K+1)),it=()=>{let be;return se?be=me:ae?be=Ue:j.route.Component?be=ot.createElement(j.route.Component,null):j.route.element?be=j.route.element:be=N,ot.createElement(Gj,{match:j,routeContext:{outlet:N,matches:Xe,isDataRoute:n!=null},children:be})};return n&&(j.route.ErrorBoundary||j.route.errorElement||K===0)?ot.createElement(qj,{location:n.location,revalidation:n.revalidation,component:me,error:se,children:it(),routeContext:{outlet:null,matches:Xe,isDataRoute:!0}}):it()},null)}function nA(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function $j(t){let e=ot.useContext(Gm);return Er(e,nA(t)),e}function Zj(t){let e=ot.useContext(db);return Er(e,nA(t)),e}function Wj(t){let e=ot.useContext(mc);return Er(e,nA(t)),e}function rA(t){let e=Wj(t),n=e.matches[e.matches.length-1];return Er(n.route.id,`${t} can only be used on routes that contain a unique "id"`),n.route.id}function Xj(){return rA("useRouteId")}function Yj(){var l;let t=ot.useContext(iA),e=Zj("useRouteError"),n=rA("useRouteError");return t!==void 0?t:(l=e.errors)==null?void 0:l[n]}function Kj(){let{router:t}=$j("useNavigate"),e=rA("useNavigate"),n=ot.useRef(!1);return GO(()=>{n.current=!0}),ot.useCallback(async(d,y={})=>{wl(n.current,qO),n.current&&(typeof d=="number"?t.navigate(d):await t.navigate(d,{fromRouteId:e,...y}))},[t,e])}var aP={};function $O(t,e,n){!e&&!aP[t]&&(aP[t]=!0,wl(!1,n))}ot.memo(Qj);function Qj({routes:t,future:e,state:n}){return HO(t,void 0,n,e)}function Jj({to:t,replace:e,state:n,relative:l}){Er(Hm(),"<Navigate> may be used only in the context of a <Router> component.");let{static:d}=ot.useContext(Il);wl(!d,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:y}=ot.useContext(mc),{pathname:A}=Tu(),s=$m(),N=tA(t,eA(y),A,l==="path"),j=JSON.stringify(N);return ot.useEffect(()=>{s(JSON.parse(j),{replace:e,state:n,relative:l})},[s,j,l,e,n]),null}function Yc(t){Er(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function e8({basename:t="/",children:e=null,location:n,navigationType:l="POP",navigator:d,static:y=!1}){Er(!Hm(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let A=t.replace(/^\/*/,"/"),s=ot.useMemo(()=>({basename:A,navigator:d,static:y,future:{}}),[A,d,y]);typeof n=="string"&&(n=qm(n));let{pathname:N="/",search:j="",hash:K="",state:se=null,key:ae="default"}=n,me=ot.useMemo(()=>{let Ue=qh(N,A);return Ue==null?null:{location:{pathname:Ue,search:j,hash:K,state:se,key:ae},navigationType:l}},[A,N,j,K,se,ae,l]);return wl(me!=null,`<Router basename="${A}"> is not able to match the URL "${N}${j}${K}" because it does not start with the basename, so the <Router> won't render anything.`),me==null?null:ot.createElement(Il.Provider,{value:s},ot.createElement(f0.Provider,{children:e,value:me}))}function t8({children:t,location:e}){return Vj(AE(t),e)}function AE(t,e=[]){let n=[];return ot.Children.forEach(t,(l,d)=>{if(!ot.isValidElement(l))return;let y=[...e,d];if(l.type===ot.Fragment){n.push.apply(n,AE(l.props.children,y));return}Er(l.type===Yc,`[${typeof l.type=="string"?l.type:l.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Er(!l.props.index||!l.props.children,"An index route cannot have child routes.");let A={id:l.props.id||y.join("-"),caseSensitive:l.props.caseSensitive,element:l.props.element,Component:l.props.Component,index:l.props.index,path:l.props.path,loader:l.props.loader,action:l.props.action,hydrateFallbackElement:l.props.hydrateFallbackElement,HydrateFallback:l.props.HydrateFallback,errorElement:l.props.errorElement,ErrorBoundary:l.props.ErrorBoundary,hasErrorBoundary:l.props.hasErrorBoundary===!0||l.props.ErrorBoundary!=null||l.props.errorElement!=null,shouldRevalidate:l.props.shouldRevalidate,handle:l.props.handle,lazy:l.props.lazy};l.props.children&&(A.children=AE(l.props.children,y)),n.push(A)}),n}var Fx="get",Bx="application/x-www-form-urlencoded";function fb(t){return t!=null&&typeof t.tagName=="string"}function i8(t){return fb(t)&&t.tagName.toLowerCase()==="button"}function n8(t){return fb(t)&&t.tagName.toLowerCase()==="form"}function r8(t){return fb(t)&&t.tagName.toLowerCase()==="input"}function s8(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function a8(t,e){return t.button===0&&(!e||e==="_self")&&!s8(t)}var yx=null;function o8(){if(yx===null)try{new FormData(document.createElement("form"),0),yx=!1}catch{yx=!0}return yx}var l8=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function _2(t){return t!=null&&!l8.has(t)?(wl(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Bx}"`),null):t}function c8(t,e){let n,l,d,y,A;if(n8(t)){let s=t.getAttribute("action");l=s?qh(s,e):null,n=t.getAttribute("method")||Fx,d=_2(t.getAttribute("enctype"))||Bx,y=new FormData(t)}else if(i8(t)||r8(t)&&(t.type==="submit"||t.type==="image")){let s=t.form;if(s==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let N=t.getAttribute("formaction")||s.getAttribute("action");if(l=N?qh(N,e):null,n=t.getAttribute("formmethod")||s.getAttribute("method")||Fx,d=_2(t.getAttribute("formenctype"))||_2(s.getAttribute("enctype"))||Bx,y=new FormData(s,t),!o8()){let{name:j,type:K,value:se}=t;if(K==="image"){let ae=j?`${j}.`:"";y.append(`${ae}x`,"0"),y.append(`${ae}y`,"0")}else j&&y.append(j,se)}}else{if(fb(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=Fx,l=null,d=Bx,A=t}return y&&d==="text/plain"&&(A=y,y=void 0),{action:l,method:n.toLowerCase(),encType:d,formData:y,body:A}}function sA(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}async function u8(t,e){if(t.id in e)return e[t.id];try{let n=await tj(()=>import(t.module),[]);return e[t.id]=n,n}catch(n){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function h8(t){return t!=null&&typeof t.page=="string"}function d8(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function f8(t,e,n){let l=await Promise.all(t.map(async d=>{let y=e.routes[d.route.id];if(y){let A=await u8(y,n);return A.links?A.links():[]}return[]}));return _8(l.flat(1).filter(d8).filter(d=>d.rel==="stylesheet"||d.rel==="preload").map(d=>d.rel==="stylesheet"?{...d,rel:"prefetch",as:"style"}:{...d,rel:"prefetch"}))}function oP(t,e,n,l,d,y){let A=(N,j)=>n[j]?N.route.id!==n[j].route.id:!0,s=(N,j)=>{var K;return n[j].pathname!==N.pathname||((K=n[j].route.path)==null?void 0:K.endsWith("*"))&&n[j].params["*"]!==N.params["*"]};return y==="assets"?e.filter((N,j)=>A(N,j)||s(N,j)):y==="data"?e.filter((N,j)=>{var se;let K=l.routes[N.route.id];if(!K||!K.hasLoader)return!1;if(A(N,j)||s(N,j))return!0;if(N.route.shouldRevalidate){let ae=N.route.shouldRevalidate({currentUrl:new URL(d.pathname+d.search+d.hash,window.origin),currentParams:((se=n[0])==null?void 0:se.params)||{},nextUrl:new URL(t,window.origin),nextParams:N.params,defaultShouldRevalidate:!0});if(typeof ae=="boolean")return ae}return!0}):[]}function p8(t,e,{includeHydrateFallback:n}={}){return m8(t.map(l=>{let d=e.routes[l.route.id];if(!d)return[];let y=[d.module];return d.clientActionModule&&(y=y.concat(d.clientActionModule)),d.clientLoaderModule&&(y=y.concat(d.clientLoaderModule)),n&&d.hydrateFallbackModule&&(y=y.concat(d.hydrateFallbackModule)),d.imports&&(y=y.concat(d.imports)),y}).flat(1))}function m8(t){return[...new Set(t)]}function g8(t){let e={},n=Object.keys(t).sort();for(let l of n)e[l]=t[l];return e}function _8(t,e){let n=new Set,l=new Set(e);return t.reduce((d,y)=>{if(e&&!h8(y)&&y.as==="script"&&y.href&&l.has(y.href))return d;let s=JSON.stringify(g8(y));return n.has(s)||(n.add(s),d.push({key:s,link:y})),d},[])}function y8(t){let e=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return e.pathname==="/"?e.pathname="_root.data":e.pathname=`${e.pathname.replace(/\/$/,"")}.data`,e}function v8(){let t=ot.useContext(Gm);return sA(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function x8(){let t=ot.useContext(db);return sA(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var aA=ot.createContext(void 0);aA.displayName="FrameworkContext";function ZO(){let t=ot.useContext(aA);return sA(t,"You must render this element inside a <HydratedRouter> element"),t}function b8(t,e){let n=ot.useContext(aA),[l,d]=ot.useState(!1),[y,A]=ot.useState(!1),{onFocus:s,onBlur:N,onMouseEnter:j,onMouseLeave:K,onTouchStart:se}=e,ae=ot.useRef(null);ot.useEffect(()=>{if(t==="render"&&A(!0),t==="viewport"){let Xe=be=>{be.forEach(Ee=>{A(Ee.isIntersecting)})},it=new IntersectionObserver(Xe,{threshold:.5});return ae.current&&it.observe(ae.current),()=>{it.disconnect()}}},[t]),ot.useEffect(()=>{if(l){let Xe=setTimeout(()=>{A(!0)},100);return()=>{clearTimeout(Xe)}}},[l]);let me=()=>{d(!0)},Ue=()=>{d(!1),A(!1)};return n?t!=="intent"?[y,ae,{}]:[y,ae,{onFocus:W_(s,me),onBlur:W_(N,Ue),onMouseEnter:W_(j,me),onMouseLeave:W_(K,Ue),onTouchStart:W_(se,me)}]:[!1,ae,{}]}function W_(t,e){return n=>{t&&t(n),n.defaultPrevented||e(n)}}function w8({page:t,...e}){let{router:n}=v8(),l=ot.useMemo(()=>FO(n.routes,t,n.basename),[n.routes,t,n.basename]);return l?ot.createElement(E8,{page:t,matches:l,...e}):null}function T8(t){let{manifest:e,routeModules:n}=ZO(),[l,d]=ot.useState([]);return ot.useEffect(()=>{let y=!1;return f8(t,e,n).then(A=>{y||d(A)}),()=>{y=!0}},[t,e,n]),l}function E8({page:t,matches:e,...n}){let l=Tu(),{manifest:d,routeModules:y}=ZO(),{loaderData:A,matches:s}=x8(),N=ot.useMemo(()=>oP(t,e,s,d,l,"data"),[t,e,s,d,l]),j=ot.useMemo(()=>oP(t,e,s,d,l,"assets"),[t,e,s,d,l]),K=ot.useMemo(()=>{if(t===l.pathname+l.search+l.hash)return[];let me=new Set,Ue=!1;if(e.forEach(it=>{var Ee;let be=d.routes[it.route.id];!be||!be.hasLoader||(!N.some(Ce=>Ce.route.id===it.route.id)&&it.route.id in A&&((Ee=y[it.route.id])!=null&&Ee.shouldRevalidate)||be.hasClientLoader?Ue=!0:me.add(it.route.id))}),me.size===0)return[];let Xe=y8(t);return Ue&&me.size>0&&Xe.searchParams.set("_routes",e.filter(it=>me.has(it.route.id)).map(it=>it.route.id).join(",")),[Xe.pathname+Xe.search]},[A,l,d,N,e,t,y]),se=ot.useMemo(()=>p8(j,d),[j,d]),ae=T8(j);return ot.createElement(ot.Fragment,null,K.map(me=>ot.createElement("link",{key:me,rel:"prefetch",as:"fetch",href:me,...n})),se.map(me=>ot.createElement("link",{key:me,rel:"modulepreload",href:me,...n})),ae.map(({key:me,link:Ue})=>ot.createElement("link",{key:me,...Ue})))}function S8(...t){return e=>{t.forEach(n=>{typeof n=="function"?n(e):n!=null&&(n.current=e)})}}var WO=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{WO&&(window.__reactRouterVersion="7.2.0")}catch{}function A8({basename:t,children:e,window:n}){let l=ot.useRef();l.current==null&&(l.current=dj({window:n,v5Compat:!0}));let d=l.current,[y,A]=ot.useState({action:d.action,location:d.location}),s=ot.useCallback(N=>{ot.startTransition(()=>A(N))},[A]);return ot.useLayoutEffect(()=>d.listen(s),[d,s]),ot.createElement(e8,{basename:t,children:e,location:y.location,navigationType:y.action,navigator:d})}var XO=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,es=ot.forwardRef(function({onClick:e,discover:n="render",prefetch:l="none",relative:d,reloadDocument:y,replace:A,state:s,target:N,to:j,preventScrollReset:K,viewTransition:se,...ae},me){let{basename:Ue}=ot.useContext(Il),Xe=typeof j=="string"&&XO.test(j),it,be=!1;if(typeof j=="string"&&Xe&&(it=j,WO))try{let Ve=new URL(window.location.href),De=j.startsWith("//")?new URL(Ve.protocol+j):new URL(j),je=qh(De.pathname,Ue);De.origin===Ve.origin&&je!=null?j=je+De.search+De.hash:be=!0}catch{wl(!1,`<Link to="${j}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let Ee=Fj(j,{relative:d}),[Ce,We,Ct]=b8(l,ae),Ut=R8(j,{replace:A,state:s,target:N,preventScrollReset:K,relative:d,viewTransition:se});function we(Ve){e&&e(Ve),Ve.defaultPrevented||Ut(Ve)}let Ae=ot.createElement("a",{...ae,...Ct,href:it||Ee,onClick:be||y?e:we,ref:S8(me,We),target:N,"data-discover":!Xe&&n==="render"?"true":void 0});return Ce&&!Xe?ot.createElement(ot.Fragment,null,Ae,ot.createElement(w8,{page:Ee})):Ae});es.displayName="Link";var I8=ot.forwardRef(function({"aria-current":e="page",caseSensitive:n=!1,className:l="",end:d=!1,style:y,to:A,viewTransition:s,children:N,...j},K){let se=p0(A,{relative:j.relative}),ae=Tu(),me=ot.useContext(db),{navigator:Ue,basename:Xe}=ot.useContext(Il),it=me!=null&&O8(se)&&s===!0,be=Ue.encodeLocation?Ue.encodeLocation(se).pathname:se.pathname,Ee=ae.pathname,Ce=me&&me.navigation&&me.navigation.location?me.navigation.location.pathname:null;n||(Ee=Ee.toLowerCase(),Ce=Ce?Ce.toLowerCase():null,be=be.toLowerCase()),Ce&&Xe&&(Ce=qh(Ce,Xe)||Ce);const We=be!=="/"&&be.endsWith("/")?be.length-1:be.length;let Ct=Ee===be||!d&&Ee.startsWith(be)&&Ee.charAt(We)==="/",Ut=Ce!=null&&(Ce===be||!d&&Ce.startsWith(be)&&Ce.charAt(be.length)==="/"),we={isActive:Ct,isPending:Ut,isTransitioning:it},Ae=Ct?e:void 0,Ve;typeof l=="function"?Ve=l(we):Ve=[l,Ct?"active":null,Ut?"pending":null,it?"transitioning":null].filter(Boolean).join(" ");let De=typeof y=="function"?y(we):y;return ot.createElement(es,{...j,"aria-current":Ae,className:Ve,ref:K,style:De,to:A,viewTransition:s},typeof N=="function"?N(we):N)});I8.displayName="NavLink";var M8=ot.forwardRef(({discover:t="render",fetcherKey:e,navigate:n,reloadDocument:l,replace:d,state:y,method:A=Fx,action:s,onSubmit:N,relative:j,preventScrollReset:K,viewTransition:se,...ae},me)=>{let Ue=L8(),Xe=z8(s,{relative:j}),it=A.toLowerCase()==="get"?"get":"post",be=typeof s=="string"&&XO.test(s),Ee=Ce=>{if(N&&N(Ce),Ce.defaultPrevented)return;Ce.preventDefault();let We=Ce.nativeEvent.submitter,Ct=(We==null?void 0:We.getAttribute("formmethod"))||A;Ue(We||Ce.currentTarget,{fetcherKey:e,method:Ct,navigate:n,replace:d,state:y,relative:j,preventScrollReset:K,viewTransition:se})};return ot.createElement("form",{ref:me,method:it,action:Xe,onSubmit:l?N:Ee,...ae,"data-discover":!be&&t==="render"?"true":void 0})});M8.displayName="Form";function C8(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function YO(t){let e=ot.useContext(Gm);return Er(e,C8(t)),e}function R8(t,{target:e,replace:n,state:l,preventScrollReset:d,relative:y,viewTransition:A}={}){let s=$m(),N=Tu(),j=p0(t,{relative:y});return ot.useCallback(K=>{if(a8(K,e)){K.preventDefault();let se=n!==void 0?n:Gy(N)===Gy(j);s(t,{replace:se,state:l,preventScrollReset:d,relative:y,viewTransition:A})}},[N,s,j,n,l,e,t,d,y,A])}var D8=0,P8=()=>`__${String(++D8)}__`;function L8(){let{router:t}=YO("useSubmit"),{basename:e}=ot.useContext(Il),n=Xj();return ot.useCallback(async(l,d={})=>{let{action:y,method:A,encType:s,formData:N,body:j}=c8(l,e);if(d.navigate===!1){let K=d.fetcherKey||P8();await t.fetch(K,n,d.action||y,{preventScrollReset:d.preventScrollReset,formData:N,body:j,formMethod:d.method||A,formEncType:d.encType||s,flushSync:d.flushSync})}else await t.navigate(d.action||y,{preventScrollReset:d.preventScrollReset,formData:N,body:j,formMethod:d.method||A,formEncType:d.encType||s,replace:d.replace,state:d.state,fromRouteId:n,flushSync:d.flushSync,viewTransition:d.viewTransition})},[t,e,n])}function z8(t,{relative:e}={}){let{basename:n}=ot.useContext(Il),l=ot.useContext(mc);Er(l,"useFormAction must be used inside a RouteContext");let[d]=l.matches.slice(-1),y={...p0(t||".",{relative:e})},A=Tu();if(t==null){y.search=A.search;let s=new URLSearchParams(y.search),N=s.getAll("index");if(N.some(K=>K==="")){s.delete("index"),N.filter(se=>se).forEach(se=>s.append("index",se));let K=s.toString();y.search=K?`?${K}`:""}}return(!t||t===".")&&d.route.index&&(y.search=y.search?y.search.replace(/^\?/,"?index&"):"?index"),n!=="/"&&(y.pathname=y.pathname==="/"?n:uu([n,y.pathname])),Gy(y)}function O8(t,e={}){let n=ot.useContext(jO);Er(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:l}=YO("useViewTransitionState"),d=p0(t,{relative:e.relative});if(!n.isTransitioning)return!1;let y=qh(n.currentLocation.pathname,l)||n.currentLocation.pathname,A=qh(n.nextLocation.pathname,l)||n.nextLocation.pathname;return S1(d.pathname,A)!=null||S1(d.pathname,y)!=null}new TextEncoder;const k8=()=>{};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KO=function(t){const e=[];let n=0;for(let l=0;l<t.length;l++){let d=t.charCodeAt(l);d<128?e[n++]=d:d<2048?(e[n++]=d>>6|192,e[n++]=d&63|128):(d&64512)===55296&&l+1<t.length&&(t.charCodeAt(l+1)&64512)===56320?(d=65536+((d&1023)<<10)+(t.charCodeAt(++l)&1023),e[n++]=d>>18|240,e[n++]=d>>12&63|128,e[n++]=d>>6&63|128,e[n++]=d&63|128):(e[n++]=d>>12|224,e[n++]=d>>6&63|128,e[n++]=d&63|128)}return e},N8=function(t){const e=[];let n=0,l=0;for(;n<t.length;){const d=t[n++];if(d<128)e[l++]=String.fromCharCode(d);else if(d>191&&d<224){const y=t[n++];e[l++]=String.fromCharCode((d&31)<<6|y&63)}else if(d>239&&d<365){const y=t[n++],A=t[n++],s=t[n++],N=((d&7)<<18|(y&63)<<12|(A&63)<<6|s&63)-65536;e[l++]=String.fromCharCode(55296+(N>>10)),e[l++]=String.fromCharCode(56320+(N&1023))}else{const y=t[n++],A=t[n++];e[l++]=String.fromCharCode((d&15)<<12|(y&63)<<6|A&63)}}return e.join("")},QO={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,l=[];for(let d=0;d<t.length;d+=3){const y=t[d],A=d+1<t.length,s=A?t[d+1]:0,N=d+2<t.length,j=N?t[d+2]:0,K=y>>2,se=(y&3)<<4|s>>4;let ae=(s&15)<<2|j>>6,me=j&63;N||(me=64,A||(ae=64)),l.push(n[K],n[se],n[ae],n[me])}return l.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(KO(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):N8(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,l=[];for(let d=0;d<t.length;){const y=n[t.charAt(d++)],s=d<t.length?n[t.charAt(d)]:0;++d;const j=d<t.length?n[t.charAt(d)]:64;++d;const se=d<t.length?n[t.charAt(d)]:64;if(++d,y==null||s==null||j==null||se==null)throw new F8;const ae=y<<2|s>>4;if(l.push(ae),j!==64){const me=s<<4&240|j>>2;if(l.push(me),se!==64){const Ue=j<<6&192|se;l.push(Ue)}}}return l},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class F8 extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const B8=function(t){const e=KO(t);return QO.encodeByteArray(e,!0)},A1=function(t){return B8(t).replace(/\./g,"")},JO=function(t){try{return QO.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function V8(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const U8=()=>V8().__FIREBASE_DEFAULTS__,j8=()=>{if(typeof process>"u"||typeof process.env>"u")return;const t={}.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},q8=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&JO(t[1]);return e&&JSON.parse(e)},pb=()=>{try{return k8()||U8()||j8()||q8()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},ek=t=>{var e,n;return(n=(e=pb())===null||e===void 0?void 0:e.emulatorHosts)===null||n===void 0?void 0:n[t]},G8=t=>{const e=ek(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const l=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),l]:[e.substring(0,n),l]},tk=()=>{var t;return(t=pb())===null||t===void 0?void 0:t.config},ik=t=>{var e;return(e=pb())===null||e===void 0?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H8{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,l)=>{n?this.reject(n):this.resolve(l),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,l))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $8(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},l=e||"demo-project",d=t.iat||0,y=t.sub||t.user_id;if(!y)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const A=Object.assign({iss:`https://securetoken.google.com/${l}`,aud:l,iat:d,exp:d+3600,auth_time:d,sub:y,user_id:y,firebase:{sign_in_provider:"custom",identities:{}}},t),s="";return[A1(JSON.stringify(n)),A1(JSON.stringify(A)),s].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fa(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Z8(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(fa())}function W8(){var t;const e=(t=pb())===null||t===void 0?void 0:t.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function X8(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function nk(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function Y8(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function K8(){const t=fa();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function Q8(){return!W8()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function rk(){try{return typeof indexedDB=="object"}catch{return!1}}function sk(){return new Promise((t,e)=>{try{let n=!0;const l="validate-browser-context-for-indexeddb-analytics-module",d=self.indexedDB.open(l);d.onsuccess=()=>{d.result.close(),n||self.indexedDB.deleteDatabase(l),t(!0)},d.onupgradeneeded=()=>{n=!1},d.onerror=()=>{var y;e(((y=d.error)===null||y===void 0?void 0:y.message)||"")}}catch(n){e(n)}})}function J8(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eq="FirebaseError";class Ml extends Error{constructor(e,n,l){super(n),this.code=e,this.customData=l,this.name=eq,Object.setPrototypeOf(this,Ml.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,zf.prototype.create)}}class zf{constructor(e,n,l){this.service=e,this.serviceName=n,this.errors=l}create(e,...n){const l=n[0]||{},d=`${this.service}/${e}`,y=this.errors[e],A=y?tq(y,l):"Error",s=`${this.serviceName}: ${A} (${d}).`;return new Ml(d,s,l)}}function tq(t,e){return t.replace(iq,(n,l)=>{const d=e[l];return d!=null?String(d):`<${l}?>`})}const iq=/\{\$([^}]+)}/g;function nq(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Gh(t,e){if(t===e)return!0;const n=Object.keys(t),l=Object.keys(e);for(const d of n){if(!l.includes(d))return!1;const y=t[d],A=e[d];if(lP(y)&&lP(A)){if(!Gh(y,A))return!1}else if(y!==A)return!1}for(const d of l)if(!n.includes(d))return!1;return!0}function lP(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function m0(t){const e=[];for(const[n,l]of Object.entries(t))Array.isArray(l)?l.forEach(d=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(d))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(l));return e.length?"&"+e.join("&"):""}function ty(t){const e={};return t.replace(/^\?/,"").split("&").forEach(l=>{if(l){const[d,y]=l.split("=");e[decodeURIComponent(d)]=decodeURIComponent(y)}}),e}function iy(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}function rq(t,e){const n=new sq(t,e);return n.subscribe.bind(n)}class sq{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(l=>{this.error(l)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,l){let d;if(e===void 0&&n===void 0&&l===void 0)throw new Error("Missing Observer.");aq(e,["next","error","complete"])?d=e:d={next:e,error:n,complete:l},d.next===void 0&&(d.next=y2),d.error===void 0&&(d.error=y2),d.complete===void 0&&(d.complete=y2);const y=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?d.error(this.finalError):d.complete()}catch{}}),this.observers.push(d),y}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(l){typeof console<"u"&&console.error&&console.error(l)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function aq(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function y2(){}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oq=1e3,lq=2,cq=4*60*60*1e3,uq=.5;function cP(t,e=oq,n=lq){const l=e*Math.pow(n,t),d=Math.round(uq*l*(Math.random()-.5)*2);return Math.min(cq,l+d)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rs(t){return t&&t._delegate?t._delegate:t}class Tl{constructor(e,n,l){this.name=e,this.instanceFactory=n,this.type=l,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rf="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hq{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const l=new H8;if(this.instancesDeferred.set(n,l),this.isInitialized(n)||this.shouldAutoInitialize())try{const d=this.getOrInitializeService({instanceIdentifier:n});d&&l.resolve(d)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){var n;const l=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),d=(n=e==null?void 0:e.optional)!==null&&n!==void 0?n:!1;if(this.isInitialized(l)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:l})}catch(y){if(d)return null;throw y}else{if(d)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(fq(e))try{this.getOrInitializeService({instanceIdentifier:rf})}catch{}for(const[n,l]of this.instancesDeferred.entries()){const d=this.normalizeInstanceIdentifier(n);try{const y=this.getOrInitializeService({instanceIdentifier:d});l.resolve(y)}catch{}}}}clearInstance(e=rf){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=rf){return this.instances.has(e)}getOptions(e=rf){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,l=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(l))throw Error(`${this.name}(${l}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const d=this.getOrInitializeService({instanceIdentifier:l,options:n});for(const[y,A]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(y);l===s&&A.resolve(d)}return d}onInit(e,n){var l;const d=this.normalizeInstanceIdentifier(n),y=(l=this.onInitCallbacks.get(d))!==null&&l!==void 0?l:new Set;y.add(e),this.onInitCallbacks.set(d,y);const A=this.instances.get(d);return A&&e(A,d),()=>{y.delete(e)}}invokeOnInitCallbacks(e,n){const l=this.onInitCallbacks.get(n);if(l)for(const d of l)try{d(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let l=this.instances.get(e);if(!l&&this.component&&(l=this.component.instanceFactory(this.container,{instanceIdentifier:dq(e),options:n}),this.instances.set(e,l),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(l,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,l)}catch{}return l||null}normalizeInstanceIdentifier(e=rf){return this.component?this.component.multipleInstances?e:rf:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function dq(t){return t===rf?void 0:t}function fq(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pq{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new hq(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var mn;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(mn||(mn={}));const mq={debug:mn.DEBUG,verbose:mn.VERBOSE,info:mn.INFO,warn:mn.WARN,error:mn.ERROR,silent:mn.SILENT},gq=mn.INFO,_q={[mn.DEBUG]:"log",[mn.VERBOSE]:"log",[mn.INFO]:"info",[mn.WARN]:"warn",[mn.ERROR]:"error"},yq=(t,e,...n)=>{if(e<t.logLevel)return;const l=new Date().toISOString(),d=_q[e];if(d)console[d](`[${l}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class mb{constructor(e){this.name=e,this._logLevel=gq,this._logHandler=yq,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in mn))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?mq[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,mn.DEBUG,...e),this._logHandler(this,mn.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,mn.VERBOSE,...e),this._logHandler(this,mn.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,mn.INFO,...e),this._logHandler(this,mn.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,mn.WARN,...e),this._logHandler(this,mn.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,mn.ERROR,...e),this._logHandler(this,mn.ERROR,...e)}}const vq=(t,e)=>e.some(n=>t instanceof n);let uP,hP;function xq(){return uP||(uP=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function bq(){return hP||(hP=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const ak=new WeakMap,IE=new WeakMap,ok=new WeakMap,v2=new WeakMap,oA=new WeakMap;function wq(t){const e=new Promise((n,l)=>{const d=()=>{t.removeEventListener("success",y),t.removeEventListener("error",A)},y=()=>{n(zh(t.result)),d()},A=()=>{l(t.error),d()};t.addEventListener("success",y),t.addEventListener("error",A)});return e.then(n=>{n instanceof IDBCursor&&ak.set(n,t)}).catch(()=>{}),oA.set(e,t),e}function Tq(t){if(IE.has(t))return;const e=new Promise((n,l)=>{const d=()=>{t.removeEventListener("complete",y),t.removeEventListener("error",A),t.removeEventListener("abort",A)},y=()=>{n(),d()},A=()=>{l(t.error||new DOMException("AbortError","AbortError")),d()};t.addEventListener("complete",y),t.addEventListener("error",A),t.addEventListener("abort",A)});IE.set(t,e)}let ME={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return IE.get(t);if(e==="objectStoreNames")return t.objectStoreNames||ok.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return zh(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function Eq(t){ME=t(ME)}function Sq(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const l=t.call(x2(this),e,...n);return ok.set(l,e.sort?e.sort():[e]),zh(l)}:bq().includes(t)?function(...e){return t.apply(x2(this),e),zh(ak.get(this))}:function(...e){return zh(t.apply(x2(this),e))}}function Aq(t){return typeof t=="function"?Sq(t):(t instanceof IDBTransaction&&Tq(t),vq(t,xq())?new Proxy(t,ME):t)}function zh(t){if(t instanceof IDBRequest)return wq(t);if(v2.has(t))return v2.get(t);const e=Aq(t);return e!==t&&(v2.set(t,e),oA.set(e,t)),e}const x2=t=>oA.get(t);function lk(t,e,{blocked:n,upgrade:l,blocking:d,terminated:y}={}){const A=indexedDB.open(t,e),s=zh(A);return l&&A.addEventListener("upgradeneeded",N=>{l(zh(A.result),N.oldVersion,N.newVersion,zh(A.transaction),N)}),n&&A.addEventListener("blocked",N=>n(N.oldVersion,N.newVersion,N)),s.then(N=>{y&&N.addEventListener("close",()=>y()),d&&N.addEventListener("versionchange",j=>d(j.oldVersion,j.newVersion,j))}).catch(()=>{}),s}const Iq=["get","getKey","getAll","getAllKeys","count"],Mq=["put","add","delete","clear"],b2=new Map;function dP(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(b2.get(e))return b2.get(e);const n=e.replace(/FromIndex$/,""),l=e!==n,d=Mq.includes(n);if(!(n in(l?IDBIndex:IDBObjectStore).prototype)||!(d||Iq.includes(n)))return;const y=async function(A,...s){const N=this.transaction(A,d?"readwrite":"readonly");let j=N.store;return l&&(j=j.index(s.shift())),(await Promise.all([j[n](...s),d&&N.done]))[0]};return b2.set(e,y),y}Eq(t=>({...t,get:(e,n,l)=>dP(e,n)||t.get(e,n,l),has:(e,n)=>!!dP(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cq{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(Rq(n)){const l=n.getImmediate();return`${l.library}/${l.version}`}else return null}).filter(n=>n).join(" ")}}function Rq(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const CE="@firebase/app",fP="0.11.2";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yu=new mb("@firebase/app"),Dq="@firebase/app-compat",Pq="@firebase/analytics-compat",Lq="@firebase/analytics",zq="@firebase/app-check-compat",Oq="@firebase/app-check",kq="@firebase/auth",Nq="@firebase/auth-compat",Fq="@firebase/database",Bq="@firebase/data-connect",Vq="@firebase/database-compat",Uq="@firebase/functions",jq="@firebase/functions-compat",qq="@firebase/installations",Gq="@firebase/installations-compat",Hq="@firebase/messaging",$q="@firebase/messaging-compat",Zq="@firebase/performance",Wq="@firebase/performance-compat",Xq="@firebase/remote-config",Yq="@firebase/remote-config-compat",Kq="@firebase/storage",Qq="@firebase/storage-compat",Jq="@firebase/firestore",e9="@firebase/vertexai",t9="@firebase/firestore-compat",i9="firebase",n9="11.4.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RE="[DEFAULT]",r9={[CE]:"fire-core",[Dq]:"fire-core-compat",[Lq]:"fire-analytics",[Pq]:"fire-analytics-compat",[Oq]:"fire-app-check",[zq]:"fire-app-check-compat",[kq]:"fire-auth",[Nq]:"fire-auth-compat",[Fq]:"fire-rtdb",[Bq]:"fire-data-connect",[Vq]:"fire-rtdb-compat",[Uq]:"fire-fn",[jq]:"fire-fn-compat",[qq]:"fire-iid",[Gq]:"fire-iid-compat",[Hq]:"fire-fcm",[$q]:"fire-fcm-compat",[Zq]:"fire-perf",[Wq]:"fire-perf-compat",[Xq]:"fire-rc",[Yq]:"fire-rc-compat",[Kq]:"fire-gcs",[Qq]:"fire-gcs-compat",[Jq]:"fire-fst",[t9]:"fire-fst-compat",[e9]:"fire-vertex","fire-js":"fire-js",[i9]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const I1=new Map,s9=new Map,DE=new Map;function pP(t,e){try{t.container.addComponent(e)}catch(n){yu.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function hc(t){const e=t.name;if(DE.has(e))return yu.debug(`There were multiple attempts to register component ${e}.`),!1;DE.set(e,t);for(const n of I1.values())pP(n,t);for(const n of s9.values())pP(n,t);return!0}function g0(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function jo(t){return t==null?!1:t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const a9={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Oh=new zf("app","Firebase",a9);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o9{constructor(e,n,l){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},n),this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=l,this.container.addComponent(new Tl("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Oh.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zm=n9;function ck(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const l=Object.assign({name:RE,automaticDataCollectionEnabled:!1},e),d=l.name;if(typeof d!="string"||!d)throw Oh.create("bad-app-name",{appName:String(d)});if(n||(n=tk()),!n)throw Oh.create("no-options");const y=I1.get(d);if(y){if(Gh(n,y.options)&&Gh(l,y.config))return y;throw Oh.create("duplicate-app",{appName:d})}const A=new pq(d);for(const N of DE.values())A.addComponent(N);const s=new o9(n,l,A);return I1.set(d,s),s}function uk(t=RE){const e=I1.get(t);if(!e&&t===RE&&tk())return ck();if(!e)throw Oh.create("no-app",{appName:t});return e}function $o(t,e,n){var l;let d=(l=r9[t])!==null&&l!==void 0?l:t;n&&(d+=`-${n}`);const y=d.match(/\s|\//),A=e.match(/\s|\//);if(y||A){const s=[`Unable to register library "${d}" with version "${e}":`];y&&s.push(`library name "${d}" contains illegal characters (whitespace or "/")`),y&&A&&s.push("and"),A&&s.push(`version name "${e}" contains illegal characters (whitespace or "/")`),yu.warn(s.join(" "));return}hc(new Tl(`${d}-version`,()=>({library:d,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const l9="firebase-heartbeat-database",c9=1,Hy="firebase-heartbeat-store";let w2=null;function hk(){return w2||(w2=lk(l9,c9,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(Hy)}catch(n){console.warn(n)}}}}).catch(t=>{throw Oh.create("idb-open",{originalErrorMessage:t.message})})),w2}async function u9(t){try{const n=(await hk()).transaction(Hy),l=await n.objectStore(Hy).get(dk(t));return await n.done,l}catch(e){if(e instanceof Ml)yu.warn(e.message);else{const n=Oh.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});yu.warn(n.message)}}}async function mP(t,e){try{const l=(await hk()).transaction(Hy,"readwrite");await l.objectStore(Hy).put(e,dk(t)),await l.done}catch(n){if(n instanceof Ml)yu.warn(n.message);else{const l=Oh.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});yu.warn(l.message)}}}function dk(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const h9=1024,d9=30;class f9{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new m9(n),this._heartbeatsCachePromise=this._storage.read().then(l=>(this._heartbeatsCache=l,l))}async triggerHeartbeat(){var e,n;try{const d=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),y=gP();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)===null||n===void 0?void 0:n.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===y||this._heartbeatsCache.heartbeats.some(A=>A.date===y))return;if(this._heartbeatsCache.heartbeats.push({date:y,agent:d}),this._heartbeatsCache.heartbeats.length>d9){const A=g9(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(A,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(l){yu.warn(l)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=gP(),{heartbeatsToSend:l,unsentEntries:d}=p9(this._heartbeatsCache.heartbeats),y=A1(JSON.stringify({version:2,heartbeats:l}));return this._heartbeatsCache.lastSentHeartbeatDate=n,d.length>0?(this._heartbeatsCache.heartbeats=d,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),y}catch(n){return yu.warn(n),""}}}function gP(){return new Date().toISOString().substring(0,10)}function p9(t,e=h9){const n=[];let l=t.slice();for(const d of t){const y=n.find(A=>A.agent===d.agent);if(y){if(y.dates.push(d.date),_P(n)>e){y.dates.pop();break}}else if(n.push({agent:d.agent,dates:[d.date]}),_P(n)>e){n.pop();break}l=l.slice(1)}return{heartbeatsToSend:n,unsentEntries:l}}class m9{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return rk()?sk().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await u9(this.app);return n!=null&&n.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var n;if(await this._canUseIndexedDBPromise){const d=await this.read();return mP(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:d.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var n;if(await this._canUseIndexedDBPromise){const d=await this.read();return mP(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:d.lastSentHeartbeatDate,heartbeats:[...d.heartbeats,...e.heartbeats]})}else return}}function _P(t){return A1(JSON.stringify({version:2,heartbeats:t})).length}function g9(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let l=1;l<t.length;l++)t[l].date<n&&(n=t[l].date,e=l);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _9(t){hc(new Tl("platform-logger",e=>new Cq(e),"PRIVATE")),hc(new Tl("heartbeat",e=>new f9(e),"PRIVATE")),$o(CE,fP,t),$o(CE,fP,"esm2017"),$o("fire-js","")}_9("");var y9="firebase",v9="11.4.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */$o(y9,v9,"app");const fk="@firebase/installations",lA="0.6.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pk=1e4,mk=`w:${lA}`,gk="FIS_v2",x9="https://firebaseinstallations.googleapis.com/v1",b9=60*60*1e3,w9="installations",T9="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const E9={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},wf=new zf(w9,T9,E9);function _k(t){return t instanceof Ml&&t.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yk({projectId:t}){return`${x9}/projects/${t}/installations`}function vk(t){return{token:t.token,requestStatus:2,expiresIn:A9(t.expiresIn),creationTime:Date.now()}}async function xk(t,e){const l=(await e.json()).error;return wf.create("request-failed",{requestName:t,serverCode:l.code,serverMessage:l.message,serverStatus:l.status})}function bk({apiKey:t}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t})}function S9(t,{refreshToken:e}){const n=bk(t);return n.append("Authorization",I9(e)),n}async function wk(t){const e=await t();return e.status>=500&&e.status<600?t():e}function A9(t){return Number(t.replace("s","000"))}function I9(t){return`${gk} ${t}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function M9({appConfig:t,heartbeatServiceProvider:e},{fid:n}){const l=yk(t),d=bk(t),y=e.getImmediate({optional:!0});if(y){const j=await y.getHeartbeatsHeader();j&&d.append("x-firebase-client",j)}const A={fid:n,authVersion:gk,appId:t.appId,sdkVersion:mk},s={method:"POST",headers:d,body:JSON.stringify(A)},N=await wk(()=>fetch(l,s));if(N.ok){const j=await N.json();return{fid:j.fid||n,registrationStatus:2,refreshToken:j.refreshToken,authToken:vk(j.authToken)}}else throw await xk("Create Installation",N)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tk(t){return new Promise(e=>{setTimeout(e,t)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function C9(t){return btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const R9=/^[cdef][\w-]{21}$/,PE="";function D9(){try{const t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;const n=P9(t);return R9.test(n)?n:PE}catch{return PE}}function P9(t){return C9(t).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gb(t){return`${t.appName}!${t.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ek=new Map;function Sk(t,e){const n=gb(t);Ak(n,e),L9(n,e)}function Ak(t,e){const n=Ek.get(t);if(n)for(const l of n)l(e)}function L9(t,e){const n=z9();n&&n.postMessage({key:t,fid:e}),O9()}let cf=null;function z9(){return!cf&&"BroadcastChannel"in self&&(cf=new BroadcastChannel("[Firebase] FID Change"),cf.onmessage=t=>{Ak(t.data.key,t.data.fid)}),cf}function O9(){Ek.size===0&&cf&&(cf.close(),cf=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const k9="firebase-installations-database",N9=1,Tf="firebase-installations-store";let T2=null;function cA(){return T2||(T2=lk(k9,N9,{upgrade:(t,e)=>{switch(e){case 0:t.createObjectStore(Tf)}}})),T2}async function M1(t,e){const n=gb(t),d=(await cA()).transaction(Tf,"readwrite"),y=d.objectStore(Tf),A=await y.get(n);return await y.put(e,n),await d.done,(!A||A.fid!==e.fid)&&Sk(t,e.fid),e}async function Ik(t){const e=gb(t),l=(await cA()).transaction(Tf,"readwrite");await l.objectStore(Tf).delete(e),await l.done}async function _b(t,e){const n=gb(t),d=(await cA()).transaction(Tf,"readwrite"),y=d.objectStore(Tf),A=await y.get(n),s=e(A);return s===void 0?await y.delete(n):await y.put(s,n),await d.done,s&&(!A||A.fid!==s.fid)&&Sk(t,s.fid),s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function uA(t){let e;const n=await _b(t.appConfig,l=>{const d=F9(l),y=B9(t,d);return e=y.registrationPromise,y.installationEntry});return n.fid===PE?{installationEntry:await e}:{installationEntry:n,registrationPromise:e}}function F9(t){const e=t||{fid:D9(),registrationStatus:0};return Mk(e)}function B9(t,e){if(e.registrationStatus===0){if(!navigator.onLine){const d=Promise.reject(wf.create("app-offline"));return{installationEntry:e,registrationPromise:d}}const n={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},l=V9(t,n);return{installationEntry:n,registrationPromise:l}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:U9(t)}:{installationEntry:e}}async function V9(t,e){try{const n=await M9(t,e);return M1(t.appConfig,n)}catch(n){throw _k(n)&&n.customData.serverCode===409?await Ik(t.appConfig):await M1(t.appConfig,{fid:e.fid,registrationStatus:0}),n}}async function U9(t){let e=await yP(t.appConfig);for(;e.registrationStatus===1;)await Tk(100),e=await yP(t.appConfig);if(e.registrationStatus===0){const{installationEntry:n,registrationPromise:l}=await uA(t);return l||n}return e}function yP(t){return _b(t,e=>{if(!e)throw wf.create("installation-not-found");return Mk(e)})}function Mk(t){return j9(t)?{fid:t.fid,registrationStatus:0}:t}function j9(t){return t.registrationStatus===1&&t.registrationTime+pk<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function q9({appConfig:t,heartbeatServiceProvider:e},n){const l=G9(t,n),d=S9(t,n),y=e.getImmediate({optional:!0});if(y){const j=await y.getHeartbeatsHeader();j&&d.append("x-firebase-client",j)}const A={installation:{sdkVersion:mk,appId:t.appId}},s={method:"POST",headers:d,body:JSON.stringify(A)},N=await wk(()=>fetch(l,s));if(N.ok){const j=await N.json();return vk(j)}else throw await xk("Generate Auth Token",N)}function G9(t,{fid:e}){return`${yk(t)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hA(t,e=!1){let n;const l=await _b(t.appConfig,y=>{if(!Ck(y))throw wf.create("not-registered");const A=y.authToken;if(!e&&Z9(A))return y;if(A.requestStatus===1)return n=H9(t,e),y;{if(!navigator.onLine)throw wf.create("app-offline");const s=X9(y);return n=$9(t,s),s}});return n?await n:l.authToken}async function H9(t,e){let n=await vP(t.appConfig);for(;n.authToken.requestStatus===1;)await Tk(100),n=await vP(t.appConfig);const l=n.authToken;return l.requestStatus===0?hA(t,e):l}function vP(t){return _b(t,e=>{if(!Ck(e))throw wf.create("not-registered");const n=e.authToken;return Y9(n)?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}async function $9(t,e){try{const n=await q9(t,e),l=Object.assign(Object.assign({},e),{authToken:n});return await M1(t.appConfig,l),n}catch(n){if(_k(n)&&(n.customData.serverCode===401||n.customData.serverCode===404))await Ik(t.appConfig);else{const l=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await M1(t.appConfig,l)}throw n}}function Ck(t){return t!==void 0&&t.registrationStatus===2}function Z9(t){return t.requestStatus===2&&!W9(t)}function W9(t){const e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+b9}function X9(t){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},t),{authToken:e})}function Y9(t){return t.requestStatus===1&&t.requestTime+pk<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function K9(t){const e=t,{installationEntry:n,registrationPromise:l}=await uA(e);return l?l.catch(console.error):hA(e).catch(console.error),n.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Q9(t,e=!1){const n=t;return await J9(n),(await hA(n,e)).token}async function J9(t){const{registrationPromise:e}=await uA(t);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eG(t){if(!t||!t.options)throw E2("App Configuration");if(!t.name)throw E2("App Name");const e=["projectId","apiKey","appId"];for(const n of e)if(!t.options[n])throw E2(n);return{appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}function E2(t){return wf.create("missing-app-config-values",{valueName:t})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rk="installations",tG="installations-internal",iG=t=>{const e=t.getProvider("app").getImmediate(),n=eG(e),l=g0(e,"heartbeat");return{app:e,appConfig:n,heartbeatServiceProvider:l,_delete:()=>Promise.resolve()}},nG=t=>{const e=t.getProvider("app").getImmediate(),n=g0(e,Rk).getImmediate();return{getId:()=>K9(n),getToken:d=>Q9(n,d)}};function rG(){hc(new Tl(Rk,iG,"PUBLIC")),hc(new Tl(tG,nG,"PRIVATE"))}rG();$o(fk,lA);$o(fk,lA,"esm2017");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xP="analytics",sG="firebase_id",aG="origin",oG=60*1e3,lG="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",dA="https://www.googletagmanager.com/gtag/js";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ja=new mb("@firebase/analytics");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cG={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},Zo=new zf("analytics","Analytics",cG);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uG(t){if(!t.startsWith(dA)){const e=Zo.create("invalid-gtag-resource",{gtagURL:t});return ja.warn(e.message),""}return t}function Dk(t){return Promise.all(t.map(e=>e.catch(n=>n)))}function hG(t,e){let n;return window.trustedTypes&&(n=window.trustedTypes.createPolicy(t,e)),n}function dG(t,e){const n=hG("firebase-js-sdk-policy",{createScriptURL:uG}),l=document.createElement("script"),d=`${dA}?l=${t}&id=${e}`;l.src=n?n==null?void 0:n.createScriptURL(d):d,l.async=!0,document.head.appendChild(l)}function fG(t){let e=[];return Array.isArray(window[t])?e=window[t]:window[t]=e,e}async function pG(t,e,n,l,d,y){const A=l[d];try{if(A)await e[A];else{const N=(await Dk(n)).find(j=>j.measurementId===d);N&&await e[N.appId]}}catch(s){ja.error(s)}t("config",d,y)}async function mG(t,e,n,l,d){try{let y=[];if(d&&d.send_to){let A=d.send_to;Array.isArray(A)||(A=[A]);const s=await Dk(n);for(const N of A){const j=s.find(se=>se.measurementId===N),K=j&&e[j.appId];if(K)y.push(K);else{y=[];break}}}y.length===0&&(y=Object.values(e)),await Promise.all(y),t("event",l,d||{})}catch(y){ja.error(y)}}function gG(t,e,n,l){async function d(y,...A){try{if(y==="event"){const[s,N]=A;await mG(t,e,n,s,N)}else if(y==="config"){const[s,N]=A;await pG(t,e,n,l,s,N)}else if(y==="consent"){const[s,N]=A;t("consent",s,N)}else if(y==="get"){const[s,N,j]=A;t("get",s,N,j)}else if(y==="set"){const[s]=A;t("set",s)}else t(y,...A)}catch(s){ja.error(s)}}return d}function _G(t,e,n,l,d){let y=function(...A){window[l].push(arguments)};return window[d]&&typeof window[d]=="function"&&(y=window[d]),window[d]=gG(y,t,e,n),{gtagCore:y,wrappedGtag:window[d]}}function yG(t){const e=window.document.getElementsByTagName("script");for(const n of Object.values(e))if(n.src&&n.src.includes(dA)&&n.src.includes(t))return n;return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vG=30,xG=1e3;class bG{constructor(e={},n=xG){this.throttleMetadata=e,this.intervalMillis=n}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,n){this.throttleMetadata[e]=n}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}const Pk=new bG;function wG(t){return new Headers({Accept:"application/json","x-goog-api-key":t})}async function TG(t){var e;const{appId:n,apiKey:l}=t,d={method:"GET",headers:wG(l)},y=lG.replace("{app-id}",n),A=await fetch(y,d);if(A.status!==200&&A.status!==304){let s="";try{const N=await A.json();!((e=N.error)===null||e===void 0)&&e.message&&(s=N.error.message)}catch{}throw Zo.create("config-fetch-failed",{httpStatus:A.status,responseMessage:s})}return A.json()}async function EG(t,e=Pk,n){const{appId:l,apiKey:d,measurementId:y}=t.options;if(!l)throw Zo.create("no-app-id");if(!d){if(y)return{measurementId:y,appId:l};throw Zo.create("no-api-key")}const A=e.getThrottleMetadata(l)||{backoffCount:0,throttleEndTimeMillis:Date.now()},s=new IG;return setTimeout(async()=>{s.abort()},n!==void 0?n:oG),Lk({appId:l,apiKey:d,measurementId:y},A,s,e)}async function Lk(t,{throttleEndTimeMillis:e,backoffCount:n},l,d=Pk){var y;const{appId:A,measurementId:s}=t;try{await SG(l,e)}catch(N){if(s)return ja.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${s} provided in the "measurementId" field in the local Firebase config. [${N==null?void 0:N.message}]`),{appId:A,measurementId:s};throw N}try{const N=await TG(t);return d.deleteThrottleMetadata(A),N}catch(N){const j=N;if(!AG(j)){if(d.deleteThrottleMetadata(A),s)return ja.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${s} provided in the "measurementId" field in the local Firebase config. [${j==null?void 0:j.message}]`),{appId:A,measurementId:s};throw N}const K=Number((y=j==null?void 0:j.customData)===null||y===void 0?void 0:y.httpStatus)===503?cP(n,d.intervalMillis,vG):cP(n,d.intervalMillis),se={throttleEndTimeMillis:Date.now()+K,backoffCount:n+1};return d.setThrottleMetadata(A,se),ja.debug(`Calling attemptFetch again in ${K} millis`),Lk(t,se,l,d)}}function SG(t,e){return new Promise((n,l)=>{const d=Math.max(e-Date.now(),0),y=setTimeout(n,d);t.addEventListener(()=>{clearTimeout(y),l(Zo.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function AG(t){if(!(t instanceof Ml)||!t.customData)return!1;const e=Number(t.customData.httpStatus);return e===429||e===500||e===503||e===504}class IG{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function MG(t,e,n,l,d){if(d&&d.global){t("event",n,l);return}else{const y=await e,A=Object.assign(Object.assign({},l),{send_to:y});t("event",n,A)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function CG(){if(rk())try{await sk()}catch(t){return ja.warn(Zo.create("indexeddb-unavailable",{errorInfo:t==null?void 0:t.toString()}).message),!1}else return ja.warn(Zo.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function RG(t,e,n,l,d,y,A){var s;const N=EG(t);N.then(me=>{n[me.measurementId]=me.appId,t.options.measurementId&&me.measurementId!==t.options.measurementId&&ja.warn(`The measurement ID in the local Firebase config (${t.options.measurementId}) does not match the measurement ID fetched from the server (${me.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(me=>ja.error(me)),e.push(N);const j=CG().then(me=>{if(me)return l.getId()}),[K,se]=await Promise.all([N,j]);yG(y)||dG(y,K.measurementId),d("js",new Date);const ae=(s=A==null?void 0:A.config)!==null&&s!==void 0?s:{};return ae[aG]="firebase",ae.update=!0,se!=null&&(ae[sG]=se),d("config",K.measurementId,ae),K.measurementId}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DG{constructor(e){this.app=e}_delete(){return delete Ty[this.app.options.appId],Promise.resolve()}}let Ty={},bP=[];const wP={};let S2="dataLayer",PG="gtag",TP,zk,EP=!1;function LG(){const t=[];if(nk()&&t.push("This is a browser extension environment."),J8()||t.push("Cookies are not available."),t.length>0){const e=t.map((l,d)=>`(${d+1}) ${l}`).join(" "),n=Zo.create("invalid-analytics-context",{errorInfo:e});ja.warn(n.message)}}function zG(t,e,n){LG();const l=t.options.appId;if(!l)throw Zo.create("no-app-id");if(!t.options.apiKey)if(t.options.measurementId)ja.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${t.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw Zo.create("no-api-key");if(Ty[l]!=null)throw Zo.create("already-exists",{id:l});if(!EP){fG(S2);const{wrappedGtag:y,gtagCore:A}=_G(Ty,bP,wP,S2,PG);zk=y,TP=A,EP=!0}return Ty[l]=RG(t,bP,wP,e,TP,S2,n),new DG(t)}function OG(t,e,n,l){t=rs(t),MG(zk,Ty[t.app.options.appId],e,n,l).catch(d=>ja.error(d))}const SP="@firebase/analytics",AP="0.10.12";function kG(){hc(new Tl(xP,(e,{options:n})=>{const l=e.getProvider("app").getImmediate(),d=e.getProvider("installations-internal").getImmediate();return zG(l,d,n)},"PUBLIC")),hc(new Tl("analytics-internal",t,"PRIVATE")),$o(SP,AP),$o(SP,AP,"esm2017");function t(e){try{const n=e.getProvider(xP).getImmediate();return{logEvent:(l,d,y)=>OG(n,l,d,y)}}catch(n){throw Zo.create("interop-component-reg-failed",{reason:n})}}}kG();function fA(t,e){var n={};for(var l in t)Object.prototype.hasOwnProperty.call(t,l)&&e.indexOf(l)<0&&(n[l]=t[l]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var d=0,l=Object.getOwnPropertySymbols(t);d<l.length;d++)e.indexOf(l[d])<0&&Object.prototype.propertyIsEnumerable.call(t,l[d])&&(n[l[d]]=t[l[d]]);return n}function Ok(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const NG=Ok,kk=new zf("auth","Firebase",Ok());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const C1=new mb("@firebase/auth");function FG(t,...e){C1.logLevel<=mn.WARN&&C1.warn(`Auth (${Zm}): ${t}`,...e)}function Vx(t,...e){C1.logLevel<=mn.ERROR&&C1.error(`Auth (${Zm}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function El(t,...e){throw pA(t,...e)}function ac(t,...e){return pA(t,...e)}function Nk(t,e,n){const l=Object.assign(Object.assign({},NG()),{[e]:n});return new zf("auth","Firebase",l).create(e,{appName:t.name})}function hu(t){return Nk(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function pA(t,...e){if(typeof t!="string"){const n=e[0],l=[...e.slice(1)];return l[0]&&(l[0].appName=t.name),t._errorFactory.create(n,...l)}return kk.create(t,...e)}function qi(t,e,...n){if(!t)throw pA(e,...n)}function au(t){const e="INTERNAL ASSERTION FAILED: "+t;throw Vx(e),new Error(e)}function vu(t,e){t||au(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LE(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.href)||""}function BG(){return IP()==="http:"||IP()==="https:"}function IP(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VG(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(BG()||nk()||"connection"in navigator)?navigator.onLine:!0}function UG(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _0{constructor(e,n){this.shortDelay=e,this.longDelay=n,vu(n>e,"Short delay should be less than long delay!"),this.isMobile=Z8()||Y8()}get(){return VG()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mA(t,e){vu(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fk{static initialize(e,n,l){this.fetchImpl=e,n&&(this.headersImpl=n),l&&(this.responseImpl=l)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;au("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;au("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;au("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jG={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qG=new _0(3e4,6e4);function td(t,e){return t.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:t.tenantId}):e}async function id(t,e,n,l,d={}){return Bk(t,d,async()=>{let y={},A={};l&&(e==="GET"?A=l:y={body:JSON.stringify(l)});const s=m0(Object.assign({key:t.config.apiKey},A)).slice(1),N=await t._getAdditionalHeaders();N["Content-Type"]="application/json",t.languageCode&&(N["X-Firebase-Locale"]=t.languageCode);const j=Object.assign({method:e,headers:N},y);return X8()||(j.referrerPolicy="no-referrer"),Fk.fetch()(Vk(t,t.config.apiHost,n,s),j)})}async function Bk(t,e,n){t._canInitEmulator=!1;const l=Object.assign(Object.assign({},jG),e);try{const d=new HG(t),y=await Promise.race([n(),d.promise]);d.clearNetworkTimeout();const A=await y.json();if("needConfirmation"in A)throw vx(t,"account-exists-with-different-credential",A);if(y.ok&&!("errorMessage"in A))return A;{const s=y.ok?A.errorMessage:A.error.message,[N,j]=s.split(" : ");if(N==="FEDERATED_USER_ID_ALREADY_LINKED")throw vx(t,"credential-already-in-use",A);if(N==="EMAIL_EXISTS")throw vx(t,"email-already-in-use",A);if(N==="USER_DISABLED")throw vx(t,"user-disabled",A);const K=l[N]||N.toLowerCase().replace(/[_\s]+/g,"-");if(j)throw Nk(t,K,j);El(t,K)}}catch(d){if(d instanceof Ml)throw d;El(t,"network-request-failed",{message:String(d)})}}async function y0(t,e,n,l,d={}){const y=await id(t,e,n,l,d);return"mfaPendingCredential"in y&&El(t,"multi-factor-auth-required",{_serverResponse:y}),y}function Vk(t,e,n,l){const d=`${e}${n}?${l}`;return t.config.emulator?mA(t.config,d):`${t.config.apiScheme}://${d}`}function GG(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class HG{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,l)=>{this.timer=setTimeout(()=>l(ac(this.auth,"network-request-failed")),qG.get())})}}function vx(t,e,n){const l={appName:t.name};n.email&&(l.email=n.email),n.phoneNumber&&(l.phoneNumber=n.phoneNumber);const d=ac(t,e,l);return d.customData._tokenResponse=n,d}function MP(t){return t!==void 0&&t.enterprise!==void 0}class $G{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return GG(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function ZG(t,e){return id(t,"GET","/v2/recaptchaConfig",td(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function WG(t,e){return id(t,"POST","/v1/accounts:delete",e)}async function Uk(t,e){return id(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ey(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function XG(t,e=!1){const n=rs(t),l=await n.getIdToken(e),d=gA(l);qi(d&&d.exp&&d.auth_time&&d.iat,n.auth,"internal-error");const y=typeof d.firebase=="object"?d.firebase:void 0,A=y==null?void 0:y.sign_in_provider;return{claims:d,token:l,authTime:Ey(A2(d.auth_time)),issuedAtTime:Ey(A2(d.iat)),expirationTime:Ey(A2(d.exp)),signInProvider:A||null,signInSecondFactor:(y==null?void 0:y.sign_in_second_factor)||null}}function A2(t){return Number(t)*1e3}function gA(t){const[e,n,l]=t.split(".");if(e===void 0||n===void 0||l===void 0)return Vx("JWT malformed, contained fewer than 3 sections"),null;try{const d=JO(n);return d?JSON.parse(d):(Vx("Failed to decode base64 JWT payload"),null)}catch(d){return Vx("Caught error parsing JWT payload as JSON",d==null?void 0:d.toString()),null}}function CP(t){const e=gA(t);return qi(e,"internal-error"),qi(typeof e.exp<"u","internal-error"),qi(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $y(t,e,n=!1){if(n)return e;try{return await e}catch(l){throw l instanceof Ml&&YG(l)&&t.auth.currentUser===t&&await t.auth.signOut(),l}}function YG({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KG{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var n;if(e){const l=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),l}else{this.errorBackoff=3e4;const d=((n=this.user.stsTokenManager.expirationTime)!==null&&n!==void 0?n:0)-Date.now()-3e5;return Math.max(0,d)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zE{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=Ey(this.lastLoginAt),this.creationTime=Ey(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function R1(t){var e;const n=t.auth,l=await t.getIdToken(),d=await $y(t,Uk(n,{idToken:l}));qi(d==null?void 0:d.users.length,n,"internal-error");const y=d.users[0];t._notifyReloadListener(y);const A=!((e=y.providerUserInfo)===null||e===void 0)&&e.length?jk(y.providerUserInfo):[],s=JG(t.providerData,A),N=t.isAnonymous,j=!(t.email&&y.passwordHash)&&!(s!=null&&s.length),K=N?j:!1,se={uid:y.localId,displayName:y.displayName||null,photoURL:y.photoUrl||null,email:y.email||null,emailVerified:y.emailVerified||!1,phoneNumber:y.phoneNumber||null,tenantId:y.tenantId||null,providerData:s,metadata:new zE(y.createdAt,y.lastLoginAt),isAnonymous:K};Object.assign(t,se)}async function QG(t){const e=rs(t);await R1(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function JG(t,e){return[...t.filter(l=>!e.some(d=>d.providerId===l.providerId)),...e]}function jk(t){return t.map(e=>{var{providerId:n}=e,l=fA(e,["providerId"]);return{providerId:n,uid:l.rawId||"",displayName:l.displayName||null,email:l.email||null,phoneNumber:l.phoneNumber||null,photoURL:l.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function e7(t,e){const n=await Bk(t,{},async()=>{const l=m0({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:d,apiKey:y}=t.config,A=Vk(t,d,"/v1/token",`key=${y}`),s=await t._getAdditionalHeaders();return s["Content-Type"]="application/x-www-form-urlencoded",Fk.fetch()(A,{method:"POST",headers:s,body:l})});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function t7(t,e){return id(t,"POST","/v2/accounts:revokeToken",td(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mm{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){qi(e.idToken,"internal-error"),qi(typeof e.idToken<"u","internal-error"),qi(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):CP(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){qi(e.length!==0,"internal-error");const n=CP(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(qi(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:l,refreshToken:d,expiresIn:y}=await e7(e,n);this.updateTokensAndExpiration(l,d,Number(y))}updateTokensAndExpiration(e,n,l){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+l*1e3}static fromJSON(e,n){const{refreshToken:l,accessToken:d,expirationTime:y}=n,A=new mm;return l&&(qi(typeof l=="string","internal-error",{appName:e}),A.refreshToken=l),d&&(qi(typeof d=="string","internal-error",{appName:e}),A.accessToken=d),y&&(qi(typeof y=="number","internal-error",{appName:e}),A.expirationTime=y),A}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new mm,this.toJSON())}_performRefresh(){return au("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hh(t,e){qi(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class ou{constructor(e){var{uid:n,auth:l,stsTokenManager:d}=e,y=fA(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new KG(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=n,this.auth=l,this.stsTokenManager=d,this.accessToken=d.accessToken,this.displayName=y.displayName||null,this.email=y.email||null,this.emailVerified=y.emailVerified||!1,this.phoneNumber=y.phoneNumber||null,this.photoURL=y.photoURL||null,this.isAnonymous=y.isAnonymous||!1,this.tenantId=y.tenantId||null,this.providerData=y.providerData?[...y.providerData]:[],this.metadata=new zE(y.createdAt||void 0,y.lastLoginAt||void 0)}async getIdToken(e){const n=await $y(this,this.stsTokenManager.getToken(this.auth,e));return qi(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return XG(this,e)}reload(){return QG(this)}_assign(e){this!==e&&(qi(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>Object.assign({},n)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new ou(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return n.metadata._copy(this.metadata),n}_onReload(e){qi(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let l=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),l=!0),n&&await R1(this),await this.auth._persistUserIfCurrent(this),l&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(jo(this.auth.app))return Promise.reject(hu(this.auth));const e=await this.getIdToken();return await $y(this,WG(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){var l,d,y,A,s,N,j,K;const se=(l=n.displayName)!==null&&l!==void 0?l:void 0,ae=(d=n.email)!==null&&d!==void 0?d:void 0,me=(y=n.phoneNumber)!==null&&y!==void 0?y:void 0,Ue=(A=n.photoURL)!==null&&A!==void 0?A:void 0,Xe=(s=n.tenantId)!==null&&s!==void 0?s:void 0,it=(N=n._redirectEventId)!==null&&N!==void 0?N:void 0,be=(j=n.createdAt)!==null&&j!==void 0?j:void 0,Ee=(K=n.lastLoginAt)!==null&&K!==void 0?K:void 0,{uid:Ce,emailVerified:We,isAnonymous:Ct,providerData:Ut,stsTokenManager:we}=n;qi(Ce&&we,e,"internal-error");const Ae=mm.fromJSON(this.name,we);qi(typeof Ce=="string",e,"internal-error"),hh(se,e.name),hh(ae,e.name),qi(typeof We=="boolean",e,"internal-error"),qi(typeof Ct=="boolean",e,"internal-error"),hh(me,e.name),hh(Ue,e.name),hh(Xe,e.name),hh(it,e.name),hh(be,e.name),hh(Ee,e.name);const Ve=new ou({uid:Ce,auth:e,email:ae,emailVerified:We,displayName:se,isAnonymous:Ct,photoURL:Ue,phoneNumber:me,tenantId:Xe,stsTokenManager:Ae,createdAt:be,lastLoginAt:Ee});return Ut&&Array.isArray(Ut)&&(Ve.providerData=Ut.map(De=>Object.assign({},De))),it&&(Ve._redirectEventId=it),Ve}static async _fromIdTokenResponse(e,n,l=!1){const d=new mm;d.updateFromServerResponse(n);const y=new ou({uid:n.localId,auth:e,stsTokenManager:d,isAnonymous:l});return await R1(y),y}static async _fromGetAccountInfoResponse(e,n,l){const d=n.users[0];qi(d.localId!==void 0,"internal-error");const y=d.providerUserInfo!==void 0?jk(d.providerUserInfo):[],A=!(d.email&&d.passwordHash)&&!(y!=null&&y.length),s=new mm;s.updateFromIdToken(l);const N=new ou({uid:d.localId,auth:e,stsTokenManager:s,isAnonymous:A}),j={uid:d.localId,displayName:d.displayName||null,photoURL:d.photoUrl||null,email:d.email||null,emailVerified:d.emailVerified||!1,phoneNumber:d.phoneNumber||null,tenantId:d.tenantId||null,providerData:y,metadata:new zE(d.createdAt,d.lastLoginAt),isAnonymous:!(d.email&&d.passwordHash)&&!(y!=null&&y.length)};return Object.assign(N,j),N}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RP=new Map;function lu(t){vu(t instanceof Function,"Expected a class definition");let e=RP.get(t);return e?(vu(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,RP.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qk{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}qk.type="NONE";const DP=qk;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ux(t,e,n){return`firebase:${t}:${e}:${n}`}class gm{constructor(e,n,l){this.persistence=e,this.auth=n,this.userKey=l;const{config:d,name:y}=this.auth;this.fullUserKey=Ux(this.userKey,d.apiKey,y),this.fullPersistenceKey=Ux("persistence",d.apiKey,y),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?ou._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,l="authUser"){if(!n.length)return new gm(lu(DP),e,l);const d=(await Promise.all(n.map(async j=>{if(await j._isAvailable())return j}))).filter(j=>j);let y=d[0]||lu(DP);const A=Ux(l,e.config.apiKey,e.name);let s=null;for(const j of n)try{const K=await j._get(A);if(K){const se=ou._fromJSON(e,K);j!==y&&(s=se),y=j;break}}catch{}const N=d.filter(j=>j._shouldAllowMigration);return!y._shouldAllowMigration||!N.length?new gm(y,e,l):(y=N[0],s&&await y._set(A,s.toJSON()),await Promise.all(n.map(async j=>{if(j!==y)try{await j._remove(A)}catch{}})),new gm(y,e,l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PP(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Zk(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Gk(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Xk(e))return"Blackberry";if(Yk(e))return"Webos";if(Hk(e))return"Safari";if((e.includes("chrome/")||$k(e))&&!e.includes("edge/"))return"Chrome";if(Wk(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,l=t.match(n);if((l==null?void 0:l.length)===2)return l[1]}return"Other"}function Gk(t=fa()){return/firefox\//i.test(t)}function Hk(t=fa()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function $k(t=fa()){return/crios\//i.test(t)}function Zk(t=fa()){return/iemobile/i.test(t)}function Wk(t=fa()){return/android/i.test(t)}function Xk(t=fa()){return/blackberry/i.test(t)}function Yk(t=fa()){return/webos/i.test(t)}function _A(t=fa()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function i7(t=fa()){var e;return _A(t)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function n7(){return K8()&&document.documentMode===10}function Kk(t=fa()){return _A(t)||Wk(t)||Yk(t)||Xk(t)||/windows phone/i.test(t)||Zk(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qk(t,e=[]){let n;switch(t){case"Browser":n=PP(fa());break;case"Worker":n=`${PP(fa())}-${t}`;break;default:n=t}const l=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${Zm}/${l}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r7{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const l=y=>new Promise((A,s)=>{try{const N=e(y);A(N)}catch(N){s(N)}});l.onAbort=n,this.queue.push(l);const d=this.queue.length-1;return()=>{this.queue[d]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const l of this.queue)await l(e),l.onAbort&&n.push(l.onAbort)}catch(l){n.reverse();for(const d of n)try{d()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:l==null?void 0:l.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function s7(t,e={}){return id(t,"GET","/v2/passwordPolicy",td(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const a7=6;class o7{constructor(e){var n,l,d,y;const A=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(n=A.minPasswordLength)!==null&&n!==void 0?n:a7,A.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=A.maxPasswordLength),A.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=A.containsLowercaseCharacter),A.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=A.containsUppercaseCharacter),A.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=A.containsNumericCharacter),A.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=A.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(d=(l=e.allowedNonAlphanumericCharacters)===null||l===void 0?void 0:l.join(""))!==null&&d!==void 0?d:"",this.forceUpgradeOnSignin=(y=e.forceUpgradeOnSignin)!==null&&y!==void 0?y:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var n,l,d,y,A,s;const N={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,N),this.validatePasswordCharacterOptions(e,N),N.isValid&&(N.isValid=(n=N.meetsMinPasswordLength)!==null&&n!==void 0?n:!0),N.isValid&&(N.isValid=(l=N.meetsMaxPasswordLength)!==null&&l!==void 0?l:!0),N.isValid&&(N.isValid=(d=N.containsLowercaseLetter)!==null&&d!==void 0?d:!0),N.isValid&&(N.isValid=(y=N.containsUppercaseLetter)!==null&&y!==void 0?y:!0),N.isValid&&(N.isValid=(A=N.containsNumericCharacter)!==null&&A!==void 0?A:!0),N.isValid&&(N.isValid=(s=N.containsNonAlphanumericCharacter)!==null&&s!==void 0?s:!0),N}validatePasswordLengthOptions(e,n){const l=this.customStrengthOptions.minPasswordLength,d=this.customStrengthOptions.maxPasswordLength;l&&(n.meetsMinPasswordLength=e.length>=l),d&&(n.meetsMaxPasswordLength=e.length<=d)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let l;for(let d=0;d<e.length;d++)l=e.charAt(d),this.updatePasswordCharacterOptionsStatuses(n,l>="a"&&l<="z",l>="A"&&l<="Z",l>="0"&&l<="9",this.allowedNonAlphanumericCharacters.includes(l))}updatePasswordCharacterOptionsStatuses(e,n,l,d,y){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=l)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=d)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=y))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l7{constructor(e,n,l,d){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=l,this.config=d,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new LP(this),this.idTokenSubscription=new LP(this),this.beforeStateQueue=new r7(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=kk,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=d.sdkClientVersion}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=lu(n)),this._initializationPromise=this.queue(async()=>{var l,d;if(!this._deleted&&(this.persistenceManager=await gm.create(this,e),!this._deleted)){if(!((l=this._popupRedirectResolver)===null||l===void 0)&&l._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=((d=this.currentUser)===null||d===void 0?void 0:d.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await Uk(this,{idToken:e}),l=await ou._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(l)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var n;if(jo(this.app)){const A=this.app.settings.authIdToken;return A?new Promise(s=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(A).then(s,s))}):this.directlySetCurrentUser(null)}const l=await this.assertedPersistence.getCurrentUser();let d=l,y=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const A=(n=this.redirectUser)===null||n===void 0?void 0:n._redirectEventId,s=d==null?void 0:d._redirectEventId,N=await this.tryRedirectSignIn(e);(!A||A===s)&&(N!=null&&N.user)&&(d=N.user,y=!0)}if(!d)return this.directlySetCurrentUser(null);if(!d._redirectEventId){if(y)try{await this.beforeStateQueue.runMiddleware(d)}catch(A){d=l,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(A))}return d?this.reloadAndSetCurrentUserOrClear(d):this.directlySetCurrentUser(null)}return qi(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===d._redirectEventId?this.directlySetCurrentUser(d):this.reloadAndSetCurrentUserOrClear(d)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await R1(e)}catch(n){if((n==null?void 0:n.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=UG()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(jo(this.app))return Promise.reject(hu(this));const n=e?rs(e):null;return n&&qi(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&qi(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return jo(this.app)?Promise.reject(hu(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return jo(this.app)?Promise.reject(hu(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(lu(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await s7(this),n=new o7(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new zf("auth","Firebase",e())}onAuthStateChanged(e,n,l){return this.registerStateListener(this.authStateSubscription,e,n,l)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,l){return this.registerStateListener(this.idTokenSubscription,e,n,l)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const l=this.onAuthStateChanged(()=>{l(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),l={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(l.tenantId=this.tenantId),await t7(this,l)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,n){const l=await this.getOrInitRedirectPersistenceManager(n);return e===null?l.removeCurrentUser():l.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&lu(e)||this._popupRedirectResolver;qi(n,this,"argument-error"),this.redirectPersistenceManager=await gm.create(this,[lu(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var n,l;return this._isInitialized&&await this.queue(async()=>{}),((n=this._currentUser)===null||n===void 0?void 0:n._redirectEventId)===e?this._currentUser:((l=this.redirectUser)===null||l===void 0?void 0:l._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,n;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const l=(n=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&n!==void 0?n:null;this.lastNotifiedUid!==l&&(this.lastNotifiedUid=l,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,l,d){if(this._deleted)return()=>{};const y=typeof n=="function"?n:n.next.bind(n);let A=!1;const s=this._isInitialized?Promise.resolve():this._initializationPromise;if(qi(s,this,"internal-error"),s.then(()=>{A||y(this.currentUser)}),typeof n=="function"){const N=e.addObserver(n,l,d);return()=>{A=!0,N()}}else{const N=e.addObserver(n);return()=>{A=!0,N()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return qi(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Qk(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const n={"X-Client-Version":this.clientVersion};this.app.options.appId&&(n["X-Firebase-gmpid"]=this.app.options.appId);const l=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());l&&(n["X-Firebase-Client"]=l);const d=await this._getAppCheckToken();return d&&(n["X-Firebase-AppCheck"]=d),n}async _getAppCheckToken(){var e;if(jo(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const n=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return n!=null&&n.error&&FG(`Error while retrieving App Check token: ${n.error}`),n==null?void 0:n.token}}function Of(t){return rs(t)}class LP{constructor(e){this.auth=e,this.observer=null,this.addObserver=rq(n=>this.observer=n)}get next(){return qi(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let yb={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function c7(t){yb=t}function Jk(t){return yb.loadJS(t)}function u7(){return yb.recaptchaEnterpriseScript}function h7(){return yb.gapiScript}function d7(t){return`__${t}${Math.floor(Math.random()*1e6)}`}class f7{constructor(){this.enterprise=new p7}ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}class p7{ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}const m7="recaptcha-enterprise",e4="NO_RECAPTCHA";class g7{constructor(e){this.type=m7,this.auth=Of(e)}async verify(e="verify",n=!1){async function l(y){if(!n){if(y.tenantId==null&&y._agentRecaptchaConfig!=null)return y._agentRecaptchaConfig.siteKey;if(y.tenantId!=null&&y._tenantRecaptchaConfigs[y.tenantId]!==void 0)return y._tenantRecaptchaConfigs[y.tenantId].siteKey}return new Promise(async(A,s)=>{ZG(y,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(N=>{if(N.recaptchaKey===void 0)s(new Error("recaptcha Enterprise site key undefined"));else{const j=new $G(N);return y.tenantId==null?y._agentRecaptchaConfig=j:y._tenantRecaptchaConfigs[y.tenantId]=j,A(j.siteKey)}}).catch(N=>{s(N)})})}function d(y,A,s){const N=window.grecaptcha;MP(N)?N.enterprise.ready(()=>{N.enterprise.execute(y,{action:e}).then(j=>{A(j)}).catch(()=>{A(e4)})}):s(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new f7().execute("siteKey",{action:"verify"}):new Promise((y,A)=>{l(this.auth).then(s=>{if(!n&&MP(window.grecaptcha))d(s,y,A);else{if(typeof window>"u"){A(new Error("RecaptchaVerifier is only supported in browser"));return}let N=u7();N.length!==0&&(N+=s),Jk(N).then(()=>{d(s,y,A)}).catch(j=>{A(j)})}}).catch(s=>{A(s)})})}}async function X_(t,e,n,l=!1,d=!1){const y=new g7(t);let A;if(d)A=e4;else try{A=await y.verify(n)}catch{A=await y.verify(n,!0)}const s=Object.assign({},e);if(n==="mfaSmsEnrollment"||n==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in s){const N=s.phoneEnrollmentInfo.phoneNumber,j=s.phoneEnrollmentInfo.recaptchaToken;Object.assign(s,{phoneEnrollmentInfo:{phoneNumber:N,recaptchaToken:j,captchaResponse:A,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in s){const N=s.phoneSignInInfo.recaptchaToken;Object.assign(s,{phoneSignInInfo:{recaptchaToken:N,captchaResponse:A,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return s}return l?Object.assign(s,{captchaResp:A}):Object.assign(s,{captchaResponse:A}),Object.assign(s,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(s,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),s}async function OE(t,e,n,l,d){var y,A;if(d==="EMAIL_PASSWORD_PROVIDER")if(!((y=t._getRecaptchaConfig())===null||y===void 0)&&y.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const s=await X_(t,e,n,n==="getOobCode");return l(t,s)}else return l(t,e).catch(async s=>{if(s.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const N=await X_(t,e,n,n==="getOobCode");return l(t,N)}else return Promise.reject(s)});else if(d==="PHONE_PROVIDER")if(!((A=t._getRecaptchaConfig())===null||A===void 0)&&A.isProviderEnabled("PHONE_PROVIDER")){const s=await X_(t,e,n);return l(t,s).catch(async N=>{var j;if(((j=t._getRecaptchaConfig())===null||j===void 0?void 0:j.getProviderEnforcementState("PHONE_PROVIDER"))==="AUDIT"&&(N.code==="auth/missing-recaptcha-token"||N.code==="auth/invalid-app-credential")){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${n} flow.`);const K=await X_(t,e,n,!1,!0);return l(t,K)}return Promise.reject(N)})}else{const s=await X_(t,e,n,!1,!0);return l(t,s)}else return Promise.reject(d+" provider is not supported.")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _7(t,e){const n=g0(t,"auth");if(n.isInitialized()){const d=n.getImmediate(),y=n.getOptions();if(Gh(y,e??{}))return d;El(d,"already-initialized")}return n.initialize({options:e})}function y7(t,e){const n=(e==null?void 0:e.persistence)||[],l=(Array.isArray(n)?n:[n]).map(lu);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(l,e==null?void 0:e.popupRedirectResolver)}function v7(t,e,n){const l=Of(t);qi(/^https?:\/\//.test(e),l,"invalid-emulator-scheme");const d=!!(n!=null&&n.disableWarnings),y=t4(e),{host:A,port:s}=x7(e),N=s===null?"":`:${s}`,j={url:`${y}//${A}${N}/`},K=Object.freeze({host:A,port:s,protocol:y.replace(":",""),options:Object.freeze({disableWarnings:d})});if(!l._canInitEmulator){qi(l.config.emulator&&l.emulatorConfig,l,"emulator-config-failed"),qi(Gh(j,l.config.emulator)&&Gh(K,l.emulatorConfig),l,"emulator-config-failed");return}l.config.emulator=j,l.emulatorConfig=K,l.settings.appVerificationDisabledForTesting=!0,d||b7()}function t4(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function x7(t){const e=t4(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const l=n[2].split("@").pop()||"",d=/^(\[[^\]]+\])(:|$)/.exec(l);if(d){const y=d[1];return{host:y,port:zP(l.substr(y.length+1))}}else{const[y,A]=l.split(":");return{host:y,port:zP(A)}}}function zP(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function b7(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yA{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return au("not implemented")}_getIdTokenResponse(e){return au("not implemented")}_linkToIdToken(e,n){return au("not implemented")}_getReauthenticationResolver(e){return au("not implemented")}}async function w7(t,e){return id(t,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function T7(t,e){return y0(t,"POST","/v1/accounts:signInWithPassword",td(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function E7(t,e){return y0(t,"POST","/v1/accounts:signInWithEmailLink",td(t,e))}async function S7(t,e){return y0(t,"POST","/v1/accounts:signInWithEmailLink",td(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zy extends yA{constructor(e,n,l,d=null){super("password",l),this._email=e,this._password=n,this._tenantId=d}static _fromEmailAndPassword(e,n){return new Zy(e,n,"password")}static _fromEmailAndCode(e,n,l=null){return new Zy(e,n,"emailLink",l)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n!=null&&n.email&&(n!=null&&n.password)){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return OE(e,n,"signInWithPassword",T7,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return E7(e,{email:this._email,oobCode:this._password});default:El(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":const l={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return OE(e,l,"signUpPassword",w7,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return S7(e,{idToken:n,email:this._email,oobCode:this._password});default:El(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _m(t,e){return y0(t,"POST","/v1/accounts:signInWithIdp",td(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const A7="http://localhost";class Ef extends yA{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new Ef(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):El("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:l,signInMethod:d}=n,y=fA(n,["providerId","signInMethod"]);if(!l||!d)return null;const A=new Ef(l,d);return A.idToken=y.idToken||void 0,A.accessToken=y.accessToken||void 0,A.secret=y.secret,A.nonce=y.nonce,A.pendingToken=y.pendingToken||null,A}_getIdTokenResponse(e){const n=this.buildRequest();return _m(e,n)}_linkToIdToken(e,n){const l=this.buildRequest();return l.idToken=n,_m(e,l)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,_m(e,n)}buildRequest(){const e={requestUri:A7,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=m0(n)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function I7(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function M7(t){const e=ty(iy(t)).link,n=e?ty(iy(e)).deep_link_id:null,l=ty(iy(t)).deep_link_id;return(l?ty(iy(l)).link:null)||l||n||e||t}class vA{constructor(e){var n,l,d,y,A,s;const N=ty(iy(e)),j=(n=N.apiKey)!==null&&n!==void 0?n:null,K=(l=N.oobCode)!==null&&l!==void 0?l:null,se=I7((d=N.mode)!==null&&d!==void 0?d:null);qi(j&&K&&se,"argument-error"),this.apiKey=j,this.operation=se,this.code=K,this.continueUrl=(y=N.continueUrl)!==null&&y!==void 0?y:null,this.languageCode=(A=N.languageCode)!==null&&A!==void 0?A:null,this.tenantId=(s=N.tenantId)!==null&&s!==void 0?s:null}static parseLink(e){const n=M7(e);try{return new vA(n)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wm{constructor(){this.providerId=Wm.PROVIDER_ID}static credential(e,n){return Zy._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const l=vA.parseLink(n);return qi(l,"argument-error"),Zy._fromEmailAndCode(e,l.code,l.tenantId)}}Wm.PROVIDER_ID="password";Wm.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Wm.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i4{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v0 extends i4{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vh extends v0{constructor(){super("facebook.com")}static credential(e){return Ef._fromParams({providerId:vh.PROVIDER_ID,signInMethod:vh.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return vh.credentialFromTaggedObject(e)}static credentialFromError(e){return vh.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return vh.credential(e.oauthAccessToken)}catch{return null}}}vh.FACEBOOK_SIGN_IN_METHOD="facebook.com";vh.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eu extends v0{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return Ef._fromParams({providerId:eu.PROVIDER_ID,signInMethod:eu.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return eu.credentialFromTaggedObject(e)}static credentialFromError(e){return eu.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:l}=e;if(!n&&!l)return null;try{return eu.credential(n,l)}catch{return null}}}eu.GOOGLE_SIGN_IN_METHOD="google.com";eu.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xh extends v0{constructor(){super("github.com")}static credential(e){return Ef._fromParams({providerId:xh.PROVIDER_ID,signInMethod:xh.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return xh.credentialFromTaggedObject(e)}static credentialFromError(e){return xh.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return xh.credential(e.oauthAccessToken)}catch{return null}}}xh.GITHUB_SIGN_IN_METHOD="github.com";xh.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bh extends v0{constructor(){super("twitter.com")}static credential(e,n){return Ef._fromParams({providerId:bh.PROVIDER_ID,signInMethod:bh.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return bh.credentialFromTaggedObject(e)}static credentialFromError(e){return bh.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:l}=e;if(!n||!l)return null;try{return bh.credential(n,l)}catch{return null}}}bh.TWITTER_SIGN_IN_METHOD="twitter.com";bh.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function C7(t,e){return y0(t,"POST","/v1/accounts:signUp",td(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sf{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,l,d=!1){const y=await ou._fromIdTokenResponse(e,l,d),A=OP(l);return new Sf({user:y,providerId:A,_tokenResponse:l,operationType:n})}static async _forOperation(e,n,l){await e._updateTokensIfNecessary(l,!0);const d=OP(l);return new Sf({user:e,providerId:d,_tokenResponse:l,operationType:n})}}function OP(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D1 extends Ml{constructor(e,n,l,d){var y;super(n.code,n.message),this.operationType=l,this.user=d,Object.setPrototypeOf(this,D1.prototype),this.customData={appName:e.name,tenantId:(y=e.tenantId)!==null&&y!==void 0?y:void 0,_serverResponse:n.customData._serverResponse,operationType:l}}static _fromErrorAndOperation(e,n,l,d){return new D1(e,n,l,d)}}function n4(t,e,n,l){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(y=>{throw y.code==="auth/multi-factor-auth-required"?D1._fromErrorAndOperation(t,y,e,l):y})}async function R7(t,e,n=!1){const l=await $y(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return Sf._forOperation(t,"link",l)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function D7(t,e,n=!1){const{auth:l}=t;if(jo(l.app))return Promise.reject(hu(l));const d="reauthenticate";try{const y=await $y(t,n4(l,d,e,t),n);qi(y.idToken,l,"internal-error");const A=gA(y.idToken);qi(A,l,"internal-error");const{sub:s}=A;return qi(t.uid===s,l,"user-mismatch"),Sf._forOperation(t,d,y)}catch(y){throw(y==null?void 0:y.code)==="auth/user-not-found"&&El(l,"user-mismatch"),y}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function r4(t,e,n=!1){if(jo(t.app))return Promise.reject(hu(t));const l="signIn",d=await n4(t,l,e),y=await Sf._fromIdTokenResponse(t,l,d);return n||await t._updateCurrentUser(y.user),y}async function P7(t,e){return r4(Of(t),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function s4(t){const e=Of(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function L7(t,e,n){if(jo(t.app))return Promise.reject(hu(t));const l=Of(t),A=await OE(l,{returnSecureToken:!0,email:e,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",C7,"EMAIL_PASSWORD_PROVIDER").catch(N=>{throw N.code==="auth/password-does-not-meet-requirements"&&s4(t),N}),s=await Sf._fromIdTokenResponse(l,"signIn",A);return await l._updateCurrentUser(s.user),s}function z7(t,e,n){return jo(t.app)?Promise.reject(hu(t)):P7(rs(t),Wm.credential(e,n)).catch(async l=>{throw l.code==="auth/password-does-not-meet-requirements"&&s4(t),l})}function O7(t,e,n,l){return rs(t).onIdTokenChanged(e,n,l)}function k7(t,e,n){return rs(t).beforeAuthStateChanged(e,n)}function N7(t,e,n,l){return rs(t).onAuthStateChanged(e,n,l)}function F7(t){return rs(t).signOut()}const P1="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a4{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(P1,"1"),this.storage.removeItem(P1),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const B7=1e3,V7=10;class o4 extends a4{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Kk(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const l=this.storage.getItem(n),d=this.localCache[n];l!==d&&e(n,d,l)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((A,s,N)=>{this.notifyListeners(A,N)});return}const l=e.key;n?this.detachListener():this.stopPolling();const d=()=>{const A=this.storage.getItem(l);!n&&this.localCache[l]===A||this.notifyListeners(l,A)},y=this.storage.getItem(l);n7()&&y!==e.newValue&&e.newValue!==e.oldValue?setTimeout(d,V7):d()}notifyListeners(e,n){this.localCache[e]=n;const l=this.listeners[e];if(l)for(const d of Array.from(l))d(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,l)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:l}),!0)})},B7)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}o4.type="LOCAL";const U7=o4;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l4 extends a4{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}l4.type="SESSION";const c4=l4;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function j7(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vb{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(d=>d.isListeningto(e));if(n)return n;const l=new vb(e);return this.receivers.push(l),l}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:l,eventType:d,data:y}=n.data,A=this.handlersMap[d];if(!(A!=null&&A.size))return;n.ports[0].postMessage({status:"ack",eventId:l,eventType:d});const s=Array.from(A).map(async j=>j(n.origin,y)),N=await j7(s);n.ports[0].postMessage({status:"done",eventId:l,eventType:d,response:N})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}vb.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xA(t="",e=10){let n="";for(let l=0;l<e;l++)n+=Math.floor(Math.random()*10);return t+n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q7{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,l=50){const d=typeof MessageChannel<"u"?new MessageChannel:null;if(!d)throw new Error("connection_unavailable");let y,A;return new Promise((s,N)=>{const j=xA("",20);d.port1.start();const K=setTimeout(()=>{N(new Error("unsupported_event"))},l);A={messageChannel:d,onMessage(se){const ae=se;if(ae.data.eventId===j)switch(ae.data.status){case"ack":clearTimeout(K),y=setTimeout(()=>{N(new Error("timeout"))},3e3);break;case"done":clearTimeout(y),s(ae.data.response);break;default:clearTimeout(K),clearTimeout(y),N(new Error("invalid_response"));break}}},this.handlers.add(A),d.port1.addEventListener("message",A.onMessage),this.target.postMessage({eventType:e,eventId:j,data:n},[d.port2])}).finally(()=>{A&&this.removeMessageHandler(A)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oc(){return window}function G7(t){oc().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function u4(){return typeof oc().WorkerGlobalScope<"u"&&typeof oc().importScripts=="function"}async function H7(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function $7(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)===null||t===void 0?void 0:t.controller)||null}function Z7(){return u4()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const h4="firebaseLocalStorageDb",W7=1,L1="firebaseLocalStorage",d4="fbase_key";class x0{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function xb(t,e){return t.transaction([L1],e?"readwrite":"readonly").objectStore(L1)}function X7(){const t=indexedDB.deleteDatabase(h4);return new x0(t).toPromise()}function kE(){const t=indexedDB.open(h4,W7);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const l=t.result;try{l.createObjectStore(L1,{keyPath:d4})}catch(d){n(d)}}),t.addEventListener("success",async()=>{const l=t.result;l.objectStoreNames.contains(L1)?e(l):(l.close(),await X7(),e(await kE()))})})}async function kP(t,e,n){const l=xb(t,!0).put({[d4]:e,value:n});return new x0(l).toPromise()}async function Y7(t,e){const n=xb(t,!1).get(e),l=await new x0(n).toPromise();return l===void 0?null:l.value}function NP(t,e){const n=xb(t,!0).delete(e);return new x0(n).toPromise()}const K7=800,Q7=3;class f4{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await kE(),this.db)}async _withRetries(e){let n=0;for(;;)try{const l=await this._openDb();return await e(l)}catch(l){if(n++>Q7)throw l;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return u4()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=vb._getInstance(Z7()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){var e,n;if(this.activeServiceWorker=await H7(),!this.activeServiceWorker)return;this.sender=new q7(this.activeServiceWorker);const l=await this.sender._send("ping",{},800);l&&!((e=l[0])===null||e===void 0)&&e.fulfilled&&!((n=l[0])===null||n===void 0)&&n.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||$7()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await kE();return await kP(e,P1,"1"),await NP(e,P1),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(l=>kP(l,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(l=>Y7(l,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>NP(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(d=>{const y=xb(d,!1).getAll();return new x0(y).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],l=new Set;if(e.length!==0)for(const{fbase_key:d,value:y}of e)l.add(d),JSON.stringify(this.localCache[d])!==JSON.stringify(y)&&(this.notifyListeners(d,y),n.push(d));for(const d of Object.keys(this.localCache))this.localCache[d]&&!l.has(d)&&(this.notifyListeners(d,null),n.push(d));return n}notifyListeners(e,n){this.localCache[e]=n;const l=this.listeners[e];if(l)for(const d of Array.from(l))d(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),K7)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}f4.type="LOCAL";const J7=f4;new _0(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eH(t,e){return e?lu(e):(qi(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bA extends yA{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return _m(e,this._buildIdpRequest())}_linkToIdToken(e,n){return _m(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return _m(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function tH(t){return r4(t.auth,new bA(t),t.bypassAuthState)}function iH(t){const{auth:e,user:n}=t;return qi(n,e,"internal-error"),D7(n,new bA(t),t.bypassAuthState)}async function nH(t){const{auth:e,user:n}=t;return qi(n,e,"internal-error"),R7(n,new bA(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p4{constructor(e,n,l,d,y=!1){this.auth=e,this.resolver=l,this.user=d,this.bypassAuthState=y,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(l){this.reject(l)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:l,postBody:d,tenantId:y,error:A,type:s}=e;if(A){this.reject(A);return}const N={auth:this.auth,requestUri:n,sessionId:l,tenantId:y||void 0,postBody:d||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(s)(N))}catch(j){this.reject(j)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return tH;case"linkViaPopup":case"linkViaRedirect":return nH;case"reauthViaPopup":case"reauthViaRedirect":return iH;default:El(this.auth,"internal-error")}}resolve(e){vu(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){vu(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rH=new _0(2e3,1e4);class am extends p4{constructor(e,n,l,d,y){super(e,n,d,y),this.provider=l,this.authWindow=null,this.pollId=null,am.currentPopupAction&&am.currentPopupAction.cancel(),am.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return qi(e,this.auth,"internal-error"),e}async onExecution(){vu(this.filter.length===1,"Popup operations only handle one event");const e=xA();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(ac(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(ac(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,am.currentPopupAction=null}pollUserCancellation(){const e=()=>{var n,l;if(!((l=(n=this.authWindow)===null||n===void 0?void 0:n.window)===null||l===void 0)&&l.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(ac(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,rH.get())};e()}}am.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sH="pendingRedirect",jx=new Map;class aH extends p4{constructor(e,n,l=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,l),this.eventId=null}async execute(){let e=jx.get(this.auth._key());if(!e){try{const l=await oH(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(l)}catch(n){e=()=>Promise.reject(n)}jx.set(this.auth._key(),e)}return this.bypassAuthState||jx.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function oH(t,e){const n=uH(e),l=cH(t);if(!await l._isAvailable())return!1;const d=await l._get(n)==="true";return await l._remove(n),d}function lH(t,e){jx.set(t._key(),e)}function cH(t){return lu(t._redirectPersistence)}function uH(t){return Ux(sH,t.config.apiKey,t.name)}async function hH(t,e,n=!1){if(jo(t.app))return Promise.reject(hu(t));const l=Of(t),d=eH(l,e),A=await new aH(l,d,n).execute();return A&&!n&&(delete A.user._redirectEventId,await l._persistUserIfCurrent(A.user),await l._setRedirectUser(null,e)),A}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dH=10*60*1e3;class fH{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(l=>{this.isEventForConsumer(e,l)&&(n=!0,this.sendToConsumer(e,l),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!pH(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){var l;if(e.error&&!m4(e)){const d=((l=e.error.code)===null||l===void 0?void 0:l.split("auth/")[1])||"internal-error";n.onError(ac(this.auth,d))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const l=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&l}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=dH&&this.cachedEventUids.clear(),this.cachedEventUids.has(FP(e))}saveEventToCache(e){this.cachedEventUids.add(FP(e)),this.lastProcessedEventTime=Date.now()}}function FP(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function m4({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function pH(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return m4(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function mH(t,e={}){return id(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gH=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,_H=/^https?/;async function yH(t){if(t.config.emulator)return;const{authorizedDomains:e}=await mH(t);for(const n of e)try{if(vH(n))return}catch{}El(t,"unauthorized-domain")}function vH(t){const e=LE(),{protocol:n,hostname:l}=new URL(e);if(t.startsWith("chrome-extension://")){const A=new URL(t);return A.hostname===""&&l===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&A.hostname===l}if(!_H.test(n))return!1;if(gH.test(t))return l===t;const d=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+d+"|"+d+")$","i").test(l)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xH=new _0(3e4,6e4);function BP(){const t=oc().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function bH(t){return new Promise((e,n)=>{var l,d,y;function A(){BP(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{BP(),n(ac(t,"network-request-failed"))},timeout:xH.get()})}if(!((d=(l=oc().gapi)===null||l===void 0?void 0:l.iframes)===null||d===void 0)&&d.Iframe)e(gapi.iframes.getContext());else if(!((y=oc().gapi)===null||y===void 0)&&y.load)A();else{const s=d7("iframefcb");return oc()[s]=()=>{gapi.load?A():n(ac(t,"network-request-failed"))},Jk(`${h7()}?onload=${s}`).catch(N=>n(N))}}).catch(e=>{throw qx=null,e})}let qx=null;function wH(t){return qx=qx||bH(t),qx}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TH=new _0(5e3,15e3),EH="__/auth/iframe",SH="emulator/auth/iframe",AH={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},IH=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function MH(t){const e=t.config;qi(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?mA(e,SH):`https://${t.config.authDomain}/${EH}`,l={apiKey:e.apiKey,appName:t.name,v:Zm},d=IH.get(t.config.apiHost);d&&(l.eid=d);const y=t._getFrameworks();return y.length&&(l.fw=y.join(",")),`${n}?${m0(l).slice(1)}`}async function CH(t){const e=await wH(t),n=oc().gapi;return qi(n,t,"internal-error"),e.open({where:document.body,url:MH(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:AH,dontclear:!0},l=>new Promise(async(d,y)=>{await l.restyle({setHideOnLeave:!1});const A=ac(t,"network-request-failed"),s=oc().setTimeout(()=>{y(A)},TH.get());function N(){oc().clearTimeout(s),d(l)}l.ping(N).then(N,()=>{y(A)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RH={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},DH=500,PH=600,LH="_blank",zH="http://localhost";class VP{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function OH(t,e,n,l=DH,d=PH){const y=Math.max((window.screen.availHeight-d)/2,0).toString(),A=Math.max((window.screen.availWidth-l)/2,0).toString();let s="";const N=Object.assign(Object.assign({},RH),{width:l.toString(),height:d.toString(),top:y,left:A}),j=fa().toLowerCase();n&&(s=$k(j)?LH:n),Gk(j)&&(e=e||zH,N.scrollbars="yes");const K=Object.entries(N).reduce((ae,[me,Ue])=>`${ae}${me}=${Ue},`,"");if(i7(j)&&s!=="_self")return kH(e||"",s),new VP(null);const se=window.open(e||"",s,K);qi(se,t,"popup-blocked");try{se.focus()}catch{}return new VP(se)}function kH(t,e){const n=document.createElement("a");n.href=t,n.target=e;const l=document.createEvent("MouseEvent");l.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(l)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NH="__/auth/handler",FH="emulator/auth/handler",BH=encodeURIComponent("fac");async function UP(t,e,n,l,d,y){qi(t.config.authDomain,t,"auth-domain-config-required"),qi(t.config.apiKey,t,"invalid-api-key");const A={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:l,v:Zm,eventId:d};if(e instanceof i4){e.setDefaultLanguage(t.languageCode),A.providerId=e.providerId||"",nq(e.getCustomParameters())||(A.customParameters=JSON.stringify(e.getCustomParameters()));for(const[K,se]of Object.entries(y||{}))A[K]=se}if(e instanceof v0){const K=e.getScopes().filter(se=>se!=="");K.length>0&&(A.scopes=K.join(","))}t.tenantId&&(A.tid=t.tenantId);const s=A;for(const K of Object.keys(s))s[K]===void 0&&delete s[K];const N=await t._getAppCheckToken(),j=N?`#${BH}=${encodeURIComponent(N)}`:"";return`${VH(t)}?${m0(s).slice(1)}${j}`}function VH({config:t}){return t.emulator?mA(t,FH):`https://${t.authDomain}/${NH}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const I2="webStorageSupport";class UH{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=c4,this._completeRedirectFn=hH,this._overrideRedirectResult=lH}async _openPopup(e,n,l,d){var y;vu((y=this.eventManagers[e._key()])===null||y===void 0?void 0:y.manager,"_initialize() not called before _openPopup()");const A=await UP(e,n,l,LE(),d);return OH(e,A,xA())}async _openRedirect(e,n,l,d){await this._originValidation(e);const y=await UP(e,n,l,LE(),d);return G7(y),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:d,promise:y}=this.eventManagers[n];return d?Promise.resolve(d):(vu(y,"If manager is not set, promise should be"),y)}const l=this.initAndGetManager(e);return this.eventManagers[n]={promise:l},l.catch(()=>{delete this.eventManagers[n]}),l}async initAndGetManager(e){const n=await CH(e),l=new fH(e);return n.register("authEvent",d=>(qi(d==null?void 0:d.authEvent,e,"invalid-auth-event"),{status:l.onEvent(d.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:l},this.iframes[e._key()]=n,l}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(I2,{type:I2},d=>{var y;const A=(y=d==null?void 0:d[0])===null||y===void 0?void 0:y[I2];A!==void 0&&n(!!A),El(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=yH(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return Kk()||Hk()||_A()}}const jH=UH;var jP="@firebase/auth",qP="1.9.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qH{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(l=>{e((l==null?void 0:l.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){qi(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GH(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function HH(t){hc(new Tl("auth",(e,{options:n})=>{const l=e.getProvider("app").getImmediate(),d=e.getProvider("heartbeat"),y=e.getProvider("app-check-internal"),{apiKey:A,authDomain:s}=l.options;qi(A&&!A.includes(":"),"invalid-api-key",{appName:l.name});const N={apiKey:A,authDomain:s,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Qk(t)},j=new l7(l,d,y,N);return y7(j,n),j},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,l)=>{e.getProvider("auth-internal").initialize()})),hc(new Tl("auth-internal",e=>{const n=Of(e.getProvider("auth").getImmediate());return(l=>new qH(l))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),$o(jP,qP,GH(t)),$o(jP,qP,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $H=5*60,ZH=ik("authIdTokenMaxAge")||$H;let GP=null;const WH=t=>async e=>{const n=e&&await e.getIdTokenResult(),l=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(l&&l>ZH)return;const d=n==null?void 0:n.token;GP!==d&&(GP=d,await fetch(t,{method:d?"POST":"DELETE",headers:d?{Authorization:`Bearer ${d}`}:{}}))};function XH(t=uk()){const e=g0(t,"auth");if(e.isInitialized())return e.getImmediate();const n=_7(t,{popupRedirectResolver:jH,persistence:[J7,U7,c4]}),l=ik("authTokenSyncURL");if(l&&typeof isSecureContext=="boolean"&&isSecureContext){const y=new URL(l,location.origin);if(location.origin===y.origin){const A=WH(y.toString());k7(n,A,()=>A(n.currentUser)),O7(n,s=>A(s))}}const d=ek("auth");return d&&v7(n,`http://${d}`),n}function YH(){var t,e;return(e=(t=document.getElementsByTagName("head"))===null||t===void 0?void 0:t[0])!==null&&e!==void 0?e:document}c7({loadJS(t){return new Promise((e,n)=>{const l=document.createElement("script");l.setAttribute("src",t),l.onload=e,l.onerror=d=>{const y=ac("internal-error");y.customData=d,n(y)},l.type="text/javascript",l.charset="UTF-8",YH().appendChild(l)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});HH("Browser");var HP=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var kh,g4;(function(){var t;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(we,Ae){function Ve(){}Ve.prototype=Ae.prototype,we.D=Ae.prototype,we.prototype=new Ve,we.prototype.constructor=we,we.C=function(De,je,pt){for(var Ye=Array(arguments.length-2),Or=2;Or<arguments.length;Or++)Ye[Or-2]=arguments[Or];return Ae.prototype[je].apply(De,Ye)}}function n(){this.blockSize=-1}function l(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(l,n),l.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function d(we,Ae,Ve){Ve||(Ve=0);var De=Array(16);if(typeof Ae=="string")for(var je=0;16>je;++je)De[je]=Ae.charCodeAt(Ve++)|Ae.charCodeAt(Ve++)<<8|Ae.charCodeAt(Ve++)<<16|Ae.charCodeAt(Ve++)<<24;else for(je=0;16>je;++je)De[je]=Ae[Ve++]|Ae[Ve++]<<8|Ae[Ve++]<<16|Ae[Ve++]<<24;Ae=we.g[0],Ve=we.g[1],je=we.g[2];var pt=we.g[3],Ye=Ae+(pt^Ve&(je^pt))+De[0]+3614090360&4294967295;Ae=Ve+(Ye<<7&4294967295|Ye>>>25),Ye=pt+(je^Ae&(Ve^je))+De[1]+3905402710&4294967295,pt=Ae+(Ye<<12&4294967295|Ye>>>20),Ye=je+(Ve^pt&(Ae^Ve))+De[2]+606105819&4294967295,je=pt+(Ye<<17&4294967295|Ye>>>15),Ye=Ve+(Ae^je&(pt^Ae))+De[3]+3250441966&4294967295,Ve=je+(Ye<<22&4294967295|Ye>>>10),Ye=Ae+(pt^Ve&(je^pt))+De[4]+4118548399&4294967295,Ae=Ve+(Ye<<7&4294967295|Ye>>>25),Ye=pt+(je^Ae&(Ve^je))+De[5]+1200080426&4294967295,pt=Ae+(Ye<<12&4294967295|Ye>>>20),Ye=je+(Ve^pt&(Ae^Ve))+De[6]+2821735955&4294967295,je=pt+(Ye<<17&4294967295|Ye>>>15),Ye=Ve+(Ae^je&(pt^Ae))+De[7]+4249261313&4294967295,Ve=je+(Ye<<22&4294967295|Ye>>>10),Ye=Ae+(pt^Ve&(je^pt))+De[8]+1770035416&4294967295,Ae=Ve+(Ye<<7&4294967295|Ye>>>25),Ye=pt+(je^Ae&(Ve^je))+De[9]+2336552879&4294967295,pt=Ae+(Ye<<12&4294967295|Ye>>>20),Ye=je+(Ve^pt&(Ae^Ve))+De[10]+4294925233&4294967295,je=pt+(Ye<<17&4294967295|Ye>>>15),Ye=Ve+(Ae^je&(pt^Ae))+De[11]+2304563134&4294967295,Ve=je+(Ye<<22&4294967295|Ye>>>10),Ye=Ae+(pt^Ve&(je^pt))+De[12]+1804603682&4294967295,Ae=Ve+(Ye<<7&4294967295|Ye>>>25),Ye=pt+(je^Ae&(Ve^je))+De[13]+4254626195&4294967295,pt=Ae+(Ye<<12&4294967295|Ye>>>20),Ye=je+(Ve^pt&(Ae^Ve))+De[14]+2792965006&4294967295,je=pt+(Ye<<17&4294967295|Ye>>>15),Ye=Ve+(Ae^je&(pt^Ae))+De[15]+1236535329&4294967295,Ve=je+(Ye<<22&4294967295|Ye>>>10),Ye=Ae+(je^pt&(Ve^je))+De[1]+4129170786&4294967295,Ae=Ve+(Ye<<5&4294967295|Ye>>>27),Ye=pt+(Ve^je&(Ae^Ve))+De[6]+3225465664&4294967295,pt=Ae+(Ye<<9&4294967295|Ye>>>23),Ye=je+(Ae^Ve&(pt^Ae))+De[11]+643717713&4294967295,je=pt+(Ye<<14&4294967295|Ye>>>18),Ye=Ve+(pt^Ae&(je^pt))+De[0]+3921069994&4294967295,Ve=je+(Ye<<20&4294967295|Ye>>>12),Ye=Ae+(je^pt&(Ve^je))+De[5]+3593408605&4294967295,Ae=Ve+(Ye<<5&4294967295|Ye>>>27),Ye=pt+(Ve^je&(Ae^Ve))+De[10]+38016083&4294967295,pt=Ae+(Ye<<9&4294967295|Ye>>>23),Ye=je+(Ae^Ve&(pt^Ae))+De[15]+3634488961&4294967295,je=pt+(Ye<<14&4294967295|Ye>>>18),Ye=Ve+(pt^Ae&(je^pt))+De[4]+3889429448&4294967295,Ve=je+(Ye<<20&4294967295|Ye>>>12),Ye=Ae+(je^pt&(Ve^je))+De[9]+568446438&4294967295,Ae=Ve+(Ye<<5&4294967295|Ye>>>27),Ye=pt+(Ve^je&(Ae^Ve))+De[14]+3275163606&4294967295,pt=Ae+(Ye<<9&4294967295|Ye>>>23),Ye=je+(Ae^Ve&(pt^Ae))+De[3]+4107603335&4294967295,je=pt+(Ye<<14&4294967295|Ye>>>18),Ye=Ve+(pt^Ae&(je^pt))+De[8]+1163531501&4294967295,Ve=je+(Ye<<20&4294967295|Ye>>>12),Ye=Ae+(je^pt&(Ve^je))+De[13]+2850285829&4294967295,Ae=Ve+(Ye<<5&4294967295|Ye>>>27),Ye=pt+(Ve^je&(Ae^Ve))+De[2]+4243563512&4294967295,pt=Ae+(Ye<<9&4294967295|Ye>>>23),Ye=je+(Ae^Ve&(pt^Ae))+De[7]+1735328473&4294967295,je=pt+(Ye<<14&4294967295|Ye>>>18),Ye=Ve+(pt^Ae&(je^pt))+De[12]+2368359562&4294967295,Ve=je+(Ye<<20&4294967295|Ye>>>12),Ye=Ae+(Ve^je^pt)+De[5]+4294588738&4294967295,Ae=Ve+(Ye<<4&4294967295|Ye>>>28),Ye=pt+(Ae^Ve^je)+De[8]+2272392833&4294967295,pt=Ae+(Ye<<11&4294967295|Ye>>>21),Ye=je+(pt^Ae^Ve)+De[11]+1839030562&4294967295,je=pt+(Ye<<16&4294967295|Ye>>>16),Ye=Ve+(je^pt^Ae)+De[14]+4259657740&4294967295,Ve=je+(Ye<<23&4294967295|Ye>>>9),Ye=Ae+(Ve^je^pt)+De[1]+2763975236&4294967295,Ae=Ve+(Ye<<4&4294967295|Ye>>>28),Ye=pt+(Ae^Ve^je)+De[4]+1272893353&4294967295,pt=Ae+(Ye<<11&4294967295|Ye>>>21),Ye=je+(pt^Ae^Ve)+De[7]+4139469664&4294967295,je=pt+(Ye<<16&4294967295|Ye>>>16),Ye=Ve+(je^pt^Ae)+De[10]+3200236656&4294967295,Ve=je+(Ye<<23&4294967295|Ye>>>9),Ye=Ae+(Ve^je^pt)+De[13]+681279174&4294967295,Ae=Ve+(Ye<<4&4294967295|Ye>>>28),Ye=pt+(Ae^Ve^je)+De[0]+3936430074&4294967295,pt=Ae+(Ye<<11&4294967295|Ye>>>21),Ye=je+(pt^Ae^Ve)+De[3]+3572445317&4294967295,je=pt+(Ye<<16&4294967295|Ye>>>16),Ye=Ve+(je^pt^Ae)+De[6]+76029189&4294967295,Ve=je+(Ye<<23&4294967295|Ye>>>9),Ye=Ae+(Ve^je^pt)+De[9]+3654602809&4294967295,Ae=Ve+(Ye<<4&4294967295|Ye>>>28),Ye=pt+(Ae^Ve^je)+De[12]+3873151461&4294967295,pt=Ae+(Ye<<11&4294967295|Ye>>>21),Ye=je+(pt^Ae^Ve)+De[15]+530742520&4294967295,je=pt+(Ye<<16&4294967295|Ye>>>16),Ye=Ve+(je^pt^Ae)+De[2]+3299628645&4294967295,Ve=je+(Ye<<23&4294967295|Ye>>>9),Ye=Ae+(je^(Ve|~pt))+De[0]+4096336452&4294967295,Ae=Ve+(Ye<<6&4294967295|Ye>>>26),Ye=pt+(Ve^(Ae|~je))+De[7]+1126891415&4294967295,pt=Ae+(Ye<<10&4294967295|Ye>>>22),Ye=je+(Ae^(pt|~Ve))+De[14]+2878612391&4294967295,je=pt+(Ye<<15&4294967295|Ye>>>17),Ye=Ve+(pt^(je|~Ae))+De[5]+4237533241&4294967295,Ve=je+(Ye<<21&4294967295|Ye>>>11),Ye=Ae+(je^(Ve|~pt))+De[12]+1700485571&4294967295,Ae=Ve+(Ye<<6&4294967295|Ye>>>26),Ye=pt+(Ve^(Ae|~je))+De[3]+2399980690&4294967295,pt=Ae+(Ye<<10&4294967295|Ye>>>22),Ye=je+(Ae^(pt|~Ve))+De[10]+4293915773&4294967295,je=pt+(Ye<<15&4294967295|Ye>>>17),Ye=Ve+(pt^(je|~Ae))+De[1]+2240044497&4294967295,Ve=je+(Ye<<21&4294967295|Ye>>>11),Ye=Ae+(je^(Ve|~pt))+De[8]+1873313359&4294967295,Ae=Ve+(Ye<<6&4294967295|Ye>>>26),Ye=pt+(Ve^(Ae|~je))+De[15]+4264355552&4294967295,pt=Ae+(Ye<<10&4294967295|Ye>>>22),Ye=je+(Ae^(pt|~Ve))+De[6]+2734768916&4294967295,je=pt+(Ye<<15&4294967295|Ye>>>17),Ye=Ve+(pt^(je|~Ae))+De[13]+1309151649&4294967295,Ve=je+(Ye<<21&4294967295|Ye>>>11),Ye=Ae+(je^(Ve|~pt))+De[4]+4149444226&4294967295,Ae=Ve+(Ye<<6&4294967295|Ye>>>26),Ye=pt+(Ve^(Ae|~je))+De[11]+3174756917&4294967295,pt=Ae+(Ye<<10&4294967295|Ye>>>22),Ye=je+(Ae^(pt|~Ve))+De[2]+718787259&4294967295,je=pt+(Ye<<15&4294967295|Ye>>>17),Ye=Ve+(pt^(je|~Ae))+De[9]+3951481745&4294967295,we.g[0]=we.g[0]+Ae&4294967295,we.g[1]=we.g[1]+(je+(Ye<<21&4294967295|Ye>>>11))&4294967295,we.g[2]=we.g[2]+je&4294967295,we.g[3]=we.g[3]+pt&4294967295}l.prototype.u=function(we,Ae){Ae===void 0&&(Ae=we.length);for(var Ve=Ae-this.blockSize,De=this.B,je=this.h,pt=0;pt<Ae;){if(je==0)for(;pt<=Ve;)d(this,we,pt),pt+=this.blockSize;if(typeof we=="string"){for(;pt<Ae;)if(De[je++]=we.charCodeAt(pt++),je==this.blockSize){d(this,De),je=0;break}}else for(;pt<Ae;)if(De[je++]=we[pt++],je==this.blockSize){d(this,De),je=0;break}}this.h=je,this.o+=Ae},l.prototype.v=function(){var we=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);we[0]=128;for(var Ae=1;Ae<we.length-8;++Ae)we[Ae]=0;var Ve=8*this.o;for(Ae=we.length-8;Ae<we.length;++Ae)we[Ae]=Ve&255,Ve/=256;for(this.u(we),we=Array(16),Ae=Ve=0;4>Ae;++Ae)for(var De=0;32>De;De+=8)we[Ve++]=this.g[Ae]>>>De&255;return we};function y(we,Ae){var Ve=s;return Object.prototype.hasOwnProperty.call(Ve,we)?Ve[we]:Ve[we]=Ae(we)}function A(we,Ae){this.h=Ae;for(var Ve=[],De=!0,je=we.length-1;0<=je;je--){var pt=we[je]|0;De&&pt==Ae||(Ve[je]=pt,De=!1)}this.g=Ve}var s={};function N(we){return-128<=we&&128>we?y(we,function(Ae){return new A([Ae|0],0>Ae?-1:0)}):new A([we|0],0>we?-1:0)}function j(we){if(isNaN(we)||!isFinite(we))return se;if(0>we)return it(j(-we));for(var Ae=[],Ve=1,De=0;we>=Ve;De++)Ae[De]=we/Ve|0,Ve*=4294967296;return new A(Ae,0)}function K(we,Ae){if(we.length==0)throw Error("number format error: empty string");if(Ae=Ae||10,2>Ae||36<Ae)throw Error("radix out of range: "+Ae);if(we.charAt(0)=="-")return it(K(we.substring(1),Ae));if(0<=we.indexOf("-"))throw Error('number format error: interior "-" character');for(var Ve=j(Math.pow(Ae,8)),De=se,je=0;je<we.length;je+=8){var pt=Math.min(8,we.length-je),Ye=parseInt(we.substring(je,je+pt),Ae);8>pt?(pt=j(Math.pow(Ae,pt)),De=De.j(pt).add(j(Ye))):(De=De.j(Ve),De=De.add(j(Ye)))}return De}var se=N(0),ae=N(1),me=N(16777216);t=A.prototype,t.m=function(){if(Xe(this))return-it(this).m();for(var we=0,Ae=1,Ve=0;Ve<this.g.length;Ve++){var De=this.i(Ve);we+=(0<=De?De:4294967296+De)*Ae,Ae*=4294967296}return we},t.toString=function(we){if(we=we||10,2>we||36<we)throw Error("radix out of range: "+we);if(Ue(this))return"0";if(Xe(this))return"-"+it(this).toString(we);for(var Ae=j(Math.pow(we,6)),Ve=this,De="";;){var je=We(Ve,Ae).g;Ve=be(Ve,je.j(Ae));var pt=((0<Ve.g.length?Ve.g[0]:Ve.h)>>>0).toString(we);if(Ve=je,Ue(Ve))return pt+De;for(;6>pt.length;)pt="0"+pt;De=pt+De}},t.i=function(we){return 0>we?0:we<this.g.length?this.g[we]:this.h};function Ue(we){if(we.h!=0)return!1;for(var Ae=0;Ae<we.g.length;Ae++)if(we.g[Ae]!=0)return!1;return!0}function Xe(we){return we.h==-1}t.l=function(we){return we=be(this,we),Xe(we)?-1:Ue(we)?0:1};function it(we){for(var Ae=we.g.length,Ve=[],De=0;De<Ae;De++)Ve[De]=~we.g[De];return new A(Ve,~we.h).add(ae)}t.abs=function(){return Xe(this)?it(this):this},t.add=function(we){for(var Ae=Math.max(this.g.length,we.g.length),Ve=[],De=0,je=0;je<=Ae;je++){var pt=De+(this.i(je)&65535)+(we.i(je)&65535),Ye=(pt>>>16)+(this.i(je)>>>16)+(we.i(je)>>>16);De=Ye>>>16,pt&=65535,Ye&=65535,Ve[je]=Ye<<16|pt}return new A(Ve,Ve[Ve.length-1]&-2147483648?-1:0)};function be(we,Ae){return we.add(it(Ae))}t.j=function(we){if(Ue(this)||Ue(we))return se;if(Xe(this))return Xe(we)?it(this).j(it(we)):it(it(this).j(we));if(Xe(we))return it(this.j(it(we)));if(0>this.l(me)&&0>we.l(me))return j(this.m()*we.m());for(var Ae=this.g.length+we.g.length,Ve=[],De=0;De<2*Ae;De++)Ve[De]=0;for(De=0;De<this.g.length;De++)for(var je=0;je<we.g.length;je++){var pt=this.i(De)>>>16,Ye=this.i(De)&65535,Or=we.i(je)>>>16,di=we.i(je)&65535;Ve[2*De+2*je]+=Ye*di,Ee(Ve,2*De+2*je),Ve[2*De+2*je+1]+=pt*di,Ee(Ve,2*De+2*je+1),Ve[2*De+2*je+1]+=Ye*Or,Ee(Ve,2*De+2*je+1),Ve[2*De+2*je+2]+=pt*Or,Ee(Ve,2*De+2*je+2)}for(De=0;De<Ae;De++)Ve[De]=Ve[2*De+1]<<16|Ve[2*De];for(De=Ae;De<2*Ae;De++)Ve[De]=0;return new A(Ve,0)};function Ee(we,Ae){for(;(we[Ae]&65535)!=we[Ae];)we[Ae+1]+=we[Ae]>>>16,we[Ae]&=65535,Ae++}function Ce(we,Ae){this.g=we,this.h=Ae}function We(we,Ae){if(Ue(Ae))throw Error("division by zero");if(Ue(we))return new Ce(se,se);if(Xe(we))return Ae=We(it(we),Ae),new Ce(it(Ae.g),it(Ae.h));if(Xe(Ae))return Ae=We(we,it(Ae)),new Ce(it(Ae.g),Ae.h);if(30<we.g.length){if(Xe(we)||Xe(Ae))throw Error("slowDivide_ only works with positive integers.");for(var Ve=ae,De=Ae;0>=De.l(we);)Ve=Ct(Ve),De=Ct(De);var je=Ut(Ve,1),pt=Ut(De,1);for(De=Ut(De,2),Ve=Ut(Ve,2);!Ue(De);){var Ye=pt.add(De);0>=Ye.l(we)&&(je=je.add(Ve),pt=Ye),De=Ut(De,1),Ve=Ut(Ve,1)}return Ae=be(we,je.j(Ae)),new Ce(je,Ae)}for(je=se;0<=we.l(Ae);){for(Ve=Math.max(1,Math.floor(we.m()/Ae.m())),De=Math.ceil(Math.log(Ve)/Math.LN2),De=48>=De?1:Math.pow(2,De-48),pt=j(Ve),Ye=pt.j(Ae);Xe(Ye)||0<Ye.l(we);)Ve-=De,pt=j(Ve),Ye=pt.j(Ae);Ue(pt)&&(pt=ae),je=je.add(pt),we=be(we,Ye)}return new Ce(je,we)}t.A=function(we){return We(this,we).h},t.and=function(we){for(var Ae=Math.max(this.g.length,we.g.length),Ve=[],De=0;De<Ae;De++)Ve[De]=this.i(De)&we.i(De);return new A(Ve,this.h&we.h)},t.or=function(we){for(var Ae=Math.max(this.g.length,we.g.length),Ve=[],De=0;De<Ae;De++)Ve[De]=this.i(De)|we.i(De);return new A(Ve,this.h|we.h)},t.xor=function(we){for(var Ae=Math.max(this.g.length,we.g.length),Ve=[],De=0;De<Ae;De++)Ve[De]=this.i(De)^we.i(De);return new A(Ve,this.h^we.h)};function Ct(we){for(var Ae=we.g.length+1,Ve=[],De=0;De<Ae;De++)Ve[De]=we.i(De)<<1|we.i(De-1)>>>31;return new A(Ve,we.h)}function Ut(we,Ae){var Ve=Ae>>5;Ae%=32;for(var De=we.g.length-Ve,je=[],pt=0;pt<De;pt++)je[pt]=0<Ae?we.i(pt+Ve)>>>Ae|we.i(pt+Ve+1)<<32-Ae:we.i(pt+Ve);return new A(je,we.h)}l.prototype.digest=l.prototype.v,l.prototype.reset=l.prototype.s,l.prototype.update=l.prototype.u,g4=l,A.prototype.add=A.prototype.add,A.prototype.multiply=A.prototype.j,A.prototype.modulo=A.prototype.A,A.prototype.compare=A.prototype.l,A.prototype.toNumber=A.prototype.m,A.prototype.toString=A.prototype.toString,A.prototype.getBits=A.prototype.i,A.fromNumber=j,A.fromString=K,kh=A}).apply(typeof HP<"u"?HP:typeof self<"u"?self:typeof window<"u"?window:{});var xx=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var _4,ny,y4,Gx,NE,v4,x4,b4;(function(){var t,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(L,Z,re){return L==Array.prototype||L==Object.prototype||(L[Z]=re.value),L};function n(L){L=[typeof globalThis=="object"&&globalThis,L,typeof window=="object"&&window,typeof self=="object"&&self,typeof xx=="object"&&xx];for(var Z=0;Z<L.length;++Z){var re=L[Z];if(re&&re.Math==Math)return re}throw Error("Cannot find global object")}var l=n(this);function d(L,Z){if(Z)e:{var re=l;L=L.split(".");for(var Se=0;Se<L.length-1;Se++){var gt=L[Se];if(!(gt in re))break e;re=re[gt]}L=L[L.length-1],Se=re[L],Z=Z(Se),Z!=Se&&Z!=null&&e(re,L,{configurable:!0,writable:!0,value:Z})}}function y(L,Z){L instanceof String&&(L+="");var re=0,Se=!1,gt={next:function(){if(!Se&&re<L.length){var Tt=re++;return{value:Z(Tt,L[Tt]),done:!1}}return Se=!0,{done:!0,value:void 0}}};return gt[Symbol.iterator]=function(){return gt},gt}d("Array.prototype.values",function(L){return L||function(){return y(this,function(Z,re){return re})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var A=A||{},s=this||self;function N(L){var Z=typeof L;return Z=Z!="object"?Z:L?Array.isArray(L)?"array":Z:"null",Z=="array"||Z=="object"&&typeof L.length=="number"}function j(L){var Z=typeof L;return Z=="object"&&L!=null||Z=="function"}function K(L,Z,re){return L.call.apply(L.bind,arguments)}function se(L,Z,re){if(!L)throw Error();if(2<arguments.length){var Se=Array.prototype.slice.call(arguments,2);return function(){var gt=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(gt,Se),L.apply(Z,gt)}}return function(){return L.apply(Z,arguments)}}function ae(L,Z,re){return ae=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?K:se,ae.apply(null,arguments)}function me(L,Z){var re=Array.prototype.slice.call(arguments,1);return function(){var Se=re.slice();return Se.push.apply(Se,arguments),L.apply(this,Se)}}function Ue(L,Z){function re(){}re.prototype=Z.prototype,L.aa=Z.prototype,L.prototype=new re,L.prototype.constructor=L,L.Qb=function(Se,gt,Tt){for(var Yt=Array(arguments.length-2),ni=2;ni<arguments.length;ni++)Yt[ni-2]=arguments[ni];return Z.prototype[gt].apply(Se,Yt)}}function Xe(L){const Z=L.length;if(0<Z){const re=Array(Z);for(let Se=0;Se<Z;Se++)re[Se]=L[Se];return re}return[]}function it(L,Z){for(let re=1;re<arguments.length;re++){const Se=arguments[re];if(N(Se)){const gt=L.length||0,Tt=Se.length||0;L.length=gt+Tt;for(let Yt=0;Yt<Tt;Yt++)L[gt+Yt]=Se[Yt]}else L.push(Se)}}class be{constructor(Z,re){this.i=Z,this.j=re,this.h=0,this.g=null}get(){let Z;return 0<this.h?(this.h--,Z=this.g,this.g=Z.next,Z.next=null):Z=this.i(),Z}}function Ee(L){return/^[\s\xa0]*$/.test(L)}function Ce(){var L=s.navigator;return L&&(L=L.userAgent)?L:""}function We(L){return We[" "](L),L}We[" "]=function(){};var Ct=Ce().indexOf("Gecko")!=-1&&!(Ce().toLowerCase().indexOf("webkit")!=-1&&Ce().indexOf("Edge")==-1)&&!(Ce().indexOf("Trident")!=-1||Ce().indexOf("MSIE")!=-1)&&Ce().indexOf("Edge")==-1;function Ut(L,Z,re){for(const Se in L)Z.call(re,L[Se],Se,L)}function we(L,Z){for(const re in L)Z.call(void 0,L[re],re,L)}function Ae(L){const Z={};for(const re in L)Z[re]=L[re];return Z}const Ve="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function De(L,Z){let re,Se;for(let gt=1;gt<arguments.length;gt++){Se=arguments[gt];for(re in Se)L[re]=Se[re];for(let Tt=0;Tt<Ve.length;Tt++)re=Ve[Tt],Object.prototype.hasOwnProperty.call(Se,re)&&(L[re]=Se[re])}}function je(L){var Z=1;L=L.split(":");const re=[];for(;0<Z&&L.length;)re.push(L.shift()),Z--;return L.length&&re.push(L.join(":")),re}function pt(L){s.setTimeout(()=>{throw L},0)}function Ye(){var L=ai;let Z=null;return L.g&&(Z=L.g,L.g=L.g.next,L.g||(L.h=null),Z.next=null),Z}class Or{constructor(){this.h=this.g=null}add(Z,re){const Se=di.get();Se.set(Z,re),this.h?this.h.next=Se:this.g=Se,this.h=Se}}var di=new be(()=>new Qt,L=>L.reset());class Qt{constructor(){this.next=this.g=this.h=null}set(Z,re){this.h=Z,this.g=re,this.next=null}reset(){this.next=this.g=this.h=null}}let Ai,Mi=!1,ai=new Or,pn=()=>{const L=s.Promise.resolve(void 0);Ai=()=>{L.then(oi)}};var oi=()=>{for(var L;L=Ye();){try{L.h.call(L.g)}catch(re){pt(re)}var Z=di;Z.j(L),100>Z.h&&(Z.h++,L.next=Z.g,Z.g=L)}Mi=!1};function Wi(){this.s=this.s,this.C=this.C}Wi.prototype.s=!1,Wi.prototype.ma=function(){this.s||(this.s=!0,this.N())},Wi.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function $t(L,Z){this.type=L,this.g=this.target=Z,this.defaultPrevented=!1}$t.prototype.h=function(){this.defaultPrevented=!0};var Nn=function(){if(!s.addEventListener||!Object.defineProperty)return!1;var L=!1,Z=Object.defineProperty({},"passive",{get:function(){L=!0}});try{const re=()=>{};s.addEventListener("test",re,Z),s.removeEventListener("test",re,Z)}catch{}return L}();function _n(L,Z){if($t.call(this,L?L.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,L){var re=this.type=L.type,Se=L.changedTouches&&L.changedTouches.length?L.changedTouches[0]:null;if(this.target=L.target||L.srcElement,this.g=Z,Z=L.relatedTarget){if(Ct){e:{try{We(Z.nodeName);var gt=!0;break e}catch{}gt=!1}gt||(Z=null)}}else re=="mouseover"?Z=L.fromElement:re=="mouseout"&&(Z=L.toElement);this.relatedTarget=Z,Se?(this.clientX=Se.clientX!==void 0?Se.clientX:Se.pageX,this.clientY=Se.clientY!==void 0?Se.clientY:Se.pageY,this.screenX=Se.screenX||0,this.screenY=Se.screenY||0):(this.clientX=L.clientX!==void 0?L.clientX:L.pageX,this.clientY=L.clientY!==void 0?L.clientY:L.pageY,this.screenX=L.screenX||0,this.screenY=L.screenY||0),this.button=L.button,this.key=L.key||"",this.ctrlKey=L.ctrlKey,this.altKey=L.altKey,this.shiftKey=L.shiftKey,this.metaKey=L.metaKey,this.pointerId=L.pointerId||0,this.pointerType=typeof L.pointerType=="string"?L.pointerType:Sr[L.pointerType]||"",this.state=L.state,this.i=L,L.defaultPrevented&&_n.aa.h.call(this)}}Ue(_n,$t);var Sr={2:"touch",3:"pen",4:"mouse"};_n.prototype.h=function(){_n.aa.h.call(this);var L=this.i;L.preventDefault?L.preventDefault():L.returnValue=!1};var Cs="closure_listenable_"+(1e6*Math.random()|0),Rs=0;function ss(L,Z,re,Se,gt){this.listener=L,this.proxy=null,this.src=Z,this.type=re,this.capture=!!Se,this.ha=gt,this.key=++Rs,this.da=this.fa=!1}function ke(L){L.da=!0,L.listener=null,L.proxy=null,L.src=null,L.ha=null}function rr(L){this.src=L,this.g={},this.h=0}rr.prototype.add=function(L,Z,re,Se,gt){var Tt=L.toString();L=this.g[Tt],L||(L=this.g[Tt]=[],this.h++);var Yt=Zs(L,Z,Se,gt);return-1<Yt?(Z=L[Yt],re||(Z.fa=!1)):(Z=new ss(Z,this.src,Tt,!!Se,gt),Z.fa=re,L.push(Z)),Z};function pa(L,Z){var re=Z.type;if(re in L.g){var Se=L.g[re],gt=Array.prototype.indexOf.call(Se,Z,void 0),Tt;(Tt=0<=gt)&&Array.prototype.splice.call(Se,gt,1),Tt&&(ke(Z),L.g[re].length==0&&(delete L.g[re],L.h--))}}function Zs(L,Z,re,Se){for(var gt=0;gt<L.length;++gt){var Tt=L[gt];if(!Tt.da&&Tt.listener==Z&&Tt.capture==!!re&&Tt.ha==Se)return gt}return-1}var St="closure_lm_"+(1e6*Math.random()|0),cr={};function Wr(L,Z,re,Se,gt){if(Se&&Se.once)return vr(L,Z,re,Se,gt);if(Array.isArray(Z)){for(var Tt=0;Tt<Z.length;Tt++)Wr(L,Z[Tt],re,Se,gt);return null}return re=Ps(re),L&&L[Cs]?L.K(Z,re,j(Se)?!!Se.capture:!!Se,gt):Ko(L,Z,re,!1,Se,gt)}function Ko(L,Z,re,Se,gt,Tt){if(!Z)throw Error("Invalid event type");var Yt=j(gt)?!!gt.capture:!!gt,ni=bi(L);if(ni||(L[St]=ni=new rr(L)),re=ni.add(Z,re,Se,Yt,Tt),re.proxy)return re;if(Se=Li(),re.proxy=Se,Se.src=L,Se.listener=re,L.addEventListener)Nn||(gt=Yt),gt===void 0&&(gt=!1),L.addEventListener(Z.toString(),Se,gt);else if(L.attachEvent)L.attachEvent(go(Z.toString()),Se);else if(L.addListener&&L.removeListener)L.addListener(Se);else throw Error("addEventListener and attachEvent are unavailable.");return re}function Li(){function L(re){return Z.call(L.src,L.listener,re)}const Z=Qo;return L}function vr(L,Z,re,Se,gt){if(Array.isArray(Z)){for(var Tt=0;Tt<Z.length;Tt++)vr(L,Z[Tt],re,Se,gt);return null}return re=Ps(re),L&&L[Cs]?L.L(Z,re,j(Se)?!!Se.capture:!!Se,gt):Ko(L,Z,re,!0,Se,gt)}function Ds(L,Z,re,Se,gt){if(Array.isArray(Z))for(var Tt=0;Tt<Z.length;Tt++)Ds(L,Z[Tt],re,Se,gt);else Se=j(Se)?!!Se.capture:!!Se,re=Ps(re),L&&L[Cs]?(L=L.i,Z=String(Z).toString(),Z in L.g&&(Tt=L.g[Z],re=Zs(Tt,re,Se,gt),-1<re&&(ke(Tt[re]),Array.prototype.splice.call(Tt,re,1),Tt.length==0&&(delete L.g[Z],L.h--)))):L&&(L=bi(L))&&(Z=L.g[Z.toString()],L=-1,Z&&(L=Zs(Z,re,Se,gt)),(re=-1<L?Z[L]:null)&&Da(re))}function Da(L){if(typeof L!="number"&&L&&!L.da){var Z=L.src;if(Z&&Z[Cs])pa(Z.i,L);else{var re=L.type,Se=L.proxy;Z.removeEventListener?Z.removeEventListener(re,Se,L.capture):Z.detachEvent?Z.detachEvent(go(re),Se):Z.addListener&&Z.removeListener&&Z.removeListener(Se),(re=bi(Z))?(pa(re,L),re.h==0&&(re.src=null,Z[St]=null)):ke(L)}}}function go(L){return L in cr?cr[L]:cr[L]="on"+L}function Qo(L,Z){if(L.da)L=!0;else{Z=new _n(Z,this);var re=L.listener,Se=L.ha||L.src;L.fa&&Da(L),L=re.call(Se,Z)}return L}function bi(L){return L=L[St],L instanceof rr?L:null}var Ws="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ps(L){return typeof L=="function"?L:(L[Ws]||(L[Ws]=function(Z){return L.handleEvent(Z)}),L[Ws])}function Yn(){Wi.call(this),this.i=new rr(this),this.M=this,this.F=null}Ue(Yn,Wi),Yn.prototype[Cs]=!0,Yn.prototype.removeEventListener=function(L,Z,re,Se){Ds(this,L,Z,re,Se)};function Sn(L,Z){var re,Se=L.F;if(Se)for(re=[];Se;Se=Se.F)re.push(Se);if(L=L.M,Se=Z.type||Z,typeof Z=="string")Z=new $t(Z,L);else if(Z instanceof $t)Z.target=Z.target||L;else{var gt=Z;Z=new $t(Se,L),De(Z,gt)}if(gt=!0,re)for(var Tt=re.length-1;0<=Tt;Tt--){var Yt=Z.g=re[Tt];gt=Xs(Yt,Se,!0,Z)&&gt}if(Yt=Z.g=L,gt=Xs(Yt,Se,!0,Z)&&gt,gt=Xs(Yt,Se,!1,Z)&&gt,re)for(Tt=0;Tt<re.length;Tt++)Yt=Z.g=re[Tt],gt=Xs(Yt,Se,!1,Z)&&gt}Yn.prototype.N=function(){if(Yn.aa.N.call(this),this.i){var L=this.i,Z;for(Z in L.g){for(var re=L.g[Z],Se=0;Se<re.length;Se++)ke(re[Se]);delete L.g[Z],L.h--}}this.F=null},Yn.prototype.K=function(L,Z,re,Se){return this.i.add(String(L),Z,!1,re,Se)},Yn.prototype.L=function(L,Z,re,Se){return this.i.add(String(L),Z,!0,re,Se)};function Xs(L,Z,re,Se){if(Z=L.i.g[String(Z)],!Z)return!0;Z=Z.concat();for(var gt=!0,Tt=0;Tt<Z.length;++Tt){var Yt=Z[Tt];if(Yt&&!Yt.da&&Yt.capture==re){var ni=Yt.listener,Ht=Yt.ha||Yt.src;Yt.fa&&pa(L.i,Yt),gt=ni.call(Ht,Se)!==!1&&gt}}return gt&&!Se.defaultPrevented}function _o(L,Z,re){if(typeof L=="function")re&&(L=ae(L,re));else if(L&&typeof L.handleEvent=="function")L=ae(L.handleEvent,L);else throw Error("Invalid listener argument");return 2147483647<Number(Z)?-1:s.setTimeout(L,Z||0)}function Jo(L){L.g=_o(()=>{L.g=null,L.i&&(L.i=!1,Jo(L))},L.l);const Z=L.h;L.h=null,L.m.apply(null,Z)}class Rl extends Wi{constructor(Z,re){super(),this.m=Z,this.l=re,this.h=null,this.i=!1,this.g=null}j(Z){this.h=arguments,this.g?this.i=!0:Jo(this)}N(){super.N(),this.g&&(s.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ar(L){Wi.call(this),this.h=L,this.g={}}Ue(Ar,Wi);var el=[];function tl(L){Ut(L.g,function(Z,re){this.g.hasOwnProperty(re)&&Da(Z)},L),L.g={}}Ar.prototype.N=function(){Ar.aa.N.call(this),tl(this)},Ar.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var as=s.JSON.stringify,il=s.JSON.parse,yi=class{stringify(L){return s.JSON.stringify(L,void 0)}parse(L){return s.JSON.parse(L,void 0)}};function Ys(){}Ys.prototype.h=null;function gc(L){return L.h||(L.h=L.i())}function os(){}var Ls={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function yo(){$t.call(this,"d")}Ue(yo,$t);function vo(){$t.call(this,"c")}Ue(vo,$t);var Ks={},_c=null;function Ha(){return _c=_c||new Yn}Ks.La="serverreachability";function yc(L){$t.call(this,Ks.La,L)}Ue(yc,$t);function xo(L){const Z=Ha();Sn(Z,new yc(Z))}Ks.STAT_EVENT="statevent";function Kn(L,Z){$t.call(this,Ks.STAT_EVENT,L),this.stat=Z}Ue(Kn,$t);function Ir(L){const Z=Ha();Sn(Z,new Kn(Z,L))}Ks.Ma="timingevent";function vc(L,Z){$t.call(this,Ks.Ma,L),this.size=Z}Ue(vc,$t);function $a(L,Z){if(typeof L!="function")throw Error("Fn must not be null and must be a function");return s.setTimeout(function(){L()},Z)}function sr(){this.g=!0}sr.prototype.xa=function(){this.g=!1};function Pa(L,Z,re,Se,gt,Tt){L.info(function(){if(L.g)if(Tt)for(var Yt="",ni=Tt.split("&"),Ht=0;Ht<ni.length;Ht++){var on=ni[Ht].split("=");if(1<on.length){var Kt=on[0];on=on[1];var hr=Kt.split("_");Yt=2<=hr.length&&hr[1]=="type"?Yt+(Kt+"="+on+"&"):Yt+(Kt+"=redacted&")}}else Yt=null;else Yt=Tt;return"XMLHTTP REQ ("+Se+") [attempt "+gt+"]: "+Z+`
`+re+`
`+Yt})}function nt(L,Z,re,Se,gt,Tt,Yt){L.info(function(){return"XMLHTTP RESP ("+Se+") [ attempt "+gt+"]: "+Z+`
`+re+`
`+Tt+" "+Yt})}function X(L,Z,re,Se){L.info(function(){return"XMLHTTP TEXT ("+Z+"): "+oe(L,re)+(Se?" "+Se:"")})}function ne(L,Z){L.info(function(){return"TIMEOUT: "+Z})}sr.prototype.info=function(){};function oe(L,Z){if(!L.g)return Z;if(!Z)return null;try{var re=JSON.parse(Z);if(re){for(L=0;L<re.length;L++)if(Array.isArray(re[L])){var Se=re[L];if(!(2>Se.length)){var gt=Se[1];if(Array.isArray(gt)&&!(1>gt.length)){var Tt=gt[0];if(Tt!="noop"&&Tt!="stop"&&Tt!="close")for(var Yt=1;Yt<gt.length;Yt++)gt[Yt]=""}}}}return as(re)}catch{return Z}}var ye={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},ve={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Le;function Ge(){}Ue(Ge,Ys),Ge.prototype.g=function(){return new XMLHttpRequest},Ge.prototype.i=function(){return{}},Le=new Ge;function Oe(L,Z,re,Se){this.j=L,this.i=Z,this.l=re,this.R=Se||1,this.U=new Ar(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new et}function et(){this.i=null,this.g="",this.h=!1}var Je={},tt={};function mt(L,Z,re){L.L=1,L.v=zs(Gn(Z)),L.m=re,L.P=!0,At(L,null)}function At(L,Z){L.F=Date.now(),si(L),L.A=Gn(L.v);var re=L.A,Se=L.R;Array.isArray(Se)||(Se=[String(Se)]),wc(re.i,"t",Se),L.C=0,re=L.j.J,L.h=new et,L.g=Bl(L.j,re?Z:null,!L.m),0<L.O&&(L.M=new Rl(ae(L.Y,L,L.g),L.O)),Z=L.U,re=L.g,Se=L.ca;var gt="readystatechange";Array.isArray(gt)||(gt&&(el[0]=gt.toString()),gt=el);for(var Tt=0;Tt<gt.length;Tt++){var Yt=Wr(re,gt[Tt],Se||Z.handleEvent,!1,Z.h||Z);if(!Yt)break;Z.g[Yt.key]=Yt}Z=L.H?Ae(L.H):{},L.m?(L.u||(L.u="POST"),Z["Content-Type"]="application/x-www-form-urlencoded",L.g.ea(L.A,L.u,L.m,Z)):(L.u="GET",L.g.ea(L.A,L.u,null,Z)),xo(),Pa(L.i,L.u,L.A,L.l,L.R,L.m)}Oe.prototype.ca=function(L){L=L.target;const Z=this.M;Z&&Fn(L)==3?Z.j():this.Y(L)},Oe.prototype.Y=function(L){try{if(L==this.g)e:{const hr=Fn(this.g);var Z=this.g.Ba();const Qa=this.g.Z();if(!(3>hr)&&(hr!=3||this.g&&(this.h.h||this.g.oa()||Iu(this.g)))){this.J||hr!=4||Z==7||(Z==8||0>=Qa?xo(3):xo(2)),ii(this);var re=this.g.Z();this.X=re;t:if(Rt(this)){var Se=Iu(this.g);L="";var gt=Se.length,Tt=Fn(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Ii(this),Si(this);var Yt="";break t}this.h.i=new s.TextDecoder}for(Z=0;Z<gt;Z++)this.h.h=!0,L+=this.h.i.decode(Se[Z],{stream:!(Tt&&Z==gt-1)});Se.length=0,this.h.g+=L,this.C=0,Yt=this.h.g}else Yt=this.g.oa();if(this.o=re==200,nt(this.i,this.u,this.A,this.l,this.R,hr,re),this.o){if(this.T&&!this.K){t:{if(this.g){var ni,Ht=this.g;if((ni=Ht.g?Ht.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Ee(ni)){var on=ni;break t}}on=null}if(re=on)X(this.i,this.l,re,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,wi(this,re);else{this.o=!1,this.s=3,Ir(12),Ii(this),Si(this);break e}}if(this.P){re=!0;let li;for(;!this.J&&this.C<Yt.length;)if(li=Jt(this,Yt),li==tt){hr==4&&(this.s=4,Ir(14),re=!1),X(this.i,this.l,null,"[Incomplete Response]");break}else if(li==Je){this.s=4,Ir(15),X(this.i,this.l,Yt,"[Invalid Chunk]"),re=!1;break}else X(this.i,this.l,li,null),wi(this,li);if(Rt(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),hr!=4||Yt.length!=0||this.h.h||(this.s=1,Ir(16),re=!1),this.o=this.o&&re,!re)X(this.i,this.l,Yt,"[Invalid Chunked Response]"),Ii(this),Si(this);else if(0<Yt.length&&!this.W){this.W=!0;var Kt=this.j;Kt.g==this&&Kt.ba&&!Kt.M&&(Kt.j.info("Great, no buffering proxy detected. Bytes received: "+Yt.length),Ec(Kt),Kt.M=!0,Ir(11))}}else X(this.i,this.l,Yt,null),wi(this,Yt);hr==4&&Ii(this),this.o&&!this.J&&(hr==4?Sc(this.j,this):(this.o=!1,si(this)))}else Ka(this.g),re==400&&0<Yt.indexOf("Unknown SID")?(this.s=3,Ir(12)):(this.s=0,Ir(13)),Ii(this),Si(this)}}}catch{}finally{}};function Rt(L){return L.g?L.u=="GET"&&L.L!=2&&L.j.Ca:!1}function Jt(L,Z){var re=L.C,Se=Z.indexOf(`
`,re);return Se==-1?tt:(re=Number(Z.substring(re,Se)),isNaN(re)?Je:(Se+=1,Se+re>Z.length?tt:(Z=Z.slice(Se,Se+re),L.C=Se+re,Z)))}Oe.prototype.cancel=function(){this.J=!0,Ii(this)};function si(L){L.S=Date.now()+L.I,ci(L,L.I)}function ci(L,Z){if(L.B!=null)throw Error("WatchDog timer not null");L.B=$a(ae(L.ba,L),Z)}function ii(L){L.B&&(s.clearTimeout(L.B),L.B=null)}Oe.prototype.ba=function(){this.B=null;const L=Date.now();0<=L-this.S?(ne(this.i,this.A),this.L!=2&&(xo(),Ir(17)),Ii(this),this.s=2,Si(this)):ci(this,this.S-L)};function Si(L){L.j.G==0||L.J||Sc(L.j,L)}function Ii(L){ii(L);var Z=L.M;Z&&typeof Z.ma=="function"&&Z.ma(),L.M=null,tl(L.U),L.g&&(Z=L.g,L.g=null,Z.abort(),Z.ma())}function wi(L,Z){try{var re=L.j;if(re.G!=0&&(re.g==L||qn(re.h,L))){if(!L.K&&qn(re.h,L)&&re.G==3){try{var Se=re.Da.g.parse(Z)}catch{Se=null}if(Array.isArray(Se)&&Se.length==3){var gt=Se;if(gt[0]==0){e:if(!re.u){if(re.g)if(re.g.F+3e3<L.F)Nl(re),Ln(re);else break e;ud(re),Ir(18)}}else re.za=gt[1],0<re.za-re.T&&37500>gt[2]&&re.F&&re.v==0&&!re.C&&(re.C=$a(ae(re.Za,re),6e3));if(1>=ma(re.h)&&re.ca){try{re.ca()}catch{}re.ca=void 0}}else ya(re,11)}else if((L.K||re.g==L)&&Nl(re),!Ee(Z))for(gt=re.Da.g.parse(Z),Z=0;Z<gt.length;Z++){let on=gt[Z];if(re.T=on[0],on=on[1],re.G==2)if(on[0]=="c"){re.K=on[1],re.ia=on[2];const Kt=on[3];Kt!=null&&(re.la=Kt,re.j.info("VER="+re.la));const hr=on[4];hr!=null&&(re.Aa=hr,re.j.info("SVER="+re.Aa));const Qa=on[5];Qa!=null&&typeof Qa=="number"&&0<Qa&&(Se=1.5*Qa,re.L=Se,re.j.info("backChannelRequestTimeoutMs_="+Se)),Se=re;const li=L.g;if(li){const Ja=li.g?li.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Ja){var Tt=Se.h;Tt.g||Ja.indexOf("spdy")==-1&&Ja.indexOf("quic")==-1&&Ja.indexOf("h2")==-1||(Tt.j=Tt.l,Tt.g=new Set,Tt.h&&(Qn(Tt,Tt.h),Tt.h=null))}if(Se.D){const eo=li.g?li.g.getResponseHeader("X-HTTP-Session-Id"):null;eo&&(Se.ya=eo,an(Se.I,Se.D,eo))}}re.G=3,re.l&&re.l.ua(),re.ba&&(re.R=Date.now()-L.F,re.j.info("Handshake RTT: "+re.R+"ms")),Se=re;var Yt=L;if(Se.qa=Vf(Se,Se.J?Se.ia:null,Se.W),Yt.K){Ur(Se.h,Yt);var ni=Yt,Ht=Se.L;Ht&&(ni.I=Ht),ni.B&&(ii(ni),si(ni)),Se.g=Yt}else La(Se);0<re.i.length&&bs(re)}else on[0]!="stop"&&on[0]!="close"||ya(re,7);else re.G==3&&(on[0]=="stop"||on[0]=="close"?on[0]=="stop"?ya(re,7):ur(re):on[0]!="noop"&&re.l&&re.l.ta(on),re.v=0)}}xo(4)}catch{}}var Vi=class{constructor(L,Z){this.g=L,this.map=Z}};function Ui(L){this.l=L||10,s.PerformanceNavigationTiming?(L=s.performance.getEntriesByType("navigation"),L=0<L.length&&(L[0].nextHopProtocol=="hq"||L[0].nextHopProtocol=="h2")):L=!!(s.chrome&&s.chrome.loadTimes&&s.chrome.loadTimes()&&s.chrome.loadTimes().wasFetchedViaSpdy),this.j=L?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Un(L){return L.h?!0:L.g?L.g.size>=L.j:!1}function ma(L){return L.h?1:L.g?L.g.size:0}function qn(L,Z){return L.h?L.h==Z:L.g?L.g.has(Z):!1}function Qn(L,Z){L.g?L.g.add(Z):L.h=Z}function Ur(L,Z){L.h&&L.h==Z?L.h=null:L.g&&L.g.has(Z)&&L.g.delete(Z)}Ui.prototype.cancel=function(){if(this.i=Dl(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const L of this.g.values())L.cancel();this.g.clear()}};function Dl(L){if(L.h!=null)return L.i.concat(L.h.D);if(L.g!=null&&L.g.size!==0){let Z=L.i;for(const re of L.g.values())Z=Z.concat(re.D);return Z}return Xe(L.i)}function Za(L){if(L.V&&typeof L.V=="function")return L.V();if(typeof Map<"u"&&L instanceof Map||typeof Set<"u"&&L instanceof Set)return Array.from(L.values());if(typeof L=="string")return L.split("");if(N(L)){for(var Z=[],re=L.length,Se=0;Se<re;Se++)Z.push(L[Se]);return Z}Z=[],re=0;for(Se in L)Z[re++]=L[Se];return Z}function xc(L){if(L.na&&typeof L.na=="function")return L.na();if(!L.V||typeof L.V!="function"){if(typeof Map<"u"&&L instanceof Map)return Array.from(L.keys());if(!(typeof Set<"u"&&L instanceof Set)){if(N(L)||typeof L=="string"){var Z=[];L=L.length;for(var re=0;re<L;re++)Z.push(re);return Z}Z=[],re=0;for(const Se in L)Z[re++]=Se;return Z}}}function Eu(L,Z){if(L.forEach&&typeof L.forEach=="function")L.forEach(Z,void 0);else if(N(L)||typeof L=="string")Array.prototype.forEach.call(L,Z,void 0);else for(var re=xc(L),Se=Za(L),gt=Se.length,Tt=0;Tt<gt;Tt++)Z.call(void 0,Se[Tt],re&&re[Tt],L)}var ad=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function od(L,Z){if(L){L=L.split("&");for(var re=0;re<L.length;re++){var Se=L[re].indexOf("="),gt=null;if(0<=Se){var Tt=L[re].substring(0,Se);gt=L[re].substring(Se+1)}else Tt=L[re];Z(Tt,gt?decodeURIComponent(gt.replace(/\+/g," ")):"")}}}function Wa(L){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,L instanceof Wa){this.h=L.h,vs(this,L.j),this.o=L.o,this.g=L.g,Qs(this,L.s),this.l=L.l;var Z=L.i,re=new rl;re.i=Z.i,Z.g&&(re.g=new Map(Z.g),re.h=Z.h),ga(this,re),this.m=L.m}else L&&(Z=String(L).match(ad))?(this.h=!1,vs(this,Z[1]||"",!0),this.o=bo(Z[2]||""),this.g=bo(Z[3]||"",!0),Qs(this,Z[4]),this.l=bo(Z[5]||"",!0),ga(this,Z[6]||"",!0),this.m=bo(Z[7]||"")):(this.h=!1,this.i=new rl(null,this.h))}Wa.prototype.toString=function(){var L=[],Z=this.j;Z&&L.push(nl(Z,Xa,!0),":");var re=this.g;return(re||Z=="file")&&(L.push("//"),(Z=this.o)&&L.push(nl(Z,Xa,!0),"@"),L.push(encodeURIComponent(String(re)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),re=this.s,re!=null&&L.push(":",String(re))),(re=this.l)&&(this.g&&re.charAt(0)!="/"&&L.push("/"),L.push(nl(re,re.charAt(0)=="/"?ld:Ff,!0))),(re=this.i.toString())&&L.push("?",re),(re=this.m)&&L.push("#",nl(re,$i)),L.join("")};function Gn(L){return new Wa(L)}function vs(L,Z,re){L.j=re?bo(Z,!0):Z,L.j&&(L.j=L.j.replace(/:$/,""))}function Qs(L,Z){if(Z){if(Z=Number(Z),isNaN(Z)||0>Z)throw Error("Bad port number "+Z);L.s=Z}else L.s=null}function ga(L,Z,re){Z instanceof rl?(L.i=Z,Su(L.i,L.h)):(re||(Z=nl(Z,Js)),L.i=new rl(Z,L.h))}function an(L,Z,re){L.i.set(Z,re)}function zs(L){return an(L,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),L}function bo(L,Z){return L?Z?decodeURI(L.replace(/%25/g,"%2525")):decodeURIComponent(L):""}function nl(L,Z,re){return typeof L=="string"?(L=encodeURI(L).replace(Z,wo),re&&(L=L.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),L):null}function wo(L){return L=L.charCodeAt(0),"%"+(L>>4&15).toString(16)+(L&15).toString(16)}var Xa=/[#\/\?@]/g,Ff=/[#\?:]/g,ld=/[#\?]/g,Js=/[#\?@]/g,$i=/#/g;function rl(L,Z){this.h=this.g=null,this.i=L||null,this.j=!!Z}function ei(L){L.g||(L.g=new Map,L.h=0,L.i&&od(L.i,function(Z,re){L.add(decodeURIComponent(Z.replace(/\+/g," ")),re)}))}t=rl.prototype,t.add=function(L,Z){ei(this),this.i=null,L=vi(this,L);var re=this.g.get(L);return re||this.g.set(L,re=[]),re.push(Z),this.h+=1,this};function cd(L,Z){ei(L),Z=vi(L,Z),L.g.has(Z)&&(L.i=null,L.h-=L.g.get(Z).length,L.g.delete(Z))}function bc(L,Z){return ei(L),Z=vi(L,Z),L.g.has(Z)}t.forEach=function(L,Z){ei(this),this.g.forEach(function(re,Se){re.forEach(function(gt){L.call(Z,gt,Se,this)},this)},this)},t.na=function(){ei(this);const L=Array.from(this.g.values()),Z=Array.from(this.g.keys()),re=[];for(let Se=0;Se<Z.length;Se++){const gt=L[Se];for(let Tt=0;Tt<gt.length;Tt++)re.push(Z[Se])}return re},t.V=function(L){ei(this);let Z=[];if(typeof L=="string")bc(this,L)&&(Z=Z.concat(this.g.get(vi(this,L))));else{L=Array.from(this.g.values());for(let re=0;re<L.length;re++)Z=Z.concat(L[re])}return Z},t.set=function(L,Z){return ei(this),this.i=null,L=vi(this,L),bc(this,L)&&(this.h-=this.g.get(L).length),this.g.set(L,[Z]),this.h+=1,this},t.get=function(L,Z){return L?(L=this.V(L),0<L.length?String(L[0]):Z):Z};function wc(L,Z,re){cd(L,Z),0<re.length&&(L.i=null,L.g.set(vi(L,Z),Xe(re)),L.h+=re.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const L=[],Z=Array.from(this.g.keys());for(var re=0;re<Z.length;re++){var Se=Z[re];const Tt=encodeURIComponent(String(Se)),Yt=this.V(Se);for(Se=0;Se<Yt.length;Se++){var gt=Tt;Yt[Se]!==""&&(gt+="="+encodeURIComponent(String(Yt[Se]))),L.push(gt)}}return this.i=L.join("&")};function vi(L,Z){return Z=String(Z),L.j&&(Z=Z.toLowerCase()),Z}function Su(L,Z){Z&&!L.j&&(ei(L),L.i=null,L.g.forEach(function(re,Se){var gt=Se.toLowerCase();Se!=gt&&(cd(this,Se),wc(this,gt,re))},L)),L.j=Z}function sl(L,Z){const re=new sr;if(s.Image){const Se=new Image;Se.onload=me(zi,re,"TestLoadImage: loaded",!0,Z,Se),Se.onerror=me(zi,re,"TestLoadImage: error",!1,Z,Se),Se.onabort=me(zi,re,"TestLoadImage: abort",!1,Z,Se),Se.ontimeout=me(zi,re,"TestLoadImage: timeout",!1,Z,Se),s.setTimeout(function(){Se.ontimeout&&Se.ontimeout()},1e4),Se.src=L}else Z(!1)}function qt(L,Z){const re=new sr,Se=new AbortController,gt=setTimeout(()=>{Se.abort(),zi(re,"TestPingServer: timeout",!1,Z)},1e4);fetch(L,{signal:Se.signal}).then(Tt=>{clearTimeout(gt),Tt.ok?zi(re,"TestPingServer: ok",!0,Z):zi(re,"TestPingServer: server error",!1,Z)}).catch(()=>{clearTimeout(gt),zi(re,"TestPingServer: error",!1,Z)})}function zi(L,Z,re,Se,gt){try{gt&&(gt.onload=null,gt.onerror=null,gt.onabort=null,gt.ontimeout=null),Se(re)}catch{}}function Ni(){this.g=new yi}function jr(L,Z,re){const Se=re||"";try{Eu(L,function(gt,Tt){let Yt=gt;j(gt)&&(Yt=as(gt)),Z.push(Se+Tt+"="+encodeURIComponent(Yt))})}catch(gt){throw Z.push(Se+"type="+encodeURIComponent("_badmap")),gt}}function ea(L){this.l=L.Ub||null,this.j=L.eb||!1}Ue(ea,Ys),ea.prototype.g=function(){return new Oi(this.l,this.j)},ea.prototype.i=function(L){return function(){return L}}({});function Oi(L,Z){Yn.call(this),this.D=L,this.o=Z,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}Ue(Oi,Yn),t=Oi.prototype,t.open=function(L,Z){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=L,this.A=Z,this.readyState=1,Ya(this)},t.send=function(L){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const Z={headers:this.u,method:this.B,credentials:this.m,cache:void 0};L&&(Z.body=L),(this.D||s).fetch(new Request(this.A,Z)).then(this.Sa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,xs(this)),this.readyState=0},t.Sa=function(L){if(this.g&&(this.l=L,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=L.headers,this.readyState=2,Ya(this)),this.g&&(this.readyState=3,Ya(this),this.g)))if(this.responseType==="arraybuffer")L.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof s.ReadableStream<"u"&&"body"in L){if(this.j=L.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Pl(this)}else L.text().then(this.Ra.bind(this),this.ga.bind(this))};function Pl(L){L.j.read().then(L.Pa.bind(L)).catch(L.ga.bind(L))}t.Pa=function(L){if(this.g){if(this.o&&L.value)this.response.push(L.value);else if(!this.o){var Z=L.value?L.value:new Uint8Array(0);(Z=this.v.decode(Z,{stream:!L.done}))&&(this.response=this.responseText+=Z)}L.done?xs(this):Ya(this),this.readyState==3&&Pl(this)}},t.Ra=function(L){this.g&&(this.response=this.responseText=L,xs(this))},t.Qa=function(L){this.g&&(this.response=L,xs(this))},t.ga=function(){this.g&&xs(this)};function xs(L){L.readyState=4,L.l=null,L.j=null,L.v=null,Ya(L)}t.setRequestHeader=function(L,Z){this.u.append(L,Z)},t.getResponseHeader=function(L){return this.h&&this.h.get(L.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const L=[],Z=this.h.entries();for(var re=Z.next();!re.done;)re=re.value,L.push(re[0]+": "+re[1]),re=Z.next();return L.join(`\r
`)};function Ya(L){L.onreadystatechange&&L.onreadystatechange.call(L)}Object.defineProperty(Oi.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(L){this.m=L?"include":"same-origin"}});function xr(L){let Z="";return Ut(L,function(re,Se){Z+=Se,Z+=":",Z+=re,Z+=`\r
`}),Z}function Rn(L,Z,re){e:{for(Se in re){var Se=!1;break e}Se=!0}Se||(re=xr(re),typeof L=="string"?re!=null&&encodeURIComponent(String(re)):an(L,Z,re))}function Hn(L){Yn.call(this),this.headers=new Map,this.o=L||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}Ue(Hn,Yn);var ls=/^https?$/i,Au=["POST","PUT"];t=Hn.prototype,t.Ha=function(L){this.J=L},t.ea=function(L,Z,re,Se){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+L);Z=Z?Z.toUpperCase():"GET",this.D=L,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Le.g(),this.v=this.o?gc(this.o):gc(Le),this.g.onreadystatechange=ae(this.Ea,this);try{this.B=!0,this.g.open(Z,String(L),!0),this.B=!1}catch(Tt){Ll(this,Tt);return}if(L=re||"",re=new Map(this.headers),Se)if(Object.getPrototypeOf(Se)===Object.prototype)for(var gt in Se)re.set(gt,Se[gt]);else if(typeof Se.keys=="function"&&typeof Se.get=="function")for(const Tt of Se.keys())re.set(Tt,Se.get(Tt));else throw Error("Unknown input type for opt_headers: "+String(Se));Se=Array.from(re.keys()).find(Tt=>Tt.toLowerCase()=="content-type"),gt=s.FormData&&L instanceof s.FormData,!(0<=Array.prototype.indexOf.call(Au,Z,void 0))||Se||gt||re.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[Tt,Yt]of re)this.g.setRequestHeader(Tt,Yt);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{_a(this),this.u=!0,this.g.send(L),this.u=!1}catch(Tt){Ll(this,Tt)}};function Ll(L,Z){L.h=!1,L.g&&(L.j=!0,L.g.abort(),L.j=!1),L.l=Z,L.m=5,Tc(L),br(L)}function Tc(L){L.A||(L.A=!0,Sn(L,"complete"),Sn(L,"error"))}t.abort=function(L){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=L||7,Sn(this,"complete"),Sn(this,"abort"),br(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),br(this,!0)),Hn.aa.N.call(this)},t.Ea=function(){this.s||(this.B||this.u||this.j?zl(this):this.bb())},t.bb=function(){zl(this)};function zl(L){if(L.h&&typeof A<"u"&&(!L.v[1]||Fn(L)!=4||L.Z()!=2)){if(L.u&&Fn(L)==4)_o(L.Ea,0,L);else if(Sn(L,"readystatechange"),Fn(L)==4){L.h=!1;try{const Yt=L.Z();e:switch(Yt){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var Z=!0;break e;default:Z=!1}var re;if(!(re=Z)){var Se;if(Se=Yt===0){var gt=String(L.D).match(ad)[1]||null;!gt&&s.self&&s.self.location&&(gt=s.self.location.protocol.slice(0,-1)),Se=!ls.test(gt?gt.toLowerCase():"")}re=Se}if(re)Sn(L,"complete"),Sn(L,"success");else{L.m=6;try{var Tt=2<Fn(L)?L.g.statusText:""}catch{Tt=""}L.l=Tt+" ["+L.Z()+"]",Tc(L)}}finally{br(L)}}}}function br(L,Z){if(L.g){_a(L);const re=L.g,Se=L.v[0]?()=>{}:null;L.g=null,L.v=null,Z||Sn(L,"ready");try{re.onreadystatechange=Se}catch{}}}function _a(L){L.I&&(s.clearTimeout(L.I),L.I=null)}t.isActive=function(){return!!this.g};function Fn(L){return L.g?L.g.readyState:0}t.Z=function(){try{return 2<Fn(this)?this.g.status:-1}catch{return-1}},t.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.Oa=function(L){if(this.g){var Z=this.g.responseText;return L&&Z.indexOf(L)==0&&(Z=Z.substring(L.length)),il(Z)}};function Iu(L){try{if(!L.g)return null;if("response"in L.g)return L.g.response;switch(L.H){case"":case"text":return L.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in L.g)return L.g.mozResponseArrayBuffer}return null}catch{return null}}function Ka(L){const Z={};L=(L.g&&2<=Fn(L)&&L.g.getAllResponseHeaders()||"").split(`\r
`);for(let Se=0;Se<L.length;Se++){if(Ee(L[Se]))continue;var re=je(L[Se]);const gt=re[0];if(re=re[1],typeof re!="string")continue;re=re.trim();const Tt=Z[gt]||[];Z[gt]=Tt,Tt.push(re)}we(Z,function(Se){return Se.join(", ")})}t.Ba=function(){return this.m},t.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function yn(L,Z,re){return re&&re.internalChannelParams&&re.internalChannelParams[L]||Z}function Os(L){this.Aa=0,this.i=[],this.j=new sr,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=yn("failFast",!1,L),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=yn("baseRetryDelayMs",5e3,L),this.cb=yn("retryDelaySeedMs",1e4,L),this.Wa=yn("forwardChannelMaxRetries",2,L),this.wa=yn("forwardChannelRequestTimeoutMs",2e4,L),this.pa=L&&L.xmlHttpFactory||void 0,this.Xa=L&&L.Tb||void 0,this.Ca=L&&L.useFetchStreams||!1,this.L=void 0,this.J=L&&L.supportsCrossDomainXhr||!1,this.K="",this.h=new Ui(L&&L.concurrentRequestLimit),this.Da=new Ni,this.P=L&&L.fastHandshake||!1,this.O=L&&L.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=L&&L.Rb||!1,L&&L.xa&&this.j.xa(),L&&L.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&L&&L.detectBufferingProxy||!1,this.ja=void 0,L&&L.longPollingTimeout&&0<L.longPollingTimeout&&(this.ja=L.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}t=Os.prototype,t.la=8,t.G=1,t.connect=function(L,Z,re,Se){Ir(0),this.W=L,this.H=Z||{},re&&Se!==void 0&&(this.H.OSID=re,this.H.OAID=Se),this.F=this.X,this.I=Vf(this,null,this.W),bs(this)};function ur(L){if(Ol(L),L.G==3){var Z=L.U++,re=Gn(L.I);if(an(re,"SID",L.K),an(re,"RID",Z),an(re,"TYPE","terminate"),cs(L,re),Z=new Oe(L,L.j,Z),Z.L=2,Z.v=zs(Gn(re)),re=!1,s.navigator&&s.navigator.sendBeacon)try{re=s.navigator.sendBeacon(Z.v.toString(),"")}catch{}!re&&s.Image&&(new Image().src=Z.v,re=!0),re||(Z.g=Bl(Z.j,null),Z.g.ea(Z.v)),Z.F=Date.now(),si(Z)}Bf(L)}function Ln(L){L.g&&(Ec(L),L.g.cancel(),L.g=null)}function Ol(L){Ln(L),L.u&&(s.clearTimeout(L.u),L.u=null),Nl(L),L.h.cancel(),L.s&&(typeof L.s=="number"&&s.clearTimeout(L.s),L.s=null)}function bs(L){if(!Un(L.h)&&!L.s){L.s=!0;var Z=L.Ga;Ai||pn(),Mi||(Ai(),Mi=!0),ai.add(Z,L),L.B=0}}function al(L,Z){return ma(L.h)>=L.h.j-(L.s?1:0)?!1:L.s?(L.i=Z.D.concat(L.i),!0):L.G==1||L.G==2||L.B>=(L.Va?0:L.Wa)?!1:(L.s=$a(ae(L.Ga,L,Z),Fl(L,L.B)),L.B++,!0)}t.Ga=function(L){if(this.s)if(this.s=null,this.G==1){if(!L){this.U=Math.floor(1e5*Math.random()),L=this.U++;const gt=new Oe(this,this.j,L);let Tt=this.o;if(this.S&&(Tt?(Tt=Ae(Tt),De(Tt,this.S)):Tt=this.S),this.m!==null||this.O||(gt.H=Tt,Tt=null),this.P)e:{for(var Z=0,re=0;re<this.i.length;re++){t:{var Se=this.i[re];if("__data__"in Se.map&&(Se=Se.map.__data__,typeof Se=="string")){Se=Se.length;break t}Se=void 0}if(Se===void 0)break;if(Z+=Se,4096<Z){Z=re;break e}if(Z===4096||re===this.i.length-1){Z=re+1;break e}}Z=1e3}else Z=1e3;Z=Mu(this,gt,Z),re=Gn(this.I),an(re,"RID",L),an(re,"CVER",22),this.D&&an(re,"X-HTTP-Session-Id",this.D),cs(this,re),Tt&&(this.O?Z="headers="+encodeURIComponent(String(xr(Tt)))+"&"+Z:this.m&&Rn(re,this.m,Tt)),Qn(this.h,gt),this.Ua&&an(re,"TYPE","init"),this.P?(an(re,"$req",Z),an(re,"SID","null"),gt.T=!0,mt(gt,re,null)):mt(gt,re,Z),this.G=2}}else this.G==3&&(L?kl(this,L):this.i.length==0||Un(this.h)||kl(this))};function kl(L,Z){var re;Z?re=Z.l:re=L.U++;const Se=Gn(L.I);an(Se,"SID",L.K),an(Se,"RID",re),an(Se,"AID",L.T),cs(L,Se),L.m&&L.o&&Rn(Se,L.m,L.o),re=new Oe(L,L.j,re,L.B+1),L.m===null&&(re.H=L.o),Z&&(L.i=Z.D.concat(L.i)),Z=Mu(L,re,1e3),re.I=Math.round(.5*L.wa)+Math.round(.5*L.wa*Math.random()),Qn(L.h,re),mt(re,Se,Z)}function cs(L,Z){L.H&&Ut(L.H,function(re,Se){an(Z,Se,re)}),L.l&&Eu({},function(re,Se){an(Z,Se,re)})}function Mu(L,Z,re){re=Math.min(L.i.length,re);var Se=L.l?ae(L.l.Na,L.l,L):null;e:{var gt=L.i;let Tt=-1;for(;;){const Yt=["count="+re];Tt==-1?0<re?(Tt=gt[0].g,Yt.push("ofs="+Tt)):Tt=0:Yt.push("ofs="+Tt);let ni=!0;for(let Ht=0;Ht<re;Ht++){let on=gt[Ht].g;const Kt=gt[Ht].map;if(on-=Tt,0>on)Tt=Math.max(0,gt[Ht].g-100),ni=!1;else try{jr(Kt,Yt,"req"+on+"_")}catch{Se&&Se(Kt)}}if(ni){Se=Yt.join("&");break e}}}return L=L.i.splice(0,re),Z.D=L,Se}function La(L){if(!L.g&&!L.u){L.Y=1;var Z=L.Fa;Ai||pn(),Mi||(Ai(),Mi=!0),ai.add(Z,L),L.v=0}}function ud(L){return L.g||L.u||3<=L.v?!1:(L.Y++,L.u=$a(ae(L.Fa,L),Fl(L,L.v)),L.v++,!0)}t.Fa=function(){if(this.u=null,Xr(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var L=2*this.R;this.j.info("BP detection timer enabled: "+L),this.A=$a(ae(this.ab,this),L)}},t.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Ir(10),Ln(this),Xr(this))};function Ec(L){L.A!=null&&(s.clearTimeout(L.A),L.A=null)}function Xr(L){L.g=new Oe(L,L.j,"rpc",L.Y),L.m===null&&(L.g.H=L.o),L.g.O=0;var Z=Gn(L.qa);an(Z,"RID","rpc"),an(Z,"SID",L.K),an(Z,"AID",L.T),an(Z,"CI",L.F?"0":"1"),!L.F&&L.ja&&an(Z,"TO",L.ja),an(Z,"TYPE","xmlhttp"),cs(L,Z),L.m&&L.o&&Rn(Z,L.m,L.o),L.L&&(L.g.I=L.L);var re=L.g;L=L.ia,re.L=1,re.v=zs(Gn(Z)),re.m=null,re.P=!0,At(re,L)}t.Za=function(){this.C!=null&&(this.C=null,Ln(this),ud(this),Ir(19))};function Nl(L){L.C!=null&&(s.clearTimeout(L.C),L.C=null)}function Sc(L,Z){var re=null;if(L.g==Z){Nl(L),Ec(L),L.g=null;var Se=2}else if(qn(L.h,Z))re=Z.D,Ur(L.h,Z),Se=1;else return;if(L.G!=0){if(Z.o)if(Se==1){re=Z.m?Z.m.length:0,Z=Date.now()-Z.F;var gt=L.B;Se=Ha(),Sn(Se,new vc(Se,re)),bs(L)}else La(L);else if(gt=Z.s,gt==3||gt==0&&0<Z.X||!(Se==1&&al(L,Z)||Se==2&&ud(L)))switch(re&&0<re.length&&(Z=L.h,Z.i=Z.i.concat(re)),gt){case 1:ya(L,5);break;case 4:ya(L,10);break;case 3:ya(L,6);break;default:ya(L,2)}}}function Fl(L,Z){let re=L.Ta+Math.floor(Math.random()*L.cb);return L.isActive()||(re*=2),re*Z}function ya(L,Z){if(L.j.info("Error code "+Z),Z==2){var re=ae(L.fb,L),Se=L.Xa;const gt=!Se;Se=new Wa(Se||"//www.google.com/images/cleardot.gif"),s.location&&s.location.protocol=="http"||vs(Se,"https"),zs(Se),gt?sl(Se.toString(),re):qt(Se.toString(),re)}else Ir(2);L.G=0,L.l&&L.l.sa(Z),Bf(L),Ol(L)}t.fb=function(L){L?(this.j.info("Successfully pinged google.com"),Ir(2)):(this.j.info("Failed to ping google.com"),Ir(1))};function Bf(L){if(L.G=0,L.ka=[],L.l){const Z=Dl(L.h);(Z.length!=0||L.i.length!=0)&&(it(L.ka,Z),it(L.ka,L.i),L.h.i.length=0,Xe(L.i),L.i.length=0),L.l.ra()}}function Vf(L,Z,re){var Se=re instanceof Wa?Gn(re):new Wa(re);if(Se.g!="")Z&&(Se.g=Z+"."+Se.g),Qs(Se,Se.s);else{var gt=s.location;Se=gt.protocol,Z=Z?Z+"."+gt.hostname:gt.hostname,gt=+gt.port;var Tt=new Wa(null);Se&&vs(Tt,Se),Z&&(Tt.g=Z),gt&&Qs(Tt,gt),re&&(Tt.l=re),Se=Tt}return re=L.D,Z=L.ya,re&&Z&&an(Se,re,Z),an(Se,"VER",L.la),cs(L,Se),Se}function Bl(L,Z,re){if(Z&&!L.J)throw Error("Can't create secondary domain capable XhrIo object.");return Z=L.Ca&&!L.pa?new Hn(new ea({eb:re})):new Hn(L.pa),Z.Ha(L.J),Z}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function Vl(){}t=Vl.prototype,t.ua=function(){},t.ta=function(){},t.sa=function(){},t.ra=function(){},t.isActive=function(){return!0},t.Na=function(){};function Cu(){}Cu.prototype.g=function(L,Z){return new kr(L,Z)};function kr(L,Z){Yn.call(this),this.g=new Os(Z),this.l=L,this.h=Z&&Z.messageUrlParams||null,L=Z&&Z.messageHeaders||null,Z&&Z.clientProtocolHeaderRequired&&(L?L["X-Client-Protocol"]="webchannel":L={"X-Client-Protocol":"webchannel"}),this.g.o=L,L=Z&&Z.initMessageHeaders||null,Z&&Z.messageContentType&&(L?L["X-WebChannel-Content-Type"]=Z.messageContentType:L={"X-WebChannel-Content-Type":Z.messageContentType}),Z&&Z.va&&(L?L["X-WebChannel-Client-Profile"]=Z.va:L={"X-WebChannel-Client-Profile":Z.va}),this.g.S=L,(L=Z&&Z.Sb)&&!Ee(L)&&(this.g.m=L),this.v=Z&&Z.supportsCrossDomainXhr||!1,this.u=Z&&Z.sendRawJson||!1,(Z=Z&&Z.httpSessionIdParam)&&!Ee(Z)&&(this.g.D=Z,L=this.h,L!==null&&Z in L&&(L=this.h,Z in L&&delete L[Z])),this.j=new ks(this)}Ue(kr,Yn),kr.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},kr.prototype.close=function(){ur(this.g)},kr.prototype.o=function(L){var Z=this.g;if(typeof L=="string"){var re={};re.__data__=L,L=re}else this.u&&(re={},re.__data__=as(L),L=re);Z.i.push(new Vi(Z.Ya++,L)),Z.G==3&&bs(Z)},kr.prototype.N=function(){this.g.l=null,delete this.j,ur(this.g),delete this.g,kr.aa.N.call(this)};function Ru(L){yo.call(this),L.__headers__&&(this.headers=L.__headers__,this.statusCode=L.__status__,delete L.__headers__,delete L.__status__);var Z=L.__sm__;if(Z){e:{for(const re in Z){L=re;break e}L=void 0}(this.i=L)&&(L=this.i,Z=Z!==null&&L in Z?Z[L]:void 0),this.data=Z}else this.data=L}Ue(Ru,yo);function za(){vo.call(this),this.status=1}Ue(za,vo);function ks(L){this.g=L}Ue(ks,Vl),ks.prototype.ua=function(){Sn(this.g,"a")},ks.prototype.ta=function(L){Sn(this.g,new Ru(L))},ks.prototype.sa=function(L){Sn(this.g,new za)},ks.prototype.ra=function(){Sn(this.g,"b")},Cu.prototype.createWebChannel=Cu.prototype.g,kr.prototype.send=kr.prototype.o,kr.prototype.open=kr.prototype.m,kr.prototype.close=kr.prototype.close,b4=function(){return new Cu},x4=function(){return Ha()},v4=Ks,NE={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},ye.NO_ERROR=0,ye.TIMEOUT=8,ye.HTTP_ERROR=6,Gx=ye,ve.COMPLETE="complete",y4=ve,os.EventType=Ls,Ls.OPEN="a",Ls.CLOSE="b",Ls.ERROR="c",Ls.MESSAGE="d",Yn.prototype.listen=Yn.prototype.K,ny=os,Hn.prototype.listenOnce=Hn.prototype.L,Hn.prototype.getLastError=Hn.prototype.Ka,Hn.prototype.getLastErrorCode=Hn.prototype.Ba,Hn.prototype.getStatus=Hn.prototype.Z,Hn.prototype.getResponseJson=Hn.prototype.Oa,Hn.prototype.getResponseText=Hn.prototype.oa,Hn.prototype.send=Hn.prototype.ea,Hn.prototype.setWithCredentials=Hn.prototype.Ha,_4=Hn}).apply(typeof xx<"u"?xx:typeof self<"u"?self:typeof window<"u"?window:{});const $P="@firebase/firestore",ZP="4.7.9";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let oa=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};oa.UNAUTHENTICATED=new oa(null),oa.GOOGLE_CREDENTIALS=new oa("google-credentials-uid"),oa.FIRST_PARTY=new oa("first-party-uid"),oa.MOCK_USER=new oa("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Xm="11.4.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Af=new mb("@firebase/firestore");function Hp(){return Af.logLevel}function mi(t,...e){if(Af.logLevel<=mn.DEBUG){const n=e.map(wA);Af.debug(`Firestore (${Xm}): ${t}`,...n)}}function xu(t,...e){if(Af.logLevel<=mn.ERROR){const n=e.map(wA);Af.error(`Firestore (${Xm}): ${t}`,...n)}}function Mm(t,...e){if(Af.logLevel<=mn.WARN){const n=e.map(wA);Af.warn(`Firestore (${Xm}): ${t}`,...n)}}function wA(t){if(typeof t=="string")return t;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(n){return JSON.stringify(n)}(t)}catch{return t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hi(t="Unexpected state"){const e=`FIRESTORE (${Xm}) INTERNAL ASSERTION FAILED: `+t;throw xu(e),new Error(e)}function Vn(t,e){t||Hi()}function Qi(t,e){return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nt={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class gi extends Ml{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class du{constructor(){this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w4{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class KH{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable(()=>n(oa.UNAUTHENTICATED))}shutdown(){}}class QH{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable(()=>n(this.token.user))}shutdown(){this.changeListener=null}}class JH{constructor(e){this.t=e,this.currentUser=oa.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){Vn(this.o===void 0);let l=this.i;const d=N=>this.i!==l?(l=this.i,n(N)):Promise.resolve();let y=new du;this.o=()=>{this.i++,this.currentUser=this.u(),y.resolve(),y=new du,e.enqueueRetryable(()=>d(this.currentUser))};const A=()=>{const N=y;e.enqueueRetryable(async()=>{await N.promise,await d(this.currentUser)})},s=N=>{mi("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=N,this.o&&(this.auth.addAuthTokenListener(this.o),A())};this.t.onInit(N=>s(N)),setTimeout(()=>{if(!this.auth){const N=this.t.getImmediate({optional:!0});N?s(N):(mi("FirebaseAuthCredentialsProvider","Auth not yet detected"),y.resolve(),y=new du)}},0),A()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(l=>this.i!==e?(mi("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):l?(Vn(typeof l.accessToken=="string"),new w4(l.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Vn(e===null||typeof e=="string"),new oa(e)}}class e${constructor(e,n,l){this.l=e,this.h=n,this.P=l,this.type="FirstParty",this.user=oa.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);const e=this.I();return e&&this.T.set("Authorization",e),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}}class t${constructor(e,n,l){this.l=e,this.h=n,this.P=l}getToken(){return Promise.resolve(new e$(this.l,this.h,this.P))}start(e,n){e.enqueueRetryable(()=>n(oa.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class WP{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class i${constructor(e,n){this.A=n,this.forceRefresh=!1,this.appCheck=null,this.R=null,this.V=null,jo(e)&&e.settings.appCheckToken&&(this.V=e.settings.appCheckToken)}start(e,n){Vn(this.o===void 0);const l=y=>{y.error!=null&&mi("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${y.error.message}`);const A=y.token!==this.R;return this.R=y.token,mi("FirebaseAppCheckTokenProvider",`Received ${A?"new":"existing"} token.`),A?n(y.token):Promise.resolve()};this.o=y=>{e.enqueueRetryable(()=>l(y))};const d=y=>{mi("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=y,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(y=>d(y)),setTimeout(()=>{if(!this.appCheck){const y=this.A.getImmediate({optional:!0});y?d(y):mi("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.V)return Promise.resolve(new WP(this.V));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(n=>n?(Vn(typeof n.token=="string"),this.R=n.token,new WP(n.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function n$(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let l=0;l<t;l++)n[l]=Math.floor(256*Math.random());return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T4{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=62*Math.floor(4.129032258064516);let l="";for(;l.length<20;){const d=n$(40);for(let y=0;y<d.length;++y)l.length<20&&d[y]<n&&(l+=e.charAt(d[y]%62))}return l}}function En(t,e){return t<e?-1:t>e?1:0}function Cm(t,e,n){return t.length===e.length&&t.every((l,d)=>n(l,e[d]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XP=-62135596800,YP=1e6;class Vr{static now(){return Vr.fromMillis(Date.now())}static fromDate(e){return Vr.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),l=Math.floor((e-1e3*n)*YP);return new Vr(n,l)}constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new gi(Nt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new gi(Nt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<XP)throw new gi(Nt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new gi(Nt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/YP}_compareTo(e){return this.seconds===e.seconds?En(this.nanoseconds,e.nanoseconds):En(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds-XP;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ki{static fromTimestamp(e){return new Ki(e)}static min(){return new Ki(new Vr(0,0))}static max(){return new Ki(new Vr(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KP="__name__";class ec{constructor(e,n,l){n===void 0?n=0:n>e.length&&Hi(),l===void 0?l=e.length-n:l>e.length-n&&Hi(),this.segments=e,this.offset=n,this.len=l}get length(){return this.len}isEqual(e){return ec.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof ec?e.forEach(l=>{n.push(l)}):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,l=this.limit();n<l;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const l=Math.min(e.length,n.length);for(let d=0;d<l;d++){const y=ec.compareSegments(e.get(d),n.get(d));if(y!==0)return y}return Math.sign(e.length-n.length)}static compareSegments(e,n){const l=ec.isNumericId(e),d=ec.isNumericId(n);return l&&!d?-1:!l&&d?1:l&&d?ec.extractNumericId(e).compare(ec.extractNumericId(n)):e<n?-1:e>n?1:0}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return kh.fromString(e.substring(4,e.length-2))}}class gr extends ec{construct(e,n,l){return new gr(e,n,l)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const n=[];for(const l of e){if(l.indexOf("//")>=0)throw new gi(Nt.INVALID_ARGUMENT,`Invalid segment (${l}). Paths must not contain // in them.`);n.push(...l.split("/").filter(d=>d.length>0))}return new gr(n)}static emptyPath(){return new gr([])}}const r$=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class js extends ec{construct(e,n,l){return new js(e,n,l)}static isValidIdentifier(e){return r$.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),js.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===KP}static keyField(){return new js([KP])}static fromServerFormat(e){const n=[];let l="",d=0;const y=()=>{if(l.length===0)throw new gi(Nt.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(l),l=""};let A=!1;for(;d<e.length;){const s=e[d];if(s==="\\"){if(d+1===e.length)throw new gi(Nt.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const N=e[d+1];if(N!=="\\"&&N!=="."&&N!=="`")throw new gi(Nt.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);l+=N,d+=2}else s==="`"?(A=!A,d++):s!=="."||A?(l+=s,d++):(y(),d++)}if(y(),A)throw new gi(Nt.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new js(n)}static emptyPath(){return new js([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pi{constructor(e){this.path=e}static fromPath(e){return new Pi(gr.fromString(e))}static fromName(e){return new Pi(gr.fromString(e).popFirst(5))}static empty(){return new Pi(gr.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&gr.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return gr.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Pi(new gr(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wy=-1;function s$(t,e){const n=t.toTimestamp().seconds,l=t.toTimestamp().nanoseconds+1,d=Ki.fromTimestamp(l===1e9?new Vr(n+1,0):new Vr(n,l));return new Hh(d,Pi.empty(),e)}function a$(t){return new Hh(t.readTime,t.key,Wy)}class Hh{constructor(e,n,l){this.readTime=e,this.documentKey=n,this.largestBatchId=l}static min(){return new Hh(Ki.min(),Pi.empty(),Wy)}static max(){return new Hh(Ki.max(),Pi.empty(),Wy)}}function o$(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=Pi.comparator(t.documentKey,e.documentKey),n!==0?n:En(t.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const l$="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class c${constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ym(t){if(t.code!==Nt.FAILED_PRECONDITION||t.message!==l$)throw t;mi("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bt{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)},n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)})}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&Hi(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new Bt((l,d)=>{this.nextCallback=y=>{this.wrapSuccess(e,y).next(l,d)},this.catchCallback=y=>{this.wrapFailure(n,y).next(l,d)}})}toPromise(){return new Promise((e,n)=>{this.next(e,n)})}wrapUserFunction(e){try{const n=e();return n instanceof Bt?n:Bt.resolve(n)}catch(n){return Bt.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction(()=>e(n)):Bt.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction(()=>e(n)):Bt.reject(n)}static resolve(e){return new Bt((n,l)=>{n(e)})}static reject(e){return new Bt((n,l)=>{l(e)})}static waitFor(e){return new Bt((n,l)=>{let d=0,y=0,A=!1;e.forEach(s=>{++d,s.next(()=>{++y,A&&y===d&&n()},N=>l(N))}),A=!0,y===d&&n()})}static or(e){let n=Bt.resolve(!1);for(const l of e)n=n.next(d=>d?Bt.resolve(d):l());return n}static forEach(e,n){const l=[];return e.forEach((d,y)=>{l.push(n.call(this,d,y))}),this.waitFor(l)}static mapArray(e,n){return new Bt((l,d)=>{const y=e.length,A=new Array(y);let s=0;for(let N=0;N<y;N++){const j=N;n(e[j]).next(K=>{A[j]=K,++s,s===y&&l(A)},K=>d(K))}})}static doWhile(e,n){return new Bt((l,d)=>{const y=()=>{e()===!0?n().next(()=>{y()},d):l()};y()})}}function u$(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function Km(t){return t.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bb{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=l=>this.oe(l),this._e=l=>n.writeSequenceNumber(l))}oe(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this._e&&this._e(e),e}}bb.ae=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TA=-1;function wb(t){return t==null}function z1(t){return t===0&&1/t==-1/0}function h$(t){return typeof t=="number"&&Number.isInteger(t)&&!z1(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const E4="";function d$(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=QP(e)),e=f$(t.get(n),e);return QP(e)}function f$(t,e){let n=e;const l=t.length;for(let d=0;d<l;d++){const y=t.charAt(d);switch(y){case"\0":n+="";break;case E4:n+="";break;default:n+=y}}return n}function QP(t){return t+E4+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function JP(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function nd(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function S4(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zr{constructor(e,n){this.comparator=e,this.root=n||Vs.EMPTY}insert(e,n){return new zr(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,Vs.BLACK,null,null))}remove(e){return new zr(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Vs.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const l=this.comparator(e,n.key);if(l===0)return n.value;l<0?n=n.left:l>0&&(n=n.right)}return null}indexOf(e){let n=0,l=this.root;for(;!l.isEmpty();){const d=this.comparator(e,l.key);if(d===0)return n+l.left.size;d<0?l=l.left:(n+=l.left.size+1,l=l.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((n,l)=>(e(n,l),!1))}toString(){const e=[];return this.inorderTraversal((n,l)=>(e.push(`${n}:${l}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new bx(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new bx(this.root,e,this.comparator,!1)}getReverseIterator(){return new bx(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new bx(this.root,e,this.comparator,!0)}}class bx{constructor(e,n,l,d){this.isReverse=d,this.nodeStack=[];let y=1;for(;!e.isEmpty();)if(y=n?l(e.key,n):1,n&&d&&(y*=-1),y<0)e=this.isReverse?e.left:e.right;else{if(y===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Vs{constructor(e,n,l,d,y){this.key=e,this.value=n,this.color=l??Vs.RED,this.left=d??Vs.EMPTY,this.right=y??Vs.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,l,d,y){return new Vs(e??this.key,n??this.value,l??this.color,d??this.left,y??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,l){let d=this;const y=l(e,d.key);return d=y<0?d.copy(null,null,null,d.left.insert(e,n,l),null):y===0?d.copy(null,n,null,null,null):d.copy(null,null,null,null,d.right.insert(e,n,l)),d.fixUp()}removeMin(){if(this.left.isEmpty())return Vs.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let l,d=this;if(n(e,d.key)<0)d.left.isEmpty()||d.left.isRed()||d.left.left.isRed()||(d=d.moveRedLeft()),d=d.copy(null,null,null,d.left.remove(e,n),null);else{if(d.left.isRed()&&(d=d.rotateRight()),d.right.isEmpty()||d.right.isRed()||d.right.left.isRed()||(d=d.moveRedRight()),n(e,d.key)===0){if(d.right.isEmpty())return Vs.EMPTY;l=d.right.min(),d=d.copy(l.key,l.value,null,null,d.right.removeMin())}d=d.copy(null,null,null,null,d.right.remove(e,n))}return d.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Vs.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Vs.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Hi();const e=this.left.check();if(e!==this.right.check())throw Hi();return e+(this.isRed()?0:1)}}Vs.EMPTY=null,Vs.RED=!0,Vs.BLACK=!1;Vs.EMPTY=new class{constructor(){this.size=0}get key(){throw Hi()}get value(){throw Hi()}get color(){throw Hi()}get left(){throw Hi()}get right(){throw Hi()}copy(e,n,l,d,y){return this}insert(e,n,l){return new Vs(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _s{constructor(e){this.comparator=e,this.data=new zr(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((n,l)=>(e(n),!1))}forEachInRange(e,n){const l=this.data.getIteratorFrom(e[0]);for(;l.hasNext();){const d=l.getNext();if(this.comparator(d.key,e[1])>=0)return;n(d.key)}}forEachWhile(e,n){let l;for(l=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();l.hasNext();)if(!e(l.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new e3(this.data.getIterator())}getIteratorFrom(e){return new e3(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach(l=>{n=n.add(l)}),n}isEqual(e){if(!(e instanceof _s)||this.size!==e.size)return!1;const n=this.data.getIterator(),l=e.data.getIterator();for(;n.hasNext();){const d=n.getNext().key,y=l.getNext().key;if(this.comparator(d,y)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(n=>{e.push(n)}),e}toString(){const e=[];return this.forEach(n=>e.push(n)),"SortedSet("+e.toString()+")"}copy(e){const n=new _s(this.comparator);return n.data=e,n}}class e3{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class co{constructor(e){this.fields=e,e.sort(js.comparator)}static empty(){return new co([])}unionWith(e){let n=new _s(js.comparator);for(const l of this.fields)n=n.add(l);for(const l of e)n=n.add(l);return new co(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return Cm(this.fields,e.fields,(n,l)=>n.isEqual(l))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A4 extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $s{constructor(e){this.binaryString=e}static fromBase64String(e){const n=function(d){try{return atob(d)}catch(y){throw typeof DOMException<"u"&&y instanceof DOMException?new A4("Invalid base64 string: "+y):y}}(e);return new $s(n)}static fromUint8Array(e){const n=function(d){let y="";for(let A=0;A<d.length;++A)y+=String.fromCharCode(d[A]);return y}(e);return new $s(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(n){return btoa(n)}(this.binaryString)}toUint8Array(){return function(n){const l=new Uint8Array(n.length);for(let d=0;d<n.length;d++)l[d]=n.charCodeAt(d);return l}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return En(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}$s.EMPTY_BYTE_STRING=new $s("");const p$=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function $h(t){if(Vn(!!t),typeof t=="string"){let e=0;const n=p$.exec(t);if(Vn(!!n),n[1]){let d=n[1];d=(d+"000000000").substr(0,9),e=Number(d)}const l=new Date(t);return{seconds:Math.floor(l.getTime()/1e3),nanos:e}}return{seconds:Zr(t.seconds),nanos:Zr(t.nanos)}}function Zr(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function Zh(t){return typeof t=="string"?$s.fromBase64String(t):$s.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const I4="server_timestamp",M4="__type__",C4="__previous_value__",R4="__local_write_time__";function EA(t){var e,n;return((n=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{})[M4])===null||n===void 0?void 0:n.stringValue)===I4}function Tb(t){const e=t.mapValue.fields[C4];return EA(e)?Tb(e):e}function Xy(t){const e=$h(t.mapValue.fields[R4].timestampValue);return new Vr(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m${constructor(e,n,l,d,y,A,s,N,j){this.databaseId=e,this.appId=n,this.persistenceKey=l,this.host=d,this.ssl=y,this.forceLongPolling=A,this.autoDetectLongPolling=s,this.longPollingOptions=N,this.useFetchStreams=j}}const O1="(default)";class Yy{constructor(e,n){this.projectId=e,this.database=n||O1}static empty(){return new Yy("","")}get isDefaultDatabase(){return this.database===O1}isEqual(e){return e instanceof Yy&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const D4="__type__",P4="__max__",wx={mapValue:{fields:{__type__:{stringValue:P4}}}},L4="__vector__",k1="value";function Wh(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?EA(t)?4:_$(t)?9007199254740991:g$(t)?10:11:Hi()}function dc(t,e){if(t===e)return!0;const n=Wh(t);if(n!==Wh(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Xy(t).isEqual(Xy(e));case 3:return function(d,y){if(typeof d.timestampValue=="string"&&typeof y.timestampValue=="string"&&d.timestampValue.length===y.timestampValue.length)return d.timestampValue===y.timestampValue;const A=$h(d.timestampValue),s=$h(y.timestampValue);return A.seconds===s.seconds&&A.nanos===s.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(d,y){return Zh(d.bytesValue).isEqual(Zh(y.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(d,y){return Zr(d.geoPointValue.latitude)===Zr(y.geoPointValue.latitude)&&Zr(d.geoPointValue.longitude)===Zr(y.geoPointValue.longitude)}(t,e);case 2:return function(d,y){if("integerValue"in d&&"integerValue"in y)return Zr(d.integerValue)===Zr(y.integerValue);if("doubleValue"in d&&"doubleValue"in y){const A=Zr(d.doubleValue),s=Zr(y.doubleValue);return A===s?z1(A)===z1(s):isNaN(A)&&isNaN(s)}return!1}(t,e);case 9:return Cm(t.arrayValue.values||[],e.arrayValue.values||[],dc);case 10:case 11:return function(d,y){const A=d.mapValue.fields||{},s=y.mapValue.fields||{};if(JP(A)!==JP(s))return!1;for(const N in A)if(A.hasOwnProperty(N)&&(s[N]===void 0||!dc(A[N],s[N])))return!1;return!0}(t,e);default:return Hi()}}function Ky(t,e){return(t.values||[]).find(n=>dc(n,e))!==void 0}function Rm(t,e){if(t===e)return 0;const n=Wh(t),l=Wh(e);if(n!==l)return En(n,l);switch(n){case 0:case 9007199254740991:return 0;case 1:return En(t.booleanValue,e.booleanValue);case 2:return function(y,A){const s=Zr(y.integerValue||y.doubleValue),N=Zr(A.integerValue||A.doubleValue);return s<N?-1:s>N?1:s===N?0:isNaN(s)?isNaN(N)?0:-1:1}(t,e);case 3:return t3(t.timestampValue,e.timestampValue);case 4:return t3(Xy(t),Xy(e));case 5:return En(t.stringValue,e.stringValue);case 6:return function(y,A){const s=Zh(y),N=Zh(A);return s.compareTo(N)}(t.bytesValue,e.bytesValue);case 7:return function(y,A){const s=y.split("/"),N=A.split("/");for(let j=0;j<s.length&&j<N.length;j++){const K=En(s[j],N[j]);if(K!==0)return K}return En(s.length,N.length)}(t.referenceValue,e.referenceValue);case 8:return function(y,A){const s=En(Zr(y.latitude),Zr(A.latitude));return s!==0?s:En(Zr(y.longitude),Zr(A.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return i3(t.arrayValue,e.arrayValue);case 10:return function(y,A){var s,N,j,K;const se=y.fields||{},ae=A.fields||{},me=(s=se[k1])===null||s===void 0?void 0:s.arrayValue,Ue=(N=ae[k1])===null||N===void 0?void 0:N.arrayValue,Xe=En(((j=me==null?void 0:me.values)===null||j===void 0?void 0:j.length)||0,((K=Ue==null?void 0:Ue.values)===null||K===void 0?void 0:K.length)||0);return Xe!==0?Xe:i3(me,Ue)}(t.mapValue,e.mapValue);case 11:return function(y,A){if(y===wx.mapValue&&A===wx.mapValue)return 0;if(y===wx.mapValue)return 1;if(A===wx.mapValue)return-1;const s=y.fields||{},N=Object.keys(s),j=A.fields||{},K=Object.keys(j);N.sort(),K.sort();for(let se=0;se<N.length&&se<K.length;++se){const ae=En(N[se],K[se]);if(ae!==0)return ae;const me=Rm(s[N[se]],j[K[se]]);if(me!==0)return me}return En(N.length,K.length)}(t.mapValue,e.mapValue);default:throw Hi()}}function t3(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return En(t,e);const n=$h(t),l=$h(e),d=En(n.seconds,l.seconds);return d!==0?d:En(n.nanos,l.nanos)}function i3(t,e){const n=t.values||[],l=e.values||[];for(let d=0;d<n.length&&d<l.length;++d){const y=Rm(n[d],l[d]);if(y)return y}return En(n.length,l.length)}function Dm(t){return FE(t)}function FE(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(n){const l=$h(n);return`time(${l.seconds},${l.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(n){return Zh(n).toBase64()}(t.bytesValue):"referenceValue"in t?function(n){return Pi.fromName(n).toString()}(t.referenceValue):"geoPointValue"in t?function(n){return`geo(${n.latitude},${n.longitude})`}(t.geoPointValue):"arrayValue"in t?function(n){let l="[",d=!0;for(const y of n.values||[])d?d=!1:l+=",",l+=FE(y);return l+"]"}(t.arrayValue):"mapValue"in t?function(n){const l=Object.keys(n.fields||{}).sort();let d="{",y=!0;for(const A of l)y?y=!1:d+=",",d+=`${A}:${FE(n.fields[A])}`;return d+"}"}(t.mapValue):Hi()}function Hx(t){switch(Wh(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Tb(t);return e?16+Hx(e):16;case 5:return 2*t.stringValue.length;case 6:return Zh(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return function(l){return(l.values||[]).reduce((d,y)=>d+Hx(y),0)}(t.arrayValue);case 10:case 11:return function(l){let d=0;return nd(l.fields,(y,A)=>{d+=y.length+Hx(A)}),d}(t.mapValue);default:throw Hi()}}function n3(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function BE(t){return!!t&&"integerValue"in t}function SA(t){return!!t&&"arrayValue"in t}function r3(t){return!!t&&"nullValue"in t}function s3(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function $x(t){return!!t&&"mapValue"in t}function g$(t){var e,n;return((n=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{})[D4])===null||n===void 0?void 0:n.stringValue)===L4}function Sy(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return nd(t.mapValue.fields,(n,l)=>e.mapValue.fields[n]=Sy(l)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Sy(t.arrayValue.values[n]);return e}return Object.assign({},t)}function _$(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue===P4}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ua{constructor(e){this.value=e}static empty(){return new Ua({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let l=0;l<e.length-1;++l)if(n=(n.mapValue.fields||{})[e.get(l)],!$x(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=Sy(n)}setAll(e){let n=js.emptyPath(),l={},d=[];e.forEach((A,s)=>{if(!n.isImmediateParentOf(s)){const N=this.getFieldsMap(n);this.applyChanges(N,l,d),l={},d=[],n=s.popLast()}A?l[s.lastSegment()]=Sy(A):d.push(s.lastSegment())});const y=this.getFieldsMap(n);this.applyChanges(y,l,d)}delete(e){const n=this.field(e.popLast());$x(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return dc(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let l=0;l<e.length;++l){let d=n.mapValue.fields[e.get(l)];$x(d)&&d.mapValue.fields||(d={mapValue:{fields:{}}},n.mapValue.fields[e.get(l)]=d),n=d}return n.mapValue.fields}applyChanges(e,n,l){nd(n,(d,y)=>e[d]=y);for(const d of l)delete e[d]}clone(){return new Ua(Sy(this.value))}}function z4(t){const e=[];return nd(t.fields,(n,l)=>{const d=new js([n]);if($x(l)){const y=z4(l.mapValue).fields;if(y.length===0)e.push(d);else for(const A of y)e.push(d.child(A))}else e.push(d)}),new co(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class la{constructor(e,n,l,d,y,A,s){this.key=e,this.documentType=n,this.version=l,this.readTime=d,this.createTime=y,this.data=A,this.documentState=s}static newInvalidDocument(e){return new la(e,0,Ki.min(),Ki.min(),Ki.min(),Ua.empty(),0)}static newFoundDocument(e,n,l,d){return new la(e,1,n,Ki.min(),l,d,0)}static newNoDocument(e,n){return new la(e,2,n,Ki.min(),Ki.min(),Ua.empty(),0)}static newUnknownDocument(e,n){return new la(e,3,n,Ki.min(),Ki.min(),Ua.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(Ki.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ua.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ua.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Ki.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof la&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new la(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N1{constructor(e,n){this.position=e,this.inclusive=n}}function a3(t,e,n){let l=0;for(let d=0;d<t.position.length;d++){const y=e[d],A=t.position[d];if(y.field.isKeyField()?l=Pi.comparator(Pi.fromName(A.referenceValue),n.key):l=Rm(A,n.data.field(y.field)),y.dir==="desc"&&(l*=-1),l!==0)break}return l}function o3(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!dc(t.position[n],e.position[n]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qy{constructor(e,n="asc"){this.field=e,this.dir=n}}function y$(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O4{}class is extends O4{constructor(e,n,l){super(),this.field=e,this.op=n,this.value=l}static create(e,n,l){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,l):new x$(e,n,l):n==="array-contains"?new T$(e,l):n==="in"?new E$(e,l):n==="not-in"?new S$(e,l):n==="array-contains-any"?new A$(e,l):new is(e,n,l)}static createKeyFieldInFilter(e,n,l){return n==="in"?new b$(e,l):new w$(e,l)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&this.matchesComparison(Rm(n,this.value)):n!==null&&Wh(this.value)===Wh(n)&&this.matchesComparison(Rm(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Hi()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Sl extends O4{constructor(e,n){super(),this.filters=e,this.op=n,this.ce=null}static create(e,n){return new Sl(e,n)}matches(e){return k4(this)?this.filters.find(n=>!n.matches(e))===void 0:this.filters.find(n=>n.matches(e))!==void 0}getFlattenedFilters(){return this.ce!==null||(this.ce=this.filters.reduce((e,n)=>e.concat(n.getFlattenedFilters()),[])),this.ce}getFilters(){return Object.assign([],this.filters)}}function k4(t){return t.op==="and"}function N4(t){return v$(t)&&k4(t)}function v$(t){for(const e of t.filters)if(e instanceof Sl)return!1;return!0}function VE(t){if(t instanceof is)return t.field.canonicalString()+t.op.toString()+Dm(t.value);if(N4(t))return t.filters.map(e=>VE(e)).join(",");{const e=t.filters.map(n=>VE(n)).join(",");return`${t.op}(${e})`}}function F4(t,e){return t instanceof is?function(l,d){return d instanceof is&&l.op===d.op&&l.field.isEqual(d.field)&&dc(l.value,d.value)}(t,e):t instanceof Sl?function(l,d){return d instanceof Sl&&l.op===d.op&&l.filters.length===d.filters.length?l.filters.reduce((y,A,s)=>y&&F4(A,d.filters[s]),!0):!1}(t,e):void Hi()}function B4(t){return t instanceof is?function(n){return`${n.field.canonicalString()} ${n.op} ${Dm(n.value)}`}(t):t instanceof Sl?function(n){return n.op.toString()+" {"+n.getFilters().map(B4).join(" ,")+"}"}(t):"Filter"}class x$ extends is{constructor(e,n,l){super(e,n,l),this.key=Pi.fromName(l.referenceValue)}matches(e){const n=Pi.comparator(e.key,this.key);return this.matchesComparison(n)}}class b$ extends is{constructor(e,n){super(e,"in",n),this.keys=V4("in",n)}matches(e){return this.keys.some(n=>n.isEqual(e.key))}}class w$ extends is{constructor(e,n){super(e,"not-in",n),this.keys=V4("not-in",n)}matches(e){return!this.keys.some(n=>n.isEqual(e.key))}}function V4(t,e){var n;return(((n=e.arrayValue)===null||n===void 0?void 0:n.values)||[]).map(l=>Pi.fromName(l.referenceValue))}class T$ extends is{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return SA(n)&&Ky(n.arrayValue,this.value)}}class E$ extends is{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&Ky(this.value.arrayValue,n)}}class S$ extends is{constructor(e,n){super(e,"not-in",n)}matches(e){if(Ky(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&!Ky(this.value.arrayValue,n)}}class A$ extends is{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!SA(n)||!n.arrayValue.values)&&n.arrayValue.values.some(l=>Ky(this.value.arrayValue,l))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I${constructor(e,n=null,l=[],d=[],y=null,A=null,s=null){this.path=e,this.collectionGroup=n,this.orderBy=l,this.filters=d,this.limit=y,this.startAt=A,this.endAt=s,this.le=null}}function l3(t,e=null,n=[],l=[],d=null,y=null,A=null){return new I$(t,e,n,l,d,y,A)}function AA(t){const e=Qi(t);if(e.le===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(l=>VE(l)).join(","),n+="|ob:",n+=e.orderBy.map(l=>function(y){return y.field.canonicalString()+y.dir}(l)).join(","),wb(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(l=>Dm(l)).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(l=>Dm(l)).join(",")),e.le=n}return e.le}function IA(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!y$(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!F4(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!o3(t.startAt,e.startAt)&&o3(t.endAt,e.endAt)}function UE(t){return Pi.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qm{constructor(e,n=null,l=[],d=[],y=null,A="F",s=null,N=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=l,this.filters=d,this.limit=y,this.limitType=A,this.startAt=s,this.endAt=N,this.he=null,this.Pe=null,this.Te=null,this.startAt,this.endAt}}function M$(t,e,n,l,d,y,A,s){return new Qm(t,e,n,l,d,y,A,s)}function Eb(t){return new Qm(t)}function c3(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function U4(t){return t.collectionGroup!==null}function Ay(t){const e=Qi(t);if(e.he===null){e.he=[];const n=new Set;for(const y of e.explicitOrderBy)e.he.push(y),n.add(y.field.canonicalString());const l=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(A){let s=new _s(js.comparator);return A.filters.forEach(N=>{N.getFlattenedFilters().forEach(j=>{j.isInequality()&&(s=s.add(j.field))})}),s})(e).forEach(y=>{n.has(y.canonicalString())||y.isKeyField()||e.he.push(new Qy(y,l))}),n.has(js.keyField().canonicalString())||e.he.push(new Qy(js.keyField(),l))}return e.he}function lc(t){const e=Qi(t);return e.Pe||(e.Pe=C$(e,Ay(t))),e.Pe}function C$(t,e){if(t.limitType==="F")return l3(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map(d=>{const y=d.dir==="desc"?"asc":"desc";return new Qy(d.field,y)});const n=t.endAt?new N1(t.endAt.position,t.endAt.inclusive):null,l=t.startAt?new N1(t.startAt.position,t.startAt.inclusive):null;return l3(t.path,t.collectionGroup,e,t.filters,t.limit,n,l)}}function jE(t,e){const n=t.filters.concat([e]);return new Qm(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function qE(t,e,n){return new Qm(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Sb(t,e){return IA(lc(t),lc(e))&&t.limitType===e.limitType}function j4(t){return`${AA(lc(t))}|lt:${t.limitType}`}function $p(t){return`Query(target=${function(n){let l=n.path.canonicalString();return n.collectionGroup!==null&&(l+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(l+=`, filters: [${n.filters.map(d=>B4(d)).join(", ")}]`),wb(n.limit)||(l+=", limit: "+n.limit),n.orderBy.length>0&&(l+=`, orderBy: [${n.orderBy.map(d=>function(A){return`${A.field.canonicalString()} (${A.dir})`}(d)).join(", ")}]`),n.startAt&&(l+=", startAt: ",l+=n.startAt.inclusive?"b:":"a:",l+=n.startAt.position.map(d=>Dm(d)).join(",")),n.endAt&&(l+=", endAt: ",l+=n.endAt.inclusive?"a:":"b:",l+=n.endAt.position.map(d=>Dm(d)).join(",")),`Target(${l})`}(lc(t))}; limitType=${t.limitType})`}function Ab(t,e){return e.isFoundDocument()&&function(l,d){const y=d.key.path;return l.collectionGroup!==null?d.key.hasCollectionId(l.collectionGroup)&&l.path.isPrefixOf(y):Pi.isDocumentKey(l.path)?l.path.isEqual(y):l.path.isImmediateParentOf(y)}(t,e)&&function(l,d){for(const y of Ay(l))if(!y.field.isKeyField()&&d.data.field(y.field)===null)return!1;return!0}(t,e)&&function(l,d){for(const y of l.filters)if(!y.matches(d))return!1;return!0}(t,e)&&function(l,d){return!(l.startAt&&!function(A,s,N){const j=a3(A,s,N);return A.inclusive?j<=0:j<0}(l.startAt,Ay(l),d)||l.endAt&&!function(A,s,N){const j=a3(A,s,N);return A.inclusive?j>=0:j>0}(l.endAt,Ay(l),d))}(t,e)}function R$(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function q4(t){return(e,n)=>{let l=!1;for(const d of Ay(t)){const y=D$(d,e,n);if(y!==0)return y;l=l||d.field.isKeyField()}return 0}}function D$(t,e,n){const l=t.field.isKeyField()?Pi.comparator(e.key,n.key):function(y,A,s){const N=A.data.field(y),j=s.data.field(y);return N!==null&&j!==null?Rm(N,j):Hi()}(t.field,e,n);switch(t.dir){case"asc":return l;case"desc":return-1*l;default:return Hi()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kf{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),l=this.inner[n];if(l!==void 0){for(const[d,y]of l)if(this.equalsFn(d,e))return y}}has(e){return this.get(e)!==void 0}set(e,n){const l=this.mapKeyFn(e),d=this.inner[l];if(d===void 0)return this.inner[l]=[[e,n]],void this.innerSize++;for(let y=0;y<d.length;y++)if(this.equalsFn(d[y][0],e))return void(d[y]=[e,n]);d.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),l=this.inner[n];if(l===void 0)return!1;for(let d=0;d<l.length;d++)if(this.equalsFn(l[d][0],e))return l.length===1?delete this.inner[n]:l.splice(d,1),this.innerSize--,!0;return!1}forEach(e){nd(this.inner,(n,l)=>{for(const[d,y]of l)e(d,y)})}isEmpty(){return S4(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const P$=new zr(Pi.comparator);function bu(){return P$}const G4=new zr(Pi.comparator);function ry(...t){let e=G4;for(const n of t)e=e.insert(n.key,n);return e}function H4(t){let e=G4;return t.forEach((n,l)=>e=e.insert(n,l.overlayedDocument)),e}function uf(){return Iy()}function $4(){return Iy()}function Iy(){return new kf(t=>t.toString(),(t,e)=>t.isEqual(e))}const L$=new zr(Pi.comparator),z$=new _s(Pi.comparator);function gn(...t){let e=z$;for(const n of t)e=e.add(n);return e}const O$=new _s(En);function k$(){return O$}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MA(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:z1(e)?"-0":e}}function Z4(t){return{integerValue:""+t}}function N$(t,e){return h$(e)?Z4(e):MA(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ib{constructor(){this._=void 0}}function F$(t,e,n){return t instanceof Jy?function(d,y){const A={fields:{[M4]:{stringValue:I4},[R4]:{timestampValue:{seconds:d.seconds,nanos:d.nanoseconds}}}};return y&&EA(y)&&(y=Tb(y)),y&&(A.fields[C4]=y),{mapValue:A}}(n,e):t instanceof Pm?X4(t,e):t instanceof e0?Y4(t,e):function(d,y){const A=W4(d,y),s=u3(A)+u3(d.Ie);return BE(A)&&BE(d.Ie)?Z4(s):MA(d.serializer,s)}(t,e)}function B$(t,e,n){return t instanceof Pm?X4(t,e):t instanceof e0?Y4(t,e):n}function W4(t,e){return t instanceof F1?function(l){return BE(l)||function(y){return!!y&&"doubleValue"in y}(l)}(e)?e:{integerValue:0}:null}class Jy extends Ib{}class Pm extends Ib{constructor(e){super(),this.elements=e}}function X4(t,e){const n=K4(e);for(const l of t.elements)n.some(d=>dc(d,l))||n.push(l);return{arrayValue:{values:n}}}class e0 extends Ib{constructor(e){super(),this.elements=e}}function Y4(t,e){let n=K4(e);for(const l of t.elements)n=n.filter(d=>!dc(d,l));return{arrayValue:{values:n}}}class F1 extends Ib{constructor(e,n){super(),this.serializer=e,this.Ie=n}}function u3(t){return Zr(t.integerValue||t.doubleValue)}function K4(t){return SA(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q4{constructor(e,n){this.field=e,this.transform=n}}function V$(t,e){return t.field.isEqual(e.field)&&function(l,d){return l instanceof Pm&&d instanceof Pm||l instanceof e0&&d instanceof e0?Cm(l.elements,d.elements,dc):l instanceof F1&&d instanceof F1?dc(l.Ie,d.Ie):l instanceof Jy&&d instanceof Jy}(t.transform,e.transform)}class U${constructor(e,n){this.version=e,this.transformResults=n}}class bl{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new bl}static exists(e){return new bl(void 0,e)}static updateTime(e){return new bl(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Zx(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class Mb{}function J4(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new tN(t.key,bl.none()):new b0(t.key,t.data,bl.none());{const n=t.data,l=Ua.empty();let d=new _s(js.comparator);for(let y of e.fields)if(!d.has(y)){let A=n.field(y);A===null&&y.length>1&&(y=y.popLast(),A=n.field(y)),A===null?l.delete(y):l.set(y,A),d=d.add(y)}return new rd(t.key,l,new co(d.toArray()),bl.none())}}function j$(t,e,n){t instanceof b0?function(d,y,A){const s=d.value.clone(),N=d3(d.fieldTransforms,y,A.transformResults);s.setAll(N),y.convertToFoundDocument(A.version,s).setHasCommittedMutations()}(t,e,n):t instanceof rd?function(d,y,A){if(!Zx(d.precondition,y))return void y.convertToUnknownDocument(A.version);const s=d3(d.fieldTransforms,y,A.transformResults),N=y.data;N.setAll(eN(d)),N.setAll(s),y.convertToFoundDocument(A.version,N).setHasCommittedMutations()}(t,e,n):function(d,y,A){y.convertToNoDocument(A.version).setHasCommittedMutations()}(0,e,n)}function My(t,e,n,l){return t instanceof b0?function(y,A,s,N){if(!Zx(y.precondition,A))return s;const j=y.value.clone(),K=f3(y.fieldTransforms,N,A);return j.setAll(K),A.convertToFoundDocument(A.version,j).setHasLocalMutations(),null}(t,e,n,l):t instanceof rd?function(y,A,s,N){if(!Zx(y.precondition,A))return s;const j=f3(y.fieldTransforms,N,A),K=A.data;return K.setAll(eN(y)),K.setAll(j),A.convertToFoundDocument(A.version,K).setHasLocalMutations(),s===null?null:s.unionWith(y.fieldMask.fields).unionWith(y.fieldTransforms.map(se=>se.field))}(t,e,n,l):function(y,A,s){return Zx(y.precondition,A)?(A.convertToNoDocument(A.version).setHasLocalMutations(),null):s}(t,e,n)}function q$(t,e){let n=null;for(const l of t.fieldTransforms){const d=e.data.field(l.field),y=W4(l.transform,d||null);y!=null&&(n===null&&(n=Ua.empty()),n.set(l.field,y))}return n||null}function h3(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(l,d){return l===void 0&&d===void 0||!(!l||!d)&&Cm(l,d,(y,A)=>V$(y,A))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class b0 extends Mb{constructor(e,n,l,d=[]){super(),this.key=e,this.value=n,this.precondition=l,this.fieldTransforms=d,this.type=0}getFieldMask(){return null}}class rd extends Mb{constructor(e,n,l,d,y=[]){super(),this.key=e,this.data=n,this.fieldMask=l,this.precondition=d,this.fieldTransforms=y,this.type=1}getFieldMask(){return this.fieldMask}}function eN(t){const e=new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const l=t.data.field(n);e.set(n,l)}}),e}function d3(t,e,n){const l=new Map;Vn(t.length===n.length);for(let d=0;d<n.length;d++){const y=t[d],A=y.transform,s=e.data.field(y.field);l.set(y.field,B$(A,s,n[d]))}return l}function f3(t,e,n){const l=new Map;for(const d of t){const y=d.transform,A=n.data.field(d.field);l.set(d.field,F$(y,A,e))}return l}class tN extends Mb{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class G$ extends Mb{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H${constructor(e,n,l,d){this.batchId=e,this.localWriteTime=n,this.baseMutations=l,this.mutations=d}applyToRemoteDocument(e,n){const l=n.mutationResults;for(let d=0;d<this.mutations.length;d++){const y=this.mutations[d];y.key.isEqual(e.key)&&j$(y,e,l[d])}}applyToLocalView(e,n){for(const l of this.baseMutations)l.key.isEqual(e.key)&&(n=My(l,e,n,this.localWriteTime));for(const l of this.mutations)l.key.isEqual(e.key)&&(n=My(l,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const l=$4();return this.mutations.forEach(d=>{const y=e.get(d.key),A=y.overlayedDocument;let s=this.applyToLocalView(A,y.mutatedFields);s=n.has(d.key)?null:s;const N=J4(A,s);N!==null&&l.set(d.key,N),A.isValidDocument()||A.convertToNoDocument(Ki.min())}),l}keys(){return this.mutations.reduce((e,n)=>e.add(n.key),gn())}isEqual(e){return this.batchId===e.batchId&&Cm(this.mutations,e.mutations,(n,l)=>h3(n,l))&&Cm(this.baseMutations,e.baseMutations,(n,l)=>h3(n,l))}}class CA{constructor(e,n,l,d){this.batch=e,this.commitVersion=n,this.mutationResults=l,this.docVersions=d}static from(e,n,l){Vn(e.mutations.length===l.length);let d=function(){return L$}();const y=e.mutations;for(let A=0;A<y.length;A++)d=d.insert(y[A].key,l[A].version);return new CA(e,n,l,d)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $${constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z${constructor(e,n){this.count=e,this.unchangedNames=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Qr,Mn;function W$(t){switch(t){case Nt.OK:return Hi();case Nt.CANCELLED:case Nt.UNKNOWN:case Nt.DEADLINE_EXCEEDED:case Nt.RESOURCE_EXHAUSTED:case Nt.INTERNAL:case Nt.UNAVAILABLE:case Nt.UNAUTHENTICATED:return!1;case Nt.INVALID_ARGUMENT:case Nt.NOT_FOUND:case Nt.ALREADY_EXISTS:case Nt.PERMISSION_DENIED:case Nt.FAILED_PRECONDITION:case Nt.ABORTED:case Nt.OUT_OF_RANGE:case Nt.UNIMPLEMENTED:case Nt.DATA_LOSS:return!0;default:return Hi()}}function iN(t){if(t===void 0)return xu("GRPC error has no .code"),Nt.UNKNOWN;switch(t){case Qr.OK:return Nt.OK;case Qr.CANCELLED:return Nt.CANCELLED;case Qr.UNKNOWN:return Nt.UNKNOWN;case Qr.DEADLINE_EXCEEDED:return Nt.DEADLINE_EXCEEDED;case Qr.RESOURCE_EXHAUSTED:return Nt.RESOURCE_EXHAUSTED;case Qr.INTERNAL:return Nt.INTERNAL;case Qr.UNAVAILABLE:return Nt.UNAVAILABLE;case Qr.UNAUTHENTICATED:return Nt.UNAUTHENTICATED;case Qr.INVALID_ARGUMENT:return Nt.INVALID_ARGUMENT;case Qr.NOT_FOUND:return Nt.NOT_FOUND;case Qr.ALREADY_EXISTS:return Nt.ALREADY_EXISTS;case Qr.PERMISSION_DENIED:return Nt.PERMISSION_DENIED;case Qr.FAILED_PRECONDITION:return Nt.FAILED_PRECONDITION;case Qr.ABORTED:return Nt.ABORTED;case Qr.OUT_OF_RANGE:return Nt.OUT_OF_RANGE;case Qr.UNIMPLEMENTED:return Nt.UNIMPLEMENTED;case Qr.DATA_LOSS:return Nt.DATA_LOSS;default:return Hi()}}(Mn=Qr||(Qr={}))[Mn.OK=0]="OK",Mn[Mn.CANCELLED=1]="CANCELLED",Mn[Mn.UNKNOWN=2]="UNKNOWN",Mn[Mn.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Mn[Mn.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Mn[Mn.NOT_FOUND=5]="NOT_FOUND",Mn[Mn.ALREADY_EXISTS=6]="ALREADY_EXISTS",Mn[Mn.PERMISSION_DENIED=7]="PERMISSION_DENIED",Mn[Mn.UNAUTHENTICATED=16]="UNAUTHENTICATED",Mn[Mn.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Mn[Mn.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Mn[Mn.ABORTED=10]="ABORTED",Mn[Mn.OUT_OF_RANGE=11]="OUT_OF_RANGE",Mn[Mn.UNIMPLEMENTED=12]="UNIMPLEMENTED",Mn[Mn.INTERNAL=13]="INTERNAL",Mn[Mn.UNAVAILABLE=14]="UNAVAILABLE",Mn[Mn.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function X$(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Y$=new kh([4294967295,4294967295],0);function p3(t){const e=X$().encode(t),n=new g4;return n.update(e),new Uint8Array(n.digest())}function m3(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),l=e.getUint32(4,!0),d=e.getUint32(8,!0),y=e.getUint32(12,!0);return[new kh([n,l],0),new kh([d,y],0)]}class RA{constructor(e,n,l){if(this.bitmap=e,this.padding=n,this.hashCount=l,n<0||n>=8)throw new sy(`Invalid padding: ${n}`);if(l<0)throw new sy(`Invalid hash count: ${l}`);if(e.length>0&&this.hashCount===0)throw new sy(`Invalid hash count: ${l}`);if(e.length===0&&n!==0)throw new sy(`Invalid padding when bitmap length is 0: ${n}`);this.Ee=8*e.length-n,this.de=kh.fromNumber(this.Ee)}Ae(e,n,l){let d=e.add(n.multiply(kh.fromNumber(l)));return d.compare(Y$)===1&&(d=new kh([d.getBits(0),d.getBits(1)],0)),d.modulo(this.de).toNumber()}Re(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.Ee===0)return!1;const n=p3(e),[l,d]=m3(n);for(let y=0;y<this.hashCount;y++){const A=this.Ae(l,d,y);if(!this.Re(A))return!1}return!0}static create(e,n,l){const d=e%8==0?0:8-e%8,y=new Uint8Array(Math.ceil(e/8)),A=new RA(y,d,n);return l.forEach(s=>A.insert(s)),A}insert(e){if(this.Ee===0)return;const n=p3(e),[l,d]=m3(n);for(let y=0;y<this.hashCount;y++){const A=this.Ae(l,d,y);this.Ve(A)}}Ve(e){const n=Math.floor(e/8),l=e%8;this.bitmap[n]|=1<<l}}class sy extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cb{constructor(e,n,l,d,y){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=l,this.documentUpdates=d,this.resolvedLimboDocuments=y}static createSynthesizedRemoteEventForCurrentChange(e,n,l){const d=new Map;return d.set(e,w0.createSynthesizedTargetChangeForCurrentChange(e,n,l)),new Cb(Ki.min(),d,new zr(En),bu(),gn())}}class w0{constructor(e,n,l,d,y){this.resumeToken=e,this.current=n,this.addedDocuments=l,this.modifiedDocuments=d,this.removedDocuments=y}static createSynthesizedTargetChangeForCurrentChange(e,n,l){return new w0(l,n,gn(),gn(),gn())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wx{constructor(e,n,l,d){this.me=e,this.removedTargetIds=n,this.key=l,this.fe=d}}class nN{constructor(e,n){this.targetId=e,this.ge=n}}class rN{constructor(e,n,l=$s.EMPTY_BYTE_STRING,d=null){this.state=e,this.targetIds=n,this.resumeToken=l,this.cause=d}}class g3{constructor(){this.pe=0,this.ye=_3(),this.we=$s.EMPTY_BYTE_STRING,this.be=!1,this.Se=!0}get current(){return this.be}get resumeToken(){return this.we}get De(){return this.pe!==0}get ve(){return this.Se}Ce(e){e.approximateByteSize()>0&&(this.Se=!0,this.we=e)}Fe(){let e=gn(),n=gn(),l=gn();return this.ye.forEach((d,y)=>{switch(y){case 0:e=e.add(d);break;case 2:n=n.add(d);break;case 1:l=l.add(d);break;default:Hi()}}),new w0(this.we,this.be,e,n,l)}Me(){this.Se=!1,this.ye=_3()}xe(e,n){this.Se=!0,this.ye=this.ye.insert(e,n)}Oe(e){this.Se=!0,this.ye=this.ye.remove(e)}Ne(){this.pe+=1}Be(){this.pe-=1,Vn(this.pe>=0)}Le(){this.Se=!0,this.be=!0}}class K${constructor(e){this.ke=e,this.qe=new Map,this.Qe=bu(),this.$e=Tx(),this.Ke=Tx(),this.Ue=new zr(En)}We(e){for(const n of e.me)e.fe&&e.fe.isFoundDocument()?this.Ge(n,e.fe):this.ze(n,e.key,e.fe);for(const n of e.removedTargetIds)this.ze(n,e.key,e.fe)}je(e){this.forEachTarget(e,n=>{const l=this.He(n);switch(e.state){case 0:this.Je(n)&&l.Ce(e.resumeToken);break;case 1:l.Be(),l.De||l.Me(),l.Ce(e.resumeToken);break;case 2:l.Be(),l.De||this.removeTarget(n);break;case 3:this.Je(n)&&(l.Le(),l.Ce(e.resumeToken));break;case 4:this.Je(n)&&(this.Ye(n),l.Ce(e.resumeToken));break;default:Hi()}})}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.qe.forEach((l,d)=>{this.Je(d)&&n(d)})}Ze(e){const n=e.targetId,l=e.ge.count,d=this.Xe(n);if(d){const y=d.target;if(UE(y))if(l===0){const A=new Pi(y.path);this.ze(n,A,la.newNoDocument(A,Ki.min()))}else Vn(l===1);else{const A=this.et(n);if(A!==l){const s=this.tt(e),N=s?this.nt(s,e,A):1;if(N!==0){this.Ye(n);const j=N===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ue=this.Ue.insert(n,j)}}}}}tt(e){const n=e.ge.unchangedNames;if(!n||!n.bits)return null;const{bits:{bitmap:l="",padding:d=0},hashCount:y=0}=n;let A,s;try{A=Zh(l).toUint8Array()}catch(N){if(N instanceof A4)return Mm("Decoding the base64 bloom filter in existence filter failed ("+N.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw N}try{s=new RA(A,d,y)}catch(N){return Mm(N instanceof sy?"BloomFilter error: ":"Applying bloom filter failed: ",N),null}return s.Ee===0?null:s}nt(e,n,l){return n.ge.count===l-this.st(e,n.targetId)?0:2}st(e,n){const l=this.ke.getRemoteKeysForTarget(n);let d=0;return l.forEach(y=>{const A=this.ke.it(),s=`projects/${A.projectId}/databases/${A.database}/documents/${y.path.canonicalString()}`;e.mightContain(s)||(this.ze(n,y,null),d++)}),d}ot(e){const n=new Map;this.qe.forEach((y,A)=>{const s=this.Xe(A);if(s){if(y.current&&UE(s.target)){const N=new Pi(s.target.path);this._t(N).has(A)||this.ut(A,N)||this.ze(A,N,la.newNoDocument(N,e))}y.ve&&(n.set(A,y.Fe()),y.Me())}});let l=gn();this.Ke.forEach((y,A)=>{let s=!0;A.forEachWhile(N=>{const j=this.Xe(N);return!j||j.purpose==="TargetPurposeLimboResolution"||(s=!1,!1)}),s&&(l=l.add(y))}),this.Qe.forEach((y,A)=>A.setReadTime(e));const d=new Cb(e,n,this.Ue,this.Qe,l);return this.Qe=bu(),this.$e=Tx(),this.Ke=Tx(),this.Ue=new zr(En),d}Ge(e,n){if(!this.Je(e))return;const l=this.ut(e,n.key)?2:0;this.He(e).xe(n.key,l),this.Qe=this.Qe.insert(n.key,n),this.$e=this.$e.insert(n.key,this._t(n.key).add(e)),this.Ke=this.Ke.insert(n.key,this.ct(n.key).add(e))}ze(e,n,l){if(!this.Je(e))return;const d=this.He(e);this.ut(e,n)?d.xe(n,1):d.Oe(n),this.Ke=this.Ke.insert(n,this.ct(n).delete(e)),this.Ke=this.Ke.insert(n,this.ct(n).add(e)),l&&(this.Qe=this.Qe.insert(n,l))}removeTarget(e){this.qe.delete(e)}et(e){const n=this.He(e).Fe();return this.ke.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}Ne(e){this.He(e).Ne()}He(e){let n=this.qe.get(e);return n||(n=new g3,this.qe.set(e,n)),n}ct(e){let n=this.Ke.get(e);return n||(n=new _s(En),this.Ke=this.Ke.insert(e,n)),n}_t(e){let n=this.$e.get(e);return n||(n=new _s(En),this.$e=this.$e.insert(e,n)),n}Je(e){const n=this.Xe(e)!==null;return n||mi("WatchChangeAggregator","Detected inactive target",e),n}Xe(e){const n=this.qe.get(e);return n&&n.De?null:this.ke.lt(e)}Ye(e){this.qe.set(e,new g3),this.ke.getRemoteKeysForTarget(e).forEach(n=>{this.ze(e,n,null)})}ut(e,n){return this.ke.getRemoteKeysForTarget(e).has(n)}}function Tx(){return new zr(Pi.comparator)}function _3(){return new zr(Pi.comparator)}const Q$=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),J$=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),eZ=(()=>({and:"AND",or:"OR"}))();class tZ{constructor(e,n){this.databaseId=e,this.useProto3Json=n}}function GE(t,e){return t.useProto3Json||wb(e)?e:{value:e}}function B1(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function sN(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function iZ(t,e){return B1(t,e.toTimestamp())}function cc(t){return Vn(!!t),Ki.fromTimestamp(function(n){const l=$h(n);return new Vr(l.seconds,l.nanos)}(t))}function DA(t,e){return HE(t,e).canonicalString()}function HE(t,e){const n=function(d){return new gr(["projects",d.projectId,"databases",d.database])}(t).child("documents");return e===void 0?n:n.child(e)}function aN(t){const e=gr.fromString(t);return Vn(hN(e)),e}function $E(t,e){return DA(t.databaseId,e.path)}function M2(t,e){const n=aN(e);if(n.get(1)!==t.databaseId.projectId)throw new gi(Nt.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new gi(Nt.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new Pi(lN(n))}function oN(t,e){return DA(t.databaseId,e)}function nZ(t){const e=aN(t);return e.length===4?gr.emptyPath():lN(e)}function ZE(t){return new gr(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function lN(t){return Vn(t.length>4&&t.get(4)==="documents"),t.popFirst(5)}function y3(t,e,n){return{name:$E(t,e),fields:n.value.mapValue.fields}}function rZ(t,e){let n;if("targetChange"in e){e.targetChange;const l=function(j){return j==="NO_CHANGE"?0:j==="ADD"?1:j==="REMOVE"?2:j==="CURRENT"?3:j==="RESET"?4:Hi()}(e.targetChange.targetChangeType||"NO_CHANGE"),d=e.targetChange.targetIds||[],y=function(j,K){return j.useProto3Json?(Vn(K===void 0||typeof K=="string"),$s.fromBase64String(K||"")):(Vn(K===void 0||K instanceof Buffer||K instanceof Uint8Array),$s.fromUint8Array(K||new Uint8Array))}(t,e.targetChange.resumeToken),A=e.targetChange.cause,s=A&&function(j){const K=j.code===void 0?Nt.UNKNOWN:iN(j.code);return new gi(K,j.message||"")}(A);n=new rN(l,d,y,s||null)}else if("documentChange"in e){e.documentChange;const l=e.documentChange;l.document,l.document.name,l.document.updateTime;const d=M2(t,l.document.name),y=cc(l.document.updateTime),A=l.document.createTime?cc(l.document.createTime):Ki.min(),s=new Ua({mapValue:{fields:l.document.fields}}),N=la.newFoundDocument(d,y,A,s),j=l.targetIds||[],K=l.removedTargetIds||[];n=new Wx(j,K,N.key,N)}else if("documentDelete"in e){e.documentDelete;const l=e.documentDelete;l.document;const d=M2(t,l.document),y=l.readTime?cc(l.readTime):Ki.min(),A=la.newNoDocument(d,y),s=l.removedTargetIds||[];n=new Wx([],s,A.key,A)}else if("documentRemove"in e){e.documentRemove;const l=e.documentRemove;l.document;const d=M2(t,l.document),y=l.removedTargetIds||[];n=new Wx([],y,d,null)}else{if(!("filter"in e))return Hi();{e.filter;const l=e.filter;l.targetId;const{count:d=0,unchangedNames:y}=l,A=new Z$(d,y),s=l.targetId;n=new nN(s,A)}}return n}function sZ(t,e){let n;if(e instanceof b0)n={update:y3(t,e.key,e.value)};else if(e instanceof tN)n={delete:$E(t,e.key)};else if(e instanceof rd)n={update:y3(t,e.key,e.data),updateMask:pZ(e.fieldMask)};else{if(!(e instanceof G$))return Hi();n={verify:$E(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(l=>function(y,A){const s=A.transform;if(s instanceof Jy)return{fieldPath:A.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(s instanceof Pm)return{fieldPath:A.field.canonicalString(),appendMissingElements:{values:s.elements}};if(s instanceof e0)return{fieldPath:A.field.canonicalString(),removeAllFromArray:{values:s.elements}};if(s instanceof F1)return{fieldPath:A.field.canonicalString(),increment:s.Ie};throw Hi()}(0,l))),e.precondition.isNone||(n.currentDocument=function(d,y){return y.updateTime!==void 0?{updateTime:iZ(d,y.updateTime)}:y.exists!==void 0?{exists:y.exists}:Hi()}(t,e.precondition)),n}function aZ(t,e){return t&&t.length>0?(Vn(e!==void 0),t.map(n=>function(d,y){let A=d.updateTime?cc(d.updateTime):cc(y);return A.isEqual(Ki.min())&&(A=cc(y)),new U$(A,d.transformResults||[])}(n,e))):[]}function oZ(t,e){return{documents:[oN(t,e.path)]}}function lZ(t,e){const n={structuredQuery:{}},l=e.path;let d;e.collectionGroup!==null?(d=l,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(d=l.popLast(),n.structuredQuery.from=[{collectionId:l.lastSegment()}]),n.parent=oN(t,d);const y=function(j){if(j.length!==0)return uN(Sl.create(j,"and"))}(e.filters);y&&(n.structuredQuery.where=y);const A=function(j){if(j.length!==0)return j.map(K=>function(ae){return{field:Zp(ae.field),direction:hZ(ae.dir)}}(K))}(e.orderBy);A&&(n.structuredQuery.orderBy=A);const s=GE(t,e.limit);return s!==null&&(n.structuredQuery.limit=s),e.startAt&&(n.structuredQuery.startAt=function(j){return{before:j.inclusive,values:j.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(j){return{before:!j.inclusive,values:j.position}}(e.endAt)),{ht:n,parent:d}}function cZ(t){let e=nZ(t.parent);const n=t.structuredQuery,l=n.from?n.from.length:0;let d=null;if(l>0){Vn(l===1);const K=n.from[0];K.allDescendants?d=K.collectionId:e=e.child(K.collectionId)}let y=[];n.where&&(y=function(se){const ae=cN(se);return ae instanceof Sl&&N4(ae)?ae.getFilters():[ae]}(n.where));let A=[];n.orderBy&&(A=function(se){return se.map(ae=>function(Ue){return new Qy(Wp(Ue.field),function(it){switch(it){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(Ue.direction))}(ae))}(n.orderBy));let s=null;n.limit&&(s=function(se){let ae;return ae=typeof se=="object"?se.value:se,wb(ae)?null:ae}(n.limit));let N=null;n.startAt&&(N=function(se){const ae=!!se.before,me=se.values||[];return new N1(me,ae)}(n.startAt));let j=null;return n.endAt&&(j=function(se){const ae=!se.before,me=se.values||[];return new N1(me,ae)}(n.endAt)),M$(e,d,A,y,s,"F",N,j)}function uZ(t,e){const n=function(d){switch(d){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Hi()}}(e.purpose);return n==null?null:{"goog-listen-tags":n}}function cN(t){return t.unaryFilter!==void 0?function(n){switch(n.unaryFilter.op){case"IS_NAN":const l=Wp(n.unaryFilter.field);return is.create(l,"==",{doubleValue:NaN});case"IS_NULL":const d=Wp(n.unaryFilter.field);return is.create(d,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const y=Wp(n.unaryFilter.field);return is.create(y,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const A=Wp(n.unaryFilter.field);return is.create(A,"!=",{nullValue:"NULL_VALUE"});default:return Hi()}}(t):t.fieldFilter!==void 0?function(n){return is.create(Wp(n.fieldFilter.field),function(d){switch(d){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Hi()}}(n.fieldFilter.op),n.fieldFilter.value)}(t):t.compositeFilter!==void 0?function(n){return Sl.create(n.compositeFilter.filters.map(l=>cN(l)),function(d){switch(d){case"AND":return"and";case"OR":return"or";default:return Hi()}}(n.compositeFilter.op))}(t):Hi()}function hZ(t){return Q$[t]}function dZ(t){return J$[t]}function fZ(t){return eZ[t]}function Zp(t){return{fieldPath:t.canonicalString()}}function Wp(t){return js.fromServerFormat(t.fieldPath)}function uN(t){return t instanceof is?function(n){if(n.op==="=="){if(s3(n.value))return{unaryFilter:{field:Zp(n.field),op:"IS_NAN"}};if(r3(n.value))return{unaryFilter:{field:Zp(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(s3(n.value))return{unaryFilter:{field:Zp(n.field),op:"IS_NOT_NAN"}};if(r3(n.value))return{unaryFilter:{field:Zp(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Zp(n.field),op:dZ(n.op),value:n.value}}}(t):t instanceof Sl?function(n){const l=n.getFilters().map(d=>uN(d));return l.length===1?l[0]:{compositeFilter:{op:fZ(n.op),filters:l}}}(t):Hi()}function pZ(t){const e=[];return t.fields.forEach(n=>e.push(n.canonicalString())),{fieldPaths:e}}function hN(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eh{constructor(e,n,l,d,y=Ki.min(),A=Ki.min(),s=$s.EMPTY_BYTE_STRING,N=null){this.target=e,this.targetId=n,this.purpose=l,this.sequenceNumber=d,this.snapshotVersion=y,this.lastLimboFreeSnapshotVersion=A,this.resumeToken=s,this.expectedCount=N}withSequenceNumber(e){return new Eh(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new Eh(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Eh(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Eh(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mZ{constructor(e){this.Tt=e}}function gZ(t){const e=cZ({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?qE(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _Z{constructor(){this.Tn=new yZ}addToCollectionParentIndex(e,n){return this.Tn.add(n),Bt.resolve()}getCollectionParents(e,n){return Bt.resolve(this.Tn.getEntries(n))}addFieldIndex(e,n){return Bt.resolve()}deleteFieldIndex(e,n){return Bt.resolve()}deleteAllFieldIndexes(e){return Bt.resolve()}createTargetIndexes(e,n){return Bt.resolve()}getDocumentsMatchingTarget(e,n){return Bt.resolve(null)}getIndexType(e,n){return Bt.resolve(0)}getFieldIndexes(e,n){return Bt.resolve([])}getNextCollectionGroupToUpdate(e){return Bt.resolve(null)}getMinOffset(e,n){return Bt.resolve(Hh.min())}getMinOffsetFromCollectionGroup(e,n){return Bt.resolve(Hh.min())}updateCollectionGroup(e,n,l){return Bt.resolve()}updateIndexEntries(e,n){return Bt.resolve()}}class yZ{constructor(){this.index={}}add(e){const n=e.lastSegment(),l=e.popLast(),d=this.index[n]||new _s(gr.comparator),y=!d.has(l);return this.index[n]=d.add(l),y}has(e){const n=e.lastSegment(),l=e.popLast(),d=this.index[n];return d&&d.has(l)}getEntries(e){return(this.index[e]||new _s(gr.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const v3={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},dN=41943040;class Va{static withCacheSize(e){return new Va(e,Va.DEFAULT_COLLECTION_PERCENTILE,Va.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,n,l){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=l}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Va.DEFAULT_COLLECTION_PERCENTILE=10,Va.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Va.DEFAULT=new Va(dN,Va.DEFAULT_COLLECTION_PERCENTILE,Va.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Va.DISABLED=new Va(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lm{constructor(e){this.$n=e}next(){return this.$n+=2,this.$n}static Kn(){return new Lm(0)}static Un(){return new Lm(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const x3="LruGarbageCollector",vZ=1048576;function b3([t,e],[n,l]){const d=En(t,n);return d===0?En(e,l):d}class xZ{constructor(e){this.Hn=e,this.buffer=new _s(b3),this.Jn=0}Yn(){return++this.Jn}Zn(e){const n=[e,this.Yn()];if(this.buffer.size<this.Hn)this.buffer=this.buffer.add(n);else{const l=this.buffer.last();b3(n,l)<0&&(this.buffer=this.buffer.delete(l).add(n))}}get maxValue(){return this.buffer.last()[0]}}class bZ{constructor(e,n,l){this.garbageCollector=e,this.asyncQueue=n,this.localStore=l,this.Xn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.er(6e4)}stop(){this.Xn&&(this.Xn.cancel(),this.Xn=null)}get started(){return this.Xn!==null}er(e){mi(x3,`Garbage collection scheduled in ${e}ms`),this.Xn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Xn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(n){Km(n)?mi(x3,"Ignoring IndexedDB error during garbage collection: ",n):await Ym(n)}await this.er(3e5)})}}class wZ{constructor(e,n){this.tr=e,this.params=n}calculateTargetCount(e,n){return this.tr.nr(e).next(l=>Math.floor(n/100*l))}nthSequenceNumber(e,n){if(n===0)return Bt.resolve(bb.ae);const l=new xZ(n);return this.tr.forEachTarget(e,d=>l.Zn(d.sequenceNumber)).next(()=>this.tr.rr(e,d=>l.Zn(d))).next(()=>l.maxValue)}removeTargets(e,n,l){return this.tr.removeTargets(e,n,l)}removeOrphanedDocuments(e,n){return this.tr.removeOrphanedDocuments(e,n)}collect(e,n){return this.params.cacheSizeCollectionThreshold===-1?(mi("LruGarbageCollector","Garbage collection skipped; disabled"),Bt.resolve(v3)):this.getCacheSize(e).next(l=>l<this.params.cacheSizeCollectionThreshold?(mi("LruGarbageCollector",`Garbage collection skipped; Cache size ${l} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),v3):this.ir(e,n))}getCacheSize(e){return this.tr.getCacheSize(e)}ir(e,n){let l,d,y,A,s,N,j;const K=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(se=>(se>this.params.maximumSequenceNumbersToCollect?(mi("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${se}`),d=this.params.maximumSequenceNumbersToCollect):d=se,A=Date.now(),this.nthSequenceNumber(e,d))).next(se=>(l=se,s=Date.now(),this.removeTargets(e,l,n))).next(se=>(y=se,N=Date.now(),this.removeOrphanedDocuments(e,l))).next(se=>(j=Date.now(),Hp()<=mn.DEBUG&&mi("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${A-K}ms
	Determined least recently used ${d} in `+(s-A)+`ms
	Removed ${y} targets in `+(N-s)+`ms
	Removed ${se} documents in `+(j-N)+`ms
Total Duration: ${j-K}ms`),Bt.resolve({didRun:!0,sequenceNumbersCollected:d,targetsRemoved:y,documentsRemoved:se})))}}function TZ(t,e){return new wZ(t,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EZ{constructor(){this.changes=new kf(e=>e.toString(),(e,n)=>e.isEqual(n)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,la.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const l=this.changes.get(n);return l!==void 0?Bt.resolve(l):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SZ{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AZ{constructor(e,n,l,d){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=l,this.indexManager=d}getDocument(e,n){let l=null;return this.documentOverlayCache.getOverlay(e,n).next(d=>(l=d,this.remoteDocumentCache.getEntry(e,n))).next(d=>(l!==null&&My(l.mutation,d,co.empty(),Vr.now()),d))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next(l=>this.getLocalViewOfDocuments(e,l,gn()).next(()=>l))}getLocalViewOfDocuments(e,n,l=gn()){const d=uf();return this.populateOverlays(e,d,n).next(()=>this.computeViews(e,n,d,l).next(y=>{let A=ry();return y.forEach((s,N)=>{A=A.insert(s,N.overlayedDocument)}),A}))}getOverlayedDocuments(e,n){const l=uf();return this.populateOverlays(e,l,n).next(()=>this.computeViews(e,n,l,gn()))}populateOverlays(e,n,l){const d=[];return l.forEach(y=>{n.has(y)||d.push(y)}),this.documentOverlayCache.getOverlays(e,d).next(y=>{y.forEach((A,s)=>{n.set(A,s)})})}computeViews(e,n,l,d){let y=bu();const A=Iy(),s=function(){return Iy()}();return n.forEach((N,j)=>{const K=l.get(j.key);d.has(j.key)&&(K===void 0||K.mutation instanceof rd)?y=y.insert(j.key,j):K!==void 0?(A.set(j.key,K.mutation.getFieldMask()),My(K.mutation,j,K.mutation.getFieldMask(),Vr.now())):A.set(j.key,co.empty())}),this.recalculateAndSaveOverlays(e,y).next(N=>(N.forEach((j,K)=>A.set(j,K)),n.forEach((j,K)=>{var se;return s.set(j,new SZ(K,(se=A.get(j))!==null&&se!==void 0?se:null))}),s))}recalculateAndSaveOverlays(e,n){const l=Iy();let d=new zr((A,s)=>A-s),y=gn();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next(A=>{for(const s of A)s.keys().forEach(N=>{const j=n.get(N);if(j===null)return;let K=l.get(N)||co.empty();K=s.applyToLocalView(j,K),l.set(N,K);const se=(d.get(s.batchId)||gn()).add(N);d=d.insert(s.batchId,se)})}).next(()=>{const A=[],s=d.getReverseIterator();for(;s.hasNext();){const N=s.getNext(),j=N.key,K=N.value,se=$4();K.forEach(ae=>{if(!y.has(ae)){const me=J4(n.get(ae),l.get(ae));me!==null&&se.set(ae,me),y=y.add(ae)}}),A.push(this.documentOverlayCache.saveOverlays(e,j,se))}return Bt.waitFor(A)}).next(()=>l)}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next(l=>this.recalculateAndSaveOverlays(e,l))}getDocumentsMatchingQuery(e,n,l,d){return function(A){return Pi.isDocumentKey(A.path)&&A.collectionGroup===null&&A.filters.length===0}(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):U4(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,l,d):this.getDocumentsMatchingCollectionQuery(e,n,l,d)}getNextDocuments(e,n,l,d){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,l,d).next(y=>{const A=d-y.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,l.largestBatchId,d-y.size):Bt.resolve(uf());let s=Wy,N=y;return A.next(j=>Bt.forEach(j,(K,se)=>(s<se.largestBatchId&&(s=se.largestBatchId),y.get(K)?Bt.resolve():this.remoteDocumentCache.getEntry(e,K).next(ae=>{N=N.insert(K,ae)}))).next(()=>this.populateOverlays(e,j,y)).next(()=>this.computeViews(e,N,j,gn())).next(K=>({batchId:s,changes:H4(K)})))})}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new Pi(n)).next(l=>{let d=ry();return l.isFoundDocument()&&(d=d.insert(l.key,l)),d})}getDocumentsMatchingCollectionGroupQuery(e,n,l,d){const y=n.collectionGroup;let A=ry();return this.indexManager.getCollectionParents(e,y).next(s=>Bt.forEach(s,N=>{const j=function(se,ae){return new Qm(ae,null,se.explicitOrderBy.slice(),se.filters.slice(),se.limit,se.limitType,se.startAt,se.endAt)}(n,N.child(y));return this.getDocumentsMatchingCollectionQuery(e,j,l,d).next(K=>{K.forEach((se,ae)=>{A=A.insert(se,ae)})})}).next(()=>A))}getDocumentsMatchingCollectionQuery(e,n,l,d){let y;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,l.largestBatchId).next(A=>(y=A,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,l,y,d))).next(A=>{y.forEach((N,j)=>{const K=j.getKey();A.get(K)===null&&(A=A.insert(K,la.newInvalidDocument(K)))});let s=ry();return A.forEach((N,j)=>{const K=y.get(N);K!==void 0&&My(K.mutation,j,co.empty(),Vr.now()),Ab(n,j)&&(s=s.insert(N,j))}),s})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IZ{constructor(e){this.serializer=e,this.dr=new Map,this.Ar=new Map}getBundleMetadata(e,n){return Bt.resolve(this.dr.get(n))}saveBundleMetadata(e,n){return this.dr.set(n.id,function(d){return{id:d.id,version:d.version,createTime:cc(d.createTime)}}(n)),Bt.resolve()}getNamedQuery(e,n){return Bt.resolve(this.Ar.get(n))}saveNamedQuery(e,n){return this.Ar.set(n.name,function(d){return{name:d.name,query:gZ(d.bundledQuery),readTime:cc(d.readTime)}}(n)),Bt.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MZ{constructor(){this.overlays=new zr(Pi.comparator),this.Rr=new Map}getOverlay(e,n){return Bt.resolve(this.overlays.get(n))}getOverlays(e,n){const l=uf();return Bt.forEach(n,d=>this.getOverlay(e,d).next(y=>{y!==null&&l.set(d,y)})).next(()=>l)}saveOverlays(e,n,l){return l.forEach((d,y)=>{this.Et(e,n,y)}),Bt.resolve()}removeOverlaysForBatchId(e,n,l){const d=this.Rr.get(l);return d!==void 0&&(d.forEach(y=>this.overlays=this.overlays.remove(y)),this.Rr.delete(l)),Bt.resolve()}getOverlaysForCollection(e,n,l){const d=uf(),y=n.length+1,A=new Pi(n.child("")),s=this.overlays.getIteratorFrom(A);for(;s.hasNext();){const N=s.getNext().value,j=N.getKey();if(!n.isPrefixOf(j.path))break;j.path.length===y&&N.largestBatchId>l&&d.set(N.getKey(),N)}return Bt.resolve(d)}getOverlaysForCollectionGroup(e,n,l,d){let y=new zr((j,K)=>j-K);const A=this.overlays.getIterator();for(;A.hasNext();){const j=A.getNext().value;if(j.getKey().getCollectionGroup()===n&&j.largestBatchId>l){let K=y.get(j.largestBatchId);K===null&&(K=uf(),y=y.insert(j.largestBatchId,K)),K.set(j.getKey(),j)}}const s=uf(),N=y.getIterator();for(;N.hasNext()&&(N.getNext().value.forEach((j,K)=>s.set(j,K)),!(s.size()>=d)););return Bt.resolve(s)}Et(e,n,l){const d=this.overlays.get(l.key);if(d!==null){const A=this.Rr.get(d.largestBatchId).delete(l.key);this.Rr.set(d.largestBatchId,A)}this.overlays=this.overlays.insert(l.key,new $$(n,l));let y=this.Rr.get(n);y===void 0&&(y=gn(),this.Rr.set(n,y)),this.Rr.set(n,y.add(l.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CZ{constructor(){this.sessionToken=$s.EMPTY_BYTE_STRING}getSessionToken(e){return Bt.resolve(this.sessionToken)}setSessionToken(e,n){return this.sessionToken=n,Bt.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PA{constructor(){this.Vr=new _s(Es.mr),this.gr=new _s(Es.pr)}isEmpty(){return this.Vr.isEmpty()}addReference(e,n){const l=new Es(e,n);this.Vr=this.Vr.add(l),this.gr=this.gr.add(l)}yr(e,n){e.forEach(l=>this.addReference(l,n))}removeReference(e,n){this.wr(new Es(e,n))}br(e,n){e.forEach(l=>this.removeReference(l,n))}Sr(e){const n=new Pi(new gr([])),l=new Es(n,e),d=new Es(n,e+1),y=[];return this.gr.forEachInRange([l,d],A=>{this.wr(A),y.push(A.key)}),y}Dr(){this.Vr.forEach(e=>this.wr(e))}wr(e){this.Vr=this.Vr.delete(e),this.gr=this.gr.delete(e)}vr(e){const n=new Pi(new gr([])),l=new Es(n,e),d=new Es(n,e+1);let y=gn();return this.gr.forEachInRange([l,d],A=>{y=y.add(A.key)}),y}containsKey(e){const n=new Es(e,0),l=this.Vr.firstAfterOrEqual(n);return l!==null&&e.isEqual(l.key)}}class Es{constructor(e,n){this.key=e,this.Cr=n}static mr(e,n){return Pi.comparator(e.key,n.key)||En(e.Cr,n.Cr)}static pr(e,n){return En(e.Cr,n.Cr)||Pi.comparator(e.key,n.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RZ{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.Fr=1,this.Mr=new _s(Es.mr)}checkEmpty(e){return Bt.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,l,d){const y=this.Fr;this.Fr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const A=new H$(y,n,l,d);this.mutationQueue.push(A);for(const s of d)this.Mr=this.Mr.add(new Es(s.key,y)),this.indexManager.addToCollectionParentIndex(e,s.key.path.popLast());return Bt.resolve(A)}lookupMutationBatch(e,n){return Bt.resolve(this.Or(n))}getNextMutationBatchAfterBatchId(e,n){const l=n+1,d=this.Nr(l),y=d<0?0:d;return Bt.resolve(this.mutationQueue.length>y?this.mutationQueue[y]:null)}getHighestUnacknowledgedBatchId(){return Bt.resolve(this.mutationQueue.length===0?TA:this.Fr-1)}getAllMutationBatches(e){return Bt.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const l=new Es(n,0),d=new Es(n,Number.POSITIVE_INFINITY),y=[];return this.Mr.forEachInRange([l,d],A=>{const s=this.Or(A.Cr);y.push(s)}),Bt.resolve(y)}getAllMutationBatchesAffectingDocumentKeys(e,n){let l=new _s(En);return n.forEach(d=>{const y=new Es(d,0),A=new Es(d,Number.POSITIVE_INFINITY);this.Mr.forEachInRange([y,A],s=>{l=l.add(s.Cr)})}),Bt.resolve(this.Br(l))}getAllMutationBatchesAffectingQuery(e,n){const l=n.path,d=l.length+1;let y=l;Pi.isDocumentKey(y)||(y=y.child(""));const A=new Es(new Pi(y),0);let s=new _s(En);return this.Mr.forEachWhile(N=>{const j=N.key.path;return!!l.isPrefixOf(j)&&(j.length===d&&(s=s.add(N.Cr)),!0)},A),Bt.resolve(this.Br(s))}Br(e){const n=[];return e.forEach(l=>{const d=this.Or(l);d!==null&&n.push(d)}),n}removeMutationBatch(e,n){Vn(this.Lr(n.batchId,"removed")===0),this.mutationQueue.shift();let l=this.Mr;return Bt.forEach(n.mutations,d=>{const y=new Es(d.key,n.batchId);return l=l.delete(y),this.referenceDelegate.markPotentiallyOrphaned(e,d.key)}).next(()=>{this.Mr=l})}qn(e){}containsKey(e,n){const l=new Es(n,0),d=this.Mr.firstAfterOrEqual(l);return Bt.resolve(n.isEqual(d&&d.key))}performConsistencyCheck(e){return this.mutationQueue.length,Bt.resolve()}Lr(e,n){return this.Nr(e)}Nr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Or(e){const n=this.Nr(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DZ{constructor(e){this.kr=e,this.docs=function(){return new zr(Pi.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const l=n.key,d=this.docs.get(l),y=d?d.size:0,A=this.kr(n);return this.docs=this.docs.insert(l,{document:n.mutableCopy(),size:A}),this.size+=A-y,this.indexManager.addToCollectionParentIndex(e,l.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const l=this.docs.get(n);return Bt.resolve(l?l.document.mutableCopy():la.newInvalidDocument(n))}getEntries(e,n){let l=bu();return n.forEach(d=>{const y=this.docs.get(d);l=l.insert(d,y?y.document.mutableCopy():la.newInvalidDocument(d))}),Bt.resolve(l)}getDocumentsMatchingQuery(e,n,l,d){let y=bu();const A=n.path,s=new Pi(A.child("__id-9223372036854775808__")),N=this.docs.getIteratorFrom(s);for(;N.hasNext();){const{key:j,value:{document:K}}=N.getNext();if(!A.isPrefixOf(j.path))break;j.path.length>A.length+1||o$(a$(K),l)<=0||(d.has(K.key)||Ab(n,K))&&(y=y.insert(K.key,K.mutableCopy()))}return Bt.resolve(y)}getAllFromCollectionGroup(e,n,l,d){Hi()}qr(e,n){return Bt.forEach(this.docs,l=>n(l))}newChangeBuffer(e){return new PZ(this)}getSize(e){return Bt.resolve(this.size)}}class PZ extends EZ{constructor(e){super(),this.Ir=e}applyChanges(e){const n=[];return this.changes.forEach((l,d)=>{d.isValidDocument()?n.push(this.Ir.addEntry(e,d)):this.Ir.removeEntry(l)}),Bt.waitFor(n)}getFromCache(e,n){return this.Ir.getEntry(e,n)}getAllFromCache(e,n){return this.Ir.getEntries(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LZ{constructor(e){this.persistence=e,this.Qr=new kf(n=>AA(n),IA),this.lastRemoteSnapshotVersion=Ki.min(),this.highestTargetId=0,this.$r=0,this.Kr=new PA,this.targetCount=0,this.Ur=Lm.Kn()}forEachTarget(e,n){return this.Qr.forEach((l,d)=>n(d)),Bt.resolve()}getLastRemoteSnapshotVersion(e){return Bt.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Bt.resolve(this.$r)}allocateTargetId(e){return this.highestTargetId=this.Ur.next(),Bt.resolve(this.highestTargetId)}setTargetsMetadata(e,n,l){return l&&(this.lastRemoteSnapshotVersion=l),n>this.$r&&(this.$r=n),Bt.resolve()}zn(e){this.Qr.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.Ur=new Lm(n),this.highestTargetId=n),e.sequenceNumber>this.$r&&(this.$r=e.sequenceNumber)}addTargetData(e,n){return this.zn(n),this.targetCount+=1,Bt.resolve()}updateTargetData(e,n){return this.zn(n),Bt.resolve()}removeTargetData(e,n){return this.Qr.delete(n.target),this.Kr.Sr(n.targetId),this.targetCount-=1,Bt.resolve()}removeTargets(e,n,l){let d=0;const y=[];return this.Qr.forEach((A,s)=>{s.sequenceNumber<=n&&l.get(s.targetId)===null&&(this.Qr.delete(A),y.push(this.removeMatchingKeysForTargetId(e,s.targetId)),d++)}),Bt.waitFor(y).next(()=>d)}getTargetCount(e){return Bt.resolve(this.targetCount)}getTargetData(e,n){const l=this.Qr.get(n)||null;return Bt.resolve(l)}addMatchingKeys(e,n,l){return this.Kr.yr(n,l),Bt.resolve()}removeMatchingKeys(e,n,l){this.Kr.br(n,l);const d=this.persistence.referenceDelegate,y=[];return d&&n.forEach(A=>{y.push(d.markPotentiallyOrphaned(e,A))}),Bt.waitFor(y)}removeMatchingKeysForTargetId(e,n){return this.Kr.Sr(n),Bt.resolve()}getMatchingKeysForTargetId(e,n){const l=this.Kr.vr(n);return Bt.resolve(l)}containsKey(e,n){return Bt.resolve(this.Kr.containsKey(n))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fN{constructor(e,n){this.Wr={},this.overlays={},this.Gr=new bb(0),this.zr=!1,this.zr=!0,this.jr=new CZ,this.referenceDelegate=e(this),this.Hr=new LZ(this),this.indexManager=new _Z,this.remoteDocumentCache=function(d){return new DZ(d)}(l=>this.referenceDelegate.Jr(l)),this.serializer=new mZ(n),this.Yr=new IZ(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.zr=!1,Promise.resolve()}get started(){return this.zr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new MZ,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let l=this.Wr[e.toKey()];return l||(l=new RZ(n,this.referenceDelegate),this.Wr[e.toKey()]=l),l}getGlobalsCache(){return this.jr}getTargetCache(){return this.Hr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Yr}runTransaction(e,n,l){mi("MemoryPersistence","Starting transaction:",e);const d=new zZ(this.Gr.next());return this.referenceDelegate.Zr(),l(d).next(y=>this.referenceDelegate.Xr(d).next(()=>y)).toPromise().then(y=>(d.raiseOnCommittedEvent(),y))}ei(e,n){return Bt.or(Object.values(this.Wr).map(l=>()=>l.containsKey(e,n)))}}class zZ extends c${constructor(e){super(),this.currentSequenceNumber=e}}class LA{constructor(e){this.persistence=e,this.ti=new PA,this.ni=null}static ri(e){return new LA(e)}get ii(){if(this.ni)return this.ni;throw Hi()}addReference(e,n,l){return this.ti.addReference(l,n),this.ii.delete(l.toString()),Bt.resolve()}removeReference(e,n,l){return this.ti.removeReference(l,n),this.ii.add(l.toString()),Bt.resolve()}markPotentiallyOrphaned(e,n){return this.ii.add(n.toString()),Bt.resolve()}removeTarget(e,n){this.ti.Sr(n.targetId).forEach(d=>this.ii.add(d.toString()));const l=this.persistence.getTargetCache();return l.getMatchingKeysForTargetId(e,n.targetId).next(d=>{d.forEach(y=>this.ii.add(y.toString()))}).next(()=>l.removeTargetData(e,n))}Zr(){this.ni=new Set}Xr(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Bt.forEach(this.ii,l=>{const d=Pi.fromPath(l);return this.si(e,d).next(y=>{y||n.removeEntry(d,Ki.min())})}).next(()=>(this.ni=null,n.apply(e)))}updateLimboDocument(e,n){return this.si(e,n).next(l=>{l?this.ii.delete(n.toString()):this.ii.add(n.toString())})}Jr(e){return 0}si(e,n){return Bt.or([()=>Bt.resolve(this.ti.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.ei(e,n)])}}class V1{constructor(e,n){this.persistence=e,this.oi=new kf(l=>d$(l.path),(l,d)=>l.isEqual(d)),this.garbageCollector=TZ(this,n)}static ri(e,n){return new V1(e,n)}Zr(){}Xr(e){return Bt.resolve()}forEachTarget(e,n){return this.persistence.getTargetCache().forEachTarget(e,n)}nr(e){const n=this.sr(e);return this.persistence.getTargetCache().getTargetCount(e).next(l=>n.next(d=>l+d))}sr(e){let n=0;return this.rr(e,l=>{n++}).next(()=>n)}rr(e,n){return Bt.forEach(this.oi,(l,d)=>this.ar(e,l,d).next(y=>y?Bt.resolve():n(d)))}removeTargets(e,n,l){return this.persistence.getTargetCache().removeTargets(e,n,l)}removeOrphanedDocuments(e,n){let l=0;const d=this.persistence.getRemoteDocumentCache(),y=d.newChangeBuffer();return d.qr(e,A=>this.ar(e,A,n).next(s=>{s||(l++,y.removeEntry(A,Ki.min()))})).next(()=>y.apply(e)).next(()=>l)}markPotentiallyOrphaned(e,n){return this.oi.set(n,e.currentSequenceNumber),Bt.resolve()}removeTarget(e,n){const l=n.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,l)}addReference(e,n,l){return this.oi.set(l,e.currentSequenceNumber),Bt.resolve()}removeReference(e,n,l){return this.oi.set(l,e.currentSequenceNumber),Bt.resolve()}updateLimboDocument(e,n){return this.oi.set(n,e.currentSequenceNumber),Bt.resolve()}Jr(e){let n=e.key.toString().length;return e.isFoundDocument()&&(n+=Hx(e.data.value)),n}ar(e,n,l){return Bt.or([()=>this.persistence.ei(e,n),()=>this.persistence.getTargetCache().containsKey(e,n),()=>{const d=this.oi.get(n);return Bt.resolve(d!==void 0&&d>l)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zA{constructor(e,n,l,d){this.targetId=e,this.fromCache=n,this.Hi=l,this.Ji=d}static Yi(e,n){let l=gn(),d=gn();for(const y of n.docChanges)switch(y.type){case 0:l=l.add(y.doc.key);break;case 1:d=d.add(y.doc.key)}return new zA(e,n.fromCache,l,d)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OZ{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kZ{constructor(){this.Zi=!1,this.Xi=!1,this.es=100,this.ts=function(){return Q8()?8:u$(fa())>0?6:4}()}initialize(e,n){this.ns=e,this.indexManager=n,this.Zi=!0}getDocumentsMatchingQuery(e,n,l,d){const y={result:null};return this.rs(e,n).next(A=>{y.result=A}).next(()=>{if(!y.result)return this.ss(e,n,d,l).next(A=>{y.result=A})}).next(()=>{if(y.result)return;const A=new OZ;return this._s(e,n,A).next(s=>{if(y.result=s,this.Xi)return this.us(e,n,A,s.size)})}).next(()=>y.result)}us(e,n,l,d){return l.documentReadCount<this.es?(Hp()<=mn.DEBUG&&mi("QueryEngine","SDK will not create cache indexes for query:",$p(n),"since it only creates cache indexes for collection contains","more than or equal to",this.es,"documents"),Bt.resolve()):(Hp()<=mn.DEBUG&&mi("QueryEngine","Query:",$p(n),"scans",l.documentReadCount,"local documents and returns",d,"documents as results."),l.documentReadCount>this.ts*d?(Hp()<=mn.DEBUG&&mi("QueryEngine","The SDK decides to create cache indexes for query:",$p(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,lc(n))):Bt.resolve())}rs(e,n){if(c3(n))return Bt.resolve(null);let l=lc(n);return this.indexManager.getIndexType(e,l).next(d=>d===0?null:(n.limit!==null&&d===1&&(n=qE(n,null,"F"),l=lc(n)),this.indexManager.getDocumentsMatchingTarget(e,l).next(y=>{const A=gn(...y);return this.ns.getDocuments(e,A).next(s=>this.indexManager.getMinOffset(e,l).next(N=>{const j=this.cs(n,s);return this.ls(n,j,A,N.readTime)?this.rs(e,qE(n,null,"F")):this.hs(e,j,n,N)}))})))}ss(e,n,l,d){return c3(n)||d.isEqual(Ki.min())?Bt.resolve(null):this.ns.getDocuments(e,l).next(y=>{const A=this.cs(n,y);return this.ls(n,A,l,d)?Bt.resolve(null):(Hp()<=mn.DEBUG&&mi("QueryEngine","Re-using previous result from %s to execute query: %s",d.toString(),$p(n)),this.hs(e,A,n,s$(d,Wy)).next(s=>s))})}cs(e,n){let l=new _s(q4(e));return n.forEach((d,y)=>{Ab(e,y)&&(l=l.add(y))}),l}ls(e,n,l,d){if(e.limit===null)return!1;if(l.size!==n.size)return!0;const y=e.limitType==="F"?n.last():n.first();return!!y&&(y.hasPendingWrites||y.version.compareTo(d)>0)}_s(e,n,l){return Hp()<=mn.DEBUG&&mi("QueryEngine","Using full collection scan to execute query:",$p(n)),this.ns.getDocumentsMatchingQuery(e,n,Hh.min(),l)}hs(e,n,l,d){return this.ns.getDocumentsMatchingQuery(e,l,d).next(y=>(n.forEach(A=>{y=y.insert(A.key,A)}),y))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OA="LocalStore",NZ=3e8;class FZ{constructor(e,n,l,d){this.persistence=e,this.Ps=n,this.serializer=d,this.Ts=new zr(En),this.Is=new kf(y=>AA(y),IA),this.Es=new Map,this.ds=e.getRemoteDocumentCache(),this.Hr=e.getTargetCache(),this.Yr=e.getBundleCache(),this.As(l)}As(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new AZ(this.ds,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ds.setIndexManager(this.indexManager),this.Ps.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",n=>e.collect(n,this.Ts))}}function BZ(t,e,n,l){return new FZ(t,e,n,l)}async function pN(t,e){const n=Qi(t);return await n.persistence.runTransaction("Handle user change","readonly",l=>{let d;return n.mutationQueue.getAllMutationBatches(l).next(y=>(d=y,n.As(e),n.mutationQueue.getAllMutationBatches(l))).next(y=>{const A=[],s=[];let N=gn();for(const j of d){A.push(j.batchId);for(const K of j.mutations)N=N.add(K.key)}for(const j of y){s.push(j.batchId);for(const K of j.mutations)N=N.add(K.key)}return n.localDocuments.getDocuments(l,N).next(j=>({Rs:j,removedBatchIds:A,addedBatchIds:s}))})})}function VZ(t,e){const n=Qi(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",l=>{const d=e.batch.keys(),y=n.ds.newChangeBuffer({trackRemovals:!0});return function(s,N,j,K){const se=j.batch,ae=se.keys();let me=Bt.resolve();return ae.forEach(Ue=>{me=me.next(()=>K.getEntry(N,Ue)).next(Xe=>{const it=j.docVersions.get(Ue);Vn(it!==null),Xe.version.compareTo(it)<0&&(se.applyToRemoteDocument(Xe,j),Xe.isValidDocument()&&(Xe.setReadTime(j.commitVersion),K.addEntry(Xe)))})}),me.next(()=>s.mutationQueue.removeMutationBatch(N,se))}(n,l,e,y).next(()=>y.apply(l)).next(()=>n.mutationQueue.performConsistencyCheck(l)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(l,d,e.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(l,function(s){let N=gn();for(let j=0;j<s.mutationResults.length;++j)s.mutationResults[j].transformResults.length>0&&(N=N.add(s.batch.mutations[j].key));return N}(e))).next(()=>n.localDocuments.getDocuments(l,d))})}function mN(t){const e=Qi(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",n=>e.Hr.getLastRemoteSnapshotVersion(n))}function UZ(t,e){const n=Qi(t),l=e.snapshotVersion;let d=n.Ts;return n.persistence.runTransaction("Apply remote event","readwrite-primary",y=>{const A=n.ds.newChangeBuffer({trackRemovals:!0});d=n.Ts;const s=[];e.targetChanges.forEach((K,se)=>{const ae=d.get(se);if(!ae)return;s.push(n.Hr.removeMatchingKeys(y,K.removedDocuments,se).next(()=>n.Hr.addMatchingKeys(y,K.addedDocuments,se)));let me=ae.withSequenceNumber(y.currentSequenceNumber);e.targetMismatches.get(se)!==null?me=me.withResumeToken($s.EMPTY_BYTE_STRING,Ki.min()).withLastLimboFreeSnapshotVersion(Ki.min()):K.resumeToken.approximateByteSize()>0&&(me=me.withResumeToken(K.resumeToken,l)),d=d.insert(se,me),function(Xe,it,be){return Xe.resumeToken.approximateByteSize()===0||it.snapshotVersion.toMicroseconds()-Xe.snapshotVersion.toMicroseconds()>=NZ?!0:be.addedDocuments.size+be.modifiedDocuments.size+be.removedDocuments.size>0}(ae,me,K)&&s.push(n.Hr.updateTargetData(y,me))});let N=bu(),j=gn();if(e.documentUpdates.forEach(K=>{e.resolvedLimboDocuments.has(K)&&s.push(n.persistence.referenceDelegate.updateLimboDocument(y,K))}),s.push(jZ(y,A,e.documentUpdates).next(K=>{N=K.Vs,j=K.fs})),!l.isEqual(Ki.min())){const K=n.Hr.getLastRemoteSnapshotVersion(y).next(se=>n.Hr.setTargetsMetadata(y,y.currentSequenceNumber,l));s.push(K)}return Bt.waitFor(s).next(()=>A.apply(y)).next(()=>n.localDocuments.getLocalViewOfDocuments(y,N,j)).next(()=>N)}).then(y=>(n.Ts=d,y))}function jZ(t,e,n){let l=gn(),d=gn();return n.forEach(y=>l=l.add(y)),e.getEntries(t,l).next(y=>{let A=bu();return n.forEach((s,N)=>{const j=y.get(s);N.isFoundDocument()!==j.isFoundDocument()&&(d=d.add(s)),N.isNoDocument()&&N.version.isEqual(Ki.min())?(e.removeEntry(s,N.readTime),A=A.insert(s,N)):!j.isValidDocument()||N.version.compareTo(j.version)>0||N.version.compareTo(j.version)===0&&j.hasPendingWrites?(e.addEntry(N),A=A.insert(s,N)):mi(OA,"Ignoring outdated watch update for ",s,". Current version:",j.version," Watch version:",N.version)}),{Vs:A,fs:d}})}function qZ(t,e){const n=Qi(t);return n.persistence.runTransaction("Get next mutation batch","readonly",l=>(e===void 0&&(e=TA),n.mutationQueue.getNextMutationBatchAfterBatchId(l,e)))}function GZ(t,e){const n=Qi(t);return n.persistence.runTransaction("Allocate target","readwrite",l=>{let d;return n.Hr.getTargetData(l,e).next(y=>y?(d=y,Bt.resolve(d)):n.Hr.allocateTargetId(l).next(A=>(d=new Eh(e,A,"TargetPurposeListen",l.currentSequenceNumber),n.Hr.addTargetData(l,d).next(()=>d))))}).then(l=>{const d=n.Ts.get(l.targetId);return(d===null||l.snapshotVersion.compareTo(d.snapshotVersion)>0)&&(n.Ts=n.Ts.insert(l.targetId,l),n.Is.set(e,l.targetId)),l})}async function WE(t,e,n){const l=Qi(t),d=l.Ts.get(e),y=n?"readwrite":"readwrite-primary";try{n||await l.persistence.runTransaction("Release target",y,A=>l.persistence.referenceDelegate.removeTarget(A,d))}catch(A){if(!Km(A))throw A;mi(OA,`Failed to update sequence numbers for target ${e}: ${A}`)}l.Ts=l.Ts.remove(e),l.Is.delete(d.target)}function w3(t,e,n){const l=Qi(t);let d=Ki.min(),y=gn();return l.persistence.runTransaction("Execute query","readwrite",A=>function(N,j,K){const se=Qi(N),ae=se.Is.get(K);return ae!==void 0?Bt.resolve(se.Ts.get(ae)):se.Hr.getTargetData(j,K)}(l,A,lc(e)).next(s=>{if(s)return d=s.lastLimboFreeSnapshotVersion,l.Hr.getMatchingKeysForTargetId(A,s.targetId).next(N=>{y=N})}).next(()=>l.Ps.getDocumentsMatchingQuery(A,e,n?d:Ki.min(),n?y:gn())).next(s=>(HZ(l,R$(e),s),{documents:s,gs:y})))}function HZ(t,e,n){let l=t.Es.get(e)||Ki.min();n.forEach((d,y)=>{y.readTime.compareTo(l)>0&&(l=y.readTime)}),t.Es.set(e,l)}class T3{constructor(){this.activeTargetIds=k$()}Ds(e){this.activeTargetIds=this.activeTargetIds.add(e)}vs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ss(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class $Z{constructor(){this.ho=new T3,this.Po={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,l){}addLocalQueryTarget(e,n=!0){return n&&this.ho.Ds(e),this.Po[e]||"not-current"}updateQueryState(e,n,l){this.Po[e]=n}removeLocalQueryTarget(e){this.ho.vs(e)}isLocalQueryTarget(e){return this.ho.activeTargetIds.has(e)}clearQueryState(e){delete this.Po[e]}getAllActiveQueryTargets(){return this.ho.activeTargetIds}isActiveQueryTarget(e){return this.ho.activeTargetIds.has(e)}start(){return this.ho=new T3,Promise.resolve()}handleUserChange(e,n,l){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZZ{To(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const E3="ConnectivityMonitor";class S3{constructor(){this.Io=()=>this.Eo(),this.Ao=()=>this.Ro(),this.Vo=[],this.mo()}To(e){this.Vo.push(e)}shutdown(){window.removeEventListener("online",this.Io),window.removeEventListener("offline",this.Ao)}mo(){window.addEventListener("online",this.Io),window.addEventListener("offline",this.Ao)}Eo(){mi(E3,"Network connectivity changed: AVAILABLE");for(const e of this.Vo)e(0)}Ro(){mi(E3,"Network connectivity changed: UNAVAILABLE");for(const e of this.Vo)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ex=null;function XE(){return Ex===null?Ex=function(){return 268435456+Math.round(2147483648*Math.random())}():Ex++,"0x"+Ex.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const C2="RestConnection",WZ={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class XZ{get fo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const n=e.ssl?"https":"http",l=encodeURIComponent(this.databaseId.projectId),d=encodeURIComponent(this.databaseId.database);this.po=n+"://"+e.host,this.yo=`projects/${l}/databases/${d}`,this.wo=this.databaseId.database===O1?`project_id=${l}`:`project_id=${l}&database_id=${d}`}bo(e,n,l,d,y){const A=XE(),s=this.So(e,n.toUriEncodedString());mi(C2,`Sending RPC '${e}' ${A}:`,s,l);const N={"google-cloud-resource-prefix":this.yo,"x-goog-request-params":this.wo};return this.Do(N,d,y),this.vo(e,s,N,l).then(j=>(mi(C2,`Received RPC '${e}' ${A}: `,j),j),j=>{throw Mm(C2,`RPC '${e}' ${A} failed with error: `,j,"url: ",s,"request:",l),j})}Co(e,n,l,d,y,A){return this.bo(e,n,l,d,y)}Do(e,n,l){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Xm}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((d,y)=>e[y]=d),l&&l.headers.forEach((d,y)=>e[y]=d)}So(e,n){const l=WZ[e];return`${this.po}/v1/${n}:${l}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YZ{constructor(e){this.Fo=e.Fo,this.Mo=e.Mo}xo(e){this.Oo=e}No(e){this.Bo=e}Lo(e){this.ko=e}onMessage(e){this.qo=e}close(){this.Mo()}send(e){this.Fo(e)}Qo(){this.Oo()}$o(){this.Bo()}Ko(e){this.ko(e)}Uo(e){this.qo(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aa="WebChannelConnection";class KZ extends XZ{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}vo(e,n,l,d){const y=XE();return new Promise((A,s)=>{const N=new _4;N.setWithCredentials(!0),N.listenOnce(y4.COMPLETE,()=>{try{switch(N.getLastErrorCode()){case Gx.NO_ERROR:const K=N.getResponseJson();mi(aa,`XHR for RPC '${e}' ${y} received:`,JSON.stringify(K)),A(K);break;case Gx.TIMEOUT:mi(aa,`RPC '${e}' ${y} timed out`),s(new gi(Nt.DEADLINE_EXCEEDED,"Request time out"));break;case Gx.HTTP_ERROR:const se=N.getStatus();if(mi(aa,`RPC '${e}' ${y} failed with status:`,se,"response text:",N.getResponseText()),se>0){let ae=N.getResponseJson();Array.isArray(ae)&&(ae=ae[0]);const me=ae==null?void 0:ae.error;if(me&&me.status&&me.message){const Ue=function(it){const be=it.toLowerCase().replace(/_/g,"-");return Object.values(Nt).indexOf(be)>=0?be:Nt.UNKNOWN}(me.status);s(new gi(Ue,me.message))}else s(new gi(Nt.UNKNOWN,"Server responded with status "+N.getStatus()))}else s(new gi(Nt.UNAVAILABLE,"Connection failed."));break;default:Hi()}}finally{mi(aa,`RPC '${e}' ${y} completed.`)}});const j=JSON.stringify(d);mi(aa,`RPC '${e}' ${y} sending request:`,d),N.send(n,"POST",j,l,15)})}Wo(e,n,l){const d=XE(),y=[this.po,"/","google.firestore.v1.Firestore","/",e,"/channel"],A=b4(),s=x4(),N={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},j=this.longPollingOptions.timeoutSeconds;j!==void 0&&(N.longPollingTimeout=Math.round(1e3*j)),this.useFetchStreams&&(N.useFetchStreams=!0),this.Do(N.initMessageHeaders,n,l),N.encodeInitMessageHeaders=!0;const K=y.join("");mi(aa,`Creating RPC '${e}' stream ${d}: ${K}`,N);const se=A.createWebChannel(K,N);let ae=!1,me=!1;const Ue=new YZ({Fo:it=>{me?mi(aa,`Not sending because RPC '${e}' stream ${d} is closed:`,it):(ae||(mi(aa,`Opening RPC '${e}' stream ${d} transport.`),se.open(),ae=!0),mi(aa,`RPC '${e}' stream ${d} sending:`,it),se.send(it))},Mo:()=>se.close()}),Xe=(it,be,Ee)=>{it.listen(be,Ce=>{try{Ee(Ce)}catch(We){setTimeout(()=>{throw We},0)}})};return Xe(se,ny.EventType.OPEN,()=>{me||(mi(aa,`RPC '${e}' stream ${d} transport opened.`),Ue.Qo())}),Xe(se,ny.EventType.CLOSE,()=>{me||(me=!0,mi(aa,`RPC '${e}' stream ${d} transport closed`),Ue.Ko())}),Xe(se,ny.EventType.ERROR,it=>{me||(me=!0,Mm(aa,`RPC '${e}' stream ${d} transport errored:`,it),Ue.Ko(new gi(Nt.UNAVAILABLE,"The operation could not be completed")))}),Xe(se,ny.EventType.MESSAGE,it=>{var be;if(!me){const Ee=it.data[0];Vn(!!Ee);const Ce=Ee,We=(Ce==null?void 0:Ce.error)||((be=Ce[0])===null||be===void 0?void 0:be.error);if(We){mi(aa,`RPC '${e}' stream ${d} received error:`,We);const Ct=We.status;let Ut=function(Ve){const De=Qr[Ve];if(De!==void 0)return iN(De)}(Ct),we=We.message;Ut===void 0&&(Ut=Nt.INTERNAL,we="Unknown error status: "+Ct+" with message "+We.message),me=!0,Ue.Ko(new gi(Ut,we)),se.close()}else mi(aa,`RPC '${e}' stream ${d} received:`,Ee),Ue.Uo(Ee)}}),Xe(s,v4.STAT_EVENT,it=>{it.stat===NE.PROXY?mi(aa,`RPC '${e}' stream ${d} detected buffering proxy`):it.stat===NE.NOPROXY&&mi(aa,`RPC '${e}' stream ${d} detected no buffering proxy`)}),setTimeout(()=>{Ue.$o()},0),Ue}}function R2(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rb(t){return new tZ(t,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gN{constructor(e,n,l=1e3,d=1.5,y=6e4){this.Ti=e,this.timerId=n,this.Go=l,this.zo=d,this.jo=y,this.Ho=0,this.Jo=null,this.Yo=Date.now(),this.reset()}reset(){this.Ho=0}Zo(){this.Ho=this.jo}Xo(e){this.cancel();const n=Math.floor(this.Ho+this.e_()),l=Math.max(0,Date.now()-this.Yo),d=Math.max(0,n-l);d>0&&mi("ExponentialBackoff",`Backing off for ${d} ms (base delay: ${this.Ho} ms, delay with jitter: ${n} ms, last attempt: ${l} ms ago)`),this.Jo=this.Ti.enqueueAfterDelay(this.timerId,d,()=>(this.Yo=Date.now(),e())),this.Ho*=this.zo,this.Ho<this.Go&&(this.Ho=this.Go),this.Ho>this.jo&&(this.Ho=this.jo)}t_(){this.Jo!==null&&(this.Jo.skipDelay(),this.Jo=null)}cancel(){this.Jo!==null&&(this.Jo.cancel(),this.Jo=null)}e_(){return(Math.random()-.5)*this.Ho}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const A3="PersistentStream";class _N{constructor(e,n,l,d,y,A,s,N){this.Ti=e,this.n_=l,this.r_=d,this.connection=y,this.authCredentialsProvider=A,this.appCheckCredentialsProvider=s,this.listener=N,this.state=0,this.i_=0,this.s_=null,this.o_=null,this.stream=null,this.__=0,this.a_=new gN(e,n)}u_(){return this.state===1||this.state===5||this.c_()}c_(){return this.state===2||this.state===3}start(){this.__=0,this.state!==4?this.auth():this.l_()}async stop(){this.u_()&&await this.close(0)}h_(){this.state=0,this.a_.reset()}P_(){this.c_()&&this.s_===null&&(this.s_=this.Ti.enqueueAfterDelay(this.n_,6e4,()=>this.T_()))}I_(e){this.E_(),this.stream.send(e)}async T_(){if(this.c_())return this.close(0)}E_(){this.s_&&(this.s_.cancel(),this.s_=null)}d_(){this.o_&&(this.o_.cancel(),this.o_=null)}async close(e,n){this.E_(),this.d_(),this.a_.cancel(),this.i_++,e!==4?this.a_.reset():n&&n.code===Nt.RESOURCE_EXHAUSTED?(xu(n.toString()),xu("Using maximum backoff delay to prevent overloading the backend."),this.a_.Zo()):n&&n.code===Nt.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.A_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Lo(n)}A_(){}auth(){this.state=1;const e=this.R_(this.i_),n=this.i_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([l,d])=>{this.i_===n&&this.V_(l,d)},l=>{e(()=>{const d=new gi(Nt.UNKNOWN,"Fetching auth token failed: "+l.message);return this.m_(d)})})}V_(e,n){const l=this.R_(this.i_);this.stream=this.f_(e,n),this.stream.xo(()=>{l(()=>this.listener.xo())}),this.stream.No(()=>{l(()=>(this.state=2,this.o_=this.Ti.enqueueAfterDelay(this.r_,1e4,()=>(this.c_()&&(this.state=3),Promise.resolve())),this.listener.No()))}),this.stream.Lo(d=>{l(()=>this.m_(d))}),this.stream.onMessage(d=>{l(()=>++this.__==1?this.g_(d):this.onNext(d))})}l_(){this.state=5,this.a_.Xo(async()=>{this.state=0,this.start()})}m_(e){return mi(A3,`close with error: ${e}`),this.stream=null,this.close(4,e)}R_(e){return n=>{this.Ti.enqueueAndForget(()=>this.i_===e?n():(mi(A3,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class QZ extends _N{constructor(e,n,l,d,y,A){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,l,d,A),this.serializer=y}f_(e,n){return this.connection.Wo("Listen",e,n)}g_(e){return this.onNext(e)}onNext(e){this.a_.reset();const n=rZ(this.serializer,e),l=function(y){if(!("targetChange"in y))return Ki.min();const A=y.targetChange;return A.targetIds&&A.targetIds.length?Ki.min():A.readTime?cc(A.readTime):Ki.min()}(e);return this.listener.p_(n,l)}y_(e){const n={};n.database=ZE(this.serializer),n.addTarget=function(y,A){let s;const N=A.target;if(s=UE(N)?{documents:oZ(y,N)}:{query:lZ(y,N).ht},s.targetId=A.targetId,A.resumeToken.approximateByteSize()>0){s.resumeToken=sN(y,A.resumeToken);const j=GE(y,A.expectedCount);j!==null&&(s.expectedCount=j)}else if(A.snapshotVersion.compareTo(Ki.min())>0){s.readTime=B1(y,A.snapshotVersion.toTimestamp());const j=GE(y,A.expectedCount);j!==null&&(s.expectedCount=j)}return s}(this.serializer,e);const l=uZ(this.serializer,e);l&&(n.labels=l),this.I_(n)}w_(e){const n={};n.database=ZE(this.serializer),n.removeTarget=e,this.I_(n)}}class JZ extends _N{constructor(e,n,l,d,y,A){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,l,d,A),this.serializer=y}get b_(){return this.__>0}start(){this.lastStreamToken=void 0,super.start()}A_(){this.b_&&this.S_([])}f_(e,n){return this.connection.Wo("Write",e,n)}g_(e){return Vn(!!e.streamToken),this.lastStreamToken=e.streamToken,Vn(!e.writeResults||e.writeResults.length===0),this.listener.D_()}onNext(e){Vn(!!e.streamToken),this.lastStreamToken=e.streamToken,this.a_.reset();const n=aZ(e.writeResults,e.commitTime),l=cc(e.commitTime);return this.listener.v_(l,n)}C_(){const e={};e.database=ZE(this.serializer),this.I_(e)}S_(e){const n={streamToken:this.lastStreamToken,writes:e.map(l=>sZ(this.serializer,l))};this.I_(n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eW{}class tW extends eW{constructor(e,n,l,d){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=l,this.serializer=d,this.F_=!1}M_(){if(this.F_)throw new gi(Nt.FAILED_PRECONDITION,"The client has already been terminated.")}bo(e,n,l,d){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([y,A])=>this.connection.bo(e,HE(n,l),d,y,A)).catch(y=>{throw y.name==="FirebaseError"?(y.code===Nt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),y):new gi(Nt.UNKNOWN,y.toString())})}Co(e,n,l,d,y){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([A,s])=>this.connection.Co(e,HE(n,l),d,A,s,y)).catch(A=>{throw A.name==="FirebaseError"?(A.code===Nt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),A):new gi(Nt.UNKNOWN,A.toString())})}terminate(){this.F_=!0,this.connection.terminate()}}class iW{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.x_=0,this.O_=null,this.N_=!0}B_(){this.x_===0&&(this.L_("Unknown"),this.O_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.O_=null,this.k_("Backend didn't respond within 10 seconds."),this.L_("Offline"),Promise.resolve())))}q_(e){this.state==="Online"?this.L_("Unknown"):(this.x_++,this.x_>=1&&(this.Q_(),this.k_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.L_("Offline")))}set(e){this.Q_(),this.x_=0,e==="Online"&&(this.N_=!1),this.L_(e)}L_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}k_(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.N_?(xu(n),this.N_=!1):mi("OnlineStateTracker",n)}Q_(){this.O_!==null&&(this.O_.cancel(),this.O_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const If="RemoteStore";class nW{constructor(e,n,l,d,y){this.localStore=e,this.datastore=n,this.asyncQueue=l,this.remoteSyncer={},this.K_=[],this.U_=new Map,this.W_=new Set,this.G_=[],this.z_=y,this.z_.To(A=>{l.enqueueAndForget(async()=>{Nf(this)&&(mi(If,"Restarting streams for network reachability change."),await async function(N){const j=Qi(N);j.W_.add(4),await T0(j),j.j_.set("Unknown"),j.W_.delete(4),await Db(j)}(this))})}),this.j_=new iW(l,d)}}async function Db(t){if(Nf(t))for(const e of t.G_)await e(!0)}async function T0(t){for(const e of t.G_)await e(!1)}function yN(t,e){const n=Qi(t);n.U_.has(e.targetId)||(n.U_.set(e.targetId,e),BA(n)?FA(n):Jm(n).c_()&&NA(n,e))}function kA(t,e){const n=Qi(t),l=Jm(n);n.U_.delete(e),l.c_()&&vN(n,e),n.U_.size===0&&(l.c_()?l.P_():Nf(n)&&n.j_.set("Unknown"))}function NA(t,e){if(t.H_.Ne(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Ki.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}Jm(t).y_(e)}function vN(t,e){t.H_.Ne(e),Jm(t).w_(e)}function FA(t){t.H_=new K$({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),lt:e=>t.U_.get(e)||null,it:()=>t.datastore.serializer.databaseId}),Jm(t).start(),t.j_.B_()}function BA(t){return Nf(t)&&!Jm(t).u_()&&t.U_.size>0}function Nf(t){return Qi(t).W_.size===0}function xN(t){t.H_=void 0}async function rW(t){t.j_.set("Online")}async function sW(t){t.U_.forEach((e,n)=>{NA(t,e)})}async function aW(t,e){xN(t),BA(t)?(t.j_.q_(e),FA(t)):t.j_.set("Unknown")}async function oW(t,e,n){if(t.j_.set("Online"),e instanceof rN&&e.state===2&&e.cause)try{await async function(d,y){const A=y.cause;for(const s of y.targetIds)d.U_.has(s)&&(await d.remoteSyncer.rejectListen(s,A),d.U_.delete(s),d.H_.removeTarget(s))}(t,e)}catch(l){mi(If,"Failed to remove targets %s: %s ",e.targetIds.join(","),l),await U1(t,l)}else if(e instanceof Wx?t.H_.We(e):e instanceof nN?t.H_.Ze(e):t.H_.je(e),!n.isEqual(Ki.min()))try{const l=await mN(t.localStore);n.compareTo(l)>=0&&await function(y,A){const s=y.H_.ot(A);return s.targetChanges.forEach((N,j)=>{if(N.resumeToken.approximateByteSize()>0){const K=y.U_.get(j);K&&y.U_.set(j,K.withResumeToken(N.resumeToken,A))}}),s.targetMismatches.forEach((N,j)=>{const K=y.U_.get(N);if(!K)return;y.U_.set(N,K.withResumeToken($s.EMPTY_BYTE_STRING,K.snapshotVersion)),vN(y,N);const se=new Eh(K.target,N,j,K.sequenceNumber);NA(y,se)}),y.remoteSyncer.applyRemoteEvent(s)}(t,n)}catch(l){mi(If,"Failed to raise snapshot:",l),await U1(t,l)}}async function U1(t,e,n){if(!Km(e))throw e;t.W_.add(1),await T0(t),t.j_.set("Offline"),n||(n=()=>mN(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{mi(If,"Retrying IndexedDB access"),await n(),t.W_.delete(1),await Db(t)})}function bN(t,e){return e().catch(n=>U1(t,n,e))}async function Pb(t){const e=Qi(t),n=Xh(e);let l=e.K_.length>0?e.K_[e.K_.length-1].batchId:TA;for(;lW(e);)try{const d=await qZ(e.localStore,l);if(d===null){e.K_.length===0&&n.P_();break}l=d.batchId,cW(e,d)}catch(d){await U1(e,d)}wN(e)&&TN(e)}function lW(t){return Nf(t)&&t.K_.length<10}function cW(t,e){t.K_.push(e);const n=Xh(t);n.c_()&&n.b_&&n.S_(e.mutations)}function wN(t){return Nf(t)&&!Xh(t).u_()&&t.K_.length>0}function TN(t){Xh(t).start()}async function uW(t){Xh(t).C_()}async function hW(t){const e=Xh(t);for(const n of t.K_)e.S_(n.mutations)}async function dW(t,e,n){const l=t.K_.shift(),d=CA.from(l,e,n);await bN(t,()=>t.remoteSyncer.applySuccessfulWrite(d)),await Pb(t)}async function fW(t,e){e&&Xh(t).b_&&await async function(l,d){if(function(A){return W$(A)&&A!==Nt.ABORTED}(d.code)){const y=l.K_.shift();Xh(l).h_(),await bN(l,()=>l.remoteSyncer.rejectFailedWrite(y.batchId,d)),await Pb(l)}}(t,e),wN(t)&&TN(t)}async function I3(t,e){const n=Qi(t);n.asyncQueue.verifyOperationInProgress(),mi(If,"RemoteStore received new credentials");const l=Nf(n);n.W_.add(3),await T0(n),l&&n.j_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.W_.delete(3),await Db(n)}async function pW(t,e){const n=Qi(t);e?(n.W_.delete(2),await Db(n)):e||(n.W_.add(2),await T0(n),n.j_.set("Unknown"))}function Jm(t){return t.J_||(t.J_=function(n,l,d){const y=Qi(n);return y.M_(),new QZ(l,y.connection,y.authCredentials,y.appCheckCredentials,y.serializer,d)}(t.datastore,t.asyncQueue,{xo:rW.bind(null,t),No:sW.bind(null,t),Lo:aW.bind(null,t),p_:oW.bind(null,t)}),t.G_.push(async e=>{e?(t.J_.h_(),BA(t)?FA(t):t.j_.set("Unknown")):(await t.J_.stop(),xN(t))})),t.J_}function Xh(t){return t.Y_||(t.Y_=function(n,l,d){const y=Qi(n);return y.M_(),new JZ(l,y.connection,y.authCredentials,y.appCheckCredentials,y.serializer,d)}(t.datastore,t.asyncQueue,{xo:()=>Promise.resolve(),No:uW.bind(null,t),Lo:fW.bind(null,t),D_:hW.bind(null,t),v_:dW.bind(null,t)}),t.G_.push(async e=>{e?(t.Y_.h_(),await Pb(t)):(await t.Y_.stop(),t.K_.length>0&&(mi(If,`Stopping write stream with ${t.K_.length} pending writes`),t.K_=[]))})),t.Y_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VA{constructor(e,n,l,d,y){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=l,this.op=d,this.removalCallback=y,this.deferred=new du,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(A=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,n,l,d,y){const A=Date.now()+l,s=new VA(e,n,A,d,y);return s.start(l),s}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new gi(Nt.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function UA(t,e){if(xu("AsyncQueue",`${e}: ${t}`),Km(t))return new gi(Nt.UNAVAILABLE,`${e}: ${t}`);throw t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ym{static emptySet(e){return new ym(e.comparator)}constructor(e){this.comparator=e?(n,l)=>e(n,l)||Pi.comparator(n.key,l.key):(n,l)=>Pi.comparator(n.key,l.key),this.keyedMap=ry(),this.sortedSet=new zr(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((n,l)=>(e(n),!1))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof ym)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),l=e.sortedSet.getIterator();for(;n.hasNext();){const d=n.getNext().key,y=l.getNext().key;if(!d.isEqual(y))return!1}return!0}toString(){const e=[];return this.forEach(n=>{e.push(n.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const l=new ym;return l.comparator=this.comparator,l.keyedMap=e,l.sortedSet=n,l}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M3{constructor(){this.Z_=new zr(Pi.comparator)}track(e){const n=e.doc.key,l=this.Z_.get(n);l?e.type!==0&&l.type===3?this.Z_=this.Z_.insert(n,e):e.type===3&&l.type!==1?this.Z_=this.Z_.insert(n,{type:l.type,doc:e.doc}):e.type===2&&l.type===2?this.Z_=this.Z_.insert(n,{type:2,doc:e.doc}):e.type===2&&l.type===0?this.Z_=this.Z_.insert(n,{type:0,doc:e.doc}):e.type===1&&l.type===0?this.Z_=this.Z_.remove(n):e.type===1&&l.type===2?this.Z_=this.Z_.insert(n,{type:1,doc:l.doc}):e.type===0&&l.type===1?this.Z_=this.Z_.insert(n,{type:2,doc:e.doc}):Hi():this.Z_=this.Z_.insert(n,e)}X_(){const e=[];return this.Z_.inorderTraversal((n,l)=>{e.push(l)}),e}}class zm{constructor(e,n,l,d,y,A,s,N,j){this.query=e,this.docs=n,this.oldDocs=l,this.docChanges=d,this.mutatedKeys=y,this.fromCache=A,this.syncStateChanged=s,this.excludesMetadataChanges=N,this.hasCachedResults=j}static fromInitialDocuments(e,n,l,d,y){const A=[];return n.forEach(s=>{A.push({type:0,doc:s})}),new zm(e,n,ym.emptySet(n),A,l,d,!0,!1,y)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Sb(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,l=e.docChanges;if(n.length!==l.length)return!1;for(let d=0;d<n.length;d++)if(n[d].type!==l[d].type||!n[d].doc.isEqual(l[d].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mW{constructor(){this.ea=void 0,this.ta=[]}na(){return this.ta.some(e=>e.ra())}}class gW{constructor(){this.queries=C3(),this.onlineState="Unknown",this.ia=new Set}terminate(){(function(n,l){const d=Qi(n),y=d.queries;d.queries=C3(),y.forEach((A,s)=>{for(const N of s.ta)N.onError(l)})})(this,new gi(Nt.ABORTED,"Firestore shutting down"))}}function C3(){return new kf(t=>j4(t),Sb)}async function jA(t,e){const n=Qi(t);let l=3;const d=e.query;let y=n.queries.get(d);y?!y.na()&&e.ra()&&(l=2):(y=new mW,l=e.ra()?0:1);try{switch(l){case 0:y.ea=await n.onListen(d,!0);break;case 1:y.ea=await n.onListen(d,!1);break;case 2:await n.onFirstRemoteStoreListen(d)}}catch(A){const s=UA(A,`Initialization of query '${$p(e.query)}' failed`);return void e.onError(s)}n.queries.set(d,y),y.ta.push(e),e.sa(n.onlineState),y.ea&&e.oa(y.ea)&&GA(n)}async function qA(t,e){const n=Qi(t),l=e.query;let d=3;const y=n.queries.get(l);if(y){const A=y.ta.indexOf(e);A>=0&&(y.ta.splice(A,1),y.ta.length===0?d=e.ra()?0:1:!y.na()&&e.ra()&&(d=2))}switch(d){case 0:return n.queries.delete(l),n.onUnlisten(l,!0);case 1:return n.queries.delete(l),n.onUnlisten(l,!1);case 2:return n.onLastRemoteStoreUnlisten(l);default:return}}function _W(t,e){const n=Qi(t);let l=!1;for(const d of e){const y=d.query,A=n.queries.get(y);if(A){for(const s of A.ta)s.oa(d)&&(l=!0);A.ea=d}}l&&GA(n)}function yW(t,e,n){const l=Qi(t),d=l.queries.get(e);if(d)for(const y of d.ta)y.onError(n);l.queries.delete(e)}function GA(t){t.ia.forEach(e=>{e.next()})}var YE,R3;(R3=YE||(YE={}))._a="default",R3.Cache="cache";class HA{constructor(e,n,l){this.query=e,this.aa=n,this.ua=!1,this.ca=null,this.onlineState="Unknown",this.options=l||{}}oa(e){if(!this.options.includeMetadataChanges){const l=[];for(const d of e.docChanges)d.type!==3&&l.push(d);e=new zm(e.query,e.docs,e.oldDocs,l,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.ua?this.la(e)&&(this.aa.next(e),n=!0):this.ha(e,this.onlineState)&&(this.Pa(e),n=!0),this.ca=e,n}onError(e){this.aa.error(e)}sa(e){this.onlineState=e;let n=!1;return this.ca&&!this.ua&&this.ha(this.ca,e)&&(this.Pa(this.ca),n=!0),n}ha(e,n){if(!e.fromCache||!this.ra())return!0;const l=n!=="Offline";return(!this.options.Ta||!l)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}la(e){if(e.docChanges.length>0)return!0;const n=this.ca&&this.ca.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}Pa(e){e=zm.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.ua=!0,this.aa.next(e)}ra(){return this.options.source!==YE.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EN{constructor(e){this.key=e}}class SN{constructor(e){this.key=e}}class vW{constructor(e,n){this.query=e,this.fa=n,this.ga=null,this.hasCachedResults=!1,this.current=!1,this.pa=gn(),this.mutatedKeys=gn(),this.ya=q4(e),this.wa=new ym(this.ya)}get ba(){return this.fa}Sa(e,n){const l=n?n.Da:new M3,d=n?n.wa:this.wa;let y=n?n.mutatedKeys:this.mutatedKeys,A=d,s=!1;const N=this.query.limitType==="F"&&d.size===this.query.limit?d.last():null,j=this.query.limitType==="L"&&d.size===this.query.limit?d.first():null;if(e.inorderTraversal((K,se)=>{const ae=d.get(K),me=Ab(this.query,se)?se:null,Ue=!!ae&&this.mutatedKeys.has(ae.key),Xe=!!me&&(me.hasLocalMutations||this.mutatedKeys.has(me.key)&&me.hasCommittedMutations);let it=!1;ae&&me?ae.data.isEqual(me.data)?Ue!==Xe&&(l.track({type:3,doc:me}),it=!0):this.va(ae,me)||(l.track({type:2,doc:me}),it=!0,(N&&this.ya(me,N)>0||j&&this.ya(me,j)<0)&&(s=!0)):!ae&&me?(l.track({type:0,doc:me}),it=!0):ae&&!me&&(l.track({type:1,doc:ae}),it=!0,(N||j)&&(s=!0)),it&&(me?(A=A.add(me),y=Xe?y.add(K):y.delete(K)):(A=A.delete(K),y=y.delete(K)))}),this.query.limit!==null)for(;A.size>this.query.limit;){const K=this.query.limitType==="F"?A.last():A.first();A=A.delete(K.key),y=y.delete(K.key),l.track({type:1,doc:K})}return{wa:A,Da:l,ls:s,mutatedKeys:y}}va(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,l,d){const y=this.wa;this.wa=e.wa,this.mutatedKeys=e.mutatedKeys;const A=e.Da.X_();A.sort((K,se)=>function(me,Ue){const Xe=it=>{switch(it){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Hi()}};return Xe(me)-Xe(Ue)}(K.type,se.type)||this.ya(K.doc,se.doc)),this.Ca(l),d=d!=null&&d;const s=n&&!d?this.Fa():[],N=this.pa.size===0&&this.current&&!d?1:0,j=N!==this.ga;return this.ga=N,A.length!==0||j?{snapshot:new zm(this.query,e.wa,y,A,e.mutatedKeys,N===0,j,!1,!!l&&l.resumeToken.approximateByteSize()>0),Ma:s}:{Ma:s}}sa(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({wa:this.wa,Da:new M3,mutatedKeys:this.mutatedKeys,ls:!1},!1)):{Ma:[]}}xa(e){return!this.fa.has(e)&&!!this.wa.has(e)&&!this.wa.get(e).hasLocalMutations}Ca(e){e&&(e.addedDocuments.forEach(n=>this.fa=this.fa.add(n)),e.modifiedDocuments.forEach(n=>{}),e.removedDocuments.forEach(n=>this.fa=this.fa.delete(n)),this.current=e.current)}Fa(){if(!this.current)return[];const e=this.pa;this.pa=gn(),this.wa.forEach(l=>{this.xa(l.key)&&(this.pa=this.pa.add(l.key))});const n=[];return e.forEach(l=>{this.pa.has(l)||n.push(new SN(l))}),this.pa.forEach(l=>{e.has(l)||n.push(new EN(l))}),n}Oa(e){this.fa=e.gs,this.pa=gn();const n=this.Sa(e.documents);return this.applyChanges(n,!0)}Na(){return zm.fromInitialDocuments(this.query,this.wa,this.mutatedKeys,this.ga===0,this.hasCachedResults)}}const $A="SyncEngine";class xW{constructor(e,n,l){this.query=e,this.targetId=n,this.view=l}}class bW{constructor(e){this.key=e,this.Ba=!1}}class wW{constructor(e,n,l,d,y,A){this.localStore=e,this.remoteStore=n,this.eventManager=l,this.sharedClientState=d,this.currentUser=y,this.maxConcurrentLimboResolutions=A,this.La={},this.ka=new kf(s=>j4(s),Sb),this.qa=new Map,this.Qa=new Set,this.$a=new zr(Pi.comparator),this.Ka=new Map,this.Ua=new PA,this.Wa={},this.Ga=new Map,this.za=Lm.Un(),this.onlineState="Unknown",this.ja=void 0}get isPrimaryClient(){return this.ja===!0}}async function TW(t,e,n=!0){const l=DN(t);let d;const y=l.ka.get(e);return y?(l.sharedClientState.addLocalQueryTarget(y.targetId),d=y.view.Na()):d=await AN(l,e,n,!0),d}async function EW(t,e){const n=DN(t);await AN(n,e,!0,!1)}async function AN(t,e,n,l){const d=await GZ(t.localStore,lc(e)),y=d.targetId,A=t.sharedClientState.addLocalQueryTarget(y,n);let s;return l&&(s=await SW(t,e,y,A==="current",d.resumeToken)),t.isPrimaryClient&&n&&yN(t.remoteStore,d),s}async function SW(t,e,n,l,d){t.Ha=(se,ae,me)=>async function(Xe,it,be,Ee){let Ce=it.view.Sa(be);Ce.ls&&(Ce=await w3(Xe.localStore,it.query,!1).then(({documents:we})=>it.view.Sa(we,Ce)));const We=Ee&&Ee.targetChanges.get(it.targetId),Ct=Ee&&Ee.targetMismatches.get(it.targetId)!=null,Ut=it.view.applyChanges(Ce,Xe.isPrimaryClient,We,Ct);return P3(Xe,it.targetId,Ut.Ma),Ut.snapshot}(t,se,ae,me);const y=await w3(t.localStore,e,!0),A=new vW(e,y.gs),s=A.Sa(y.documents),N=w0.createSynthesizedTargetChangeForCurrentChange(n,l&&t.onlineState!=="Offline",d),j=A.applyChanges(s,t.isPrimaryClient,N);P3(t,n,j.Ma);const K=new xW(e,n,A);return t.ka.set(e,K),t.qa.has(n)?t.qa.get(n).push(e):t.qa.set(n,[e]),j.snapshot}async function AW(t,e,n){const l=Qi(t),d=l.ka.get(e),y=l.qa.get(d.targetId);if(y.length>1)return l.qa.set(d.targetId,y.filter(A=>!Sb(A,e))),void l.ka.delete(e);l.isPrimaryClient?(l.sharedClientState.removeLocalQueryTarget(d.targetId),l.sharedClientState.isActiveQueryTarget(d.targetId)||await WE(l.localStore,d.targetId,!1).then(()=>{l.sharedClientState.clearQueryState(d.targetId),n&&kA(l.remoteStore,d.targetId),KE(l,d.targetId)}).catch(Ym)):(KE(l,d.targetId),await WE(l.localStore,d.targetId,!0))}async function IW(t,e){const n=Qi(t),l=n.ka.get(e),d=n.qa.get(l.targetId);n.isPrimaryClient&&d.length===1&&(n.sharedClientState.removeLocalQueryTarget(l.targetId),kA(n.remoteStore,l.targetId))}async function MW(t,e,n){const l=OW(t);try{const d=await function(A,s){const N=Qi(A),j=Vr.now(),K=s.reduce((me,Ue)=>me.add(Ue.key),gn());let se,ae;return N.persistence.runTransaction("Locally write mutations","readwrite",me=>{let Ue=bu(),Xe=gn();return N.ds.getEntries(me,K).next(it=>{Ue=it,Ue.forEach((be,Ee)=>{Ee.isValidDocument()||(Xe=Xe.add(be))})}).next(()=>N.localDocuments.getOverlayedDocuments(me,Ue)).next(it=>{se=it;const be=[];for(const Ee of s){const Ce=q$(Ee,se.get(Ee.key).overlayedDocument);Ce!=null&&be.push(new rd(Ee.key,Ce,z4(Ce.value.mapValue),bl.exists(!0)))}return N.mutationQueue.addMutationBatch(me,j,be,s)}).next(it=>{ae=it;const be=it.applyToLocalDocumentSet(se,Xe);return N.documentOverlayCache.saveOverlays(me,it.batchId,be)})}).then(()=>({batchId:ae.batchId,changes:H4(se)}))}(l.localStore,e);l.sharedClientState.addPendingMutation(d.batchId),function(A,s,N){let j=A.Wa[A.currentUser.toKey()];j||(j=new zr(En)),j=j.insert(s,N),A.Wa[A.currentUser.toKey()]=j}(l,d.batchId,n),await E0(l,d.changes),await Pb(l.remoteStore)}catch(d){const y=UA(d,"Failed to persist write");n.reject(y)}}async function IN(t,e){const n=Qi(t);try{const l=await UZ(n.localStore,e);e.targetChanges.forEach((d,y)=>{const A=n.Ka.get(y);A&&(Vn(d.addedDocuments.size+d.modifiedDocuments.size+d.removedDocuments.size<=1),d.addedDocuments.size>0?A.Ba=!0:d.modifiedDocuments.size>0?Vn(A.Ba):d.removedDocuments.size>0&&(Vn(A.Ba),A.Ba=!1))}),await E0(n,l,e)}catch(l){await Ym(l)}}function D3(t,e,n){const l=Qi(t);if(l.isPrimaryClient&&n===0||!l.isPrimaryClient&&n===1){const d=[];l.ka.forEach((y,A)=>{const s=A.view.sa(e);s.snapshot&&d.push(s.snapshot)}),function(A,s){const N=Qi(A);N.onlineState=s;let j=!1;N.queries.forEach((K,se)=>{for(const ae of se.ta)ae.sa(s)&&(j=!0)}),j&&GA(N)}(l.eventManager,e),d.length&&l.La.p_(d),l.onlineState=e,l.isPrimaryClient&&l.sharedClientState.setOnlineState(e)}}async function CW(t,e,n){const l=Qi(t);l.sharedClientState.updateQueryState(e,"rejected",n);const d=l.Ka.get(e),y=d&&d.key;if(y){let A=new zr(Pi.comparator);A=A.insert(y,la.newNoDocument(y,Ki.min()));const s=gn().add(y),N=new Cb(Ki.min(),new Map,new zr(En),A,s);await IN(l,N),l.$a=l.$a.remove(y),l.Ka.delete(e),ZA(l)}else await WE(l.localStore,e,!1).then(()=>KE(l,e,n)).catch(Ym)}async function RW(t,e){const n=Qi(t),l=e.batch.batchId;try{const d=await VZ(n.localStore,e);CN(n,l,null),MN(n,l),n.sharedClientState.updateMutationState(l,"acknowledged"),await E0(n,d)}catch(d){await Ym(d)}}async function DW(t,e,n){const l=Qi(t);try{const d=await function(A,s){const N=Qi(A);return N.persistence.runTransaction("Reject batch","readwrite-primary",j=>{let K;return N.mutationQueue.lookupMutationBatch(j,s).next(se=>(Vn(se!==null),K=se.keys(),N.mutationQueue.removeMutationBatch(j,se))).next(()=>N.mutationQueue.performConsistencyCheck(j)).next(()=>N.documentOverlayCache.removeOverlaysForBatchId(j,K,s)).next(()=>N.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(j,K)).next(()=>N.localDocuments.getDocuments(j,K))})}(l.localStore,e);CN(l,e,n),MN(l,e),l.sharedClientState.updateMutationState(e,"rejected",n),await E0(l,d)}catch(d){await Ym(d)}}function MN(t,e){(t.Ga.get(e)||[]).forEach(n=>{n.resolve()}),t.Ga.delete(e)}function CN(t,e,n){const l=Qi(t);let d=l.Wa[l.currentUser.toKey()];if(d){const y=d.get(e);y&&(n?y.reject(n):y.resolve(),d=d.remove(e)),l.Wa[l.currentUser.toKey()]=d}}function KE(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const l of t.qa.get(e))t.ka.delete(l),n&&t.La.Ja(l,n);t.qa.delete(e),t.isPrimaryClient&&t.Ua.Sr(e).forEach(l=>{t.Ua.containsKey(l)||RN(t,l)})}function RN(t,e){t.Qa.delete(e.path.canonicalString());const n=t.$a.get(e);n!==null&&(kA(t.remoteStore,n),t.$a=t.$a.remove(e),t.Ka.delete(n),ZA(t))}function P3(t,e,n){for(const l of n)l instanceof EN?(t.Ua.addReference(l.key,e),PW(t,l)):l instanceof SN?(mi($A,"Document no longer in limbo: "+l.key),t.Ua.removeReference(l.key,e),t.Ua.containsKey(l.key)||RN(t,l.key)):Hi()}function PW(t,e){const n=e.key,l=n.path.canonicalString();t.$a.get(n)||t.Qa.has(l)||(mi($A,"New document in limbo: "+n),t.Qa.add(l),ZA(t))}function ZA(t){for(;t.Qa.size>0&&t.$a.size<t.maxConcurrentLimboResolutions;){const e=t.Qa.values().next().value;t.Qa.delete(e);const n=new Pi(gr.fromString(e)),l=t.za.next();t.Ka.set(l,new bW(n)),t.$a=t.$a.insert(n,l),yN(t.remoteStore,new Eh(lc(Eb(n.path)),l,"TargetPurposeLimboResolution",bb.ae))}}async function E0(t,e,n){const l=Qi(t),d=[],y=[],A=[];l.ka.isEmpty()||(l.ka.forEach((s,N)=>{A.push(l.Ha(N,e,n).then(j=>{var K;if((j||n)&&l.isPrimaryClient){const se=j?!j.fromCache:(K=n==null?void 0:n.targetChanges.get(N.targetId))===null||K===void 0?void 0:K.current;l.sharedClientState.updateQueryState(N.targetId,se?"current":"not-current")}if(j){d.push(j);const se=zA.Yi(N.targetId,j);y.push(se)}}))}),await Promise.all(A),l.La.p_(d),await async function(N,j){const K=Qi(N);try{await K.persistence.runTransaction("notifyLocalViewChanges","readwrite",se=>Bt.forEach(j,ae=>Bt.forEach(ae.Hi,me=>K.persistence.referenceDelegate.addReference(se,ae.targetId,me)).next(()=>Bt.forEach(ae.Ji,me=>K.persistence.referenceDelegate.removeReference(se,ae.targetId,me)))))}catch(se){if(!Km(se))throw se;mi(OA,"Failed to update sequence numbers: "+se)}for(const se of j){const ae=se.targetId;if(!se.fromCache){const me=K.Ts.get(ae),Ue=me.snapshotVersion,Xe=me.withLastLimboFreeSnapshotVersion(Ue);K.Ts=K.Ts.insert(ae,Xe)}}}(l.localStore,y))}async function LW(t,e){const n=Qi(t);if(!n.currentUser.isEqual(e)){mi($A,"User change. New user:",e.toKey());const l=await pN(n.localStore,e);n.currentUser=e,function(y,A){y.Ga.forEach(s=>{s.forEach(N=>{N.reject(new gi(Nt.CANCELLED,A))})}),y.Ga.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,l.removedBatchIds,l.addedBatchIds),await E0(n,l.Rs)}}function zW(t,e){const n=Qi(t),l=n.Ka.get(e);if(l&&l.Ba)return gn().add(l.key);{let d=gn();const y=n.qa.get(e);if(!y)return d;for(const A of y){const s=n.ka.get(A);d=d.unionWith(s.view.ba)}return d}}function DN(t){const e=Qi(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=IN.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=zW.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=CW.bind(null,e),e.La.p_=_W.bind(null,e.eventManager),e.La.Ja=yW.bind(null,e.eventManager),e}function OW(t){const e=Qi(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=RW.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=DW.bind(null,e),e}class j1{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Rb(e.databaseInfo.databaseId),this.sharedClientState=this.Za(e),this.persistence=this.Xa(e),await this.persistence.start(),this.localStore=this.eu(e),this.gcScheduler=this.tu(e,this.localStore),this.indexBackfillerScheduler=this.nu(e,this.localStore)}tu(e,n){return null}nu(e,n){return null}eu(e){return BZ(this.persistence,new kZ,e.initialUser,this.serializer)}Xa(e){return new fN(LA.ri,this.serializer)}Za(e){return new $Z}async terminate(){var e,n;(e=this.gcScheduler)===null||e===void 0||e.stop(),(n=this.indexBackfillerScheduler)===null||n===void 0||n.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}j1.provider={build:()=>new j1};class kW extends j1{constructor(e){super(),this.cacheSizeBytes=e}tu(e,n){Vn(this.persistence.referenceDelegate instanceof V1);const l=this.persistence.referenceDelegate.garbageCollector;return new bZ(l,e.asyncQueue,n)}Xa(e){const n=this.cacheSizeBytes!==void 0?Va.withCacheSize(this.cacheSizeBytes):Va.DEFAULT;return new fN(l=>V1.ri(l,n),this.serializer)}}class QE{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=l=>D3(this.syncEngine,l,1),this.remoteStore.remoteSyncer.handleCredentialChange=LW.bind(null,this.syncEngine),await pW(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new gW}()}createDatastore(e){const n=Rb(e.databaseInfo.databaseId),l=function(y){return new KZ(y)}(e.databaseInfo);return function(y,A,s,N){return new tW(y,A,s,N)}(e.authCredentials,e.appCheckCredentials,l,n)}createRemoteStore(e){return function(l,d,y,A,s){return new nW(l,d,y,A,s)}(this.localStore,this.datastore,e.asyncQueue,n=>D3(this.syncEngine,n,0),function(){return S3.D()?new S3:new ZZ}())}createSyncEngine(e,n){return function(d,y,A,s,N,j,K){const se=new wW(d,y,A,s,N,j);return K&&(se.ja=!0),se}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}async terminate(){var e,n;await async function(d){const y=Qi(d);mi(If,"RemoteStore shutting down."),y.W_.add(5),await T0(y),y.z_.shutdown(),y.j_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(n=this.eventManager)===null||n===void 0||n.terminate()}}QE.provider={build:()=>new QE};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WA{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.iu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.iu(this.observer.error,e):xu("Uncaught Error in snapshot listener:",e.toString()))}su(){this.muted=!0}iu(e,n){setTimeout(()=>{this.muted||e(n)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yh="FirestoreClient";class NW{constructor(e,n,l,d,y){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=l,this.databaseInfo=d,this.user=oa.UNAUTHENTICATED,this.clientId=T4.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=y,this.authCredentials.start(l,async A=>{mi(Yh,"Received user=",A.uid),await this.authCredentialListener(A),this.user=A}),this.appCheckCredentials.start(l,A=>(mi(Yh,"Received new app check token=",A),this.appCheckCredentialListener(A,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new du;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const l=UA(n,"Failed to shutdown persistence");e.reject(l)}}),e.promise}}async function D2(t,e){t.asyncQueue.verifyOperationInProgress(),mi(Yh,"Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let l=n.initialUser;t.setCredentialChangeListener(async d=>{l.isEqual(d)||(await pN(e.localStore,d),l=d)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=e}async function L3(t,e){t.asyncQueue.verifyOperationInProgress();const n=await FW(t);mi(Yh,"Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener(l=>I3(e.remoteStore,l)),t.setAppCheckTokenChangeListener((l,d)=>I3(e.remoteStore,d)),t._onlineComponents=e}async function FW(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){mi(Yh,"Using user provided OfflineComponentProvider");try{await D2(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(d){return d.name==="FirebaseError"?d.code===Nt.FAILED_PRECONDITION||d.code===Nt.UNIMPLEMENTED:!(typeof DOMException<"u"&&d instanceof DOMException)||d.code===22||d.code===20||d.code===11}(n))throw n;Mm("Error using user provided cache. Falling back to memory cache: "+n),await D2(t,new j1)}}else mi(Yh,"Using default OfflineComponentProvider"),await D2(t,new kW(void 0));return t._offlineComponents}async function PN(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(mi(Yh,"Using user provided OnlineComponentProvider"),await L3(t,t._uninitializedComponentsProvider._online)):(mi(Yh,"Using default OnlineComponentProvider"),await L3(t,new QE))),t._onlineComponents}function BW(t){return PN(t).then(e=>e.syncEngine)}async function q1(t){const e=await PN(t),n=e.eventManager;return n.onListen=TW.bind(null,e.syncEngine),n.onUnlisten=AW.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=EW.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=IW.bind(null,e.syncEngine),n}function VW(t,e,n={}){const l=new du;return t.asyncQueue.enqueueAndForget(async()=>function(y,A,s,N,j){const K=new WA({next:ae=>{K.su(),A.enqueueAndForget(()=>qA(y,se));const me=ae.docs.has(s);!me&&ae.fromCache?j.reject(new gi(Nt.UNAVAILABLE,"Failed to get document because the client is offline.")):me&&ae.fromCache&&N&&N.source==="server"?j.reject(new gi(Nt.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):j.resolve(ae)},error:ae=>j.reject(ae)}),se=new HA(Eb(s.path),K,{includeMetadataChanges:!0,Ta:!0});return jA(y,se)}(await q1(t),t.asyncQueue,e,n,l)),l.promise}function UW(t,e,n={}){const l=new du;return t.asyncQueue.enqueueAndForget(async()=>function(y,A,s,N,j){const K=new WA({next:ae=>{K.su(),A.enqueueAndForget(()=>qA(y,se)),ae.fromCache&&N.source==="server"?j.reject(new gi(Nt.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):j.resolve(ae)},error:ae=>j.reject(ae)}),se=new HA(s,K,{includeMetadataChanges:!0,Ta:!0});return jA(y,se)}(await q1(t),t.asyncQueue,e,n,l)),l.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LN(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const z3=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zN(t,e,n){if(!n)throw new gi(Nt.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function jW(t,e,n,l){if(e===!0&&l===!0)throw new gi(Nt.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function O3(t){if(!Pi.isDocumentKey(t))throw new gi(Nt.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function k3(t){if(Pi.isDocumentKey(t))throw new gi(Nt.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function Lb(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=function(l){return l.constructor?l.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":Hi()}function po(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new gi(Nt.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Lb(t);throw new gi(Nt.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ON="firestore.googleapis.com",N3=!0;class F3{constructor(e){var n,l;if(e.host===void 0){if(e.ssl!==void 0)throw new gi(Nt.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=ON,this.ssl=N3}else this.host=e.host,this.ssl=(n=e.ssl)!==null&&n!==void 0?n:N3;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=dN;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<vZ)throw new gi(Nt.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}jW("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=LN((l=e.experimentalLongPollingOptions)!==null&&l!==void 0?l:{}),function(y){if(y.timeoutSeconds!==void 0){if(isNaN(y.timeoutSeconds))throw new gi(Nt.INVALID_ARGUMENT,`invalid long polling timeout: ${y.timeoutSeconds} (must not be NaN)`);if(y.timeoutSeconds<5)throw new gi(Nt.INVALID_ARGUMENT,`invalid long polling timeout: ${y.timeoutSeconds} (minimum allowed value is 5)`);if(y.timeoutSeconds>30)throw new gi(Nt.INVALID_ARGUMENT,`invalid long polling timeout: ${y.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(l,d){return l.timeoutSeconds===d.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class zb{constructor(e,n,l,d){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=l,this._app=d,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new F3({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new gi(Nt.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new gi(Nt.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new F3(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(l){if(!l)return new KH;switch(l.type){case"firstParty":return new t$(l.sessionIndex||"0",l.iamToken||null,l.authTokenFactory||null);case"provider":return l.client;default:throw new gi(Nt.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(n){const l=z3.get(n);l&&(mi("ComponentProvider","Removing Datastore"),z3.delete(n),l.terminate())}(this),Promise.resolve()}}function qW(t,e,n,l={}){var d;const y=(t=po(t,zb))._getSettings(),A=Object.assign(Object.assign({},y),{emulatorOptions:t._getEmulatorOptions()}),s=`${e}:${n}`;y.host!==ON&&y.host!==s&&Mm("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const N=Object.assign(Object.assign({},y),{host:s,ssl:!1,emulatorOptions:l});if(!Gh(N,A)&&(t._setSettings(N),l.mockUserToken)){let j,K;if(typeof l.mockUserToken=="string")j=l.mockUserToken,K=oa.MOCK_USER;else{j=$8(l.mockUserToken,(d=t._app)===null||d===void 0?void 0:d.options.projectId);const se=l.mockUserToken.sub||l.mockUserToken.user_id;if(!se)throw new gi(Nt.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");K=new oa(se)}t._authCredentials=new QH(new w4(j,K))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sd{constructor(e,n,l){this.converter=n,this._query=l,this.type="query",this.firestore=e}withConverter(e){return new sd(this.firestore,e,this._query)}}class ha{constructor(e,n,l){this.converter=n,this._key=l,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Nh(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new ha(this.firestore,e,this._key)}}class Nh extends sd{constructor(e,n,l){super(e,n,Eb(l)),this._path=l,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new ha(this.firestore,null,new Pi(e))}withConverter(e){return new Nh(this.firestore,e,this._path)}}function da(t,e,...n){if(t=rs(t),zN("collection","path",e),t instanceof zb){const l=gr.fromString(e,...n);return k3(l),new Nh(t,null,l)}{if(!(t instanceof ha||t instanceof Nh))throw new gi(Nt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const l=t._path.child(gr.fromString(e,...n));return k3(l),new Nh(t.firestore,null,l)}}function Gs(t,e,...n){if(t=rs(t),arguments.length===1&&(e=T4.newId()),zN("doc","path",e),t instanceof zb){const l=gr.fromString(e,...n);return O3(l),new ha(t,null,new Pi(l))}{if(!(t instanceof ha||t instanceof Nh))throw new gi(Nt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const l=t._path.child(gr.fromString(e,...n));return O3(l),new ha(t.firestore,t instanceof Nh?t.converter:null,new Pi(l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const B3="AsyncQueue";class V3{constructor(e=Promise.resolve()){this.Vu=[],this.mu=!1,this.fu=[],this.gu=null,this.pu=!1,this.yu=!1,this.wu=[],this.a_=new gN(this,"async_queue_retry"),this.bu=()=>{const l=R2();l&&mi(B3,"Visibility state changed to "+l.visibilityState),this.a_.t_()},this.Su=e;const n=R2();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this.bu)}get isShuttingDown(){return this.mu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Du(),this.vu(e)}enterRestrictedMode(e){if(!this.mu){this.mu=!0,this.yu=e||!1;const n=R2();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this.bu)}}enqueue(e){if(this.Du(),this.mu)return new Promise(()=>{});const n=new du;return this.vu(()=>this.mu&&this.yu?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)).then(()=>n.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Vu.push(e),this.Cu()))}async Cu(){if(this.Vu.length!==0){try{await this.Vu[0](),this.Vu.shift(),this.a_.reset()}catch(e){if(!Km(e))throw e;mi(B3,"Operation failed with retryable error: "+e)}this.Vu.length>0&&this.a_.Xo(()=>this.Cu())}}vu(e){const n=this.Su.then(()=>(this.pu=!0,e().catch(l=>{this.gu=l,this.pu=!1;const d=function(A){let s=A.message||"";return A.stack&&(s=A.stack.includes(A.message)?A.stack:A.message+`
`+A.stack),s}(l);throw xu("INTERNAL UNHANDLED ERROR: ",d),l}).then(l=>(this.pu=!1,l))));return this.Su=n,n}enqueueAfterDelay(e,n,l){this.Du(),this.wu.indexOf(e)>-1&&(n=0);const d=VA.createAndSchedule(this,e,n,l,y=>this.Fu(y));return this.fu.push(d),d}Du(){this.gu&&Hi()}verifyOperationInProgress(){}async Mu(){let e;do e=this.Su,await e;while(e!==this.Su)}xu(e){for(const n of this.fu)if(n.timerId===e)return!0;return!1}Ou(e){return this.Mu().then(()=>{this.fu.sort((n,l)=>n.targetTimeMs-l.targetTimeMs);for(const n of this.fu)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.Mu()})}Nu(e){this.wu.push(e)}Fu(e){const n=this.fu.indexOf(e);this.fu.splice(n,1)}}function U3(t){return function(n,l){if(typeof n!="object"||n===null)return!1;const d=n;for(const y of l)if(y in d&&typeof d[y]=="function")return!0;return!1}(t,["next","error","complete"])}class Kh extends zb{constructor(e,n,l,d){super(e,n,l,d),this.type="firestore",this._queue=new V3,this._persistenceKey=(d==null?void 0:d.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new V3(e),this._firestoreClient=void 0,await e}}}function GW(t,e){const n=typeof t=="object"?t:uk(),l=typeof t=="string"?t:e||O1,d=g0(n,"firestore").getImmediate({identifier:l});if(!d._initialized){const y=G8("firestore");y&&qW(d,...y)}return d}function Ob(t){if(t._terminated)throw new gi(Nt.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||HW(t),t._firestoreClient}function HW(t){var e,n,l;const d=t._freezeSettings(),y=function(s,N,j,K){return new m$(s,N,j,K.host,K.ssl,K.experimentalForceLongPolling,K.experimentalAutoDetectLongPolling,LN(K.experimentalLongPollingOptions),K.useFetchStreams)}(t._databaseId,((e=t._app)===null||e===void 0?void 0:e.options.appId)||"",t._persistenceKey,d);t._componentsProvider||!((n=d.localCache)===null||n===void 0)&&n._offlineComponentProvider&&(!((l=d.localCache)===null||l===void 0)&&l._onlineComponentProvider)&&(t._componentsProvider={_offline:d.localCache._offlineComponentProvider,_online:d.localCache._onlineComponentProvider}),t._firestoreClient=new NW(t._authCredentials,t._appCheckCredentials,t._queue,y,t._componentsProvider&&function(s){const N=s==null?void 0:s._online.build();return{_offline:s==null?void 0:s._offline.build(N),_online:N}}(t._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Om{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Om($s.fromBase64String(e))}catch(n){throw new gi(Nt.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new Om($s.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kb{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new gi(Nt.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new js(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S0{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XA{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new gi(Nt.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new gi(Nt.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return En(this._lat,e._lat)||En(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YA{constructor(e){this._values=(e||[]).map(n=>n)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(l,d){if(l.length!==d.length)return!1;for(let y=0;y<l.length;++y)if(l[y]!==d[y])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $W=/^__.*__$/;class ZW{constructor(e,n,l){this.data=e,this.fieldMask=n,this.fieldTransforms=l}toMutation(e,n){return this.fieldMask!==null?new rd(e,this.data,this.fieldMask,n,this.fieldTransforms):new b0(e,this.data,n,this.fieldTransforms)}}class kN{constructor(e,n,l){this.data=e,this.fieldMask=n,this.fieldTransforms=l}toMutation(e,n){return new rd(e,this.data,this.fieldMask,n,this.fieldTransforms)}}function NN(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Hi()}}class Nb{constructor(e,n,l,d,y,A){this.settings=e,this.databaseId=n,this.serializer=l,this.ignoreUndefinedProperties=d,y===void 0&&this.Bu(),this.fieldTransforms=y||[],this.fieldMask=A||[]}get path(){return this.settings.path}get Lu(){return this.settings.Lu}ku(e){return new Nb(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}qu(e){var n;const l=(n=this.path)===null||n===void 0?void 0:n.child(e),d=this.ku({path:l,Qu:!1});return d.$u(e),d}Ku(e){var n;const l=(n=this.path)===null||n===void 0?void 0:n.child(e),d=this.ku({path:l,Qu:!1});return d.Bu(),d}Uu(e){return this.ku({path:void 0,Qu:!0})}Wu(e){return G1(e,this.settings.methodName,this.settings.Gu||!1,this.path,this.settings.zu)}contains(e){return this.fieldMask.find(n=>e.isPrefixOf(n))!==void 0||this.fieldTransforms.find(n=>e.isPrefixOf(n.field))!==void 0}Bu(){if(this.path)for(let e=0;e<this.path.length;e++)this.$u(this.path.get(e))}$u(e){if(e.length===0)throw this.Wu("Document fields must not be empty");if(NN(this.Lu)&&$W.test(e))throw this.Wu('Document fields cannot begin and end with "__"')}}class WW{constructor(e,n,l){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=l||Rb(e)}ju(e,n,l,d=!1){return new Nb({Lu:e,methodName:n,zu:l,path:js.emptyPath(),Qu:!1,Gu:d},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Fb(t){const e=t._freezeSettings(),n=Rb(t._databaseId);return new WW(t._databaseId,!!e.ignoreUndefinedProperties,n)}function FN(t,e,n,l,d,y={}){const A=t.ju(y.merge||y.mergeFields?2:0,e,n,d);JA("Data must be an object, but it was:",A,l);const s=BN(l,A);let N,j;if(y.merge)N=new co(A.fieldMask),j=A.fieldTransforms;else if(y.mergeFields){const K=[];for(const se of y.mergeFields){const ae=JE(e,se,n);if(!A.contains(ae))throw new gi(Nt.INVALID_ARGUMENT,`Field '${ae}' is specified in your field mask but missing from your input data.`);UN(K,ae)||K.push(ae)}N=new co(K),j=A.fieldTransforms.filter(se=>N.covers(se.field))}else N=null,j=A.fieldTransforms;return new ZW(new Ua(s),N,j)}class Bb extends S0{_toFieldTransform(e){if(e.Lu!==2)throw e.Lu===1?e.Wu(`${this._methodName}() can only appear at the top level of your update data`):e.Wu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Bb}}function XW(t,e,n){return new Nb({Lu:3,zu:e.settings.zu,methodName:t._methodName,Qu:n},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class KA extends S0{_toFieldTransform(e){return new Q4(e.path,new Jy)}isEqual(e){return e instanceof KA}}class QA extends S0{constructor(e,n){super(e),this.Hu=n}_toFieldTransform(e){const n=XW(this,e,!0),l=this.Hu.map(y=>eg(y,n)),d=new Pm(l);return new Q4(e.path,d)}isEqual(e){return e instanceof QA&&Gh(this.Hu,e.Hu)}}function YW(t,e,n,l){const d=t.ju(1,e,n);JA("Data must be an object, but it was:",d,l);const y=[],A=Ua.empty();nd(l,(N,j)=>{const K=eI(e,N,n);j=rs(j);const se=d.Ku(K);if(j instanceof Bb)y.push(K);else{const ae=eg(j,se);ae!=null&&(y.push(K),A.set(K,ae))}});const s=new co(y);return new kN(A,s,d.fieldTransforms)}function KW(t,e,n,l,d,y){const A=t.ju(1,e,n),s=[JE(e,l,n)],N=[d];if(y.length%2!=0)throw new gi(Nt.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let ae=0;ae<y.length;ae+=2)s.push(JE(e,y[ae])),N.push(y[ae+1]);const j=[],K=Ua.empty();for(let ae=s.length-1;ae>=0;--ae)if(!UN(j,s[ae])){const me=s[ae];let Ue=N[ae];Ue=rs(Ue);const Xe=A.Ku(me);if(Ue instanceof Bb)j.push(me);else{const it=eg(Ue,Xe);it!=null&&(j.push(me),K.set(me,it))}}const se=new co(j);return new kN(K,se,A.fieldTransforms)}function QW(t,e,n,l=!1){return eg(n,t.ju(l?4:3,e))}function eg(t,e){if(VN(t=rs(t)))return JA("Unsupported field value:",e,t),BN(t,e);if(t instanceof S0)return function(l,d){if(!NN(d.Lu))throw d.Wu(`${l._methodName}() can only be used with update() and set()`);if(!d.path)throw d.Wu(`${l._methodName}() is not currently supported inside arrays`);const y=l._toFieldTransform(d);y&&d.fieldTransforms.push(y)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.Qu&&e.Lu!==4)throw e.Wu("Nested arrays are not supported");return function(l,d){const y=[];let A=0;for(const s of l){let N=eg(s,d.Uu(A));N==null&&(N={nullValue:"NULL_VALUE"}),y.push(N),A++}return{arrayValue:{values:y}}}(t,e)}return function(l,d){if((l=rs(l))===null)return{nullValue:"NULL_VALUE"};if(typeof l=="number")return N$(d.serializer,l);if(typeof l=="boolean")return{booleanValue:l};if(typeof l=="string")return{stringValue:l};if(l instanceof Date){const y=Vr.fromDate(l);return{timestampValue:B1(d.serializer,y)}}if(l instanceof Vr){const y=new Vr(l.seconds,1e3*Math.floor(l.nanoseconds/1e3));return{timestampValue:B1(d.serializer,y)}}if(l instanceof XA)return{geoPointValue:{latitude:l.latitude,longitude:l.longitude}};if(l instanceof Om)return{bytesValue:sN(d.serializer,l._byteString)};if(l instanceof ha){const y=d.databaseId,A=l.firestore._databaseId;if(!A.isEqual(y))throw d.Wu(`Document reference is for database ${A.projectId}/${A.database} but should be for database ${y.projectId}/${y.database}`);return{referenceValue:DA(l.firestore._databaseId||d.databaseId,l._key.path)}}if(l instanceof YA)return function(A,s){return{mapValue:{fields:{[D4]:{stringValue:L4},[k1]:{arrayValue:{values:A.toArray().map(j=>{if(typeof j!="number")throw s.Wu("VectorValues must only contain numeric values.");return MA(s.serializer,j)})}}}}}}(l,d);throw d.Wu(`Unsupported field value: ${Lb(l)}`)}(t,e)}function BN(t,e){const n={};return S4(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):nd(t,(l,d)=>{const y=eg(d,e.qu(l));y!=null&&(n[l]=y)}),{mapValue:{fields:n}}}function VN(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof Vr||t instanceof XA||t instanceof Om||t instanceof ha||t instanceof S0||t instanceof YA)}function JA(t,e,n){if(!VN(n)||!function(d){return typeof d=="object"&&d!==null&&(Object.getPrototypeOf(d)===Object.prototype||Object.getPrototypeOf(d)===null)}(n)){const l=Lb(n);throw l==="an object"?e.Wu(t+" a custom object"):e.Wu(t+" "+l)}}function JE(t,e,n){if((e=rs(e))instanceof kb)return e._internalPath;if(typeof e=="string")return eI(t,e);throw G1("Field path arguments must be of type string or ",t,!1,void 0,n)}const JW=new RegExp("[~\\*/\\[\\]]");function eI(t,e,n){if(e.search(JW)>=0)throw G1(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new kb(...e.split("."))._internalPath}catch{throw G1(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function G1(t,e,n,l,d){const y=l&&!l.isEmpty(),A=d!==void 0;let s=`Function ${e}() called with invalid data`;n&&(s+=" (via `toFirestore()`)"),s+=". ";let N="";return(y||A)&&(N+=" (found",y&&(N+=` in field ${l}`),A&&(N+=` in document ${d}`),N+=")"),new gi(Nt.INVALID_ARGUMENT,s+t+N)}function UN(t,e){return t.some(n=>n.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jN{constructor(e,n,l,d,y){this._firestore=e,this._userDataWriter=n,this._key=l,this._document=d,this._converter=y}get id(){return this._key.path.lastSegment()}get ref(){return new ha(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new eX(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field(Vb("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class eX extends jN{data(){return super.data()}}function Vb(t,e){return typeof e=="string"?eI(t,e):e instanceof kb?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qN(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new gi(Nt.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class tI{}class GN extends tI{}function Wo(t,e,...n){let l=[];e instanceof tI&&l.push(e),l=l.concat(n),function(y){const A=y.filter(N=>N instanceof iI).length,s=y.filter(N=>N instanceof Ub).length;if(A>1||A>0&&s>0)throw new gi(Nt.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(l);for(const d of l)t=d._apply(t);return t}class Ub extends GN{constructor(e,n,l){super(),this._field=e,this._op=n,this._value=l,this.type="where"}static _create(e,n,l){return new Ub(e,n,l)}_apply(e){const n=this._parse(e);return HN(e._query,n),new sd(e.firestore,e.converter,jE(e._query,n))}_parse(e){const n=Fb(e.firestore);return function(y,A,s,N,j,K,se){let ae;if(j.isKeyField()){if(K==="array-contains"||K==="array-contains-any")throw new gi(Nt.INVALID_ARGUMENT,`Invalid Query. You can't perform '${K}' queries on documentId().`);if(K==="in"||K==="not-in"){q3(se,K);const Ue=[];for(const Xe of se)Ue.push(j3(N,y,Xe));ae={arrayValue:{values:Ue}}}else ae=j3(N,y,se)}else K!=="in"&&K!=="not-in"&&K!=="array-contains-any"||q3(se,K),ae=QW(s,A,se,K==="in"||K==="not-in");return is.create(j,K,ae)}(e._query,"where",n,e.firestore._databaseId,this._field,this._op,this._value)}}function Ho(t,e,n){const l=e,d=Vb("where",t);return Ub._create(d,l,n)}class iI extends tI{constructor(e,n){super(),this.type=e,this._queryConstraints=n}static _create(e,n){return new iI(e,n)}_parse(e){const n=this._queryConstraints.map(l=>l._parse(e)).filter(l=>l.getFilters().length>0);return n.length===1?n[0]:Sl.create(n,this._getOperator())}_apply(e){const n=this._parse(e);return n.getFilters().length===0?e:(function(d,y){let A=d;const s=y.getFlattenedFilters();for(const N of s)HN(A,N),A=jE(A,N)}(e._query,n),new sd(e.firestore,e.converter,jE(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class nI extends GN{constructor(e,n){super(),this._field=e,this._direction=n,this.type="orderBy"}static _create(e,n){return new nI(e,n)}_apply(e){const n=function(d,y,A){if(d.startAt!==null)throw new gi(Nt.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(d.endAt!==null)throw new gi(Nt.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Qy(y,A)}(e._query,this._field,this._direction);return new sd(e.firestore,e.converter,function(d,y){const A=d.explicitOrderBy.concat([y]);return new Qm(d.path,d.collectionGroup,A,d.filters.slice(),d.limit,d.limitType,d.startAt,d.endAt)}(e._query,n))}}function tX(t,e="asc"){const n=e,l=Vb("orderBy",t);return nI._create(l,n)}function j3(t,e,n){if(typeof(n=rs(n))=="string"){if(n==="")throw new gi(Nt.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!U4(e)&&n.indexOf("/")!==-1)throw new gi(Nt.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const l=e.path.child(gr.fromString(n));if(!Pi.isDocumentKey(l))throw new gi(Nt.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${l}' is not because it has an odd number of segments (${l.length}).`);return n3(t,new Pi(l))}if(n instanceof ha)return n3(t,n._key);throw new gi(Nt.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Lb(n)}.`)}function q3(t,e){if(!Array.isArray(t)||t.length===0)throw new gi(Nt.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function HN(t,e){const n=function(d,y){for(const A of d)for(const s of A.getFlattenedFilters())if(y.indexOf(s.op)>=0)return s.op;return null}(t.filters,function(d){switch(d){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(n!==null)throw n===e.op?new gi(Nt.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new gi(Nt.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}class iX{convertValue(e,n="none"){switch(Wh(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Zr(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(Zh(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 11:return this.convertObject(e.mapValue,n);case 10:return this.convertVectorValue(e.mapValue);default:throw Hi()}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){const l={};return nd(e,(d,y)=>{l[d]=this.convertValue(y,n)}),l}convertVectorValue(e){var n,l,d;const y=(d=(l=(n=e.fields)===null||n===void 0?void 0:n[k1].arrayValue)===null||l===void 0?void 0:l.values)===null||d===void 0?void 0:d.map(A=>Zr(A.doubleValue));return new YA(y)}convertGeoPoint(e){return new XA(Zr(e.latitude),Zr(e.longitude))}convertArray(e,n){return(e.values||[]).map(l=>this.convertValue(l,n))}convertServerTimestamp(e,n){switch(n){case"previous":const l=Tb(e);return l==null?null:this.convertValue(l,n);case"estimate":return this.convertTimestamp(Xy(e));default:return null}}convertTimestamp(e){const n=$h(e);return new Vr(n.seconds,n.nanos)}convertDocumentKey(e,n){const l=gr.fromString(e);Vn(hN(l));const d=new Yy(l.get(1),l.get(3)),y=new Pi(l.popFirst(5));return d.isEqual(n)||xu(`Document ${y} contains a document reference within a different database (${d.projectId}/${d.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),y}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $N(t,e,n){let l;return l=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,l}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ay{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class ZN extends jN{constructor(e,n,l,d,y,A){super(e,n,l,d,A),this._firestore=e,this._firestoreImpl=e,this.metadata=y}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new Xx(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const l=this._document.data.field(Vb("DocumentSnapshot.get",e));if(l!==null)return this._userDataWriter.convertValue(l,n.serverTimestamps)}}}class Xx extends ZN{data(e={}){return super.data(e)}}class WN{constructor(e,n,l,d){this._firestore=e,this._userDataWriter=n,this._snapshot=d,this.metadata=new ay(d.hasPendingWrites,d.fromCache),this.query=l}get docs(){const e=[];return this.forEach(n=>e.push(n)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach(l=>{e.call(n,new Xx(this._firestore,this._userDataWriter,l.key,l,new ay(this._snapshot.mutatedKeys.has(l.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new gi(Nt.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=function(d,y){if(d._snapshot.oldDocs.isEmpty()){let A=0;return d._snapshot.docChanges.map(s=>{const N=new Xx(d._firestore,d._userDataWriter,s.doc.key,s.doc,new ay(d._snapshot.mutatedKeys.has(s.doc.key),d._snapshot.fromCache),d.query.converter);return s.doc,{type:"added",doc:N,oldIndex:-1,newIndex:A++}})}{let A=d._snapshot.oldDocs;return d._snapshot.docChanges.filter(s=>y||s.type!==3).map(s=>{const N=new Xx(d._firestore,d._userDataWriter,s.doc.key,s.doc,new ay(d._snapshot.mutatedKeys.has(s.doc.key),d._snapshot.fromCache),d.query.converter);let j=-1,K=-1;return s.type!==0&&(j=A.indexOf(s.doc.key),A=A.delete(s.doc.key)),s.type!==1&&(A=A.add(s.doc),K=A.indexOf(s.doc.key)),{type:nX(s.type),doc:N,oldIndex:j,newIndex:K}})}}(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}}function nX(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Hi()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fu(t){t=po(t,ha);const e=po(t.firestore,Kh);return VW(Ob(e),t._key).then(n=>XN(e,t,n))}class rI extends iX{constructor(e){super(),this.firestore=e}convertBytes(e){return new Om(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new ha(this.firestore,null,n)}}function Qh(t){t=po(t,sd);const e=po(t.firestore,Kh),n=Ob(e),l=new rI(e);return qN(t._query),UW(n,t._query).then(d=>new WN(e,l,t,d))}function A0(t,e,n){t=po(t,ha);const l=po(t.firestore,Kh),d=$N(t.converter,e,n);return aI(l,[FN(Fb(l),"setDoc",t._key,d,t.converter!==null,n).toMutation(t._key,bl.none())])}function Fh(t,e,n,...l){t=po(t,ha);const d=po(t.firestore,Kh),y=Fb(d);let A;return A=typeof(e=rs(e))=="string"||e instanceof kb?KW(y,"updateDoc",t._key,e,n,l):YW(y,"updateDoc",t._key,e),aI(d,[A.toMutation(t._key,bl.exists(!0))])}function sI(t,e){const n=po(t.firestore,Kh),l=Gs(t),d=$N(t.converter,e);return aI(n,[FN(Fb(t.firestore),"addDoc",l._key,d,t.converter!==null,{}).toMutation(l._key,bl.exists(!1))]).then(()=>l)}function H1(t,...e){var n,l,d;t=rs(t);let y={includeMetadataChanges:!1,source:"default"},A=0;typeof e[A]!="object"||U3(e[A])||(y=e[A],A++);const s={includeMetadataChanges:y.includeMetadataChanges,source:y.source};if(U3(e[A])){const se=e[A];e[A]=(n=se.next)===null||n===void 0?void 0:n.bind(se),e[A+1]=(l=se.error)===null||l===void 0?void 0:l.bind(se),e[A+2]=(d=se.complete)===null||d===void 0?void 0:d.bind(se)}let N,j,K;if(t instanceof ha)j=po(t.firestore,Kh),K=Eb(t._key.path),N={next:se=>{e[A]&&e[A](XN(j,t,se))},error:e[A+1],complete:e[A+2]};else{const se=po(t,sd);j=po(se.firestore,Kh),K=se._query;const ae=new rI(j);N={next:me=>{e[A]&&e[A](new WN(j,ae,se,me))},error:e[A+1],complete:e[A+2]},qN(t._query)}return function(ae,me,Ue,Xe){const it=new WA(Xe),be=new HA(me,it,Ue);return ae.asyncQueue.enqueueAndForget(async()=>jA(await q1(ae),be)),()=>{it.su(),ae.asyncQueue.enqueueAndForget(async()=>qA(await q1(ae),be))}}(Ob(j),K,s,N)}function aI(t,e){return function(l,d){const y=new du;return l.asyncQueue.enqueueAndForget(async()=>MW(await BW(l),d,y)),y.promise}(Ob(t),e)}function XN(t,e,n){const l=n.docs.get(e._key),d=new rI(t);return new ZN(t,d,e._key,l,new ay(n.hasPendingWrites,n.fromCache),e.converter)}function Hs(){return new KA("serverTimestamp")}function rX(...t){return new QA("arrayUnion",t)}(function(e,n=!0){(function(d){Xm=d})(Zm),hc(new Tl("firestore",(l,{instanceIdentifier:d,options:y})=>{const A=l.getProvider("app").getImmediate(),s=new Kh(new JH(l.getProvider("auth-internal")),new i$(A,l.getProvider("app-check-internal")),function(j,K){if(!Object.prototype.hasOwnProperty.apply(j.options,["projectId"]))throw new gi(Nt.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Yy(j.options.projectId,K)}(A,d),A);return y=Object.assign({useFetchStreams:n},y),s._setSettings(y),s},"PUBLIC").setMultipleInstances(!0)),$o($P,ZP,e),$o($P,ZP,"esm2017")})();const sX={apiKey:"AIzaSyBetdh0XHzxDAlDFZgcEm4GLScXRMixL2c",authDomain:"swiftdrop-617bd.firebaseapp.com",projectId:"swiftdrop-617bd",storageBucket:"swiftdrop-617bd.firebasestorage.app",messagingSenderId:"22451382364",appId:"1:22451382364:web:03b082a6070c7018dbde99"},YN=ck(sX),$1=XH(YN),Pn=GW(YN),KN=ot.createContext(),aX=({children:t})=>{const[e,n]=ot.useState(null),[l,d]=ot.useState(!0);ot.useEffect(()=>{const A=N7($1,s=>{n(s),d(!1)});return()=>A()},[]);const y=()=>{F7($1)};return J.jsx(KN.Provider,{value:{user:e,logout:y},children:!l&&t})},Cl=()=>ot.useContext(KN);function QN({children:t,className:e,...n}){return J.jsx("button",{...n,className:`px-4 py-2 rounded-lg font-semibold transition-colors ${e}`,children:t})}function oX(){const{user:t,logout:e}=Cl(),[n,l]=ot.useState(!1),y=Tu().pathname==="/"?"bg-black bg-opacity-50 backdrop-blur-md":"bg-gradient-to-r from-indigo-600 to-indigo-400 shadow-md";return J.jsx("nav",{className:`${y} text-white p-4`,children:J.jsxs("div",{className:"flex justify-between items-center max-w-7xl mx-auto",children:[J.jsx(es,{to:"/",className:"text-2xl font-bold",children:"SwiftDrop 🚀"}),J.jsxs("div",{className:"flex space-x-4 items-center",children:[t&&J.jsx(es,{to:"/available-deliveries",className:"hover:text-indigo-300",children:"Available Deliveries"}),t&&J.jsx(es,{to:"/create-delivery",className:"hover:text-indigo-300",children:"Create Delivery"}),t&&J.jsx(es,{to:"/user-dashboard",className:"hover:text-indigo-300",children:"Dashboard"}),t?J.jsxs("div",{className:"relative",children:[J.jsx("button",{onClick:()=>l(!n),className:"focus:outline-none",children:J.jsx("img",{src:`https://randomuser.me/api/portraits/${parseInt(t==null?void 0:t.uid,36)%2===0?"men":"women"}/${parseInt(t==null?void 0:t.uid,36)%99}.jpg`,alt:"Profile",className:"h-10 w-10 rounded-full border-2 border-white cursor-pointer"})}),n&&J.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg py-2 text-gray-800 z-50",children:[J.jsx(es,{to:"/user-dashboard",className:"block px-4 py-2 hover:bg-gray-100",children:"Dashboard"}),J.jsx("a",{href:"http://localhost:5173/review",className:"block px-4 py-2 hover:bg-gray-100",target:"_self",rel:"noopener noreferrer",children:"Reviews"}),J.jsx(es,{to:"/settings",className:"block px-4 py-2 hover:bg-gray-100",children:"Settings"}),J.jsx("div",{className:"border-t my-1"}),J.jsx("button",{onClick:()=>{e(),l(!1)},className:"block w-full text-left px-4 py-2 text-red-600 hover:bg-gray-100",children:"Logout"})]})]}):J.jsxs(J.Fragment,{children:[J.jsx(es,{to:"/available-deliveries",className:"hover:text-indigo-300",children:"Available Deliveries"}),J.jsx(es,{to:"/login",className:"hover:text-indigo-300",children:"Login"}),J.jsx(es,{to:"/signup",className:"hover:text-indigo-300",children:"Sign Up"})]})]})]})})}const lX="/swiftdrop_uc/assets/homepage-11170184.mp4";function cX(){return Cl(),J.jsxs(J.Fragment,{children:[J.jsx("style",{children:`
          *, *::before, *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
          }
          html, body, #root {
            width: 100%;
            height: 100%;
            overflow: hidden;
          }
          video {
            display: block;
            width: 100%;
            height: 100%;
          }
        `}),J.jsx("nav",{className:"fixed top-0 left-0 w-full bg-black bg-opacity-70 text-white py-4 px-6 z-20 backdrop-blur-md",children:J.jsxs("div",{className:"flex justify-between items-center max-w-7xl mx-auto",children:[J.jsx(es,{to:"/",className:"text-2xl font-bold tracking-wide hover:text-yellow-300 transition",children:"SwiftDrop 🚀"}),J.jsxs("div",{className:"space-x-6",children:[J.jsx(es,{to:"/available-deliveries",className:"hover:text-yellow-300 transition",children:"Available Deliveries"}),J.jsx(es,{to:"/login",className:"hover:text-yellow-300 transition",children:"Login"}),J.jsx(es,{to:"/signup",className:"hover:text-yellow-300 transition",children:"Sign Up"})]})]})}),J.jsxs("div",{className:"fixed inset-0 w-full h-full",children:[J.jsx("video",{src:lX,autoPlay:!0,loop:!0,muted:!0,playsInline:!0,className:"absolute top-0 left-0 w-full h-full object-cover"}),J.jsx("div",{className:"absolute inset-0 bg-black opacity-30 backdrop-blur-lg"})]}),J.jsxs("div",{className:"relative z-10 text-center px-6 w-full h-full flex flex-col items-center justify-center",children:[J.jsxs("h1",{className:"text-6xl font-extrabold drop-shadow-lg text-white",children:["Welcome to ",J.jsx("span",{className:"text-yellow-300",children:"SwiftDrop"})]}),J.jsx("h2",{className:"text-3xl font-semibold mt-4 text-white drop-shadow-lg tracking-wide",children:"Earn While You Travel, Deliver with Ease!"}),J.jsxs("div",{className:"mt-8 flex space-x-6",children:[J.jsx(es,{to:"/create-delivery",className:"px-8 py-3 bg-yellow-400 text-black font-semibold rounded-lg shadow-md hover:bg-yellow-500 transition-transform transform hover:scale-105",children:"Create Delivery"}),J.jsx(es,{to:"/available-deliveries",className:"px-8 py-3 border-2 border-yellow-400 text-yellow-400 font-semibold rounded-lg hover:bg-yellow-400 hover:text-black transition-transform transform hover:scale-105",children:"Available Deliveries"})]})]})]})}const uX=(t,e)=>L7($1,t,e),hX=(t,e)=>z7($1,t,e);new eu;function af({className:t,...e}){return J.jsx("input",{...e,className:`border border-gray-300 rounded-lg px-3 py-2 w-full focus:ring-2 focus:ring-blue-400 focus:outline-none ${t}`})}/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dX=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),JN=(...t)=>t.filter((e,n,l)=>!!e&&e.trim()!==""&&l.indexOf(e)===n).join(" ").trim();/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var fX={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pX=ot.forwardRef(({color:t="currentColor",size:e=24,strokeWidth:n=2,absoluteStrokeWidth:l,className:d="",children:y,iconNode:A,...s},N)=>ot.createElement("svg",{ref:N,...fX,width:e,height:e,stroke:t,strokeWidth:l?Number(n)*24/Number(e):n,className:JN("lucide",d),...s},[...A.map(([j,K])=>ot.createElement(j,K)),...Array.isArray(y)?y:[y]]));/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jb=(t,e)=>{const n=ot.forwardRef(({className:l,...d},y)=>ot.createElement(pX,{ref:y,iconNode:e,className:JN(`lucide-${dX(t)}`,l),...d}));return n.displayName=`${t}`,n};/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mX=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],eS=jb("Lock",mX);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gX=[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]],eF=jb("Mail",gX);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _X=[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]],yX=jb("Phone",_X);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vX=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],xX=jb("User",vX),bX="/swiftdrop_uc/assets/loginpage-bf6b7790.mp4";function wX(){const[t,e]=ot.useState(""),[n,l]=ot.useState(""),[d,y]=ot.useState(""),[A,s]=ot.useState(!1),N=$m(),{user:j}=Cl(),K=async se=>{se.preventDefault(),s(!0),y("");try{await hX(t,n),N("/available-deliveries")}catch{y("Invalid credentials. Please try again.")}finally{s(!1)}};return J.jsxs(J.Fragment,{children:[J.jsx("style",{children:`
          *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
          }
          html, body {
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            background: black;
          }
          video {
            display: block;
            width: 100%;
            height: 100%;
            object-fit: cover;
          }
        `}),J.jsxs("div",{className:"relative flex flex-col items-center justify-center w-screen h-screen text-white",children:[J.jsx("div",{className:"absolute inset-0 w-full h-full",children:J.jsx("video",{src:bX,autoPlay:!0,loop:!0,muted:!0,playsInline:!0,className:"absolute top-0 left-0 w-full h-full object-cover"})}),J.jsx("div",{className:"absolute inset-0 w-full h-full bg-black bg-opacity-70"}),J.jsx("div",{className:"absolute top-6 left-10 flex items-center z-10",children:J.jsx(es,{to:"/",className:"text-2xl font-bold text-white hover:text-yellow-400 transition",children:"SwiftDrop 🚀"})}),J.jsxs("div",{className:"relative z-10 bg-white bg-opacity-20 p-8 rounded-lg shadow-lg w-full max-w-md backdrop-blur-md",children:[J.jsx("h2",{className:"text-2xl font-bold text-center mb-4 text-white",children:"Welcome Back"}),d&&J.jsx("p",{className:"text-red-400 text-center mb-4",children:d}),j&&J.jsxs("p",{className:"text-green-300 text-center mb-4",children:["Logged in as ",j.email]}),J.jsxs("form",{onSubmit:K,className:"space-y-4",children:[J.jsxs("div",{className:"relative",children:[J.jsx(eF,{className:"absolute left-3 top-3 h-5 w-5 text-gray-300"}),J.jsx(af,{type:"email",placeholder:"Email",value:t,onChange:se=>e(se.target.value),className:"pl-10 bg-transparent border border-white text-white placeholder-gray-300",required:!0})]}),J.jsxs("div",{className:"relative",children:[J.jsx(eS,{className:"absolute left-3 top-3 h-5 w-5 text-gray-300"}),J.jsx(af,{type:"password",placeholder:"Password",value:n,onChange:se=>l(se.target.value),className:"pl-10 bg-transparent border border-white text-white placeholder-gray-300",required:!0})]}),J.jsx(QN,{type:"submit",className:"w-full bg-yellow-400 text-black font-bold rounded-lg shadow-md hover:bg-yellow-500 transition",disabled:A,children:A?"Logging in...":"Log In"})]}),J.jsxs("p",{className:"text-center text-sm text-gray-300 mt-4",children:["Don't have an account?"," ",J.jsx(es,{to:"/signup",className:"text-yellow-300 hover:underline",children:"Sign up"})]})]})]})]})}const TX="/swiftdrop_uc/assets/signuppage-c219a68e.mp4",EX=async(t,e,n,l)=>{const d=Gs(Pn,"users",t);await A0(d,{uid:t,fullName:n,email:e,phoneNumber:l,isVerified:!1,trustScore:0,createdAt:Hs()})};function SX(){const[t,e]=ot.useState(""),[n,l]=ot.useState(""),[d,y]=ot.useState(""),[A,s]=ot.useState(""),[N,j]=ot.useState(""),[K,se]=ot.useState(!1),[ae,me]=ot.useState(""),[Ue,Xe]=ot.useState(!1),it=$m(),be=async Ee=>{if(Ee.preventDefault(),d!==A){me("Passwords do not match!");return}Xe(!0),me("");try{const We=(await uX(n,d)).user;await EX(We.uid,n,t,N),se("Account created successfully! Redirecting to login..."),it("/")}catch(Ce){me(Ce.message)}finally{Xe(!1)}};return J.jsxs(J.Fragment,{children:[J.jsx("style",{children:`
          *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
          }
          html, body {
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            background: black;
          }
          video {
            display: block;
            width: 100%;
            height: 100%;
            object-fit: cover;
          }
        `}),J.jsxs("div",{className:"relative flex flex-col items-center justify-center w-screen h-screen text-white",children:[J.jsx("div",{className:"absolute inset-0 w-full h-full",children:J.jsx("video",{src:TX,autoPlay:!0,loop:!0,muted:!0,playsInline:!0,className:"absolute top-0 left-0 w-full h-full object-cover"})}),J.jsx("div",{className:"absolute inset-0 w-full h-full bg-black bg-opacity-60"}),J.jsx("div",{className:"absolute top-6 left-10 flex items-center z-10",children:J.jsx(es,{to:"/",className:"text-2xl font-bold text-white hover:text-yellow-400 transition",children:"SwiftDrop 🚀"})}),J.jsxs("div",{className:"relative z-10 bg-white bg-opacity-20 p-8 rounded-lg shadow-lg w-full max-w-md backdrop-blur-md",children:[J.jsx("h2",{className:"text-2xl font-bold text-center mb-4 text-white",children:"Create Your Account"}),ae&&J.jsx("p",{className:"text-red-400 text-center mb-4",children:ae}),K&&J.jsx("p",{className:"text-green-300 text-center mb-4",children:K}),J.jsxs("form",{onSubmit:be,className:"space-y-4",children:[J.jsxs("div",{className:"relative",children:[J.jsx(xX,{className:"absolute left-3 top-3 h-5 w-5 text-gray-300"}),J.jsx(af,{type:"text",placeholder:"Full Name",value:t,onChange:Ee=>e(Ee.target.value),className:"pl-10 bg-transparent border border-white text-white placeholder-gray-300",required:!0})]}),J.jsxs("div",{className:"relative",children:[J.jsx(eF,{className:"absolute left-3 top-3 h-5 w-5 text-gray-300"}),J.jsx(af,{type:"email",placeholder:"Email",value:n,onChange:Ee=>l(Ee.target.value),className:"pl-10 bg-transparent border border-white text-white placeholder-gray-300",required:!0})]}),J.jsxs("div",{className:"relative",children:[J.jsx(eS,{className:"absolute left-3 top-3 h-5 w-5 text-gray-300"}),J.jsx(af,{type:"password",placeholder:"Password",value:d,onChange:Ee=>y(Ee.target.value),className:"pl-10 bg-transparent border border-white text-white placeholder-gray-300",required:!0})]}),J.jsxs("div",{className:"relative",children:[J.jsx(eS,{className:"absolute left-3 top-3 h-5 w-5 text-gray-300"}),J.jsx(af,{type:"password",placeholder:"Confirm Password",value:A,onChange:Ee=>s(Ee.target.value),className:"pl-10 bg-transparent border border-white text-white placeholder-gray-300",required:!0})]}),J.jsxs("div",{className:"relative",children:[J.jsx(yX,{className:"absolute left-3 top-3 h-5 w-5 text-gray-300"}),J.jsx(af,{type:"number",placeholder:"Phone Number",value:N,onChange:Ee=>j(Ee.target.value),className:"pl-10 bg-transparent border border-white text-white placeholder-gray-300",required:!0})]}),J.jsx(QN,{type:"submit",className:"w-full bg-yellow-400 text-black font-bold rounded-lg shadow-md hover:bg-yellow-500 transition",disabled:Ue,children:Ue?"Creating Account...":"Sign Up"})]})]})]})]})}const AX=async t=>{const e=query(da(Pn,"reviews"),where("userId","==",t)),l=(await getDocs(e)).docs.map(A=>({id:A.id,...A.data()})),d=l.reduce((A,s)=>A+s.rating,0),y=l.length>0?(d/l.length).toFixed(1):"No ratings yet";return{reviews:l,averageRating:y}},IX=async(t,e)=>{try{return(await sI(da(Pn,"delivery"),{senderId:t,itemDetails:{title:e.title,description:e.description,category:e.category,weight:e.weight,dimensions:e.dimensions,fragile:e.fragile},pickup:{location:{address:e.pickup.location.address,city:e.pickup.location.city},flexibleTime:e.pickup.flexibleTime,date:e.pickup.date},dropoff:{location:{address:e.dropoff.location.address,city:e.dropoff.location.city},preferredTime:e.dropoff.preferredTime},compensation:{amount:e.compensation.amount,currency:e.compensation.currency,paymentMethod:e.compensation.paymentMethod,escrow:e.escrow},security:{idVerificationRequired:e.idVerificationRequired},status:"Pending",assignedTraveler:null,requestedTravelers:[],createdAt:Hs(),updatedAt:Hs()})).id}catch(n){throw console.error("❌ Error creating delivery:",n),n}},MX=async(t,e)=>{try{const n=Gs(Pn,"delivery",t),l=Gs(Pn,"trips",`${t}_${e}`),d=await fu(n);if(!d.exists())return{success:!1,message:"Delivery not found!"};const y=d.data();return y.requestedTravelers&&y.requestedTravelers.some(A=>A.travelerId===e)?{success:!1,message:"You have already requested this delivery."}:(await Fh(n,{requestedTravelers:rX({travelerId:e,requestedAt:new Date().toISOString()}),updatedAt:Hs()}),await A0(l,{deliveryId:t,userId:e,status:"Pending",requestedAt:new Date().toISOString(),updatedAt:Hs()}),{success:!0,message:"Request sent successfully!"})}catch(n){return console.error("Error requesting delivery:",n),{success:!1,message:n.message}}},tF=async t=>{const e=Wo(da(Pn,"delivery"),Ho("senderId","==",t));return(await Qh(e)).docs.map(l=>({id:l.id,...l.data()}))},CX=async t=>{const e=Wo(da(Pn,"delivery"),Ho("requestedTravelers","array-contains",{travelerId:t}));return(await Qh(e)).docs.map(l=>({id:l.id,...l.data()}))},RX=async t=>{const e=Wo(da(Pn,"delivery"),Ho("assignedTraveler","==",t));return(await Qh(e)).docs.map(l=>({id:l.id,...l.data()}))},DX=async()=>{const t=Wo(da(Pn,"delivery"),Ho("status","==","Pending"));return(await Qh(t)).docs.map(n=>({id:n.id,...n.data()}))},PX=async(t,e)=>{try{const n=Gs(Pn,"delivery",t),l=await fu(n);return l.exists()?l.data().assignedTraveler?{success:!1,message:"Traveler already assigned for this delivery!"}:(await Fh(n,{assignedTraveler:e,status:"Accepted",updatedAt:Hs()}),{success:!0,message:"Traveler accepted successfully!"}):{success:!1,message:"Delivery not found!"}}catch(n){return console.error("Error accepting traveler:",n),{success:!1,message:n.message}}},LX=async(t,e)=>{try{const n=Gs(Pn,"delivery",t),l=await fu(n);if(!l.exists())return{success:!1,message:"Delivery not found!"};const y=(l.data().requestedTravelers||[]).filter(A=>A.travelerId!==e);return await Fh(n,{requestedTravelers:y,updatedAt:Hs()}),{success:!0,message:"Traveler request canceled successfully!"}}catch(n){return console.error("Error canceling traveler request:",n),{success:!1,message:n.message}}};function zX(){const{user:t}=Cl(),[e,n]=ot.useState([]),[l,d]=ot.useState(""),[y,A]=ot.useState([]);return ot.useEffect(()=>{t&&(AX(t.uid).then(s=>{n(s.reviews),d(s.averageRating)}),tF(t.uid).then(A))},[t]),t?J.jsx("div",{className:"bg-gray-100 min-h-screen p-6",children:J.jsxs("div",{className:"bg-white rounded-xl shadow-md p-6 max-w-lg mx-auto",children:[J.jsx("h1",{className:"text-2xl font-bold text-indigo-700 mb-2",children:"Your Profile"}),J.jsxs("p",{children:[J.jsx("strong",{children:"Email:"})," ",t.email]}),J.jsxs("p",{children:[J.jsx("strong",{children:"Average Rating:"})," ",l]}),J.jsx("h2",{className:"text-xl font-semibold mt-4",children:"Your Deliveries:"}),y.length===0?J.jsx("p",{className:"text-gray-500",children:"No deliveries yet."}):J.jsx("ul",{className:"space-y-2 mt-2",children:y.map(s=>J.jsxs("li",{className:"bg-gray-50 p-3 rounded-md shadow-sm",children:[J.jsxs("p",{children:[J.jsx("strong",{children:"From:"})," ",s.pickupLocation]}),J.jsxs("p",{children:[J.jsx("strong",{children:"To:"})," ",s.dropoffLocation]}),J.jsxs("p",{children:[J.jsx("strong",{children:"Item:"})," ",s.itemDescription]}),J.jsxs("p",{children:[J.jsx("strong",{children:"Status:"})," ",s.status]})]},s.id))}),J.jsx("h2",{className:"text-xl font-semibold mt-4",children:"Reviews Received:"}),e.length===0?J.jsx("p",{className:"text-gray-500",children:"No reviews yet."}):J.jsx("ul",{className:"space-y-2 mt-2",children:e.map(s=>J.jsxs("li",{className:"bg-gray-50 p-3 rounded-md shadow-sm",children:[J.jsxs("p",{children:[J.jsx("strong",{children:"Rating:"})," ⭐ ",s.rating]}),J.jsxs("p",{children:[J.jsx("strong",{children:"Comment:"})," ",s.comment]})]},s.id))})]})}):J.jsx("p",{className:"text-center text-gray-500",children:"Please log in to view your profile."})}const Sx=({children:t})=>{const{user:e}=Cl();return e?t:J.jsx(Jj,{to:"/login",replace:!0})},qb=async t=>{if(!t)return null;try{const e=await fu(Gs(Pn,"users",t));return e.exists()?e.data():null}catch(e){return console.error("Error fetching user profile:",e),null}};var iF={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},G3=Sh.createContext&&Sh.createContext(iF),OX=["attr","size","title"];function kX(t,e){if(t==null)return{};var n=NX(t,e),l,d;if(Object.getOwnPropertySymbols){var y=Object.getOwnPropertySymbols(t);for(d=0;d<y.length;d++)l=y[d],!(e.indexOf(l)>=0)&&Object.prototype.propertyIsEnumerable.call(t,l)&&(n[l]=t[l])}return n}function NX(t,e){if(t==null)return{};var n={};for(var l in t)if(Object.prototype.hasOwnProperty.call(t,l)){if(e.indexOf(l)>=0)continue;n[l]=t[l]}return n}function Z1(){return Z1=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&(t[l]=n[l])}return t},Z1.apply(this,arguments)}function H3(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);e&&(l=l.filter(function(d){return Object.getOwnPropertyDescriptor(t,d).enumerable})),n.push.apply(n,l)}return n}function W1(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?H3(Object(n),!0).forEach(function(l){FX(t,l,n[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):H3(Object(n)).forEach(function(l){Object.defineProperty(t,l,Object.getOwnPropertyDescriptor(n,l))})}return t}function FX(t,e,n){return e=BX(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function BX(t){var e=VX(t,"string");return typeof e=="symbol"?e:e+""}function VX(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var l=n.call(t,e||"default");if(typeof l!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function nF(t){return t&&t.map((e,n)=>Sh.createElement(e.tag,W1({key:n},e.attr),nF(e.child)))}function oI(t){return e=>Sh.createElement(UX,Z1({attr:W1({},t.attr)},e),nF(t.child))}function UX(t){var e=n=>{var{attr:l,size:d,title:y}=t,A=kX(t,OX),s=d||n.size||"1em",N;return n.className&&(N=n.className),t.className&&(N=(N?N+" ":"")+t.className),Sh.createElement("svg",Z1({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},n.attr,l,A,{className:N,style:W1(W1({color:t.color||n.color},n.style),t.style),height:s,width:s,xmlns:"http://www.w3.org/2000/svg"}),y&&Sh.createElement("title",null,y),t.children)};return G3!==void 0?Sh.createElement(G3.Consumer,null,n=>e(n)):e(iF)}function jX(t){return oI({tag:"svg",attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M425.7 256c-16.9 0-32.8-9-41.4-23.4L320 126l-64.2 106.6c-8.7 14.5-24.6 23.5-41.5 23.5-4.5 0-9-.6-13.3-1.9L64 215v178c0 14.7 10 27.5 24.2 31l216.2 54.1c10.2 2.5 20.9 2.5 31 0L551.8 424c14.2-3.6 24.2-16.4 24.2-31V215l-137 39.1c-4.3 1.3-8.8 1.9-13.3 1.9zm212.6-112.2L586.8 41c-3.1-6.2-9.8-9.8-16.7-8.9L320 64l91.7 152.1c3.8 6.3 11.4 9.3 18.5 7.3l197.9-56.5c9.9-2.9 14.7-13.9 10.2-23.1zM53.2 41L1.7 143.8c-4.6 9.2.3 20.2 10.1 23l197.9 56.5c7.1 2 14.7-1 18.5-7.3L320 64 69.8 32.1c-6.9-.8-13.5 2.7-16.6 8.9z"},child:[]}]})(t)}function qX(t){return oI({tag:"svg",attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M172.268 501.67C26.97 291.031 0 269.413 0 192 0 85.961 85.961 0 192 0s192 85.961 192 192c0 77.413-26.97 99.031-172.268 309.67-9.535 13.774-29.93 13.773-39.464 0zM192 272c44.183 0 80-35.817 80-80s-35.817-80-80-80-80 35.817-80 80 35.817 80 80 80z"},child:[]}]})(t)}function GX(t){return oI({tag:"svg",attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M624 352h-16V243.9c0-12.7-5.1-24.9-14.1-33.9L494 110.1c-9-9-21.2-14.1-33.9-14.1H416V48c0-26.5-21.5-48-48-48H48C21.5 0 0 21.5 0 48v320c0 26.5 21.5 48 48 48h16c0 53 43 96 96 96s96-43 96-96h128c0 53 43 96 96 96s96-43 96-96h48c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zM160 464c-26.5 0-48-21.5-48-48s21.5-48 48-48 48 21.5 48 48-21.5 48-48 48zm320 0c-26.5 0-48-21.5-48-48s21.5-48 48-48 48 21.5 48 48-21.5 48-48 48zm80-208H416V144h44.1l99.9 99.9V256z"},child:[]}]})(t)}function HX(){const{user:t}=Cl(),[e,n]=ot.useState([]),[l,d]=ot.useState(null),[y,A]=ot.useState({x:0,y:0}),s=ot.useRef(null);ot.useEffect(()=>{DX().then(async K=>{const se=await Promise.all(K.map(async ae=>{const me=await qb(ae.senderId);return{...ae,senderProfile:me}}));n(se)})},[]);const N=(K,se)=>{const ae=K.currentTarget.getBoundingClientRect();A({x:ae.left+window.scrollX,y:ae.top+ae.height+window.scrollY+5}),d(se)},j=async K=>{if(!(t!=null&&t.uid)){alert("User not found. Please log in.");return}const se=await MX(K,t.uid);if(se.success){alert("✅ Request sent successfully!"),n(me=>me.map(Ue=>Ue.id===K?{...Ue,requestedTravelers:[...Ue.requestedTravelers??[],{travelerId:t.uid}]}:Ue));const ae=da(Pn,"trips");await sI(ae,{deliveryId:K,travelerId:t.uid,status:"Pending",createdAt:Hs()})}else alert("❌ "+se.message)};return ot.useEffect(()=>{const K=se=>{s.current&&!s.current.contains(se.target)&&d(null)};return l&&document.addEventListener("mousedown",K),()=>{document.removeEventListener("mousedown",K)}},[l]),J.jsx("div",{className:"bg-gray-100 min-h-screen p-6 flex justify-center",children:J.jsxs("div",{className:"w-full max-w-2xl",children:[J.jsx("h1",{className:"text-2xl font-bold text-indigo-700 mb-4 text-center",children:"📦 Available Deliveries"}),e.length===0?J.jsx("p",{className:"text-gray-500 text-center",children:"No available deliveries."}):J.jsx("div",{className:"space-y-6",children:e.map(K=>{var se,ae,me,Ue,Xe,it,be,Ee,Ce,We,Ct,Ut,we,Ae,Ve,De,je,pt;return J.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-md border border-gray-300 relative",children:[J.jsxs("div",{className:"flex items-center mb-3 cursor-pointer relative",onClick:Ye=>N(Ye,K.senderProfile),children:[J.jsx("img",{src:((se=K.senderProfile)==null?void 0:se.profilePicture)||"/default-avatar.png",alt:(ae=K.senderProfile)==null?void 0:ae.fullName,className:"w-10 h-10 rounded-full border mr-3"}),J.jsxs("div",{children:[J.jsx("h3",{className:"text-md font-semibold text-gray-800",children:(me=K.senderProfile)==null?void 0:me.fullName}),J.jsxs("p",{className:"text-sm text-gray-500",children:["⭐ ",(Xe=(Ue=K.senderProfile)==null?void 0:Ue.rating)==null?void 0:Xe.overallRating," (",(be=(it=K.senderProfile)==null?void 0:it.rating)==null?void 0:be.totalReviews," reviews)"]})]})]}),J.jsxs("div",{className:"mb-3",children:[J.jsx("h3",{className:"text-lg font-bold text-gray-800",children:(Ee=K.itemDetails)==null?void 0:Ee.title}),J.jsx("p",{className:"text-gray-600 text-sm",children:(Ce=K.itemDetails)==null?void 0:Ce.description})]}),J.jsxs("div",{className:"text-gray-700 text-sm space-y-2",children:[J.jsxs("p",{className:"flex items-center",children:[J.jsx(qX,{className:"text-red-500 mr-2"}),J.jsx("strong",{children:"Pickup:"})," ",(Ct=(We=K.pickup)==null?void 0:We.location)==null?void 0:Ct.address,", ",(we=(Ut=K.pickup)==null?void 0:Ut.location)==null?void 0:we.city]}),J.jsxs("p",{className:"flex items-center",children:[J.jsx(GX,{className:"text-blue-500 mr-2"}),J.jsx("strong",{children:"Dropoff:"})," ",(Ve=(Ae=K.dropoff)==null?void 0:Ae.location)==null?void 0:Ve.address,", ",(je=(De=K.dropoff)==null?void 0:De.location)==null?void 0:je.city]}),J.jsxs("p",{className:"flex items-center",children:[J.jsx(jX,{className:"text-green-500 mr-2"}),J.jsx("strong",{children:"Category:"})," ",(pt=K.itemDetails)==null?void 0:pt.category]})]}),J.jsx("div",{className:"mt-4 flex justify-end",children:(K.requestedTravelers??[]).some(Ye=>Ye.travelerId===(t==null?void 0:t.uid))?J.jsx("button",{className:"bg-gray-400 text-white px-4 py-2 rounded-md cursor-not-allowed",children:"✅ Request Sent"}):J.jsx("button",{className:"bg-green-500 text-white px-4 py-2 rounded-md hover:bg-green-600 transition",onClick:()=>j(K.id),children:"✅ Accept Delivery"})})]},K.id)})})]})})}function $X(){const{user:t}=Cl(),e=$m(),[n,l]=ot.useState(1),[d,y]=ot.useState({title:"",description:"",category:"General Parcel",weight:{value:"",unit:"kg"},dimensions:{length:"",width:"",height:""},fragile:!1,pickup:{location:{address:"",city:"",lat:null,lng:null},flexibleTime:!1,pickupDate:"",pickupTime:""},dropoff:{location:{address:"",city:"",lat:null,lng:null},dropoffDate:"",dropoffTime:""},compensation:{amount:0,currency:"EUR",paymentMethod:"Cash"},escrow:!1,idVerificationRequired:!1,specialInstructions:""}),A=K=>{const{name:se,value:ae,type:me,checked:Ue}=K.target;y(Xe=>{const it=JSON.parse(JSON.stringify(Xe)),be=se.split(".");let Ee=it;for(let Ce=0;Ce<be.length-1;Ce++)Ee[be[Ce]]||(Ee[be[Ce]]={}),Ee=Ee[be[Ce]];return Ee[be[be.length-1]]=me==="checkbox"?Ue:ae||"",it})},s=(K,se)=>{if(!K||!se)return null;const ae=`${K}T${se}:00`,me=new Date(ae);return isNaN(me.getTime())?null:Vr.fromDate(me)},N=K=>(Object.keys(K).forEach(se=>{K[se]===void 0?K[se]="":typeof K[se]=="object"&&K[se]!==null&&N(K[se])}),K),j=async K=>{if(K.preventDefault(),!t){alert("❌ You must be logged in to create a delivery post.");return}const ae=["title","description","pickup.location.address","pickup.location.city","pickupDate","pickupTime","dropoff.location.address","dropoff.location.city","dropoffDate","dropoffTime","compensation.amount"].filter(it=>{const be=it.split(".");let Ee=d;return be.forEach(Ce=>Ee=(Ee==null?void 0:Ee[Ce])??null),!Ee||Ee===""});if(ae.length>0){alert("❌ Please fill in all required fields."),console.warn("Missing Fields:",ae);return}const me=s(d.pickupDate,d.pickupTime),Ue=s(d.dropoffDate,d.dropoffTime);if(!me||!Ue){alert("❌ Invalid Pickup or Dropoff date/time.");return}const Xe={title:d.title,description:d.description,category:d.category,weight:{value:parseFloat(d.weight.value)||0,unit:d.weight.unit},dimensions:{length:d.dimensions.length||"",width:d.dimensions.width||"",height:d.dimensions.height||""},fragile:d.fragile,pickup:{location:{address:d.pickup.location.address||"",city:d.pickup.location.city||"",lat:d.pickup.location.lat||"",lng:d.pickup.location.lng||""},date:me,flexibleTime:d.pickup.flexibleTime||!1},dropoff:{location:{address:d.dropoff.location.address||"",city:d.dropoff.location.city||"",lat:d.dropoff.location.lat||null,lng:d.dropoff.location.lng||null},preferredTime:Ue},compensation:{amount:parseFloat(d.compensation.amount),currency:d.compensation.currency,paymentMethod:d.compensation.paymentMethod},escrow:d.escrow,idVerificationRequired:d.idVerificationRequired,specialInstructions:d.specialInstructions||"",status:"Pending",createdAt:Vr.now(),updatedAt:Vr.now()};console.log("pickup in createDelvery:",Xe.pickup.date),console.log("pickUp FlexibleTime"+Xe.pickup.flexibleTime),console.log("pickup in createDelvery:",N(Xe.pickup.date));try{await IX(t.uid,N(Xe)),alert("✅ Delivery post created successfully!"),e("/available-deliveries")}catch(it){console.error("Error submitting form:",it),alert("❌ Error creating delivery. Please try again.")}};return J.jsx("div",{className:"bg-gray-100 min-h-screen flex items-center justify-center p-6",children:J.jsxs("div",{className:"bg-white rounded-xl shadow-md p-8 max-w-2xl w-full",children:[J.jsxs("div",{className:"flex justify-between mb-6 text-gray-600 cursor-pointer",children:[J.jsx("span",{onClick:()=>l(1),className:`font-bold ${n===1?"text-blue-600 underline":""}`,children:"1. Item Details"}),J.jsx("span",{onClick:()=>l(2),className:`font-bold ${n===2?"text-blue-600 underline":""}`,children:"2. Pickup & Dropoff"}),J.jsx("span",{onClick:()=>l(3),className:`font-bold ${n===3?"text-blue-600 underline":""}`,children:"3. Payment & Security"}),J.jsx("span",{onClick:()=>l(4),className:`font-bold ${n===4?"text-blue-600 underline":""}`,children:"4. Preview & Submit"})]}),J.jsxs("form",{onSubmit:j,className:"space-y-6",children:[n===1&&J.jsxs(J.Fragment,{children:[J.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Step 1: Item Details"}),J.jsxs("div",{className:"bg-gray-50 p-5 rounded-md shadow-sm mb-6 border border-gray-300",children:[J.jsx("label",{className:"text-gray-600 text-sm",children:"Item Title"}),J.jsx("input",{type:"text",name:"title",placeholder:"Enter item title",value:d.title,onChange:A,className:"w-full p-3 border rounded-md focus:ring focus:ring-blue-300 mb-3",required:!0}),J.jsx("label",{className:"text-gray-600 text-sm",children:"Item Description"}),J.jsx("textarea",{name:"description",placeholder:"Provide a brief description",value:d.description,onChange:A,className:"w-full p-3 border rounded-md focus:ring focus:ring-blue-300 mb-3",required:!0}),J.jsx("label",{className:"text-gray-600 text-sm",children:"Category"}),J.jsxs("select",{name:"category",value:d.category,onChange:A,className:"w-full p-3 border rounded-md focus:ring focus:ring-blue-300 mb-3",children:[J.jsx("option",{children:"General Parcel"}),J.jsx("option",{children:"Documents"}),J.jsx("option",{children:"Books"}),J.jsx("option",{children:"Household Items"}),J.jsx("option",{children:"Gifts"})]}),J.jsx("label",{className:"text-gray-600 text-sm",children:"Weight"}),J.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[J.jsx("input",{type:"number",name:"weight.value",placeholder:"Enter weight",value:d.weight.value,onChange:A,className:"w-3/4 p-3 border rounded-md focus:ring focus:ring-blue-300",required:!0}),J.jsxs("select",{name:"weight.unit",value:d.weight.unit,onChange:A,className:"w-1/4 p-3 border rounded-md focus:ring focus:ring-blue-300",children:[J.jsx("option",{children:"kg"}),J.jsx("option",{children:"g"}),J.jsx("option",{children:"lbs"})]})]}),J.jsx("label",{className:"text-gray-600 text-sm",children:"Dimensions (cm)"}),J.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-3",children:[J.jsx("input",{type:"number",name:"dimensions.length",placeholder:"Length",value:d.dimensions.length,onChange:A,className:"p-3 border rounded-md focus:ring focus:ring-blue-300"}),J.jsx("input",{type:"number",name:"dimensions.width",placeholder:"Width",value:d.dimensions.width,onChange:A,className:"p-3 border rounded-md focus:ring focus:ring-blue-300"}),J.jsx("input",{type:"number",name:"dimensions.height",placeholder:"Height",value:d.dimensions.height,onChange:A,className:"p-3 border rounded-md focus:ring focus:ring-blue-300"})]}),J.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[J.jsx("input",{type:"checkbox",name:"fragile",checked:d.fragile,onChange:A,className:"h-5 w-5 text-blue-500 border-gray-300 focus:ring focus:ring-blue-400"}),J.jsx("span",{className:"text-gray-700",children:"Is this item fragile?"})]})]}),J.jsx("button",{type:"button",onClick:()=>{if(!d.title||!d.description){alert("Please enter item title and description before proceeding.");return}l(2)},className:"w-full bg-blue-500 text-white py-3 rounded-md hover:bg-blue-600 transition",children:"Next Step ➡"})]}),n===2&&J.jsxs(J.Fragment,{children:[J.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Step 2: Pickup & Dropoff"}),J.jsxs("div",{className:"bg-gray-50 p-5 rounded-md shadow-sm mb-6 border border-gray-300",children:[J.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-3",children:"📍 Pickup Details"}),J.jsx("label",{className:"text-gray-600 text-sm",children:"Pickup Address"}),J.jsx("input",{type:"text",name:"pickup.location.address",placeholder:"Enter pickup address",value:d.pickup.location.address,onChange:A,className:"w-full p-3 border rounded-md focus:ring focus:ring-blue-300 mb-3",required:!0}),J.jsx("label",{className:"text-gray-600 text-sm",children:"Pickup City"}),J.jsx("input",{type:"text",name:"pickup.location.city",placeholder:"Enter city name",value:d.pickup.location.city,onChange:A,className:"w-full p-3 border rounded-md focus:ring focus:ring-blue-300 mb-3",required:!0}),J.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-2",children:[J.jsxs("div",{children:[J.jsx("label",{className:"text-gray-600 text-sm",children:"Pickup Date"}),J.jsx("input",{type:"date",name:"pickupDate",value:d.pickupDate,onChange:A,className:"w-full p-3 border rounded-md focus:ring focus:ring-blue-300",required:!0})]}),J.jsxs("div",{children:[J.jsx("label",{className:"text-gray-600 text-sm",children:"Pickup Time"}),J.jsx("input",{type:"time",name:"pickupTime",value:d.pickupTime,onChange:A,className:"w-full p-3 border rounded-md focus:ring focus:ring-blue-300",required:!0})]})]})]}),J.jsxs("div",{className:"bg-gray-50 p-5 rounded-md shadow-sm border border-gray-300",children:[J.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-3",children:"🚚 Dropoff Details"}),J.jsx("label",{className:"text-gray-600 text-sm",children:"Dropoff Address"}),J.jsx("input",{type:"text",name:"dropoff.location.address",placeholder:"Enter dropoff address",value:d.dropoff.location.address,onChange:A,className:"w-full p-3 border rounded-md focus:ring focus:ring-blue-300 mb-3",required:!0}),J.jsx("label",{className:"text-gray-600 text-sm",children:"Dropoff City"}),J.jsx("input",{type:"text",name:"dropoff.location.city",placeholder:"Enter city name",value:d.dropoff.location.city,onChange:A,className:"w-full p-3 border rounded-md focus:ring focus:ring-blue-300 mb-3",required:!0}),J.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-2",children:[J.jsxs("div",{children:[J.jsx("label",{className:"text-gray-600 text-sm",children:"Dropoff Date"}),J.jsx("input",{type:"date",name:"dropoffDate",value:d.dropoffDate,onChange:A,className:"w-full p-3 border rounded-md focus:ring focus:ring-blue-300",required:!0})]}),J.jsxs("div",{children:[J.jsx("label",{className:"text-gray-600 text-sm",children:"Dropoff Time"}),J.jsx("input",{type:"time",name:"dropoffTime",value:d.dropoffTime,onChange:A,className:"w-full p-3 border rounded-md focus:ring focus:ring-blue-300",required:!0})]})]})]}),J.jsx("button",{type:"button",onClick:()=>{if(!d.pickup.location.address||!d.pickupDate){alert("Please enter pickup location and date before proceeding.");return}l(3)},className:"w-full bg-blue-500 text-white py-3 rounded-md hover:bg-blue-600 transition",children:"Next Step ➡"})]}),n===3&&J.jsxs(J.Fragment,{children:[J.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Step 3: Payment & Security"}),J.jsxs("div",{className:"bg-gray-50 p-5 rounded-md shadow-sm mb-6 border border-gray-300",children:[J.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-3",children:"💰 Compensation Details"}),J.jsx("label",{className:"text-gray-600 text-sm",children:"Compensation Amount"}),J.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[J.jsx("input",{type:"number",name:"compensation.amount",placeholder:"Enter amount",value:d.compensation.amount,onChange:A,className:"w-3/4 p-3 border rounded-md focus:ring focus:ring-blue-300"}),J.jsxs("select",{name:"compensation.currency",value:d.compensation.currency,onChange:A,className:"w-1/4 p-3 border rounded-md focus:ring focus:ring-blue-300",children:[J.jsx("option",{value:"EUR",children:"€ EUR"}),J.jsx("option",{value:"USD",children:"$ USD"}),J.jsx("option",{value:"GBP",children:"£ GBP"}),J.jsx("option",{value:"INR",children:"₹ INR"})]})]}),J.jsx("label",{className:"text-gray-600 text-sm",children:"Payment Method"}),J.jsxs("select",{name:"compensation.paymentMethod",value:d.compensation.paymentMethod,onChange:A,className:"w-full p-3 border rounded-md focus:ring focus:ring-blue-300 mb-3",children:[J.jsx("option",{children:"Cash"}),J.jsx("option",{children:"Online Payment"}),J.jsx("option",{children:"Escrow"})]}),J.jsxs("label",{className:"flex items-center space-x-2 mt-3",children:[J.jsx("input",{type:"checkbox",name:"escrow",checked:d.escrow,onChange:A,className:"h-5 w-5 text-blue-500 border-gray-300 focus:ring focus:ring-blue-400"}),J.jsx("span",{className:"text-gray-700",children:"Use Escrow Payment for Secure Transactions"})]})]}),J.jsxs("div",{className:"bg-gray-50 p-5 rounded-md shadow-sm border border-gray-300",children:[J.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-3",children:"🔒 Security Settings"}),J.jsxs("label",{className:"flex items-center space-x-2",children:[J.jsx("input",{type:"checkbox",name:"idVerificationRequired",checked:d.idVerificationRequired,onChange:A,className:"h-5 w-5 text-blue-500 border-gray-300 focus:ring focus:ring-blue-400"}),J.jsx("span",{className:"text-gray-700",children:"Require ID Verification from Traveler"})]})]}),J.jsx("button",{type:"button",onClick:()=>l(4),className:"w-full bg-blue-500 text-white py-3 rounded-md hover:bg-blue-600 transition mt-6",children:"Next Step ➡"})]}),n===4&&J.jsxs(J.Fragment,{children:[J.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Step 4: Preview & Submit"}),J.jsxs("div",{className:"bg-gray-50 p-5 rounded-md shadow-sm border border-gray-300 mb-6",children:[J.jsxs("div",{className:"mb-5",children:[J.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-2",children:"📦 Item Details"}),J.jsxs("p",{children:[J.jsx("strong",{children:"Title:"})," ",d.title]}),J.jsxs("p",{children:[J.jsx("strong",{children:"Description:"})," ",d.description]}),J.jsxs("p",{children:[J.jsx("strong",{children:"Category:"})," ",d.category]}),J.jsxs("p",{children:[J.jsx("strong",{children:"Weight:"})," ",d.weight.value," ",d.weight.unit]}),J.jsxs("p",{children:[J.jsx("strong",{children:"Dimensions:"})," ",d.dimensions.length,"cm × ",d.dimensions.width,"cm × ",d.dimensions.height,"cm"]}),J.jsxs("p",{children:[J.jsx("strong",{children:"Fragile:"})," ",d.fragile?"Yes":"No"]})]}),J.jsxs("div",{className:"mb-5",children:[J.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-2",children:"📍 Pickup & Dropoff"}),J.jsxs("p",{children:[J.jsx("strong",{children:"Pickup Address:"})," ",d.pickup.location.address,", ",d.pickup.location.city]}),J.jsxs("p",{children:[J.jsx("strong",{children:"Pickup Date & Time:"})," ",d.pickupDate," at ",d.pickupTime]}),J.jsxs("p",{children:[J.jsx("strong",{children:"Dropoff Address:"})," ",d.dropoff.location.address,", ",d.dropoff.location.city]}),J.jsxs("p",{children:[J.jsx("strong",{children:"Dropoff Date & Time:"})," ",d.dropoffDate," at ",d.dropoffTime]})]}),J.jsxs("div",{children:[J.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-2",children:"💰 Payment & Security"}),J.jsxs("p",{children:[J.jsx("strong",{children:"Compensation:"})," €",d.compensation.amount]}),J.jsxs("p",{children:[J.jsx("strong",{children:"Payment Method:"})," ",d.compensation.paymentMethod]}),J.jsxs("p",{children:[J.jsx("strong",{children:"Escrow Payment:"})," ",d.escrow?"Enabled":"Not Used"]}),J.jsxs("p",{children:[J.jsx("strong",{children:"ID Verification Required:"})," ",d.idVerificationRequired?"Yes":"No"]})]})]}),J.jsxs("div",{className:"flex justify-between",children:[J.jsx("button",{type:"button",onClick:()=>l(3),className:"w-1/2 bg-gray-400 text-white py-3 rounded-md hover:bg-gray-500 transition mr-2",children:"⬅ Edit Payment"}),J.jsx("button",{type:"button",onClick:j,className:"w-1/2 bg-green-500 text-white py-3 rounded-md hover:bg-green-600 transition",children:"✅ Confirm & Submit"})]})]})]})]})})}function ZX({createdOrders:t,acceptedOrders:e}){const n=()=>{let l=0;return e.forEach(d=>{d.compensation&&d.compensation.amount&&(l+=parseFloat(d.compensation.amount))}),l.toFixed(2)};return J.jsxs("div",{children:[J.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-6",children:"Dashboard Overview"}),J.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[J.jsx("div",{className:"bg-white p-6 rounded-lg shadow",children:J.jsxs("div",{className:"flex items-center",children:[J.jsx("div",{className:"p-3 rounded-full bg-blue-100 text-blue-600 mr-4",children:J.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:J.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"})})}),J.jsxs("div",{children:[J.jsx("p",{className:"text-gray-500 text-sm",children:"Total Orders"}),J.jsx("p",{className:"text-2xl font-bold",children:t.length})]})]})}),J.jsx("div",{className:"bg-white p-6 rounded-lg shadow",children:J.jsxs("div",{className:"flex items-center",children:[J.jsx("div",{className:"p-3 rounded-full bg-green-100 text-green-600 mr-4",children:J.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:J.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),J.jsxs("div",{children:[J.jsx("p",{className:"text-gray-500 text-sm",children:"Total Earnings"}),J.jsxs("p",{className:"text-2xl font-bold",children:["€",n()]})]})]})}),J.jsx("div",{className:"bg-white p-6 rounded-lg shadow",children:J.jsxs("div",{className:"flex items-center",children:[J.jsx("div",{className:"p-3 rounded-full bg-purple-100 text-purple-600 mr-4",children:J.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:J.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),J.jsxs("div",{children:[J.jsx("p",{className:"text-gray-500 text-sm",children:"Completed Trips"}),J.jsx("p",{className:"text-2xl font-bold",children:e.filter(l=>l.status==="Completed").length})]})]})})]}),J.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden mb-6",children:[J.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:J.jsx("h2",{className:"font-semibold text-lg",children:"Recent Activity"})}),J.jsx("div",{className:"px-6 py-4",children:J.jsxs("div",{className:"space-y-4",children:[t.slice(0,3).map((l,d)=>{var y;return J.jsxs("div",{className:"flex items-start pb-4 border-b border-gray-100",children:[J.jsx("div",{className:"p-2 rounded-md bg-gray-100 mr-4",children:J.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:J.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"})})}),J.jsxs("div",{className:"flex-1",children:[J.jsx("p",{className:"font-medium",children:((y=l.itemDetails)==null?void 0:y.title)||"Package"}),J.jsxs("p",{className:"text-sm text-gray-500",children:["Status: ",l.status]})]}),J.jsx("div",{className:"text-right",children:J.jsx("span",{className:"inline-block px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-800",children:l.status})})]},l.id||d)}),t.length===0&&J.jsx("p",{className:"text-gray-500 text-center py-4",children:"No recent activity"})]})})]}),J.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[J.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:J.jsx("h2",{className:"font-semibold text-lg",children:"Quick Actions"})}),J.jsx("div",{className:"p-6",children:J.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[J.jsxs("button",{className:"flex flex-col items-center justify-center p-4 bg-indigo-50 rounded-lg hover:bg-indigo-100 transition",children:[J.jsx("svg",{className:"h-8 w-8 text-indigo-600 mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:J.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"})}),J.jsx("span",{className:"text-sm font-medium",children:"Create Order"})]}),J.jsxs("button",{className:"flex flex-col items-center justify-center p-4 bg-green-50 rounded-lg hover:bg-green-100 transition",children:[J.jsx("svg",{className:"h-8 w-8 text-green-600 mb-2",fill:"none",viewBox:"0 0 24 24 24",stroke:"currentColor",children:J.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 8h2a2 2 0 012 2v6a2 2 0 01-2 2h-2v4l-4-4H9a1.994 1.994 0 01-1.414-.586m0 0L11 14h4a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2v4l.586-.586z"})}),J.jsx("span",{className:"text-sm font-medium",children:"Messages"})]}),J.jsxs("button",{className:"flex flex-col items-center justify-center p-4 bg-yellow-50 rounded-lg hover:bg-yellow-100 transition",children:[J.jsx("svg",{className:"h-8 w-8 text-yellow-600 mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:J.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),J.jsx("span",{className:"text-sm font-medium",children:"Track Orders"})]}),J.jsxs("button",{className:"flex flex-col items-center justify-center p-4 bg-purple-50 rounded-lg hover:bg-purple-100 transition",children:[J.jsx("svg",{className:"h-8 w-8 text-purple-600 mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:J.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2-5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 00-1.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),J.jsx("span",{className:"text-sm font-medium",children:"View Reports"})]})]})})]})]})}const WX=async(t,e)=>{if(!t||!e||t===e)return console.error("❌ Invalid senderId or travelerId. They must be different."),null;const n=[t,e].sort().join("_"),l=Gs(Pn,"chats",n);try{return(await fu(l)).exists()?console.log(`📢 Chat already exists: ${n}`):(console.log(`📢 Creating new chat: ${n}`),await A0(l,{participants:[t,e],lastUpdated:Hs()})),n}catch(d){return console.error("❌ Error getting/creating chat:",d),null}},XX=async(t,e,n)=>{if(!n.trim())return;if(!t||!e){console.error("❌ Invalid chatId or senderId in sendMessage.");return}const l=da(Pn,"chats",t,"messages");try{await sI(l,{senderId:e,text:n,timestamp:Hs()}),console.log(`✅ Message sent to chat ${t}: ${n}`),await A0(Gs(Pn,"chats",t),{lastUpdated:Hs()},{merge:!0})}catch(d){console.error("❌ Error sending message:",d)}},YX=(t,e)=>{if(!t)return console.error("❌ listenForMessages called with undefined chatId."),()=>{};console.log(`📡 Setting up real-time listener for chat: ${t}`);const n=da(Pn,"chats",t,"messages"),l=Wo(n,tX("timestamp","asc"));return H1(l,d=>{d.empty?console.log(`🚫 No messages found for chat ${t}`):console.log(`📩 Received ${d.docs.length} messages for chat ${t}`);const y=d.docs.map(A=>({id:A.id,...A.data()}));e(y)},d=>{console.error("❌ Error fetching messages:",d)})};function rF({senderId:t,travelerId:e,deliveryTitle:n,closeChat:l}){const[d,y]=ot.useState([]),[A,s]=ot.useState(""),[N,j]=ot.useState(null),[K,se]=ot.useState("Loading..."),ae=ot.useRef(null),me=ot.useRef(null);ot.useEffect(()=>{const Xe=async()=>{try{const be=await qb(e);se((be==null?void 0:be.fullName)||"Unknown User")}catch(be){console.error("❌ Error fetching receiver name:",be)}},it=async()=>{const be=await WX(t,e);j(be),YX(be,y)};e&&(Xe(),it())},[t,e]);const Ue=async()=>{A.trim()!==""&&(await XX(N,t,A),s(""),setTimeout(()=>{var Xe;(Xe=me.current)==null||Xe.scrollIntoView({behavior:"smooth"})},100))};return J.jsxs("div",{className:"fixed bottom-4 right-4 w-80 bg-white rounded-lg shadow-lg border border-gray-300",children:[J.jsxs("div",{className:"p-3 bg-blue-600 text-white flex justify-between items-center rounded-t-lg",children:[J.jsxs("span",{className:"font-semibold",children:["Chat with ",K]}),J.jsx("button",{onClick:l,className:"text-white text-xl hover:opacity-80 transition",children:"✖"})]}),J.jsxs("div",{className:"p-4 h-64 overflow-y-auto text-sm text-gray-800",children:[d.length===0?J.jsxs("p",{className:"text-gray-500",children:["Start a conversation with ",K,' about "',n,'".']}):d.map((Xe,it)=>J.jsxs("div",{className:`mb-2 p-2 rounded-lg ${Xe.senderId===t?"bg-blue-100 text-blue-700 self-end":"bg-gray-200 text-gray-800 self-start"}`,children:[J.jsxs("span",{className:"font-semibold",children:[Xe.senderId===t?"You":K,":"]})," ",Xe.text]},it)),J.jsx("div",{ref:me})]}),J.jsxs("div",{className:"p-2 border-t border-gray-200 flex items-center",children:[J.jsx("textarea",{ref:ae,rows:"1",className:"flex-1 p-2 text-sm border rounded-md outline-none resize-none overflow-hidden",value:A,onChange:Xe=>s(Xe.target.value),placeholder:"Type your message..."}),J.jsx("button",{onClick:Ue,className:"bg-blue-500 text-white px-3 py-1 ml-2 rounded-md hover:bg-blue-600 transition",children:"➤"})]})]})}var sF={exports:{}};(function(t,e){(function(n,l){t.exports=l()})(eV,function(){var n,l,d;function y(s,N){if(!n)n=N;else if(!l)l=N;else{var j="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+n+")(sharedChunk); ("+l+")(sharedChunk); self.onerror = null;",K={};n(K),d=N(K),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(d.workerUrl=window.URL.createObjectURL(new Blob([j],{type:"text/javascript"})))}}y(["exports"],function(s){function N(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var j,K={},se={};function ae(){if(j)return se;j=1,Object.defineProperty(se,"__esModule",{value:!0}),se.setMatrixArrayType=function(m){se.ARRAY_TYPE=i=m},se.toRadian=function(m){return m*u},se.equals=function(m,h){return Math.abs(m-h)<=c*Math.max(1,Math.abs(m),Math.abs(h))},se.RANDOM=se.ARRAY_TYPE=se.EPSILON=void 0;var c=1e-6;se.EPSILON=c;var i=typeof Float32Array<"u"?Float32Array:Array;se.ARRAY_TYPE=i;var a=Math.random;se.RANDOM=a;var u=Math.PI/180;return Math.hypot||(Math.hypot=function(){for(var m=0,h=arguments.length;h--;)m+=arguments[h]*arguments[h];return Math.sqrt(m)}),se}var me,Ue={};function Xe(){if(me)return Ue;function c(h){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(g){return typeof g}:function(g){return g&&typeof Symbol=="function"&&g.constructor===Symbol&&g!==Symbol.prototype?"symbol":typeof g},c(h)}me=1,Object.defineProperty(Ue,"__esModule",{value:!0}),Ue.create=function(){var h=new i.ARRAY_TYPE(4);return i.ARRAY_TYPE!=Float32Array&&(h[1]=0,h[2]=0),h[0]=1,h[3]=1,h},Ue.clone=function(h){var g=new i.ARRAY_TYPE(4);return g[0]=h[0],g[1]=h[1],g[2]=h[2],g[3]=h[3],g},Ue.copy=function(h,g){return h[0]=g[0],h[1]=g[1],h[2]=g[2],h[3]=g[3],h},Ue.identity=function(h){return h[0]=1,h[1]=0,h[2]=0,h[3]=1,h},Ue.fromValues=function(h,g,b,E){var R=new i.ARRAY_TYPE(4);return R[0]=h,R[1]=g,R[2]=b,R[3]=E,R},Ue.set=function(h,g,b,E,R){return h[0]=g,h[1]=b,h[2]=E,h[3]=R,h},Ue.transpose=function(h,g){if(h===g){var b=g[1];h[1]=g[2],h[2]=b}else h[0]=g[0],h[1]=g[2],h[2]=g[1],h[3]=g[3];return h},Ue.invert=function(h,g){var b=g[0],E=g[1],R=g[2],v=g[3],S=b*v-R*E;return S?(h[0]=v*(S=1/S),h[1]=-E*S,h[2]=-R*S,h[3]=b*S,h):null},Ue.adjoint=function(h,g){var b=g[0];return h[0]=g[3],h[1]=-g[1],h[2]=-g[2],h[3]=b,h},Ue.determinant=function(h){return h[0]*h[3]-h[2]*h[1]},Ue.multiply=u,Ue.rotate=function(h,g,b){var E=g[0],R=g[1],v=g[2],S=g[3],C=Math.sin(b),T=Math.cos(b);return h[0]=E*T+v*C,h[1]=R*T+S*C,h[2]=E*-C+v*T,h[3]=R*-C+S*T,h},Ue.scale=function(h,g,b){var E=g[1],R=g[2],v=g[3],S=b[0],C=b[1];return h[0]=g[0]*S,h[1]=E*S,h[2]=R*C,h[3]=v*C,h},Ue.fromRotation=function(h,g){var b=Math.sin(g),E=Math.cos(g);return h[0]=E,h[1]=b,h[2]=-b,h[3]=E,h},Ue.fromScaling=function(h,g){return h[0]=g[0],h[1]=0,h[2]=0,h[3]=g[1],h},Ue.str=function(h){return"mat2("+h[0]+", "+h[1]+", "+h[2]+", "+h[3]+")"},Ue.frob=function(h){return Math.hypot(h[0],h[1],h[2],h[3])},Ue.LDU=function(h,g,b,E){return h[2]=E[2]/E[0],b[0]=E[0],b[1]=E[1],b[3]=E[3]-h[2]*b[1],[h,g,b]},Ue.add=function(h,g,b){return h[0]=g[0]+b[0],h[1]=g[1]+b[1],h[2]=g[2]+b[2],h[3]=g[3]+b[3],h},Ue.subtract=m,Ue.exactEquals=function(h,g){return h[0]===g[0]&&h[1]===g[1]&&h[2]===g[2]&&h[3]===g[3]},Ue.equals=function(h,g){var b=h[0],E=h[1],R=h[2],v=h[3],S=g[0],C=g[1],T=g[2],I=g[3];return Math.abs(b-S)<=i.EPSILON*Math.max(1,Math.abs(b),Math.abs(S))&&Math.abs(E-C)<=i.EPSILON*Math.max(1,Math.abs(E),Math.abs(C))&&Math.abs(R-T)<=i.EPSILON*Math.max(1,Math.abs(R),Math.abs(T))&&Math.abs(v-I)<=i.EPSILON*Math.max(1,Math.abs(v),Math.abs(I))},Ue.multiplyScalar=function(h,g,b){return h[0]=g[0]*b,h[1]=g[1]*b,h[2]=g[2]*b,h[3]=g[3]*b,h},Ue.multiplyScalarAndAdd=function(h,g,b,E){return h[0]=g[0]+b[0]*E,h[1]=g[1]+b[1]*E,h[2]=g[2]+b[2]*E,h[3]=g[3]+b[3]*E,h},Ue.sub=Ue.mul=void 0;var i=function(h,g){if(h&&h.__esModule)return h;if(h===null||c(h)!=="object"&&typeof h!="function")return{default:h};var b=a(void 0);if(b&&b.has(h))return b.get(h);var E={},R=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var v in h)if(v!=="default"&&Object.prototype.hasOwnProperty.call(h,v)){var S=R?Object.getOwnPropertyDescriptor(h,v):null;S&&(S.get||S.set)?Object.defineProperty(E,v,S):E[v]=h[v]}return E.default=h,b&&b.set(h,E),E}(ae());function a(h){if(typeof WeakMap!="function")return null;var g=new WeakMap,b=new WeakMap;return(a=function(E){return E?b:g})(h)}function u(h,g,b){var E=g[0],R=g[1],v=g[2],S=g[3],C=b[0],T=b[1],I=b[2],D=b[3];return h[0]=E*C+v*T,h[1]=R*C+S*T,h[2]=E*I+v*D,h[3]=R*I+S*D,h}function m(h,g,b){return h[0]=g[0]-b[0],h[1]=g[1]-b[1],h[2]=g[2]-b[2],h[3]=g[3]-b[3],h}return Ue.mul=u,Ue.sub=m,Ue}var it,be={};function Ee(){if(it)return be;function c(h){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(g){return typeof g}:function(g){return g&&typeof Symbol=="function"&&g.constructor===Symbol&&g!==Symbol.prototype?"symbol":typeof g},c(h)}it=1,Object.defineProperty(be,"__esModule",{value:!0}),be.create=function(){var h=new i.ARRAY_TYPE(6);return i.ARRAY_TYPE!=Float32Array&&(h[1]=0,h[2]=0,h[4]=0,h[5]=0),h[0]=1,h[3]=1,h},be.clone=function(h){var g=new i.ARRAY_TYPE(6);return g[0]=h[0],g[1]=h[1],g[2]=h[2],g[3]=h[3],g[4]=h[4],g[5]=h[5],g},be.copy=function(h,g){return h[0]=g[0],h[1]=g[1],h[2]=g[2],h[3]=g[3],h[4]=g[4],h[5]=g[5],h},be.identity=function(h){return h[0]=1,h[1]=0,h[2]=0,h[3]=1,h[4]=0,h[5]=0,h},be.fromValues=function(h,g,b,E,R,v){var S=new i.ARRAY_TYPE(6);return S[0]=h,S[1]=g,S[2]=b,S[3]=E,S[4]=R,S[5]=v,S},be.set=function(h,g,b,E,R,v,S){return h[0]=g,h[1]=b,h[2]=E,h[3]=R,h[4]=v,h[5]=S,h},be.invert=function(h,g){var b=g[0],E=g[1],R=g[2],v=g[3],S=g[4],C=g[5],T=b*v-E*R;return T?(h[0]=v*(T=1/T),h[1]=-E*T,h[2]=-R*T,h[3]=b*T,h[4]=(R*C-v*S)*T,h[5]=(E*S-b*C)*T,h):null},be.determinant=function(h){return h[0]*h[3]-h[1]*h[2]},be.multiply=u,be.rotate=function(h,g,b){var E=g[0],R=g[1],v=g[2],S=g[3],C=g[4],T=g[5],I=Math.sin(b),D=Math.cos(b);return h[0]=E*D+v*I,h[1]=R*D+S*I,h[2]=E*-I+v*D,h[3]=R*-I+S*D,h[4]=C,h[5]=T,h},be.scale=function(h,g,b){var E=g[1],R=g[2],v=g[3],S=g[4],C=g[5],T=b[0],I=b[1];return h[0]=g[0]*T,h[1]=E*T,h[2]=R*I,h[3]=v*I,h[4]=S,h[5]=C,h},be.translate=function(h,g,b){var E=g[0],R=g[1],v=g[2],S=g[3],C=g[4],T=g[5],I=b[0],D=b[1];return h[0]=E,h[1]=R,h[2]=v,h[3]=S,h[4]=E*I+v*D+C,h[5]=R*I+S*D+T,h},be.fromRotation=function(h,g){var b=Math.sin(g),E=Math.cos(g);return h[0]=E,h[1]=b,h[2]=-b,h[3]=E,h[4]=0,h[5]=0,h},be.fromScaling=function(h,g){return h[0]=g[0],h[1]=0,h[2]=0,h[3]=g[1],h[4]=0,h[5]=0,h},be.fromTranslation=function(h,g){return h[0]=1,h[1]=0,h[2]=0,h[3]=1,h[4]=g[0],h[5]=g[1],h},be.str=function(h){return"mat2d("+h[0]+", "+h[1]+", "+h[2]+", "+h[3]+", "+h[4]+", "+h[5]+")"},be.frob=function(h){return Math.hypot(h[0],h[1],h[2],h[3],h[4],h[5],1)},be.add=function(h,g,b){return h[0]=g[0]+b[0],h[1]=g[1]+b[1],h[2]=g[2]+b[2],h[3]=g[3]+b[3],h[4]=g[4]+b[4],h[5]=g[5]+b[5],h},be.subtract=m,be.multiplyScalar=function(h,g,b){return h[0]=g[0]*b,h[1]=g[1]*b,h[2]=g[2]*b,h[3]=g[3]*b,h[4]=g[4]*b,h[5]=g[5]*b,h},be.multiplyScalarAndAdd=function(h,g,b,E){return h[0]=g[0]+b[0]*E,h[1]=g[1]+b[1]*E,h[2]=g[2]+b[2]*E,h[3]=g[3]+b[3]*E,h[4]=g[4]+b[4]*E,h[5]=g[5]+b[5]*E,h},be.exactEquals=function(h,g){return h[0]===g[0]&&h[1]===g[1]&&h[2]===g[2]&&h[3]===g[3]&&h[4]===g[4]&&h[5]===g[5]},be.equals=function(h,g){var b=h[0],E=h[1],R=h[2],v=h[3],S=h[4],C=h[5],T=g[0],I=g[1],D=g[2],k=g[3],F=g[4],q=g[5];return Math.abs(b-T)<=i.EPSILON*Math.max(1,Math.abs(b),Math.abs(T))&&Math.abs(E-I)<=i.EPSILON*Math.max(1,Math.abs(E),Math.abs(I))&&Math.abs(R-D)<=i.EPSILON*Math.max(1,Math.abs(R),Math.abs(D))&&Math.abs(v-k)<=i.EPSILON*Math.max(1,Math.abs(v),Math.abs(k))&&Math.abs(S-F)<=i.EPSILON*Math.max(1,Math.abs(S),Math.abs(F))&&Math.abs(C-q)<=i.EPSILON*Math.max(1,Math.abs(C),Math.abs(q))},be.sub=be.mul=void 0;var i=function(h,g){if(h&&h.__esModule)return h;if(h===null||c(h)!=="object"&&typeof h!="function")return{default:h};var b=a(void 0);if(b&&b.has(h))return b.get(h);var E={},R=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var v in h)if(v!=="default"&&Object.prototype.hasOwnProperty.call(h,v)){var S=R?Object.getOwnPropertyDescriptor(h,v):null;S&&(S.get||S.set)?Object.defineProperty(E,v,S):E[v]=h[v]}return E.default=h,b&&b.set(h,E),E}(ae());function a(h){if(typeof WeakMap!="function")return null;var g=new WeakMap,b=new WeakMap;return(a=function(E){return E?b:g})(h)}function u(h,g,b){var E=g[0],R=g[1],v=g[2],S=g[3],C=g[4],T=g[5],I=b[0],D=b[1],k=b[2],F=b[3],q=b[4],H=b[5];return h[0]=E*I+v*D,h[1]=R*I+S*D,h[2]=E*k+v*F,h[3]=R*k+S*F,h[4]=E*q+v*H+C,h[5]=R*q+S*H+T,h}function m(h,g,b){return h[0]=g[0]-b[0],h[1]=g[1]-b[1],h[2]=g[2]-b[2],h[3]=g[3]-b[3],h[4]=g[4]-b[4],h[5]=g[5]-b[5],h}return be.mul=u,be.sub=m,be}var Ce,We={};function Ct(){if(Ce)return We;function c(h){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(g){return typeof g}:function(g){return g&&typeof Symbol=="function"&&g.constructor===Symbol&&g!==Symbol.prototype?"symbol":typeof g},c(h)}Ce=1,Object.defineProperty(We,"__esModule",{value:!0}),We.create=function(){var h=new i.ARRAY_TYPE(9);return i.ARRAY_TYPE!=Float32Array&&(h[1]=0,h[2]=0,h[3]=0,h[5]=0,h[6]=0,h[7]=0),h[0]=1,h[4]=1,h[8]=1,h},We.fromMat4=function(h,g){return h[0]=g[0],h[1]=g[1],h[2]=g[2],h[3]=g[4],h[4]=g[5],h[5]=g[6],h[6]=g[8],h[7]=g[9],h[8]=g[10],h},We.clone=function(h){var g=new i.ARRAY_TYPE(9);return g[0]=h[0],g[1]=h[1],g[2]=h[2],g[3]=h[3],g[4]=h[4],g[5]=h[5],g[6]=h[6],g[7]=h[7],g[8]=h[8],g},We.copy=function(h,g){return h[0]=g[0],h[1]=g[1],h[2]=g[2],h[3]=g[3],h[4]=g[4],h[5]=g[5],h[6]=g[6],h[7]=g[7],h[8]=g[8],h},We.fromValues=function(h,g,b,E,R,v,S,C,T){var I=new i.ARRAY_TYPE(9);return I[0]=h,I[1]=g,I[2]=b,I[3]=E,I[4]=R,I[5]=v,I[6]=S,I[7]=C,I[8]=T,I},We.set=function(h,g,b,E,R,v,S,C,T,I){return h[0]=g,h[1]=b,h[2]=E,h[3]=R,h[4]=v,h[5]=S,h[6]=C,h[7]=T,h[8]=I,h},We.identity=function(h){return h[0]=1,h[1]=0,h[2]=0,h[3]=0,h[4]=1,h[5]=0,h[6]=0,h[7]=0,h[8]=1,h},We.transpose=function(h,g){if(h===g){var b=g[1],E=g[2],R=g[5];h[1]=g[3],h[2]=g[6],h[3]=b,h[5]=g[7],h[6]=E,h[7]=R}else h[0]=g[0],h[1]=g[3],h[2]=g[6],h[3]=g[1],h[4]=g[4],h[5]=g[7],h[6]=g[2],h[7]=g[5],h[8]=g[8];return h},We.invert=function(h,g){var b=g[0],E=g[1],R=g[2],v=g[3],S=g[4],C=g[5],T=g[6],I=g[7],D=g[8],k=D*S-C*I,F=-D*v+C*T,q=I*v-S*T,H=b*k+E*F+R*q;return H?(h[0]=k*(H=1/H),h[1]=(-D*E+R*I)*H,h[2]=(C*E-R*S)*H,h[3]=F*H,h[4]=(D*b-R*T)*H,h[5]=(-C*b+R*v)*H,h[6]=q*H,h[7]=(-I*b+E*T)*H,h[8]=(S*b-E*v)*H,h):null},We.adjoint=function(h,g){var b=g[0],E=g[1],R=g[2],v=g[3],S=g[4],C=g[5],T=g[6],I=g[7],D=g[8];return h[0]=S*D-C*I,h[1]=R*I-E*D,h[2]=E*C-R*S,h[3]=C*T-v*D,h[4]=b*D-R*T,h[5]=R*v-b*C,h[6]=v*I-S*T,h[7]=E*T-b*I,h[8]=b*S-E*v,h},We.determinant=function(h){var g=h[3],b=h[4],E=h[5],R=h[6],v=h[7],S=h[8];return h[0]*(S*b-E*v)+h[1]*(-S*g+E*R)+h[2]*(v*g-b*R)},We.multiply=u,We.translate=function(h,g,b){var E=g[0],R=g[1],v=g[2],S=g[3],C=g[4],T=g[5],I=g[6],D=g[7],k=g[8],F=b[0],q=b[1];return h[0]=E,h[1]=R,h[2]=v,h[3]=S,h[4]=C,h[5]=T,h[6]=F*E+q*S+I,h[7]=F*R+q*C+D,h[8]=F*v+q*T+k,h},We.rotate=function(h,g,b){var E=g[0],R=g[1],v=g[2],S=g[3],C=g[4],T=g[5],I=g[6],D=g[7],k=g[8],F=Math.sin(b),q=Math.cos(b);return h[0]=q*E+F*S,h[1]=q*R+F*C,h[2]=q*v+F*T,h[3]=q*S-F*E,h[4]=q*C-F*R,h[5]=q*T-F*v,h[6]=I,h[7]=D,h[8]=k,h},We.scale=function(h,g,b){var E=b[0],R=b[1];return h[0]=E*g[0],h[1]=E*g[1],h[2]=E*g[2],h[3]=R*g[3],h[4]=R*g[4],h[5]=R*g[5],h[6]=g[6],h[7]=g[7],h[8]=g[8],h},We.fromTranslation=function(h,g){return h[0]=1,h[1]=0,h[2]=0,h[3]=0,h[4]=1,h[5]=0,h[6]=g[0],h[7]=g[1],h[8]=1,h},We.fromRotation=function(h,g){var b=Math.sin(g),E=Math.cos(g);return h[0]=E,h[1]=b,h[2]=0,h[3]=-b,h[4]=E,h[5]=0,h[6]=0,h[7]=0,h[8]=1,h},We.fromScaling=function(h,g){return h[0]=g[0],h[1]=0,h[2]=0,h[3]=0,h[4]=g[1],h[5]=0,h[6]=0,h[7]=0,h[8]=1,h},We.fromMat2d=function(h,g){return h[0]=g[0],h[1]=g[1],h[2]=0,h[3]=g[2],h[4]=g[3],h[5]=0,h[6]=g[4],h[7]=g[5],h[8]=1,h},We.fromQuat=function(h,g){var b=g[0],E=g[1],R=g[2],v=g[3],S=b+b,C=E+E,T=R+R,I=b*S,D=E*S,k=E*C,F=R*S,q=R*C,H=R*T,U=v*S,$=v*C,Y=v*T;return h[0]=1-k-H,h[3]=D-Y,h[6]=F+$,h[1]=D+Y,h[4]=1-I-H,h[7]=q-U,h[2]=F-$,h[5]=q+U,h[8]=1-I-k,h},We.normalFromMat4=function(h,g){var b=g[0],E=g[1],R=g[2],v=g[3],S=g[4],C=g[5],T=g[6],I=g[7],D=g[8],k=g[9],F=g[10],q=g[11],H=g[12],U=g[13],$=g[14],Y=g[15],ie=b*C-E*S,he=b*T-R*S,ue=b*I-v*S,ce=E*T-R*C,Ie=E*I-v*C,de=R*I-v*T,Me=D*U-k*H,ze=D*$-F*H,Pe=D*Y-q*H,Ne=k*$-F*U,qe=k*Y-q*U,Ze=F*Y-q*$,Be=ie*Ze-he*qe+ue*Ne+ce*Pe-Ie*ze+de*Me;return Be?(h[0]=(C*Ze-T*qe+I*Ne)*(Be=1/Be),h[1]=(T*Pe-S*Ze-I*ze)*Be,h[2]=(S*qe-C*Pe+I*Me)*Be,h[3]=(R*qe-E*Ze-v*Ne)*Be,h[4]=(b*Ze-R*Pe+v*ze)*Be,h[5]=(E*Pe-b*qe-v*Me)*Be,h[6]=(U*de-$*Ie+Y*ce)*Be,h[7]=($*ue-H*de-Y*he)*Be,h[8]=(H*Ie-U*ue+Y*ie)*Be,h):null},We.projection=function(h,g,b){return h[0]=2/g,h[1]=0,h[2]=0,h[3]=0,h[4]=-2/b,h[5]=0,h[6]=-1,h[7]=1,h[8]=1,h},We.str=function(h){return"mat3("+h[0]+", "+h[1]+", "+h[2]+", "+h[3]+", "+h[4]+", "+h[5]+", "+h[6]+", "+h[7]+", "+h[8]+")"},We.frob=function(h){return Math.hypot(h[0],h[1],h[2],h[3],h[4],h[5],h[6],h[7],h[8])},We.add=function(h,g,b){return h[0]=g[0]+b[0],h[1]=g[1]+b[1],h[2]=g[2]+b[2],h[3]=g[3]+b[3],h[4]=g[4]+b[4],h[5]=g[5]+b[5],h[6]=g[6]+b[6],h[7]=g[7]+b[7],h[8]=g[8]+b[8],h},We.subtract=m,We.multiplyScalar=function(h,g,b){return h[0]=g[0]*b,h[1]=g[1]*b,h[2]=g[2]*b,h[3]=g[3]*b,h[4]=g[4]*b,h[5]=g[5]*b,h[6]=g[6]*b,h[7]=g[7]*b,h[8]=g[8]*b,h},We.multiplyScalarAndAdd=function(h,g,b,E){return h[0]=g[0]+b[0]*E,h[1]=g[1]+b[1]*E,h[2]=g[2]+b[2]*E,h[3]=g[3]+b[3]*E,h[4]=g[4]+b[4]*E,h[5]=g[5]+b[5]*E,h[6]=g[6]+b[6]*E,h[7]=g[7]+b[7]*E,h[8]=g[8]+b[8]*E,h},We.exactEquals=function(h,g){return h[0]===g[0]&&h[1]===g[1]&&h[2]===g[2]&&h[3]===g[3]&&h[4]===g[4]&&h[5]===g[5]&&h[6]===g[6]&&h[7]===g[7]&&h[8]===g[8]},We.equals=function(h,g){var b=h[0],E=h[1],R=h[2],v=h[3],S=h[4],C=h[5],T=h[6],I=h[7],D=h[8],k=g[0],F=g[1],q=g[2],H=g[3],U=g[4],$=g[5],Y=g[6],ie=g[7],he=g[8];return Math.abs(b-k)<=i.EPSILON*Math.max(1,Math.abs(b),Math.abs(k))&&Math.abs(E-F)<=i.EPSILON*Math.max(1,Math.abs(E),Math.abs(F))&&Math.abs(R-q)<=i.EPSILON*Math.max(1,Math.abs(R),Math.abs(q))&&Math.abs(v-H)<=i.EPSILON*Math.max(1,Math.abs(v),Math.abs(H))&&Math.abs(S-U)<=i.EPSILON*Math.max(1,Math.abs(S),Math.abs(U))&&Math.abs(C-$)<=i.EPSILON*Math.max(1,Math.abs(C),Math.abs($))&&Math.abs(T-Y)<=i.EPSILON*Math.max(1,Math.abs(T),Math.abs(Y))&&Math.abs(I-ie)<=i.EPSILON*Math.max(1,Math.abs(I),Math.abs(ie))&&Math.abs(D-he)<=i.EPSILON*Math.max(1,Math.abs(D),Math.abs(he))},We.sub=We.mul=void 0;var i=function(h,g){if(h&&h.__esModule)return h;if(h===null||c(h)!=="object"&&typeof h!="function")return{default:h};var b=a(void 0);if(b&&b.has(h))return b.get(h);var E={},R=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var v in h)if(v!=="default"&&Object.prototype.hasOwnProperty.call(h,v)){var S=R?Object.getOwnPropertyDescriptor(h,v):null;S&&(S.get||S.set)?Object.defineProperty(E,v,S):E[v]=h[v]}return E.default=h,b&&b.set(h,E),E}(ae());function a(h){if(typeof WeakMap!="function")return null;var g=new WeakMap,b=new WeakMap;return(a=function(E){return E?b:g})(h)}function u(h,g,b){var E=g[0],R=g[1],v=g[2],S=g[3],C=g[4],T=g[5],I=g[6],D=g[7],k=g[8],F=b[0],q=b[1],H=b[2],U=b[3],$=b[4],Y=b[5],ie=b[6],he=b[7],ue=b[8];return h[0]=F*E+q*S+H*I,h[1]=F*R+q*C+H*D,h[2]=F*v+q*T+H*k,h[3]=U*E+$*S+Y*I,h[4]=U*R+$*C+Y*D,h[5]=U*v+$*T+Y*k,h[6]=ie*E+he*S+ue*I,h[7]=ie*R+he*C+ue*D,h[8]=ie*v+he*T+ue*k,h}function m(h,g,b){return h[0]=g[0]-b[0],h[1]=g[1]-b[1],h[2]=g[2]-b[2],h[3]=g[3]-b[3],h[4]=g[4]-b[4],h[5]=g[5]-b[5],h[6]=g[6]-b[6],h[7]=g[7]-b[7],h[8]=g[8]-b[8],h}return We.mul=u,We.sub=m,We}var Ut,we={};function Ae(){if(Ut)return we;function c(v){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(S){return typeof S}:function(S){return S&&typeof Symbol=="function"&&S.constructor===Symbol&&S!==Symbol.prototype?"symbol":typeof S},c(v)}Ut=1,Object.defineProperty(we,"__esModule",{value:!0}),we.create=function(){var v=new i.ARRAY_TYPE(16);return i.ARRAY_TYPE!=Float32Array&&(v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[11]=0,v[12]=0,v[13]=0,v[14]=0),v[0]=1,v[5]=1,v[10]=1,v[15]=1,v},we.clone=function(v){var S=new i.ARRAY_TYPE(16);return S[0]=v[0],S[1]=v[1],S[2]=v[2],S[3]=v[3],S[4]=v[4],S[5]=v[5],S[6]=v[6],S[7]=v[7],S[8]=v[8],S[9]=v[9],S[10]=v[10],S[11]=v[11],S[12]=v[12],S[13]=v[13],S[14]=v[14],S[15]=v[15],S},we.copy=function(v,S){return v[0]=S[0],v[1]=S[1],v[2]=S[2],v[3]=S[3],v[4]=S[4],v[5]=S[5],v[6]=S[6],v[7]=S[7],v[8]=S[8],v[9]=S[9],v[10]=S[10],v[11]=S[11],v[12]=S[12],v[13]=S[13],v[14]=S[14],v[15]=S[15],v},we.fromValues=function(v,S,C,T,I,D,k,F,q,H,U,$,Y,ie,he,ue){var ce=new i.ARRAY_TYPE(16);return ce[0]=v,ce[1]=S,ce[2]=C,ce[3]=T,ce[4]=I,ce[5]=D,ce[6]=k,ce[7]=F,ce[8]=q,ce[9]=H,ce[10]=U,ce[11]=$,ce[12]=Y,ce[13]=ie,ce[14]=he,ce[15]=ue,ce},we.set=function(v,S,C,T,I,D,k,F,q,H,U,$,Y,ie,he,ue,ce){return v[0]=S,v[1]=C,v[2]=T,v[3]=I,v[4]=D,v[5]=k,v[6]=F,v[7]=q,v[8]=H,v[9]=U,v[10]=$,v[11]=Y,v[12]=ie,v[13]=he,v[14]=ue,v[15]=ce,v},we.identity=u,we.transpose=function(v,S){if(v===S){var C=S[1],T=S[2],I=S[3],D=S[6],k=S[7],F=S[11];v[1]=S[4],v[2]=S[8],v[3]=S[12],v[4]=C,v[6]=S[9],v[7]=S[13],v[8]=T,v[9]=D,v[11]=S[14],v[12]=I,v[13]=k,v[14]=F}else v[0]=S[0],v[1]=S[4],v[2]=S[8],v[3]=S[12],v[4]=S[1],v[5]=S[5],v[6]=S[9],v[7]=S[13],v[8]=S[2],v[9]=S[6],v[10]=S[10],v[11]=S[14],v[12]=S[3],v[13]=S[7],v[14]=S[11],v[15]=S[15];return v},we.invert=function(v,S){var C=S[0],T=S[1],I=S[2],D=S[3],k=S[4],F=S[5],q=S[6],H=S[7],U=S[8],$=S[9],Y=S[10],ie=S[11],he=S[12],ue=S[13],ce=S[14],Ie=S[15],de=C*F-T*k,Me=C*q-I*k,ze=C*H-D*k,Pe=T*q-I*F,Ne=T*H-D*F,qe=I*H-D*q,Ze=U*ue-$*he,Be=U*ce-Y*he,ct=U*Ie-ie*he,yt=$*ce-Y*ue,lt=$*Ie-ie*ue,Lt=Y*Ie-ie*ce,Dt=de*Lt-Me*lt+ze*yt+Pe*ct-Ne*Be+qe*Ze;return Dt?(v[0]=(F*Lt-q*lt+H*yt)*(Dt=1/Dt),v[1]=(I*lt-T*Lt-D*yt)*Dt,v[2]=(ue*qe-ce*Ne+Ie*Pe)*Dt,v[3]=(Y*Ne-$*qe-ie*Pe)*Dt,v[4]=(q*ct-k*Lt-H*Be)*Dt,v[5]=(C*Lt-I*ct+D*Be)*Dt,v[6]=(ce*ze-he*qe-Ie*Me)*Dt,v[7]=(U*qe-Y*ze+ie*Me)*Dt,v[8]=(k*lt-F*ct+H*Ze)*Dt,v[9]=(T*ct-C*lt-D*Ze)*Dt,v[10]=(he*Ne-ue*ze+Ie*de)*Dt,v[11]=($*ze-U*Ne-ie*de)*Dt,v[12]=(F*Be-k*yt-q*Ze)*Dt,v[13]=(C*yt-T*Be+I*Ze)*Dt,v[14]=(ue*Me-he*Pe-ce*de)*Dt,v[15]=(U*Pe-$*Me+Y*de)*Dt,v):null},we.adjoint=function(v,S){var C=S[0],T=S[1],I=S[2],D=S[3],k=S[4],F=S[5],q=S[6],H=S[7],U=S[8],$=S[9],Y=S[10],ie=S[11],he=S[12],ue=S[13],ce=S[14],Ie=S[15];return v[0]=F*(Y*Ie-ie*ce)-$*(q*Ie-H*ce)+ue*(q*ie-H*Y),v[1]=-(T*(Y*Ie-ie*ce)-$*(I*Ie-D*ce)+ue*(I*ie-D*Y)),v[2]=T*(q*Ie-H*ce)-F*(I*Ie-D*ce)+ue*(I*H-D*q),v[3]=-(T*(q*ie-H*Y)-F*(I*ie-D*Y)+$*(I*H-D*q)),v[4]=-(k*(Y*Ie-ie*ce)-U*(q*Ie-H*ce)+he*(q*ie-H*Y)),v[5]=C*(Y*Ie-ie*ce)-U*(I*Ie-D*ce)+he*(I*ie-D*Y),v[6]=-(C*(q*Ie-H*ce)-k*(I*Ie-D*ce)+he*(I*H-D*q)),v[7]=C*(q*ie-H*Y)-k*(I*ie-D*Y)+U*(I*H-D*q),v[8]=k*($*Ie-ie*ue)-U*(F*Ie-H*ue)+he*(F*ie-H*$),v[9]=-(C*($*Ie-ie*ue)-U*(T*Ie-D*ue)+he*(T*ie-D*$)),v[10]=C*(F*Ie-H*ue)-k*(T*Ie-D*ue)+he*(T*H-D*F),v[11]=-(C*(F*ie-H*$)-k*(T*ie-D*$)+U*(T*H-D*F)),v[12]=-(k*($*ce-Y*ue)-U*(F*ce-q*ue)+he*(F*Y-q*$)),v[13]=C*($*ce-Y*ue)-U*(T*ce-I*ue)+he*(T*Y-I*$),v[14]=-(C*(F*ce-q*ue)-k*(T*ce-I*ue)+he*(T*q-I*F)),v[15]=C*(F*Y-q*$)-k*(T*Y-I*$)+U*(T*q-I*F),v},we.determinant=function(v){var S=v[0],C=v[1],T=v[2],I=v[3],D=v[4],k=v[5],F=v[6],q=v[7],H=v[8],U=v[9],$=v[10],Y=v[11],ie=v[12],he=v[13],ue=v[14],ce=v[15];return(S*k-C*D)*($*ce-Y*ue)-(S*F-T*D)*(U*ce-Y*he)+(S*q-I*D)*(U*ue-$*he)+(C*F-T*k)*(H*ce-Y*ie)-(C*q-I*k)*(H*ue-$*ie)+(T*q-I*F)*(H*he-U*ie)},we.multiply=m,we.translate=function(v,S,C){var T,I,D,k,F,q,H,U,$,Y,ie,he,ue=C[0],ce=C[1],Ie=C[2];return S===v?(v[12]=S[0]*ue+S[4]*ce+S[8]*Ie+S[12],v[13]=S[1]*ue+S[5]*ce+S[9]*Ie+S[13],v[14]=S[2]*ue+S[6]*ce+S[10]*Ie+S[14],v[15]=S[3]*ue+S[7]*ce+S[11]*Ie+S[15]):(I=S[1],D=S[2],k=S[3],F=S[4],q=S[5],H=S[6],U=S[7],$=S[8],Y=S[9],ie=S[10],he=S[11],v[0]=T=S[0],v[1]=I,v[2]=D,v[3]=k,v[4]=F,v[5]=q,v[6]=H,v[7]=U,v[8]=$,v[9]=Y,v[10]=ie,v[11]=he,v[12]=T*ue+F*ce+$*Ie+S[12],v[13]=I*ue+q*ce+Y*Ie+S[13],v[14]=D*ue+H*ce+ie*Ie+S[14],v[15]=k*ue+U*ce+he*Ie+S[15]),v},we.scale=function(v,S,C){var T=C[0],I=C[1],D=C[2];return v[0]=S[0]*T,v[1]=S[1]*T,v[2]=S[2]*T,v[3]=S[3]*T,v[4]=S[4]*I,v[5]=S[5]*I,v[6]=S[6]*I,v[7]=S[7]*I,v[8]=S[8]*D,v[9]=S[9]*D,v[10]=S[10]*D,v[11]=S[11]*D,v[12]=S[12],v[13]=S[13],v[14]=S[14],v[15]=S[15],v},we.rotate=function(v,S,C,T){var I,D,k,F,q,H,U,$,Y,ie,he,ue,ce,Ie,de,Me,ze,Pe,Ne,qe,Ze,Be,ct,yt,lt=T[0],Lt=T[1],Dt=T[2],wt=Math.hypot(lt,Lt,Dt);return wt<i.EPSILON?null:(lt*=wt=1/wt,Lt*=wt,Dt*=wt,I=Math.sin(C),D=Math.cos(C),q=S[1],H=S[2],U=S[3],Y=S[5],ie=S[6],he=S[7],ce=S[9],Ie=S[10],de=S[11],Me=lt*lt*(k=1-D)+D,Ne=lt*Lt*k-Dt*I,qe=Lt*Lt*k+D,Ze=Dt*Lt*k+lt*I,Be=lt*Dt*k+Lt*I,ct=Lt*Dt*k-lt*I,yt=Dt*Dt*k+D,v[0]=(F=S[0])*Me+($=S[4])*(ze=Lt*lt*k+Dt*I)+(ue=S[8])*(Pe=Dt*lt*k-Lt*I),v[1]=q*Me+Y*ze+ce*Pe,v[2]=H*Me+ie*ze+Ie*Pe,v[3]=U*Me+he*ze+de*Pe,v[4]=F*Ne+$*qe+ue*Ze,v[5]=q*Ne+Y*qe+ce*Ze,v[6]=H*Ne+ie*qe+Ie*Ze,v[7]=U*Ne+he*qe+de*Ze,v[8]=F*Be+$*ct+ue*yt,v[9]=q*Be+Y*ct+ce*yt,v[10]=H*Be+ie*ct+Ie*yt,v[11]=U*Be+he*ct+de*yt,S!==v&&(v[12]=S[12],v[13]=S[13],v[14]=S[14],v[15]=S[15]),v)},we.rotateX=function(v,S,C){var T=Math.sin(C),I=Math.cos(C),D=S[4],k=S[5],F=S[6],q=S[7],H=S[8],U=S[9],$=S[10],Y=S[11];return S!==v&&(v[0]=S[0],v[1]=S[1],v[2]=S[2],v[3]=S[3],v[12]=S[12],v[13]=S[13],v[14]=S[14],v[15]=S[15]),v[4]=D*I+H*T,v[5]=k*I+U*T,v[6]=F*I+$*T,v[7]=q*I+Y*T,v[8]=H*I-D*T,v[9]=U*I-k*T,v[10]=$*I-F*T,v[11]=Y*I-q*T,v},we.rotateY=function(v,S,C){var T=Math.sin(C),I=Math.cos(C),D=S[0],k=S[1],F=S[2],q=S[3],H=S[8],U=S[9],$=S[10],Y=S[11];return S!==v&&(v[4]=S[4],v[5]=S[5],v[6]=S[6],v[7]=S[7],v[12]=S[12],v[13]=S[13],v[14]=S[14],v[15]=S[15]),v[0]=D*I-H*T,v[1]=k*I-U*T,v[2]=F*I-$*T,v[3]=q*I-Y*T,v[8]=D*T+H*I,v[9]=k*T+U*I,v[10]=F*T+$*I,v[11]=q*T+Y*I,v},we.rotateZ=function(v,S,C){var T=Math.sin(C),I=Math.cos(C),D=S[0],k=S[1],F=S[2],q=S[3],H=S[4],U=S[5],$=S[6],Y=S[7];return S!==v&&(v[8]=S[8],v[9]=S[9],v[10]=S[10],v[11]=S[11],v[12]=S[12],v[13]=S[13],v[14]=S[14],v[15]=S[15]),v[0]=D*I+H*T,v[1]=k*I+U*T,v[2]=F*I+$*T,v[3]=q*I+Y*T,v[4]=H*I-D*T,v[5]=U*I-k*T,v[6]=$*I-F*T,v[7]=Y*I-q*T,v},we.fromTranslation=function(v,S){return v[0]=1,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=1,v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[10]=1,v[11]=0,v[12]=S[0],v[13]=S[1],v[14]=S[2],v[15]=1,v},we.fromScaling=function(v,S){return v[0]=S[0],v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=S[1],v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[10]=S[2],v[11]=0,v[12]=0,v[13]=0,v[14]=0,v[15]=1,v},we.fromRotation=function(v,S,C){var T,I,D,k=C[0],F=C[1],q=C[2],H=Math.hypot(k,F,q);return H<i.EPSILON?null:(k*=H=1/H,F*=H,q*=H,T=Math.sin(S),I=Math.cos(S),v[0]=k*k*(D=1-I)+I,v[1]=F*k*D+q*T,v[2]=q*k*D-F*T,v[3]=0,v[4]=k*F*D-q*T,v[5]=F*F*D+I,v[6]=q*F*D+k*T,v[7]=0,v[8]=k*q*D+F*T,v[9]=F*q*D-k*T,v[10]=q*q*D+I,v[11]=0,v[12]=0,v[13]=0,v[14]=0,v[15]=1,v)},we.fromXRotation=function(v,S){var C=Math.sin(S),T=Math.cos(S);return v[0]=1,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=T,v[6]=C,v[7]=0,v[8]=0,v[9]=-C,v[10]=T,v[11]=0,v[12]=0,v[13]=0,v[14]=0,v[15]=1,v},we.fromYRotation=function(v,S){var C=Math.sin(S),T=Math.cos(S);return v[0]=T,v[1]=0,v[2]=-C,v[3]=0,v[4]=0,v[5]=1,v[6]=0,v[7]=0,v[8]=C,v[9]=0,v[10]=T,v[11]=0,v[12]=0,v[13]=0,v[14]=0,v[15]=1,v},we.fromZRotation=function(v,S){var C=Math.sin(S),T=Math.cos(S);return v[0]=T,v[1]=C,v[2]=0,v[3]=0,v[4]=-C,v[5]=T,v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[10]=1,v[11]=0,v[12]=0,v[13]=0,v[14]=0,v[15]=1,v},we.fromRotationTranslation=h,we.fromQuat2=function(v,S){var C=new i.ARRAY_TYPE(3),T=-S[0],I=-S[1],D=-S[2],k=S[3],F=S[4],q=S[5],H=S[6],U=S[7],$=T*T+I*I+D*D+k*k;return $>0?(C[0]=2*(F*k+U*T+q*D-H*I)/$,C[1]=2*(q*k+U*I+H*T-F*D)/$,C[2]=2*(H*k+U*D+F*I-q*T)/$):(C[0]=2*(F*k+U*T+q*D-H*I),C[1]=2*(q*k+U*I+H*T-F*D),C[2]=2*(H*k+U*D+F*I-q*T)),h(v,S,C),v},we.getTranslation=function(v,S){return v[0]=S[12],v[1]=S[13],v[2]=S[14],v},we.getScaling=g,we.getRotation=function(v,S){var C=new i.ARRAY_TYPE(3);g(C,S);var T=1/C[0],I=1/C[1],D=1/C[2],k=S[0]*T,F=S[1]*I,q=S[2]*D,H=S[4]*T,U=S[5]*I,$=S[6]*D,Y=S[8]*T,ie=S[9]*I,he=S[10]*D,ue=k+U+he,ce=0;return ue>0?(ce=2*Math.sqrt(ue+1),v[3]=.25*ce,v[0]=($-ie)/ce,v[1]=(Y-q)/ce,v[2]=(F-H)/ce):k>U&&k>he?(ce=2*Math.sqrt(1+k-U-he),v[3]=($-ie)/ce,v[0]=.25*ce,v[1]=(F+H)/ce,v[2]=(Y+q)/ce):U>he?(ce=2*Math.sqrt(1+U-k-he),v[3]=(Y-q)/ce,v[0]=(F+H)/ce,v[1]=.25*ce,v[2]=($+ie)/ce):(ce=2*Math.sqrt(1+he-k-U),v[3]=(F-H)/ce,v[0]=(Y+q)/ce,v[1]=($+ie)/ce,v[2]=.25*ce),v},we.fromRotationTranslationScale=function(v,S,C,T){var I=S[0],D=S[1],k=S[2],F=S[3],q=I+I,H=D+D,U=k+k,$=I*q,Y=I*H,ie=I*U,he=D*H,ue=D*U,ce=k*U,Ie=F*q,de=F*H,Me=F*U,ze=T[0],Pe=T[1],Ne=T[2];return v[0]=(1-(he+ce))*ze,v[1]=(Y+Me)*ze,v[2]=(ie-de)*ze,v[3]=0,v[4]=(Y-Me)*Pe,v[5]=(1-($+ce))*Pe,v[6]=(ue+Ie)*Pe,v[7]=0,v[8]=(ie+de)*Ne,v[9]=(ue-Ie)*Ne,v[10]=(1-($+he))*Ne,v[11]=0,v[12]=C[0],v[13]=C[1],v[14]=C[2],v[15]=1,v},we.fromRotationTranslationScaleOrigin=function(v,S,C,T,I){var D=S[0],k=S[1],F=S[2],q=S[3],H=D+D,U=k+k,$=F+F,Y=D*H,ie=D*U,he=D*$,ue=k*U,ce=k*$,Ie=F*$,de=q*H,Me=q*U,ze=q*$,Pe=T[0],Ne=T[1],qe=T[2],Ze=I[0],Be=I[1],ct=I[2],yt=(1-(ue+Ie))*Pe,lt=(ie+ze)*Pe,Lt=(he-Me)*Pe,Dt=(ie-ze)*Ne,wt=(1-(Y+Ie))*Ne,vt=(ce+de)*Ne,Zt=(he+Me)*qe,zt=(ce-de)*qe,Ft=(1-(Y+ue))*qe;return v[0]=yt,v[1]=lt,v[2]=Lt,v[3]=0,v[4]=Dt,v[5]=wt,v[6]=vt,v[7]=0,v[8]=Zt,v[9]=zt,v[10]=Ft,v[11]=0,v[12]=C[0]+Ze-(yt*Ze+Dt*Be+Zt*ct),v[13]=C[1]+Be-(lt*Ze+wt*Be+zt*ct),v[14]=C[2]+ct-(Lt*Ze+vt*Be+Ft*ct),v[15]=1,v},we.fromQuat=function(v,S){var C=S[0],T=S[1],I=S[2],D=S[3],k=C+C,F=T+T,q=I+I,H=C*k,U=T*k,$=T*F,Y=I*k,ie=I*F,he=I*q,ue=D*k,ce=D*F,Ie=D*q;return v[0]=1-$-he,v[1]=U+Ie,v[2]=Y-ce,v[3]=0,v[4]=U-Ie,v[5]=1-H-he,v[6]=ie+ue,v[7]=0,v[8]=Y+ce,v[9]=ie-ue,v[10]=1-H-$,v[11]=0,v[12]=0,v[13]=0,v[14]=0,v[15]=1,v},we.frustum=function(v,S,C,T,I,D,k){var F=1/(C-S),q=1/(I-T),H=1/(D-k);return v[0]=2*D*F,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=2*D*q,v[6]=0,v[7]=0,v[8]=(C+S)*F,v[9]=(I+T)*q,v[10]=(k+D)*H,v[11]=-1,v[12]=0,v[13]=0,v[14]=k*D*2*H,v[15]=0,v},we.perspectiveNO=b,we.perspectiveZO=function(v,S,C,T,I){var D,k=1/Math.tan(S/2);return v[0]=k/C,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=k,v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[11]=-1,v[12]=0,v[13]=0,v[15]=0,I!=null&&I!==1/0?(v[10]=I*(D=1/(T-I)),v[14]=I*T*D):(v[10]=-1,v[14]=-T),v},we.perspectiveFromFieldOfView=function(v,S,C,T){var I=Math.tan(S.upDegrees*Math.PI/180),D=Math.tan(S.downDegrees*Math.PI/180),k=Math.tan(S.leftDegrees*Math.PI/180),F=Math.tan(S.rightDegrees*Math.PI/180),q=2/(k+F),H=2/(I+D);return v[0]=q,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=H,v[6]=0,v[7]=0,v[8]=-(k-F)*q*.5,v[9]=(I-D)*H*.5,v[10]=T/(C-T),v[11]=-1,v[12]=0,v[13]=0,v[14]=T*C/(C-T),v[15]=0,v},we.orthoNO=E,we.orthoZO=function(v,S,C,T,I,D,k){var F=1/(S-C),q=1/(T-I),H=1/(D-k);return v[0]=-2*F,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=-2*q,v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[10]=H,v[11]=0,v[12]=(S+C)*F,v[13]=(I+T)*q,v[14]=D*H,v[15]=1,v},we.lookAt=function(v,S,C,T){var I,D,k,F,q,H,U,$,Y,ie,he=S[0],ue=S[1],ce=S[2],Ie=T[0],de=T[1],Me=T[2],ze=C[0],Pe=C[1],Ne=C[2];return Math.abs(he-ze)<i.EPSILON&&Math.abs(ue-Pe)<i.EPSILON&&Math.abs(ce-Ne)<i.EPSILON?u(v):(U=he-ze,$=ue-Pe,Y=ce-Ne,I=de*(Y*=ie=1/Math.hypot(U,$,Y))-Me*($*=ie),D=Me*(U*=ie)-Ie*Y,k=Ie*$-de*U,(ie=Math.hypot(I,D,k))?(I*=ie=1/ie,D*=ie,k*=ie):(I=0,D=0,k=0),F=$*k-Y*D,q=Y*I-U*k,H=U*D-$*I,(ie=Math.hypot(F,q,H))?(F*=ie=1/ie,q*=ie,H*=ie):(F=0,q=0,H=0),v[0]=I,v[1]=F,v[2]=U,v[3]=0,v[4]=D,v[5]=q,v[6]=$,v[7]=0,v[8]=k,v[9]=H,v[10]=Y,v[11]=0,v[12]=-(I*he+D*ue+k*ce),v[13]=-(F*he+q*ue+H*ce),v[14]=-(U*he+$*ue+Y*ce),v[15]=1,v)},we.targetTo=function(v,S,C,T){var I=S[0],D=S[1],k=S[2],F=T[0],q=T[1],H=T[2],U=I-C[0],$=D-C[1],Y=k-C[2],ie=U*U+$*$+Y*Y;ie>0&&(U*=ie=1/Math.sqrt(ie),$*=ie,Y*=ie);var he=q*Y-H*$,ue=H*U-F*Y,ce=F*$-q*U;return(ie=he*he+ue*ue+ce*ce)>0&&(he*=ie=1/Math.sqrt(ie),ue*=ie,ce*=ie),v[0]=he,v[1]=ue,v[2]=ce,v[3]=0,v[4]=$*ce-Y*ue,v[5]=Y*he-U*ce,v[6]=U*ue-$*he,v[7]=0,v[8]=U,v[9]=$,v[10]=Y,v[11]=0,v[12]=I,v[13]=D,v[14]=k,v[15]=1,v},we.str=function(v){return"mat4("+v[0]+", "+v[1]+", "+v[2]+", "+v[3]+", "+v[4]+", "+v[5]+", "+v[6]+", "+v[7]+", "+v[8]+", "+v[9]+", "+v[10]+", "+v[11]+", "+v[12]+", "+v[13]+", "+v[14]+", "+v[15]+")"},we.frob=function(v){return Math.hypot(v[0],v[1],v[2],v[3],v[4],v[5],v[6],v[7],v[8],v[9],v[10],v[11],v[12],v[13],v[14],v[15])},we.add=function(v,S,C){return v[0]=S[0]+C[0],v[1]=S[1]+C[1],v[2]=S[2]+C[2],v[3]=S[3]+C[3],v[4]=S[4]+C[4],v[5]=S[5]+C[5],v[6]=S[6]+C[6],v[7]=S[7]+C[7],v[8]=S[8]+C[8],v[9]=S[9]+C[9],v[10]=S[10]+C[10],v[11]=S[11]+C[11],v[12]=S[12]+C[12],v[13]=S[13]+C[13],v[14]=S[14]+C[14],v[15]=S[15]+C[15],v},we.subtract=R,we.multiplyScalar=function(v,S,C){return v[0]=S[0]*C,v[1]=S[1]*C,v[2]=S[2]*C,v[3]=S[3]*C,v[4]=S[4]*C,v[5]=S[5]*C,v[6]=S[6]*C,v[7]=S[7]*C,v[8]=S[8]*C,v[9]=S[9]*C,v[10]=S[10]*C,v[11]=S[11]*C,v[12]=S[12]*C,v[13]=S[13]*C,v[14]=S[14]*C,v[15]=S[15]*C,v},we.multiplyScalarAndAdd=function(v,S,C,T){return v[0]=S[0]+C[0]*T,v[1]=S[1]+C[1]*T,v[2]=S[2]+C[2]*T,v[3]=S[3]+C[3]*T,v[4]=S[4]+C[4]*T,v[5]=S[5]+C[5]*T,v[6]=S[6]+C[6]*T,v[7]=S[7]+C[7]*T,v[8]=S[8]+C[8]*T,v[9]=S[9]+C[9]*T,v[10]=S[10]+C[10]*T,v[11]=S[11]+C[11]*T,v[12]=S[12]+C[12]*T,v[13]=S[13]+C[13]*T,v[14]=S[14]+C[14]*T,v[15]=S[15]+C[15]*T,v},we.exactEquals=function(v,S){return v[0]===S[0]&&v[1]===S[1]&&v[2]===S[2]&&v[3]===S[3]&&v[4]===S[4]&&v[5]===S[5]&&v[6]===S[6]&&v[7]===S[7]&&v[8]===S[8]&&v[9]===S[9]&&v[10]===S[10]&&v[11]===S[11]&&v[12]===S[12]&&v[13]===S[13]&&v[14]===S[14]&&v[15]===S[15]},we.equals=function(v,S){var C=v[0],T=v[1],I=v[2],D=v[3],k=v[4],F=v[5],q=v[6],H=v[7],U=v[8],$=v[9],Y=v[10],ie=v[11],he=v[12],ue=v[13],ce=v[14],Ie=v[15],de=S[0],Me=S[1],ze=S[2],Pe=S[3],Ne=S[4],qe=S[5],Ze=S[6],Be=S[7],ct=S[8],yt=S[9],lt=S[10],Lt=S[11],Dt=S[12],wt=S[13],vt=S[14],Zt=S[15];return Math.abs(C-de)<=i.EPSILON*Math.max(1,Math.abs(C),Math.abs(de))&&Math.abs(T-Me)<=i.EPSILON*Math.max(1,Math.abs(T),Math.abs(Me))&&Math.abs(I-ze)<=i.EPSILON*Math.max(1,Math.abs(I),Math.abs(ze))&&Math.abs(D-Pe)<=i.EPSILON*Math.max(1,Math.abs(D),Math.abs(Pe))&&Math.abs(k-Ne)<=i.EPSILON*Math.max(1,Math.abs(k),Math.abs(Ne))&&Math.abs(F-qe)<=i.EPSILON*Math.max(1,Math.abs(F),Math.abs(qe))&&Math.abs(q-Ze)<=i.EPSILON*Math.max(1,Math.abs(q),Math.abs(Ze))&&Math.abs(H-Be)<=i.EPSILON*Math.max(1,Math.abs(H),Math.abs(Be))&&Math.abs(U-ct)<=i.EPSILON*Math.max(1,Math.abs(U),Math.abs(ct))&&Math.abs($-yt)<=i.EPSILON*Math.max(1,Math.abs($),Math.abs(yt))&&Math.abs(Y-lt)<=i.EPSILON*Math.max(1,Math.abs(Y),Math.abs(lt))&&Math.abs(ie-Lt)<=i.EPSILON*Math.max(1,Math.abs(ie),Math.abs(Lt))&&Math.abs(he-Dt)<=i.EPSILON*Math.max(1,Math.abs(he),Math.abs(Dt))&&Math.abs(ue-wt)<=i.EPSILON*Math.max(1,Math.abs(ue),Math.abs(wt))&&Math.abs(ce-vt)<=i.EPSILON*Math.max(1,Math.abs(ce),Math.abs(vt))&&Math.abs(Ie-Zt)<=i.EPSILON*Math.max(1,Math.abs(Ie),Math.abs(Zt))},we.sub=we.mul=we.ortho=we.perspective=void 0;var i=function(v,S){if(v&&v.__esModule)return v;if(v===null||c(v)!=="object"&&typeof v!="function")return{default:v};var C=a(void 0);if(C&&C.has(v))return C.get(v);var T={},I=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var D in v)if(D!=="default"&&Object.prototype.hasOwnProperty.call(v,D)){var k=I?Object.getOwnPropertyDescriptor(v,D):null;k&&(k.get||k.set)?Object.defineProperty(T,D,k):T[D]=v[D]}return T.default=v,C&&C.set(v,T),T}(ae());function a(v){if(typeof WeakMap!="function")return null;var S=new WeakMap,C=new WeakMap;return(a=function(T){return T?C:S})(v)}function u(v){return v[0]=1,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=1,v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[10]=1,v[11]=0,v[12]=0,v[13]=0,v[14]=0,v[15]=1,v}function m(v,S,C){var T=S[0],I=S[1],D=S[2],k=S[3],F=S[4],q=S[5],H=S[6],U=S[7],$=S[8],Y=S[9],ie=S[10],he=S[11],ue=S[12],ce=S[13],Ie=S[14],de=S[15],Me=C[0],ze=C[1],Pe=C[2],Ne=C[3];return v[0]=Me*T+ze*F+Pe*$+Ne*ue,v[1]=Me*I+ze*q+Pe*Y+Ne*ce,v[2]=Me*D+ze*H+Pe*ie+Ne*Ie,v[3]=Me*k+ze*U+Pe*he+Ne*de,v[4]=(Me=C[4])*T+(ze=C[5])*F+(Pe=C[6])*$+(Ne=C[7])*ue,v[5]=Me*I+ze*q+Pe*Y+Ne*ce,v[6]=Me*D+ze*H+Pe*ie+Ne*Ie,v[7]=Me*k+ze*U+Pe*he+Ne*de,v[8]=(Me=C[8])*T+(ze=C[9])*F+(Pe=C[10])*$+(Ne=C[11])*ue,v[9]=Me*I+ze*q+Pe*Y+Ne*ce,v[10]=Me*D+ze*H+Pe*ie+Ne*Ie,v[11]=Me*k+ze*U+Pe*he+Ne*de,v[12]=(Me=C[12])*T+(ze=C[13])*F+(Pe=C[14])*$+(Ne=C[15])*ue,v[13]=Me*I+ze*q+Pe*Y+Ne*ce,v[14]=Me*D+ze*H+Pe*ie+Ne*Ie,v[15]=Me*k+ze*U+Pe*he+Ne*de,v}function h(v,S,C){var T=S[0],I=S[1],D=S[2],k=S[3],F=T+T,q=I+I,H=D+D,U=T*F,$=T*q,Y=T*H,ie=I*q,he=I*H,ue=D*H,ce=k*F,Ie=k*q,de=k*H;return v[0]=1-(ie+ue),v[1]=$+de,v[2]=Y-Ie,v[3]=0,v[4]=$-de,v[5]=1-(U+ue),v[6]=he+ce,v[7]=0,v[8]=Y+Ie,v[9]=he-ce,v[10]=1-(U+ie),v[11]=0,v[12]=C[0],v[13]=C[1],v[14]=C[2],v[15]=1,v}function g(v,S){var C=S[4],T=S[5],I=S[6],D=S[8],k=S[9],F=S[10];return v[0]=Math.hypot(S[0],S[1],S[2]),v[1]=Math.hypot(C,T,I),v[2]=Math.hypot(D,k,F),v}function b(v,S,C,T,I){var D,k=1/Math.tan(S/2);return v[0]=k/C,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=k,v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[11]=-1,v[12]=0,v[13]=0,v[15]=0,I!=null&&I!==1/0?(v[10]=(I+T)*(D=1/(T-I)),v[14]=2*I*T*D):(v[10]=-1,v[14]=-2*T),v}function E(v,S,C,T,I,D,k){var F=1/(S-C),q=1/(T-I),H=1/(D-k);return v[0]=-2*F,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=-2*q,v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[10]=2*H,v[11]=0,v[12]=(S+C)*F,v[13]=(I+T)*q,v[14]=(k+D)*H,v[15]=1,v}function R(v,S,C){return v[0]=S[0]-C[0],v[1]=S[1]-C[1],v[2]=S[2]-C[2],v[3]=S[3]-C[3],v[4]=S[4]-C[4],v[5]=S[5]-C[5],v[6]=S[6]-C[6],v[7]=S[7]-C[7],v[8]=S[8]-C[8],v[9]=S[9]-C[9],v[10]=S[10]-C[10],v[11]=S[11]-C[11],v[12]=S[12]-C[12],v[13]=S[13]-C[13],v[14]=S[14]-C[14],v[15]=S[15]-C[15],v}return we.perspective=b,we.ortho=E,we.mul=m,we.sub=R,we}var Ve,De={},je={};function pt(){if(Ve)return je;function c(I){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(D){return typeof D}:function(D){return D&&typeof Symbol=="function"&&D.constructor===Symbol&&D!==Symbol.prototype?"symbol":typeof D},c(I)}Ve=1,Object.defineProperty(je,"__esModule",{value:!0}),je.create=u,je.clone=function(I){var D=new i.ARRAY_TYPE(3);return D[0]=I[0],D[1]=I[1],D[2]=I[2],D},je.length=m,je.fromValues=function(I,D,k){var F=new i.ARRAY_TYPE(3);return F[0]=I,F[1]=D,F[2]=k,F},je.copy=function(I,D){return I[0]=D[0],I[1]=D[1],I[2]=D[2],I},je.set=function(I,D,k,F){return I[0]=D,I[1]=k,I[2]=F,I},je.add=function(I,D,k){return I[0]=D[0]+k[0],I[1]=D[1]+k[1],I[2]=D[2]+k[2],I},je.subtract=h,je.multiply=g,je.divide=b,je.ceil=function(I,D){return I[0]=Math.ceil(D[0]),I[1]=Math.ceil(D[1]),I[2]=Math.ceil(D[2]),I},je.floor=function(I,D){return I[0]=Math.floor(D[0]),I[1]=Math.floor(D[1]),I[2]=Math.floor(D[2]),I},je.min=function(I,D,k){return I[0]=Math.min(D[0],k[0]),I[1]=Math.min(D[1],k[1]),I[2]=Math.min(D[2],k[2]),I},je.max=function(I,D,k){return I[0]=Math.max(D[0],k[0]),I[1]=Math.max(D[1],k[1]),I[2]=Math.max(D[2],k[2]),I},je.round=function(I,D){return I[0]=Math.round(D[0]),I[1]=Math.round(D[1]),I[2]=Math.round(D[2]),I},je.scale=function(I,D,k){return I[0]=D[0]*k,I[1]=D[1]*k,I[2]=D[2]*k,I},je.scaleAndAdd=function(I,D,k,F){return I[0]=D[0]+k[0]*F,I[1]=D[1]+k[1]*F,I[2]=D[2]+k[2]*F,I},je.distance=E,je.squaredDistance=R,je.squaredLength=v,je.negate=function(I,D){return I[0]=-D[0],I[1]=-D[1],I[2]=-D[2],I},je.inverse=function(I,D){return I[0]=1/D[0],I[1]=1/D[1],I[2]=1/D[2],I},je.normalize=function(I,D){var k=D[0],F=D[1],q=D[2],H=k*k+F*F+q*q;return H>0&&(H=1/Math.sqrt(H)),I[0]=D[0]*H,I[1]=D[1]*H,I[2]=D[2]*H,I},je.dot=S,je.cross=function(I,D,k){var F=D[0],q=D[1],H=D[2],U=k[0],$=k[1],Y=k[2];return I[0]=q*Y-H*$,I[1]=H*U-F*Y,I[2]=F*$-q*U,I},je.lerp=function(I,D,k,F){var q=D[0],H=D[1],U=D[2];return I[0]=q+F*(k[0]-q),I[1]=H+F*(k[1]-H),I[2]=U+F*(k[2]-U),I},je.hermite=function(I,D,k,F,q,H){var U=H*H,$=U*(2*H-3)+1,Y=U*(H-2)+H,ie=U*(H-1),he=U*(3-2*H);return I[0]=D[0]*$+k[0]*Y+F[0]*ie+q[0]*he,I[1]=D[1]*$+k[1]*Y+F[1]*ie+q[1]*he,I[2]=D[2]*$+k[2]*Y+F[2]*ie+q[2]*he,I},je.bezier=function(I,D,k,F,q,H){var U=1-H,$=U*U,Y=H*H,ie=$*U,he=3*H*$,ue=3*Y*U,ce=Y*H;return I[0]=D[0]*ie+k[0]*he+F[0]*ue+q[0]*ce,I[1]=D[1]*ie+k[1]*he+F[1]*ue+q[1]*ce,I[2]=D[2]*ie+k[2]*he+F[2]*ue+q[2]*ce,I},je.random=function(I,D){D=D||1;var k=2*i.RANDOM()*Math.PI,F=2*i.RANDOM()-1,q=Math.sqrt(1-F*F)*D;return I[0]=Math.cos(k)*q,I[1]=Math.sin(k)*q,I[2]=F*D,I},je.transformMat4=function(I,D,k){var F=D[0],q=D[1],H=D[2],U=k[3]*F+k[7]*q+k[11]*H+k[15];return I[0]=(k[0]*F+k[4]*q+k[8]*H+k[12])/(U=U||1),I[1]=(k[1]*F+k[5]*q+k[9]*H+k[13])/U,I[2]=(k[2]*F+k[6]*q+k[10]*H+k[14])/U,I},je.transformMat3=function(I,D,k){var F=D[0],q=D[1],H=D[2];return I[0]=F*k[0]+q*k[3]+H*k[6],I[1]=F*k[1]+q*k[4]+H*k[7],I[2]=F*k[2]+q*k[5]+H*k[8],I},je.transformQuat=function(I,D,k){var F=k[0],q=k[1],H=k[2],U=D[0],$=D[1],Y=D[2],ie=q*Y-H*$,he=H*U-F*Y,ue=F*$-q*U,ce=q*ue-H*he,Ie=H*ie-F*ue,de=F*he-q*ie,Me=2*k[3];return he*=Me,ue*=Me,Ie*=2,de*=2,I[0]=U+(ie*=Me)+(ce*=2),I[1]=$+he+Ie,I[2]=Y+ue+de,I},je.rotateX=function(I,D,k,F){var q=[],H=[];return q[0]=D[0]-k[0],q[1]=D[1]-k[1],q[2]=D[2]-k[2],H[0]=q[0],H[1]=q[1]*Math.cos(F)-q[2]*Math.sin(F),H[2]=q[1]*Math.sin(F)+q[2]*Math.cos(F),I[0]=H[0]+k[0],I[1]=H[1]+k[1],I[2]=H[2]+k[2],I},je.rotateY=function(I,D,k,F){var q=[],H=[];return q[0]=D[0]-k[0],q[1]=D[1]-k[1],q[2]=D[2]-k[2],H[0]=q[2]*Math.sin(F)+q[0]*Math.cos(F),H[1]=q[1],H[2]=q[2]*Math.cos(F)-q[0]*Math.sin(F),I[0]=H[0]+k[0],I[1]=H[1]+k[1],I[2]=H[2]+k[2],I},je.rotateZ=function(I,D,k,F){var q=[],H=[];return q[0]=D[0]-k[0],q[1]=D[1]-k[1],q[2]=D[2]-k[2],H[0]=q[0]*Math.cos(F)-q[1]*Math.sin(F),H[1]=q[0]*Math.sin(F)+q[1]*Math.cos(F),H[2]=q[2],I[0]=H[0]+k[0],I[1]=H[1]+k[1],I[2]=H[2]+k[2],I},je.angle=function(I,D){var k=I[0],F=I[1],q=I[2],H=D[0],U=D[1],$=D[2],Y=Math.sqrt(k*k+F*F+q*q)*Math.sqrt(H*H+U*U+$*$),ie=Y&&S(I,D)/Y;return Math.acos(Math.min(Math.max(ie,-1),1))},je.zero=function(I){return I[0]=0,I[1]=0,I[2]=0,I},je.str=function(I){return"vec3("+I[0]+", "+I[1]+", "+I[2]+")"},je.exactEquals=function(I,D){return I[0]===D[0]&&I[1]===D[1]&&I[2]===D[2]},je.equals=function(I,D){var k=I[0],F=I[1],q=I[2],H=D[0],U=D[1],$=D[2];return Math.abs(k-H)<=i.EPSILON*Math.max(1,Math.abs(k),Math.abs(H))&&Math.abs(F-U)<=i.EPSILON*Math.max(1,Math.abs(F),Math.abs(U))&&Math.abs(q-$)<=i.EPSILON*Math.max(1,Math.abs(q),Math.abs($))},je.forEach=je.sqrLen=je.len=je.sqrDist=je.dist=je.div=je.mul=je.sub=void 0;var i=function(I,D){if(I&&I.__esModule)return I;if(I===null||c(I)!=="object"&&typeof I!="function")return{default:I};var k=a(void 0);if(k&&k.has(I))return k.get(I);var F={},q=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var H in I)if(H!=="default"&&Object.prototype.hasOwnProperty.call(I,H)){var U=q?Object.getOwnPropertyDescriptor(I,H):null;U&&(U.get||U.set)?Object.defineProperty(F,H,U):F[H]=I[H]}return F.default=I,k&&k.set(I,F),F}(ae());function a(I){if(typeof WeakMap!="function")return null;var D=new WeakMap,k=new WeakMap;return(a=function(F){return F?k:D})(I)}function u(){var I=new i.ARRAY_TYPE(3);return i.ARRAY_TYPE!=Float32Array&&(I[0]=0,I[1]=0,I[2]=0),I}function m(I){return Math.hypot(I[0],I[1],I[2])}function h(I,D,k){return I[0]=D[0]-k[0],I[1]=D[1]-k[1],I[2]=D[2]-k[2],I}function g(I,D,k){return I[0]=D[0]*k[0],I[1]=D[1]*k[1],I[2]=D[2]*k[2],I}function b(I,D,k){return I[0]=D[0]/k[0],I[1]=D[1]/k[1],I[2]=D[2]/k[2],I}function E(I,D){return Math.hypot(D[0]-I[0],D[1]-I[1],D[2]-I[2])}function R(I,D){var k=D[0]-I[0],F=D[1]-I[1],q=D[2]-I[2];return k*k+F*F+q*q}function v(I){var D=I[0],k=I[1],F=I[2];return D*D+k*k+F*F}function S(I,D){return I[0]*D[0]+I[1]*D[1]+I[2]*D[2]}je.sub=h,je.mul=g,je.div=b,je.dist=E,je.sqrDist=R,je.len=m,je.sqrLen=v;var C,T=(C=u(),function(I,D,k,F,q,H){var U,$;for(D||(D=3),k||(k=0),$=F?Math.min(F*D+k,I.length):I.length,U=k;U<$;U+=D)C[0]=I[U],C[1]=I[U+1],C[2]=I[U+2],q(C,C,H),I[U]=C[0],I[U+1]=C[1],I[U+2]=C[2];return I});return je.forEach=T,je}var Ye,Or,di={};function Qt(){if(Ye)return di;function c(T){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(I){return typeof I}:function(I){return I&&typeof Symbol=="function"&&I.constructor===Symbol&&I!==Symbol.prototype?"symbol":typeof I},c(T)}Ye=1,Object.defineProperty(di,"__esModule",{value:!0}),di.create=u,di.clone=function(T){var I=new i.ARRAY_TYPE(4);return I[0]=T[0],I[1]=T[1],I[2]=T[2],I[3]=T[3],I},di.fromValues=function(T,I,D,k){var F=new i.ARRAY_TYPE(4);return F[0]=T,F[1]=I,F[2]=D,F[3]=k,F},di.copy=function(T,I){return T[0]=I[0],T[1]=I[1],T[2]=I[2],T[3]=I[3],T},di.set=function(T,I,D,k,F){return T[0]=I,T[1]=D,T[2]=k,T[3]=F,T},di.add=function(T,I,D){return T[0]=I[0]+D[0],T[1]=I[1]+D[1],T[2]=I[2]+D[2],T[3]=I[3]+D[3],T},di.subtract=m,di.multiply=h,di.divide=g,di.ceil=function(T,I){return T[0]=Math.ceil(I[0]),T[1]=Math.ceil(I[1]),T[2]=Math.ceil(I[2]),T[3]=Math.ceil(I[3]),T},di.floor=function(T,I){return T[0]=Math.floor(I[0]),T[1]=Math.floor(I[1]),T[2]=Math.floor(I[2]),T[3]=Math.floor(I[3]),T},di.min=function(T,I,D){return T[0]=Math.min(I[0],D[0]),T[1]=Math.min(I[1],D[1]),T[2]=Math.min(I[2],D[2]),T[3]=Math.min(I[3],D[3]),T},di.max=function(T,I,D){return T[0]=Math.max(I[0],D[0]),T[1]=Math.max(I[1],D[1]),T[2]=Math.max(I[2],D[2]),T[3]=Math.max(I[3],D[3]),T},di.round=function(T,I){return T[0]=Math.round(I[0]),T[1]=Math.round(I[1]),T[2]=Math.round(I[2]),T[3]=Math.round(I[3]),T},di.scale=function(T,I,D){return T[0]=I[0]*D,T[1]=I[1]*D,T[2]=I[2]*D,T[3]=I[3]*D,T},di.scaleAndAdd=function(T,I,D,k){return T[0]=I[0]+D[0]*k,T[1]=I[1]+D[1]*k,T[2]=I[2]+D[2]*k,T[3]=I[3]+D[3]*k,T},di.distance=b,di.squaredDistance=E,di.length=R,di.squaredLength=v,di.negate=function(T,I){return T[0]=-I[0],T[1]=-I[1],T[2]=-I[2],T[3]=-I[3],T},di.inverse=function(T,I){return T[0]=1/I[0],T[1]=1/I[1],T[2]=1/I[2],T[3]=1/I[3],T},di.normalize=function(T,I){var D=I[0],k=I[1],F=I[2],q=I[3],H=D*D+k*k+F*F+q*q;return H>0&&(H=1/Math.sqrt(H)),T[0]=D*H,T[1]=k*H,T[2]=F*H,T[3]=q*H,T},di.dot=function(T,I){return T[0]*I[0]+T[1]*I[1]+T[2]*I[2]+T[3]*I[3]},di.cross=function(T,I,D,k){var F=D[0]*k[1]-D[1]*k[0],q=D[0]*k[2]-D[2]*k[0],H=D[0]*k[3]-D[3]*k[0],U=D[1]*k[2]-D[2]*k[1],$=D[1]*k[3]-D[3]*k[1],Y=D[2]*k[3]-D[3]*k[2],ie=I[0],he=I[1],ue=I[2],ce=I[3];return T[0]=he*Y-ue*$+ce*U,T[1]=-ie*Y+ue*H-ce*q,T[2]=ie*$-he*H+ce*F,T[3]=-ie*U+he*q-ue*F,T},di.lerp=function(T,I,D,k){var F=I[0],q=I[1],H=I[2],U=I[3];return T[0]=F+k*(D[0]-F),T[1]=q+k*(D[1]-q),T[2]=H+k*(D[2]-H),T[3]=U+k*(D[3]-U),T},di.random=function(T,I){var D,k,F,q,H,U;I=I||1;do H=(D=2*i.RANDOM()-1)*D+(k=2*i.RANDOM()-1)*k;while(H>=1);do U=(F=2*i.RANDOM()-1)*F+(q=2*i.RANDOM()-1)*q;while(U>=1);var $=Math.sqrt((1-H)/U);return T[0]=I*D,T[1]=I*k,T[2]=I*F*$,T[3]=I*q*$,T},di.transformMat4=function(T,I,D){var k=I[0],F=I[1],q=I[2],H=I[3];return T[0]=D[0]*k+D[4]*F+D[8]*q+D[12]*H,T[1]=D[1]*k+D[5]*F+D[9]*q+D[13]*H,T[2]=D[2]*k+D[6]*F+D[10]*q+D[14]*H,T[3]=D[3]*k+D[7]*F+D[11]*q+D[15]*H,T},di.transformQuat=function(T,I,D){var k=I[0],F=I[1],q=I[2],H=D[0],U=D[1],$=D[2],Y=D[3],ie=Y*k+U*q-$*F,he=Y*F+$*k-H*q,ue=Y*q+H*F-U*k,ce=-H*k-U*F-$*q;return T[0]=ie*Y+ce*-H+he*-$-ue*-U,T[1]=he*Y+ce*-U+ue*-H-ie*-$,T[2]=ue*Y+ce*-$+ie*-U-he*-H,T[3]=I[3],T},di.zero=function(T){return T[0]=0,T[1]=0,T[2]=0,T[3]=0,T},di.str=function(T){return"vec4("+T[0]+", "+T[1]+", "+T[2]+", "+T[3]+")"},di.exactEquals=function(T,I){return T[0]===I[0]&&T[1]===I[1]&&T[2]===I[2]&&T[3]===I[3]},di.equals=function(T,I){var D=T[0],k=T[1],F=T[2],q=T[3],H=I[0],U=I[1],$=I[2],Y=I[3];return Math.abs(D-H)<=i.EPSILON*Math.max(1,Math.abs(D),Math.abs(H))&&Math.abs(k-U)<=i.EPSILON*Math.max(1,Math.abs(k),Math.abs(U))&&Math.abs(F-$)<=i.EPSILON*Math.max(1,Math.abs(F),Math.abs($))&&Math.abs(q-Y)<=i.EPSILON*Math.max(1,Math.abs(q),Math.abs(Y))},di.forEach=di.sqrLen=di.len=di.sqrDist=di.dist=di.div=di.mul=di.sub=void 0;var i=function(T,I){if(T&&T.__esModule)return T;if(T===null||c(T)!=="object"&&typeof T!="function")return{default:T};var D=a(void 0);if(D&&D.has(T))return D.get(T);var k={},F=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var q in T)if(q!=="default"&&Object.prototype.hasOwnProperty.call(T,q)){var H=F?Object.getOwnPropertyDescriptor(T,q):null;H&&(H.get||H.set)?Object.defineProperty(k,q,H):k[q]=T[q]}return k.default=T,D&&D.set(T,k),k}(ae());function a(T){if(typeof WeakMap!="function")return null;var I=new WeakMap,D=new WeakMap;return(a=function(k){return k?D:I})(T)}function u(){var T=new i.ARRAY_TYPE(4);return i.ARRAY_TYPE!=Float32Array&&(T[0]=0,T[1]=0,T[2]=0,T[3]=0),T}function m(T,I,D){return T[0]=I[0]-D[0],T[1]=I[1]-D[1],T[2]=I[2]-D[2],T[3]=I[3]-D[3],T}function h(T,I,D){return T[0]=I[0]*D[0],T[1]=I[1]*D[1],T[2]=I[2]*D[2],T[3]=I[3]*D[3],T}function g(T,I,D){return T[0]=I[0]/D[0],T[1]=I[1]/D[1],T[2]=I[2]/D[2],T[3]=I[3]/D[3],T}function b(T,I){return Math.hypot(I[0]-T[0],I[1]-T[1],I[2]-T[2],I[3]-T[3])}function E(T,I){var D=I[0]-T[0],k=I[1]-T[1],F=I[2]-T[2],q=I[3]-T[3];return D*D+k*k+F*F+q*q}function R(T){return Math.hypot(T[0],T[1],T[2],T[3])}function v(T){var I=T[0],D=T[1],k=T[2],F=T[3];return I*I+D*D+k*k+F*F}di.sub=m,di.mul=h,di.div=g,di.dist=b,di.sqrDist=E,di.len=R,di.sqrLen=v;var S,C=(S=u(),function(T,I,D,k,F,q){var H,U;for(I||(I=4),D||(D=0),U=k?Math.min(k*I+D,T.length):T.length,H=D;H<U;H+=I)S[0]=T[H],S[1]=T[H+1],S[2]=T[H+2],S[3]=T[H+3],F(S,S,q),T[H]=S[0],T[H+1]=S[1],T[H+2]=S[2],T[H+3]=S[3];return T});return di.forEach=C,di}function Ai(){if(Or)return De;function c(de){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Me){return typeof Me}:function(Me){return Me&&typeof Symbol=="function"&&Me.constructor===Symbol&&Me!==Symbol.prototype?"symbol":typeof Me},c(de)}Or=1,Object.defineProperty(De,"__esModule",{value:!0}),De.create=b,De.identity=function(de){return de[0]=0,de[1]=0,de[2]=0,de[3]=1,de},De.setAxisAngle=E,De.getAxisAngle=function(de,Me){var ze=2*Math.acos(Me[3]),Pe=Math.sin(ze/2);return Pe>i.EPSILON?(de[0]=Me[0]/Pe,de[1]=Me[1]/Pe,de[2]=Me[2]/Pe):(de[0]=1,de[1]=0,de[2]=0),ze},De.getAngle=function(de,Me){var ze=D(de,Me);return Math.acos(2*ze*ze-1)},De.multiply=R,De.rotateX=function(de,Me,ze){ze*=.5;var Pe=Me[0],Ne=Me[1],qe=Me[2],Ze=Me[3],Be=Math.sin(ze),ct=Math.cos(ze);return de[0]=Pe*ct+Ze*Be,de[1]=Ne*ct+qe*Be,de[2]=qe*ct-Ne*Be,de[3]=Ze*ct-Pe*Be,de},De.rotateY=function(de,Me,ze){ze*=.5;var Pe=Me[0],Ne=Me[1],qe=Me[2],Ze=Me[3],Be=Math.sin(ze),ct=Math.cos(ze);return de[0]=Pe*ct-qe*Be,de[1]=Ne*ct+Ze*Be,de[2]=qe*ct+Pe*Be,de[3]=Ze*ct-Ne*Be,de},De.rotateZ=function(de,Me,ze){ze*=.5;var Pe=Me[0],Ne=Me[1],qe=Me[2],Ze=Me[3],Be=Math.sin(ze),ct=Math.cos(ze);return de[0]=Pe*ct+Ne*Be,de[1]=Ne*ct-Pe*Be,de[2]=qe*ct+Ze*Be,de[3]=Ze*ct-qe*Be,de},De.calculateW=function(de,Me){var ze=Me[0],Pe=Me[1],Ne=Me[2];return de[0]=ze,de[1]=Pe,de[2]=Ne,de[3]=Math.sqrt(Math.abs(1-ze*ze-Pe*Pe-Ne*Ne)),de},De.exp=v,De.ln=S,De.pow=function(de,Me,ze){return S(de,Me),I(de,de,ze),v(de,de),de},De.slerp=C,De.random=function(de){var Me=i.RANDOM(),ze=i.RANDOM(),Pe=i.RANDOM(),Ne=Math.sqrt(1-Me),qe=Math.sqrt(Me);return de[0]=Ne*Math.sin(2*Math.PI*ze),de[1]=Ne*Math.cos(2*Math.PI*ze),de[2]=qe*Math.sin(2*Math.PI*Pe),de[3]=qe*Math.cos(2*Math.PI*Pe),de},De.invert=function(de,Me){var ze=Me[0],Pe=Me[1],Ne=Me[2],qe=Me[3],Ze=ze*ze+Pe*Pe+Ne*Ne+qe*qe,Be=Ze?1/Ze:0;return de[0]=-ze*Be,de[1]=-Pe*Be,de[2]=-Ne*Be,de[3]=qe*Be,de},De.conjugate=function(de,Me){return de[0]=-Me[0],de[1]=-Me[1],de[2]=-Me[2],de[3]=Me[3],de},De.fromMat3=T,De.fromEuler=function(de,Me,ze,Pe){var Ne=.5*Math.PI/180;Me*=Ne,ze*=Ne,Pe*=Ne;var qe=Math.sin(Me),Ze=Math.cos(Me),Be=Math.sin(ze),ct=Math.cos(ze),yt=Math.sin(Pe),lt=Math.cos(Pe);return de[0]=qe*ct*lt-Ze*Be*yt,de[1]=Ze*Be*lt+qe*ct*yt,de[2]=Ze*ct*yt-qe*Be*lt,de[3]=Ze*ct*lt+qe*Be*yt,de},De.str=function(de){return"quat("+de[0]+", "+de[1]+", "+de[2]+", "+de[3]+")"},De.setAxes=De.sqlerp=De.rotationTo=De.equals=De.exactEquals=De.normalize=De.sqrLen=De.squaredLength=De.len=De.length=De.lerp=De.dot=De.scale=De.mul=De.add=De.set=De.copy=De.fromValues=De.clone=void 0;var i=g(ae()),a=g(Ct()),u=g(pt()),m=g(Qt());function h(de){if(typeof WeakMap!="function")return null;var Me=new WeakMap,ze=new WeakMap;return(h=function(Pe){return Pe?ze:Me})(de)}function g(de,Me){if(de&&de.__esModule)return de;if(de===null||c(de)!=="object"&&typeof de!="function")return{default:de};var ze=h(Me);if(ze&&ze.has(de))return ze.get(de);var Pe={},Ne=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var qe in de)if(qe!=="default"&&Object.prototype.hasOwnProperty.call(de,qe)){var Ze=Ne?Object.getOwnPropertyDescriptor(de,qe):null;Ze&&(Ze.get||Ze.set)?Object.defineProperty(Pe,qe,Ze):Pe[qe]=de[qe]}return Pe.default=de,ze&&ze.set(de,Pe),Pe}function b(){var de=new i.ARRAY_TYPE(4);return i.ARRAY_TYPE!=Float32Array&&(de[0]=0,de[1]=0,de[2]=0),de[3]=1,de}function E(de,Me,ze){ze*=.5;var Pe=Math.sin(ze);return de[0]=Pe*Me[0],de[1]=Pe*Me[1],de[2]=Pe*Me[2],de[3]=Math.cos(ze),de}function R(de,Me,ze){var Pe=Me[0],Ne=Me[1],qe=Me[2],Ze=Me[3],Be=ze[0],ct=ze[1],yt=ze[2],lt=ze[3];return de[0]=Pe*lt+Ze*Be+Ne*yt-qe*ct,de[1]=Ne*lt+Ze*ct+qe*Be-Pe*yt,de[2]=qe*lt+Ze*yt+Pe*ct-Ne*Be,de[3]=Ze*lt-Pe*Be-Ne*ct-qe*yt,de}function v(de,Me){var ze=Me[0],Pe=Me[1],Ne=Me[2],qe=Me[3],Ze=Math.sqrt(ze*ze+Pe*Pe+Ne*Ne),Be=Math.exp(qe),ct=Ze>0?Be*Math.sin(Ze)/Ze:0;return de[0]=ze*ct,de[1]=Pe*ct,de[2]=Ne*ct,de[3]=Be*Math.cos(Ze),de}function S(de,Me){var ze=Me[0],Pe=Me[1],Ne=Me[2],qe=Me[3],Ze=Math.sqrt(ze*ze+Pe*Pe+Ne*Ne),Be=Ze>0?Math.atan2(Ze,qe)/Ze:0;return de[0]=ze*Be,de[1]=Pe*Be,de[2]=Ne*Be,de[3]=.5*Math.log(ze*ze+Pe*Pe+Ne*Ne+qe*qe),de}function C(de,Me,ze,Pe){var Ne,qe,Ze,Be,ct,yt=Me[0],lt=Me[1],Lt=Me[2],Dt=Me[3],wt=ze[0],vt=ze[1],Zt=ze[2],zt=ze[3];return(qe=yt*wt+lt*vt+Lt*Zt+Dt*zt)<0&&(qe=-qe,wt=-wt,vt=-vt,Zt=-Zt,zt=-zt),1-qe>i.EPSILON?(Ne=Math.acos(qe),Ze=Math.sin(Ne),Be=Math.sin((1-Pe)*Ne)/Ze,ct=Math.sin(Pe*Ne)/Ze):(Be=1-Pe,ct=Pe),de[0]=Be*yt+ct*wt,de[1]=Be*lt+ct*vt,de[2]=Be*Lt+ct*Zt,de[3]=Be*Dt+ct*zt,de}function T(de,Me){var ze,Pe=Me[0]+Me[4]+Me[8];if(Pe>0)ze=Math.sqrt(Pe+1),de[3]=.5*ze,de[0]=(Me[5]-Me[7])*(ze=.5/ze),de[1]=(Me[6]-Me[2])*ze,de[2]=(Me[1]-Me[3])*ze;else{var Ne=0;Me[4]>Me[0]&&(Ne=1),Me[8]>Me[3*Ne+Ne]&&(Ne=2);var qe=(Ne+1)%3,Ze=(Ne+2)%3;ze=Math.sqrt(Me[3*Ne+Ne]-Me[3*qe+qe]-Me[3*Ze+Ze]+1),de[Ne]=.5*ze,de[3]=(Me[3*qe+Ze]-Me[3*Ze+qe])*(ze=.5/ze),de[qe]=(Me[3*qe+Ne]+Me[3*Ne+qe])*ze,de[Ze]=(Me[3*Ze+Ne]+Me[3*Ne+Ze])*ze}return de}De.clone=m.clone,De.fromValues=m.fromValues,De.copy=m.copy,De.set=m.set,De.add=m.add,De.mul=R;var I=m.scale;De.scale=I;var D=m.dot;De.dot=D,De.lerp=m.lerp;var k=m.length;De.length=k,De.len=k;var F=m.squaredLength;De.squaredLength=F,De.sqrLen=F;var q=m.normalize;De.normalize=q,De.exactEquals=m.exactEquals,De.equals=m.equals;var H,U,$,Y=(H=u.create(),U=u.fromValues(1,0,0),$=u.fromValues(0,1,0),function(de,Me,ze){var Pe=u.dot(Me,ze);return Pe<-.999999?(u.cross(H,U,Me),u.len(H)<1e-6&&u.cross(H,$,Me),u.normalize(H,H),E(de,H,Math.PI),de):Pe>.999999?(de[0]=0,de[1]=0,de[2]=0,de[3]=1,de):(u.cross(H,Me,ze),de[0]=H[0],de[1]=H[1],de[2]=H[2],de[3]=1+Pe,q(de,de))});De.rotationTo=Y;var ie,he,ue=(ie=b(),he=b(),function(de,Me,ze,Pe,Ne,qe){return C(ie,Me,Ne,qe),C(he,ze,Pe,qe),C(de,ie,he,2*qe*(1-qe)),de});De.sqlerp=ue;var ce,Ie=(ce=a.create(),function(de,Me,ze,Pe){return ce[0]=ze[0],ce[3]=ze[1],ce[6]=ze[2],ce[1]=Pe[0],ce[4]=Pe[1],ce[7]=Pe[2],ce[2]=-Me[0],ce[5]=-Me[1],ce[8]=-Me[2],q(de,T(de,ce))});return De.setAxes=Ie,De}var Mi,ai={};function pn(){if(Mi)return ai;function c(C){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(T){return typeof T}:function(T){return T&&typeof Symbol=="function"&&T.constructor===Symbol&&T!==Symbol.prototype?"symbol":typeof T},c(C)}Mi=1,Object.defineProperty(ai,"__esModule",{value:!0}),ai.create=function(){var C=new i.ARRAY_TYPE(8);return i.ARRAY_TYPE!=Float32Array&&(C[0]=0,C[1]=0,C[2]=0,C[4]=0,C[5]=0,C[6]=0,C[7]=0),C[3]=1,C},ai.clone=function(C){var T=new i.ARRAY_TYPE(8);return T[0]=C[0],T[1]=C[1],T[2]=C[2],T[3]=C[3],T[4]=C[4],T[5]=C[5],T[6]=C[6],T[7]=C[7],T},ai.fromValues=function(C,T,I,D,k,F,q,H){var U=new i.ARRAY_TYPE(8);return U[0]=C,U[1]=T,U[2]=I,U[3]=D,U[4]=k,U[5]=F,U[6]=q,U[7]=H,U},ai.fromRotationTranslationValues=function(C,T,I,D,k,F,q){var H=new i.ARRAY_TYPE(8);H[0]=C,H[1]=T,H[2]=I,H[3]=D;var U=.5*k,$=.5*F,Y=.5*q;return H[4]=U*D+$*I-Y*T,H[5]=$*D+Y*C-U*I,H[6]=Y*D+U*T-$*C,H[7]=-U*C-$*T-Y*I,H},ai.fromRotationTranslation=g,ai.fromTranslation=function(C,T){return C[0]=0,C[1]=0,C[2]=0,C[3]=1,C[4]=.5*T[0],C[5]=.5*T[1],C[6]=.5*T[2],C[7]=0,C},ai.fromRotation=function(C,T){return C[0]=T[0],C[1]=T[1],C[2]=T[2],C[3]=T[3],C[4]=0,C[5]=0,C[6]=0,C[7]=0,C},ai.fromMat4=function(C,T){var I=a.create();u.getRotation(I,T);var D=new i.ARRAY_TYPE(3);return u.getTranslation(D,T),g(C,I,D),C},ai.copy=b,ai.identity=function(C){return C[0]=0,C[1]=0,C[2]=0,C[3]=1,C[4]=0,C[5]=0,C[6]=0,C[7]=0,C},ai.set=function(C,T,I,D,k,F,q,H,U){return C[0]=T,C[1]=I,C[2]=D,C[3]=k,C[4]=F,C[5]=q,C[6]=H,C[7]=U,C},ai.getDual=function(C,T){return C[0]=T[4],C[1]=T[5],C[2]=T[6],C[3]=T[7],C},ai.setDual=function(C,T){return C[4]=T[0],C[5]=T[1],C[6]=T[2],C[7]=T[3],C},ai.getTranslation=function(C,T){var I=T[4],D=T[5],k=T[6],F=T[7],q=-T[0],H=-T[1],U=-T[2],$=T[3];return C[0]=2*(I*$+F*q+D*U-k*H),C[1]=2*(D*$+F*H+k*q-I*U),C[2]=2*(k*$+F*U+I*H-D*q),C},ai.translate=function(C,T,I){var D=T[0],k=T[1],F=T[2],q=T[3],H=.5*I[0],U=.5*I[1],$=.5*I[2],Y=T[4],ie=T[5],he=T[6],ue=T[7];return C[0]=D,C[1]=k,C[2]=F,C[3]=q,C[4]=q*H+k*$-F*U+Y,C[5]=q*U+F*H-D*$+ie,C[6]=q*$+D*U-k*H+he,C[7]=-D*H-k*U-F*$+ue,C},ai.rotateX=function(C,T,I){var D=-T[0],k=-T[1],F=-T[2],q=T[3],H=T[4],U=T[5],$=T[6],Y=T[7],ie=H*q+Y*D+U*F-$*k,he=U*q+Y*k+$*D-H*F,ue=$*q+Y*F+H*k-U*D,ce=Y*q-H*D-U*k-$*F;return a.rotateX(C,T,I),C[4]=ie*(q=C[3])+ce*(D=C[0])+he*(F=C[2])-ue*(k=C[1]),C[5]=he*q+ce*k+ue*D-ie*F,C[6]=ue*q+ce*F+ie*k-he*D,C[7]=ce*q-ie*D-he*k-ue*F,C},ai.rotateY=function(C,T,I){var D=-T[0],k=-T[1],F=-T[2],q=T[3],H=T[4],U=T[5],$=T[6],Y=T[7],ie=H*q+Y*D+U*F-$*k,he=U*q+Y*k+$*D-H*F,ue=$*q+Y*F+H*k-U*D,ce=Y*q-H*D-U*k-$*F;return a.rotateY(C,T,I),C[4]=ie*(q=C[3])+ce*(D=C[0])+he*(F=C[2])-ue*(k=C[1]),C[5]=he*q+ce*k+ue*D-ie*F,C[6]=ue*q+ce*F+ie*k-he*D,C[7]=ce*q-ie*D-he*k-ue*F,C},ai.rotateZ=function(C,T,I){var D=-T[0],k=-T[1],F=-T[2],q=T[3],H=T[4],U=T[5],$=T[6],Y=T[7],ie=H*q+Y*D+U*F-$*k,he=U*q+Y*k+$*D-H*F,ue=$*q+Y*F+H*k-U*D,ce=Y*q-H*D-U*k-$*F;return a.rotateZ(C,T,I),C[4]=ie*(q=C[3])+ce*(D=C[0])+he*(F=C[2])-ue*(k=C[1]),C[5]=he*q+ce*k+ue*D-ie*F,C[6]=ue*q+ce*F+ie*k-he*D,C[7]=ce*q-ie*D-he*k-ue*F,C},ai.rotateByQuatAppend=function(C,T,I){var D=I[0],k=I[1],F=I[2],q=I[3],H=T[0],U=T[1],$=T[2],Y=T[3];return C[0]=H*q+Y*D+U*F-$*k,C[1]=U*q+Y*k+$*D-H*F,C[2]=$*q+Y*F+H*k-U*D,C[3]=Y*q-H*D-U*k-$*F,C[4]=(H=T[4])*q+(Y=T[7])*D+(U=T[5])*F-($=T[6])*k,C[5]=U*q+Y*k+$*D-H*F,C[6]=$*q+Y*F+H*k-U*D,C[7]=Y*q-H*D-U*k-$*F,C},ai.rotateByQuatPrepend=function(C,T,I){var D=T[0],k=T[1],F=T[2],q=T[3],H=I[0],U=I[1],$=I[2],Y=I[3];return C[0]=D*Y+q*H+k*$-F*U,C[1]=k*Y+q*U+F*H-D*$,C[2]=F*Y+q*$+D*U-k*H,C[3]=q*Y-D*H-k*U-F*$,C[4]=D*(Y=I[7])+q*(H=I[4])+k*($=I[6])-F*(U=I[5]),C[5]=k*Y+q*U+F*H-D*$,C[6]=F*Y+q*$+D*U-k*H,C[7]=q*Y-D*H-k*U-F*$,C},ai.rotateAroundAxis=function(C,T,I,D){if(Math.abs(D)<i.EPSILON)return b(C,T);var k=Math.hypot(I[0],I[1],I[2]);D*=.5;var F=Math.sin(D),q=F*I[0]/k,H=F*I[1]/k,U=F*I[2]/k,$=Math.cos(D),Y=T[0],ie=T[1],he=T[2],ue=T[3];C[0]=Y*$+ue*q+ie*U-he*H,C[1]=ie*$+ue*H+he*q-Y*U,C[2]=he*$+ue*U+Y*H-ie*q,C[3]=ue*$-Y*q-ie*H-he*U;var ce=T[4],Ie=T[5],de=T[6],Me=T[7];return C[4]=ce*$+Me*q+Ie*U-de*H,C[5]=Ie*$+Me*H+de*q-ce*U,C[6]=de*$+Me*U+ce*H-Ie*q,C[7]=Me*$-ce*q-Ie*H-de*U,C},ai.add=function(C,T,I){return C[0]=T[0]+I[0],C[1]=T[1]+I[1],C[2]=T[2]+I[2],C[3]=T[3]+I[3],C[4]=T[4]+I[4],C[5]=T[5]+I[5],C[6]=T[6]+I[6],C[7]=T[7]+I[7],C},ai.multiply=E,ai.scale=function(C,T,I){return C[0]=T[0]*I,C[1]=T[1]*I,C[2]=T[2]*I,C[3]=T[3]*I,C[4]=T[4]*I,C[5]=T[5]*I,C[6]=T[6]*I,C[7]=T[7]*I,C},ai.lerp=function(C,T,I,D){var k=1-D;return R(T,I)<0&&(D=-D),C[0]=T[0]*k+I[0]*D,C[1]=T[1]*k+I[1]*D,C[2]=T[2]*k+I[2]*D,C[3]=T[3]*k+I[3]*D,C[4]=T[4]*k+I[4]*D,C[5]=T[5]*k+I[5]*D,C[6]=T[6]*k+I[6]*D,C[7]=T[7]*k+I[7]*D,C},ai.invert=function(C,T){var I=S(T);return C[0]=-T[0]/I,C[1]=-T[1]/I,C[2]=-T[2]/I,C[3]=T[3]/I,C[4]=-T[4]/I,C[5]=-T[5]/I,C[6]=-T[6]/I,C[7]=T[7]/I,C},ai.conjugate=function(C,T){return C[0]=-T[0],C[1]=-T[1],C[2]=-T[2],C[3]=T[3],C[4]=-T[4],C[5]=-T[5],C[6]=-T[6],C[7]=T[7],C},ai.normalize=function(C,T){var I=S(T);if(I>0){I=Math.sqrt(I);var D=T[0]/I,k=T[1]/I,F=T[2]/I,q=T[3]/I,H=T[4],U=T[5],$=T[6],Y=T[7],ie=D*H+k*U+F*$+q*Y;C[0]=D,C[1]=k,C[2]=F,C[3]=q,C[4]=(H-D*ie)/I,C[5]=(U-k*ie)/I,C[6]=($-F*ie)/I,C[7]=(Y-q*ie)/I}return C},ai.str=function(C){return"quat2("+C[0]+", "+C[1]+", "+C[2]+", "+C[3]+", "+C[4]+", "+C[5]+", "+C[6]+", "+C[7]+")"},ai.exactEquals=function(C,T){return C[0]===T[0]&&C[1]===T[1]&&C[2]===T[2]&&C[3]===T[3]&&C[4]===T[4]&&C[5]===T[5]&&C[6]===T[6]&&C[7]===T[7]},ai.equals=function(C,T){var I=C[0],D=C[1],k=C[2],F=C[3],q=C[4],H=C[5],U=C[6],$=C[7],Y=T[0],ie=T[1],he=T[2],ue=T[3],ce=T[4],Ie=T[5],de=T[6],Me=T[7];return Math.abs(I-Y)<=i.EPSILON*Math.max(1,Math.abs(I),Math.abs(Y))&&Math.abs(D-ie)<=i.EPSILON*Math.max(1,Math.abs(D),Math.abs(ie))&&Math.abs(k-he)<=i.EPSILON*Math.max(1,Math.abs(k),Math.abs(he))&&Math.abs(F-ue)<=i.EPSILON*Math.max(1,Math.abs(F),Math.abs(ue))&&Math.abs(q-ce)<=i.EPSILON*Math.max(1,Math.abs(q),Math.abs(ce))&&Math.abs(H-Ie)<=i.EPSILON*Math.max(1,Math.abs(H),Math.abs(Ie))&&Math.abs(U-de)<=i.EPSILON*Math.max(1,Math.abs(U),Math.abs(de))&&Math.abs($-Me)<=i.EPSILON*Math.max(1,Math.abs($),Math.abs(Me))},ai.sqrLen=ai.squaredLength=ai.len=ai.length=ai.dot=ai.mul=ai.setReal=ai.getReal=void 0;var i=h(ae()),a=h(Ai()),u=h(Ae());function m(C){if(typeof WeakMap!="function")return null;var T=new WeakMap,I=new WeakMap;return(m=function(D){return D?I:T})(C)}function h(C,T){if(C&&C.__esModule)return C;if(C===null||c(C)!=="object"&&typeof C!="function")return{default:C};var I=m(T);if(I&&I.has(C))return I.get(C);var D={},k=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var F in C)if(F!=="default"&&Object.prototype.hasOwnProperty.call(C,F)){var q=k?Object.getOwnPropertyDescriptor(C,F):null;q&&(q.get||q.set)?Object.defineProperty(D,F,q):D[F]=C[F]}return D.default=C,I&&I.set(C,D),D}function g(C,T,I){var D=.5*I[0],k=.5*I[1],F=.5*I[2],q=T[0],H=T[1],U=T[2],$=T[3];return C[0]=q,C[1]=H,C[2]=U,C[3]=$,C[4]=D*$+k*U-F*H,C[5]=k*$+F*q-D*U,C[6]=F*$+D*H-k*q,C[7]=-D*q-k*H-F*U,C}function b(C,T){return C[0]=T[0],C[1]=T[1],C[2]=T[2],C[3]=T[3],C[4]=T[4],C[5]=T[5],C[6]=T[6],C[7]=T[7],C}function E(C,T,I){var D=T[0],k=T[1],F=T[2],q=T[3],H=I[4],U=I[5],$=I[6],Y=I[7],ie=T[4],he=T[5],ue=T[6],ce=T[7],Ie=I[0],de=I[1],Me=I[2],ze=I[3];return C[0]=D*ze+q*Ie+k*Me-F*de,C[1]=k*ze+q*de+F*Ie-D*Me,C[2]=F*ze+q*Me+D*de-k*Ie,C[3]=q*ze-D*Ie-k*de-F*Me,C[4]=D*Y+q*H+k*$-F*U+ie*ze+ce*Ie+he*Me-ue*de,C[5]=k*Y+q*U+F*H-D*$+he*ze+ce*de+ue*Ie-ie*Me,C[6]=F*Y+q*$+D*U-k*H+ue*ze+ce*Me+ie*de-he*Ie,C[7]=q*Y-D*H-k*U-F*$+ce*ze-ie*Ie-he*de-ue*Me,C}ai.getReal=a.copy,ai.setReal=a.copy,ai.mul=E;var R=a.dot;ai.dot=R;var v=a.length;ai.length=v,ai.len=v;var S=a.squaredLength;return ai.squaredLength=S,ai.sqrLen=S,ai}var oi,Wi,$t={};function Nn(){if(oi)return $t;function c(T){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(I){return typeof I}:function(I){return I&&typeof Symbol=="function"&&I.constructor===Symbol&&I!==Symbol.prototype?"symbol":typeof I},c(T)}oi=1,Object.defineProperty($t,"__esModule",{value:!0}),$t.create=u,$t.clone=function(T){var I=new i.ARRAY_TYPE(2);return I[0]=T[0],I[1]=T[1],I},$t.fromValues=function(T,I){var D=new i.ARRAY_TYPE(2);return D[0]=T,D[1]=I,D},$t.copy=function(T,I){return T[0]=I[0],T[1]=I[1],T},$t.set=function(T,I,D){return T[0]=I,T[1]=D,T},$t.add=function(T,I,D){return T[0]=I[0]+D[0],T[1]=I[1]+D[1],T},$t.subtract=m,$t.multiply=h,$t.divide=g,$t.ceil=function(T,I){return T[0]=Math.ceil(I[0]),T[1]=Math.ceil(I[1]),T},$t.floor=function(T,I){return T[0]=Math.floor(I[0]),T[1]=Math.floor(I[1]),T},$t.min=function(T,I,D){return T[0]=Math.min(I[0],D[0]),T[1]=Math.min(I[1],D[1]),T},$t.max=function(T,I,D){return T[0]=Math.max(I[0],D[0]),T[1]=Math.max(I[1],D[1]),T},$t.round=function(T,I){return T[0]=Math.round(I[0]),T[1]=Math.round(I[1]),T},$t.scale=function(T,I,D){return T[0]=I[0]*D,T[1]=I[1]*D,T},$t.scaleAndAdd=function(T,I,D,k){return T[0]=I[0]+D[0]*k,T[1]=I[1]+D[1]*k,T},$t.distance=b,$t.squaredDistance=E,$t.length=R,$t.squaredLength=v,$t.negate=function(T,I){return T[0]=-I[0],T[1]=-I[1],T},$t.inverse=function(T,I){return T[0]=1/I[0],T[1]=1/I[1],T},$t.normalize=function(T,I){var D=I[0],k=I[1],F=D*D+k*k;return F>0&&(F=1/Math.sqrt(F)),T[0]=I[0]*F,T[1]=I[1]*F,T},$t.dot=function(T,I){return T[0]*I[0]+T[1]*I[1]},$t.cross=function(T,I,D){var k=I[0]*D[1]-I[1]*D[0];return T[0]=T[1]=0,T[2]=k,T},$t.lerp=function(T,I,D,k){var F=I[0],q=I[1];return T[0]=F+k*(D[0]-F),T[1]=q+k*(D[1]-q),T},$t.random=function(T,I){I=I||1;var D=2*i.RANDOM()*Math.PI;return T[0]=Math.cos(D)*I,T[1]=Math.sin(D)*I,T},$t.transformMat2=function(T,I,D){var k=I[0],F=I[1];return T[0]=D[0]*k+D[2]*F,T[1]=D[1]*k+D[3]*F,T},$t.transformMat2d=function(T,I,D){var k=I[0],F=I[1];return T[0]=D[0]*k+D[2]*F+D[4],T[1]=D[1]*k+D[3]*F+D[5],T},$t.transformMat3=function(T,I,D){var k=I[0],F=I[1];return T[0]=D[0]*k+D[3]*F+D[6],T[1]=D[1]*k+D[4]*F+D[7],T},$t.transformMat4=function(T,I,D){var k=I[0],F=I[1];return T[0]=D[0]*k+D[4]*F+D[12],T[1]=D[1]*k+D[5]*F+D[13],T},$t.rotate=function(T,I,D,k){var F=I[0]-D[0],q=I[1]-D[1],H=Math.sin(k),U=Math.cos(k);return T[0]=F*U-q*H+D[0],T[1]=F*H+q*U+D[1],T},$t.angle=function(T,I){var D=T[0],k=T[1],F=I[0],q=I[1],H=Math.sqrt(D*D+k*k)*Math.sqrt(F*F+q*q);return Math.acos(Math.min(Math.max(H&&(D*F+k*q)/H,-1),1))},$t.zero=function(T){return T[0]=0,T[1]=0,T},$t.str=function(T){return"vec2("+T[0]+", "+T[1]+")"},$t.exactEquals=function(T,I){return T[0]===I[0]&&T[1]===I[1]},$t.equals=function(T,I){var D=T[0],k=T[1],F=I[0],q=I[1];return Math.abs(D-F)<=i.EPSILON*Math.max(1,Math.abs(D),Math.abs(F))&&Math.abs(k-q)<=i.EPSILON*Math.max(1,Math.abs(k),Math.abs(q))},$t.forEach=$t.sqrLen=$t.sqrDist=$t.dist=$t.div=$t.mul=$t.sub=$t.len=void 0;var i=function(T,I){if(T&&T.__esModule)return T;if(T===null||c(T)!=="object"&&typeof T!="function")return{default:T};var D=a(void 0);if(D&&D.has(T))return D.get(T);var k={},F=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var q in T)if(q!=="default"&&Object.prototype.hasOwnProperty.call(T,q)){var H=F?Object.getOwnPropertyDescriptor(T,q):null;H&&(H.get||H.set)?Object.defineProperty(k,q,H):k[q]=T[q]}return k.default=T,D&&D.set(T,k),k}(ae());function a(T){if(typeof WeakMap!="function")return null;var I=new WeakMap,D=new WeakMap;return(a=function(k){return k?D:I})(T)}function u(){var T=new i.ARRAY_TYPE(2);return i.ARRAY_TYPE!=Float32Array&&(T[0]=0,T[1]=0),T}function m(T,I,D){return T[0]=I[0]-D[0],T[1]=I[1]-D[1],T}function h(T,I,D){return T[0]=I[0]*D[0],T[1]=I[1]*D[1],T}function g(T,I,D){return T[0]=I[0]/D[0],T[1]=I[1]/D[1],T}function b(T,I){return Math.hypot(I[0]-T[0],I[1]-T[1])}function E(T,I){var D=I[0]-T[0],k=I[1]-T[1];return D*D+k*k}function R(T){return Math.hypot(T[0],T[1])}function v(T){var I=T[0],D=T[1];return I*I+D*D}$t.len=R,$t.sub=m,$t.mul=h,$t.div=g,$t.dist=b,$t.sqrDist=E,$t.sqrLen=v;var S,C=(S=u(),function(T,I,D,k,F,q){var H,U;for(I||(I=2),D||(D=0),U=k?Math.min(k*I+D,T.length):T.length,H=D;H<U;H+=I)S[0]=T[H],S[1]=T[H+1],F(S,S,q),T[H]=S[0],T[H+1]=S[1];return T});return $t.forEach=C,$t}function _n(){if(Wi)return K;function c(T){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(I){return typeof I}:function(I){return I&&typeof Symbol=="function"&&I.constructor===Symbol&&I!==Symbol.prototype?"symbol":typeof I},c(T)}Wi=1,Object.defineProperty(K,"__esModule",{value:!0}),K.vec4=K.vec3=K.vec2=K.quat2=K.quat=K.mat4=K.mat3=K.mat2d=K.mat2=K.glMatrix=void 0;var i=C(ae());K.glMatrix=i;var a=C(Xe());K.mat2=a;var u=C(Ee());K.mat2d=u;var m=C(Ct());K.mat3=m;var h=C(Ae());K.mat4=h;var g=C(Ai());K.quat=g;var b=C(pn());K.quat2=b;var E=C(Nn());K.vec2=E;var R=C(pt());K.vec3=R;var v=C(Qt());function S(T){if(typeof WeakMap!="function")return null;var I=new WeakMap,D=new WeakMap;return(S=function(k){return k?D:I})(T)}function C(T,I){if(T&&T.__esModule)return T;if(T===null||c(T)!=="object"&&typeof T!="function")return{default:T};var D=S(I);if(D&&D.has(T))return D.get(T);var k={},F=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var q in T)if(q!=="default"&&Object.prototype.hasOwnProperty.call(T,q)){var H=F?Object.getOwnPropertyDescriptor(T,q):null;H&&(H.get||H.set)?Object.defineProperty(k,q,H):k[q]=T[q]}return k.default=T,D&&D.set(T,k),k}return K.vec4=v,K}var Sr,Cs,Rs,ss,ke=_n(),rr=function(){if(Cs)return Sr;function c(i,a,u,m){this.cx=3*i,this.bx=3*(u-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(m-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=a,this.p2x=u,this.p2y=m}return Cs=1,Sr=c,c.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,a){if(a===void 0&&(a=1e-6),i<0)return 0;if(i>1)return 1;for(var u=i,m=0;m<8;m++){var h=this.sampleCurveX(u)-i;if(Math.abs(h)<a)return u;var g=this.sampleCurveDerivativeX(u);if(Math.abs(g)<1e-6)break;u-=h/g}var b=0,E=1;for(u=i,m=0;m<20&&(h=this.sampleCurveX(u),!(Math.abs(h-i)<a));m++)i>h?b=u:E=u,u=.5*(E-b)+b;return u},solve:function(i,a){return this.sampleCurveY(this.solveCurveX(i,a))}},Sr}(),pa=N(rr);function Zs(){if(ss)return Rs;function c(i,a){this.x=i,this.y=a}return ss=1,Rs=c,c.prototype={clone:function(){return new c(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,a){return this.clone()._rotateAround(i,a)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var a=i.x-this.x,u=i.y-this.y;return a*a+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,a){return Math.atan2(this.x*a-this.y*i,this.x*i+this.y*a)},_matMult:function(i){var a=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=a,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var a=Math.cos(i),u=Math.sin(i),m=u*this.x+a*this.y;return this.x=a*this.x-u*this.y,this.y=m,this},_rotateAround:function(i,a){var u=Math.cos(i),m=Math.sin(i),h=a.y+m*(this.x-a.x)+u*(this.y-a.y);return this.x=a.x+u*(this.x-a.x)-m*(this.y-a.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},c.convert=function(i){return i instanceof c?i:Array.isArray(i)?new c(i[0],i[1]):i},Rs}var St=N(Zs());function cr(c,i){if(Array.isArray(c)){if(!Array.isArray(i)||c.length!==i.length)return!1;for(let a=0;a<c.length;a++)if(!cr(c[a],i[a]))return!1;return!0}if(typeof c=="object"&&c!==null&&i!==null){if(typeof i!="object"||Object.keys(c).length!==Object.keys(i).length)return!1;for(const a in c)if(!cr(c[a],i[a]))return!1;return!0}return c===i}const Wr=Math.PI/180,Ko=180/Math.PI;function Li(c){return c*Wr}function vr(c){return c*Ko}const Ds=[[0,0],[1,0],[1,1],[0,1]];function Da(c){if(c<=0)return 0;if(c>=1)return 1;const i=c*c,a=i*c;return 4*(c<.5?a:3*(c-i)+a-.75)}function go(c,i,a,u){const m=new pa(c,i,a,u);return function(h){return m.solve(h)}}const Qo=go(.25,.1,.25,1);function bi(c,i,a){return Math.min(a,Math.max(i,c))}function Ws(c,i,a){return(a=bi((a-c)/(i-c),0,1))*a*(3-2*a)}function Ps(c,i,a){const u=a-i,m=((c-i)%u+u)%u+i;return m===i?a:m}function Yn(c,i,a){if(!c.length)return a(null,[]);let u=c.length;const m=new Array(c.length);let h=null;c.forEach((g,b)=>{i(g,(E,R)=>{E&&(h=E),m[b]=R,--u==0&&a(h,m)})})}function Sn(c,...i){for(const a of i)for(const u in a)c[u]=a[u];return c}let Xs=1;function _o(){return Xs++}function Jo(c){return c<=1?1:Math.pow(2,Math.ceil(Math.log(c)/Math.LN2))}function Rl(c,i){c.forEach(a=>{i[a]&&(i[a]=i[a].bind(i))})}function Ar(c,i){return c.indexOf(i,c.length-i.length)!==-1}function el(c,i,a){const u={};for(const m in c)u[m]=i.call(this,c[m],m,c);return u}function tl(c,i,a){const u={};for(const m in c)i.call(this,c[m],m,c)&&(u[m]=c[m]);return u}function as(c){return Array.isArray(c)?c.map(as):typeof c=="object"&&c?el(c,as):c}const il={};function yi(c){il[c]||(typeof console<"u"&&console.warn(c),il[c]=!0)}function Ys(c,i,a){return(a.y-c.y)*(i.x-c.x)>(i.y-c.y)*(a.x-c.x)}function gc(c){let i=0;for(let a,u,m=0,h=c.length,g=h-1;m<h;g=m++)a=c[m],u=c[g],i+=(u.x-a.x)*(a.y+u.y);return i}function os([c,i,a]){const u=Li(i+90),m=Li(a);return{x:c*Math.cos(u)*Math.sin(m),y:c*Math.sin(u)*Math.sin(m),z:c*Math.cos(m),azimuthal:i,polar:a}}function Ls(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function yo(c){const i={};if(c.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(a,u,m,h)=>{const g=m||h;return i[u]=!g||g.toLowerCase(),""}),i["max-age"]){const a=parseInt(i["max-age"],10);isNaN(a)?delete i["max-age"]:i["max-age"]=a}return i}let vo=null;function Ks(c,i){return[c[4*i],c[4*i+1],c[4*i+2],c[4*i+3]]}function _c(c,i,a,u){for(;i<a;){const m=i+a>>1;c[m]<u?i=m+1:a=m}return i}function Ha(c,i,a,u){for(;i<a;){const m=i+a>>1;c[m]<=u?i=m+1:a=m}return i}function yc(c){return c>0?1/(1.001-c):1+c}function xo(c){return c>0?1-1/(1.001-c):-c}const Kn={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Kn.API_URL)return null;try{const c=new URL(Kn.API_URL);return c.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":c.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Ir(c){return Kn.API_URL_REGEX.test(c)}function vc(c){return Kn.API_SPRITE_REGEX.test(c)}let $a,sr,Pa,nt,X,ne;function oe(){return $a==null&&($a=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),$a}const ye={now:()=>nt!==void 0?nt:performance.now(),setNow(c){nt=c},restoreNow(){nt=void 0},frame(c){const i=requestAnimationFrame(c);return{cancel:()=>cancelAnimationFrame(i)}},getImageData(c,i=0){const{width:a,height:u}=c;X||(X=document.createElement("canvas"));const m=X.getContext("2d",{willReadFrequently:!0});if(!m)throw new Error("failed to create canvas 2d context");return(a>X.width||u>X.height)&&(X.width=a,X.height=u),m.clearRect(-i,-i,a+2*i,u+2*i),m.drawImage(c,0,0,a,u),m.getImageData(-i,-i,a+2*i,u+2*i)},resolveURL:c=>(sr||(sr=document.createElement("a")),sr.href=c,sr.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Pa==null&&(Pa=window.matchMedia("(prefers-reduced-motion: reduce)")),Pa.matches)},hasCanvasFingerprintNoise(){if(ne!==void 0)return ne;if(!oe())return ne=!1,!1;const c=new OffscreenCanvas(85,1),i=c.getContext("2d",{willReadFrequently:!0});let a=0;for(let m=0;m<c.width;++m)i.fillStyle=`rgba(${a++},${a++},${a++}, 255)`,i.fillRect(m,0,1,1);const u=i.getImageData(0,0,c.width,c.height);a=0;for(let m=0;m<u.data.length;++m)if(m%4!=3&&a++!==u.data[m])return ne=!0,!0;return ne=!1,!1}};function ve(c,i){const a=c.indexOf("?");if(a<0)return`${c}?${new URLSearchParams(i).toString()}`;const u=new URLSearchParams(c.slice(a));for(const m in i)u.set(m,i[m]);return`${c.slice(0,a)}?${u.toString()}`}function Le(c,i={persistentParams:[]}){const a=c.indexOf("?");if(a<0)return c;const u=new URLSearchParams,m=new URLSearchParams(c.slice(a));for(const g of i.persistentParams){const b=m.get(g);b&&u.set(g,b)}const h=u.toString();return`${c.slice(0,a)}${h.length>0?`?${h}`:""}`}const Ge="mapbox-tiles";let Oe=500,et=50;const Je=["language","worldview","jobid"];let tt,mt;function At(){try{return caches}catch{}}function Rt(){const c=At();c&&tt==null&&(tt=c.open(Ge))}let Jt=1/0;const si={supported:!1,testSupport:function(c){!Si&&ii&&(Ii?Vi(c):ci=c)}};let ci,ii,Si=!1,Ii=!1;const wi=typeof self<"u"?self:{};function Vi(c){const i=c.createTexture();c.bindTexture(c.TEXTURE_2D,i);try{if(c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,ii),c.isContextLost())return;si.supported=!0}catch{}c.deleteTexture(i),Si=!0}wi.document&&(ii=wi.document.createElement("img"),ii.onload=function(){ci&&Vi(ci),ci=null,Ii=!0},ii.onerror=function(){Si=!0,ci=null},ii.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Ui={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Ui);class Un extends Error{constructor(i,a,u){a===401&&Ir(u)&&(i+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(i),this.status=a,this.url=u}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const ma=Ls()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,qn=function(c,i){if(!(/^file:/.test(a=c.url)||/^file:/.test(ma())&&!/^\w+:/.test(a))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(u,m){const h=new AbortController,g=new Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,referrer:ma(),referrerPolicy:u.referrerPolicy,signal:h.signal});let b=!1,E=!1;const R=(v=g.url).indexOf("sku=")>0&&Ir(v);var v;u.type==="json"&&g.headers.set("Accept","application/json");const S=(T,I,D)=>{if(E)return;if(T&&T.message!=="SecurityError"&&yi(T.toString()),I&&D)return C(I);const k=Date.now();fetch(g).then(F=>{if(F.ok){const q=R?F.clone():null;return C(F,q,k)}return m(new Un(F.statusText,F.status,u.url))}).catch(F=>{F.name!=="AbortError"&&m(new Error(`${F.message} ${u.url}`))})},C=(T,I,D)=>{(u.type==="arrayBuffer"?T.arrayBuffer():u.type==="json"?T.json():T.text()).then(k=>{E||(I&&D&&function(F,q,H){if(Rt(),tt==null)return;const U=yo(q.headers.get("Cache-Control")||"");if(U["no-store"])return;const $={status:q.status,statusText:q.statusText,headers:new Headers};q.headers.forEach((he,ue)=>$.headers.set(ue,he)),U["max-age"]&&$.headers.set("Expires",new Date(H+1e3*U["max-age"]).toUTCString());const Y=$.headers.get("Expires");if(!Y||new Date(Y).getTime()-H<42e4)return;let ie=Le(F.url,{persistentParams:Je});if(q.status===206){const he=F.headers.get("Range");if(!he)return;$.status=200,ie=ve(ie,{range:he})}(function(he,ue){if(mt===void 0)try{new Response(new ReadableStream),mt=!0}catch{mt=!1}mt?ue(he.body):he.blob().then(ue)})(q,he=>{const ue=new Response((ce=q.status)!==200&&ce!==404&&[101,103,204,205,304].includes(ce)?null:he,$);var ce;Rt(),tt!=null&&tt.then(Ie=>Ie.put(ie,ue)).catch(Ie=>yi(Ie.message))})}(g,I,D),b=!0,m(null,k,T.headers.get("Cache-Control"),T.headers.get("Expires")))}).catch(k=>{E||m(new Error(k.message))})};return R?function(T,I){if(Rt(),tt==null)return I(null);tt.then(D=>{let k=Le(T.url,{persistentParams:Je});const F=T.headers.get("Range");F&&(k=ve(k,{range:F})),D.match(k).then(q=>{const H=function(U){if(!U)return!1;const $=new Date(U.headers.get("Expires")||0),Y=yo(U.headers.get("Cache-Control")||"");return $>Date.now()&&!Y["no-cache"]}(q);D.delete(k),H&&D.put(k,q.clone()),I(null,q,H)}).catch(I)}).catch(I)}(g,S):S(null,null),{cancel:()=>{E=!0,b||h.abort()}}}(c,i);if(Ls()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",c,i,void 0,!0)}var a;return function(u,m){const h=new XMLHttpRequest;h.open(u.method||"GET",u.url,!0),u.type==="arrayBuffer"&&(h.responseType="arraybuffer");for(const g in u.headers)h.setRequestHeader(g,u.headers[g]);return u.type==="json"&&(h.responseType="text",h.setRequestHeader("Accept","application/json")),h.withCredentials=u.credentials==="include",h.onerror=()=>{m(new Error(h.statusText))},h.onload=()=>{if((h.status>=200&&h.status<300||h.status===0)&&h.response!==null){let g=h.response;if(u.type==="json")try{g=JSON.parse(h.response)}catch(b){return m(b)}m(null,g,h.getResponseHeader("Cache-Control"),h.getResponseHeader("Expires"))}else m(new Un(h.statusText,h.status,u.url))},h.send(u.body),{cancel:()=>h.abort()}}(c,i)},Qn=function(c,i){return qn(Sn(c,{type:"arrayBuffer"}),i)};function Ur(c){const i=document.createElement("a");return i.href=c,i.protocol===location.protocol&&i.host===location.host}const Dl="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Za,xc;Za=[],xc=0;const Eu=function(c,i){if(si.supported&&(c.headers||(c.headers={}),c.headers.accept="image/webp,*/*"),xc>=Kn.MAX_PARALLEL_IMAGE_REQUESTS){const h={requestParameters:c,callback:i,cancelled:!1,cancel(){this.cancelled=!0}};return Za.push(h),h}xc++;let a=!1;const u=()=>{if(!a)for(a=!0,xc--;Za.length&&xc<Kn.MAX_PARALLEL_IMAGE_REQUESTS;){const h=Za.shift(),{requestParameters:g,callback:b,cancelled:E}=h;E||(h.cancel=Eu(g,b).cancel)}},m=Qn(c,(h,g,b,E)=>{u(),h?i(h):g&&(self.createImageBitmap?function(R,v){const S=new Blob([new Uint8Array(R)],{type:"image/png"});createImageBitmap(S).then(C=>{v(null,C)}).catch(C=>{v(new Error(`Could not load image because of ${C.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(g,(R,v)=>i(R,v,b,E)):function(R,v){const S=new Image;S.onload=()=>{v(null,S),URL.revokeObjectURL(S.src),S.onload=null,requestAnimationFrame(()=>{S.src=Dl})},S.onerror=()=>v(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const C=new Blob([new Uint8Array(R)],{type:"image/png"});S.src=R.byteLength?URL.createObjectURL(C):Dl}(g,(R,v)=>i(R,v,b,E)))});return{cancel:()=>{m.cancel(),u()}}};var ad,od,Wa,Gn={exports:{}},vs={exports:{}},Qs={exports:{}},ga=function(){if(Wa)return Gn.exports;Wa=1;var c=(ad||(ad=1,vs.exports=function(a,u){var m,h,g,b,E,R,v,S;for(h=a.length-(m=3&a.length),g=u,E=3432918353,R=461845907,S=0;S<h;)v=255&a.charCodeAt(S)|(255&a.charCodeAt(++S))<<8|(255&a.charCodeAt(++S))<<16|(255&a.charCodeAt(++S))<<24,++S,g=27492+(65535&(b=5*(65535&(g=(g^=v=(65535&(v=(v=(65535&v)*E+(((v>>>16)*E&65535)<<16)&4294967295)<<15|v>>>17))*R+(((v>>>16)*R&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(b>>>16)&65535)<<16);switch(v=0,m){case 3:v^=(255&a.charCodeAt(S+2))<<16;case 2:v^=(255&a.charCodeAt(S+1))<<8;case 1:g^=v=(65535&(v=(v=(65535&(v^=255&a.charCodeAt(S)))*E+(((v>>>16)*E&65535)<<16)&4294967295)<<15|v>>>17))*R+(((v>>>16)*R&65535)<<16)&4294967295}return g^=a.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0}),vs.exports),i=(od||(od=1,Qs.exports=function(a,u){for(var m,h=a.length,g=u^h,b=0;h>=4;)m=1540483477*(65535&(m=255&a.charCodeAt(b)|(255&a.charCodeAt(++b))<<8|(255&a.charCodeAt(++b))<<16|(255&a.charCodeAt(++b))<<24))+((1540483477*(m>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(m=1540483477*(65535&(m^=m>>>24))+((1540483477*(m>>>16)&65535)<<16)),h-=4,++b;switch(h){case 3:g^=(255&a.charCodeAt(b+2))<<16;case 2:g^=(255&a.charCodeAt(b+1))<<8;case 1:g=1540483477*(65535&(g^=255&a.charCodeAt(b)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0}),Qs.exports);return Gn.exports=c,Gn.exports.murmur3=c,Gn.exports.murmur2=i,Gn.exports}(),an=N(ga);class zs{constructor(i,...a){Sn(this,a[0]||{}),this.type=i}}class bo extends zs{constructor(i,a={}){super("error",Sn({error:i},a))}}function nl(c,i,a){a[c]&&a[c].indexOf(i)!==-1||(a[c]=a[c]||[],a[c].push(i))}function wo(c,i,a){if(a&&a[c]){const u=a[c].indexOf(i);u!==-1&&a[c].splice(u,1)}}class Xa{on(i,a){return this._listeners=this._listeners||{},nl(i,a,this._listeners),this}off(i,a){return wo(i,a,this._listeners),wo(i,a,this._oneTimeListeners),this}once(i,a){return a?(this._oneTimeListeners=this._oneTimeListeners||{},nl(i,a,this._oneTimeListeners),this):new Promise(u=>this.once(i,u))}fire(i,a){const u=typeof i=="string"?new zs(i,a):i,m=u.type;if(this.listens(m)){u.target=this;const h=this._listeners&&this._listeners[m]?this._listeners[m].slice():[];for(const E of h)E.call(this,u);const g=this._oneTimeListeners&&this._oneTimeListeners[m]?this._oneTimeListeners[m].slice():[];for(const E of g)wo(m,E,this._oneTimeListeners),E.call(this,u);const b=this._eventedParent;b&&(Sn(u,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),b.fire(u))}else u instanceof bo&&console.error(u.error);return this}listens(i){return!!(this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i))}setEventedParent(i,a){return this._eventedParent=i,this._eventedParentData=a,this}}var Ff,ld={},Js=function(){if(Ff)return ld;Ff=1;var c={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function i(h){return(h=Math.round(h))<0?0:h>255?255:h}function a(h){return i(h[h.length-1]==="%"?parseFloat(h)/100*255:parseInt(h))}function u(h){return(g=h[h.length-1]==="%"?parseFloat(h)/100:parseFloat(h))<0?0:g>1?1:g;var g}function m(h,g,b){return b<0?b+=1:b>1&&(b-=1),6*b<1?h+(g-h)*b*6:2*b<1?g:3*b<2?h+(g-h)*(2/3-b)*6:h}try{ld.parseCSSColor=function(h){var g,b=h.replace(/ /g,"").toLowerCase();if(b in c)return c[b].slice();if(b[0]==="#")return b.length===4?(g=parseInt(b.substr(1),16))>=0&&g<=4095?[(3840&g)>>4|(3840&g)>>8,240&g|(240&g)>>4,15&g|(15&g)<<4,1]:null:b.length===7&&(g=parseInt(b.substr(1),16))>=0&&g<=16777215?[(16711680&g)>>16,(65280&g)>>8,255&g,1]:null;var E=b.indexOf("("),R=b.indexOf(")");if(E!==-1&&R+1===b.length){var v=b.substr(0,E),S=b.substr(E+1,R-(E+1)).split(","),C=1;switch(v){case"rgba":if(S.length!==4)return null;C=u(S.pop());case"rgb":return S.length!==3?null:[a(S[0]),a(S[1]),a(S[2]),C];case"hsla":if(S.length!==4)return null;C=u(S.pop());case"hsl":if(S.length!==3)return null;var T=(parseFloat(S[0])%360+360)%360/360,I=u(S[1]),D=u(S[2]),k=D<=.5?D*(I+1):D+I-D*I,F=2*D-k;return[i(255*m(F,k,T+1/3)),i(255*m(F,k,T)),i(255*m(F,k,T-1/3)),C];default:return null}}return null}}catch{}return ld}();class $i{constructor(i,a,u,m=1){this.r=i,this.g=a,this.b=u,this.a=m}static parse(i){if(!i)return;if(i instanceof $i)return i;if(typeof i!="string")return;const a=Js.parseCSSColor(i);return a?new $i(a[0]/255*a[3],a[1]/255*a[3],a[2]/255*a[3],a[3]):void 0}toStringPremultipliedAlpha(){const[i,a,u,m]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(i)},${Math.round(a)},${Math.round(u)},${m})`}toString(){const[i,a,u,m]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*i)},${Math.round(255*a)},${Math.round(255*u)},${m})`}toRenderColor(i){const{r:a,g:u,b:m,a:h}=this;return new rl(i,a,u,m,h)}clone(){return new $i(this.r,this.g,this.b,this.a)}}class rl{constructor(i,a,u,m,h){if(i){const g=i.image.height,b=g*g;a=h===0?0:a/h*(g-1),u=h===0?0:u/h*(g-1),m=h===0?0:m/h*(g-1);const E=Math.floor(a),R=Math.floor(u),v=Math.floor(m),S=Math.ceil(a),C=Math.ceil(u),T=Math.ceil(m),I=a-E,D=u-R,k=m-v,F=i.image.data,q=4*(E+R*b+v*g),H=4*(E+R*b+T*g),U=4*(E+C*b+v*g),$=4*(E+C*b+T*g),Y=4*(S+R*b+v*g),ie=4*(S+R*b+T*g),he=4*(S+C*b+v*g),ue=4*(S+C*b+T*g);if(q<0||ue>=F.length)throw new Error("out of range");this.r=ei(ei(ei(F[q],F[H],k),ei(F[U],F[$],k),D),ei(ei(F[Y],F[ie],k),ei(F[he],F[ue],k),D),I)/255*h,this.g=ei(ei(ei(F[q+1],F[H+1],k),ei(F[U+1],F[$+1],k),D),ei(ei(F[Y+1],F[ie+1],k),ei(F[he+1],F[ue+1],k),D),I)/255*h,this.b=ei(ei(ei(F[q+2],F[H+2],k),ei(F[U+2],F[$+2],k),D),ei(ei(F[Y+2],F[ie+2],k),ei(F[he+2],F[ue+2],k),D),I)/255*h,this.a=h}else this.r=a,this.g=u,this.b=m,this.a=h}toArray(){const{r:i,g:a,b:u,a:m}=this;return m===0?[0,0,0,0]:[255*i/m,255*a/m,255*u/m,m]}toHslaArray(){if(this.a===0)return[0,0,0,0];const{r:i,g:a,b:u,a:m}=this,h=Math.min(Math.max(i/m,0),1),g=Math.min(Math.max(a/m,0),1),b=Math.min(Math.max(u/m,0),1),E=Math.min(h,g,b),R=Math.max(h,g,b),v=(E+R)/2;if(E===R)return[0,0,100*v,m];const S=R-E,C=v>.5?S/(2-R-E):S/(R+E);let T=0;return R===h?T=(g-b)/S+(g<b?6:0):R===g?T=(b-h)/S+2:R===b&&(T=(h-g)/S+4),T*=60,[Math.min(Math.max(T,0),360),Math.min(Math.max(100*C,0),100),Math.min(Math.max(100*v,0),100),m]}toArray01(){const{r:i,g:a,b:u,a:m}=this;return m===0?[0,0,0,0]:[i/m,a/m,u/m,m]}toArray01Scaled(i){const{r:a,g:u,b:m,a:h}=this;return h===0?[0,0,0]:[a/h*i,u/h*i,m/h*i]}toArray01PremultipliedAlpha(){const{r:i,g:a,b:u,a:m}=this;return[i,a,u,m]}toArray01Linear(){const{r:i,g:a,b:u,a:m}=this;return m===0?[0,0,0,0]:[Math.pow(i/m,2.2),Math.pow(a/m,2.2),Math.pow(u/m,2.2),m]}}function ei(c,i,a){return c*(1-a)+i*a}function cd(c,i,a){return c.map((u,m)=>ei(u,i[m],a))}$i.black=new $i(0,0,0,1),$i.white=new $i(1,1,1,1),$i.transparent=new $i(0,0,0,0),$i.red=new $i(1,0,0,1),$i.blue=new $i(0,0,1,1);var bc=Object.freeze({__proto__:null,array:cd,color:function(c,i,a){return new $i(ei(c.r,i.r,a),ei(c.g,i.g,a),ei(c.b,i.b,a),ei(c.a,i.a,a))},number:ei});function wc(c,...i){for(const a of i)for(const u in a)c[u]=a[u];return c}class vi extends Error{constructor(i,a){super(a),this.message=a,this.key=i}}class Su{constructor(i,a=[]){this.parent=i,this.bindings={};for(const[u,m]of a)this.bindings[u]=m}concat(i){return new Su(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)}}const sl={kind:"null"},qt={kind:"number"},zi={kind:"string"},Ni={kind:"boolean"},jr={kind:"color"},ea={kind:"object"},Oi={kind:"value"},Pl={kind:"collator"},xs={kind:"formatted"},Ya={kind:"resolvedImage"};function xr(c,i){return{kind:"array",itemType:c,N:i}}function Rn(c){if(c.kind==="array"){const i=Rn(c.itemType);return typeof c.N=="number"?`array<${i}, ${c.N}>`:c.itemType.kind==="value"?"array":`array<${i}>`}return c.kind}const Hn=[sl,qt,zi,Ni,jr,xs,ea,xr(Oi),Ya];function ls(c,i){if(i.kind==="error")return null;if(c.kind==="array"){if(i.kind==="array"&&(i.N===0&&i.itemType.kind==="value"||!ls(c.itemType,i.itemType))&&(typeof c.N!="number"||c.N===i.N))return null}else{if(c.kind===i.kind)return null;if(c.kind==="value"){for(const a of Hn)if(!ls(a,i))return null}}return`Expected ${Rn(c)} but found ${Rn(i)} instead.`}function Au(c,i){return i.some(a=>a.kind===c.kind)}function Ll(c,i){return i.some(a=>a==="null"?c===null:a==="array"?Array.isArray(c):a==="object"?c&&!Array.isArray(c)&&typeof c=="object":a===typeof c)}class Tc{constructor(i,a,u){this.sensitivity=i?a?"variant":"case":a?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,a){return this.collator.compare(i,a)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class zl{constructor(i,a,u,m,h){this.text=i.normalize?i.normalize():i,this.image=a,this.scale=u,this.fontStack=m,this.textColor=h}}class br{constructor(i){this.sections=i}static fromString(i){return new br([new zl(i,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(i=>i.text.length!==0||i.image&&i.image.namePrimary)}static factory(i){return i instanceof br?i:br.fromString(i)}toString(){return this.sections.length===0?"":this.sections.map(i=>i.text).join("")}serialize(){const i=["format"];for(const a of this.sections){if(a.image){i.push(["image",a.image.namePrimary]);continue}i.push(a.text);const u={};a.fontStack&&(u["text-font"]=["literal",a.fontStack.split(",")]),a.scale&&(u["font-scale"]=a.scale),a.textColor&&(u["text-color"]=["rgba"].concat(a.textColor.toRenderColor(null).toArray())),i.push(u)}return i}}class _a{constructor(i,a){if(this.id=i,this.options=a||{params:{}},this.options.transform){const{a:u,b:m,c:h,d:g,e:b,f:E}=this.options.transform;this.options.transform=new DOMMatrix([u,m,h,g,b,E])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}static deserializeId(i){return JSON.parse(i).id}static deserializeFromString(i){const a=JSON.parse(i),{a:u,b:m,c:h,d:g,e:b,f:E}=a.options.transform;return new DOMMatrix([u,m,h,g,b,E]),new _a(a.id,a.options)}scaleSelf(i){return this.options.transform=this.options.transform.scale(i),this}serialize(){const i={id:this.id};this.options&&(i.options=this.options);const{a,b:u,c:m,d:h,e:g,f:b}=this.options.transform;return i.options.transform={a,b:u,c:m,d:h,e:g,f:b},JSON.stringify(i)}}class Fn{constructor(i){this.namePrimary=i.namePrimary,i.nameSecondary&&(this.nameSecondary=i.nameSecondary),i.optionsPrimary&&(this.optionsPrimary=i.optionsPrimary),i.optionsSecondary&&(this.optionsSecondary=i.optionsSecondary),this.available=i.available}toString(){return this.namePrimary&&this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}getPrimary(){return new _a(this.namePrimary,{params:this.optionsPrimary&&this.optionsPrimary.params||{}})}getSerializedPrimary(){return this.getPrimary().serialize()}getSecondary(){return this.nameSecondary?new _a(this.nameSecondary,{params:this.optionsSecondary&&this.optionsSecondary.params||{}}):null}static from(i){return typeof i=="string"?Fn.build(i):i}static build(i,a,u,m){return i?new Fn({namePrimary:i,nameSecondary:a,optionsPrimary:u,optionsSecondary:m,available:!1}):null}}function Iu(c,i,a,u){return typeof c=="number"&&c>=0&&c<=255&&typeof i=="number"&&i>=0&&i<=255&&typeof a=="number"&&a>=0&&a<=255?u===void 0||typeof u=="number"&&u>=0&&u<=1?null:`Invalid rgba value [${[c,i,a,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof u=="number"?[c,i,a,u]:[c,i,a]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ka(c){if(c===null||typeof c=="string"||typeof c=="boolean"||typeof c=="number"||c instanceof $i||c instanceof Tc||c instanceof br||c instanceof Fn)return!0;if(Array.isArray(c)){for(const i of c)if(!Ka(i))return!1;return!0}if(typeof c=="object"){for(const i in c)if(!Ka(c[i]))return!1;return!0}return!1}function yn(c){if(c===null)return sl;if(typeof c=="string")return zi;if(typeof c=="boolean")return Ni;if(typeof c=="number")return qt;if(c instanceof $i)return jr;if(c instanceof Tc)return Pl;if(c instanceof br)return xs;if(c instanceof Fn)return Ya;if(Array.isArray(c)){const i=c.length;let a;for(const u of c){const m=yn(u);if(a){if(a===m)continue;a=Oi;break}a=m}return xr(a||Oi,i)}return ea}function Os(c){const i=typeof c;return c===null?"":i==="string"||i==="number"||i==="boolean"?String(c):c instanceof $i?c.toStringPremultipliedAlpha():c instanceof br||c instanceof Fn?c.toString():JSON.stringify(c)}class ur{constructor(i,a){this.type=i,this.value=a}static parse(i,a){if(i.length!==2)return a.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!Ka(i[1]))return a.error("invalid value");const u=i[1];let m=yn(u);const h=a.expectedType;return m.kind!=="array"||m.N!==0||!h||h.kind!=="array"||typeof h.N=="number"&&h.N!==0||(m=h),new ur(m,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof $i?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof br?this.value.serialize():this.value}}class Ln{constructor(i){this.name="ExpressionEvaluationError",this.message=i}toJSON(){return this.message}}const Ol={string:zi,number:qt,boolean:Ni,object:ea};class bs{constructor(i,a){this.type=i,this.args=a}static parse(i,a){if(i.length<2)return a.error("Expected at least one argument.");let u,m=1;const h=i[0];if(h==="array"){let b,E;if(i.length>2){const R=i[1];if(typeof R!="string"||!(R in Ol)||R==="object")return a.error('The item type argument of "array" must be one of string, number, boolean',1);b=Ol[R],m++}else b=Oi;if(i.length>3){if(i[2]!==null&&(typeof i[2]!="number"||i[2]<0||i[2]!==Math.floor(i[2])))return a.error('The length argument to "array" must be a positive integer literal',2);E=i[2],m++}u=xr(b,E)}else u=Ol[h];const g=[];for(;m<i.length;m++){const b=a.parse(i[m],m,Oi);if(!b)return null;g.push(b)}return new bs(u,g)}evaluate(i){for(let a=0;a<this.args.length;a++){const u=this.args[a].evaluate(i);if(!ls(this.type,yn(u)))return u;if(a===this.args.length-1)throw new Ln(`The expression ${JSON.stringify(this.args[a].serialize())} evaluated to ${Rn(yn(u))} but was expected to be of type ${Rn(this.type)}.`)}return null}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=this.type,a=[i.kind];if(i.kind==="array"){const u=i.itemType;if(u.kind==="string"||u.kind==="number"||u.kind==="boolean"){a.push(u.kind);const m=i.N;(typeof m=="number"||this.args.length>1)&&a.push(m)}}return a.concat(this.args.map(u=>u.serialize()))}}class al{constructor(i){this.type=xs,this.sections=i}static parse(i,a){if(i.length<2)return a.error("Expected at least one argument.");const u=i[1];if(!Array.isArray(u)&&typeof u=="object")return a.error("First argument must be an image or text section.");const m=[];let h=!1;for(let g=1;g<=i.length-1;++g){const b=i[g];if(h&&typeof b=="object"&&!Array.isArray(b)){h=!1;let E=null;if(b["font-scale"]&&(E=a.parseObjectValue(b["font-scale"],g,"font-scale",qt),!E))return null;let R=null;if(b["text-font"]&&(R=a.parseObjectValue(b["text-font"],g,"text-font",xr(zi)),!R))return null;let v=null;if(b["text-color"]&&(v=a.parseObjectValue(b["text-color"],g,"text-color",jr),!v))return null;const S=m[m.length-1];S.scale=E,S.font=R,S.textColor=v}else{const E=a.parse(i[g],g,Oi);if(!E)return null;const R=E.type.kind;if(R!=="string"&&R!=="value"&&R!=="null"&&R!=="resolvedImage")return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");h=!0,m.push({content:E,scale:null,font:null,textColor:null})}}return new al(m)}evaluate(i){return new br(this.sections.map(a=>{const u=a.content.evaluate(i);return yn(u)===Ya?new zl("",u,null,null,null):new zl(Os(u),null,a.scale?a.scale.evaluate(i):null,a.font?a.font.evaluate(i).join(","):null,a.textColor?a.textColor.evaluate(i):null)}))}eachChild(i){for(const a of this.sections)i(a.content),a.scale&&i(a.scale),a.font&&i(a.font),a.textColor&&i(a.textColor)}outputDefined(){return!1}serialize(){const i=["format"];for(const a of this.sections){i.push(a.content.serialize());const u={};a.scale&&(u["font-scale"]=a.scale.serialize()),a.font&&(u["text-font"]=a.font.serialize()),a.textColor&&(u["text-color"]=a.textColor.serialize()),i.push(u)}return i}}class kl{constructor(i,a,u,m){this._imageWarnHistory={},this.type=Ya,this.inputPrimary=i,this.inputSecondary=a,this.inputPrimaryParams=u,this.inputSecondaryParams=m}static parse(i,a){if(i.length<2)return a.error("Expected two or more arguments.");let u=1;const m=[];function h(){if(u<i.length){const b=a.parse(i[u],u++,zi);return b?(m.push({image:b,options:void 0}),!0):(a.error(m.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function g(){if(u<i.length){if((b=i[u])===null||typeof b!="object"||Array.isArray(b))return!0;const E=i[u].params,R=a.concat(u);if(!E)return u++,!0;if(typeof E!="object"||E.constructor!==Object)return R.error('Image options "params" should be an object'),!1;const v={},S=R.concat(void 0,"params");for(const C in E){if(!C)return S.error("Image parameter name should be non-empty"),!1;const T=S.concat(void 0,C).parse(E[C],void 0,jr,void 0,{typeAnnotation:"coerce"});if(!T)return!1;v[C]=T}return m[m.length-1].options=v,u++,!0}var b;return!0}for(let b=0;b<2;b++)if(!h()||!g())return;return new kl(m[0].image,m[1]?m[1].image:void 0,m[0].options,m[1]?m[1].options:void 0)}evaluateParams(i,a){const u={};if(a){for(const m in a)if(a[m])try{const h=a[m].evaluate(i),g=`Ignoring image parameter "${m}" with semi-transparent color ${h.toString()}`;if(h.a!==1){this._imageWarnHistory[g]||(console.warn(g),this._imageWarnHistory[g]=!0);continue}u[m]=h}catch{continue}if(Object.keys(u).length!==0)return{params:u}}}evaluate(i){const a=Fn.build(this.inputPrimary.evaluate(i),this.inputSecondary?this.inputSecondary.evaluate(i):void 0,this.inputPrimaryParams?this.evaluateParams(i,this.inputPrimaryParams):void 0,this.inputSecondaryParams?this.evaluateParams(i,this.inputSecondaryParams):void 0);return a&&i.availableImages&&(a.available=i.availableImages.indexOf(a.namePrimary)>-1,a.nameSecondary&&a.available&&i.availableImages&&(a.available=i.availableImages.indexOf(a.nameSecondary)>-1)),a}eachChild(i){if(i(this.inputPrimary),this.inputPrimaryParams)for(const a in this.inputPrimaryParams)this.inputPrimaryParams[a]&&i(this.inputPrimaryParams[a]);if(this.inputSecondary&&(i(this.inputSecondary),this.inputSecondaryParams))for(const a in this.inputSecondaryParams)this.inputSecondaryParams[a]&&i(this.inputSecondaryParams[a])}outputDefined(){return!1}serializeParams(i){const a={};if(i){for(const u in i)i[u]&&(a[u]=i[u].serialize());return{params:a}}}serialize(){const i=["image",this.inputPrimary.serialize()];return this.inputPrimaryParams&&i.push(this.serializeParams(this.inputPrimaryParams)),this.inputSecondary&&(i.push(this.inputSecondary.serialize()),this.inputSecondaryParams&&i.push(this.serializeParams(this.inputSecondaryParams))),i}}function cs(c){return c instanceof Number?"number":c instanceof String?"string":c instanceof Boolean?"boolean":Array.isArray(c)?"array":c===null?"null":typeof c}const Mu={"to-boolean":Ni,"to-color":jr,"to-number":qt,"to-string":zi};class La{constructor(i,a){this.type=i,this.args=a}static parse(i,a){if(i.length<2)return a.error("Expected at least one argument.");const u=i[0],m=[];let h=sl;if(u==="to-array"){if(!Array.isArray(i[1]))return null;const g=i[1].length;if(a.expectedType){if(a.expectedType.kind!=="array")return a.error(`Expected ${a.expectedType.kind} but found array.`);h=xr(a.expectedType.itemType,g)}else{if(!(g>0&&Ka(i[1][0])))return null;h=xr(yn(i[1][0]),g)}for(let b=0;b<g;b++){const E=i[1][b];let R;if(cs(E)==="array")R=a.parse(E,void 0,h.itemType);else{const v=cs(E);if(v!==h.itemType.kind)return a.error(`Expected ${h.itemType.kind} but found ${v}.`);R=a.registry.literal.parse(["literal",E===void 0?null:E],a)}if(!R)return null;m.push(R)}}else{if((u==="to-boolean"||u==="to-string")&&i.length!==2)return a.error("Expected one argument.");h=Mu[u];for(let g=1;g<i.length;g++){const b=a.parse(i[g],g,Oi);if(!b)return null;m.push(b)}}return new La(h,m)}evaluate(i){if(this.type.kind==="boolean")return!!this.args[0].evaluate(i);if(this.type.kind==="color"){let a,u;for(const m of this.args){if(a=m.evaluate(i),u=null,a instanceof $i)return a;if(typeof a=="string"){const h=i.parseColor(a);if(h)return h}else if(Array.isArray(a)&&(u=a.length<3||a.length>4?`Invalid rbga value ${JSON.stringify(a)}: expected an array containing either three or four numeric values.`:Iu(a[0],a[1],a[2],a[3]),!u))return new $i(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new Ln(u||`Could not parse color from value '${typeof a=="string"?a:String(JSON.stringify(a))}'`)}if(this.type.kind==="number"){let a=null;for(const u of this.args){if(a=u.evaluate(i),a===null)return 0;const m=Number(a);if(!isNaN(m))return m}throw new Ln(`Could not convert ${JSON.stringify(a)} to number.`)}return this.type.kind==="formatted"?br.fromString(Os(this.args[0].evaluate(i))):this.type.kind==="resolvedImage"?Fn.build(Os(this.args[0].evaluate(i))):this.type.kind==="array"?this.args.map(a=>a.evaluate(i)):Os(this.args[0].evaluate(i))}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){if(this.type.kind==="formatted")return new al([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new kl(this.args[0]).serialize();const i=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(a=>{i.push(a.serialize())}),i}}const ud=["Unknown","Point","LineString","Polygon"];class Ec{constructor(i,a){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=i,this.options=a}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?ud[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(i){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const i=this.featureDistanceData.center,a=this.featureDistanceData.scale,{x:u,y:m}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(u*a-i[0])+this.featureDistanceData.bearing[1]*(m*a-i[1])}return 0}parseColor(i){let a=this._parseColorCache[i];return a||(a=this._parseColorCache[i]=$i.parse(i)),a}getConfig(i){return this.options?this.options.get(i):null}}class Xr{constructor(i,a,u,m,h){this.name=i,this.type=a,this._evaluate=u,this.args=m,this._overloadIndex=h}evaluate(i){if(!this._evaluate){const a=Xr.definitions[this.name];this._evaluate=Array.isArray(a)?a[2]:a.overloads[this._overloadIndex][1]}return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(i=>i.serialize()))}static parse(i,a){const u=i[0],m=Xr.definitions[u];if(!m)return a.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const h=Array.isArray(m)?m[0]:m.type,g=Array.isArray(m)?[[m[1],m[2]]]:m.overloads,b=[];let E=null,R=-1;for(const[v,S]of g){if(Array.isArray(v)&&v.length!==i.length-1)continue;b.push(v),R++,E=new gd(a.registry,a.path,null,a.scope,void 0,a._scope,a.options);const C=[];let T=!1;for(let I=1;I<i.length;I++){const D=i[I],k=Array.isArray(v)?v[I-1]:v.type,F=E.parse(D,1+C.length,k);if(!F){T=!0;break}C.push(F)}if(!T)if(Array.isArray(v)&&v.length!==C.length)E.error(`Expected ${v.length} arguments, but found ${C.length} instead.`);else{for(let I=0;I<C.length;I++){const D=Array.isArray(v)?v[I]:v.type,k=C[I];E.concat(I+1).checkSubtype(D,k.type)}if(E.errors.length===0)return new Xr(u,h,S,C,R)}}if(b.length===1)a.errors.push(...E.errors);else{const v=(b.length?b:g.map(([C])=>C)).map(Nl).join(" | "),S=[];for(let C=1;C<i.length;C++){const T=a.parse(i[C],1+S.length);if(!T)return null;S.push(Rn(T.type))}a.error(`Expected arguments of type ${v}, but found (${S.join(", ")}) instead.`)}return null}static register(i,a){Xr.definitions=a;for(const u in a)i[u]=Xr}}function Nl(c){return Array.isArray(c)?`(${c.map(Rn).join(", ")})`:`(${Rn(c.type)}...)`}class Sc{constructor(i,a,u){this.type=Pl,this.locale=u,this.caseSensitive=i,this.diacriticSensitive=a}static parse(i,a){if(i.length!==2)return a.error("Expected one argument.");const u=i[1];if(typeof u!="object"||Array.isArray(u))return a.error("Collator options argument must be an object.");const m=u["case-sensitive"]===void 0?a.parse(!1,1,Ni):a.parseObjectValue(u["case-sensitive"],1,"case-sensitive",Ni);if(!m)return null;const h=u["diacritic-sensitive"]===void 0?a.parse(!1,1,Ni):a.parseObjectValue(u["diacritic-sensitive"],1,"diacritic-sensitive",Ni);if(!h)return null;let g=null;return u.locale&&(g=a.parseObjectValue(u.locale,1,"locale",zi),!g)?null:new Sc(m,h,g)}evaluate(i){return new Tc(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}serialize(){const i={};return i["case-sensitive"]=this.caseSensitive.serialize(),i["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(i.locale=this.locale.serialize()),["collator",i]}}function Fl(c,i,a=0,u=c.length-1,m=Bf){for(;u>a;){if(u-a>600){const E=u-a+1,R=i-a+1,v=Math.log(E),S=.5*Math.exp(2*v/3),C=.5*Math.sqrt(v*S*(E-S)/E)*(R-E/2<0?-1:1);Fl(c,i,Math.max(a,Math.floor(i-R*S/E+C)),Math.min(u,Math.floor(i+(E-R)*S/E+C)),m)}const h=c[i];let g=a,b=u;for(ya(c,a,i),m(c[u],h)>0&&ya(c,a,u);g<b;){for(ya(c,g,b),g++,b--;m(c[g],h)<0;)g++;for(;m(c[b],h)>0;)b--}m(c[a],h)===0?ya(c,a,b):(b++,ya(c,b,u)),b<=i&&(a=b+1),i<=b&&(u=b-1)}}function ya(c,i,a){const u=c[i];c[i]=c[a],c[a]=u}function Bf(c,i){return c<i?-1:c>i?1:0}function Vf(c){let i=0;for(let a,u,m=0,h=c.length,g=h-1;m<h;g=m++)a=c[m],u=c[g],i+=(u.x-a.x)*(a.y+u.y);return i}function Bl(c,i){c[0]=Math.min(c[0],i[0]),c[1]=Math.min(c[1],i[1]),c[2]=Math.max(c[2],i[0]),c[3]=Math.max(c[3],i[1])}function Vl(c,i){return!(c[0]<=i[0]||c[2]>=i[2]||c[1]<=i[1]||c[3]>=i[3])}function Cu(c,i,a){const u=c[0]-i[0],m=c[1]-i[1],h=c[0]-a[0],g=c[1]-a[1];return u*g-h*m==0&&u*h<=0&&m*g<=0}function kr(c,i,a=!1){let u=!1;for(let b=0,E=i.length;b<E;b++){const R=i[b];for(let v=0,S=R.length,C=S-1;v<S;C=v++){const T=R[C],I=R[v];if(Cu(c,T,I))return a;(h=T)[1]>(m=c)[1]!=(g=I)[1]>m[1]&&m[0]<(g[0]-h[0])*(m[1]-h[1])/(g[1]-h[1])+h[0]&&(u=!u)}}var m,h,g;return u}function Ru(c,i,a,u){const m=u[0]-a[0],h=u[1]-a[1],g=(c[0]-a[0])*h-m*(c[1]-a[1]),b=(i[0]-a[0])*h-m*(i[1]-a[1]);return g>0&&b<0||g<0&&b>0}function za(c,i,a,u){return(m=[u[0]-a[0],u[1]-a[1]])[0]*(h=[i[0]-c[0],i[1]-c[1]])[1]-m[1]*h[0]!=0&&!(!Ru(c,i,a,u)||!Ru(a,u,c,i));var m,h}const ks=8192;function L(c,i){const a=(180+c[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c[1]*Math.PI/360)))/360,m=Math.pow(2,i.z);return[Math.round(a*m*ks),Math.round(u*m*ks)]}function Z(c,i){for(let a=0;a<i.length;a++)if(kr(c,i[a]))return!0;return!1}function re(c,i,a){for(const u of a)for(let m=0,h=u.length,g=h-1;m<h;g=m++)if(za(c,i,u[g],u[m]))return!0;return!1}function Se(c,i){for(let a=0;a<c.length;++a)if(!kr(c[a],i))return!1;for(let a=0;a<c.length-1;++a)if(re(c[a],c[a+1],i))return!1;return!0}function gt(c,i){for(let a=0;a<i.length;a++)if(Se(c,i[a]))return!0;return!1}function Tt(c,i,a){const u=[];for(let m=0;m<c.length;m++){const h=[];for(let g=0;g<c[m].length;g++){const b=L(c[m][g],a);Bl(i,b),h.push(b)}u.push(h)}return u}function Yt(c,i,a){const u=[];for(let m=0;m<c.length;m++){const h=Tt(c[m],i,a);u.push(h)}return u}function ni(c,i,a,u){if(c[0]<a[0]||c[0]>a[2]){const m=.5*u;let h=c[0]-a[0]>m?-u:a[0]-c[0]>m?u:0;h===0&&(h=c[0]-a[2]>m?-u:a[2]-c[0]>m?u:0),c[0]+=h}Bl(i,c)}function Ht(c,i,a,u){const m=Math.pow(2,u.z)*ks,h=[u.x*ks,u.y*ks],g=[];if(!c)return g;for(const b of c)for(const E of b){const R=[E.x+h[0],E.y+h[1]];ni(R,i,a,m),g.push(R)}return g}function on(c,i,a,u){const m=Math.pow(2,u.z)*ks,h=[u.x*ks,u.y*ks],g=[];if(!c)return g;for(const E of c){const R=[];for(const v of E){const S=[v.x+h[0],v.y+h[1]];Bl(i,S),R.push(S)}g.push(R)}if(i[2]-i[0]<=m/2){(b=i)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(const E of g)for(const R of E)ni(R,i,a,m)}var b;return g}class Kt{constructor(i,a){this.type=Ni,this.geojson=i,this.geometries=a}static parse(i,a){if(i.length!==2)return a.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(Ka(i[1])){const u=i[1];if(u.type==="FeatureCollection")for(let m=0;m<u.features.length;++m){const h=u.features[m].geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new Kt(u,u.features[m].geometry)}else if(u.type==="Feature"){const m=u.geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new Kt(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new Kt(u,u)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return function(a,u){const m=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],g=a.canonicalID();if(!g)return!1;if(u.type==="Polygon"){const b=Tt(u.coordinates,h,g),E=Ht(a.geometry(),m,h,g);if(!Vl(m,h))return!1;for(const R of E)if(!kr(R,b))return!1}if(u.type==="MultiPolygon"){const b=Yt(u.coordinates,h,g),E=Ht(a.geometry(),m,h,g);if(!Vl(m,h))return!1;for(const R of E)if(!Z(R,b))return!1}return!0}(i,this.geometries);if(i.geometryType()==="LineString")return function(a,u){const m=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],g=a.canonicalID();if(!g)return!1;if(u.type==="Polygon"){const b=Tt(u.coordinates,h,g),E=on(a.geometry(),m,h,g);if(!Vl(m,h))return!1;for(const R of E)if(!Se(R,b))return!1}if(u.type==="MultiPolygon"){const b=Yt(u.coordinates,h,g),E=on(a.geometry(),m,h,g);if(!Vl(m,h))return!1;for(const R of E)if(!gt(R,b))return!1}return!0}(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const hr={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Qa=1/298.257223563,li=Qa*(2-Qa),Ja=Math.PI/180;class eo{static fromTile(i,a,u){const m=Math.PI*(1-2*(i+.5)/Math.pow(2,a)),h=Math.atan(.5*(Math.exp(m)-Math.exp(-m)))/Ja;return new eo(h,u)}static get units(){return hr}constructor(i,a){if(i===void 0)throw new Error("No latitude given.");if(a&&!hr[a])throw new Error(`Unknown unit ${a}. Use one of: ${Object.keys(hr).join(", ")}`);const u=6378.137*Ja*(a?hr[a]:1),m=Math.cos(i*Ja),h=1/(1-li*(1-m*m)),g=Math.sqrt(h);this.kx=u*g*m,this.ky=u*g*h*(1-li)}distance(i,a){const u=Ns(i[0]-a[0])*this.kx,m=(i[1]-a[1])*this.ky;return Math.sqrt(u*u+m*m)}bearing(i,a){const u=Ns(a[0]-i[0])*this.kx;return Math.atan2(u,(a[1]-i[1])*this.ky)/Ja}destination(i,a,u){const m=u*Ja;return this.offset(i,Math.sin(m)*a,Math.cos(m)*a)}offset(i,a,u){return[i[0]+a/this.kx,i[1]+u/this.ky]}lineDistance(i){let a=0;for(let u=0;u<i.length-1;u++)a+=this.distance(i[u],i[u+1]);return a}area(i){let a=0;for(let u=0;u<i.length;u++){const m=i[u];for(let h=0,g=m.length,b=g-1;h<g;b=h++)a+=Ns(m[h][0]-m[b][0])*(m[h][1]+m[b][1])*(u?-1:1)}return Math.abs(a)/2*this.kx*this.ky}along(i,a){let u=0;if(a<=0)return i[0];for(let m=0;m<i.length-1;m++){const h=i[m],g=i[m+1],b=this.distance(h,g);if(u+=b,u>a)return Uf(h,g,(a-(u-b))/b)}return i[i.length-1]}pointToSegmentDistance(i,a,u){let[m,h]=a,g=Ns(u[0]-m)*this.kx,b=(u[1]-h)*this.ky;if(g!==0||b!==0){const E=(Ns(i[0]-m)*this.kx*g+(i[1]-h)*this.ky*b)/(g*g+b*b);E>1?(m=u[0],h=u[1]):E>0&&(m+=g/this.kx*E,h+=b/this.ky*E)}return g=Ns(i[0]-m)*this.kx,b=(i[1]-h)*this.ky,Math.sqrt(g*g+b*b)}pointOnLine(i,a){let u=1/0,m=i[0][0],h=i[0][1],g=0,b=0;for(let E=0;E<i.length-1;E++){let R=i[E][0],v=i[E][1],S=Ns(i[E+1][0]-R)*this.kx,C=(i[E+1][1]-v)*this.ky,T=0;S===0&&C===0||(T=(Ns(a[0]-R)*this.kx*S+(a[1]-v)*this.ky*C)/(S*S+C*C),T>1?(R=i[E+1][0],v=i[E+1][1]):T>0&&(R+=S/this.kx*T,v+=C/this.ky*T)),S=Ns(a[0]-R)*this.kx,C=(a[1]-v)*this.ky;const I=S*S+C*C;I<u&&(u=I,m=R,h=v,g=E,b=T)}return{point:[m,h],index:g,t:Math.max(0,Math.min(1,b))}}lineSlice(i,a,u){let m=this.pointOnLine(u,i),h=this.pointOnLine(u,a);if(m.index>h.index||m.index===h.index&&m.t>h.t){const R=m;m=h,h=R}const g=[m.point],b=m.index+1,E=h.index;!tg(u[b],g[0])&&b<=E&&g.push(u[b]);for(let R=b+1;R<=E;R++)g.push(u[R]);return tg(u[E],h.point)||g.push(h.point),g}lineSliceAlong(i,a,u){let m=0;const h=[];for(let g=0;g<u.length-1;g++){const b=u[g],E=u[g+1],R=this.distance(b,E);if(m+=R,m>i&&h.length===0&&h.push(Uf(b,E,(i-(m-R))/R)),m>=a)return h.push(Uf(b,E,(a-(m-R))/R)),h;m>i&&h.push(E)}return h}bufferPoint(i,a){const u=a/this.ky,m=a/this.kx;return[i[0]-m,i[1]-u,i[0]+m,i[1]+u]}bufferBBox(i,a){const u=a/this.ky,m=a/this.kx;return[i[0]-m,i[1]-u,i[2]+m,i[3]+u]}insideBBox(i,a){return Ns(i[0]-a[0])>=0&&Ns(i[0]-a[2])<=0&&i[1]>=a[1]&&i[1]<=a[3]}}function tg(c,i){return c[0]===i[0]&&c[1]===i[1]}function Uf(c,i,a){const u=Ns(i[0]-c[0]);return[c[0]+u*a,c[1]+(i[1]-c[1])*a]}function Ns(c){for(;c<-180;)c+=360;for(;c>180;)c-=360;return c}class Yr{constructor(i=[],a=(u,m)=>u<m?-1:u>m?1:0){if(this.data=i,this.length=this.data.length,this.compare=a,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;const i=this.data[0],a=this.data.pop();return--this.length>0&&(this.data[0]=a,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:a,compare:u}=this,m=a[i];for(;i>0;){const h=i-1>>1,g=a[h];if(u(m,g)>=0)break;a[i]=g,i=h}a[i]=m}_down(i){const{data:a,compare:u}=this,m=this.length>>1,h=a[i];for(;i<m;){let g=1+(i<<1);const b=g+1;if(b<this.length&&u(a[b],a[g])<0&&(g=b),u(a[g],h)>=0)break;a[i]=a[g],i=g}a[i]=h}}var Pt=8192;function ig(c,i){return i.dist-c.dist}const jf=100,hd=50;function Ul(c){const i=[1/0,1/0,-1/0,-1/0];if(i.length!==c.length)return!1;for(let a=0;a<i.length;a++)if(i[a]!==c[a])return!1;return!0}function qr(c){return c[1]-c[0]+1}function ol(c,i){const a=c[1]>=c[0]&&c[1]<i;return a||console.warn("Distance Expression: Index is out of range"),a}function ng(c,i){if(c[0]>c[1])return[null,null];const a=qr(c);if(i){if(a===2)return[c,null];const u=Math.floor(a/2);return[[c[0],c[0]+u],[c[0]+u,c[1]]]}{if(a===1)return[c,null];const u=Math.floor(a/2)-1;return[[c[0],c[0]+u],[c[0]+u+1,c[1]]]}}function Ac(c,i){const a=[1/0,1/0,-1/0,-1/0];if(!ol(i,c.length))return a;for(let u=i[0];u<=i[1];++u)Bl(a,c[u]);return a}function Ic(c){const i=[1/0,1/0,-1/0,-1/0];for(let a=0;a<c.length;++a)for(let u=0;u<c[a].length;++u)Bl(i,c[a][u]);return i}function Mc(c,i,a){if(Ul(c)||Ul(i))return NaN;let u=0,m=0;return c[2]<i[0]&&(u=i[0]-c[2]),c[0]>i[2]&&(u=c[0]-i[2]),c[1]>i[3]&&(m=c[1]-i[3]),c[3]<i[1]&&(m=i[1]-c[3]),a.distance([0,0],[u,m])}function rg(c){return 360*c-180}function Gb(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}function sg(c,i){const a=Math.pow(2,i.z),u=(c.y/Pt+i.y)/a;return[rg((c.x/Pt+i.x)/a),Gb(u)]}function Hb(c,i){const a=[];for(let u=0;u<c.length;++u)a.push(sg(c[u],i));return a}function I0(c,i,a){const u=a.pointOnLine(i,c).point;return a.distance(c,u)}function ag(c,i,a,u,m){const h=a.slice(u[0],u[1]+1);let g=1/0;for(let b=i[0];b<=i[1];++b)if((g=Math.min(g,I0(c[b],h,m)))===0)return 0;return g}function og(c,i,a,u,m){const h=Math.min(m.pointToSegmentDistance(c,a,u),m.pointToSegmentDistance(i,a,u)),g=Math.min(m.pointToSegmentDistance(a,c,i),m.pointToSegmentDistance(u,c,i));return Math.min(h,g)}function $b(c,i,a,u,m){if(!ol(i,c.length)||!ol(u,a.length))return NaN;let h=1/0;for(let g=i[0];g<i[1];++g)for(let b=u[0];b<u[1];++b){if(za(c[g],c[g+1],a[b],a[b+1]))return 0;h=Math.min(h,og(c[g],c[g+1],a[b],a[b+1],m))}return h}function M0(c,i,a,u,m){if(!ol(i,c.length)||!ol(u,a.length))return NaN;let h=1/0;for(let g=i[0];g<=i[1];++g)for(let b=u[0];b<=u[1];++b)if((h=Math.min(h,m.distance(c[g],a[b])))===0)return h;return h}function Cc(c,i,a){if(kr(c,i,!0))return 0;let u=1/0;for(const m of i){const h=m.length;if(h<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(m[0]!==m[h-1]&&(u=Math.min(u,a.pointToSegmentDistance(c,m[h-1],m[0])))===0||(u=Math.min(u,I0(c,m,a)))===0)return u}return u}function Zb(c,i,a,u){if(!ol(i,c.length))return NaN;for(let h=i[0];h<=i[1];++h)if(kr(c[h],a,!0))return 0;let m=1/0;for(let h=i[0];h<i[1];++h)for(const g of a)for(let b=0,E=g.length,R=E-1;b<E;R=b++){if(za(c[h],c[h+1],g[R],g[b]))return 0;m=Math.min(m,og(c[h],c[h+1],g[R],g[b],u))}return m}function C0(c,i){for(const a of c)for(let u=0;u<=a.length-1;++u)if(kr(a[u],i,!0))return!0;return!1}function lg(c,i,a,u=1/0){const m=Ic(c),h=Ic(i);if(u!==1/0&&Mc(m,h,a)>=u)return u;if(Vl(m,h)){if(C0(c,i))return 0}else if(C0(i,c))return 0;let g=u;for(const b of c)for(let E=0,R=b.length,v=R-1;E<R;v=E++)for(const S of i)for(let C=0,T=S.length,I=T-1;C<T;I=C++){if(za(b[v],b[E],S[I],S[C]))return 0;g=Math.min(g,og(b[v],b[E],S[I],S[C],a))}return g}function dd(c,i,a,u,m,h,g){if(h===null||g===null)return;const b=Mc(Ac(u,h),Ac(m,g),a);b<i&&c.push({dist:b,range1:h,range2:g})}function R0(c,i,a,u,m=1/0){let h=Math.min(u.distance(c[0],a[0][0]),m);if(h===0)return h;const g=new Yr([{dist:0,range1:[0,c.length-1],range2:[0,0]}],ig),b=i?hd:jf,E=Ic(a);for(;g.length;){const R=g.pop();if(R.dist>=h)continue;const v=R.range1;if(qr(v)<=b){if(!ol(v,c.length))return NaN;if(i){const S=Zb(c,v,a,u);if((h=Math.min(h,S))===0)return h}else for(let S=v[0];S<=v[1];++S){const C=Cc(c[S],a,u);if((h=Math.min(h,C))===0)return h}}else{const S=ng(v,i);if(S[0]!==null){const C=Mc(Ac(c,S[0]),E,u);C<h&&g.push({dist:C,range1:S[0],range2:[0,0]})}if(S[1]!==null){const C=Mc(Ac(c,S[1]),E,u);C<h&&g.push({dist:C,range1:S[1],range2:[0,0]})}}}return h}function Oa(c,i,a,u,m,h=1/0){let g=Math.min(h,m.distance(c[0],a[0]));if(g===0)return g;const b=new Yr([{dist:0,range1:[0,c.length-1],range2:[0,a.length-1]}],ig),E=i?hd:jf,R=u?hd:jf;for(;b.length;){const v=b.pop();if(v.dist>=g)continue;const S=v.range1,C=v.range2;if(qr(S)<=E&&qr(C)<=R){if(!ol(S,c.length)||!ol(C,a.length))return NaN;if(i&&u?g=Math.min(g,$b(c,S,a,C,m)):i||u?i&&!u?g=Math.min(g,ag(a,C,c,S,m)):!i&&u&&(g=Math.min(g,ag(c,S,a,C,m))):g=Math.min(g,M0(c,S,a,C,m)),g===0)return g}else{const T=ng(S,i),I=ng(C,u);dd(b,g,m,c,a,T[0],I[0]),dd(b,g,m,c,a,T[0],I[1]),dd(b,g,m,c,a,T[1],I[0]),dd(b,g,m,c,a,T[1],I[1])}}return g}function qf(c,i,a,u,m=1/0){let h=m;const g=Ac(c,[0,c.length-1]);for(const b of a)if(!(h!==1/0&&Mc(g,Ac(b,[0,b.length-1]),u)>=h)&&(h=Math.min(h,Oa(c,i,b,!0,u,h)),h===0))return h;return h}function fd(c,i,a,u,m=1/0){let h=m;const g=Ac(c,[0,c.length-1]);for(const b of a){if(h!==1/0&&Mc(g,Ic(b),u)>=h)continue;const E=R0(c,i,b,u,h);if(isNaN(E))return E;if((h=Math.min(h,E))===0)return h}return h}function Gf(c){return c==="Point"||c==="MultiPoint"||c==="LineString"||c==="MultiLineString"||c==="Polygon"||c==="MultiPolygon"}class jl{constructor(i,a){this.type=qt,this.geojson=i,this.geometries=a}static parse(i,a){if(i.length!==2)return a.error(`'distance' expression requires either one argument, but found ' ${i.length-1} instead.`);if(Ka(i[1])){const u=i[1];if(u.type==="FeatureCollection"){for(let m=0;m<u.features.length;++m)if(Gf(u.features[m].geometry.type))return new jl(u,u.features[m].geometry)}else if(u.type==="Feature"){if(Gf(u.geometry.type))return new jl(u,u.geometry)}else if(Gf(u.type))return new jl(u,u)}return a.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(i){const a=i.geometry(),u=i.canonicalID();if(a!=null&&u!=null){if(i.geometryType()==="Point")return function(m,h,g){const b=[];for(const R of m)for(const v of R)b.push(sg(v,h));const E=new eo(b[0][1],"meters");return g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString"?Oa(b,!1,g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",E):g.type==="MultiLineString"?qf(b,!1,g.coordinates,E):g.type==="Polygon"||g.type==="MultiPolygon"?fd(b,!1,g.type==="Polygon"?[g.coordinates]:g.coordinates,E):null}(a,u,this.geometries);if(i.geometryType()==="LineString")return function(m,h,g){const b=[];for(const R of m){const v=[];for(const S of R)v.push(sg(S,h));b.push(v)}const E=new eo(b[0][0][1],"meters");if(g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString")return qf(g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",b,E);if(g.type==="MultiLineString"){let R=1/0;for(let v=0;v<g.coordinates.length;v++){const S=qf(g.coordinates[v],!0,b,E,R);if(isNaN(S))return S;if((R=Math.min(R,S))===0)return R}return R}if(g.type==="Polygon"||g.type==="MultiPolygon"){let R=1/0;for(let v=0;v<b.length;v++){const S=fd(b[v],!0,g.type==="Polygon"?[g.coordinates]:g.coordinates,E,R);if(isNaN(S))return S;if((R=Math.min(R,S))===0)return R}return R}return null}(a,u,this.geometries);if(i.geometryType()==="Polygon")return function(m,h,g){const b=[];for(const R of function(v,S){const C=v.length;if(C<=1)return[v];const T=[];let I,D;for(let k=0;k<C;k++){const F=Vf(v[k]);F!==0&&(v[k].area=Math.abs(F),D===void 0&&(D=F<0),D===F<0?(I&&T.push(I),I=[v[k]]):I.push(v[k]))}return I&&T.push(I),T}(m)){const v=[];for(let S=0;S<R.length;++S)v.push(Hb(R[S],h));b.push(v)}const E=new eo(b[0][0][0][1],"meters");if(g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString")return fd(g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",b,E);if(g.type==="MultiLineString"){let R=1/0;for(let v=0;v<g.coordinates.length;v++){const S=fd(g.coordinates[v],!0,b,E,R);if(isNaN(S))return S;if((R=Math.min(R,S))===0)return R}return R}return g.type==="Polygon"||g.type==="MultiPolygon"?function(R,v,S){let C=1/0;for(const T of R)for(const I of v){const D=lg(T,I,S,C);if(isNaN(D))return D;if((C=Math.min(C,D))===0)return C}return C}(g.type==="Polygon"?[g.coordinates]:g.coordinates,b,E):null}(a,u,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Hf(c,i){switch(c){case"string":return Os(i);case"number":return+i;case"boolean":return!!i;case"color":return $i.parse(i);case"formatted":return br.fromString(Os(i));case"resolvedImage":return Fn.build(Os(i))}return i}function cg(c,i,a,u){return u!==void 0&&(c=u*Math.round(c/u)),i!==void 0&&c<i&&(c=i),a!==void 0&&c>a&&(c=a),c}class Rc{constructor(i,a,u){this.type=i,this.key=a,this.scope=u}static parse(i,a){let u=a.expectedType;if(u==null&&(u=Oi),i.length<2||i.length>3)return a.error("Invalid number of arguments for 'config' expression.");const m=a.parse(i[1],1);if(!(m instanceof ur))return a.error("Key name of 'config' expression must be a string literal.");if(i.length>=3){const h=a.parse(i[2],2);return h instanceof ur?new Rc(u,Os(m.value),Os(h.value)):a.error("Scope of 'config' expression must be a string literal.")}return new Rc(u,Os(m.value))}evaluate(i){const a=[this.key,this.scope,i.scope].filter(Boolean).join(""),u=i.getConfig(a);if(!u)return null;const{type:m,value:h,values:g,minValue:b,maxValue:E,stepValue:R}=u,v=u.default.evaluate(i);let S=v;if(h){const C=i.scope;i.scope=(C||"").split("").slice(1).join(""),S=h.evaluate(i),i.scope=C}return m&&(S=Hf(m,S)),S===void 0||b===void 0&&E===void 0&&R===void 0||(typeof S=="number"?S=cg(S,b,E,R):Array.isArray(S)&&(S=S.map(C=>typeof C=="number"?cg(C,b,E,R):C))),h!==void 0&&S!==void 0&&g&&!g.includes(S)&&(S=v,m&&(S=Hf(m,S))),(m&&m!==this.type||S!==void 0&&yn(S)!==this.type)&&(S=Hf(this.type.kind,S)),S}eachChild(){}outputDefined(){return!1}serialize(){const i=["config",this.key];return this.scope&&i.concat(this.key),i}}function Du(c){if(c instanceof Xr&&(c.name==="get"&&c.args.length===1||c.name==="feature-state"||c.name==="has"&&c.args.length===1||c.name==="properties"||c.name==="geometry-type"||c.name==="id"||/^filter-/.test(c.name))||c instanceof Kt||c instanceof jl)return!1;let i=!0;return c.eachChild(a=>{i&&!Du(a)&&(i=!1)}),i}function pd(c){if(c instanceof Xr&&c.name==="feature-state")return!1;let i=!0;return c.eachChild(a=>{i&&!pd(a)&&(i=!1)}),i}function md(c){if(c instanceof Rc)return new Set([c.key]);let i=new Set;return c.eachChild(a=>{i=new Set([...i,...md(a)])}),i}function Dc(c,i){if(c instanceof Xr&&i.indexOf(c.name)>=0)return!1;let a=!0;return c.eachChild(u=>{a&&!Dc(u,i)&&(a=!1)}),a}class Pc{constructor(i,a){this.type=a.type,this.name=i,this.boundExpression=a}static parse(i,a){if(i.length!==2||typeof i[1]!="string")return a.error("'var' expression requires exactly one string literal argument.");const u=i[1];return a.scope.has(u)?new Pc(u,a.scope.get(u)):a.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Pu{constructor(i,a=[],u,m=new Su,h=[],g,b){this.registry=i,this.path=a,this.key=a.map(E=>typeof E=="string"?`['${E}']`:`[${E}]`).join(""),this.scope=m,this.errors=h,this.expectedType=u,this._scope=g,this.options=b}parse(i,a,u,m,h={}){return a||u?this.concat(a,null,u,m)._parse(i,h):this._parse(i,h)}parseObjectValue(i,a,u,m,h,g={}){return this.concat(a,u,m,h)._parse(i,g)}_parse(i,a){function u(m,h,g){return g==="assert"?new bs(h,[m]):g==="coerce"?new La(h,[m]):m}if(i!==null&&typeof i!="string"&&typeof i!="boolean"&&typeof i!="number"||(i=["literal",i]),Array.isArray(i)){if(i.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const m=typeof i[0]=="string"?this.registry[i[0]]:void 0;if(m){let h=m.parse(i,this);if(!h)return null;if(this.expectedType){const g=this.expectedType,b=h.type;if(g.kind!=="string"&&g.kind!=="number"&&g.kind!=="boolean"&&g.kind!=="object"&&g.kind!=="array"||b.kind!=="value")if(g.kind!=="color"&&g.kind!=="formatted"&&g.kind!=="resolvedImage"||b.kind!=="value"&&b.kind!=="string"){if(this.checkSubtype(g,b))return null}else h=u(h,g,a.typeAnnotation||"coerce");else h=u(h,g,a.typeAnnotation||"assert")}if(!(h instanceof ur)&&h.type.kind!=="resolvedImage"&&$f(h)){const g=new Ec(this._scope,this.options);try{h=new ur(h.type,h.evaluate(g))}catch(b){return this.error(b.message),null}}return h}return La.parse(["to-array",i],this)}return this.error(i===void 0?"'undefined' value invalid. Use null instead.":typeof i=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof i} instead.`)}concat(i,a,u,m){let h=typeof i=="number"?this.path.concat(i):this.path;h=typeof a=="string"?h.concat(a):h;const g=m?this.scope.concat(m):this.scope;return new Pu(this.registry,h,u||null,g,this.errors,this._scope,this.options)}error(i,...a){const u=`${this.key}${a.map(m=>`[${m}]`).join("")}`;this.errors.push(new vi(u,i))}checkSubtype(i,a){const u=ls(i,a);return u&&this.error(u),u}}var gd=Pu;function $f(c){if(c instanceof Pc)return $f(c.boundExpression);if(c instanceof Xr&&c.name==="error"||c instanceof Sc||c instanceof Kt||c instanceof jl||c instanceof Rc)return!1;const i=c instanceof La||c instanceof bs;let a=!0;return c.eachChild(u=>{a=i?a&&$f(u):a&&u instanceof ur}),!!a&&Du(c)&&Dc(c,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function _d(c,i){const a=c.length-1;let u,m,h=0,g=a,b=0;for(;h<=g;)if(b=Math.floor((h+g)/2),u=c[b],m=c[b+1],u<=i){if(b===a||i<m)return b;h=b+1}else{if(!(u>i))throw new Ln("Input is not a number.");g=b-1}return 0}class Lu{constructor(i,a,u){this.type=i,this.input=a,this.labels=[],this.outputs=[];for(const[m,h]of u)this.labels.push(m),this.outputs.push(h)}static parse(i,a){if(i.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return a.error("Expected an even number of arguments.");const u=a.parse(i[1],1,qt);if(!u)return null;const m=[];let h=null;a.expectedType&&a.expectedType.kind!=="value"&&(h=a.expectedType);for(let g=1;g<i.length;g+=2){const b=g===1?-1/0:i[g],E=i[g+1],R=g,v=g+1;if(typeof b!="number")return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',R);if(m.length&&m[m.length-1][0]>=b)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',R);const S=a.parse(E,v,h);if(!S)return null;h=h||S.type,m.push([b,S])}return new Lu(h,u,m)}evaluate(i){const a=this.labels,u=this.outputs;if(a.length===1)return u[0].evaluate(i);const m=this.input.evaluate(i);if(m<=a[0])return u[0].evaluate(i);const h=a.length;return m>=a[h-1]?u[h-1].evaluate(i):u[_d(a,m)].evaluate(i)}eachChild(i){i(this.input);for(const a of this.outputs)i(a)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){const i=["step",this.input.serialize()];for(let a=0;a<this.labels.length;a++)a>0&&i.push(this.labels[a]),i.push(this.outputs[a].serialize());return i}}const Lc=.95047,Fi=1.08883,D0=4/29,zu=6/29,P0=3*zu*zu,L0=zu*zu*zu,Wb=Math.PI/180,An=180/Math.PI;function ug(c){return c>L0?Math.pow(c,1/3):c/P0+D0}function hg(c){return c>zu?c*c*c:P0*(c-D0)}function dg(c){return 255*(c<=.0031308?12.92*c:1.055*Math.pow(c,1/2.4)-.055)}function fg(c){return(c/=255)<=.04045?c/12.92:Math.pow((c+.055)/1.055,2.4)}function z0(c){const i=fg(c.r),a=fg(c.g),u=fg(c.b),m=ug((.4124564*i+.3575761*a+.1804375*u)/Lc),h=ug((.2126729*i+.7151522*a+.072175*u)/1);return{l:116*h-16,a:500*(m-h),b:200*(h-ug((.0193339*i+.119192*a+.9503041*u)/Fi)),alpha:c.a}}function O0(c){let i=(c.l+16)/116,a=isNaN(c.a)?i:i+c.a/500,u=isNaN(c.b)?i:i-c.b/200;return i=1*hg(i),a=Lc*hg(a),u=Fi*hg(u),new $i(dg(3.2404542*a-1.5371385*i-.4985314*u),dg(-.969266*a+1.8760108*i+.041556*u),dg(.0556434*a-.2040259*i+1.0572252*u),c.alpha)}function Xb(c,i,a){const u=i-c;return c+a*(u>180||u<-180?u-360*Math.round(u/360):u)}const yd={forward:z0,reverse:O0,interpolate:function(c,i,a){return{l:ei(c.l,i.l,a),a:ei(c.a,i.a,a),b:ei(c.b,i.b,a),alpha:ei(c.alpha,i.alpha,a)}}},vd={forward:function(c){const{l:i,a,b:u}=z0(c),m=Math.atan2(u,a)*An;return{h:m<0?m+360:m,c:Math.sqrt(a*a+u*u),l:i,alpha:c.a}},reverse:function(c){const i=c.h*Wb,a=c.c;return O0({l:c.l,a:Math.cos(i)*a,b:Math.sin(i)*a,alpha:c.alpha})},interpolate:function(c,i,a){return{h:Xb(c.h,i.h,a),c:ei(c.c,i.c,a),l:ei(c.l,i.l,a),alpha:ei(c.alpha,i.alpha,a)}}};var k0=Object.freeze({__proto__:null,hcl:vd,lab:yd});class ta{constructor(i,a,u,m,h,g){this.type=i,this.operator=a,this.interpolation=u,this.input=m,this.dynamicStops=h,this.labels=[],this.outputs=[];for(const[b,E]of g)this.labels.push(b),this.outputs.push(E)}static interpolationFactor(i,a,u,m){let h=0;if(i.name==="exponential")h=pg(a,i.base,u,m);else if(i.name==="linear")h=pg(a,1,u,m);else if(i.name==="cubic-bezier"){const g=i.controlPoints;h=new pa(g[0],g[1],g[2],g[3]).solve(pg(a,1,u,m))}return h}static parse(i,a){let[u,m,h,...g]=i;if(!Array.isArray(m)||m.length===0)return a.error("Expected an interpolation type expression.",1);if(m[0]==="linear")m={name:"linear"};else if(m[0]==="exponential"){const R=m[1];if(typeof R!="number")return a.error("Exponential interpolation requires a numeric base.",1,1);m={name:"exponential",base:R}}else{if(m[0]!=="cubic-bezier")return a.error(`Unknown interpolation type ${String(m[0])}`,1,0);{const R=m.slice(1);if(R.length!==4||R.some(v=>typeof v!="number"||v<0||v>1))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);m={name:"cubic-bezier",controlPoints:R}}}if(i.length-1<3)return a.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length-1>3&&(i.length-1)%2!=0)return a.error("Expected an even number of arguments.");if(h=a.parse(h,2,qt),!h)return null;const b=[];let E=null;if(u==="interpolate-hcl"||u==="interpolate-lab"?E=jr:a.expectedType&&a.expectedType.kind!=="value"&&(E=a.expectedType),i.length-1==3){const R=a.parse(g[0],3,Oi);return R?new ta(E,u,m,h,R,b):null}for(let R=0;R<g.length;R+=2){const v=g[R],S=g[R+1],C=R+3,T=R+4;if(typeof v!="number")return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',C);if(b.length&&b[b.length-1][0]>=v)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',C);const I=a.parse(S,T,E);if(!I)return null;E=E||I.type,b.push([v,I])}return E.kind==="number"||E.kind==="color"||E.kind==="array"&&E.itemType.kind==="number"&&typeof E.N=="number"?new ta(E,u,m,h,null,b):a.error(`Type ${Rn(E)} is not interpolatable.`)}evaluate(i){let a=this.labels,u=this.outputs;if(this.dynamicStops){const v=this.dynamicStops.evaluate(i);if(v.length%2!=0)throw new Ln("Expected an even number of arguments.");a=[],u=[];for(let S=0;S<v.length;S+=2){const C=v[S],T=new ur(qt,v[S+1]);if(typeof C!="number")throw new Ln('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.');if(a.length&&a[a.length-1]>=C)throw new Ln('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.');a.push(C),u.push(T)}if(a.length===0)throw new Ln("Expected at least one input/output pair.")}if(a.length===1)return u[0].evaluate(i);const m=this.input.evaluate(i);if(m<=a[0])return u[0].evaluate(i);const h=a.length;if(m>=a[h-1])return u[h-1].evaluate(i);const g=_d(a,m),b=ta.interpolationFactor(this.interpolation,m,a[g],a[g+1]),E=u[g].evaluate(i),R=u[g+1].evaluate(i);return this.operator==="interpolate"?bc[this.type.kind.toLowerCase()](E,R,b):this.operator==="interpolate-hcl"?vd.reverse(vd.interpolate(vd.forward(E),vd.forward(R),b)):yd.reverse(yd.interpolate(yd.forward(E),yd.forward(R),b))}eachChild(i){i(this.input);for(const a of this.outputs)i(a)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){let i;i=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const a=[this.operator,i,this.input.serialize()];if(this.dynamicStops)a.push(this.dynamicStops.serialize());else for(let u=0;u<this.labels.length;u++)a.push(this.labels[u],this.outputs[u].serialize());return a}}function pg(c,i,a,u){const m=u-a,h=c-a;return m===0?0:i===1?h/m:(Math.pow(i,h)-1)/(Math.pow(i,m)-1)}class Zf{constructor(i,a){this.type=i,this.args=a}static parse(i,a){if(i.length<2)return a.error("Expectected at least one argument.");let u=null;const m=a.expectedType;m&&m.kind!=="value"&&(u=m);const h=[];for(const b of i.slice(1)){const E=a.parse(b,1+h.length,u,void 0,{typeAnnotation:"omit"});if(!E)return null;u=u||E.type,h.push(E)}const g=m&&h.some(b=>ls(m,b.type));return new Zf(g?Oi:u,h)}evaluate(i){let a,u=null,m=0;for(const h of this.args){if(m++,u=h.evaluate(i),u&&u instanceof Fn&&!u.available&&(a||(a=u),u=null,m===this.args.length))return a;if(u!==null)break}return u}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=["coalesce"];return this.eachChild(a=>{i.push(a.serialize())}),i}}class Wf{constructor(i,a){this.type=a.type,this.bindings=[].concat(i),this.result=a}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(const a of this.bindings)i(a[1]);i(this.result)}static parse(i,a){if(i.length<4)return a.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);const u=[];for(let h=1;h<i.length-1;h+=2){const g=i[h];if(typeof g!="string")return a.error(`Expected string, but found ${typeof g} instead.`,h);if(/[^a-zA-Z0-9_]/.test(g))return a.error("Variable names must contain only alphanumeric characters or '_'.",h);const b=a.parse(i[h+1],h+1);if(!b)return null;u.push([g,b])}const m=a.parse(i[i.length-1],i.length-1,a.expectedType,u);return m?new Wf(u,m):null}outputDefined(){return this.result.outputDefined()}serialize(){const i=["let"];for(const[a,u]of this.bindings)i.push(a,u.serialize());return i.push(this.result.serialize()),i}}class mg{constructor(i,a,u){this.type=i,this.index=a,this.input=u}static parse(i,a){if(i.length!==3)return a.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const u=a.parse(i[1],1,qt),m=a.parse(i[2],2,xr(a.expectedType||Oi));return u&&m?new mg(m.type.itemType,u,m):null}evaluate(i){const a=this.index.evaluate(i),u=this.input.evaluate(i);if(a<0)throw new Ln(`Array index out of bounds: ${a} < 0.`);if(a>u.length-1)throw new Ln(`Array index out of bounds: ${a} > ${u.length-1}.`);if(a===Math.floor(a))return u[a];const m=Math.floor(a),h=Math.ceil(a),g=u[m],b=u[h];if(typeof g!="number"||typeof b!="number")throw new Ln(`Cannot interpolate between non-number values at index ${a}.`);const E=a-m;return g*(1-E)+b*E}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class gg{constructor(i,a){this.type=Ni,this.needle=i,this.haystack=a}static parse(i,a){if(i.length!==3)return a.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const u=a.parse(i[1],1,Oi),m=a.parse(i[2],2,Oi);return u&&m?Au(u.type,[Ni,zi,qt,sl,Oi])?new gg(u,m):a.error(`Expected first argument to be of type boolean, string, number or null, but found ${Rn(u.type)} instead`):null}evaluate(i){const a=this.needle.evaluate(i),u=this.haystack.evaluate(i);if(u==null)return!1;if(!Ll(a,["boolean","string","number","null"]))throw new Ln(`Expected first argument to be of type boolean, string, number or null, but found ${Rn(yn(a))} instead.`);if(!Ll(u,["string","array"]))throw new Ln(`Expected second argument to be of type array or string, but found ${Rn(yn(u))} instead.`);return u.indexOf(a)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Xf{constructor(i,a,u){this.type=qt,this.needle=i,this.haystack=a,this.fromIndex=u}static parse(i,a){if(i.length<=2||i.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const u=a.parse(i[1],1,Oi),m=a.parse(i[2],2,Oi);if(!u||!m)return null;if(!Au(u.type,[Ni,zi,qt,sl,Oi]))return a.error(`Expected first argument to be of type boolean, string, number or null, but found ${Rn(u.type)} instead`);if(i.length===4){const h=a.parse(i[3],3,qt);return h?new Xf(u,m,h):null}return new Xf(u,m)}evaluate(i){const a=this.needle.evaluate(i),u=this.haystack.evaluate(i);if(!Ll(a,["boolean","string","number","null"]))throw new Ln(`Expected first argument to be of type boolean, string, number or null, but found ${Rn(yn(a))} instead.`);if(!Ll(u,["string","array"]))throw new Ln(`Expected second argument to be of type array or string, but found ${Rn(yn(u))} instead.`);if(this.fromIndex){const m=this.fromIndex.evaluate(i);return u.indexOf(a,m)}return u.indexOf(a)}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const i=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),i]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class _g{constructor(i,a,u,m,h,g){this.inputType=i,this.type=a,this.input=u,this.cases=m,this.outputs=h,this.otherwise=g}static parse(i,a){if(i.length<5)return a.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return a.error("Expected an even number of arguments.");let u,m;a.expectedType&&a.expectedType.kind!=="value"&&(m=a.expectedType);const h={},g=[];for(let R=2;R<i.length-1;R+=2){let v=i[R];const S=i[R+1];Array.isArray(v)||(v=[v]);const C=a.concat(R);if(v.length===0)return C.error("Expected at least one branch label.");for(const I of v){if(typeof I!="number"&&typeof I!="string")return C.error("Branch labels must be numbers or strings.");if(typeof I=="number"&&Math.abs(I)>Number.MAX_SAFE_INTEGER)return C.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof I=="number"&&Math.floor(I)!==I)return C.error("Numeric branch labels must be integer values.");if(u){if(C.checkSubtype(u,yn(I)))return null}else u=yn(I);if(h[String(I)]!==void 0)return C.error("Branch labels must be unique.");h[String(I)]=g.length}const T=a.parse(S,R,m);if(!T)return null;m=m||T.type,g.push(T)}const b=a.parse(i[1],1,Oi);if(!b)return null;const E=a.parse(i[i.length-1],i.length-1,m);return E?b.type.kind!=="value"&&a.concat(1).checkSubtype(u,b.type)?null:new _g(u,m,b,h,g,E):null}evaluate(i){const a=this.input.evaluate(i);return(yn(a)===this.inputType&&this.outputs[this.cases[a]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every(i=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["match",this.input.serialize()],a=Object.keys(this.cases).sort(),u=[],m={};for(const g of a){const b=m[this.cases[g]];b===void 0?(m[this.cases[g]]=u.length,u.push([this.cases[g],[g]])):u[b][1].push(g)}const h=g=>this.inputType.kind==="number"?Number(g):g;for(const[g,b]of u)i.push(b.length===1?h(b[0]):b.map(h)),i.push(this.outputs[g].serialize());return i.push(this.otherwise.serialize()),i}}class yg{constructor(i,a,u){this.type=i,this.branches=a,this.otherwise=u}static parse(i,a){if(i.length<4)return a.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!=0)return a.error("Expected an odd number of arguments.");let u;a.expectedType&&a.expectedType.kind!=="value"&&(u=a.expectedType);const m=[];for(let g=1;g<i.length-1;g+=2){const b=a.parse(i[g],g,Ni);if(!b)return null;const E=a.parse(i[g+1],g+1,u);if(!E)return null;m.push([b,E]),u=u||E.type}const h=a.parse(i[i.length-1],i.length-1,u);return h?new yg(u,m,h):null}evaluate(i){for(const[a,u]of this.branches)if(a.evaluate(i))return u.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(const[a,u]of this.branches)i(a),i(u);i(this.otherwise)}outputDefined(){return this.branches.every(([i,a])=>a.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["case"];return this.eachChild(a=>{i.push(a.serialize())}),i}}class Yf{constructor(i,a,u,m){this.type=i,this.input=a,this.beginIndex=u,this.endIndex=m}static parse(i,a){if(i.length<=2||i.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const u=a.parse(i[1],1,Oi),m=a.parse(i[2],2,qt);if(!u||!m)return null;if(!Au(u.type,[xr(Oi),zi,Oi]))return a.error(`Expected first argument to be of type array or string, but found ${Rn(u.type)} instead`);if(i.length===4){const h=a.parse(i[3],3,qt);return h?new Yf(u.type,u,m,h):null}return new Yf(u.type,u,m)}evaluate(i){const a=this.input.evaluate(i),u=this.beginIndex.evaluate(i);if(!Ll(a,["string","array"]))throw new Ln(`Expected first argument to be of type array or string, but found ${Rn(yn(a))} instead.`);if(this.endIndex){const m=this.endIndex.evaluate(i);return a.slice(u,m)}return a.slice(u)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const i=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),i]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function N0(c,i){return c==="=="||c==="!="?i.kind==="boolean"||i.kind==="string"||i.kind==="number"||i.kind==="null"||i.kind==="value":i.kind==="string"||i.kind==="number"||i.kind==="value"}function F0(c,i,a,u){return u.compare(i,a)===0}function Ou(c,i,a){const u=c!=="=="&&c!=="!=";return class aF{constructor(h,g,b){this.type=Ni,this.lhs=h,this.rhs=g,this.collator=b,this.hasUntypedArgument=h.type.kind==="value"||g.type.kind==="value"}static parse(h,g){if(h.length!==3&&h.length!==4)return g.error("Expected two or three arguments.");const b=h[0];let E=g.parse(h[1],1,Oi);if(!E)return null;if(!N0(b,E.type))return g.concat(1).error(`"${b}" comparisons are not supported for type '${Rn(E.type)}'.`);let R=g.parse(h[2],2,Oi);if(!R)return null;if(!N0(b,R.type))return g.concat(2).error(`"${b}" comparisons are not supported for type '${Rn(R.type)}'.`);if(E.type.kind!==R.type.kind&&E.type.kind!=="value"&&R.type.kind!=="value")return g.error(`Cannot compare types '${Rn(E.type)}' and '${Rn(R.type)}'.`);u&&(E.type.kind==="value"&&R.type.kind!=="value"?E=new bs(R.type,[E]):E.type.kind!=="value"&&R.type.kind==="value"&&(R=new bs(E.type,[R])));let v=null;if(h.length===4){if(E.type.kind!=="string"&&R.type.kind!=="string"&&E.type.kind!=="value"&&R.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(v=g.parse(h[3],3,Pl),!v)return null}return new aF(E,R,v)}evaluate(h){const g=this.lhs.evaluate(h),b=this.rhs.evaluate(h);if(u&&this.hasUntypedArgument){const E=yn(g),R=yn(b);if(E.kind!==R.kind||E.kind!=="string"&&E.kind!=="number")throw new Ln(`Expected arguments for "${c}" to be (string, string) or (number, number), but found (${E.kind}, ${R.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const E=yn(g),R=yn(b);if(E.kind!=="string"||R.kind!=="string")return i(h,g,b)}return this.collator?a(h,g,b,this.collator.evaluate(h)):i(h,g,b)}eachChild(h){h(this.lhs),h(this.rhs),this.collator&&h(this.collator)}outputDefined(){return!0}serialize(){const h=[c];return this.eachChild(g=>{h.push(g.serialize())}),h}}}const Yb=Ou("==",function(c,i,a){return i===a},F0),Kb=Ou("!=",function(c,i,a){return i!==a},function(c,i,a,u){return!F0(0,i,a,u)}),Qb=Ou("<",function(c,i,a){return i<a},function(c,i,a,u){return u.compare(i,a)<0}),Jb=Ou(">",function(c,i,a){return i>a},function(c,i,a,u){return u.compare(i,a)>0}),ew=Ou("<=",function(c,i,a){return i<=a},function(c,i,a,u){return u.compare(i,a)<=0}),tw=Ou(">=",function(c,i,a){return i>=a},function(c,i,a,u){return u.compare(i,a)>=0});class vg{constructor(i,a,u,m,h,g){this.type=zi,this.number=i,this.locale=a,this.currency=u,this.unit=m,this.minFractionDigits=h,this.maxFractionDigits=g}static parse(i,a){if(i.length!==3)return a.error("Expected two arguments.");const u=a.parse(i[1],1,qt);if(!u)return null;const m=i[2];if(typeof m!="object"||Array.isArray(m))return a.error("NumberFormat options argument must be an object.");let h=null;if(m.locale&&(h=a.parseObjectValue(m.locale,2,"locale",zi),!h))return null;let g=null;if(m.currency&&(g=a.parseObjectValue(m.currency,2,"currency",zi),!g))return null;let b=null;if(m.unit&&(b=a.parseObjectValue(m.unit,2,"unit",zi),!b))return null;let E=null;if(m["min-fraction-digits"]&&(E=a.parseObjectValue(m["min-fraction-digits"],2,"min-fraction-digits",qt),!E))return null;let R=null;return m["max-fraction-digits"]&&(R=a.parseObjectValue(m["max-fraction-digits"],2,"max-fraction-digits",qt),!R)?null:new vg(u,h,g,b,E,R)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(i):void 0,unit:this.unit?this.unit.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.unit&&i(this.unit),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const i={};return this.locale&&(i.locale=this.locale.serialize()),this.currency&&(i.currency=this.currency.serialize()),this.unit&&(i.unit=this.unit.serialize()),this.minFractionDigits&&(i["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(i["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),i]}}class xg{constructor(i){this.type=qt,this.input=i}static parse(i,a){if(i.length!==2)return a.error(`Expected 1 argument, but found ${i.length-1} instead.`);const u=a.parse(i[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?a.error(`Expected argument of type string or array, but found ${Rn(u.type)} instead.`):new xg(u):null}evaluate(i){const a=this.input.evaluate(i);if(typeof a=="string"||Array.isArray(a))return a.length;throw new Ln(`Expected value to be of type string or array, but found ${Rn(yn(a))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}serialize(){const i=["length"];return this.eachChild(a=>{i.push(a.serialize())}),i}}function Kf(c){return function(){c=1831565813+(c|=0)|0;let i=Math.imul(c^c>>>15,1|c);return i=i+Math.imul(i^i>>>7,61|i)^i,((i^i>>>14)>>>0)/4294967296}}const ku={"==":Yb,"!=":Kb,">":Jb,"<":Qb,">=":tw,"<=":ew,array:bs,at:mg,boolean:bs,case:yg,coalesce:Zf,collator:Sc,format:al,image:kl,in:gg,"index-of":Xf,interpolate:ta,"interpolate-hcl":ta,"interpolate-lab":ta,length:xg,let:Wf,literal:ur,match:_g,number:bs,"number-format":vg,object:bs,slice:Yf,step:Lu,string:bs,"to-boolean":La,"to-color":La,"to-number":La,"to-string":La,var:Pc,within:Kt,distance:jl,config:Rc};function bg(c,[i,a,u,m]){i=i.evaluate(c),a=a.evaluate(c),u=u.evaluate(c);const h=m?m.evaluate(c):1,g=Iu(i,a,u,h);if(g)throw new Ln(g);return new $i(i/255*h,a/255*h,u/255*h,h)}function B0(c,[i,a,u,m]){i=i.evaluate(c),a=a.evaluate(c),u=u.evaluate(c);const h=m?m.evaluate(c):1,g=function(R,v,S,C){return typeof R=="number"&&R>=0&&R<=360?typeof v=="number"&&v>=0&&v<=100&&typeof S=="number"&&S>=0&&S<=100?C===void 0||typeof C=="number"&&C>=0&&C<=1?null:`Invalid hsla value [${[R,v,S,C].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof C=="number"?[R,v,S,C]:[R,v,S]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof C=="number"?[R,v,S,C]:[R,v,S]).join(", ")}]: 'h' must be between 0 and 360.`}(i,a,u,h);if(g)throw new Ln(g);const b=`hsla(${i}, ${a}%, ${u}%, ${h})`,E=$i.parse(b);if(!E)throw new Ln(`Failed to parse HSLA color: ${b}`);return E}function V0(c,i){return c in i}function wg(c,i){const a=i[c];return a===void 0?null:a}function ql(c){return{type:c}}function Tg(c){return{result:"success",value:c}}function va(c){return{result:"error",value:c}}function Qf(c,i){return!!c&&!!c.parameters&&c.parameters.indexOf(i)>-1}function xd(c){return c["property-type"]==="data-driven"}function U0(c){return Qf(c.expression,"measure-light")}function Jf(c){return Qf(c.expression,"zoom")}function bd(c){return!!c.expression&&c.expression.interpolated}function Eg(c){return typeof c=="object"&&c!==null&&!Array.isArray(c)}function iw(c){return c}function Sg(c,i){const a=i.type==="color",u=c.stops&&typeof c.stops[0][0]=="object",m=u||!(u||c.property!==void 0),h=c.type||(bd(i)?"exponential":"interval");if(a&&((c=wc({},c)).stops&&(c.stops=c.stops.map(R=>[R[0],$i.parse(R[1])])),c.default=$i.parse(c.default?c.default:i.default)),c.colorSpace&&c.colorSpace!=="rgb"&&!k0[c.colorSpace])throw new Error(`Unknown color space: ${c.colorSpace}`);let g,b,E;if(h==="exponential")g=j0;else if(h==="interval")g=rw;else if(h==="categorical"){g=nw,b=Object.create(null);for(const R of c.stops)b[R[0]]=R[1];E=typeof c.stops[0][0]}else{if(h!=="identity")throw new Error(`Unknown function type "${h}"`);g=q0}if(u){const R={},v=[];for(let T=0;T<c.stops.length;T++){const I=c.stops[T],D=I[0].zoom;R[D]===void 0&&(R[D]={zoom:D,type:c.type,property:c.property,default:c.default,stops:[]},v.push(D)),R[D].stops.push([I[0].value,I[1]])}const S=[];for(const T of v)S.push([R[T].zoom,Sg(R[T],i)]);const C={name:"linear"};return{kind:"composite",interpolationType:C,interpolationFactor:ta.interpolationFactor.bind(void 0,C),zoomStops:S.map(T=>T[0]),evaluate:({zoom:T},I)=>j0({stops:S,base:c.base},i,T).evaluate(T,I)}}if(m){const R=h==="exponential"?{name:"exponential",base:c.base!==void 0?c.base:1}:null;return{kind:"camera",interpolationType:R,interpolationFactor:ta.interpolationFactor.bind(void 0,R),zoomStops:c.stops.map(v=>v[0]),evaluate:({zoom:v})=>g(c,i,v,b,E)}}return{kind:"source",evaluate(R,v){const S=v&&v.properties?v.properties[c.property]:void 0;return S===void 0?Nu(c.default,i.default):g(c,i,S,b,E)}}}function Nu(c,i,a){return c!==void 0?c:i!==void 0?i:a!==void 0?a:void 0}function nw(c,i,a,u,m){return Nu(typeof a===m?u[a]:void 0,c.default,i.default)}function rw(c,i,a){if(cs(a)!=="number")return Nu(c.default,i.default);const u=c.stops.length;if(u===1||a<=c.stops[0][0])return c.stops[0][1];if(a>=c.stops[u-1][0])return c.stops[u-1][1];const m=_d(c.stops.map(h=>h[0]),a);return c.stops[m][1]}function j0(c,i,a){const u=c.base!==void 0?c.base:1;if(cs(a)!=="number")return Nu(c.default,i.default);const m=c.stops.length;if(m===1||a<=c.stops[0][0])return c.stops[0][1];if(a>=c.stops[m-1][0])return c.stops[m-1][1];const h=_d(c.stops.map(v=>v[0]),a),g=function(v,S,C,T){const I=T-C,D=v-C;return I===0?0:S===1?D/I:(Math.pow(S,D)-1)/(Math.pow(S,I)-1)}(a,u,c.stops[h][0],c.stops[h+1][0]),b=c.stops[h][1],E=c.stops[h+1][1];let R=bc[i.type]||iw;if(c.colorSpace&&c.colorSpace!=="rgb"){const v=k0[c.colorSpace];R=(S,C)=>v.reverse(v.interpolate(v.forward(S),v.forward(C),g))}return typeof b.evaluate=="function"?{evaluate(...v){const S=b.evaluate.apply(void 0,v),C=E.evaluate.apply(void 0,v);if(S!==void 0&&C!==void 0)return R(S,C,g)}}:R(b,E,g)}function q0(c,i,a){return i.type==="color"?a=$i.parse(a):i.type==="formatted"?a=br.fromString(a.toString()):i.type==="resolvedImage"?a=Fn.build(a.toString()):cs(a)===i.type||i.type==="enum"&&i.values[a]||(a=void 0),Nu(a,c.default,i.default)}Xr.register(ku,{error:[{kind:"error"},[zi],(c,[i])=>{throw new Ln(i.evaluate(c))}],typeof:[zi,[Oi],(c,[i])=>Rn(yn(i.evaluate(c)))],"to-rgba":[xr(qt,4),[jr],(c,[i])=>i.evaluate(c).toRenderColor(null).toArray()],"to-hsla":[xr(qt,4),[jr],(c,[i])=>i.evaluate(c).toRenderColor(null).toHslaArray()],rgb:[jr,[qt,qt,qt],bg],rgba:[jr,[qt,qt,qt,qt],bg],hsl:[jr,[qt,qt,qt],B0],hsla:[jr,[qt,qt,qt,qt],B0],has:{type:Ni,overloads:[[[zi],(c,[i])=>V0(i.evaluate(c),c.properties())],[[zi,ea],(c,[i,a])=>V0(i.evaluate(c),a.evaluate(c))]]},get:{type:Oi,overloads:[[[zi],(c,[i])=>wg(i.evaluate(c),c.properties())],[[zi,ea],(c,[i,a])=>wg(i.evaluate(c),a.evaluate(c))]]},"feature-state":[Oi,[zi],(c,[i])=>wg(i.evaluate(c),c.featureState||{})],properties:[ea,[],c=>c.properties()],"geometry-type":[zi,[],c=>c.geometryType()],id:[Oi,[],c=>c.id()],zoom:[qt,[],c=>c.globals.zoom],pitch:[qt,[],c=>c.globals.pitch||0],"distance-from-center":[qt,[],c=>c.distanceFromCenter()],"measure-light":[qt,[zi],(c,[i])=>c.measureLight(i.evaluate(c))],"heatmap-density":[qt,[],c=>c.globals.heatmapDensity||0],"line-progress":[qt,[],c=>c.globals.lineProgress||0],"raster-value":[qt,[],c=>c.globals.rasterValue||0],"raster-particle-speed":[qt,[],c=>c.globals.rasterParticleSpeed||0],"sky-radial-progress":[qt,[],c=>c.globals.skyRadialProgress||0],accumulated:[Oi,[],c=>c.globals.accumulated===void 0?null:c.globals.accumulated],"+":[qt,ql(qt),(c,i)=>{let a=0;for(const u of i)a+=u.evaluate(c);return a}],"*":[qt,ql(qt),(c,i)=>{let a=1;for(const u of i)a*=u.evaluate(c);return a}],"-":{type:qt,overloads:[[[qt,qt],(c,[i,a])=>i.evaluate(c)-a.evaluate(c)],[[qt],(c,[i])=>-i.evaluate(c)]]},"/":[qt,[qt,qt],(c,[i,a])=>i.evaluate(c)/a.evaluate(c)],"%":[qt,[qt,qt],(c,[i,a])=>i.evaluate(c)%a.evaluate(c)],ln2:[qt,[],()=>Math.LN2],pi:[qt,[],()=>Math.PI],e:[qt,[],()=>Math.E],"^":[qt,[qt,qt],(c,[i,a])=>Math.pow(i.evaluate(c),a.evaluate(c))],sqrt:[qt,[qt],(c,[i])=>Math.sqrt(i.evaluate(c))],log10:[qt,[qt],(c,[i])=>Math.log(i.evaluate(c))/Math.LN10],ln:[qt,[qt],(c,[i])=>Math.log(i.evaluate(c))],log2:[qt,[qt],(c,[i])=>Math.log(i.evaluate(c))/Math.LN2],sin:[qt,[qt],(c,[i])=>Math.sin(i.evaluate(c))],cos:[qt,[qt],(c,[i])=>Math.cos(i.evaluate(c))],tan:[qt,[qt],(c,[i])=>Math.tan(i.evaluate(c))],asin:[qt,[qt],(c,[i])=>Math.asin(i.evaluate(c))],acos:[qt,[qt],(c,[i])=>Math.acos(i.evaluate(c))],atan:[qt,[qt],(c,[i])=>Math.atan(i.evaluate(c))],min:[qt,ql(qt),(c,i)=>Math.min(...i.map(a=>a.evaluate(c)))],max:[qt,ql(qt),(c,i)=>Math.max(...i.map(a=>a.evaluate(c)))],abs:[qt,[qt],(c,[i])=>Math.abs(i.evaluate(c))],round:[qt,[qt],(c,[i])=>{const a=i.evaluate(c);return a<0?-Math.round(-a):Math.round(a)}],floor:[qt,[qt],(c,[i])=>Math.floor(i.evaluate(c))],ceil:[qt,[qt],(c,[i])=>Math.ceil(i.evaluate(c))],"filter-==":[Ni,[zi,Oi],(c,[i,a])=>c.properties()[i.value]===a.value],"filter-id-==":[Ni,[Oi],(c,[i])=>c.id()===i.value],"filter-type-==":[Ni,[zi],(c,[i])=>c.geometryType()===i.value],"filter-<":[Ni,[zi,Oi],(c,[i,a])=>{const u=c.properties()[i.value],m=a.value;return typeof u==typeof m&&u<m}],"filter-id-<":[Ni,[Oi],(c,[i])=>{const a=c.id(),u=i.value;return typeof a==typeof u&&a<u}],"filter->":[Ni,[zi,Oi],(c,[i,a])=>{const u=c.properties()[i.value],m=a.value;return typeof u==typeof m&&u>m}],"filter-id->":[Ni,[Oi],(c,[i])=>{const a=c.id(),u=i.value;return typeof a==typeof u&&a>u}],"filter-<=":[Ni,[zi,Oi],(c,[i,a])=>{const u=c.properties()[i.value],m=a.value;return typeof u==typeof m&&u<=m}],"filter-id-<=":[Ni,[Oi],(c,[i])=>{const a=c.id(),u=i.value;return typeof a==typeof u&&a<=u}],"filter->=":[Ni,[zi,Oi],(c,[i,a])=>{const u=c.properties()[i.value],m=a.value;return typeof u==typeof m&&u>=m}],"filter-id->=":[Ni,[Oi],(c,[i])=>{const a=c.id(),u=i.value;return typeof a==typeof u&&a>=u}],"filter-has":[Ni,[Oi],(c,[i])=>i.value in c.properties()],"filter-has-id":[Ni,[],c=>c.id()!==null&&c.id()!==void 0],"filter-type-in":[Ni,[xr(zi)],(c,[i])=>i.value.indexOf(c.geometryType())>=0],"filter-id-in":[Ni,[xr(Oi)],(c,[i])=>i.value.indexOf(c.id())>=0],"filter-in-small":[Ni,[zi,xr(Oi)],(c,[i,a])=>a.value.indexOf(c.properties()[i.value])>=0],"filter-in-large":[Ni,[zi,xr(Oi)],(c,[i,a])=>function(u,m,h,g){for(;h<=g;){const b=h+g>>1;if(m[b]===u)return!0;m[b]>u?g=b-1:h=b+1}return!1}(c.properties()[i.value],a.value,0,a.value.length-1)],all:{type:Ni,overloads:[[[Ni,Ni],(c,[i,a])=>i.evaluate(c)&&a.evaluate(c)],[ql(Ni),(c,i)=>{for(const a of i)if(!a.evaluate(c))return!1;return!0}]]},any:{type:Ni,overloads:[[[Ni,Ni],(c,[i,a])=>i.evaluate(c)||a.evaluate(c)],[ql(Ni),(c,i)=>{for(const a of i)if(a.evaluate(c))return!0;return!1}]]},"!":[Ni,[Ni],(c,[i])=>!i.evaluate(c)],"is-supported-script":[Ni,[zi],(c,[i])=>{const a=c.globals&&c.globals.isSupportedScript;return!a||a(i.evaluate(c))}],upcase:[zi,[zi],(c,[i])=>i.evaluate(c).toUpperCase()],downcase:[zi,[zi],(c,[i])=>i.evaluate(c).toLowerCase()],concat:[zi,ql(Oi),(c,i)=>i.map(a=>Os(a.evaluate(c))).join("")],"resolved-locale":[zi,[Pl],(c,[i])=>i.evaluate(c).resolvedLocale()],random:[qt,[qt,qt,Oi],(c,i)=>{const[a,u,m]=i.map(g=>g.evaluate(c));if(a>u||a===u)return a;let h;if(typeof m=="string")h=function(g){let b=0;if(g.length===0)return b;for(let E=0;E<g.length;E++)b=(b<<5)-b+g.charCodeAt(E),b|=0;return b}(m);else{if(typeof m!="number")throw new Ln(`Invalid seed input: ${m}`);h=m}return a+Kf(h)()*(u-a)}]});class ep{constructor(i,a,u,m){this.expression=i,this._warningHistory={},this._evaluator=new Ec(u,m),this._defaultValue=a?function(h){return h.type==="color"&&(Eg(h.default)||Array.isArray(h.default))?new $i(0,0,0,0):h.type==="color"?$i.parse(h.default)||null:h.default===void 0?null:h.default}(a):null,this._enumValues=a&&a.type==="enum"?a.values:null,this.configDependencies=md(i)}evaluateWithoutErrorHandling(i,a,u,m,h,g,b,E){return this._evaluator.globals=i,this._evaluator.feature=a,this._evaluator.featureState=u,this._evaluator.canonical=m||null,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=g,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=E||null,this.expression.evaluate(this._evaluator)}evaluate(i,a,u,m,h,g,b,E){this._evaluator.globals=i,this._evaluator.feature=a||null,this._evaluator.featureState=u||null,this._evaluator.canonical=m||null,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=g||null,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=E||null;try{const R=this.expression.evaluate(this._evaluator);if(R==null||typeof R=="number"&&R!=R)return this._defaultValue;if(this._enumValues&&!(R in this._enumValues))throw new Ln(`Expected value to be one of ${Object.keys(this._enumValues).map(v=>JSON.stringify(v)).join(", ")}, but found ${JSON.stringify(R)} instead.`);return R}catch(R){return this._warningHistory[R.message]||(this._warningHistory[R.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${R.message}`)),this._defaultValue}}}function Fu(c){return Array.isArray(c)&&c.length>0&&typeof c[0]=="string"&&c[0]in ku}function Bu(c,i,a,u){const m=new gd(ku,[],i?function(g){const b={color:jr,string:zi,number:qt,enum:zi,boolean:Ni,formatted:xs,resolvedImage:Ya};return g.type==="array"?xr(b[g.value]||Oi,g.length):b[g.type]}(i):void 0,void 0,void 0,a,u),h=m.parse(c,void 0,void 0,void 0,i&&i.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?Tg(new ep(h,i,a,u)):va(m.errors)}class tp{constructor(i,a,u,m){this.kind=i,this._styleExpression=a,this.isLightConstant=u,this.isLineProgressConstant=m,this.isStateDependent=i!=="constant"&&!pd(a.expression),this.configDependencies=md(a.expression)}evaluateWithoutErrorHandling(i,a,u,m,h,g){return this._styleExpression.evaluateWithoutErrorHandling(i,a,u,m,h,g)}evaluate(i,a,u,m,h,g){return this._styleExpression.evaluate(i,a,u,m,h,g)}}class wd{constructor(i,a,u,m,h,g){this.kind=i,this.zoomStops=u,this._styleExpression=a,this.isStateDependent=i!=="camera"&&!pd(a.expression),this.isLightConstant=h,this.isLineProgressConstant=g,this.configDependencies=md(a.expression),this.interpolationType=m}evaluateWithoutErrorHandling(i,a,u,m,h,g){return this._styleExpression.evaluateWithoutErrorHandling(i,a,u,m,h,g)}evaluate(i,a,u,m,h,g){return this._styleExpression.evaluate(i,a,u,m,h,g)}interpolationFactor(i,a,u){return this.interpolationType?ta.interpolationFactor(this.interpolationType,i,a,u):0}}function G0(c,i,a,u){if((c=Bu(c,i,a,u)).result==="error")return c;const m=c.value.expression,h=Du(m);if(!h&&!xd(i))return va([new vi("","data expressions not supported")]);const g=Dc(m,["zoom","pitch","distance-from-center"]);if(!g&&!Jf(i))return va([new vi("","zoom expressions not supported")]);const b=Dc(m,["measure-light"]);if(!b&&!U0(i))return va([new vi("","measure-light expression not supported")]);const E=Dc(m,["line-progress"]);if(!E&&!function(S){return Qf(S.expression,"line-progress")}(i))return va([new vi("","line-progress expression not supported")]);const R=i.expression&&i.expression.relaxZoomRestriction,v=Ed(m);return v||g||R?v instanceof vi?va([v]):v instanceof ta&&!bd(i)?va([new vi("",'"interpolate" expressions cannot be used with this property')]):Tg(v?new wd(h&&E?"camera":"composite",c.value,v.labels,v instanceof ta?v.interpolation:void 0,b,E):new tp(h&&E?"constant":"source",c.value,b,E)):va([new vi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Td{constructor(i,a){this._parameters=i,this._specification=a,wc(this,Sg(this._parameters,this._specification))}static deserialize(i){return new Td(i._parameters,i._specification)}static serialize(i){return{_parameters:i._parameters,_specification:i._specification}}}function Ed(c){let i=null;if(c instanceof Wf)i=Ed(c.result);else if(c instanceof Zf){for(const a of c.args)if(i=Ed(a),i)break}else(c instanceof Lu||c instanceof ta)&&c.input instanceof Xr&&c.input.name==="zoom"&&(i=c);return i instanceof vi||c.eachChild(a=>{const u=Ed(a);u instanceof vi?i=u:i&&u&&i!==u&&(i=new vi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}var Ag,H0,sw=function(){if(H0)return Ag;H0=1,Ag=i;var c=3;function i(a,u,m){var h=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var g=new Int32Array(this.arrayBuffer);a=g[0],this.d=(u=g[1])+2*(m=g[2]);for(var b=0;b<this.d*this.d;b++){var E=g[c+b],R=g[c+b+1];h.push(E===R?null:g.subarray(E,R))}var v=g[c+h.length+1];this.keys=g.subarray(g[c+h.length],v),this.bboxes=g.subarray(v),this.insert=this._insertReadonly}else{this.d=u+2*m;for(var S=0;S<this.d*this.d;S++)h.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=a,this.padding=m,this.scale=u/a,this.uid=0;var C=m/u*a;this.min=-C,this.max=a+C}return i.prototype.insert=function(a,u,m,h,g){this._forEachCell(u,m,h,g,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(u),this.bboxes.push(m),this.bboxes.push(h),this.bboxes.push(g)},i.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},i.prototype._insertCell=function(a,u,m,h,g,b){this.cells[g].push(b)},i.prototype.query=function(a,u,m,h,g){var b=this.min,E=this.max;if(a<=b&&u<=b&&E<=m&&E<=h&&!g)return Array.prototype.slice.call(this.keys);var R=[];return this._forEachCell(a,u,m,h,this._queryCell,R,{},g),R},i.prototype._queryCell=function(a,u,m,h,g,b,E,R){var v=this.cells[g];if(v!==null)for(var S=this.keys,C=this.bboxes,T=0;T<v.length;T++){var I=v[T];if(E[I]===void 0){var D=4*I;(R?R(C[D+0],C[D+1],C[D+2],C[D+3]):a<=C[D+2]&&u<=C[D+3]&&m>=C[D+0]&&h>=C[D+1])?(E[I]=!0,b.push(S[I])):E[I]=!1}}},i.prototype._forEachCell=function(a,u,m,h,g,b,E,R){for(var v=this._convertToCellCoord(a),S=this._convertToCellCoord(u),C=this._convertToCellCoord(m),T=this._convertToCellCoord(h),I=v;I<=C;I++)for(var D=S;D<=T;D++){var k=this.d*D+I;if((!R||R(this._convertFromCellCoord(I),this._convertFromCellCoord(D),this._convertFromCellCoord(I+1),this._convertFromCellCoord(D+1)))&&g.call(this,a,u,m,h,k,b,E,R))return}},i.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},i.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},i.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,u=c+this.cells.length+1+1,m=0,h=0;h<this.cells.length;h++)m+=this.cells[h].length;var g=new Int32Array(u+m+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;for(var b=u,E=0;E<a.length;E++){var R=a[E];g[c+E]=b,g.set(R,b),b+=R.length}return g[c+a.length]=b,g.set(this.keys,b),g[c+a.length+1]=b+=this.keys.length,g.set(this.bboxes,b),b+=this.bboxes.length,g.buffer},Ag}(),zc=N(sw);const ip={};function Gt(c,i,a={}){Object.defineProperty(c,"_classRegistryKey",{value:i,writable:!1}),ip[i]={klass:c,omit:a.omit||[]}}Gt(Object,"Object"),zc.serialize=function(c,i){const a=c.toArrayBuffer();return i&&i.add(a),{buffer:a}},zc.deserialize=function(c){return new zc(c.buffer)},Object.defineProperty(zc,"name",{value:"Grid"}),Gt(zc,"Grid"),typeof DOMMatrix<"u"&&Gt(DOMMatrix,"DOMMatrix"),Gt($i,"Color"),Gt(Error,"Error"),Gt(br,"Formatted"),Gt(zl,"FormattedSection"),Gt(Un,"AJAXError"),Gt(Fn,"ResolvedImage"),Gt(Td,"StylePropertyFunction"),Gt(ep,"StyleExpression",{omit:["_evaluator"]}),Gt(_a,"ImageIdWithOptions"),Gt(wd,"ZoomDependentExpression"),Gt(tp,"ZoomConstantExpression"),Gt(Xr,"CompoundExpression",{omit:["_evaluate"]});for(const c in ku)ip[ku[c]._classRegistryKey]||Gt(ku[c],`Expression${c}`);function Ig(c){return c&&typeof ArrayBuffer<"u"&&(c instanceof ArrayBuffer||c.constructor&&c.constructor.name==="ArrayBuffer")}function Mg(c){return self.ImageBitmap&&c instanceof ImageBitmap}function Gl(c,i){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp)return c;if(Ig(c)||Mg(c))return i&&i.add(c),c;if(ArrayBuffer.isView(c))return i&&i.add(c.buffer),c;if(c instanceof ImageData)return i&&i.add(c.data.buffer),c;if(Array.isArray(c)){const a=[];for(const u of c)a.push(Gl(u,i));return a}if(c instanceof Map){const a={$name:"Map"};for(const[u,m]of c.entries())a[u]=Gl(m);return a}if(c instanceof Set){const a={$name:"Set"};let u=0;for(const m of c.values())a[++u]=Gl(m);return a}if(typeof c=="object"){const a=c.constructor,u=a._classRegistryKey;if(!u)throw new Error(`Can't serialize object of unregistered class "${u}".`);const m=a.serialize?a.serialize(c,i):{};if(!a.serialize){for(const h in c)c.hasOwnProperty(h)&&(ip[u].omit.indexOf(h)>=0||(m[h]=Gl(c[h],i)));c instanceof Error&&(m.message=c.message)}if(m.$name)throw new Error("$name property is reserved for worker serialization logic.");return u!=="Object"&&(m.$name=u),m}throw new Error("can't serialize object of type "+typeof c)}function Oc(c){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||Ig(c)||Mg(c)||ArrayBuffer.isView(c)||c instanceof ImageData)return c;if(Array.isArray(c))return c.map(Oc);if(typeof c=="object"){const i=c.$name||"Object";if(i==="Map"){const m=new Map;for(const h of Object.keys(c))h!=="$name"&&m.set(h,Oc(c[h]));return m}if(i==="Set"){const m=new Set;for(const h of Object.keys(c))h!=="$name"&&m.add(Oc(c[h]));return m}const{klass:a}=ip[i];if(!a)throw new Error(`Can't deserialize unregistered class "${i}".`);if(a.deserialize)return a.deserialize(c);const u=Object.create(a.prototype);for(const m of Object.keys(c))m!=="$name"&&(u[m]=Oc(c[m]));return u}throw new Error("can't deserialize object of type "+typeof c)}const Wt={"Latin-1 Supplement":c=>c>=128&&c<=255,Arabic:c=>c>=1536&&c<=1791,"Arabic Supplement":c=>c>=1872&&c<=1919,"Arabic Extended-A":c=>c>=2208&&c<=2303,"Hangul Jamo":c=>c>=4352&&c<=4607,"Unified Canadian Aboriginal Syllabics":c=>c>=5120&&c<=5759,Khmer:c=>c>=6016&&c<=6143,"Unified Canadian Aboriginal Syllabics Extended":c=>c>=6320&&c<=6399,"General Punctuation":c=>c>=8192&&c<=8303,"Letterlike Symbols":c=>c>=8448&&c<=8527,"Number Forms":c=>c>=8528&&c<=8591,"Miscellaneous Technical":c=>c>=8960&&c<=9215,"Control Pictures":c=>c>=9216&&c<=9279,"Optical Character Recognition":c=>c>=9280&&c<=9311,"Enclosed Alphanumerics":c=>c>=9312&&c<=9471,"Geometric Shapes":c=>c>=9632&&c<=9727,"Miscellaneous Symbols":c=>c>=9728&&c<=9983,"Miscellaneous Symbols and Arrows":c=>c>=11008&&c<=11263,"CJK Radicals Supplement":c=>c>=11904&&c<=12031,"Kangxi Radicals":c=>c>=12032&&c<=12255,"Ideographic Description Characters":c=>c>=12272&&c<=12287,"CJK Symbols and Punctuation":c=>c>=12288&&c<=12351,Hiragana:c=>c>=12352&&c<=12447,Katakana:c=>c>=12448&&c<=12543,Bopomofo:c=>c>=12544&&c<=12591,"Hangul Compatibility Jamo":c=>c>=12592&&c<=12687,Kanbun:c=>c>=12688&&c<=12703,"Bopomofo Extended":c=>c>=12704&&c<=12735,"CJK Strokes":c=>c>=12736&&c<=12783,"Katakana Phonetic Extensions":c=>c>=12784&&c<=12799,"Enclosed CJK Letters and Months":c=>c>=12800&&c<=13055,"CJK Compatibility":c=>c>=13056&&c<=13311,"CJK Unified Ideographs Extension A":c=>c>=13312&&c<=19903,"Yijing Hexagram Symbols":c=>c>=19904&&c<=19967,"CJK Unified Ideographs":c=>c>=19968&&c<=40959,"Yi Syllables":c=>c>=40960&&c<=42127,"Yi Radicals":c=>c>=42128&&c<=42191,"Hangul Jamo Extended-A":c=>c>=43360&&c<=43391,"Hangul Syllables":c=>c>=44032&&c<=55215,"Hangul Jamo Extended-B":c=>c>=55216&&c<=55295,"Private Use Area":c=>c>=57344&&c<=63743,"CJK Compatibility Ideographs":c=>c>=63744&&c<=64255,"Arabic Presentation Forms-A":c=>c>=64336&&c<=65023,"Vertical Forms":c=>c>=65040&&c<=65055,"CJK Compatibility Forms":c=>c>=65072&&c<=65103,"Small Form Variants":c=>c>=65104&&c<=65135,"Arabic Presentation Forms-B":c=>c>=65136&&c<=65279,"Halfwidth and Fullwidth Forms":c=>c>=65280&&c<=65519,Osage:c=>c>=66736&&c<=66815,"CJK Unified Ideographs Extension B":c=>c>=131072&&c<=173791};function Cg(c){for(const i of c)if(np(i.charCodeAt(0)))return!0;return!1}function aw(c){for(const i of c)if(!ow(i.charCodeAt(0)))return!1;return!0}function ow(c){return!(Wt.Arabic(c)||Wt["Arabic Supplement"](c)||Wt["Arabic Extended-A"](c)||Wt["Arabic Presentation Forms-A"](c)||Wt["Arabic Presentation Forms-B"](c))}function np(c){return!(c!==746&&c!==747&&(c<4352||!(Wt["Bopomofo Extended"](c)||Wt.Bopomofo(c)||Wt["CJK Compatibility Forms"](c)&&!(c>=65097&&c<=65103)||Wt["CJK Compatibility Ideographs"](c)||Wt["CJK Compatibility"](c)||Wt["CJK Radicals Supplement"](c)||Wt["CJK Strokes"](c)||!(!Wt["CJK Symbols and Punctuation"](c)||c>=12296&&c<=12305||c>=12308&&c<=12319||c===12336)||Wt["CJK Unified Ideographs Extension A"](c)||Wt["CJK Unified Ideographs"](c)||Wt["Enclosed CJK Letters and Months"](c)||Wt["Hangul Compatibility Jamo"](c)||Wt["Hangul Jamo Extended-A"](c)||Wt["Hangul Jamo Extended-B"](c)||Wt["Hangul Jamo"](c)||Wt["Hangul Syllables"](c)||Wt.Hiragana(c)||Wt["Ideographic Description Characters"](c)||Wt.Kanbun(c)||Wt["Kangxi Radicals"](c)||Wt["Katakana Phonetic Extensions"](c)||Wt.Katakana(c)&&c!==12540||!(!Wt["Halfwidth and Fullwidth Forms"](c)||c===65288||c===65289||c===65293||c>=65306&&c<=65310||c===65339||c===65341||c===65343||c>=65371&&c<=65503||c===65507||c>=65512&&c<=65519)||!(!Wt["Small Form Variants"](c)||c>=65112&&c<=65118||c>=65123&&c<=65126)||Wt["Unified Canadian Aboriginal Syllabics"](c)||Wt["Unified Canadian Aboriginal Syllabics Extended"](c)||Wt["Vertical Forms"](c)||Wt["Yijing Hexagram Symbols"](c)||Wt["Yi Syllables"](c)||Wt["Yi Radicals"](c))))}function Rg(c){return!(np(c)||function(i){return!!(Wt["Latin-1 Supplement"](i)&&(i===167||i===169||i===174||i===177||i===188||i===189||i===190||i===215||i===247)||Wt["General Punctuation"](i)&&(i===8214||i===8224||i===8225||i===8240||i===8241||i===8251||i===8252||i===8258||i===8263||i===8264||i===8265||i===8273)||Wt["Letterlike Symbols"](i)||Wt["Number Forms"](i)||Wt["Miscellaneous Technical"](i)&&(i>=8960&&i<=8967||i>=8972&&i<=8991||i>=8996&&i<=9e3||i===9003||i>=9085&&i<=9114||i>=9150&&i<=9165||i===9167||i>=9169&&i<=9179||i>=9186&&i<=9215)||Wt["Control Pictures"](i)&&i!==9251||Wt["Optical Character Recognition"](i)||Wt["Enclosed Alphanumerics"](i)||Wt["Geometric Shapes"](i)||Wt["Miscellaneous Symbols"](i)&&!(i>=9754&&i<=9759)||Wt["Miscellaneous Symbols and Arrows"](i)&&(i>=11026&&i<=11055||i>=11088&&i<=11097||i>=11192&&i<=11243)||Wt["CJK Symbols and Punctuation"](i)||Wt.Katakana(i)||Wt["Private Use Area"](i)||Wt["CJK Compatibility Forms"](i)||Wt["Small Form Variants"](i)||Wt["Halfwidth and Fullwidth Forms"](i)||i===8734||i===8756||i===8757||i>=9984&&i<=10087||i>=10102&&i<=10131||i===65532||i===65533)}(c))}function Dg(c){return c>=1424&&c<=2303||Wt["Arabic Presentation Forms-A"](c)||Wt["Arabic Presentation Forms-B"](c)}function $0(c,i){return!(!i&&Dg(c)||c>=2304&&c<=3583||c>=3840&&c<=4255||Wt.Khmer(c))}function Pg(c){for(const i of c)if(Dg(i.charCodeAt(0)))return!0;return!1}const Sd="deferred",rp="loading",Lg="loaded";let To=null,ia="unavailable",Hl=null;const zg=function(c){c&&typeof c=="string"&&c.indexOf("NetworkError")>-1&&(ia="error"),To&&To(c)};function Og(){Vu.fire(new zs("pluginStateChange",{pluginStatus:ia,pluginURL:Hl}))}const Vu=new Xa,sp=function(){return ia},Ad=function(){if(ia!==Sd||!Hl)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ia=rp,Og(),Hl&&Qn({url:Hl},c=>{c?zg(c):(ia=Lg,Og())})},xa={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>ia===Lg||xa.applyArabicShaping!=null,isLoading:()=>ia===rp,setState(c){ia=c.pluginStatus,Hl=c.pluginURL},isParsed:()=>xa.applyArabicShaping!=null&&xa.processBidirectionalText!=null&&xa.processStyledBidirectionalText!=null,getPluginURL:()=>Hl};class vn{constructor(i,a){this.zoom=i,a?(this.now=a.now,this.fadeDuration=a.fadeDuration,this.transition=a.transition,this.pitch=a.pitch,this.brightness=a.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(i){return function(a,u){for(const m of a)if(!$0(m.charCodeAt(0),u))return!1;return!0}(i,xa.isLoaded())}}class ap{constructor(i,a,u,m){this.property=i,this.value=a,this.expression=function(h,g,b,E){if(Eg(h))return new Td(h,g);if(Fu(h)||Array.isArray(h)&&h.length>0){const R=G0(h,g,b,E);if(R.result==="error")throw new Error(R.value.map(v=>`${v.key}: ${v.message}`).join(", "));return R.value}{let R=h;return typeof h=="string"&&g.type==="color"&&(R=$i.parse(h)),{kind:"constant",configDependencies:new Set,evaluate:()=>R}}}(a===void 0?i.specification.default:a,i.specification,u,m)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(i,a,u){return this.property.possiblyEvaluate(this,i,a,u)}}class Id{constructor(i,a,u){this.property=i,this.value=new ap(i,void 0,a,u)}transitioned(i,a){return new kg(this.property,this.value,a,Sn({},i.transition,this.transition),i.now)}untransitioned(){return new kg(this.property,this.value,null,{},0)}}class op{constructor(i,a,u){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues),this._scope=a,this._options=u,this.configDependencies=new Set}getValue(i){return as(this._values[i].value.value)}setValue(i,a){this._values.hasOwnProperty(i)||(this._values[i]=new Id(this._values[i].property,this._scope,this._options)),this._values[i].value=new ap(this._values[i].property,a===null?void 0:as(a),this._scope,this._options),this._values[i].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[i].value.expression.configDependencies]))}setTransitionOrValue(i,a){a&&(this._options=a);const u=this._properties.properties;if(i)for(const m in i){const h=i[m];if(Ar(m,"-transition")){const g=m.slice(0,-11);u[g]&&this.setTransition(g,h)}else u.hasOwnProperty(m)&&this.setValue(m,h)}}getTransition(i){return as(this._values[i].transition)}setTransition(i,a){this._values.hasOwnProperty(i)||(this._values[i]=new Id(this._values[i].property)),this._values[i].transition=as(a)||void 0}serialize(){const i={};for(const a of Object.keys(this._values)){const u=this.getValue(a);u!==void 0&&(i[a]=u);const m=this.getTransition(a);m!==void 0&&(i[`${a}-transition`]=m)}return i}transitioned(i,a){const u=new Md(this._properties);for(const m of Object.keys(this._values))u._values[m]=this._values[m].transitioned(i,a._values[m]);return u}untransitioned(){const i=new Md(this._properties);for(const a of Object.keys(this._values))i._values[a]=this._values[a].untransitioned();return i}}class kg{constructor(i,a,u,m,h){const g=m.delay||0,b=m.duration||0;h=h||0,this.property=i,this.value=a,this.begin=h+g,this.end=this.begin+b,i.specification.transition&&(m.delay||m.duration)&&(this.prior=u)}possiblyEvaluate(i,a,u){const m=i.now||0,h=this.value.possiblyEvaluate(i,a,u),g=this.prior;if(g){if(m>this.end)return this.prior=null,h;if(this.value.isDataDriven())return this.prior=null,h;if(m<this.begin)return g.possiblyEvaluate(i,a,u);{const b=(m-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(i,a,u),h,Da(b))}}return h}}class Md{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)}possiblyEvaluate(i,a,u){const m=new qu(this._properties);for(const h of Object.keys(this._values))m._values[h]=this._values[h].possiblyEvaluate(i,a,u);return m}hasTransition(){for(const i of Object.keys(this._values))if(this._values[i].prior)return!0;return!1}}class Uu{constructor(i,a,u){this._properties=i,this._values=Object.create(i.defaultPropertyValues),this._scope=a,this._options=u,this.configDependencies=new Set}getValue(i){return as(this._values[i].value)}setValue(i,a){this._values[i]=new ap(this._values[i].property,a===null?void 0:as(a),this._scope,this._options),this._values[i].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[i].expression.configDependencies]))}serialize(){const i={};for(const a of Object.keys(this._values)){const u=this.getValue(a);u!==void 0&&(i[a]=u)}return i}possiblyEvaluate(i,a,u){const m=new qu(this._properties);for(const h of Object.keys(this._values))m._values[h]=this._values[h].possiblyEvaluate(i,a,u);return m}}class ju{constructor(i,a,u){this.property=i,this.value=a,this.parameters=u}isConstant(){return this.value.kind==="constant"}constantOr(i){return this.value.kind==="constant"?this.value.value:i}evaluate(i,a,u,m){return this.property.evaluate(this.value,this.parameters,i,a,u,m)}}class qu{constructor(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)}get(i){return this._values[i]}}class Et{constructor(i){this.specification=i}possiblyEvaluate(i,a){return i.expression.evaluate(a)}interpolate(i,a,u){const m=bc[this.specification.type];return m?m(i,a,u):i}}class kt{constructor(i,a){this.specification=i,this.overrides=a}possiblyEvaluate(i,a,u,m){return new ju(this,i.expression.kind==="constant"||i.expression.kind==="camera"?{kind:"constant",value:i.expression.evaluate(a,null,{},u,m)}:i.expression,a)}interpolate(i,a,u){if(i.value.kind!=="constant"||a.value.kind!=="constant")return i;if(i.value.value===void 0||a.value.value===void 0)return new ju(this,{kind:"constant",value:void 0},i.parameters);const m=bc[this.specification.type];return m?new ju(this,{kind:"constant",value:m(i.value.value,a.value.value,u)},i.parameters):i}evaluate(i,a,u,m,h,g){return i.kind==="constant"?i.value:i.evaluate(a,u,m,h,g)}}class Gu{constructor(i){this.specification=i}possiblyEvaluate(i,a,u,m){return!!i.expression.evaluate(a,null,{},u,m)}interpolate(){return!1}}class zn{constructor(i){this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const a=new vn(0,{});for(const u in i){const m=i[u];m.specification.overridable&&this.overridableProperties.push(u);const h=this.defaultPropertyValues[u]=new ap(m,void 0),g=this.defaultTransitionablePropertyValues[u]=new Id(m);this.defaultTransitioningPropertyValues[u]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=h.possiblyEvaluate(a)}}}Gt(kt,"DataDrivenProperty"),Gt(Et,"DataConstantProperty"),Gt(Gu,"ColorRampProperty");var Qe=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow","experimental":true},"rain":{"type":"rain","experimental":true},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor","experimental":true},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"experimental":true,"type":"featuresets"}},"featuresets":{"experimental":true,"*":{"type":"featureset"}},"featureset":{"experimental":true,"metadata":{"experimental":true,"type":"*"},"selectors":{"experimental":true,"type":"array","value":"selector"}},"selector":{"experimental":true,"layer":{"experimental":true,"type":"string","required":true},"properties":{"experimental":true,"type":"selectorProperty","required":false},"featureNamespace":{"experimental":true,"type":"string","required":false},"_uniqueFeatureID":{"experimental":true,"type":"boolean","private":true,"required":false}},"selectorProperty":{"experimental":true,"*":{"experimental":true,"type":"*"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"property-type":"data-constant"},"shadow-quality":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]},"experimental":true},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant"},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","experimental":true,"private":true,"expression":{},"property-type":"data-constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"line-cross-slope":{"type":"number","experimental":true,"expression":{},"property-type":"constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","experimental":true,"private":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","experimental":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.4,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","property-type":"data-constant","default":0.71,"minimum":0,"maximum":5,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.57,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","property-type":"data-constant","default":0.7,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}},"buildingFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"flat","property-type":"data-constant"},"fill-extrusion-base-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"terrain","property-type":"data-constant"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]},"experimental":true,"property-type":"data-constant"},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"*"}}}');function Z0(c){return c instanceof Number||c instanceof String||c instanceof Boolean?c.valueOf():c}function lp(c){if(Array.isArray(c))return c.map(lp);if(c instanceof Object&&!(c instanceof Number||c instanceof String||c instanceof Boolean)){const i={};for(const a in c)i[a]=lp(c[a]);return i}return Z0(c)}function Ng(c){if(c===!0||c===!1)return!0;if(!Array.isArray(c)||c.length===0)return!1;switch(c[0]){case"has":return c.length>=2&&c[1]!=="$id"&&c[1]!=="$type";case"in":return c.length>=3&&(typeof c[1]!="string"||Array.isArray(c[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return c.length!==3||Array.isArray(c[1])||Array.isArray(c[2]);case"any":case"all":for(const i of c.slice(1))if(!Ng(i)&&typeof i!="boolean")return!1;return!0;default:return!0}}function W0(c,i="",a=null,u="fill"){if(c==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Ng(c)||(c=cp(c));const m=c;let h=!0;try{h=function(v){if(!Hu(v))return v;let S=lp(v);return Y0(S),S=X0(S),S}(m)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(m,null,2)}
        `)}let g=null,b=null;if(u!=="background"&&u!=="sky"&&u!=="slot"){b=Qe[`filter_${u}`];const v=Bu(h,b,i,a);if(v.result==="error")throw new Error(v.value.map(S=>`${S.key}: ${S.message}`).join(", "));g=(S,C,T)=>v.value.evaluate(S,C,{},T)}let E=null,R=null;if(h!==m){const v=Bu(m,b,i,a);if(v.result==="error")throw new Error(v.value.map(S=>`${S.key}: ${S.message}`).join(", "));E=(S,C,T,I,D)=>v.value.evaluate(S,C,{},T,void 0,void 0,I,D),R=!Du(v.value.expression)}return{filter:g,dynamicFilter:E||void 0,needGeometry:K0(h),needFeature:!!R}}function X0(c){if(!Array.isArray(c))return c;const i=function(a){if(lw.has(a[0])){for(let u=1;u<a.length;u++)if(Hu(a[u]))return!0}return a}(c);return i===!0?i:i.map(a=>X0(a))}function Y0(c){let i=!1;const a=[];if(c[0]==="case"){for(let u=1;u<c.length-1;u+=2)i=i||Hu(c[u]),a.push(c[u+1]);a.push(c[c.length-1])}else if(c[0]==="match"){i=i||Hu(c[1]);for(let u=2;u<c.length-1;u+=2)a.push(c[u+1]);a.push(c[c.length-1])}else if(c[0]==="step"){i=i||Hu(c[1]);for(let u=1;u<c.length-1;u+=2)a.push(c[u+1])}i&&(c.length=0,c.push("any",...a));for(let u=1;u<c.length;u++)Y0(c[u])}function Hu(c){if(!Array.isArray(c))return!1;if((i=c[0])==="pitch"||i==="distance-from-center")return!0;var i;for(let a=1;a<c.length;a++)if(Hu(c[a]))return!0;return!1}const lw=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function cw(c,i){return c<i?-1:c>i?1:0}function K0(c){if(!Array.isArray(c))return!1;if(c[0]==="within"||c[0]==="distance")return!0;for(let i=1;i<c.length;i++)if(K0(c[i]))return!0;return!1}function cp(c){if(!c)return!0;const i=c[0];return c.length<=1?i!=="any":i==="=="?$l(c[1],c[2],"=="):i==="!="?kc($l(c[1],c[2],"==")):i==="<"||i===">"||i==="<="||i===">="?$l(c[1],c[2],i):i==="any"?(a=c.slice(1),["any"].concat(a.map(cp))):i==="all"?["all"].concat(c.slice(1).map(cp)):i==="none"?["all"].concat(c.slice(1).map(cp).map(kc)):i==="in"?Fg(c[1],c.slice(2)):i==="!in"?kc(Fg(c[1],c.slice(2))):i==="has"?Bg(c[1]):i!=="!has"||kc(Bg(c[1]));var a}function $l(c,i,a){switch(c){case"$type":return[`filter-type-${a}`,i];case"$id":return[`filter-id-${a}`,i];default:return[`filter-${a}`,c,i]}}function Fg(c,i){if(i.length===0)return!1;switch(c){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some(a=>typeof a!=typeof i[0])?["filter-in-large",c,["literal",i.sort(cw)]]:["filter-in-small",c,["literal",i]]}}function Bg(c){switch(c){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",c]}}function kc(c){return["!",c]}const up="";function Eo(c,i){return i?`${c}${up}${i}`:c}const ll="-transition",Q0=new Set(["fill","line","background","hillshade","raster"]);class Nr extends Xa{constructor(i,a,u,m,h){if(super(),this.id=i.id,this.fqid=Eo(this.id,u),this.type=i.type,this.scope=u,this.lut=m,this.options=h,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,i.type!=="custom"){if(this.metadata=i.metadata,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,i.type&&i.type!=="background"&&i.type!=="sky"&&i.type!=="slot"){this.source=i.source,this.sourceLayer=i["source-layer"],this.filter=i.filter;const g=Bu(this.filter,Qe[`filter_${i.type}`]);g.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...g.value.configDependencies]))}if(i.slot&&(this.slot=i.slot),a.layout&&(this._unevaluatedLayout=new Uu(a.layout,this.scope,h),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),a.paint){this._transitionablePaint=new op(a.paint,this.scope,h);for(const g in i.paint)this.setPaintProperty(g,i.paint[g]);for(const g in i.layout)this.setLayoutProperty(g,i.layout[g]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new qu(a.paint)}}}onAdd(i){}onRemove(i){}isDraped(i){return!this.is3D()&&Q0.has(this.type)}getLayoutProperty(i){return i==="visibility"?this.visibility:this._unevaluatedLayout.getValue(i)}setLayoutProperty(i,a){if(this.type==="custom"&&i==="visibility")return void(this.visibility=a);const u=this._unevaluatedLayout;u._properties.properties[i]&&(u.setValue(i,a),this.configDependencies=new Set([...this.configDependencies,...u.configDependencies]),i==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(i){return Ar(i,ll)?this._transitionablePaint.getTransition(i.slice(0,-11)):this._transitionablePaint.getValue(i)}setPaintProperty(i,a){const u=this._transitionablePaint,m=u._properties.properties;if(Ar(i,ll)){const S=i.slice(0,-11);return m[S]&&u.setTransition(S,a||void 0),!1}if(!m[i])return!1;const h=u._values[i],g=h.value.isDataDriven(),b=h.value;u.setValue(i,a),this.configDependencies=new Set([...this.configDependencies,...u.configDependencies]),this._handleSpecialPaintPropertyUpdate(i);const E=u._values[i].value,R=E.isDataDriven(),v=Ar(i,"pattern")||i==="line-dasharray";return R||g||v||this._handleOverridablePaintPropertyUpdate(i,b,E)}_handleSpecialPaintPropertyUpdate(i){}getProgramIds(){return null}getDefaultProgramParams(i,a,u){return null}_handleOverridablePaintPropertyUpdate(i,a,u){return!1}isHidden(i){return!!(this.minzoom&&i<this.minzoom)||!!(this.maxzoom&&i>=this.maxzoom)||this.visibility==="none"}updateTransitions(i){this._transitioningPaint=this._transitionablePaint.transitioned(i,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(i,a){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(i,void 0,a)),this.paint=this._transitioningPaint.possiblyEvaluate(i,void 0,a)}serialize(){return tl({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(i,a)=>!(i===void 0||a==="layout"&&!Object.keys(i).length||a==="paint"&&!Object.keys(i).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const i in this.paint._values){const a=this.paint.get(i);if(a instanceof ju&&xd(a.property.specification)&&(a.value.kind==="source"||a.value.kind==="composite")&&a.value.isStateDependent)return!0}return!1}compileFilter(i){this._filterCompiled||(this._featureFilter=W0(this.filter,this.scope,i),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(i){this._stats&&(i.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(i){}queryIntersectsFeature(i,a,u,m,h,g,b,E,R){}}const uw={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Cd{constructor(i,a){this._structArray=i,this._pos1=a*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class xn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(i,a){return i._trim(),a&&(i.isTransferred=!0,a.add(i.arrayBuffer)),{length:i.length,arrayBuffer:i.arrayBuffer}}static deserialize(i){const a=Object.create(this.prototype);return a.arrayBuffer=i.arrayBuffer,a.length=i.length,a.capacity=i.arrayBuffer.byteLength/a.bytesPerElement,a._refreshViews(),a}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(i){this.reserve(i),this.length=i}reserve(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const a=this.uint8;this._refreshViews(),a&&this.uint8.set(a)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...i){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...i){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Xi(c,i=1){let a=0,u=0;return{members:c.map(m=>{const h=uw[m.type].BYTES_PER_ELEMENT,g=a=J0(a,Math.max(i,h)),b=m.components||1;return u=Math.max(u,h),a+=h*b,{name:m.name,type:m.type,components:b,offset:g}}),size:J0(a,Math.max(u,i)),alignment:i}}function J0(c,i){return Math.ceil(c/i)*i}class cl extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a){const u=this.length;return this.resize(u+1),this.emplace(u,i,a)}emplace(i,a,u){const m=2*i;return this.int16[m+0]=a,this.int16[m+1]=u,i}}cl.prototype.bytesPerElement=4,Gt(cl,"StructArrayLayout2i4");class $u extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,u){const m=this.length;return this.resize(m+1),this.emplace(m,i,a,u)}emplace(i,a,u,m){const h=3*i;return this.int16[h+0]=a,this.int16[h+1]=u,this.int16[h+2]=m,i}}$u.prototype.bytesPerElement=6,Gt($u,"StructArrayLayout3i6");class ul extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,u,m){const h=this.length;return this.resize(h+1),this.emplace(h,i,a,u,m)}emplace(i,a,u,m,h){const g=4*i;return this.int16[g+0]=a,this.int16[g+1]=u,this.int16[g+2]=m,this.int16[g+3]=h,i}}ul.prototype.bytesPerElement=8,Gt(ul,"StructArrayLayout4i8");class hp extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,u,m,h){const g=this.length;return this.resize(g+1),this.emplace(g,i,a,u,m,h)}emplace(i,a,u,m,h,g){const b=5*i;return this.int16[b+0]=a,this.int16[b+1]=u,this.int16[b+2]=m,this.int16[b+3]=h,this.int16[b+4]=g,i}}hp.prototype.bytesPerElement=10,Gt(hp,"StructArrayLayout5i10");class Rd extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,u,m,h,g,b){const E=this.length;return this.resize(E+1),this.emplace(E,i,a,u,m,h,g,b)}emplace(i,a,u,m,h,g,b,E){const R=6*i,v=12*i,S=3*i;return this.int16[R+0]=a,this.int16[R+1]=u,this.uint8[v+4]=m,this.uint8[v+5]=h,this.uint8[v+6]=g,this.uint8[v+7]=b,this.float32[S+2]=E,i}}Rd.prototype.bytesPerElement=12,Gt(Rd,"StructArrayLayout2i4ub1f12");class So extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,u){const m=this.length;return this.resize(m+1),this.emplace(m,i,a,u)}emplace(i,a,u,m){const h=3*i;return this.float32[h+0]=a,this.float32[h+1]=u,this.float32[h+2]=m,i}}So.prototype.bytesPerElement=12,Gt(So,"StructArrayLayout3f12");class us extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,u,m,h){const g=this.length;return this.resize(g+1),this.emplace(g,i,a,u,m,h)}emplace(i,a,u,m,h,g){const b=6*i,E=3*i;return this.uint16[b+0]=a,this.uint16[b+1]=u,this.uint16[b+2]=m,this.uint16[b+3]=h,this.float32[E+2]=g,i}}us.prototype.bytesPerElement=12,Gt(us,"StructArrayLayout4ui1f12");class dp extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,u,m){const h=this.length;return this.resize(h+1),this.emplace(h,i,a,u,m)}emplace(i,a,u,m,h){const g=4*i;return this.uint16[g+0]=a,this.uint16[g+1]=u,this.uint16[g+2]=m,this.uint16[g+3]=h,i}}dp.prototype.bytesPerElement=8,Gt(dp,"StructArrayLayout4ui8");class Dd extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,u,m,h,g){const b=this.length;return this.resize(b+1),this.emplace(b,i,a,u,m,h,g)}emplace(i,a,u,m,h,g,b){const E=6*i;return this.int16[E+0]=a,this.int16[E+1]=u,this.int16[E+2]=m,this.int16[E+3]=h,this.int16[E+4]=g,this.int16[E+5]=b,i}}Dd.prototype.bytesPerElement=12,Gt(Dd,"StructArrayLayout6i12");class Vg extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,u,m,h,g,b,E,R,v,S,C){const T=this.length;return this.resize(T+1),this.emplace(T,i,a,u,m,h,g,b,E,R,v,S,C)}emplace(i,a,u,m,h,g,b,E,R,v,S,C,T){const I=12*i;return this.int16[I+0]=a,this.int16[I+1]=u,this.int16[I+2]=m,this.int16[I+3]=h,this.uint16[I+4]=g,this.uint16[I+5]=b,this.uint16[I+6]=E,this.uint16[I+7]=R,this.int16[I+8]=v,this.int16[I+9]=S,this.int16[I+10]=C,this.int16[I+11]=T,i}}Vg.prototype.bytesPerElement=24,Gt(Vg,"StructArrayLayout4i4ui4i24");class Ug extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,u,m,h,g){const b=this.length;return this.resize(b+1),this.emplace(b,i,a,u,m,h,g)}emplace(i,a,u,m,h,g,b){const E=10*i,R=5*i;return this.int16[E+0]=a,this.int16[E+1]=u,this.int16[E+2]=m,this.float32[R+2]=h,this.float32[R+3]=g,this.float32[R+4]=b,i}}Ug.prototype.bytesPerElement=20,Gt(Ug,"StructArrayLayout3i3f20");class Nc extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,u,m){const h=this.length;return this.resize(h+1),this.emplace(h,i,a,u,m)}emplace(i,a,u,m,h){const g=4*i;return this.float32[g+0]=a,this.float32[g+1]=u,this.float32[g+2]=m,this.float32[g+3]=h,i}}Nc.prototype.bytesPerElement=16,Gt(Nc,"StructArrayLayout4f16");class jg extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i){const a=this.length;return this.resize(a+1),this.emplace(a,i)}emplace(i,a){return this.uint32[1*i+0]=a,i}}jg.prototype.bytesPerElement=4,Gt(jg,"StructArrayLayout1ul4");class Zl extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a){const u=this.length;return this.resize(u+1),this.emplace(u,i,a)}emplace(i,a,u){const m=2*i;return this.uint16[m+0]=a,this.uint16[m+1]=u,i}}Zl.prototype.bytesPerElement=4,Gt(Zl,"StructArrayLayout2ui4");class qg extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,u,m,h,g,b,E,R,v,S,C,T){const I=this.length;return this.resize(I+1),this.emplace(I,i,a,u,m,h,g,b,E,R,v,S,C,T)}emplace(i,a,u,m,h,g,b,E,R,v,S,C,T,I){const D=20*i,k=10*i;return this.int16[D+0]=a,this.int16[D+1]=u,this.int16[D+2]=m,this.int16[D+3]=h,this.int16[D+4]=g,this.float32[k+3]=b,this.float32[k+4]=E,this.float32[k+5]=R,this.float32[k+6]=v,this.int16[D+14]=S,this.uint32[k+8]=C,this.uint16[D+18]=T,this.uint16[D+19]=I,i}}qg.prototype.bytesPerElement=40,Gt(qg,"StructArrayLayout5i4f1i1ul2ui40");class fp extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,u,m,h,g,b){const E=this.length;return this.resize(E+1),this.emplace(E,i,a,u,m,h,g,b)}emplace(i,a,u,m,h,g,b,E){const R=8*i;return this.int16[R+0]=a,this.int16[R+1]=u,this.int16[R+2]=m,this.int16[R+4]=h,this.int16[R+5]=g,this.int16[R+6]=b,this.int16[R+7]=E,i}}fp.prototype.bytesPerElement=16,Gt(fp,"StructArrayLayout3i2i2i16");class Gg extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,u,m,h){const g=this.length;return this.resize(g+1),this.emplace(g,i,a,u,m,h)}emplace(i,a,u,m,h,g){const b=4*i,E=8*i;return this.float32[b+0]=a,this.float32[b+1]=u,this.float32[b+2]=m,this.int16[E+6]=h,this.int16[E+7]=g,i}}Gg.prototype.bytesPerElement=16,Gt(Gg,"StructArrayLayout2f1f2i16");class Hg extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,u,m,h,g){const b=this.length;return this.resize(b+1),this.emplace(b,i,a,u,m,h,g)}emplace(i,a,u,m,h,g,b){const E=20*i,R=5*i;return this.uint8[E+0]=a,this.uint8[E+1]=u,this.float32[R+1]=m,this.float32[R+2]=h,this.float32[R+3]=g,this.float32[R+4]=b,i}}Hg.prototype.bytesPerElement=20,Gt(Hg,"StructArrayLayout2ub4f20");class Gr extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,u){const m=this.length;return this.resize(m+1),this.emplace(m,i,a,u)}emplace(i,a,u,m){const h=3*i;return this.uint16[h+0]=a,this.uint16[h+1]=u,this.uint16[h+2]=m,i}}Gr.prototype.bytesPerElement=6,Gt(Gr,"StructArrayLayout3ui6");class $g extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,a,u,m,h,g,b,E,R,v,S,C,T,I,D,k,F,q,H,U,$){const Y=this.length;return this.resize(Y+1),this.emplace(Y,i,a,u,m,h,g,b,E,R,v,S,C,T,I,D,k,F,q,H,U,$)}emplace(i,a,u,m,h,g,b,E,R,v,S,C,T,I,D,k,F,q,H,U,$,Y){const ie=30*i,he=15*i,ue=60*i;return this.int16[ie+0]=a,this.int16[ie+1]=u,this.int16[ie+2]=m,this.float32[he+2]=h,this.float32[he+3]=g,this.uint16[ie+8]=b,this.uint16[ie+9]=E,this.uint32[he+5]=R,this.uint32[he+6]=v,this.uint32[he+7]=S,this.uint16[ie+16]=C,this.uint16[ie+17]=T,this.uint16[ie+18]=I,this.float32[he+10]=D,this.float32[he+11]=k,this.uint8[ue+48]=F,this.uint8[ue+49]=q,this.uint8[ue+50]=H,this.uint32[he+13]=U,this.int16[ie+28]=$,this.uint8[ue+58]=Y,i}}$g.prototype.bytesPerElement=60,Gt($g,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Zg extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,a,u,m,h,g,b,E,R,v,S,C,T,I,D,k,F,q,H,U,$,Y,ie,he,ue,ce,Ie,de,Me,ze,Pe,Ne){const qe=this.length;return this.resize(qe+1),this.emplace(qe,i,a,u,m,h,g,b,E,R,v,S,C,T,I,D,k,F,q,H,U,$,Y,ie,he,ue,ce,Ie,de,Me,ze,Pe,Ne)}emplace(i,a,u,m,h,g,b,E,R,v,S,C,T,I,D,k,F,q,H,U,$,Y,ie,he,ue,ce,Ie,de,Me,ze,Pe,Ne,qe){const Ze=20*i,Be=40*i,ct=80*i;return this.float32[Ze+0]=a,this.float32[Ze+1]=u,this.int16[Be+4]=m,this.int16[Be+5]=h,this.int16[Be+6]=g,this.int16[Be+7]=b,this.int16[Be+8]=E,this.int16[Be+9]=R,this.int16[Be+10]=v,this.int16[Be+11]=S,this.int16[Be+12]=C,this.uint16[Be+13]=T,this.uint16[Be+14]=I,this.uint16[Be+15]=D,this.uint16[Be+16]=k,this.uint16[Be+17]=F,this.uint16[Be+18]=q,this.uint16[Be+19]=H,this.uint16[Be+20]=U,this.uint16[Be+21]=$,this.uint16[Be+22]=Y,this.uint16[Be+23]=ie,this.uint16[Be+24]=he,this.uint16[Be+25]=ue,this.uint16[Be+26]=ce,this.uint16[Be+27]=Ie,this.uint32[Ze+14]=de,this.float32[Ze+15]=Me,this.float32[Ze+16]=ze,this.float32[Ze+17]=Pe,this.float32[Ze+18]=Ne,this.uint8[ct+76]=qe,i}}Zg.prototype.bytesPerElement=80,Gt(Zg,"StructArrayLayout2f9i15ui1ul4f1ub80");class Pd extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i){const a=this.length;return this.resize(a+1),this.emplace(a,i)}emplace(i,a){return this.float32[1*i+0]=a,i}}Pd.prototype.bytesPerElement=4,Gt(Pd,"StructArrayLayout1f4");class Wl extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,u,m,h){const g=this.length;return this.resize(g+1),this.emplace(g,i,a,u,m,h)}emplace(i,a,u,m,h,g){const b=5*i;return this.float32[b+0]=a,this.float32[b+1]=u,this.float32[b+2]=m,this.float32[b+3]=h,this.float32[b+4]=g,i}}Wl.prototype.bytesPerElement=20,Gt(Wl,"StructArrayLayout5f20");class pp extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,u,m,h,g,b){const E=this.length;return this.resize(E+1),this.emplace(E,i,a,u,m,h,g,b)}emplace(i,a,u,m,h,g,b,E){const R=7*i;return this.float32[R+0]=a,this.float32[R+1]=u,this.float32[R+2]=m,this.float32[R+3]=h,this.float32[R+4]=g,this.float32[R+5]=b,this.float32[R+6]=E,i}}pp.prototype.bytesPerElement=28,Gt(pp,"StructArrayLayout7f28");class Ao extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,u,m,h,g,b,E,R,v,S){const C=this.length;return this.resize(C+1),this.emplace(C,i,a,u,m,h,g,b,E,R,v,S)}emplace(i,a,u,m,h,g,b,E,R,v,S,C){const T=11*i;return this.float32[T+0]=a,this.float32[T+1]=u,this.float32[T+2]=m,this.float32[T+3]=h,this.float32[T+4]=g,this.float32[T+5]=b,this.float32[T+6]=E,this.float32[T+7]=R,this.float32[T+8]=v,this.float32[T+9]=S,this.float32[T+10]=C,i}}Ao.prototype.bytesPerElement=44,Gt(Ao,"StructArrayLayout11f44");class mp extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,u,m,h,g,b,E,R){const v=this.length;return this.resize(v+1),this.emplace(v,i,a,u,m,h,g,b,E,R)}emplace(i,a,u,m,h,g,b,E,R,v){const S=9*i;return this.float32[S+0]=a,this.float32[S+1]=u,this.float32[S+2]=m,this.float32[S+3]=h,this.float32[S+4]=g,this.float32[S+5]=b,this.float32[S+6]=E,this.float32[S+7]=R,this.float32[S+8]=v,i}}mp.prototype.bytesPerElement=36,Gt(mp,"StructArrayLayout9f36");class Zu extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a){const u=this.length;return this.resize(u+1),this.emplace(u,i,a)}emplace(i,a,u){const m=2*i;return this.float32[m+0]=a,this.float32[m+1]=u,i}}Zu.prototype.bytesPerElement=8,Gt(Zu,"StructArrayLayout2f8");class Wg extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,u,m){const h=this.length;return this.resize(h+1),this.emplace(h,i,a,u,m)}emplace(i,a,u,m,h){const g=6*i;return this.uint32[3*i+0]=a,this.uint16[g+2]=u,this.uint16[g+3]=m,this.uint16[g+4]=h,i}}Wg.prototype.bytesPerElement=12,Gt(Wg,"StructArrayLayout1ul3ui12");class Xg extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i){const a=this.length;return this.resize(a+1),this.emplace(a,i)}emplace(i,a){return this.uint16[1*i+0]=a,i}}Xg.prototype.bytesPerElement=2,Gt(Xg,"StructArrayLayout1ui2");class Ld extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,u,m,h,g,b,E,R,v,S,C,T,I,D,k){const F=this.length;return this.resize(F+1),this.emplace(F,i,a,u,m,h,g,b,E,R,v,S,C,T,I,D,k)}emplace(i,a,u,m,h,g,b,E,R,v,S,C,T,I,D,k,F){const q=16*i;return this.float32[q+0]=a,this.float32[q+1]=u,this.float32[q+2]=m,this.float32[q+3]=h,this.float32[q+4]=g,this.float32[q+5]=b,this.float32[q+6]=E,this.float32[q+7]=R,this.float32[q+8]=v,this.float32[q+9]=S,this.float32[q+10]=C,this.float32[q+11]=T,this.float32[q+12]=I,this.float32[q+13]=D,this.float32[q+14]=k,this.float32[q+15]=F,i}}Ld.prototype.bytesPerElement=64,Gt(Ld,"StructArrayLayout16f64");class zd extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,u,m,h,g,b){const E=this.length;return this.resize(E+1),this.emplace(E,i,a,u,m,h,g,b)}emplace(i,a,u,m,h,g,b,E){const R=10*i,v=5*i;return this.uint16[R+0]=a,this.uint16[R+1]=u,this.uint16[R+2]=m,this.uint16[R+3]=h,this.float32[v+2]=g,this.float32[v+3]=b,this.float32[v+4]=E,i}}zd.prototype.bytesPerElement=20,Gt(zd,"StructArrayLayout4ui3f20");class Yg extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i){const a=this.length;return this.resize(a+1),this.emplace(a,i)}emplace(i,a){return this.int16[1*i+0]=a,i}}Yg.prototype.bytesPerElement=2,Gt(Yg,"StructArrayLayout1i2");class gp extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(i){const a=this.length;return this.resize(a+1),this.emplace(a,i)}emplace(i,a){return this.uint8[1*i+0]=a,i}}gp.prototype.bytesPerElement=1,Gt(gp,"StructArrayLayout1ub1");class ev extends Cd{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}ev.prototype.size=40;class Kg extends qg{get(i){return new ev(this,i)}}Gt(Kg,"CollisionBoxArray");class Od extends Cd{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(i){this._structArray.uint8[this._pos1+49]=i}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(i){this._structArray.uint8[this._pos1+50]=i}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(i){this._structArray.uint32[this._pos4+13]=i}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(i){this._structArray.uint8[this._pos1+58]=i}}Od.prototype.size=60;class tv extends $g{get(i){return new Od(this,i)}}Gt(tv,"PlacedSymbolArray");class iv extends Cd{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(i){this._structArray.uint32[this._pos4+14]=i}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(i){this._structArray.float32[this._pos4+18]=i}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}iv.prototype.size=80;class nv extends Zg{get(i){return new iv(this,i)}}Gt(nv,"SymbolInstanceArray");class rv extends Pd{getoffsetX(i){return this.float32[1*i+0]}}Gt(rv,"GlyphOffsetArray");class sv extends cl{getx(i){return this.int16[2*i+0]}gety(i){return this.int16[2*i+1]}}Gt(sv,"SymbolLineVertexArray");class kd extends Cd{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}kd.prototype.size=12;class Nd extends Wg{get(i){return new kd(this,i)}}Gt(Nd,"FeatureIndexArray");class na extends Zl{geta_centroid_pos0(i){return this.uint16[2*i+0]}geta_centroid_pos1(i){return this.uint16[2*i+1]}}Gt(na,"FillExtrusionCentroidArray");class Fd extends Cd{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Fd.prototype.size=6;class av extends $u{get(i){return new Fd(this,i)}}Gt(av,"FillExtrusionWallArray");const hw=Xi([{name:"a_pos",components:2,type:"Int16"}],4),dw=Xi([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class $n{constructor(i=[]){this.segments=i}_prepareSegment(i,a,u,m){let h=this.segments[this.segments.length-1];return i>$n.MAX_VERTEX_ARRAY_LENGTH&&yi(`Max vertices per segment is ${$n.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${i}`),(!h||h.vertexLength+i>$n.MAX_VERTEX_ARRAY_LENGTH||h.sortKey!==m)&&(h={vertexOffset:a,primitiveOffset:u,vertexLength:0,primitiveLength:0},m!==void 0&&(h.sortKey=m),this.segments.push(h)),h}prepareSegment(i,a,u,m){return this._prepareSegment(i,a.length,u.length,m)}get(){return this.segments}destroy(){for(const i of this.segments)for(const a in i.vaos)i.vaos[a].destroy()}static simpleSegment(i,a,u,m){return new $n([{vertexOffset:i,primitiveOffset:a,vertexLength:u,primitiveLength:m,vaos:{},sortKey:0}])}}function _p(c,i){return 256*(c=bi(Math.floor(c),0,255))+bi(Math.floor(i),0,255)}$n.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Gt($n,"SegmentVector");const fw=Xi([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Qg=Xi([{name:"a_dash",components:4,type:"Uint16"}]);class Bd{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(i,a,u,m){this.ids.push(ov(i)),this.positions.push(a,u,m)}eachPosition(i,a){const u=ov(i);let m=0,h=this.ids.length-1;for(;m<h;){const g=m+h>>1;this.ids[g]>=u?h=g:m=g+1}for(;this.ids[m]===u;)a(this.positions[3*m],this.positions[3*m+1],this.positions[3*m+2]),m++}static serialize(i,a){const u=new Float64Array(i.ids),m=new Uint32Array(i.positions);return Vd(u,m,0,u.length-1),a&&(a.add(u.buffer),a.add(m.buffer)),{ids:u,positions:m}}static deserialize(i){const a=new Bd;let u;a.ids=i.ids,a.positions=i.positions;for(const m of a.ids)m!==u&&a.uniqueIds.push(m),u=m;return a.indexed=!0,a}}function ov(c){const i=+c;return!isNaN(i)&&Number.MIN_SAFE_INTEGER<=i&&i<=Number.MAX_SAFE_INTEGER?i:an(String(c))}function Vd(c,i,a,u){for(;a<u;){const m=c[a+u>>1];let h=a-1,g=u+1;for(;;){do h++;while(c[h]<m);do g--;while(c[g]>m);if(h>=g)break;yp(c,h,g),yp(i,3*h,3*g),yp(i,3*h+1,3*g+1),yp(i,3*h+2,3*g+2)}g-a<u-g?(Vd(c,i,a,g),a=g+1):(Vd(c,i,g+1,u),u=g)}}function yp(c,i,a){const u=c[i];c[i]=c[a],c[a]=u}Gt(Bd,"FeaturePositionMap");class Io{constructor(i){this.gl=i.gl,this.initialized=!1}fetchUniformLocation(i,a){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(i,a),this.initialized=!0),!!this.location}set(i,a,u){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Ud extends Io{constructor(i){super(i),this.current=0}set(i,a,u){this.fetchUniformLocation(i,a)&&this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}}class Jn extends Io{constructor(i){super(i),this.current=0}set(i,a,u){this.fetchUniformLocation(i,a)&&this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))}}class ka extends Io{constructor(i){super(i),this.current=[0,0]}set(i,a,u){this.fetchUniformLocation(i,a)&&(u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1])))}}class Wu extends Io{constructor(i){super(i),this.current=[0,0,0]}set(i,a,u){this.fetchUniformLocation(i,a)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2])))}}class jd extends Io{constructor(i){super(i),this.current=[0,0,0,0]}set(i,a,u){this.fetchUniformLocation(i,a)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3])))}}class lv extends Io{constructor(i){super(i),this.current=$i.transparent.toRenderColor(null)}set(i,a,u){this.fetchUniformLocation(i,a)&&(u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a)))}}const cv=new Float32Array(16);class qd extends Io{constructor(i){super(i),this.current=cv}set(i,a,u){if(this.fetchUniformLocation(i,a)){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let m=1;m<16;m++)if(u[m]!==this.current[m]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}}}const Jg=new Float32Array(9),pw=new Float32Array(4);class e_ extends Io{constructor(i){super(i),this.current=pw}set(i,a,u){if(this.fetchUniformLocation(i,a)){for(let m=0;m<4;m++)if(u[m]!==this.current[m]){this.current=u,this.gl.uniformMatrix2fv(this.location,!1,u);break}}}}function t_(c){return[_p(255*c.r,255*c.g),_p(255*c.b,255*c.a)]}class Fc{constructor(i,a,u,m){this.value=i,this.uniformNames=a.map(h=>`u_${h}`),this.type=u,this.context=m}setUniform(i,a,u,m,h){const g=m.constantOr(this.value);a.set(i,h,g instanceof $i?g.toRenderColor(this.ignoreLut?null:this.context.lut):g)}getBinding(i,a){return this.type==="color"?new lv(i):new Jn(i)}}class Bc{constructor(i,a){this.uniformNames=a.map(u=>`u_${u}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(i){this.pixelRatio=i.pixelRatio||1,this.pattern=i.tl.concat(i.br)}setUniform(i,a,u,m,h){const g=h==="u_pattern"||h==="u_dash"?this.pattern:h==="u_pixel_ratio"?this.pixelRatio:null;g&&a.set(i,h,g)}getBinding(i,a){return a==="u_pattern"||a==="u_dash"?new jd(i):new Jn(i)}}class hl{constructor(i,a,u,m){this.expression=i,this.type=u,this.maxValue=0,this.paintVertexAttributes=a.map(h=>({name:`a_${h}`,type:"Float32",components:u==="color"?2:1,offset:0})),this.paintVertexArray=new m}populatePaintArray(i,a,u,m,h,g,b){const E=this.paintVertexArray.length,R=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new vn(0,{brightness:g}),a,{},h,m,b):this.expression.kind==="constant"&&this.expression.value;!this.lutExpression||this.lutExpression.kind!=="composite"&&this.lutExpression.kind!=="source"||(this.ignoreLut=this.lutExpression.evaluate(new vn(0,{brightness:g}),a,{},h,m,b)==="none"),this.paintVertexArray.resize(i),this._setPaintValue(E,i,R,this.context)}updatePaintArray(i,a,u,m,h,g,b){const E=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:b},u,m,void 0,h):this.expression.kind==="constant"&&this.expression.value;!this.lutExpression||this.lutExpression.kind!=="composite"&&this.lutExpression.kind!=="source"||(this.ignoreLut=this.lutExpression.evaluate({zoom:0,brightness:b},u,m,void 0,h)==="none"),this._setPaintValue(i,a,E,this.context)}_setPaintValue(i,a,u,m){if(this.type==="color"){const h=t_(u.toRenderColor(this.ignoreLut?null:m.lut));for(let g=i;g<a;g++)this.paintVertexArray.emplace(g,h[0],h[1])}else{for(let h=i;h<a;h++)this.paintVertexArray.emplace(h,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class to{constructor(i,a,u,m,h,g){this.expression=i,this.uniformNames=a.map(b=>`u_${b}_t`),this.type=u,this.useIntegerZoom=m,this.context=h,this.maxValue=0,this.paintVertexAttributes=a.map(b=>({name:`a_${b}`,type:"Float32",components:u==="color"?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(i,a,u,m,h,g,b){const E=this.expression.evaluate(new vn(this.context.zoom,{brightness:g}),a,{},h,m,b),R=this.expression.evaluate(new vn(this.context.zoom+1,{brightness:g}),a,{},h,m,b);!this.lutExpression||this.lutExpression.kind!=="composite"&&this.lutExpression.kind!=="source"||(this.ignoreLut=this.lutExpression.evaluate(new vn(this.context.zoom,{brightness:g}),a,{},h,m,b)==="none");const v=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(v,i,E,R,this.context)}updatePaintArray(i,a,u,m,h,g,b){const E=this.expression.evaluate({zoom:this.context.zoom,brightness:b},u,m,void 0,h),R=this.expression.evaluate({zoom:this.context.zoom+1,brightness:b},u,m,void 0,h);!this.lutExpression||this.lutExpression.kind!=="composite"&&this.lutExpression.kind!=="source"||(this.ignoreLut=this.lutExpression.evaluate({zoom:this.context.zoom,brightness:b},u,m,void 0,h)==="none"),this._setPaintValue(i,a,E,R,this.context)}_setPaintValue(i,a,u,m,h){if(this.type==="color"){const g=t_(u.toRenderColor(this.ignoreLut?null:h.lut)),b=t_(u.toRenderColor(this.ignoreLut?null:h.lut));for(let E=i;E<a;E++)this.paintVertexArray.emplace(E,g[0],g[1],b[0],b[1])}else{for(let g=i;g<a;g++)this.paintVertexArray.emplace(g,u,m);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(m))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(i,a,u,m,h){const g=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,b=bi(this.expression.interpolationFactor(g,this.context.zoom,this.context.zoom+1),0,1);a.set(i,h,b)}getBinding(i,a){return new Jn(i)}}class Xl{constructor(i,a,u,m,h){this.expression=i,this.layerId=h,this.paintVertexAttributes=(u==="array"?Qg:fw).members;for(let g=0;g<a.length;++g);this.paintVertexArray=new m}populatePaintArray(i,a,u,m){const h=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValues(h,i,a.patterns&&a.patterns[this.layerId],u)}updatePaintArray(i,a,u,m,h,g,b){this._setPaintValues(i,a,u.patterns&&u.patterns[this.layerId],g)}_setPaintValues(i,a,u,m){if(!m||!u)return;const h=m[u];if(!h)return;const{tl:g,br:b,pixelRatio:E}=h;for(let R=i;R<a;R++)this.paintVertexArray.emplace(R,g[0],g[1],b[0],b[1],E)}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Vc{constructor(i,a,u=()=>!0){this.binders={},this._buffers=[],this.context=a;const m=[];for(const h in i.paint._values){const g=i.paint.get(h),b=i.paint.get(`${h}-use-theme`);if(h.endsWith("-use-theme")||!u(h)||!(g instanceof ju&&xd(g.property.specification)))continue;const E=gw(h,i.type),R=g.value,v=g.property.specification.type,S=!!g.property.useIntegerZoom,C=h==="line-dasharray"||h.endsWith("pattern"),T=h==="line-dasharray"&&i.layout.get("line-cap").value.kind!=="constant"||b&&b.value.kind!=="constant";if(R.kind!=="constant"||T)if(R.kind==="source"||T||C){const I=uv(h,v,"source");this.binders[h]=C?new Xl(R,E,v,I,i.id):new hl(R,E,v,I),m.push(`/a_${h}`)}else{const I=uv(h,v,"composite");this.binders[h]=new to(R,E,v,S,a,I),m.push(`/z_${h}`)}else this.binders[h]=C?new Bc(R.value,E):new Fc(R.value,E,v,a),m.push(`/u_${h}`);b&&(this.binders[h].ignoreLut=b.constantOr("default")==="none",this.binders[h].lutExpression=b.value,this.binders[h].checkUseTheme=!0)}this.cacheKey=m.sort().join("")}getMaxValue(i){const a=this.binders[i];return a instanceof hl||a instanceof to?a.maxValue:0}populatePaintArrays(i,a,u,m,h,g,b){for(const E in this.binders){const R=this.binders[E];R.context=this.context,R instanceof hl||R instanceof to||R instanceof Xl?R.populatePaintArray(i,a,u,m,h,g,b):R.lutExpression&&R instanceof Fc&&R.lutExpression&&(R.lutExpression.kind==="composite"||R.lutExpression.kind==="source")&&(R.ignoreLut=R.lutExpression.evaluate(new vn(0,{brightness:g}),a,{},h,m,b)==="none")}}setConstantPatternPositions(i){for(const a in this.binders){const u=this.binders[a];u instanceof Bc&&u.setConstantPatternPositions(i)}}updatePaintArrays(i,a,u,m,h,g,b,E,R){let v=!1;const S=Object.keys(i),C=S.length!==0&&!E,T=C?S:a.uniqueIds;this.context.lut=h.lut;for(const I in this.binders){const D=this.binders[I];if(D.context=this.context,(D instanceof hl||D instanceof to||D instanceof Xl)&&D.expression&&D.expression.kind&&D.expression.kind!=="constant"&&(D.expression.isStateDependent===!0||D.expression.isLightConstant===!1)){const k=h.paint.get(I);D.expression=k.value;for(const F of T){const q=i[F.toString()];a.eachPosition(F,(H,U,$)=>{const Y=m.feature(H);D.updatePaintArray(U,$,Y,q,g,b,R)})}if(!C)for(const F of u.uniqueIds){const q=i[F.toString()];u.eachPosition(F,(H,U,$)=>{const Y=m.feature(H);D.updatePaintArray(U,$,Y,q,g,b,R)})}v=!0}}return v}defines(){const i=[];for(const a in this.binders){const u=this.binders[a];(u instanceof Fc||u instanceof Bc)&&i.push(...u.uniformNames.map(m=>`#define HAS_UNIFORM_${m}`))}return i}getBinderAttributes(){const i=[];for(const a in this.binders){const u=this.binders[a];if(u instanceof hl||u instanceof to||u instanceof Xl)for(let m=0;m<u.paintVertexAttributes.length;m++)i.push(u.paintVertexAttributes[m].name)}return i}getBinderUniforms(){const i=[];for(const a in this.binders){const u=this.binders[a];if(u instanceof Fc||u instanceof Bc||u instanceof to)for(const m of u.uniformNames)i.push(m)}return i}getPaintVertexBuffers(){return this._buffers}getUniforms(i){const a=[];for(const u in this.binders){const m=this.binders[u];if(m instanceof Fc||m instanceof Bc||m instanceof to)for(const h of m.uniformNames)a.push({name:h,property:u,binding:m.getBinding(i,h)})}return a}setUniforms(i,a,u,m,h){for(const{name:g,property:b,binding:E}of u){if(this.binders[b].checkUseTheme&&this.binders[b]instanceof Fc){const R=m.get(`${b}-use-theme`);R.isConstant()&&(this.binders[b].ignoreLut=R.constantOr("default")==="none")}this.binders[b].setUniform(i,E,h,m.get(b),g)}}updatePaintBuffers(){this._buffers=[];for(const i in this.binders){const a=this.binders[i];(a instanceof hl||a instanceof to||a instanceof Xl)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}}upload(i){for(const a in this.binders){const u=this.binders[a];(u instanceof hl||u instanceof to||u instanceof Xl)&&u.upload(i)}this.updatePaintBuffers()}destroy(){for(const i in this.binders){const a=this.binders[i];(a instanceof hl||a instanceof to||a instanceof Xl)&&a.destroy()}}}class Yl{constructor(i,a,u=()=>!0){this.programConfigurations={};for(const m of i)this.programConfigurations[m.id]=new Vc(m,a,u);this.needsUpload=!1,this._featureMap=new Bd,this._featureMapWithoutIds=new Bd,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(i,a,u,m,h,g,b,E){for(const R in this.programConfigurations)this.programConfigurations[R].populatePaintArrays(i,a,m,h,g,b,E);a.id!==void 0?this._featureMap.add(a.id,u,this._bufferOffset,i):(this._featureMapWithoutIds.add(this._idlessCounter,u,this._bufferOffset,i),this._idlessCounter+=1),this._bufferOffset=i,this.needsUpload=!0}updatePaintArrays(i,a,u,m,h,g,b){for(const E of u)this.needsUpload=this.programConfigurations[E.id].updatePaintArrays(i,this._featureMap,this._featureMapWithoutIds,a,E,m,h,g,b||0)||this.needsUpload}get(i){return this.programConfigurations[i]}upload(i){if(this.needsUpload){for(const a in this.programConfigurations)this.programConfigurations[a].upload(i);this.needsUpload=!1}}destroy(){for(const i in this.programConfigurations)this.programConfigurations[i].destroy()}}const mw={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function gw(c,i){return mw[c]||[c.replace(`${i}-`,"").replace(/-/g,"_")]}const _w={"line-pattern":{source:us,composite:us},"fill-pattern":{source:us,composite:us},"fill-extrusion-pattern":{source:us,composite:us},"line-dasharray":{source:dp,composite:dp}},vp={color:{source:Zu,composite:Nc},number:{source:Pd,composite:Zu}};function uv(c,i,a){const u=_w[c];return u&&u[a]||vp[i][a]}Gt(Fc,"ConstantBinder"),Gt(Bc,"PatternConstantBinder"),Gt(hl,"SourceExpressionBinder"),Gt(Xl,"PatternCompositeBinder"),Gt(to,"CompositeExpressionBinder"),Gt(Vc,"ProgramConfiguration",{omit:["_buffers"]}),Gt(Yl,"ProgramConfigurationSet");const ws=Pt/Math.PI/2,Xu=5,hv=6,dv=16383,Yu=64,xp=[Yu,32,16],ba=-ws,wa=ws;function Ku(c,i,a,u=ws){return a=Li(a),[c*Math.sin(a)*u,-i*u,c*Math.cos(a)*u]}function Uc(c,i,a){return Ku(Math.cos(Li(c)),Math.sin(Li(c)),i,a)}const jc=63710088e-1,i_=2*Math.PI*jc;class Gi{constructor(i,a){if(isNaN(i)||isNaN(a))throw new Error(`Invalid LngLat object: (${i}, ${a})`);if(this.lng=+i,this.lat=+a,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Gi(Ps(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(i){const a=Math.PI/180,u=this.lat*a,m=i.lat*a,h=Math.sin(u)*Math.sin(m)+Math.cos(u)*Math.cos(m)*Math.cos((i.lng-this.lng)*a);return jc*Math.acos(Math.min(h,1))}toBounds(i=0){const a=360*i/40075017,u=a/Math.cos(Math.PI/180*this.lat);return new Kl({lng:this.lng-u,lat:this.lat-a},{lng:this.lng+u,lat:this.lat+a})}toEcef(i){return Uc(this.lat,this.lng,ws+i*ws/jc)}static convert(i){if(i instanceof Gi)return i;if(Array.isArray(i)&&(i.length===2||i.length===3))return new Gi(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&typeof i=="object"&&i!==null)return new Gi(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Kl{constructor(i,a){if(i)if(a)this.setSouthWest(i).setNorthEast(a);else if(i.length===4){const u=i;this.setSouthWest([u[0],u[1]]).setNorthEast([u[2],u[3]])}else{const u=i;this.setSouthWest(u[0]).setNorthEast(u[1])}}setNorthEast(i){return this._ne=i instanceof Gi?new Gi(i.lng,i.lat):Gi.convert(i),this}setSouthWest(i){return this._sw=i instanceof Gi?new Gi(i.lng,i.lat):Gi.convert(i),this}extend(i){const a=this._sw,u=this._ne;let m,h;if(i instanceof Gi)m=i,h=i;else{if(!(i instanceof Kl))return Array.isArray(i)?i.length===4||i.every(Array.isArray)?this.extend(Kl.convert(i)):this.extend(Gi.convert(i)):typeof i=="object"&&i!==null&&i.hasOwnProperty("lat")&&(i.hasOwnProperty("lon")||i.hasOwnProperty("lng"))?this.extend(Gi.convert(i)):this;if(m=i._sw,h=i._ne,!m||!h)return this}return a||u?(a.lng=Math.min(m.lng,a.lng),a.lat=Math.min(m.lat,a.lat),u.lng=Math.max(h.lng,u.lng),u.lat=Math.max(h.lat,u.lat)):(this._sw=new Gi(m.lng,m.lat),this._ne=new Gi(h.lng,h.lat)),this}getCenter(){return new Gi((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Gi(this.getWest(),this.getNorth())}getSouthEast(){return new Gi(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(i){const{lng:a,lat:u}=Gi.convert(i);let m=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&m}static convert(i){if(i)return i instanceof Kl?i:new Kl(i)}}const yw=0,vw=25.5;function bp(c){return i_*Math.cos(c*Math.PI/180)}function Mo(c){return(180+c)/360}function io(c){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c*Math.PI/360)))/360}function Ts(c,i){return c/bp(i)}function ra(c){return 360*c-180}function Hr(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}function fv(c,i){return c*bp(Hr(i))}const Zn=85.051129;function n_(c){return Math.cos(Li(bi(c,-Zn,Zn)))}function Qu(c,i){const a=bi(i,yw,vw),u=Math.pow(2,a);return n_(c)*i_/(512*u)}function f(c){return 1/Math.cos(c*Math.PI/180)}function r(c,i=0){const a=Math.exp(Math.PI*(1-(c.y+i/Pt)/(1<<c.z)*2));return 80150034*a/(a*a+1)/Pt/(1<<c.z)}class o{constructor(i,a,u=0){this.x=+i,this.y=+a,this.z=+u}static fromLngLat(i,a=0){const u=Gi.convert(i);return new o(Mo(u.lng),io(u.lat),Ts(a,u.lat))}toLngLat(){return new Gi(ra(this.x),Hr(this.y))}toAltitude(){return fv(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/i_*f(Hr(this.y))}}function p(c,i,a,u,m,h,g,b,E){const R=(i+u)/2,v=(a+m)/2,S=new St(R,v);b(S),function(C,T,I,D,k,F){const q=I-k,H=D-F;return Math.abs((D-T)*q-(I-C)*H)/Math.hypot(q,H)}(S.x,S.y,h.x,h.y,g.x,g.y)>=E?(p(c,i,a,R,v,h,S,b,E),p(c,R,v,u,m,S,g,b,E)):c.push(g)}function _(c,i,a){let u=c[0],m=u.x,h=u.y;i(u);const g=[u];for(let b=1;b<c.length;b++){const E=c[b],{x:R,y:v}=E;i(E),p(g,m,h,R,v,u,E,i,a),m=R,h=v,u=E}return g}function x(c,i,a,u){if(u(i,a)){const m=i.add(a)._mult(.5);x(c,i,m,u),x(c,m,a,u)}else c.push(a)}function w(c,i){let a=c[0];const u=[a];for(let m=1;m<c.length;m++){const h=c[m];x(u,a,h,i),a=h}return u}const M=Math.pow(2,14)-1,P=-M-1;function z(c,i){const a=Math.round(c.x*i),u=Math.round(c.y*i);return c.x=bi(a,P,M),c.y=bi(u,P,M),(a<c.x||a>c.x+1||u<c.y||u>c.y+1)&&yi("Geometry exceeds allowed extent, reduce your vector tile buffer size"),c}function O(c,i,a){const u=c.loadGeometry(),m=c.extent,h=Pt/m;if(i&&a&&a.projection.isReprojectedInTileSpace){const g=1<<i.z,{scale:b,x:E,y:R,projection:v}=a,S=C=>{const T=ra((i.x+C.x/m)/g),I=Hr((i.y+C.y/m)/g),D=v.project(T,I);C.x=(D.x*b-E)*m,C.y=(D.y*b-R)*m};for(let C=0;C<u.length;C++)if(c.type!==1)u[C]=_(u[C],S,1);else{const T=[];for(const I of u[C])I.x<0||I.x>=m||I.y<0||I.y>=m||(S(I),T.push(I));u[C]=T}}for(const g of u)for(const b of g)z(b,h);return u}function B(c,i){return{type:c.type,id:c.id,properties:c.properties,geometry:i?O(c):[]}}function V(c,i,a,u,m){c.emplaceBack(2*i+(u+1)/2,2*a+(m+1)/2)}function G(c,i,a){c.emplaceBack(i.x,i.y,i.z,a[0]*16384,a[1]*16384,a[2]*16384)}class Q{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=i.index,this.hasPattern=!1,this.projection=i.projection,this.layoutVertexArray=new cl,this.indexArray=new Gr,this.segments=new $n,this.programConfigurations=new Yl(i.layers,{zoom:i.zoom,lut:i.lut}),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}updateFootprints(i,a){}populate(i,a,u,m){const h=this.layers[0],g=[];let b=null;h.type==="circle"&&(b=h.layout.get("circle-sort-key"));for(const{feature:R,id:v,index:S,sourceLayerIndex:C}of i){const T=this.layers[0]._featureFilter.needGeometry,I=B(R,T);if(!this.layers[0]._featureFilter.filter(new vn(this.zoom),I,u))continue;const D=b?b.evaluate(I,{},u):void 0,k={id:v,properties:R.properties,type:R.type,sourceLayerIndex:C,index:S,geometry:T?I.geometry:O(R,u,m),patterns:{},sortKey:D};g.push(k)}b&&g.sort((R,v)=>R.sortKey-v.sortKey);let E=null;m.projection.name==="globe"&&(this.globeExtVertexArray=new Dd,E=m.projection);for(const R of g){const{geometry:v,index:S,sourceLayerIndex:C}=R,T=i[S].feature;this.addFeature(R,v,S,a.availableImages,u,E,a.brightness),a.featureIndex.insert(T,v,S,C,this.index)}}update(i,a,u,m,h,g,b){this.programConfigurations.updatePaintArrays(i,a,h,u,m,g,b)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,hw.members),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=i.createVertexBuffer(this.globeExtVertexArray,dw.members))),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(i,a,u,m,h,g,b){for(const E of a)for(const R of E){const v=R.x,S=R.y;if(v<0||v>=Pt||S<0||S>=Pt)continue;if(g){const I=g.projectTilePoint(v,S,h),D=g.upVector(h,v,S),k=this.globeExtVertexArray;G(k,I,D),G(k,I,D),G(k,I,D),G(k,I,D)}const C=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,i.sortKey),T=C.vertexLength;V(this.layoutVertexArray,v,S,-1,-1),V(this.layoutVertexArray,v,S,1,-1),V(this.layoutVertexArray,v,S,1,1),V(this.layoutVertexArray,v,S,-1,1),this.indexArray.emplaceBack(T,T+1,T+2),this.indexArray.emplaceBack(T,T+2,T+3),C.vertexLength+=4,C.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,u,{},m,h,b)}}function W(c,i){for(let a=0;a<c.length;a++)if(ge(i,c[a]))return!0;for(let a=0;a<i.length;a++)if(ge(c,i[a]))return!0;return!!pe(c,i)}function te(c,i,a){return!!ge(c,i)||!!Te(i,c,a)}function ee(c,i){if(c.length===1)return xe(i,c[0]);for(let a=0;a<i.length;a++){const u=i[a];for(let m=0;m<u.length;m++)if(ge(c,u[m]))return!0}for(let a=0;a<c.length;a++)if(xe(i,c[a]))return!0;for(let a=0;a<i.length;a++)if(pe(c,i[a]))return!0;return!1}function le(c,i,a){if(c.length>1){if(pe(c,i))return!0;for(let u=0;u<i.length;u++)if(Te(i[u],c,a))return!0}for(let u=0;u<c.length;u++)if(Te(c[u],i,a))return!0;return!1}function pe(c,i){if(c.length===0||i.length===0)return!1;for(let a=0;a<c.length-1;a++){const u=c[a],m=c[a+1];for(let h=0;h<i.length-1;h++)if(fe(u,m,i[h],i[h+1]))return!0}return!1}function fe(c,i,a,u){return Ys(c,a,u)!==Ys(i,a,u)&&Ys(c,i,a)!==Ys(c,i,u)}function Te(c,i,a){const u=a*a;if(i.length===1)return c.distSqr(i[0])<u;for(let m=1;m<i.length;m++)if(_e(c,i[m-1],i[m])<u)return!0;return!1}function _e(c,i,a){const u=i.distSqr(a);if(u===0)return c.distSqr(i);const m=((c.x-i.x)*(a.x-i.x)+(c.y-i.y)*(a.y-i.y))/u;return c.distSqr(m<0?i:m>1?a:a.sub(i)._mult(m)._add(i))}function xe(c,i){let a,u,m,h=!1;for(let g=0;g<c.length;g++){a=c[g];for(let b=0,E=a.length-1;b<a.length;E=b++)u=a[b],m=a[E],u.y>i.y!=m.y>i.y&&i.x<(m.x-u.x)*(i.y-u.y)/(m.y-u.y)+u.x&&(h=!h)}return h}function ge(c,i){let a=!1;for(let u=0,m=c.length-1;u<c.length;m=u++){const h=c[u],g=c[m];h.y>i.y!=g.y>i.y&&i.x<(g.x-h.x)*(i.y-h.y)/(g.y-h.y)+h.x&&(a=!a)}return a}function Re(c,i,a,u,m){for(const g of c)if(i<=g.x&&a<=g.y&&u>=g.x&&m>=g.y)return!0;const h=[new St(i,a),new St(i,m),new St(u,m),new St(u,a)];if(c.length>2){for(const g of h)if(ge(c,g))return!0}for(let g=0;g<c.length-1;g++)if(Fe(c[g],c[g+1],h))return!0;return!1}function Fe(c,i,a){const u=a[0],m=a[2];if(c.x<u.x&&i.x<u.x||c.x>m.x&&i.x>m.x||c.y<u.y&&i.y<u.y||c.y>m.y&&i.y>m.y)return!1;const h=Ys(c,i,a[0]);return h!==Ys(c,i,a[1])||h!==Ys(c,i,a[2])||h!==Ys(c,i,a[3])}function rt(c,i,a,u,m,h){let g=i.y-c.y,b=c.x-i.x;if(h=h||0){const E=g*g+b*b;if(E===0)return!0;const R=Math.sqrt(E);g/=R,b/=R}return!((a.x-c.x)*g+(a.y-c.y)*b-h<0||(u.x-c.x)*g+(u.y-c.y)*b-h<0||(m.x-c.x)*g+(m.y-c.y)*b-h<0)}function Ke(c,i,a,u,m,h,g){return!(rt(c,i,u,m,h,g)||rt(i,a,u,m,h,g)||rt(a,c,u,m,h,g)||rt(u,m,c,i,a,g)||rt(m,h,c,i,a,g)||rt(h,u,c,i,a,g))}function ht(c,i,a){const u=i.paint.get(c).value;return u.kind==="constant"?u.value:a.programConfigurations.get(i.id).getMaxValue(c)}function ut(c){return Math.sqrt(c[0]*c[0]+c[1]*c[1])}function $e(c,i,a,u,m){if(!i[0]&&!i[1])return c;const h=St.convert(i)._mult(m);a==="viewport"&&h._rotate(-u);const g=[];for(let b=0;b<c.length;b++)g.push(c[b].sub(h));return g}function st(c,i,a,u){const m=St.convert(c)._mult(u);return i==="viewport"&&m._rotate(-a),m}let xt,He;Gt(Q,"CircleBucket",{omit:["layers"]});var ft,at={exports:{}},Mt=(ft||(ft=1,function(c,i){(function(a){function u(h,g,b){var E=m(256*h,256*(g=Math.pow(2,b)-g-1),b),R=m(256*(h+1),256*(g+1),b);return E[0]+","+E[1]+","+R[0]+","+R[1]}function m(h,g,b){var E=2*Math.PI*6378137/256/Math.pow(2,b);return[h*E-2*Math.PI*6378137/2,g*E-2*Math.PI*6378137/2]}a.getURL=function(h,g,b,E,R,v){return v=v||{},h+"?"+["bbox="+u(b,E,R),"format="+(v.format||"image/png"),"service="+(v.service||"WMS"),"version="+(v.version||"1.1.1"),"request="+(v.request||"GetMap"),"srs="+(v.srs||"EPSG:3857"),"width="+(v.width||256),"height="+(v.height||256),"layers="+g].join("&")},a.getTileBBox=u,a.getMercCoords=m,Object.defineProperty(a,"__esModule",{value:!0})})(i)}(0,at.exports)),at.exports);class _t{constructor(i,a,u){this.z=i,this.x=a,this.y=u,this.key=It(0,i,i,a,u)}equals(i){return this.z===i.z&&this.x===i.x&&this.y===i.y}url(i,a){const u=Mt.getTileBBox(this.x,this.y,this.z),m=function(h,g,b){let E,R="";for(let v=h;v>0;v--)E=1<<v-1,R+=(g&E?1:0)+(b&E?2:0);return R}(this.z,this.x,this.y);return i[(this.x+this.y)%i.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",m).replace("{bbox-epsg-3857}",u)}toString(){return`${this.z}/${this.x}/${this.y}`}}class dt{constructor(i,a){this.wrap=i,this.canonical=a,this.key=It(i,a.z,a.z,a.x,a.y)}}class bt{constructor(i,a,u,m,h){this.overscaledZ=i,this.wrap=a,this.canonical=new _t(u,+m,+h),this.key=a===0&&i===u?this.canonical.key:It(a,i,u,m,h)}equals(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)}scaledTo(i){const a=this.canonical.z-i;return i>this.canonical.z?new bt(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new bt(i,this.wrap,i,this.canonical.x>>a,this.canonical.y>>a)}calculateScaledKey(i,a=!0){if(this.overscaledZ===i&&a)return this.key;if(i>this.canonical.z)return It(this.wrap*+a,i,this.canonical.z,this.canonical.x,this.canonical.y);{const u=this.canonical.z-i;return It(this.wrap*+a,i,i,this.canonical.x>>u,this.canonical.y>>u)}}isChildOf(i){if(i.wrap!==this.wrap)return!1;const a=this.canonical.z-i.canonical.z;return i.overscaledZ===0||i.overscaledZ<this.overscaledZ&&i.canonical.z<this.canonical.z&&i.canonical.x===this.canonical.x>>a&&i.canonical.y===this.canonical.y>>a}children(i){if(this.overscaledZ>=i)return[new bt(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const a=this.canonical.z+1,u=2*this.canonical.x,m=2*this.canonical.y;return[new bt(a,this.wrap,a,u,m),new bt(a,this.wrap,a,u+1,m),new bt(a,this.wrap,a,u,m+1),new bt(a,this.wrap,a,u+1,m+1)]}isLessThan(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))}wrapped(){return new bt(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(i){return new bt(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new dt(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function It(c,i,a,u,m){const h=1<<Math.min(a,22);let g=h*(m%h)+u%h;return c&&a<22&&(g+=h*h*((c<0?-2*c-1:2*c)%(1<<2*(22-a)))),16*(32*g+a)+(i-a)}const Ot=[c=>{let i=c.canonical.x-1,a=c.wrap;return i<0&&(i=(1<<c.canonical.z)-1,a--),new bt(c.overscaledZ,a,c.canonical.z,i,c.canonical.y)},c=>{let i=c.canonical.x+1,a=c.wrap;return i===1<<c.canonical.z&&(i=0,a++),new bt(c.overscaledZ,a,c.canonical.z,i,c.canonical.y)},c=>new bt(c.overscaledZ,c.wrap,c.canonical.z,c.canonical.x,(c.canonical.y===0?1<<c.canonical.z:c.canonical.y)-1),c=>new bt(c.overscaledZ,c.wrap,c.canonical.z,c.canonical.x,c.canonical.y===(1<<c.canonical.z)-1?0:c.canonical.y+1)];Gt(_t,"CanonicalTileID"),Gt(bt,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const jt=Xi([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:ui}=jt,ti=Xi([{name:"a_pos_3",components:3,type:"Int16"}]);var ri=Xi([{name:"a_pos",type:"Int16",components:2}]);class fi{constructor(i,a){this.pos=i,this.dir=a}intersectsPlane(i,a,u){const m=ke.vec3.dot(a,this.dir);if(Math.abs(m)<1e-6)return!1;const h=((i[0]-this.pos[0])*a[0]+(i[1]-this.pos[1])*a[1]+(i[2]-this.pos[2])*a[2])/m;return u[0]=this.pos[0]+this.dir[0]*h,u[1]=this.pos[1]+this.dir[1]*h,u[2]=this.pos[2]+this.dir[2]*h,!0}closestPointOnSphere(i,a,u){if(ke.vec3.equals(this.pos,i)||a===0)return u[0]=u[1]=u[2]=0,!1;const[m,h,g]=this.dir,b=this.pos[0]-i[0],E=this.pos[1]-i[1],R=this.pos[2]-i[2],v=m*m+h*h+g*g,S=2*(b*m+E*h+R*g),C=S*S-4*v*(b*b+E*E+R*R-a*a);if(C<0){const T=Math.max(-S/2,0),I=b+m*T,D=E+h*T,k=R+g*T,F=Math.hypot(I,D,k);return u[0]=I*a/F,u[1]=D*a/F,u[2]=k*a/F,!1}{const T=(-S-Math.sqrt(C))/(2*v);if(T<0){const I=Math.hypot(b,E,R);return u[0]=b*a/I,u[1]=E*a/I,u[2]=R*a/I,!1}return u[0]=b+m*T,u[1]=E+h*T,u[2]=R+g*T,!0}}}class ki{constructor(i,a,u,m,h){this.TL=i,this.TR=a,this.BR=u,this.BL=m,this.horizon=h}static fromInvProjectionMatrix(i,a,u){const m=[-1,1,1],h=[1,1,1],g=[1,-1,1],b=[-1,-1,1],E=ke.vec3.transformMat4(m,m,i),R=ke.vec3.transformMat4(h,h,i),v=ke.vec3.transformMat4(g,g,i),S=ke.vec3.transformMat4(b,b,i);return new ki(E,R,v,S,a/u)}}function en(c,i,a){let u=1/0,m=-1/0;const h=[];for(const g of c){ke.vec3.sub(h,g,i);const b=ke.vec3.dot(h,a);u=Math.min(u,b),m=Math.max(m,b)}return[u,m]}function Bn(c,i){let a=!0;for(let u=0;u<c.planes.length;u++){const m=c.planes[u];let h=0;for(let g=0;g<i.length;g++)h+=ke.vec3.dot(m,i[g])+m[3]>=0;if(h===0)return 0;h!==i.length&&(a=!1)}return a?2:1}function bn(c,i){for(const a of c.projections){const u=en(i,c.points[0],a.axis);if(a.projection[1]<u[0]||a.projection[0]>u[1])return 0}return 1}function _i(c,i){let a=0;const u=[0,0,0,0];for(let m=0;m<c.length;m++)u[0]=c[m][0],u[1]=c[m][1],u[2]=c[m][2],u[3]=1,ke.vec4.dot(u,i)>=0&&a++;return a}class ji{constructor(i,a){this.points=i||new Array(8).fill([0,0,0]),this.planes=a||new Array(6).fill([0,0,0,0]),this.bounds=Xt.fromPoints(this.points),this.projections=[],this.frustumEdges=[ke.vec3.sub([],this.points[2],this.points[3]),ke.vec3.sub([],this.points[0],this.points[3]),ke.vec3.sub([],this.points[4],this.points[0]),ke.vec3.sub([],this.points[5],this.points[1]),ke.vec3.sub([],this.points[6],this.points[2]),ke.vec3.sub([],this.points[7],this.points[3])];for(const u of this.frustumEdges){const m=[0,-u[2],u[1]],h=[u[2],0,-u[0]];this.projections.push({axis:m,projection:en(this.points,this.points[0],m)}),this.projections.push({axis:h,projection:en(this.points,this.points[0],h)})}}static fromInvProjectionMatrix(i,a,u,m){const h=Math.pow(2,u),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(R=>{const v=ke.vec4.transformMat4([],R,i),S=1/v[3]/a*h;return ke.vec4.mul(v,v,[S,S,m?1/v[3]:S,S])}),b=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(R=>{const v=ke.vec3.sub([],g[R[0]],g[R[1]]),S=ke.vec3.sub([],g[R[2]],g[R[1]]),C=ke.vec3.normalize([],ke.vec3.cross([],v,S)),T=-ke.vec3.dot(C,g[R[1]]);return C.concat(T)}),E=[];for(let R=0;R<g.length;R++)E.push([g[R][0],g[R][1],g[R][2]]);return new ji(E,b)}intersectsPrecise(i,a,u){for(let m=0;m<a.length;m++)if(!_i(i,a[m]))return 0;for(let m=0;m<this.planes.length;m++)if(!_i(i,this.planes[m]))return 0;for(const m of u)for(const h of this.frustumEdges){const g=ke.vec3.cross([],m,h),b=ke.vec3.length(g);if(b===0)continue;ke.vec3.scale(g,g,1/b);const E=en(this.points,this.points[0],g),R=en(i,this.points[0],g);if(E[0]>R[1]||R[0]>E[1])return 0}return 1}containsPoint(i){for(const a of this.planes){const u=a[3];if(ke.vec3.dot([a[0],a[1],a[2]],i)+u<0)return!1}return!0}}class Xt{static fromPoints(i){const a=[1/0,1/0,1/0],u=[-1/0,-1/0,-1/0];for(const m of i)ke.vec3.min(a,a,m),ke.vec3.max(u,u,m);return new Xt(a,u)}static fromTileIdAndHeight(i,a,u){const m=1<<i.canonical.z,h=i.canonical.x,g=i.canonical.y;return new Xt([h/m,g/m,a],[(h+1)/m,(g+1)/m,u])}static applyTransform(i,a){const u=i.getCorners();for(let m=0;m<u.length;++m)ke.vec3.transformMat4(u[m],u[m],a);return Xt.fromPoints(u)}static applyTransformFast(i,a){const u=[a[12],a[13],a[14]],m=[...u];for(let h=0;h<3;h++)for(let g=0;g<3;g++){const b=a[4*g+h],E=b*i.min[g],R=b*i.max[g];u[h]+=Math.min(E,R),m[h]+=Math.max(E,R)}return new Xt(u,m)}static projectAabbCorners(i,a){const u=i.getCorners();for(let m=0;m<u.length;++m)ke.vec3.transformMat4(u[m],u[m],a);return u}constructor(i,a){this.min=i,this.max=a,this.center=ke.vec3.scale([],ke.vec3.add([],this.min,this.max),.5)}quadrant(i){const a=[i%2==0,i<2],u=ke.vec3.clone(this.min),m=ke.vec3.clone(this.max);for(let h=0;h<a.length;h++)u[h]=a[h]?this.min[h]:this.center[h],m[h]=a[h]?this.center[h]:this.max[h];return m[2]=this.max[2],new Xt(u,m)}distanceX(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]}distanceY(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]}distanceZ(i){return Math.max(Math.min(this.max[2],i[2]),this.min[2])-i[2]}getCorners(){const i=this.min,a=this.max;return[[i[0],i[1],i[2]],[a[0],i[1],i[2]],[a[0],a[1],i[2]],[i[0],a[1],i[2]],[i[0],i[1],a[2]],[a[0],i[1],a[2]],[a[0],a[1],a[2]],[i[0],a[1],a[2]]]}intersects(i){return this.intersectsAabb(i.bounds)?Bn(i,this.getCorners()):0}intersectsFlat(i){return this.intersectsAabb(i.bounds)?Bn(i,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(i,a){return a||this.intersects(i)?bn(i,this.getCorners()):0}intersectsPreciseFlat(i,a){return a||this.intersectsFlat(i)?bn(i,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(i){for(let a=0;a<3;++a)if(this.min[a]>i.max[a]||i.min[a]>this.max[a])return!1;return!0}intersectsAabbXY(i){return!(this.min[0]>i.max[0]||i.min[0]>this.max[0]||this.min[1]>i.max[1]||i.min[1]>this.max[1])}encapsulate(i){for(let a=0;a<3;a++)this.min[a]=Math.min(this.min[a],i.min[a]),this.max[a]=Math.max(this.max[a],i.max[a])}encapsulatePoint(i){for(let a=0;a<3;a++)this.min[a]=Math.min(this.min[a],i[a]),this.max[a]=Math.max(this.max[a],i[a])}closestPoint(i){return[Math.max(Math.min(this.max[0],i[0]),this.min[0]),Math.max(Math.min(this.max[1],i[1]),this.min[1]),Math.max(Math.min(this.max[2],i[2]),this.min[2])]}}function Di(c){return c*ws/jc}Gt(Xt,"Aabb");const Zi=[new Xt([ba,ba,ba],[wa,wa,wa]),new Xt([ba,ba,ba],[0,0,wa]),new Xt([0,ba,ba],[wa,0,wa]),new Xt([ba,0,ba],[0,wa,wa]),new Xt([0,0,ba],[wa,wa,wa])];function Yi(c,i,a,u=!0){const m=ke.vec3.scale([],c._camera.position,c.worldSize),h=[i,a,1,1];ke.vec4.transformMat4(h,h,c.pixelMatrixInverse),ke.vec4.scale(h,h,1/h[3]);const g=ke.vec3.sub([],h,m),b=ke.vec3.normalize([],g),E=c.globeMatrix,R=[E[12],E[13],E[14]],v=ke.vec3.sub([],R,m),S=ke.vec3.length(v),C=ke.vec3.normalize([],v),T=c.worldSize/(2*Math.PI),I=ke.vec3.dot(C,b),D=Math.asin(T/S);if(D<Math.acos(I)){if(!u)return null;const Ie=[],de=[];ke.vec3.scale(Ie,b,S/I),ke.vec3.normalize(de,ke.vec3.sub(de,Ie,v)),ke.vec3.normalize(b,ke.vec3.add(b,v,ke.vec3.scale(b,de,Math.tan(D)*S)))}const k=[];new fi(m,b).closestPointOnSphere(R,T,k);const F=ke.vec3.normalize([],Ks(E,0)),q=ke.vec3.normalize([],Ks(E,1)),H=ke.vec3.normalize([],Ks(E,2)),U=ke.vec3.dot(F,k),$=ke.vec3.dot(q,k),Y=ke.vec3.dot(H,k),ie=vr(Math.asin(-$/T));let he=vr(Math.atan2(U,Y));he=c.center.lng+function(Ie,de){const Me=(de-Ie+180)%360-180;return Me<-180?Me+360:Me}(c.center.lng,he);const ue=Mo(he),ce=bi(io(ie),0,1);return new o(ue,ce)}class On{constructor(i,a,u){this.a=ke.vec3.sub([],i,u),this.b=ke.vec3.sub([],a,u),this.center=u;const m=ke.vec3.normalize([],this.a),h=ke.vec3.normalize([],this.b);this.angle=Math.acos(ke.vec3.dot(m,h))}}function Mr(c,i){if(c.angle===0)return null;let a;return a=c.a[i]===0?1/c.angle*.5*Math.PI:1/c.angle*Math.atan(c.b[i]/c.a[i]/Math.sin(c.angle)-1/Math.tan(c.angle)),a<0||a>1?null:function(u,m,h,g){const b=Math.sin(h);return u*(Math.sin((1-g)*h)/b)+m*(Math.sin(g*h)/b)}(c.a[i],c.b[i],c.angle,bi(a,0,1))+c.center[i]}function dr(c){if(c.z<=1)return Zi[c.z+2*c.y+c.x];const i=hn(kn(c));return Xt.fromPoints(i)}function fr(c,i,a){return ke.vec3.scale(c,c,1-a),ke.vec3.scaleAndAdd(c,c,i,a)}function Ta(c,i,a){for(const u of c)ke.vec3.transformMat4(u,u,i),ke.vec3.scale(u,u,a)}function hs(c,i,a,u){const m=i/c.worldSize,h=c.globeMatrix;if(a.z<=1){const ue=dr(a).getCorners();return Ta(ue,h,m),Xt.fromPoints(ue)}const g=kn(a,u),b=hn(g,ws+Di(c._tileCoverLift));Ta(b,h,m);const E=Number.MAX_VALUE,R=[-E,-E,-E],v=[E,E,E];if(g.contains(c.center)){for(const Ie of b)ke.vec3.min(v,v,Ie),ke.vec3.max(R,R,Ie);R[2]=0;const ue=c.point,ce=[ue.x*m,ue.y*m,0];return ke.vec3.min(v,v,ce),ke.vec3.max(R,R,ce),new Xt(v,R)}if(c._tileCoverLift>0){for(const ue of b)ke.vec3.min(v,v,ue),ke.vec3.max(R,R,ue);return new Xt(v,R)}const S=[h[12]*m,h[13]*m,h[14]*m],C=g.getCenter(),T=bi(c.center.lat,-Zn,Zn),I=bi(C.lat,-Zn,Zn),D=Mo(c.center.lng),k=io(T);let F=D-Mo(C.lng);const q=k-io(I);F>.5?F-=1:F<-.5&&(F+=1);let H=0;if(Math.abs(F)>Math.abs(q))H=F>=0?1:3;else{H=q>=0?0:2;const ue=[h[4]*m,h[5]*m,h[6]*m],ce=-Math.sin(Li(q>=0?g.getSouth():g.getNorth()))*ws;ke.vec3.scaleAndAdd(S,S,ue,ce)}const U=b[H],$=b[(H+1)%4],Y=new On(U,$,S),ie=[Mr(Y,0)||U[0],Mr(Y,1)||U[1],Mr(Y,2)||U[2]],he=Fs(c.zoom);if(he>0){const ue=function({x:Ie,y:de,z:Me},ze,Pe,Ne,qe){const Ze=1/(1<<Me);let Be=Ie*Ze,ct=Be+Ze,yt=de*Ze,lt=yt+Ze,Lt=0;const Dt=(Be+ct)/2-Ne;return Dt>.5?Lt=-1:Dt<-.5&&(Lt=1),Be=((Be+Lt)*ze-(Ne*=ze))*Pe+Ne,ct=((ct+Lt)*ze-Ne)*Pe+Ne,yt=(yt*ze-(qe*=ze))*Pe+qe,lt=(lt*ze-qe)*Pe+qe,[[Be,lt,0],[ct,lt,0],[ct,yt,0],[Be,yt,0]]}(a,i,c._pixelsPerMercatorPixel,D,k);for(let Ie=0;Ie<b.length;Ie++)fr(b[Ie],ue[Ie],he);const ce=ke.vec3.add([],ue[H],ue[(H+1)%4]);ke.vec3.scale(ce,ce,.5),fr(ie,ce,he)}for(const ue of b)ke.vec3.min(v,v,ue),ke.vec3.max(R,R,ue);return v[2]=Math.min(U[2],$[2]),ke.vec3.min(v,v,ie),ke.vec3.max(R,R,ie),new Xt(v,R)}function kn({x:c,y:i,z:a},u=!1){const m=1/(1<<a),h=new Gi(ra(c*m),i===(1<<a)-1&&u?-90:Hr((i+1)*m)),g=new Gi(ra((c+1)*m),i===0&&u?90:Hr(i*m));return new Kl(h,g)}function hn(c,i=ws){const a=Li(c.getNorth()),u=Li(c.getSouth()),m=Math.cos(a),h=Math.cos(u),g=Math.sin(a),b=Math.sin(u),E=c.getWest(),R=c.getEast();return[Ku(h,b,E,i),Ku(h,b,R,i),Ku(m,g,R,i),Ku(m,g,E,i)]}function ln(c,i,a,u){const m=1<<a.z,h=(c/Pt+a.x)/m;return Uc(Hr((i/Pt+a.y)/m),ra(h),u)}function Bi({min:c,max:i}){return dv/Math.max(i[0]-c[0],i[1]-c[1],i[2]-c[2])}const er=new Float64Array(16);function Cr(c){const i=Bi(c),a=ke.mat4.fromScaling(er,[i,i,i]);return ke.mat4.translate(a,a,ke.vec3.negate([],c.min))}function un(c){const i=ke.mat4.fromTranslation(er,c.min),a=1/Bi(c);return ke.mat4.scale(i,i,[a,a,a])}function ds(c){const i=Pt/(2*Math.PI);return c/(2*Math.PI)/i}function Na(c,i){return Pt/(512*Math.pow(2,c))*Bi(dr(i))}function sa(c,i,a,u,m){const h=ds(a),g=[c,i,-a/(2*Math.PI)],b=ke.mat4.identity(new Float64Array(16));return ke.mat4.translate(b,b,g),ke.mat4.scale(b,b,[h,h,h]),ke.mat4.rotateX(b,b,Li(-m)),ke.mat4.rotateY(b,b,Li(-u)),b}function Fs(c){return Ws(Xu,hv,c)}function Co(c,i){const a=Uc(i.lat,i.lng),u=function(h){const g=Uc(h._center.lat,h._center.lng),b=ke.vec3.fromValues(0,1,0);let E=ke.vec3.cross([],b,g);const R=ke.mat4.fromRotation([],-h.angle,g);E=ke.vec3.transformMat4(E,E,R),ke.mat4.fromRotation(R,-h._pitch,E);const v=ke.vec3.normalize([],g);return ke.vec3.scale(v,v,Di(h.cameraToCenterDistance/h.pixelsPerMeter)),ke.vec3.transformMat4(v,v,R),ke.vec3.add([],g,v)}(c),m=ke.vec3.subtract([],u,a);return ke.vec3.angle(m,a)}function Fa(c,i){return Co(c,i)>Math.PI/2*1.01}const Ea=Li(85),qc=Math.cos(Ea),Ro=Math.sin(Ea),Gc=ke.mat4.create(),Ju=c=>{const i=[];return c.paint.get("circle-pitch-alignment")==="map"&&i.push("PITCH_WITH_MAP"),c.paint.get("circle-pitch-scale")==="map"&&i.push("SCALE_WITH_MAP"),i};function wp(c,i,a,u,m,h,g,b,E){if(h&&c.queryGeometry.isAboveHorizon)return!1;h&&(E*=c.pixelToTileUnitsFactor);const R=c.tileID.canonical,v=a.projection.upVectorScale(R,a.center.lat,a.worldSize).metersToTile;for(const S of i)for(const C of S){const T=C.add(b),I=m&&a.elevation?a.elevation.exaggeration()*m.getElevationAt(T.x,T.y,!0):0,D=a.projection.projectTilePoint(T.x,T.y,R);if(I>0){const H=a.projection.upVector(R,T.x,T.y);D.x+=H[0]*v*I,D.y+=H[1]*v*I,D.z+=H[2]*v*I}const k=h?T:r_(D.x,D.y,D.z,u),F=h?c.tilespaceRays.map(H=>cF(H,I)):c.queryGeometry.screenGeometry,q=ke.vec4.transformMat4([],[D.x,D.y,D.z,1],u);if(!g&&h?E*=q[3]/a.cameraToCenterDistance:g&&!h&&(E*=a.cameraToCenterDistance/q[3]),h){const H=Hr((C.y/Pt+R.y)/(1<<R.z));E/=a.projection.pixelsPerMeter(H,1)/Ts(1,H)}if(te(F,k,E))return!0}return!1}function r_(c,i,a,u){const m=ke.vec4.transformMat4([],[c,i,a,1],u);return new St(m[0]/m[3],m[1]/m[3])}const lI=ke.vec3.fromValues(0,0,0),lF=ke.vec3.fromValues(0,0,1);function cF(c,i){const a=ke.vec3.create();return lI[2]=i,c.intersectsPlane(lI,lF,a),new St(a[0],a[1])}class cI extends Q{}let uI,hI,dI,fI;function pI(c,{width:i,height:a},u,m){if(m){if(m instanceof Uint8ClampedArray)m=new Uint8Array(m.buffer);else if(m.length!==i*a*u)throw new RangeError("mismatched image size")}else m=new Uint8Array(i*a*u);return c.width=i,c.height=a,c.data=m,c}function mI(c,i,a){const{width:u,height:m}=i;u===c.width&&m===c.height||(xw(c,i,{x:0,y:0},{x:0,y:0},{width:Math.min(c.width,u),height:Math.min(c.height,m)},a,null),c.width=u,c.height=m,c.data=i.data)}function xw(c,i,a,u,m,h,g,b){if(m.width===0||m.height===0)return i;if(m.width>c.width||m.height>c.height||a.x>c.width-m.width||a.y>c.height-m.height)throw new RangeError("out of range source coordinates for image copy");if(m.width>i.width||m.height>i.height||u.x>i.width-m.width||u.y>i.height-m.height)throw new RangeError("out of range destination coordinates for image copy");const E=c.data,R=i.data,v=h===4&&b;for(let S=0;S<m.height;S++){const C=((a.y+S)*c.width+a.x)*h,T=((u.y+S)*i.width+u.x)*h;if(v)for(let I=0;I<m.width;I++){const D=C+I*h+3,k=T+I*h;R[k+0]=255,R[k+1]=255,R[k+2]=255,R[k+3]=E[D]}else if(g)for(let I=0;I<m.width;I++){const D=C+I*h,k=T+I*h,F=E[D+3],q=new $i(E[D+0]/255*F,E[D+1]/255*F,E[D+2]/255*F,F).toRenderColor(g).toArray();R[k+0]=q[0],R[k+1]=q[1],R[k+2]=q[2],R[k+3]=q[3]}else for(let I=0;I<m.width*h;I++)R[T+I]=E[C+I]}return i}Gt(cI,"HeatmapBucket",{omit:["layers"]});class eh{constructor(i,a){pI(this,i,1,a)}resize(i){mI(this,new eh(i),1)}clone(){return new eh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,a,u,m,h){xw(i,a,u,m,h,1,null)}}class Kr{constructor(i,a){pI(this,i,4,a)}resize(i){mI(this,new Kr(i),4)}replace(i,a){a?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i}clone(){return new Kr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,a,u,m,h,g,b){xw(i,a,u,m,h,4,g,b)}}class gI{constructor(i,a){this.width=i.width,this.height=i.height,this.data=a instanceof Uint8Array?new Float32Array(a.buffer):a}}function s_(c){const i={},a=c.resolution||256,u=c.clips?c.clips.length:1,m=c.image||new Kr({width:a,height:u}),h=(g,b,E)=>{i[c.evaluationKey]=E;const R=c.expression.evaluate(i);R&&(m.data[g+b+0]=Math.floor(255*R.r/R.a),m.data[g+b+1]=Math.floor(255*R.g/R.a),m.data[g+b+2]=Math.floor(255*R.b/R.a),m.data[g+b+3]=Math.floor(255*R.a))};if(c.clips)for(let g=0,b=0;g<u;++g,b+=4*a)for(let E=0,R=0;E<a;E++,R+=4){const v=E/(a-1),{start:S,end:C}=c.clips[g];h(b,R,S*(1-v)+C*v)}else for(let g=0,b=0;g<a;g++,b+=4)h(0,b,g/(a-1));return m}Gt(eh,"AlphaImage"),Gt(Kr,"RGBAImage");const uF=Xi([{name:"a_pos",components:2,type:"Int16"}],4),{members:hF}=uF;function a_(c,i,a=2){const u=i&&i.length,m=u?i[0]*a:c.length;let h=_I(c,0,m,a,!0);const g=[];if(!h||h.next===h.prev)return g;let b,E,R;if(u&&(h=function(v,S,C,T){const I=[];for(let D=0,k=S.length;D<k;D++){const F=_I(v,S[D]*T,D<k-1?S[D+1]*T:v.length,T,!1);F===F.next&&(F.steiner=!0),I.push(vF(F))}I.sort(gF);for(let D=0;D<I.length;D++)C=_F(I[D],C);return C}(c,i,h,a)),c.length>80*a){b=1/0,E=1/0;let v=-1/0,S=-1/0;for(let C=a;C<m;C+=a){const T=c[C],I=c[C+1];T<b&&(b=T),I<E&&(E=I),T>v&&(v=T),I>S&&(S=I)}R=Math.max(v-b,S-E),R=R!==0?32767/R:0}return o_(h,g,a,b,E,R,0),g}function _I(c,i,a,u,m){let h;if(m===function(g,b,E,R){let v=0;for(let S=b,C=E-R;S<E;S+=R)v+=(g[C]-g[S])*(g[S+1]+g[C+1]),C=S;return v}(c,i,a,u)>0)for(let g=i;g<a;g+=u)h=xI(g/u|0,c[g],c[g+1],h);else for(let g=a-u;g>=i;g-=u)h=xI(g/u|0,c[g],c[g+1],h);return h&&pv(h,h.next)&&(c_(h),h=h.next),h}function Gd(c,i){if(!c)return c;i||(i=c);let a,u=c;do if(a=!1,u.steiner||!pv(u,u.next)&&Rr(u.prev,u,u.next)!==0)u=u.next;else{if(c_(u),u=i=u.prev,u===u.next)break;a=!0}while(a||u!==i);return i}function o_(c,i,a,u,m,h,g){if(!c)return;!g&&h&&function(E,R,v,S){let C=E;do C.z===0&&(C.z=bw(C.x,C.y,R,v,S)),C.prevZ=C.prev,C.nextZ=C.next,C=C.next;while(C!==E);C.prevZ.nextZ=null,C.prevZ=null,function(T){let I,D=1;do{let k,F=T;T=null;let q=null;for(I=0;F;){I++;let H=F,U=0;for(let Y=0;Y<D&&(U++,H=H.nextZ,H);Y++);let $=D;for(;U>0||$>0&&H;)U!==0&&($===0||!H||F.z<=H.z)?(k=F,F=F.nextZ,U--):(k=H,H=H.nextZ,$--),q?q.nextZ=k:T=k,k.prevZ=q,q=k;F=H}q.nextZ=null,D*=2}while(I>1)}(C)}(c,u,m,h);let b=c;for(;c.prev!==c.next;){const E=c.prev,R=c.next;if(h?fF(c,u,m,h):dF(c))i.push(E.i,c.i,R.i),c_(c),c=R.next,b=R.next;else if((c=R)===b){g?g===1?o_(c=pF(Gd(c),i),i,a,u,m,h,2):g===2&&mF(c,i,a,u,m,h):o_(Gd(c),i,a,u,m,h,1);break}}}function dF(c){const i=c.prev,a=c,u=c.next;if(Rr(i,a,u)>=0)return!1;const m=i.x,h=a.x,g=u.x,b=i.y,E=a.y,R=u.y,v=m<h?m<g?m:g:h<g?h:g,S=b<E?b<R?b:R:E<R?E:R,C=m>h?m>g?m:g:h>g?h:g,T=b>E?b>R?b:R:E>R?E:R;let I=u.next;for(;I!==i;){if(I.x>=v&&I.x<=C&&I.y>=S&&I.y<=T&&Tp(m,b,h,E,g,R,I.x,I.y)&&Rr(I.prev,I,I.next)>=0)return!1;I=I.next}return!0}function fF(c,i,a,u){const m=c.prev,h=c,g=c.next;if(Rr(m,h,g)>=0)return!1;const b=m.x,E=h.x,R=g.x,v=m.y,S=h.y,C=g.y,T=b<E?b<R?b:R:E<R?E:R,I=v<S?v<C?v:C:S<C?S:C,D=b>E?b>R?b:R:E>R?E:R,k=v>S?v>C?v:C:S>C?S:C,F=bw(T,I,i,a,u),q=bw(D,k,i,a,u);let H=c.prevZ,U=c.nextZ;for(;H&&H.z>=F&&U&&U.z<=q;){if(H.x>=T&&H.x<=D&&H.y>=I&&H.y<=k&&H!==m&&H!==g&&Tp(b,v,E,S,R,C,H.x,H.y)&&Rr(H.prev,H,H.next)>=0||(H=H.prevZ,U.x>=T&&U.x<=D&&U.y>=I&&U.y<=k&&U!==m&&U!==g&&Tp(b,v,E,S,R,C,U.x,U.y)&&Rr(U.prev,U,U.next)>=0))return!1;U=U.nextZ}for(;H&&H.z>=F;){if(H.x>=T&&H.x<=D&&H.y>=I&&H.y<=k&&H!==m&&H!==g&&Tp(b,v,E,S,R,C,H.x,H.y)&&Rr(H.prev,H,H.next)>=0)return!1;H=H.prevZ}for(;U&&U.z<=q;){if(U.x>=T&&U.x<=D&&U.y>=I&&U.y<=k&&U!==m&&U!==g&&Tp(b,v,E,S,R,C,U.x,U.y)&&Rr(U.prev,U,U.next)>=0)return!1;U=U.nextZ}return!0}function pF(c,i){let a=c;do{const u=a.prev,m=a.next.next;!pv(u,m)&&yI(u,a,a.next,m)&&l_(u,m)&&l_(m,u)&&(i.push(u.i,a.i,m.i),c_(a),c_(a.next),a=c=m),a=a.next}while(a!==c);return Gd(a)}function mF(c,i,a,u,m,h){let g=c;do{let b=g.next.next;for(;b!==g.prev;){if(g.i!==b.i&&xF(g,b)){let E=vI(g,b);return g=Gd(g,g.next),E=Gd(E,E.next),o_(g,i,a,u,m,h,0),void o_(E,i,a,u,m,h,0)}b=b.next}g=g.next}while(g!==c)}function gF(c,i){return c.x-i.x}function _F(c,i){const a=function(m,h){let g=h;const b=m.x,E=m.y;let R,v=-1/0;do{if(E<=g.y&&E>=g.next.y&&g.next.y!==g.y){const D=g.x+(E-g.y)*(g.next.x-g.x)/(g.next.y-g.y);if(D<=b&&D>v&&(v=D,R=g.x<g.next.x?g:g.next,D===b))return R}g=g.next}while(g!==h);if(!R)return null;const S=R,C=R.x,T=R.y;let I=1/0;g=R;do{if(b>=g.x&&g.x>=C&&b!==g.x&&Tp(E<T?b:v,E,C,T,E<T?v:b,E,g.x,g.y)){const D=Math.abs(E-g.y)/(b-g.x);l_(g,m)&&(D<I||D===I&&(g.x>R.x||g.x===R.x&&yF(R,g)))&&(R=g,I=D)}g=g.next}while(g!==S);return R}(c,i);if(!a)return i;const u=vI(a,c);return Gd(u,u.next),Gd(a,a.next)}function yF(c,i){return Rr(c.prev,c,i.prev)<0&&Rr(i.next,c,c.next)<0}function bw(c,i,a,u,m){return(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-a)*m|0)|c<<8))|c<<4))|c<<2))|c<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-u)*m|0)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function vF(c){let i=c,a=c;do(i.x<a.x||i.x===a.x&&i.y<a.y)&&(a=i),i=i.next;while(i!==c);return a}function Tp(c,i,a,u,m,h,g,b){return(m-g)*(i-b)>=(c-g)*(h-b)&&(c-g)*(u-b)>=(a-g)*(i-b)&&(a-g)*(h-b)>=(m-g)*(u-b)}function xF(c,i){return c.next.i!==i.i&&c.prev.i!==i.i&&!function(a,u){let m=a;do{if(m.i!==a.i&&m.next.i!==a.i&&m.i!==u.i&&m.next.i!==u.i&&yI(m,m.next,a,u))return!0;m=m.next}while(m!==a);return!1}(c,i)&&(l_(c,i)&&l_(i,c)&&function(a,u){let m=a,h=!1;const g=(a.x+u.x)/2,b=(a.y+u.y)/2;do m.y>b!=m.next.y>b&&m.next.y!==m.y&&g<(m.next.x-m.x)*(b-m.y)/(m.next.y-m.y)+m.x&&(h=!h),m=m.next;while(m!==a);return h}(c,i)&&(Rr(c.prev,c,i.prev)||Rr(c,i.prev,i))||pv(c,i)&&Rr(c.prev,c,c.next)>0&&Rr(i.prev,i,i.next)>0)}function Rr(c,i,a){return(i.y-c.y)*(a.x-i.x)-(i.x-c.x)*(a.y-i.y)}function pv(c,i){return c.x===i.x&&c.y===i.y}function yI(c,i,a,u){const m=gv(Rr(c,i,a)),h=gv(Rr(c,i,u)),g=gv(Rr(a,u,c)),b=gv(Rr(a,u,i));return m!==h&&g!==b||!(m!==0||!mv(c,a,i))||!(h!==0||!mv(c,u,i))||!(g!==0||!mv(a,c,u))||!(b!==0||!mv(a,i,u))}function mv(c,i,a){return i.x<=Math.max(c.x,a.x)&&i.x>=Math.min(c.x,a.x)&&i.y<=Math.max(c.y,a.y)&&i.y>=Math.min(c.y,a.y)}function gv(c){return c>0?1:c<0?-1:0}function l_(c,i){return Rr(c.prev,c,c.next)<0?Rr(c,i,c.next)>=0&&Rr(c,c.prev,i)>=0:Rr(c,i,c.prev)<0||Rr(c,c.next,i)<0}function vI(c,i){const a=ww(c.i,c.x,c.y),u=ww(i.i,i.x,i.y),m=c.next,h=i.prev;return c.next=i,i.prev=c,a.next=m,m.prev=a,u.next=a,a.prev=u,h.next=u,u.prev=h,u}function xI(c,i,a,u){const m=ww(c,i,a);return u?(m.next=u.next,m.prev=u,u.next.prev=m,u.next=m):(m.prev=m,m.next=m),m}function c_(c){c.next.prev=c.prev,c.prev.next=c.next,c.prevZ&&(c.prevZ.nextZ=c.nextZ),c.nextZ&&(c.nextZ.prevZ=c.prevZ)}function ww(c,i,a){return{i:c,x:i,y:a,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function _v(c,i){const a=c.length;if(a<=1)return[c];const u=[];let m,h;for(let g=0;g<a;g++){const b=gc(c[g]);b!==0&&(c[g].area=Math.abs(b),h===void 0&&(h=b<0),h===b<0?(m&&u.push(m),m=[c[g]]):m.push(c[g]))}if(m&&u.push(m),i>1)for(let g=0;g<u.length;g++)u[g].length<=i||(Fl(u[g],i,1,u[g].length-1,bF),u[g]=u[g].slice(0,i));return u}function bF(c,i){return i.area-c.area}function bI(c,i,a=1){if(!c)return null;const u=typeof c=="string"?c:c.getPrimary().id;i[u]||(i[u]=[]);const m=Fn.from(u).getPrimary().scaleSelf(a);return i[u].push(m),m.serialize()}function Tw(c,i,a,u){const m=u.patternDependencies;let h=!1;for(const g of i){const b=g.paint.get(`${c}-pattern`);b.isConstant()||(h=!0),bI(b.constantOr(null),m,a)&&(h=!0)}return h}function Ew(c,i,a,u,m,h){const g=h.patternDependencies;for(const b of i){const E=b.paint.get(`${c}-pattern`).value;if(E.kind!=="constant"){let R=E.evaluate({zoom:u},a,{},h.availableImages);R=R&&R.name?R.name:R;const v=bI(R,g,m);v&&(a.patterns[b.id]=v)}}return a}class Sw{constructor(i){this.zoom=i.zoom,this.pixelRatio=i.pixelRatio,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new cl,this.indexArray=new Gr,this.indexArray2=new Zl,this.programConfigurations=new Yl(i.layers,{zoom:i.zoom,lut:i.lut}),this.segments=new $n,this.segments2=new $n,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.projection=i.projection}updateFootprints(i,a){}populate(i,a,u,m){this.hasPattern=Tw("fill",this.layers,this.pixelRatio,a);const h=this.layers[0].layout.get("fill-sort-key"),g=[];for(const{feature:b,id:E,index:R,sourceLayerIndex:v}of i){const S=this.layers[0]._featureFilter.needGeometry,C=B(b,S);if(!this.layers[0]._featureFilter.filter(new vn(this.zoom),C,u))continue;const T=h?h.evaluate(C,{},u,a.availableImages):void 0,I={id:E,properties:b.properties,type:b.type,sourceLayerIndex:v,index:R,geometry:S?C.geometry:O(b,u,m),patterns:{},sortKey:T};g.push(I)}h&&g.sort((b,E)=>b.sortKey-E.sortKey);for(const b of g){const{geometry:E,index:R,sourceLayerIndex:v}=b;if(this.hasPattern){const S=Ew("fill",this.layers,b,this.zoom,this.pixelRatio,a);this.patternFeatures.push(S)}else this.addFeature(b,E,R,u,{},a.availableImages,a.brightness,a.elevationFeatures);a.featureIndex.insert(i[R].feature,E,R,v,this.index)}}update(i,a,u,m,h,g,b){this.programConfigurations.updatePaintArrays(i,a,h,u,m,g,b)}addFeatures(i,a,u,m,h,g){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,a,u,m,g,i.elevationFeatures)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,hF),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.indexBuffer2=i.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(i,a,u,m,h,g=[],b,E){for(const R of _v(a,500)){let v=0;for(const k of R)v+=k.length;const S=this.segments.prepareSegment(v,this.layoutVertexArray,this.indexArray),C=S.vertexLength,T=[],I=[];for(const k of R){if(k.length===0)continue;k!==R[0]&&I.push(T.length/2);const F=this.segments2.prepareSegment(k.length,this.layoutVertexArray,this.indexArray2),q=F.vertexLength;this.layoutVertexArray.emplaceBack(k[0].x,k[0].y),this.indexArray2.emplaceBack(q+k.length-1,q),T.push(k[0].x),T.push(k[0].y);for(let H=1;H<k.length;H++)this.layoutVertexArray.emplaceBack(k[H].x,k[H].y),this.indexArray2.emplaceBack(q+H-1,q+H),T.push(k[H].x),T.push(k[H].y);F.vertexLength+=k.length,F.primitiveLength+=k.length}const D=a_(T,I);for(let k=0;k<D.length;k+=3)this.indexArray.emplaceBack(C+D[k],C+D[k+1],C+D[k+2]);S.vertexLength+=v,S.primitiveLength+=D.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,u,h,g,m,b)}}let wI,TI,EI,SI;Gt(Sw,"FillBucket",{omit:["layers","patternFeatures"]});class Aw{constructor(i,a,u,m){if(this.triangleCount=a.length/3,this.min=new St(0,0),this.max=new St(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||i.length===0)return;const[h,g]=[i[0].clone(),i[0].clone()];for(let S=1;S<i.length;++S){const C=i[S];h.x=Math.min(h.x,C.x),h.y=Math.min(h.y,C.y),g.x=Math.max(g.x,C.x),g.y=Math.max(g.y,C.y)}if(m){const S=Math.ceil(Math.max(g.x-h.x,g.y-h.y)/m);u=Math.max(u,S)}if(u===0)return;this.min=h,this.max=g;const b=this.max.sub(this.min);b.x=Math.max(b.x,1),b.y=Math.max(b.y,1);const E=Math.max(b.x,b.y)/u;this.cellsX=Math.max(1,Math.ceil(b.x/E)),this.cellsY=Math.max(1,Math.ceil(b.y/E)),this.xScale=1/E,this.yScale=1/E;const R=[];for(let S=0;S<this.triangleCount;S++){const C=i[a[3*S+0]].sub(this.min),T=i[a[3*S+1]].sub(this.min),I=i[a[3*S+2]].sub(this.min),D=Ql(Math.floor(Math.min(C.x,T.x,I.x)),this.xScale,this.cellsX),k=Ql(Math.floor(Math.max(C.x,T.x,I.x)),this.xScale,this.cellsX),F=Ql(Math.floor(Math.min(C.y,T.y,I.y)),this.yScale,this.cellsY),q=Ql(Math.floor(Math.max(C.y,T.y,I.y)),this.yScale,this.cellsY),H=new St(0,0),U=new St(0,0),$=new St(0,0),Y=new St(0,0);for(let ie=F;ie<=q;++ie){H.y=U.y=ie*E,$.y=Y.y=(ie+1)*E;for(let he=D;he<=k;++he)H.x=$.x=he*E,U.x=Y.x=(he+1)*E,(Ke(C,T,I,H,U,Y)||Ke(C,T,I,H,Y,$))&&R.push({cellIdx:ie*this.cellsX+he,triIdx:S})}}if(R.length===0)return;R.sort((S,C)=>S.cellIdx-C.cellIdx||S.triIdx-C.triIdx);let v=0;for(;v<R.length;){const S=R[v].cellIdx,C={start:this.payload.length,len:0};for(;v<R.length&&R[v].cellIdx===S;)++C.len,this.payload.push(R[v++].triIdx);this.cells[S]=C}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(i,a){if(this.triangleCount===0||this.cells.length===0||i.x>this.max.x||this.min.x>i.x||i.y>this.max.y||this.min.y>i.y)return;const u=Ql(i.x-this.min.x,this.xScale,this.cellsX),m=Ql(i.y-this.min.y,this.yScale,this.cellsY),h=this.cells[m*this.cellsX+u];if(h){this._lazyInitLookup();for(let g=0;g<h.len;g++){const b=this.payload[h.start+g],E=Math.floor(b/8),R=1<<b%8;if(!(this.lookup[E]&R)&&(this.lookup[E]|=R,a.push(b),a.length===this.triangleCount))return}}}query(i,a,u){if(this.triangleCount===0||this.cells.length===0||i.x>this.max.x||this.min.x>a.x||i.y>this.max.y||this.min.y>a.y)return;this._lazyInitLookup();const m=Ql(i.x-this.min.x,this.xScale,this.cellsX),h=Ql(a.x-this.min.x,this.xScale,this.cellsX),g=Ql(i.y-this.min.y,this.yScale,this.cellsY),b=Ql(a.y-this.min.y,this.yScale,this.cellsY);for(let E=g;E<=b;E++)for(let R=m;R<=h;R++){const v=this.cells[E*this.cellsX+R];if(v)for(let S=0;S<v.len;S++){const C=this.payload[v.start+S],T=Math.floor(C/8),I=1<<C%8;if(!(this.lookup[T]&I)&&(this.lookup[T]|=I,u.push(C),u.length===this.triangleCount))return}}}}function Ql(c,i,a){return Math.max(0,Math.min(a-1,Math.floor(c*i)))}Gt(Aw,"TriangleGridIndex");class AI{constructor(i){this.zoom=i.zoom,this.layers=i.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=i.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.footprints=[]}updateFootprints(i,a){for(const u of this.footprints)a.push({footprint:u,id:i})}populate(i,a,u,m){const h=[];for(const{feature:g,id:b,index:E,sourceLayerIndex:R}of i){const v=this.layers[0]._featureFilter.needGeometry,S=B(g,v);if(!this.layers[0]._featureFilter.filter(new vn(this.zoom),S,u))continue;const C={id:b,properties:g.properties,type:g.type,sourceLayerIndex:R,index:E,geometry:v?S.geometry:O(g,u,m),patterns:{}};h.push(C)}for(const g of h){const{geometry:b,index:E,sourceLayerIndex:R}=g;this.addFeature(g,b,E,u,{},a.availableImages,a.brightness),a.featureIndex.insert(i[E].feature,b,E,R,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(i){}update(i,a,u,m,h,g,b){}destroy(){}addFeature(i,a,u,m,h,g=[],b){for(const E of _v(a,2)){const R=[],v=[],S=[],C=new St(1/0,1/0),T=new St(-1/0,-1/0);for(const k of E)if(k.length!==0){k!==E[0]&&S.push(v.length/2);for(let F=0;F<k.length;F++)v.push(k[F].x),v.push(k[F].y),R.push(k[F]),C.x=Math.min(C.x,k[F].x),C.y=Math.min(C.y,k[F].y),T.x=Math.max(T.x,k[F].x),T.y=Math.max(T.y,k[F].y)}const I=a_(v,S),D=new Aw(R,I,8,256);this.footprints.push({vertices:R,indices:I,grid:D,min:C,max:T})}}}Gt(AI,"ClipBucket",{omit:["layers"]});const wF=Xi([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),TF=Xi([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),EF=Xi([{name:"a_centroid_pos",components:2,type:"Uint16"}]),SF=Xi([{name:"a_join_normal_inside",components:3,type:"Int16"}]),AF=Xi([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),IF=Xi([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:MF}=wF;var Iw,II,Mw,MI,Cw,CI,RI,yv={};function DI(){if(II)return Iw;II=1;var c=Zs();function i(m,h,g,b,E){this.properties={},this.extent=g,this.type=0,this._pbf=m,this._geometry=-1,this._keys=b,this._values=E,m.readFields(a,this,h)}function a(m,h,g){m==1?h.id=g.readVarint():m==2?function(b,E){for(var R=b.readVarint()+b.pos;b.pos<R;){var v=E._keys[b.readVarint()],S=E._values[b.readVarint()];E.properties[v]=S}}(g,h):m==3?h.type=g.readVarint():m==4&&(h._geometry=g.pos)}function u(m){for(var h,g,b=0,E=0,R=m.length,v=R-1;E<R;v=E++)b+=((g=m[v]).x-(h=m[E]).x)*(h.y+g.y);return b}return Iw=i,i.types=["Unknown","Point","LineString","Polygon"],i.prototype.loadGeometry=function(){var m=this._pbf;m.pos=this._geometry;for(var h,g=m.readVarint()+m.pos,b=1,E=0,R=0,v=0,S=[];m.pos<g;){if(E<=0){var C=m.readVarint();b=7&C,E=C>>3}if(E--,b===1||b===2)R+=m.readSVarint(),v+=m.readSVarint(),b===1&&(h&&S.push(h),h=[]),h.push(new c(R,v));else{if(b!==7)throw new Error("unknown command "+b);h&&h.push(h[0].clone())}}return h&&S.push(h),S},i.prototype.bbox=function(){var m=this._pbf;m.pos=this._geometry;for(var h=m.readVarint()+m.pos,g=1,b=0,E=0,R=0,v=1/0,S=-1/0,C=1/0,T=-1/0;m.pos<h;){if(b<=0){var I=m.readVarint();g=7&I,b=I>>3}if(b--,g===1||g===2)(E+=m.readSVarint())<v&&(v=E),E>S&&(S=E),(R+=m.readSVarint())<C&&(C=R),R>T&&(T=R);else if(g!==7)throw new Error("unknown command "+g)}return[v,C,S,T]},i.prototype.toGeoJSON=function(m,h,g){var b,E,R=this.extent*Math.pow(2,g),v=this.extent*m,S=this.extent*h,C=this.loadGeometry(),T=i.types[this.type];function I(F){for(var q=0;q<F.length;q++){var H=F[q];F[q]=[360*(H.x+v)/R-180,360/Math.PI*Math.atan(Math.exp((180-360*(H.y+S)/R)*Math.PI/180))-90]}}switch(this.type){case 1:var D=[];for(b=0;b<C.length;b++)D[b]=C[b][0];I(C=D);break;case 2:for(b=0;b<C.length;b++)I(C[b]);break;case 3:for(C=function(F){var q=F.length;if(q<=1)return[F];for(var H,U,$=[],Y=0;Y<q;Y++){var ie=u(F[Y]);ie!==0&&(U===void 0&&(U=ie<0),U===ie<0?(H&&$.push(H),H=[F[Y]]):H.push(F[Y]))}return H&&$.push(H),$}(C),b=0;b<C.length;b++)for(E=0;E<C[b].length;E++)I(C[b][E])}C.length===1?C=C[0]:T="Multi"+T;var k={type:"Feature",geometry:{type:T,coordinates:C},properties:this.properties};return"id"in this&&(k.id=this.id),k},Iw}function PI(){if(MI)return Mw;MI=1;var c=DI();function i(u,m){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=u,this._keys=[],this._values=[],this._features=[],u.readFields(a,this,m),this.length=this._features.length}function a(u,m,h){u===15?m.version=h.readVarint():u===1?m.name=h.readString():u===5?m.extent=h.readVarint():u===2?m._features.push(h.pos):u===3?m._keys.push(h.readString()):u===4&&m._values.push(function(g){for(var b=null,E=g.readVarint()+g.pos;g.pos<E;){var R=g.readVarint()>>3;b=R===1?g.readString():R===2?g.readFloat():R===3?g.readDouble():R===4?g.readVarint64():R===5?g.readVarint():R===6?g.readSVarint():R===7?g.readBoolean():null}return b}(h))}return Mw=i,i.prototype.feature=function(u){if(u<0||u>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[u];var m=this._pbf.readVarint()+this._pbf.pos;return new c(this._pbf,m,this.extent,this._keys,this._values)},Mw}function LI(){return RI||(RI=1,yv.VectorTile=function(){if(CI)return Cw;CI=1;var c=PI();function i(a,u,m){if(a===3){var h=new c(m,m.readVarint()+m.pos);h.length&&(u[h.name]=h)}}return Cw=function(a,u){this.layers=a.readFields(i,{},u)},Cw}(),yv.VectorTileFeature=DI(),yv.VectorTileLayer=PI()),yv}var Ep=LI();class Hd extends St{constructor(i,a,u){super(i,a),this.z=u}}class zI extends Hd{constructor(i,a,u,m){super(i,a,u),this.w=m}}function vv(c,i,a,u){const m=[],h=u===0?(g,b,E,R,v,S)=>{g.push(new St(S,E+(S-b)/(R-b)*(v-E)))}:(g,b,E,R,v,S)=>{g.push(new St(b+(S-E)/(v-E)*(R-b),S))};for(const g of c){const b=[];for(const E of g){if(E.length<=2)continue;const R=[];for(let C=0;C<E.length-1;C++){const T=E[C].x,I=E[C].y,D=E[C+1].x,k=E[C+1].y,F=u===0?T:I,q=u===0?D:k;F<i?q>i&&h(R,T,I,D,k,i):F>a?q<a&&h(R,T,I,D,k,a):R.push(E[C]),q<i&&F>=i&&h(R,T,I,D,k,i),q>a&&F<=a&&h(R,T,I,D,k,a)}let v=E[E.length-1];const S=u===0?v.x:v.y;S>=i&&S<=a&&R.push(v),R.length&&(v=R[R.length-1],R[0].x===v.x&&R[0].y===v.y||R.push(R[0]),b.push(R))}b.length&&m.push(b)}return m}function OI(c,i,a,u){const m=a==="x"?"y":"x",h=(u-c[a])/(i[a]-c[a]);c[m]=c[m]+(i[m]-c[m])*h,c[a]=u,c.hasOwnProperty("z")&&(c.z=ei(c.z,i.z,h)),c.hasOwnProperty("w")&&(c.w=ei(c.w,i.w,h))}function kI(c,i,a,u){const m=a,h=u;for(const g of["x","y"]){let b=c,E=i;b[g]>=E[g]&&(b=i,E=c),b[g]<m&&E[g]>m&&OI(b,E,g,m),b[g]<h&&E[g]>h&&OI(E,b,g,h)}}const xv=Number.MAX_SAFE_INTEGER;function NI(c,i,a,u){return c.order<i||c.order===xv||!(c.clipMask&a)||function(m,h){return h.length!==0&&h.find(g=>g===m)===void 0}(u,c.clipScope)}function bv(c,i){return c.x-i.x||c.y-i.y}function FI(c,i){return bv(c.min,i.min)===0&&bv(c.max,i.max)===0}function Rw(c,i){return!(c.min.x>i.max.x||c.max.x<i.min.x||c.min.y>i.max.y||c.max.y<i.min.y)}function Dw(c,i){if(c.length!==i.length)return!1;for(let a=0;a<c.length;a++)if(c[a].sourceId!==i[a].sourceId||!FI(c[a],i[a])||c[a].order!==i[a].order||c[a].clipMask!==i[a].clipMask||!cr(c[a].clipScope,i[a].clipScope))return!1;return!0}function BI(c,i,a){const u=1/Pt,m=1/(1<<a.canonical.z),h=(i.x*u+a.canonical.x)*m+a.wrap,g=(i.y*u+a.canonical.y)*m;return{min:new St((c.x*u+a.canonical.x)*m+a.wrap,(c.y*u+a.canonical.y)*m),max:new St(h,g)}}function CF(c,i,a){const u=1<<a.canonical.z,m=((i.x-a.wrap)*u-a.canonical.x)*Pt,h=(i.y*u-a.canonical.y)*Pt;return{min:new St(((c.x-a.wrap)*u-a.canonical.x)*Pt,(c.y*u-a.canonical.y)*Pt),max:new St(m,h)}}function VI(c,i,a,u,m,h,g){const b=c.indices,E=c.vertices,R=[];for(let v=u;v<u+m;v+=3){const S=i[a[v+0]+h],C=i[a[v+1]+h],T=i[a[v+2]+h],I=Math.min(S.x,C.x,T.x),D=Math.max(S.x,C.x,T.x),k=Math.min(S.y,C.y,T.y),F=Math.max(S.y,C.y,T.y);R.length=0,c.grid.query(new St(I,k),new St(D,F),R);for(let q=0;q<R.length;q++){const H=R[q];if(Ke(E[b[3*H+0]],E[b[3*H+1]],E[b[3*H+2]],S,C,T,g))return!0}}return!1}function UI(c,i,a,u){if(!c||!a)return!1;let m=c.vertices;if(!i.canonical.equals(u.canonical)||i.wrap!==u.wrap){if(a.vertices.length<c.vertices.length)return UI(a,u,c,i);const h=i.canonical,g=u.canonical,b=Math.pow(2,g.z-h.z);m=c.vertices.map(E=>new St((E.x+h.x*Pt)*b-g.x*Pt,(E.y+h.y*Pt)*b-g.y*Pt))}return VI(a,m,c.indices,0,c.indices.length,0,0)}function jI(c,i,a,u){const m=Math.pow(2,u.z-a.z);return new St((c+a.x*Pt)*m-u.x*Pt,(i+a.y*Pt)*m-u.y*Pt)}function qI(c,i){const a=[];i.grid.queryPoint(c,a);const u=i.indices,m=i.vertices;for(let h=0;h<a.length;h++){const g=a[h];if(ge([m[u[3*g+0]],m[u[3*g+1]],m[u[3*g+2]]],c))return!0}return!1}const Pw=[new St(0,0),new St(Pt,0),new St(Pt,Pt),new St(0,Pt)];function GI(c,i){const a=[];let u=[];if(!i||c.length<2)return[c];if(c.length===2)return Fe(c[0],c[1],Pw)?[c]:[];for(let m=0;m<c.length+2;m++){const h=c[m%c.length],g=c[(m+1)%c.length],b=Fe(m===0?c[c.length-1]:c[(m-1)%c.length],h,Pw),E=Fe(h,g,Pw),R=b||E;R&&u.push(h),R&&E||u.length>0&&(u.length>1&&a.push(u),u=[])}return u.length>1&&a.push(u),a}const Lw=Ep.VectorTileFeature.types,RF=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],DF=["fill-extrusion-flood-light-ground-radius"],PF=Math.pow(2,13),LF=Math.pow(2,15)-1,HI=new St(0,1),th=2147483648;function u_(c,i,a,u,m,h,g,b){c.emplaceBack((i<<1)+g,(a<<1)+h,(Math.floor(u*PF)<<1)+m,Math.round(b))}function h_(c,i,a){c.emplaceBack(i.x*Pt,i.y*Pt,a?1:0)}function wv(c,i,a,u,m,h){c.emplaceBack(i.x,i.y,(a.x<<1)+u,(a.y<<1)+m,h)}function d_(c,i,a){c.emplaceBack(i.x,i.y,i.z,a[0]*16384,a[1]*16384,a[2]*16384)}class $I{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class ZI{constructor(){this.centroidXY=new St(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new St(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new St(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new St(this.max.x-this.min.x,this.max.y-this.min.y)}}class WI{constructor(){this.acc=new St(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(i,a){i.min.x===Number.MAX_VALUE&&(i.min.x=i.max.x=a.x,i.min.y=i.max.y=a.y)}appendEdge(i,a,u){this.accCount++,this.acc._add(a);let m=!!this.borders;a.x<i.min.x?(i.min.x=a.x,m=!0):a.x>i.max.x&&(i.max.x=a.x,m=!0),a.y<i.min.y?(i.min.y=a.y,m=!0):a.y>i.max.y&&(i.max.y=a.y,m=!0),((a.x===0||a.x===Pt)&&a.x===u.x)!=((a.y===0||a.y===Pt)&&a.y===u.y)&&this.processBorderOverlap(a,u),m&&this.checkBorderIntersection(a,u)}checkBorderIntersection(i,a){a.x<0!=i.x<0&&this.addBorderIntersection(0,ei(a.y,i.y,(0-a.x)/(i.x-a.x))),a.x>Pt!=i.x>Pt&&this.addBorderIntersection(1,ei(a.y,i.y,(Pt-a.x)/(i.x-a.x))),a.y<0!=i.y<0&&this.addBorderIntersection(2,ei(a.x,i.x,(0-a.y)/(i.y-a.y))),a.y>Pt!=i.y>Pt&&this.addBorderIntersection(3,ei(a.x,i.x,(Pt-a.y)/(i.y-a.y)))}addBorderIntersection(i,a){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const u=this.borders[i];a<u[0]&&(u[0]=a),a>u[1]&&(u[1]=a)}processBorderOverlap(i,a){if(i.x===a.x){if(i.y===a.y)return;const u=i.x===0?0:1;this.addBorderIntersection(u,a.y),this.addBorderIntersection(u,i.y)}else{const u=i.y===0?2:3;this.addBorderIntersection(u,a.x),this.addBorderIntersection(u,i.x)}}centroid(){return this.accCount===0?new St(0,0):new St(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((i,a)=>i+ +(a[0]!==Number.MAX_VALUE),0):0}}function XI(c,i){const a=c.add(i)._unit(),u=bi(c.x*a.x+c.y*a.y,-1,1);var m,h,g;return g=Math.acos(u),Math.min(4,Math.max(-4,Math.tan(g)))/4*LF*((m=c).x*(h=i).y-m.y*h.x<0?-1:1)}const zF=[c=>c.x<0,c=>c.x>Pt,c=>c.y<0,c=>c.y>Pt];function OF(c,i,a,u){const m=[4];if(u===0)return m;a._mult(u);const h=c.sub(a),g=i.sub(a),b=[c,i,h,g];for(let E=0;E<4;E++)for(const R of b)if(zF[E](R)){m.push(E);break}return m}class YI{constructor(i){this.vertexArray=new hp,this.indexArray=new Gr,this.programConfigurations=new Yl(i.layers,{zoom:i.zoom,lut:i.lut},a=>DF.includes(a)),this._segments=new $n,this.hiddenByLandmarkVertexArray=new gp,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new $n}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(i,a,u,m=!1){const h=i.length;if(h>2){let g=Math.max(0,this._segments.get().length-1);const b=this._segments._prepareSegment(4*h,this.vertexArray.length,2*this._segmentToGroundQuads[g].length);let E;g!==this._segments.get().length-1&&(g++,this._segmentToGroundQuads[g]=[],this._segmentToRegionTriCounts[g]=[0,0,0,0,0]);{const R=i[0],v=i[1];E=XI(R.sub(i[h-1])._perp()._unit(),v.sub(R)._perp()._unit())}for(let R=0;R<h;R++){const v=R===h-1?0:R+1,S=i[R],C=i[v],T=i[v===h-1?0:v+1],I=C.sub(S)._perp()._unit(),D=XI(I,T.sub(C)._perp()._unit()),k=E,F=D;if(zw(S,C,a)||m&&JI(S,a)&&JI(C,a)){E=D;continue}const q=b.vertexLength;wv(this.vertexArray,S,C,1,1,k),wv(this.vertexArray,S,C,1,0,k),wv(this.vertexArray,S,C,0,1,F),wv(this.vertexArray,S,C,0,0,F),b.vertexLength+=4;const H=OF(S,C,I,u);for(const U of H)this._segmentToGroundQuads[g].push({id:q,region:U}),this._segmentToRegionTriCounts[g][U]+=2,b.primitiveLength+=2;E=D}}}prepareBorderSegments(){if(!this.hasData())return;const i=this._segments.get(),a=i.length;for(let u=0;u<a;u++)this._segmentToGroundQuads[u].sort((m,h)=>m.region-h.region);for(let u=0;u<a;u++){const m=this._segmentToGroundQuads[u],h=i[u],g=this._segmentToRegionTriCounts[u];g.reduce((E,R)=>E+R,0);let b=0;for(let E=0;E<=4;E++){const R=g[E];if(R!==0){let v=this.regionSegments[E];v||(v=this.regionSegments[E]=new $n);const S={vertexOffset:h.vertexOffset,primitiveOffset:h.primitiveOffset+b,vertexLength:h.vertexLength,primitiveLength:R};v.get().push(S)}b+=R}for(let E=0;E<m.length;E++){const R=m[E].id;this.indexArray.emplaceBack(R,R+1,R+3),this.indexArray.emplaceBack(R,R+3,R+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(i,a,u,m,h,g){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,i,a,u,m,h,g)}upload(i){this.hasData()&&(this.vertexBuffer=i.createVertexBuffer(this.vertexArray,TF.members),this.indexBuffer=i.createIndexBuffer(this.indexArray))}uploadPaintProperties(i){this.hasData()&&this.programConfigurations.upload(i)}update(i,a,u,m,h,g,b){this.hasData()&&this.programConfigurations.updatePaintArrays(i,a,u,m,h,g,b)}updateHiddenByLandmark(i){if(!this.hasData())return;const a=i.groundVertexCount+i.groundVertexArrayOffset;if(i.groundVertexCount===0)return;const u=i.flags&th?1:0;for(let m=i.groundVertexArrayOffset;m<a;++m)this.hiddenByLandmarkVertexArray.emplace(m,u);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(i){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=i.createVertexBuffer(this.hiddenByLandmarkVertexArray,AF.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let i=0;i<=4;i++){const a=this.regionSegments[i];a&&a.destroy()}}}}class Tv{constructor(i){this.zoom=i.zoom,this.canonical=i.canonical,this.overscaling=i.overscaling,this.layers=i.layers,this.pixelRatio=i.pixelRatio,this.layerIds=this.layers.map(a=>a.fqid),this.index=i.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=i.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Gr,this.footprintVertices=new cl,this.footprintSegments=[],this.layoutVertexArray=new ul,this.centroidVertexArray=new na,this.wallVertexArray=new av,this.indexArray=new Gr,this.programConfigurations=new Yl(i.layers,{zoom:i.zoom,lut:i.lut},a=>RF.includes(a)),this.segments=new $n,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.groundEffect=new YI(i),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(i,a){}populate(i,a,u,m){this.features=[],this.hasPattern=Tw("fill-extrusion",this.layers,this.pixelRatio,a),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=r(u),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:h,id:g,index:b,sourceLayerIndex:E}of i){const R=this.layers[0]._featureFilter.needGeometry,v=B(h,R);if(!this.layers[0]._featureFilter.filter(new vn(this.zoom),v,u))continue;const S={id:g,sourceLayerIndex:E,index:b,geometry:R?v.geometry:O(h,u,m),properties:h.properties,type:h.type,patterns:{}},C=this.layoutVertexArray.length,T=Lw[S.type]==="Polygon";if(this.hasPattern)this.features.push(Ew("fill-extrusion",this.layers,S,this.zoom,this.pixelRatio,a));else if(this.wallMode)for(const I of S.geometry)for(const D of GI(I,T))this.addFeature(S,[D],b,u,{},a.availableImages,m,a.brightness);else this.addFeature(S,S.geometry,b,u,{},a.availableImages,m,a.brightness);a.featureIndex.insert(h,S.geometry,b,E,this.index,C)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(i,a,u,m,h,g){for(const b of this.features){const E=Lw[b.type]==="Polygon",{geometry:R}=b;if(this.wallMode)for(const v of R)for(const S of GI(v,E))this.addFeature(b,[S],b.index,a,u,m,h,g);else this.addFeature(b,R,b.index,a,u,m,h,g)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(i,a,u,m,h,g,b){this.programConfigurations.updatePaintArrays(i,a,h,u,m,g,b),this.groundEffect.update(i,a,h,u,m,g,b)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,MF),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.wallVertexBuffer=i.createVertexBuffer(this.wallVertexArray,SF.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=i.createVertexBuffer(this.layoutVertexExtArray,IF.members,!0)),this.groundEffect.upload(i)),this.groundEffect.uploadPaintProperties(i),this.programConfigurations.upload(i),this.uploaded=!0}uploadCentroid(i){this.groundEffect.uploadHiddenByLandmark(i),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=i.createVertexBuffer(this.centroidVertexArray,EF.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,a,u,m,h,g,b,E){const R=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(i,{})/this.tileToMeter,v=[new St(0,0),new St(Pt,Pt)],S=b.projection,C=S.name==="globe",T=this.wallMode||Lw[i.type]==="Polygon",I=new WI;I.centroidDataIndex=this.centroidData.length;const D=new ZI,k=this.layers[0].paint.get("fill-extrusion-base").evaluate(i,{},m)<=0,F=this.layers[0].paint.get("fill-extrusion-height").evaluate(i,{},m);let q;if(D.height=F,D.vertexArrayOffset=this.layoutVertexArray.length,D.groundVertexArrayOffset=this.groundEffect.vertexArray.length,C&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Dd),this.wallMode){if(C)return void yi("Non zero fill-extrusion-line-width is not yet supported on globe.");if(a.length!==1)return;q=function(ce){const Ie=ce[0].x===ce[ce.length-1].x&&ce[0].y===ce[ce.length-1].y;(function(wt){let vt=0;const Zt=wt.length;for(let zt=0;zt<Zt;zt++)vt+=(wt[(zt+1)%Zt].x-wt[zt].x)*(wt[(zt+1)%Zt].y+wt[zt].y);return vt>=0})(ce)||(ce=ce.reverse());const Me={geometry:[],joinNormals:[],indices:[]},ze=[],Pe=[],Ne=[];let qe=ce.length;for(;qe>=2&&ce[qe-1].equals(ce[qe-2]);)qe--;if(qe<(Ie?3:2))return Me;let Ze,Be,ct,yt,lt,Lt=0;for(;Lt<qe-1&&ce[Lt].equals(ce[Lt+1]);)Lt++;Ie&&(Ze=ce[qe-2],lt=ce[Lt].sub(Ze)._unit()._perp());for(let wt=Lt;wt<qe;wt++){if(ct=wt===qe-1?Ie?ce[Lt+1]:void 0:ce[wt+1],ct&&ce[wt].equals(ct))continue;lt&&(yt=lt),Ze&&(Be=Ze),Ze=ce[wt],lt=ct?ct.sub(Ze)._unit()._perp():yt,yt=yt||lt;let vt=yt.add(lt);vt.x===0&&vt.y===0||vt._unit();const Zt=vt.x*lt.x+vt.y*lt.y,zt=Zt!==0?1/Zt:1/0,Ft=yt.x*lt.y-yt.y*lt.x>0;let hi="miter";const xi=2;hi==="miter"&&zt>xi&&(hi="bevel"),hi==="bevel"&&(zt>100&&(hi="flipbevel"),zt<xi&&(hi="miter"));const Ti=(Ei,Ci,Ri,dn)=>{const rn=new St(Ei.x,Ei.y),pi=new St(Ei.x,Ei.y);rn.x+=Ci.x*dn,rn.y+=Ci.y*dn,pi.x-=Ci.x*Math.max(Ri,1),pi.y-=Ci.y*Math.max(Ri,1),Ne.push(Ci),ze.push(rn),Pe.push(pi)};if(hi==="miter")vt._mult(zt),Ti(Ze,vt,0,0);else if(hi==="flipbevel")vt=lt.mult(-1),Ti(Ze,vt,0,0),Ti(Ze,vt.mult(-1),0,0);else{const Ei=-Math.sqrt(zt*zt-1),Ci=Ft?Ei:0,Ri=Ft?0:Ei;Be&&Ti(Ze,yt,Ci,Ri),ct&&Ti(Ze,lt,Ci,Ri)}}Me.geometry=[...ze,...Pe.reverse(),ze[0]],Me.joinNormals=[...Ne,...Ne.reverse(),Ne[Ne.length-1]];const Dt=Me.geometry.length-1;for(let wt=0;wt<Dt/2;wt++)if(wt+1<Dt/2){let vt=wt,Zt=wt+1,zt=Dt-1-wt,Ft=Dt-2-wt;vt=vt===0?Dt-1:vt-1,Zt=Zt===0?Dt-1:Zt-1,zt=zt===0?Dt-1:zt-1,Ft=Ft===0?Dt-1:Ft-1,Me.indices.push(zt),Me.indices.push(Zt),Me.indices.push(vt),Me.indices.push(zt),Me.indices.push(Ft),Me.indices.push(Zt)}return Me}(a[0]),a=[q.geometry]}const H=(ce,Ie)=>ce<(Ie.length-1)/2||ce===Ie.length-1,U=this.wallMode?[a]:_v(a,500);for(let ce=U.length-1;ce>=0;ce--){const Ie=U[ce];(Ie.length===0||($=Ie[0]).every(de=>de.x<=0)||$.every(de=>de.x>=Pt)||$.every(de=>de.y<=0)||$.every(de=>de.y>=Pt))&&U.splice(ce,1)}var $;let Y;if(C)Y=nM(U,v,m);else{Y=[];for(const ce of U)Y.push({polygon:ce,bounds:v})}const ie=T?this.edgeRadius:0,he=ie>0&&this.zoom<17,ue=(ce,Ie)=>{if(ce.length===0)return!1;const de=ce[ce.length-1];return Ie.x===de.x&&Ie.y===de.y};for(const{polygon:ce,bounds:Ie}of Y){let de=0,Me=0;for(const qe of ce)T&&!qe[0].equals(qe[qe.length-1])&&qe.push(qe[0]),Me+=T?qe.length-1:qe.length;const ze=this.segments.prepareSegment((T?5:4)*Me,this.layoutVertexArray,this.indexArray);D.footprintSegIdx<0&&(D.footprintSegIdx=this.footprintSegments.length),D.polygonSegIdx<0&&(D.polygonSegIdx=this.polygonSegments.length);const Pe={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Ne=new $I;if(Ne.vertexOffset=this.footprintVertices.length,Ne.indexOffset=3*this.footprintIndices.length,Ne.ringIndices=[],T){const qe=[],Ze=[];de=ze.vertexLength;for(let ct=0;ct<ce.length;ct++){const yt=ce[ct];yt.length&&ct!==0&&Ze.push(qe.length/2);const lt=[];let Lt,Dt;Lt=yt[1].sub(yt[0])._perp()._unit(),Ne.ringIndices.push(yt.length-1);for(let wt=1;wt<yt.length;wt++){const vt=yt[wt],Zt=yt[wt===yt.length-1?1:wt+1],zt=vt.clone();if(ie){Dt=Zt.sub(vt)._perp()._unit();const Ft=Lt.add(Dt)._unit(),hi=ie*Math.min(4,1/(Lt.x*Ft.x+Lt.y*Ft.y));zt.x+=hi*Ft.x,zt.y+=hi*Ft.y,zt.x=Math.round(zt.x),zt.y=Math.round(zt.y),Lt=Dt}if(!k||ie!==0&&!he||ue(lt,zt)||lt.push(zt),u_(this.layoutVertexArray,zt.x,zt.y,0,0,1,1,0),this.wallMode){const Ft=H(wt,yt);h_(this.wallVertexArray,q.joinNormals[wt],!Ft)}ze.vertexLength++,this.footprintVertices.emplaceBack(vt.x,vt.y),qe.push(vt.x,vt.y),C&&d_(this.layoutVertexExtArray,S.projectTilePoint(zt.x,zt.y,m),S.upVector(m,zt.x,zt.y))}k&&(ie===0||he)&&(lt.length!==0&&ue(lt,lt[0])&&lt.pop(),this.groundEffect.addData(lt,Ie,R))}const Be=this.wallMode?q.indices:a_(qe,Ze);for(let ct=0;ct<Be.length;ct+=3)this.footprintIndices.emplaceBack(Ne.vertexOffset+Be[ct+0],Ne.vertexOffset+Be[ct+1],Ne.vertexOffset+Be[ct+2]),this.indexArray.emplaceBack(de+Be[ct],de+Be[ct+2],de+Be[ct+1]),ze.primitiveLength++;Ne.indexCount+=Be.length,Ne.vertexCount+=this.footprintVertices.length-Ne.vertexOffset}for(let qe=0;qe<ce.length;qe++){const Ze=ce[qe];I.startRing(D,Ze[0]);let Be=Ze.length>4&&eM(Ze[Ze.length-2],Ze[0],Ze[1]),ct=ie?kF(Ze[Ze.length-2],Ze[0],Ze[1],ie):0;const yt=[];let lt,Lt,Dt;Lt=Ze[1].sub(Ze[0])._perp()._unit();let wt=!0;for(let vt=1,Zt=0;vt<Ze.length;vt++){let zt=Ze[vt-1],Ft=Ze[vt];const hi=Ze[vt===Ze.length-1?1:vt+1];if(I.appendEdge(D,Ft,zt),zw(Ft,zt,Ie)){ie&&(Lt=hi.sub(Ft)._perp()._unit(),wt=!wt);continue}const xi=Ft.sub(zt)._perp(),Ti=xi.x/(Math.abs(xi.x)+Math.abs(xi.y)),Ei=xi.y>0?1:0,Ci=zt.dist(Ft);if(Zt+Ci>32768&&(Zt=0),ie){Dt=hi.sub(Ft)._perp()._unit();let pi=QI(zt,Ft,hi,KI(Lt,Dt),ie);isNaN(pi)&&(pi=0);const Ji=Ft.sub(zt)._unit();zt=zt.add(Ji.mult(ct))._round(),Ft=Ft.add(Ji.mult(-pi))._round(),ct=pi,Lt=Dt,k&&this.zoom>=17&&(ue(yt,zt)||yt.push(zt),ue(yt,Ft)||yt.push(Ft))}const Ri=ze.vertexLength,dn=Ze.length>4&&eM(zt,Ft,hi);let rn=tM(Zt,Be,wt);if(u_(this.layoutVertexArray,zt.x,zt.y,Ti,Ei,0,0,rn),u_(this.layoutVertexArray,zt.x,zt.y,Ti,Ei,0,1,rn),this.wallMode){const pi=H(vt-1,Ze),Ji=q.joinNormals[vt-1];h_(this.wallVertexArray,Ji,pi),h_(this.wallVertexArray,Ji,pi)}if(Zt+=Ci,rn=tM(Zt,dn,!wt),Be=dn,u_(this.layoutVertexArray,Ft.x,Ft.y,Ti,Ei,0,0,rn),u_(this.layoutVertexArray,Ft.x,Ft.y,Ti,Ei,0,1,rn),this.wallMode){const pi=H(vt,Ze),Ji=q.joinNormals[vt];h_(this.wallVertexArray,Ji,pi),h_(this.wallVertexArray,Ji,pi)}if(ze.vertexLength+=4,this.indexArray.emplaceBack(Ri+0,Ri+1,Ri+2),this.indexArray.emplaceBack(Ri+1,Ri+3,Ri+2),ze.primitiveLength+=2,ie){const pi=de+(vt===1?Ze.length-2:vt-2),Ji=vt===1?de:pi+1;if(this.indexArray.emplaceBack(Ri+1,pi,Ri+3),this.indexArray.emplaceBack(pi,Ji,Ri+3),ze.primitiveLength+=2,lt===void 0&&(lt=Ri),!zw(hi,Ze[vt],Ie)){const tn=vt===Ze.length-1?lt:ze.vertexLength;this.indexArray.emplaceBack(Ri+2,Ri+3,tn),this.indexArray.emplaceBack(Ri+3,tn+1,tn),this.indexArray.emplaceBack(Ri+3,Ji,tn+1),ze.primitiveLength+=3}wt=!wt}if(C){const pi=this.layoutVertexExtArray,Ji=S.projectTilePoint(zt.x,zt.y,m),tn=S.projectTilePoint(Ft.x,Ft.y,m),In=S.upVector(m,zt.x,zt.y),tr=S.upVector(m,Ft.x,Ft.y);d_(pi,Ji,In),d_(pi,Ji,In),d_(pi,tn,tr),d_(pi,tn,tr)}}T&&(de+=Ze.length-1),k&&ie&&this.zoom>=17&&(yt.length!==0&&ue(yt,yt[0])&&yt.pop(),this.groundEffect.addData(yt,Ie,R,ie>0))}this.footprintSegments.push(Ne),Pe.triangleCount=this.indexArray.length-Pe.triangleArrayOffset,this.polygonSegments.push(Pe),++D.footprintSegLen,++D.polygonSegLen}if(D.vertexCount=this.layoutVertexArray.length-D.vertexArrayOffset,D.groundVertexCount=this.groundEffect.vertexArray.length-D.groundVertexArrayOffset,D.vertexCount!==0){if(D.centroidXY=I.borders?HI:this.encodeCentroid(I,D),this.centroidData.push(D),I.borders){this.featuresOnBorder.push(I);const ce=this.featuresOnBorder.length-1;for(let Ie=0;Ie<I.borders.length;Ie++)I.borders[Ie][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Ie].push(ce)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,u,h,g,m,E),this.groundEffect.addPaintPropertiesData(i,u,h,g,m,E),this.maxHeight=Math.max(this.maxHeight,F)}}sortBorders(){for(let i=0;i<this.borderFeatureIndices.length;i++)this.borderFeatureIndices[i].sort((a,u)=>this.featuresOnBorder[a].borders[i][0]-this.featuresOnBorder[u].borders[i][0])}splitToSubtiles(){const i=[];for(let b=0;b<this.centroidData.length;b++){const E=this.centroidData[b],R=+(E.min.y+E.max.y>Pt),v=2*R+(+(E.min.x+E.max.x>Pt)^R);for(let S=0;S<E.polygonSegLen;S++){const C=E.polygonSegIdx+S;i.push({centroidIdx:b,subtile:v,polygonSegmentIdx:C,triangleSegmentIdx:this.polygonSegments[C].triangleSegIdx})}}const a=new Gr;i.sort((b,E)=>b.triangleSegmentIdx===E.triangleSegmentIdx?b.subtile-E.subtile:b.triangleSegmentIdx-E.triangleSegmentIdx);let u=0,m=0,h=0;for(const b of i){if(b.triangleSegmentIdx!==u)break;h++}const g=i.length;for(;m!==i.length;){u=i[m].triangleSegmentIdx;let b=0,E=m,R=m;for(let v=E;v<h&&i[v].subtile===b;v++)R++;for(;E!==h;){const v=i[E];b=v.subtile;const S=this.centroidData[v.centroidIdx].min.clone(),C=this.centroidData[v.centroidIdx].max.clone(),T={vertexOffset:this.segments.segments[u].vertexOffset,primitiveOffset:a.length,vertexLength:this.segments.segments[u].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let I=E;I<R;I++){const D=i[I],k=this.polygonSegments[D.polygonSegmentIdx],F=this.centroidData[D.centroidIdx].min,q=this.centroidData[D.centroidIdx].max,H=this.indexArray.uint16;for(let U=k.triangleArrayOffset;U<k.triangleArrayOffset+k.triangleCount;U++)a.emplaceBack(H[3*U],H[3*U+1],H[3*U+2]);T.primitiveLength+=k.triangleCount,S.x=Math.min(S.x,F.x),S.y=Math.min(S.y,F.y),C.x=Math.max(C.x,q.x),C.y=Math.max(C.y,q.y)}T.primitiveLength>0&&this.triangleSubSegments.push({segment:T,min:S,max:C}),E=R;for(let I=E;I<h&&i[I].subtile===i[E].subtile;I++)R++}m=h;for(let v=m;v<g&&i[v].triangleSegmentIdx===i[m].triangleSegmentIdx;v++)h++}a._trim(),this.indexArray=a}getVisibleSegments(i,a,u){const m=new $n;if(this.wallMode){for(const D of this.triangleSubSegments)m.segments.push(D.segment);return m}let h=0,g=0;const b=1<<i.canonical.z;if(a){const D=a.getMinMaxForTile(i);D&&(h=D.min,g=D.max)}g+=this.maxHeight;const E=i.toUnwrapped();let R;const v=[E.canonical.x/b+E.wrap,E.canonical.y/b],S=[(E.canonical.x+1)/b+E.wrap,(E.canonical.y+1)/b],C=(D,k,F)=>[D[0]*(1-F[0])+k[0]*F[0],D[1]*(1-F[1])+k[1]*F[1]],T=[],I=[];for(const D of this.triangleSubSegments){T[0]=D.min.x/Pt,T[1]=D.min.y/Pt,I[0]=D.max.x/Pt,I[1]=D.max.y/Pt;const k=C(v,S,T),F=C(v,S,I);if(new Xt([k[0],k[1],h],[F[0],F[1],g]).intersectsPrecise(u)===0){R&&(m.segments.push(R),R=void 0);continue}const q=D.segment;R&&R.vertexOffset!==q.vertexOffset&&(m.segments.push(R),R=void 0),R?(R.vertexLength+=q.vertexLength,R.primitiveLength+=q.primitiveLength):R={vertexOffset:q.vertexOffset,primitiveLength:q.primitiveLength,vertexLength:q.vertexLength,primitiveOffset:q.primitiveOffset,sortKey:void 0,vaos:{}}}return R&&m.segments.push(R),m}encodeCentroid(i,a){const u=i.centroid(),m=a.span(),h=Math.min(7,Math.round(m.x*this.tileToMeter/10)),g=Math.min(7,Math.round(m.y*this.tileToMeter/10));return new St(bi(u.x,1,Pt-1)<<3|h,bi(u.y,1,Pt-1)<<3|g)}encodeBorderCentroid(i){if(!i.borders)return new St(0,0);const a=i.borders,u=Number.MAX_VALUE;if(a[0][0]!==u||a[1][0]!==u){const m=a[0][0]!==u?0:1;return new St(6|(a[0][0]!==u?0:65528),(a[m][0]+a[m][1])/2<<3|6)}{const m=a[2][0]!==u?2:3;return new St((a[m][0]+a[m][1])/2<<3|6,6|(a[2][0]!==u?0:65528))}}showCentroid(i){const a=this.centroidData[i.centroidDataIndex];a.flags&=th,a.centroidXY.x=0,a.centroidXY.y=0,this.writeCentroidToBuffer(a)}writeCentroidToBuffer(i){this.groundEffect.updateHiddenByLandmark(i);const a=i.vertexArrayOffset,u=i.vertexCount+i.vertexArrayOffset,m=i.flags&th?HI:i.centroidXY,h=this.centroidVertexArray.geta_centroid_pos0(a);if(this.centroidVertexArray.geta_centroid_pos1(a)!==m.y||h!==m.x){for(let g=a;g<u;++g)this.centroidVertexArray.emplace(g,m.x,m.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const i of this.centroidData)this.writeCentroidToBuffer(i)}updateReplacement(i,a,u){if(a.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=a.updateTime;const m=a.getReplacementRegionsForTile(i.toUnwrapped());if(Dw(this.activeReplacements,m))return;if(this.activeReplacements=m,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const g of this.centroidData)g.flags&=2147483647;const h=[];for(const g of this.activeReplacements){if(g.order<u)continue;const b=Math.max(1,Math.pow(2,g.footprintTileId.canonical.z-i.canonical.z));for(const E of this.centroidData)if(!(E.flags&th||g.min.x>E.max.x||E.min.x>g.max.x||g.min.y>E.max.y||E.min.y>g.max.y))for(let R=0;R<E.footprintSegLen;R++){const v=this.footprintSegments[E.footprintSegIdx+R];if(h.length=0,NF(this.footprintVertices,v.vertexOffset,v.vertexCount,g.footprintTileId.canonical,i.canonical,h),VI(g.footprint,h,this.footprintIndices.uint16,v.indexOffset,v.indexCount,-v.vertexOffset,-b)){E.flags|=th;break}}}for(const g of this.centroidData)this.writeCentroidToBuffer(g);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(i,a,u){let m=!1;for(let h=0;h<u.footprintSegLen;h++){const g=this.footprintSegments[u.footprintSegIdx+h];let b=0;for(const E of g.ringIndices){for(let R=b,v=E+b-1;R<E+b;v=R++){const S=this.footprintVertices.int16[2*(R+g.vertexOffset)+0],C=this.footprintVertices.int16[2*(R+g.vertexOffset)+1],T=this.footprintVertices.int16[2*(v+g.vertexOffset)+1];C>a!=T>a&&i<(this.footprintVertices.int16[2*(v+g.vertexOffset)+0]-S)*(a-C)/(T-C)+S&&(m=!m)}b=E}}return m}getHeightAtTileCoord(i,a){let u=Number.NEGATIVE_INFINITY,m=!0;const h=4*(i+Pt)*Pt+(a+Pt);if(this.partLookup.hasOwnProperty(h)){const g=this.partLookup[h];return g?{height:g.height,hidden:!!(g.flags&th)}:void 0}for(const g of this.centroidData)i>g.max.x||g.min.x>i||a>g.max.y||g.min.y>a||this.footprintContainsPoint(i,a,g)&&g&&g.height>u&&(u=g.height,this.partLookup[h]=g,m=!!(g.flags&th));if(u!==Number.NEGATIVE_INFINITY)return{height:u,hidden:m};this.partLookup[h]=void 0}}function KI(c,i){const a=c.add(i)._unit();return c.x*a.x+c.y*a.y}function kF(c,i,a,u){const m=i.sub(c)._perp()._unit(),h=a.sub(i)._perp()._unit();return QI(c,i,a,KI(m,h),u)}function QI(c,i,a,u,m){const h=Math.sqrt(1-u*u);return Math.min(c.dist(i)/3,i.dist(a)/3,m*h/u)}function zw(c,i,a){return c.x<a[0].x&&i.x<a[0].x||c.x>a[1].x&&i.x>a[1].x||c.y<a[0].y&&i.y<a[0].y||c.y>a[1].y&&i.y>a[1].y}function JI(c,i){return c.x<i[0].x||c.x>i[1].x||c.y<i[0].y||c.y>i[1].y}function eM(c,i,a){if(c.x<0||c.x>=Pt||i.x<0||i.x>=Pt||a.x<0||a.x>=Pt)return!1;const u=a.sub(i),m=u.perp(),h=c.sub(i);return(u.x*h.x+u.y*h.y)/Math.sqrt((u.x*u.x+u.y*u.y)*(h.x*h.x+h.y*h.y))>-.866&&m.x*h.x+m.y*h.y<0}function tM(c,i,a){const u=i?2|c:-3&c;return a?1|u:-2&u}function iM(){const c=Math.PI/32,i=Math.tan(c),a=jc;return a*Math.sqrt(1+2*i*i)-a}function nM(c,i,a){const u=1<<a.z,m=ra(a.x/u),h=ra((a.x+1)/u),g=Hr(a.y/u),b=Hr((a.y+1)/u);return function(E,R,v,S,C=0,T){const I=[];if(!E.length||!v||!S)return I;const D=(Y,ie)=>{for(const he of Y)I.push({polygon:he,bounds:ie})},k=Math.ceil(Math.log2(v)),F=Math.ceil(Math.log2(S)),q=k-F,H=[];for(let Y=0;Y<Math.abs(q);Y++)H.push(q>0?0:1);for(let Y=0;Y<Math.min(k,F);Y++)H.push(0),H.push(1);let U=E;if(U=vv(U,R[0].y-C,R[1].y+C,1),U=vv(U,R[0].x-C,R[1].x+C,0),!U.length)return I;const $=[];for(H.length?$.push({polygons:U,bounds:R,depth:0}):D(U,R);$.length;){const Y=$.pop(),ie=Y.depth,he=H[ie],ue=Y.bounds[0],ce=Y.bounds[1],Ie=he===0?ue.x:ue.y,de=he===0?ce.x:ce.y,Me=T?T(he,Ie,de):.5*(Ie+de),ze=vv(Y.polygons,Ie-C,Me+C,he),Pe=vv(Y.polygons,Me-C,de+C,he);if(ze.length){const Ne=[ue,new St(he===0?Me:ce.x,he===1?Me:ce.y)];H.length>ie+1?$.push({polygons:ze,bounds:Ne,depth:ie+1}):D(ze,Ne)}if(Pe.length){const Ne=[new St(he===0?Me:ue.x,he===1?Me:ue.y),ce];H.length>ie+1?$.push({polygons:Pe,bounds:Ne,depth:ie+1}):D(Pe,Ne)}}return I}(c,i,Math.ceil((h-m)/11.25),Math.ceil((g-b)/11.25),1,(E,R,v)=>{if(E===0)return .5*(R+v);{const S=Hr((a.y+R/Pt)/u);return(io(.5*(Hr((a.y+v/Pt)/u)+S))*u-a.y)*Pt}})}function NF(c,i,a,u,m,h){const g=Math.pow(2,u.z-m.z);for(let b=0;b<a;b++){let E=c.int16[2*(b+i)+0],R=c.int16[2*(b+i)+1];E=(E+m.x*Pt)*g-u.x*Pt,R=(R+m.y*Pt)*g-u.y*Pt,h.push(new St(E,R))}}let rM,sM;function f_(c,i){return c.x*i.x+c.y*i.y}function aM(c,i){if(c.length===1){let a=0;const u=i[a++];let m;for(;!m||u.equals(m);)if(m=i[a++],!m)return 1/0;for(;a<i.length;a++){const h=i[a],g=c[0],b=m.sub(u),E=h.sub(u),R=g.sub(u),v=f_(b,b),S=f_(b,E),C=f_(E,E),T=f_(R,b),I=f_(R,E),D=v*C-S*S,k=(C*T-S*I)/D,F=(v*I-S*T)/D,q=u.z*(1-k-F)+m.z*k+h.z*F;if(isFinite(q))return q}return 1/0}{let a=1/0;for(const u of i)a=Math.min(a,u.z);return a}}function oM(c,i,a,u,m,h,g,b){const E=g*m.getElevationAt(c,i,!0,!0),R=h[0]!==0,v=R?h[1]===0?g*(h[0]/7-450):g*function(S,C,T){const I=Math.floor(C[0]/8),D=Math.floor(C[1]/8),k=10*(C[0]-8*I),F=10*(C[1]-8*D),q=S.getElevationAt(I,D,!0,!0),H=S.getMeterToDEM(T),U=Math.floor(.5*(k*H-1)),$=Math.floor(.5*(F*H-1)),Y=S.tileCoordToPixel(I,D),ie=2*U+1,he=2*$+1,ue=function(Pe,Ne,qe,Ze,Be){return[Pe.getElevationAtPixel(Ne,qe,!0),Pe.getElevationAtPixel(Ne+Be,qe,!0),Pe.getElevationAtPixel(Ne,qe+Be,!0),Pe.getElevationAtPixel(Ne+Ze,qe+Be,!0)]}(S,Y.x-U,Y.y-$,ie,he),ce=Math.abs(ue[0]-ue[1]),Ie=Math.abs(ue[2]-ue[3]),de=Math.abs(ue[0]-ue[2])+Math.abs(ue[1]-ue[3]),Me=Math.min(.25,.5*H*(ce+Ie)/ie),ze=Math.min(.25,.5*H*de/he);return q+Math.max(Me*k,ze*F)}(m,h,b):E;return{base:E+(a===0?-1:a),top:R?Math.max(v+u,E+a+2):E+u}}Gt(Tv,"FillExtrusionBucket",{omit:["layers","features"]}),Gt(ZI,"PartData"),Gt($I,"FootprintSegment"),Gt(WI,"BorderCentroidData"),Gt(YI,"GroundEffect");const FF=Xi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),BF=Xi([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:VF}=FF,UF=Xi([{name:"a_packed",components:3,type:"Float32"}]),{members:jF}=UF,qF=Xi([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:GF}=qF;class lM{constructor(i,a){this.width=i,this.height=a,this.nextRow=0,this.image=new eh({width:i,height:a}),this.positions={},this.uploaded=!1}getDash(i,a){const u=this.getKey(i,a);return this.positions[u]}trim(){const i=this.width,a=this.height=Jo(this.nextRow);this.image.resize({width:i,height:a})}getKey(i,a){return i.join(",")+a}getDashRanges(i,a,u){const m=[];let h=i.length%2==1?-i[i.length-1]*u:0,g=i[0]*u,b=!0;m.push({left:h,right:g,isDash:b,zeroLength:i[0]===0});let E=i[0];for(let R=1;R<i.length;R++){b=!b;const v=i[R];h=E*u,E+=v,g=E*u,m.push({left:h,right:g,isDash:b,zeroLength:v===0})}return m}addRoundDash(i,a,u){const m=a/2;for(let h=-u;h<=u;h++){const g=this.width*(this.nextRow+u+h);let b=0,E=i[b];for(let R=0;R<this.width;R++){R/E.right>1&&(E=i[++b]);const v=Math.abs(R-E.left),S=Math.abs(R-E.right),C=Math.min(v,S);let T;const I=h/u*(m+1);if(E.isDash){const D=m-Math.abs(I);T=Math.sqrt(C*C+D*D)}else T=m-Math.sqrt(C*C+I*I);this.image.data[g+R]=Math.max(0,Math.min(255,T+128))}}}addRegularDash(i,a){for(let E=i.length-1;E>=0;--E){const R=i[E],v=i[E+1];R.zeroLength?i.splice(E,1):v&&v.isDash===R.isDash&&(v.left=R.left,i.splice(E,1))}const u=i[0],m=i[i.length-1];u.isDash===m.isDash&&(u.left=m.left-this.width,m.right=u.right+this.width);const h=this.width*this.nextRow;let g=0,b=i[g];for(let E=0;E<this.width;E++){E/b.right>1&&(b=i[++g]);const R=Math.abs(E-b.left),v=Math.abs(E-b.right),S=Math.min(R,v);this.image.data[h+E]=Math.max(0,Math.min(255,(b.isDash?S:-S)+a+128))}}addDash(i,a){const u=this.getKey(i,a);if(this.positions[u])return this.positions[u];const m=a==="round",h=m?7:0,g=2*h+1;if(this.nextRow+g>this.height)return yi("LineAtlas out of space"),null;i.length===0&&i.push(1);let b=0;for(let v=0;v<i.length;v++)i[v]<0&&(yi("Negative value is found in line dasharray, replacing values with 0"),i[v]=0),b+=i[v];if(b!==0){const v=this.width/b,S=this.getDashRanges(i,this.width,v);m?this.addRoundDash(S,v,h):this.addRegularDash(S,a==="square"?.5*v:0)}const E=this.nextRow+h;this.nextRow+=g;const R={tl:[E,h],br:[b,0]};return this.positions[u]=R,R}}Gt(lM,"LineAtlas");const HF=Ep.VectorTileFeature.types,$F=Math.cos(Math.PI/180*37.5),ZF=Math.cos(Math.PI/180*5);class Ow{constructor(i){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.zoom=i.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=i.overscaling,this.pixelRatio=i.pixelRatio,this.layers=i.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=i.index,this.projection=i.projection,this.hasPattern=!1,this.hasZOffset=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(a=>{this.gradients[a.id]={}}),this.layoutVertexArray=new Rd,this.layoutVertexArray2=new So,this.patternVertexArray=new So,this.indexArray=new Gr,this.programConfigurations=new Yl(i.layers,{zoom:i.zoom,lut:i.lut}),this.segments=new $n,this.maxLineLength=0,this.zOffsetVertexArray=new So,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.tessellationStep=i.tessellationStep?i.tessellationStep:Pt/64}updateFootprints(i,a){}populate(i,a,u,m){this.hasPattern=Tw("line",this.layers,this.pixelRatio,a);const h=this.layers[0].layout.get("line-sort-key");this.tileToMeter=r(u);const g=this.layers[0].layout.get("line-z-offset"),b=g.isConstant()&&!g.constantOr(0),E=this.layers[0].layout.get("line-elevation-reference");this.hasZOffset=E==="sea"||E==="ground"||!b&&E==="none",this.hasZOffset&&E==="none"&&yi(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`);const R=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.hasZOffset&&R!==void 0;const v=[];for(const{feature:I,id:D,index:k,sourceLayerIndex:F}of i){const q=this.layers[0]._featureFilter.needGeometry,H=B(I,q);if(!this.layers[0]._featureFilter.filter(new vn(this.zoom),H,u))continue;const U=h?h.evaluate(H,{},u):void 0,$={id:D,properties:I.properties,type:I.type,sourceLayerIndex:F,index:k,geometry:q?H.geometry:O(I,u,m),patterns:{},sortKey:U};v.push($)}h&&v.sort((I,D)=>I.sortKey-D.sortKey);const{lineAtlas:S,featureIndex:C}=a,T=this.addConstantDashes(S);for(const I of v){const{geometry:D,index:k,sourceLayerIndex:F}=I;if(T&&this.addFeatureDashes(I,S),this.hasPattern){const q=Ew("line",this.layers,I,this.zoom,this.pixelRatio,a);this.patternFeatures.push(q)}else this.addFeature(I,D,k,u,S.positions,a.availableImages,a.brightness);C.insert(i[k].feature,D,k,F,this.index)}}addConstantDashes(i){let a=!1;for(const u of this.layers){const m=u.paint.get("line-dasharray").value,h=u.layout.get("line-cap").value;if(m.kind!=="constant"||h.kind!=="constant")a=!0;else{const g=h.value,b=m.value;if(!b)continue;i.addDash(b,g)}}return a}addFeatureDashes(i,a){const u=this.zoom;for(const m of this.layers){const h=m.paint.get("line-dasharray").value,g=m.layout.get("line-cap").value;if(h.kind==="constant"&&g.kind==="constant")continue;let b,E;if(h.kind==="constant"){if(b=h.value,!b)continue}else b=h.evaluate({zoom:u},i);E=g.kind==="constant"?g.value:g.evaluate({zoom:u},i),a.addDash(b,E),i.patterns[m.id]=a.getKey(b,E)}}update(i,a,u,m,h,g,b){this.programConfigurations.updatePaintArrays(i,a,h,u,m,g,b)}addFeatures(i,a,u,m,h,g){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,a,u,m,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,jF)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=i.createVertexBuffer(this.patternVertexArray,GF)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=i.createVertexBuffer(this.zOffsetVertexArray,BF.members,!0)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,VF),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(i){if(i.properties&&i.properties.hasOwnProperty("mapbox_clip_start")&&i.properties.hasOwnProperty("mapbox_clip_end"))return{start:+i.properties.mapbox_clip_start,end:+i.properties.mapbox_clip_end}}addFeature(i,a,u,m,h,g,b){const E=this.layers[0].layout,R=E.get("line-join").evaluate(i,{}),v=E.get("line-cap").evaluate(i,{}),S=E.get("line-miter-limit"),C=E.get("line-round-limit");this.lineClips=this.lineFeatureClips(i),this.lineFeature=i,this.zOffsetValue=E.get("line-z-offset").value;const T=this.layers[0].paint.get("line-width").value;T.kind!=="constant"&&T.isLineProgressConstant===!1&&(this.variableWidthValue=T);for(const I of a)this.addLine(I,i,m,R,v,S,C);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,u,h,g,m,b)}addLine(i,a,u,m,h,g,b){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const E=m==="none";if(this.patternJoinNone=this.hasPattern&&E,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let H=0;H<i.length-1;H++)this.totalDistance+=i[H].dist(i[H+1]);this.totalFeatureLength=this.totalDistance/(this.lineClips.end-this.lineClips.start),this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const R=HF[a.type]==="Polygon";let v=i.length;for(;v>=2&&i[v-1].equals(i[v-2]);)v--;let S=0;for(;S<v-1&&i[S].equals(i[S+1]);)S++;if(v<(R?3:2))return;m==="bevel"&&(g=1.05);const C=this.segments.prepareSegment(10*v,this.layoutVertexArray,this.indexArray);let T,I,D,k,F,q;this.e1=this.e2=-1,R&&(T=i[v-2],F=i[S].sub(T)._unit()._perp());for(let H=S;H<v;H++){if(D=H===v-1?R?i[S+1]:void 0:i[H+1],D&&i[H].equals(D))continue;F&&(k=F),T&&(I=T),T=i[H],q=this.evaluateLineProgressFeatures(I?I.dist(T):0),F=D?D.sub(T)._unit()._perp():k,k=k||F;const U=I&&D;let $=U?m:R||E?"butt":h;const Y=k.x*F.x+k.y*F.y;if(E){const ze=function(Pe){if(Pe.patternJoinNone){const Ne=Pe.segmentPoints.length/2,qe=Pe.lineSoFar-Pe.segmentStart;for(let Ze=0;Ze<Ne;++Ze){const Be=Pe.segmentPoints[2*Ze+1],ct=Math.round(Pe.segmentPoints[2*Ze])+.5+.25*Be;Pe.patternVertexArray.emplaceBack(ct,qe,Pe.segmentStart),Pe.patternVertexArray.emplaceBack(ct,qe,Pe.segmentStart)}Pe.segmentPoints.length=0}Pe.e1=Pe.e2=-1};if(U&&Y<ZF){this.updateDistance(I,T),this.addCurrentVertex(T,k,1,1,C,q),ze(this),this.addCurrentVertex(T,F,-1,-1,C,q);continue}if(I){if(!D){this.updateDistance(I,T),this.addCurrentVertex(T,k,1,1,C,q),ze(this);continue}$="miter"}}let ie=k.add(F);ie.x===0&&ie.y===0||ie._unit();const he=ie.x*F.x+ie.y*F.y,ue=he!==0?1/he:1/0,ce=2*Math.sqrt(2-2*he),Ie=he<$F&&I&&D,de=k.x*F.y-k.y*F.x>0,Me=this.overscaling<=16?15*Pt/(512*this.overscaling):0;if(U&&$==="round"){if(ue<b)$="miter";else if(ue<=2){const ze=kw(T,-10,Pt+10);$=this.hasZOffset&&(ze||this.hasCrossSlope)?"miter":"fakeround"}}if($==="miter"&&ue>g&&($="bevel"),$==="bevel"&&(ue>2&&($="flipbevel"),ue<g&&($="miter")),I&&!($==="miter"&&Ie)&&this.updateDistance(I,T),$==="miter")if(Ie){const ze=T.dist(I);if(ze>2*Me){const Ne=T.sub(T.sub(I)._mult(Me/ze)._round());this.updateDistance(I,Ne),this.addCurrentVertex(Ne,k,0,0,C,q),I=Ne}this.updateDistance(I,T),ie._mult(ue),this.addCurrentVertex(T,ie,0,0,C,q);const Pe=T.dist(D);if(Pe>2*Me){const Ne=T.add(D.sub(T)._mult(Me/Pe)._round());this.updateDistance(T,Ne),this.addCurrentVertex(Ne,F,0,0,C,q),T=Ne}}else ie._mult(ue),this.addCurrentVertex(T,ie,0,0,C,q);else if($==="flipbevel"){if(ue>100)ie=F.mult(-1);else{const ze=ue*k.add(F).mag()/k.sub(F).mag();ie._perp()._mult(ze*(de?-1:1))}this.addCurrentVertex(T,ie,0,0,C,q),this.addCurrentVertex(T,ie.mult(-1),0,0,C,q)}else if($==="bevel"||$==="fakeround"){q!=null&&I&&this.addCurrentVertex(T,k,-1,-1,C,q);const ze=T.dist(I)<=2*Me&&$!=="bevel",Pe=ie.mult(de?1:-1);Pe._mult(ue);const Ne=F.mult(de?-1:1),qe=k.mult(de?-1:1),Ze=this.evaluateLineProgressFeatures(this.distance);if(q==null&&(this.addHalfVertex(T,Pe.x,Pe.y,!1,!de,0,C,Ze),ze||this.addHalfVertex(T,Pe.x+2*qe.x,Pe.y+2*qe.y,!1,de,0,C,Ze)),$==="fakeround"){const Be=Math.round(180*ce/Math.PI/20);this.addHalfVertex(T,qe.x,qe.y,!1,de,0,C,Ze);for(let ct=0;ct<Be;ct++){let yt=ct/Be;if(yt!==.5){const Lt=yt-.5;yt+=yt*Lt*(yt-1)*((1.0904+Y*(Y*(3.55645-1.43519*Y)-3.2452))*Lt*Lt+(.848013+Y*(.215638*Y-1.06021)))}const lt=Ne.sub(qe)._mult(yt)._add(qe)._unit();this.addHalfVertex(T,lt.x,lt.y,!1,de,0,C,Ze)}this.addHalfVertex(T,Ne.x,Ne.y,!1,de,0,C,Ze)}ze||q!=null||this.addHalfVertex(T,Pe.x+2*Ne.x,Pe.y+2*Ne.y,!1,de,0,C,Ze),q!=null&&D&&this.addCurrentVertex(T,F,1,1,C,q)}else $==="butt"?this.addCurrentVertex(T,ie,0,0,C,q):$==="square"?(I||this.addCurrentVertex(T,ie,-1,-1,C,q),this.addCurrentVertex(T,ie,0,0,C,q),I&&this.addCurrentVertex(T,ie,1,1,C,q)):$==="round"&&(I&&(this.addCurrentVertex(T,k,0,0,C,q),this.addCurrentVertex(T,k,1,1,C,q,!0)),D&&(this.addCurrentVertex(T,F,-1,-1,C,q,!0),this.addCurrentVertex(T,F,0,0,C,q)))}}addVerticesTo(i,a,u,m,h,g,b,E,R,v){const S=(a.w-i.w)/this.tessellationStep|0;let C=0;const T=this.scaledDistance;if(S>1){this.lineSoFar=i.w;const D=(a.x-i.x)/S,k=(a.y-i.y)/S,F=(a.z-i.z)/S,q=(a.w-i.w)/S;for(let H=1;H<S;++H){i.x+=D,i.y+=k,i.z+=F,this.lineSoFar+=q,C+=q;const U=this.evaluateLineProgressFeatures(this.prevDistance+C);this.scaledDistance=(this.prevDistance+C)/this.totalDistance,this.addHalfVertex(i,u,m,v,!1,b,R,U),this.addHalfVertex(i,h,g,v,!0,-E,R,U)}}this.lineSoFar=a.w,this.scaledDistance=T;const I=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(a,u,m,v,!1,b,R,I),this.addHalfVertex(a,h,g,v,!0,-E,R,I)}evaluateLineProgressFeatures(i){if(!this.variableWidthValue&&!this.hasZOffset)return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+i)/this.totalFeatureLength):yi(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let a=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(a=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.hasZOffset?this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:a}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:a}:{zOffset:0,variableWidth:a}}addCurrentVertex(i,a,u,m,h,g,b=!1){const E=a.x+a.y*u,R=a.y-a.x*u,v=a.y*m-a.x,S=-a.y-a.x*m;if(g!=null){const C=this.hasZOffset,T=-10,I=Pt+10,D=g.zOffset,k=new zI(i.x,i.y,D,this.lineSoFar),F=!!C&&kw(i,T,I),q=this.lineSoFar,H=this.distance;if(this.currentVertex)if(F){const U=this.currentVertexIsOutside,$=this.currentVertex,Y=new zI(i.x,i.y,D,this.lineSoFar);if(kI($,Y,T,I),!kw(Y,T,I)){if(U){this.e1=this.e2=-1,this.distance-=$.dist(k),this.lineSoFar=$.w;const ie=this.evaluateLineProgressFeatures($.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex($,E,R,b,!1,u,h,ie),this.addHalfVertex($,v,S,b,!0,-m,h,ie),this.prevDistance=this.distance}this.distance=this.prevDistance+$.dist(Y),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo($,Y,E,R,v,S,u,m,h,b),this.distance=H,this.scaledDistance=this.distance/this.totalDistance}}else{const U=this.currentVertex;if(this.currentVertexIsOutside){kI(U,k,T,I),this.e1=this.e2=-1,this.distance-=U.dist(k),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=U.w;const $=this.evaluateLineProgressFeatures(U.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(U,E,R,b,!1,u,h,$),this.addHalfVertex(U,v,S,b,!0,-m,h,$),this.prevDistance=this.distance,this.distance=H,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(U,k,E,R,v,S,u,m,h,b)}else F||(this.addHalfVertex(i,E,R,b,!1,u,h,g),this.addHalfVertex(i,v,S,b,!0,-m,h,g));this.currentVertex=k,this.currentVertexIsOutside=F,this.lineSoFar=q}else this.addHalfVertex(i,E,R,b,!1,u,h,g),this.addHalfVertex(i,v,S,b,!0,-m,h,g)}addHalfVertex({x:i,y:a},u,m,h,g,b,E,R){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),g||this.segmentPoints.push(this.lineSoFar-this.segmentStart,b)),this.layoutVertexArray.emplaceBack((i<<1)+(h?1:0),(a<<1)+(g?1:0),Math.round(63*u)+128,Math.round(63*m)+128,1+(b===0?0:b<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const S=ei(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,S)}const v=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,v),E.primitiveLength++),g?this.e2=v:this.e1=v,R!=null&&this.zOffsetVertexArray.emplaceBack(R.zOffset,R.variableWidth,R.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(i,a){this.prevDistance=this.distance,this.distance+=i.dist(a),this.updateScaledDistance()}}function kw(c,i,a){return c.x<i||c.x>a||c.y<i||c.y>a}let cM,uM;function hM(c,i,a){return i*(Pt/(c.tileSize*Math.pow(2,a-c.tileID.overscaledZ)))}Gt(Ow,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const dM=(c,i,a)=>(1-a)*c+a*i;function fM(c,i){return 1/hM(c,1,i.tileZoom)}function pM(c,i,a,u){return c.translatePosMatrix(u||i.tileID.projMatrix,i,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}const mM=c=>{const i=[];gM(c)&&i.push("RENDER_LINE_DASH"),c.paint.get("line-gradient")&&i.push("RENDER_LINE_GRADIENT");const a=c.paint.get("line-trim-offset");a[0]===0&&a[1]===0||i.push("RENDER_LINE_TRIM_OFFSET"),c.paint.get("line-border-width").constantOr(1)!==0&&i.push("RENDER_LINE_BORDER");const u=c.layout.get("line-join").constantOr("miter")==="none",m=!!c.paint.get("line-pattern").constantOr(1);return u&&m&&i.push("LINE_JOIN_NONE"),i};function gM(c){const i=c.paint.get("line-dasharray").value;return i.value||i.kind!=="constant"}let Nw;const _M=()=>Nw||(Nw={layout:cM||(cM=new zn({"line-cap":new kt(Qe.layout_line["line-cap"]),"line-join":new kt(Qe.layout_line["line-join"]),"line-miter-limit":new Et(Qe.layout_line["line-miter-limit"]),"line-round-limit":new Et(Qe.layout_line["line-round-limit"]),"line-sort-key":new kt(Qe.layout_line["line-sort-key"]),"line-z-offset":new kt(Qe.layout_line["line-z-offset"]),"line-elevation-reference":new Et(Qe.layout_line["line-elevation-reference"]),"line-cross-slope":new Et(Qe.layout_line["line-cross-slope"]),visibility:new Et(Qe.layout_line.visibility),"line-width-unit":new Et(Qe.layout_line["line-width-unit"])})),paint:uM||(uM=new zn({"line-opacity":new kt(Qe.paint_line["line-opacity"]),"line-color":new kt(Qe.paint_line["line-color"]),"line-translate":new Et(Qe.paint_line["line-translate"]),"line-translate-anchor":new Et(Qe.paint_line["line-translate-anchor"]),"line-width":new kt(Qe.paint_line["line-width"]),"line-gap-width":new kt(Qe.paint_line["line-gap-width"]),"line-offset":new kt(Qe.paint_line["line-offset"]),"line-blur":new kt(Qe.paint_line["line-blur"]),"line-dasharray":new kt(Qe.paint_line["line-dasharray"]),"line-pattern":new kt(Qe.paint_line["line-pattern"]),"line-gradient":new Gu(Qe.paint_line["line-gradient"]),"line-trim-offset":new Et(Qe.paint_line["line-trim-offset"]),"line-trim-fade-range":new Et(Qe.paint_line["line-trim-fade-range"]),"line-trim-color":new Et(Qe.paint_line["line-trim-color"]),"line-emissive-strength":new Et(Qe.paint_line["line-emissive-strength"]),"line-border-width":new kt(Qe.paint_line["line-border-width"]),"line-border-color":new kt(Qe.paint_line["line-border-color"]),"line-occlusion-opacity":new Et(Qe.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},Nw);class WF extends kt{possiblyEvaluate(i,a){return a=new vn(Math.floor(a.zoom),{now:a.now,fadeDuration:a.fadeDuration,transition:a.transition}),super.possiblyEvaluate(i,a)}evaluate(i,a,u,m){return a=Sn({},a,{zoom:Math.floor(a.zoom)}),super.evaluate(i,a,u,m)}}let p_;function yM(c,i){return i>0?i+2*c:c}const XF=Xi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),YF=Xi([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),KF=Xi([{name:"a_projected_pos",components:4,type:"Float32"}],4);Xi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const QF=Xi([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),JF=Xi([{name:"a_texb",components:2,type:"Uint16"}]),e5=Xi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),t5=Xi([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Xi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const vM=Xi([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),i5=Xi([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Xi([{name:"triangle",components:3,type:"Uint16"}]),Xi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Xi([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),Xi([{type:"Float32",name:"offsetX"}]),Xi([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var fs=24;const dl=128;function Fw(c,i,a,u,m){if(c.kind==="camera")return c.maxSize;if(c.kind==="composite"){const h=i.possiblyEvaluate(new vn(c.maxZoom),a).evaluate(m,{},a),g=i.possiblyEvaluate(new vn(c.minZoom),a).evaluate(m,{},a);return Math.max(h,g)}return i.possiblyEvaluate(new vn(u)).evaluate(m,{},a)}function Bw(c,i){const{expression:a}=i;if(a.kind==="constant")return{kind:"constant",layoutSize:a.evaluate(new vn(c+1))};if(a.kind==="source")return{kind:"source"};{const{zoomStops:u,interpolationType:m}=a;let h=0;for(;h<u.length&&u[h]<=c;)h++;h=Math.max(0,h-1);let g=h;for(;g<u.length&&u[g]<c+1;)g++;g=Math.min(u.length-1,g);const b=u[h],E=u[g];return a.kind==="composite"?{kind:"composite",minZoom:b,maxZoom:E,interpolationType:m}:{kind:"camera",minZoom:b,maxZoom:E,minSize:a.evaluate(new vn(b)),maxSize:a.evaluate(new vn(E)),interpolationType:m}}}function Ev(c,{uSize:i,uSizeT:a},{lowerSize:u,upperSize:m}){return c.kind==="source"?u/dl:c.kind==="composite"?ei(u/dl,m/dl,a):i}function Sp(c,i,a=1){let u=0,m=0;if(c.kind==="constant")m=c.layoutSize*a;else if(c.kind!=="source"){const{interpolationType:h,minZoom:g,maxZoom:b}=c,E=h?bi(ta.interpolationFactor(h,i,g,b),0,1):0;c.kind==="camera"?m=ei(c.minSize,c.maxSize,E)*a:u=E*a}return{uSizeT:u,uSize:m}}var n5=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:dl,evaluateSizeForFeature:Ev,evaluateSizeForZoom:Sp,getRasterizedIconSize:Fw,getSizeData:Bw});function r5(c,i,a){return c.sections.forEach(u=>{u.text=function(m,h,g){const b=h.layout.get("text-transform").evaluate(g,{});return b==="uppercase"?m=m.toLocaleUpperCase():b==="lowercase"&&(m=m.toLocaleLowerCase()),xa.applyArabicShaping&&(m=xa.applyArabicShaping(m)),m}(u.text,i,a)}),c}const m_={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function s5(c){return c==="︶"||c==="﹈"||c==="︸"||c==="﹄"||c==="﹂"||c==="︾"||c==="︼"||c==="︺"||c==="︘"||c==="﹀"||c==="︐"||c==="︓"||c==="︔"||c==="｀"||c==="￣"||c==="︑"||c==="︒"}function a5(c){return c==="︵"||c==="﹇"||c==="︷"||c==="﹃"||c==="﹁"||c==="︽"||c==="︻"||c==="︹"||c==="︗"||c==="︿"}var xM,Vw,bM,Uw={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function o5(){return xM||(xM=1,Uw.read=function(c,i,a,u,m){var h,g,b=8*m-u-1,E=(1<<b)-1,R=E>>1,v=-7,S=a?m-1:0,C=a?-1:1,T=c[i+S];for(S+=C,h=T&(1<<-v)-1,T>>=-v,v+=b;v>0;h=256*h+c[i+S],S+=C,v-=8);for(g=h&(1<<-v)-1,h>>=-v,v+=u;v>0;g=256*g+c[i+S],S+=C,v-=8);if(h===0)h=1-R;else{if(h===E)return g?NaN:1/0*(T?-1:1);g+=Math.pow(2,u),h-=R}return(T?-1:1)*g*Math.pow(2,h-u)},Uw.write=function(c,i,a,u,m,h){var g,b,E,R=8*h-m-1,v=(1<<R)-1,S=v>>1,C=m===23?Math.pow(2,-24)-Math.pow(2,-77):0,T=u?0:h-1,I=u?1:-1,D=i<0||i===0&&1/i<0?1:0;for(i=Math.abs(i),isNaN(i)||i===1/0?(b=isNaN(i)?1:0,g=v):(g=Math.floor(Math.log(i)/Math.LN2),i*(E=Math.pow(2,-g))<1&&(g--,E*=2),(i+=g+S>=1?C/E:C*Math.pow(2,1-S))*E>=2&&(g++,E/=2),g+S>=v?(b=0,g=v):g+S>=1?(b=(i*E-1)*Math.pow(2,m),g+=S):(b=i*Math.pow(2,S-1)*Math.pow(2,m),g=0));m>=8;c[a+T]=255&b,T+=I,b/=256,m-=8);for(g=g<<m|b,R+=m;R>0;c[a+T]=255&g,T+=I,g/=256,R-=8);c[a+T-I]|=128*D}),Uw}function wM(){if(bM)return Vw;bM=1,Vw=i;var c=o5();function i(U){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(U)?U:new Uint8Array(U||0),this.pos=0,this.type=0,this.length=this.buf.length}i.Varint=0,i.Fixed64=1,i.Bytes=2,i.Fixed32=5;var a=4294967296,u=1/a,m=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function h(U){return U.type===i.Bytes?U.readVarint()+U.pos:U.pos+1}function g(U,$,Y){return Y?4294967296*$+(U>>>0):4294967296*($>>>0)+(U>>>0)}function b(U,$,Y){var ie=$<=16383?1:$<=2097151?2:$<=268435455?3:Math.floor(Math.log($)/(7*Math.LN2));Y.realloc(ie);for(var he=Y.pos-1;he>=U;he--)Y.buf[he+ie]=Y.buf[he]}function E(U,$){for(var Y=0;Y<U.length;Y++)$.writeVarint(U[Y])}function R(U,$){for(var Y=0;Y<U.length;Y++)$.writeSVarint(U[Y])}function v(U,$){for(var Y=0;Y<U.length;Y++)$.writeFloat(U[Y])}function S(U,$){for(var Y=0;Y<U.length;Y++)$.writeDouble(U[Y])}function C(U,$){for(var Y=0;Y<U.length;Y++)$.writeBoolean(U[Y])}function T(U,$){for(var Y=0;Y<U.length;Y++)$.writeFixed32(U[Y])}function I(U,$){for(var Y=0;Y<U.length;Y++)$.writeSFixed32(U[Y])}function D(U,$){for(var Y=0;Y<U.length;Y++)$.writeFixed64(U[Y])}function k(U,$){for(var Y=0;Y<U.length;Y++)$.writeSFixed64(U[Y])}function F(U,$){return(U[$]|U[$+1]<<8|U[$+2]<<16)+16777216*U[$+3]}function q(U,$,Y){U[Y]=$,U[Y+1]=$>>>8,U[Y+2]=$>>>16,U[Y+3]=$>>>24}function H(U,$){return(U[$]|U[$+1]<<8|U[$+2]<<16)+(U[$+3]<<24)}return i.prototype={destroy:function(){this.buf=null},readFields:function(U,$,Y){for(Y=Y||this.length;this.pos<Y;){var ie=this.readVarint(),he=ie>>3,ue=this.pos;this.type=7&ie,U(he,$,this),this.pos===ue&&this.skip(ie)}return $},readMessage:function(U,$){return this.readFields(U,$,this.readVarint()+this.pos)},readFixed32:function(){var U=F(this.buf,this.pos);return this.pos+=4,U},readSFixed32:function(){var U=H(this.buf,this.pos);return this.pos+=4,U},readFixed64:function(){var U=F(this.buf,this.pos)+F(this.buf,this.pos+4)*a;return this.pos+=8,U},readSFixed64:function(){var U=F(this.buf,this.pos)+H(this.buf,this.pos+4)*a;return this.pos+=8,U},readFloat:function(){var U=c.read(this.buf,this.pos,!0,23,4);return this.pos+=4,U},readDouble:function(){var U=c.read(this.buf,this.pos,!0,52,8);return this.pos+=8,U},readVarint:function(U){var $,Y,ie=this.buf;return $=127&(Y=ie[this.pos++]),Y<128?$:($|=(127&(Y=ie[this.pos++]))<<7,Y<128?$:($|=(127&(Y=ie[this.pos++]))<<14,Y<128?$:($|=(127&(Y=ie[this.pos++]))<<21,Y<128?$:function(he,ue,ce){var Ie,de,Me=ce.buf;if(Ie=(112&(de=Me[ce.pos++]))>>4,de<128||(Ie|=(127&(de=Me[ce.pos++]))<<3,de<128)||(Ie|=(127&(de=Me[ce.pos++]))<<10,de<128)||(Ie|=(127&(de=Me[ce.pos++]))<<17,de<128)||(Ie|=(127&(de=Me[ce.pos++]))<<24,de<128)||(Ie|=(1&(de=Me[ce.pos++]))<<31,de<128))return g(he,Ie,ue);throw new Error("Expected varint not more than 10 bytes")}($|=(15&(Y=ie[this.pos]))<<28,U,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var U=this.readVarint();return U%2==1?(U+1)/-2:U/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var U=this.readVarint()+this.pos,$=this.pos;return this.pos=U,U-$>=12&&m?function(Y,ie,he){return m.decode(Y.subarray(ie,he))}(this.buf,$,U):function(Y,ie,he){for(var ue="",ce=ie;ce<he;){var Ie,de,Me,ze=Y[ce],Pe=null,Ne=ze>239?4:ze>223?3:ze>191?2:1;if(ce+Ne>he)break;Ne===1?ze<128&&(Pe=ze):Ne===2?(192&(Ie=Y[ce+1]))==128&&(Pe=(31&ze)<<6|63&Ie)<=127&&(Pe=null):Ne===3?(de=Y[ce+2],(192&(Ie=Y[ce+1]))==128&&(192&de)==128&&((Pe=(15&ze)<<12|(63&Ie)<<6|63&de)<=2047||Pe>=55296&&Pe<=57343)&&(Pe=null)):Ne===4&&(de=Y[ce+2],Me=Y[ce+3],(192&(Ie=Y[ce+1]))==128&&(192&de)==128&&(192&Me)==128&&((Pe=(15&ze)<<18|(63&Ie)<<12|(63&de)<<6|63&Me)<=65535||Pe>=1114112)&&(Pe=null)),Pe===null?(Pe=65533,Ne=1):Pe>65535&&(Pe-=65536,ue+=String.fromCharCode(Pe>>>10&1023|55296),Pe=56320|1023&Pe),ue+=String.fromCharCode(Pe),ce+=Ne}return ue}(this.buf,$,U)},readBytes:function(){var U=this.readVarint()+this.pos,$=this.buf.subarray(this.pos,U);return this.pos=U,$},readPackedVarint:function(U,$){if(this.type!==i.Bytes)return U.push(this.readVarint($));var Y=h(this);for(U=U||[];this.pos<Y;)U.push(this.readVarint($));return U},readPackedSVarint:function(U){if(this.type!==i.Bytes)return U.push(this.readSVarint());var $=h(this);for(U=U||[];this.pos<$;)U.push(this.readSVarint());return U},readPackedBoolean:function(U){if(this.type!==i.Bytes)return U.push(this.readBoolean());var $=h(this);for(U=U||[];this.pos<$;)U.push(this.readBoolean());return U},readPackedFloat:function(U){if(this.type!==i.Bytes)return U.push(this.readFloat());var $=h(this);for(U=U||[];this.pos<$;)U.push(this.readFloat());return U},readPackedDouble:function(U){if(this.type!==i.Bytes)return U.push(this.readDouble());var $=h(this);for(U=U||[];this.pos<$;)U.push(this.readDouble());return U},readPackedFixed32:function(U){if(this.type!==i.Bytes)return U.push(this.readFixed32());var $=h(this);for(U=U||[];this.pos<$;)U.push(this.readFixed32());return U},readPackedSFixed32:function(U){if(this.type!==i.Bytes)return U.push(this.readSFixed32());var $=h(this);for(U=U||[];this.pos<$;)U.push(this.readSFixed32());return U},readPackedFixed64:function(U){if(this.type!==i.Bytes)return U.push(this.readFixed64());var $=h(this);for(U=U||[];this.pos<$;)U.push(this.readFixed64());return U},readPackedSFixed64:function(U){if(this.type!==i.Bytes)return U.push(this.readSFixed64());var $=h(this);for(U=U||[];this.pos<$;)U.push(this.readSFixed64());return U},skip:function(U){var $=7&U;if($===i.Varint)for(;this.buf[this.pos++]>127;);else if($===i.Bytes)this.pos=this.readVarint()+this.pos;else if($===i.Fixed32)this.pos+=4;else{if($!==i.Fixed64)throw new Error("Unimplemented type: "+$);this.pos+=8}},writeTag:function(U,$){this.writeVarint(U<<3|$)},realloc:function(U){for(var $=this.length||16;$<this.pos+U;)$*=2;if($!==this.length){var Y=new Uint8Array($);Y.set(this.buf),this.buf=Y,this.length=$}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(U){this.realloc(4),q(this.buf,U,this.pos),this.pos+=4},writeSFixed32:function(U){this.realloc(4),q(this.buf,U,this.pos),this.pos+=4},writeFixed64:function(U){this.realloc(8),q(this.buf,-1&U,this.pos),q(this.buf,Math.floor(U*u),this.pos+4),this.pos+=8},writeSFixed64:function(U){this.realloc(8),q(this.buf,-1&U,this.pos),q(this.buf,Math.floor(U*u),this.pos+4),this.pos+=8},writeVarint:function(U){(U=+U||0)>268435455||U<0?function($,Y){var ie,he;if($>=0?(ie=$%4294967296|0,he=$/4294967296|0):(he=~(-$/4294967296),4294967295^(ie=~(-$%4294967296))?ie=ie+1|0:(ie=0,he=he+1|0)),$>=18446744073709552e3||$<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");Y.realloc(10),function(ue,ce,Ie){Ie.buf[Ie.pos++]=127&ue|128,ue>>>=7,Ie.buf[Ie.pos++]=127&ue|128,ue>>>=7,Ie.buf[Ie.pos++]=127&ue|128,ue>>>=7,Ie.buf[Ie.pos++]=127&ue|128,Ie.buf[Ie.pos]=127&(ue>>>=7)}(ie,0,Y),function(ue,ce){var Ie=(7&ue)<<4;ce.buf[ce.pos++]|=Ie|((ue>>>=3)?128:0),ue&&(ce.buf[ce.pos++]=127&ue|((ue>>>=7)?128:0),ue&&(ce.buf[ce.pos++]=127&ue|((ue>>>=7)?128:0),ue&&(ce.buf[ce.pos++]=127&ue|((ue>>>=7)?128:0),ue&&(ce.buf[ce.pos++]=127&ue|((ue>>>=7)?128:0),ue&&(ce.buf[ce.pos++]=127&ue)))))}(he,Y)}(U,this):(this.realloc(4),this.buf[this.pos++]=127&U|(U>127?128:0),U<=127||(this.buf[this.pos++]=127&(U>>>=7)|(U>127?128:0),U<=127||(this.buf[this.pos++]=127&(U>>>=7)|(U>127?128:0),U<=127||(this.buf[this.pos++]=U>>>7&127))))},writeSVarint:function(U){this.writeVarint(U<0?2*-U-1:2*U)},writeBoolean:function(U){this.writeVarint(!!U)},writeString:function(U){U=String(U),this.realloc(4*U.length),this.pos++;var $=this.pos;this.pos=function(ie,he,ue){for(var ce,Ie,de=0;de<he.length;de++){if((ce=he.charCodeAt(de))>55295&&ce<57344){if(!Ie){ce>56319||de+1===he.length?(ie[ue++]=239,ie[ue++]=191,ie[ue++]=189):Ie=ce;continue}if(ce<56320){ie[ue++]=239,ie[ue++]=191,ie[ue++]=189,Ie=ce;continue}ce=Ie-55296<<10|ce-56320|65536,Ie=null}else Ie&&(ie[ue++]=239,ie[ue++]=191,ie[ue++]=189,Ie=null);ce<128?ie[ue++]=ce:(ce<2048?ie[ue++]=ce>>6|192:(ce<65536?ie[ue++]=ce>>12|224:(ie[ue++]=ce>>18|240,ie[ue++]=ce>>12&63|128),ie[ue++]=ce>>6&63|128),ie[ue++]=63&ce|128)}return ue}(this.buf,U,this.pos);var Y=this.pos-$;Y>=128&&b($,Y,this),this.pos=$-1,this.writeVarint(Y),this.pos+=Y},writeFloat:function(U){this.realloc(4),c.write(this.buf,U,this.pos,!0,23,4),this.pos+=4},writeDouble:function(U){this.realloc(8),c.write(this.buf,U,this.pos,!0,52,8),this.pos+=8},writeBytes:function(U){var $=U.length;this.writeVarint($),this.realloc($);for(var Y=0;Y<$;Y++)this.buf[this.pos++]=U[Y]},writeRawMessage:function(U,$){this.pos++;var Y=this.pos;U($,this);var ie=this.pos-Y;ie>=128&&b(Y,ie,this),this.pos=Y-1,this.writeVarint(ie),this.pos+=ie},writeMessage:function(U,$,Y){this.writeTag(U,i.Bytes),this.writeRawMessage($,Y)},writePackedVarint:function(U,$){$.length&&this.writeMessage(U,E,$)},writePackedSVarint:function(U,$){$.length&&this.writeMessage(U,R,$)},writePackedBoolean:function(U,$){$.length&&this.writeMessage(U,C,$)},writePackedFloat:function(U,$){$.length&&this.writeMessage(U,v,$)},writePackedDouble:function(U,$){$.length&&this.writeMessage(U,S,$)},writePackedFixed32:function(U,$){$.length&&this.writeMessage(U,T,$)},writePackedSFixed32:function(U,$){$.length&&this.writeMessage(U,I,$)},writePackedFixed64:function(U,$){$.length&&this.writeMessage(U,D,$)},writePackedSFixed64:function(U,$){$.length&&this.writeMessage(U,k,$)},writeBytesField:function(U,$){this.writeTag(U,i.Bytes),this.writeBytes($)},writeFixed32Field:function(U,$){this.writeTag(U,i.Fixed32),this.writeFixed32($)},writeSFixed32Field:function(U,$){this.writeTag(U,i.Fixed32),this.writeSFixed32($)},writeFixed64Field:function(U,$){this.writeTag(U,i.Fixed64),this.writeFixed64($)},writeSFixed64Field:function(U,$){this.writeTag(U,i.Fixed64),this.writeSFixed64($)},writeVarintField:function(U,$){this.writeTag(U,i.Varint),this.writeVarint($)},writeSVarintField:function(U,$){this.writeTag(U,i.Varint),this.writeSVarint($)},writeStringField:function(U,$){this.writeTag(U,i.Bytes),this.writeString($)},writeFloatField:function(U,$){this.writeTag(U,i.Fixed32),this.writeFloat($)},writeDoubleField:function(U,$){this.writeTag(U,i.Fixed64),this.writeDouble($)},writeBooleanField:function(U,$){this.writeVarintField(U,!!$)}},Vw}var Sv=N(wM());const jw=3;function l5(c,i,a){i.glyphs=[],c===1&&a.readMessage(c5,i)}function c5(c,i,a){if(c===3){const{id:u,bitmap:m,width:h,height:g,left:b,top:E,advance:R}=a.readMessage(u5,{});i.glyphs.push({id:u,bitmap:new eh({width:h+2*jw,height:g+2*jw},m),metrics:{width:h,height:g,left:b,top:E,advance:R}})}else c===4?i.ascender=a.readSVarint():c===5&&(i.descender=a.readSVarint())}function u5(c,i,a){c===1?i.id=a.readVarint():c===2?i.bitmap=a.readBytes():c===3?i.width=a.readVarint():c===4?i.height=a.readVarint():c===5?i.left=a.readSVarint():c===6?i.top=a.readSVarint():c===7&&(i.advance=a.readVarint())}const TM=jw,no={horizontal:1,vertical:2,horizontalOnly:3};class g_{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(i,a){const u=new g_;return u.scale=i||1,u.fontStack=a,u}static forImage(i){const a=new g_;return a.image=i,a}}class Ap{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(i,a){const u=new Ap;for(let m=0;m<i.sections.length;m++){const h=i.sections[m];h.image?u.addImageSection(h):u.addTextSection(h,a)}return u}length(){return this.text.length}getSection(i){return this.sections[this.sectionIndex[i]]}getSections(){return this.sections}getSectionIndex(i){return this.sectionIndex[i]}getCodePoint(i){return this.text.codePointAt(i)}verticalizePunctuation(i){this.text=function(a,u){let m="";for(let h=0;h<a.length;h++){const g=a.charCodeAt(h+1)||null,b=a.charCodeAt(h-1)||null;m+=!u&&(g&&Rg(g)&&!m_[a[h+1]]||b&&Rg(b)&&!m_[a[h-1]])||!m_[a[h]]?a[h]:m_[a[h]]}return m}(this.text,i)}trim(){let i=0;for(let u=0;u<this.text.length&&Av[this.text.charCodeAt(u)];u++)i++;let a=this.text.length;for(let u=this.text.length-1;u>=0&&u>=i&&Av[this.text.charCodeAt(u)];u--)a--;this.text=this.text.substring(i,a),this.sectionIndex=this.sectionIndex.slice(i,a)}substring(i,a){const u=new Ap;return u.text=this.text.substring(i,a),u.sectionIndex=this.sectionIndex.slice(i,a),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((i,a)=>Math.max(i,this.sections[a].scale),0)}addTextSection(i,a){this.text+=i.text,this.sections.push(g_.forText(i.scale,i.fontStack||a));const u=this.sections.length-1;for(let m=0;m<i.text.length;++m)this.sectionIndex.push(u)}addImageSection(i){const a=i.image&&i.image.namePrimary?i.image.getPrimary():null;if(!a)return void yi("Can't add FormattedSection with an empty image.");const u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCodePoint(u),this.sections.push(g_.forImage(a)),this.sectionIndex.push(this.sections.length-1)):yi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function qw(c,i,a,u,m,h,g,b,E,R,v,S,C,T,I){const D=Ap.fromFeature(c,m);S===no.vertical&&D.verticalizePunctuation(C);let k=[];const F=function(Y,ie,he,ue,ce,Ie){if(!Y)return[];const de=[],Me=function(qe,Ze,Be,ct,yt,lt){let Lt=0;for(let Dt=0;Dt<qe.length();Dt++){const wt=qe.getSection(Dt);Lt+=EM(qe.getCodePoint(Dt),wt,ct,yt,Ze,lt)}return Lt/Math.max(1,Math.ceil(Lt/Be))}(Y,ie,he,ue,ce,Ie),ze=Y.text.indexOf("​")>=0;let Pe=0;for(let qe=0;qe<Y.length();qe++){const Ze=Y.getSection(qe),Be=Y.getCodePoint(qe);if(Av[Be]||(Pe+=EM(Be,Ze,ue,ce,ie,Ie)),qe<Y.length()-1){const ct=!((Ne=Be)<11904||!(Wt["Bopomofo Extended"](Ne)||Wt.Bopomofo(Ne)||Wt["CJK Compatibility Forms"](Ne)||Wt["CJK Compatibility Ideographs"](Ne)||Wt["CJK Compatibility"](Ne)||Wt["CJK Radicals Supplement"](Ne)||Wt["CJK Strokes"](Ne)||Wt["CJK Symbols and Punctuation"](Ne)||Wt["CJK Unified Ideographs Extension A"](Ne)||Wt["CJK Unified Ideographs"](Ne)||Wt["Enclosed CJK Letters and Months"](Ne)||Wt["Halfwidth and Fullwidth Forms"](Ne)||Wt.Hiragana(Ne)||Wt["Ideographic Description Characters"](Ne)||Wt["Kangxi Radicals"](Ne)||Wt["Katakana Phonetic Extensions"](Ne)||Wt.Katakana(Ne)||Wt["Vertical Forms"](Ne)||Wt["Yi Radicals"](Ne)||Wt["Yi Syllables"](Ne)));(h5[Be]||ct||Ze.image)&&de.push(AM(qe+1,Pe,Me,de,d5(Be,Y.getCodePoint(qe+1),ct&&ze),!1))}}var Ne;return IM(AM(Y.length(),Pe,Me,de,0,!0))}(D,R,h,i,u,T),{processBidirectionalText:q,processStyledBidirectionalText:H}=xa;if(q&&D.sections.length===1){const Y=q(D.toString(),F);for(const ie of Y){const he=new Ap;he.text=ie,he.sections=D.sections;for(let ue=0;ue<ie.length;ue++)he.sectionIndex.push(0);k.push(he)}}else if(H){const Y=H(D.text,D.sectionIndex,F);for(const ie of Y){const he=new Ap;he.text=ie[0],he.sectionIndex=ie[1],he.sections=D.sections,k.push(he)}}else k=function(Y,ie){const he=[],ue=Y.text;let ce=0;for(const Ie of ie)he.push(Y.substring(ce,Ie)),ce=Ie;return ce<ue.length&&he.push(Y.substring(ce,ue.length)),he}(D,F);const U=[],$={positionedLines:U,text:D.toString(),top:v[1],bottom:v[1],left:v[0],right:v[0],writingMode:S,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Y,ie,he,ue,ce,Ie,de,Me,ze,Pe,Ne,qe){let Ze=0,Be=0,ct=0;const yt=Me==="right"?1:Me==="left"?0:.5;let lt=!1;for(const zt of ce){const Ft=zt.getSections();for(const hi of Ft){if(hi.image)continue;const xi=ie[hi.fontStack];if(xi&&(lt=xi.ascender!==void 0&&xi.descender!==void 0,!lt))break}if(!lt)break}let Lt=0;for(const zt of ce){zt.trim();const Ft=zt.getMaxScale(),hi=(Ft-1)*fs,xi={positionedGlyphs:[],lineOffset:0};Y.positionedLines[Lt]=xi;const Ti=xi.positionedGlyphs;let Ei=0;if(!zt.length()){Be+=Ie,++Lt;continue}let Ci=0,Ri=0;for(let rn=0;rn<zt.length();rn++){const pi=zt.getSection(rn),Ji=zt.getSectionIndex(rn),tn=zt.getCodePoint(rn);let In=pi.scale,tr=null,mr=null,ir=null,jn=fs,ar=0;const wr=!(ze===no.horizontal||!Ne&&!np(tn)||Ne&&(Av[tn]||(Dt=tn,Wt.Arabic(Dt)||Wt["Arabic Supplement"](Dt)||Wt["Arabic Extended-A"](Dt)||Wt["Arabic Presentation Forms-A"](Dt)||Wt["Arabic Presentation Forms-B"](Dt))));if(pi.image){const ps=ue[pi.image.serialize()];if(!ps)continue;ir=pi.image.id,Y.iconsInText=Y.iconsInText||!0,mr=ps.paddedRect;const wn=ps.displaySize;In=In*fs/qe,tr={width:wn[0],height:wn[1],left:0,top:-TM,advance:wr?wn[1]:wn[0],localGlyph:!1},ar=lt?-tr.height*In:Ft*fs-17-wn[1]*In,jn=tr.advance;const Sa=(wr?wn[0]:wn[1])*In-fs*Ft;Sa>0&&Sa>Ei&&(Ei=Sa)}else{const ps=he[pi.fontStack];if(!ps)continue;ps[tn]&&(mr=ps[tn]);const wn=ie[pi.fontStack];if(!wn)continue;const Sa=wn.glyphs[tn];if(!Sa)continue;if(tr=Sa.metrics,jn=tn!==8203?fs:0,lt){const _l=wn.ascender!==void 0?Math.abs(wn.ascender):0,Po=wn.descender!==void 0?Math.abs(wn.descender):0,Lo=(_l+Po)*In;Ci<Lo&&(Ci=Lo,Ri=(_l-Po)/2*In),ar=-_l*In}else ar=(Ft-In)*fs-17}wr?(Y.verticalizable=!0,Ti.push({glyph:tn,imageName:ir,x:Ze,y:Be+ar,vertical:wr,scale:In,localGlyph:tr.localGlyph,fontStack:pi.fontStack,sectionIndex:Ji,metrics:tr,rect:mr}),Ze+=jn*In+Pe):(Ti.push({glyph:tn,imageName:ir,x:Ze,y:Be+ar,vertical:wr,scale:In,localGlyph:tr.localGlyph,fontStack:pi.fontStack,sectionIndex:Ji,metrics:tr,rect:mr}),Ze+=tr.advance*In+Pe)}Ti.length!==0&&(ct=Math.max(Ze-Pe,ct),lt?MM(Ti,yt,Ei,Ri,Ie*Ft/2):MM(Ti,yt,Ei,0,Ie/2)),Ze=0;const dn=Ie*Ft+Ei;xi.lineOffset=Math.max(Ei,hi),Be+=dn,++Lt}var Dt;const wt=Be,{horizontalAlign:vt,verticalAlign:Zt}=Gw(de);(function(zt,Ft,hi,xi,Ti,Ei){const Ci=(Ft-hi)*Ti,Ri=-Ei*xi;for(const dn of zt)for(const rn of dn.positionedGlyphs)rn.x+=Ci,rn.y+=Ri})(Y.positionedLines,yt,vt,Zt,ct,wt),Y.top+=-Zt*wt,Y.bottom=Y.top+wt,Y.left+=-vt*ct,Y.right=Y.left+ct,Y.hasBaseline=lt}($,i,a,u,k,g,b,E,S,R,C,I),!function(Y){for(const ie of Y)if(ie.positionedGlyphs.length!==0)return!1;return!0}(U)&&$}const Av={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},h5={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function EM(c,i,a,u,m,h){if(i.image){const g=u[i.image.serialize()];return g?g.displaySize[0]*i.scale*fs/h+m:0}{const g=a[i.fontStack],b=g&&g.glyphs[c];return b?b.metrics.advance*i.scale+m:0}}function SM(c,i,a,u){const m=Math.pow(c-i,2);return u?c<i?m/2:2*m:m+Math.abs(a)*a}function d5(c,i,a){let u=0;return c===10&&(u-=1e4),a&&(u+=150),c!==40&&c!==65288||(u+=50),i!==41&&i!==65289||(u+=50),u}function AM(c,i,a,u,m,h){let g=null,b=SM(i,a,m,h);for(const E of u){const R=SM(i-E.x,a,m,h)+E.badness;R<=b&&(g=E,b=R)}return{index:c,x:i,priorBreak:g,badness:b}}function IM(c){return c?IM(c.priorBreak).concat(c.index):[]}function Gw(c){let i=.5,a=.5;switch(c){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(c){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0}return{horizontalAlign:i,verticalAlign:a}}function MM(c,i,a,u,m){if(!(i||a||u||m))return;const h=c.length-1,g=c[h],b=(g.x+g.metrics.advance*g.scale)*i;for(let E=0;E<=h;E++)c[E].x-=b,c[E].y+=a+u+m}function f5(c,i,a,u){const{horizontalAlign:m,verticalAlign:h}=Gw(u),g=a[0]-c.displaySize[0]*m,b=a[1]-c.displaySize[1]*h;return{imagePrimary:c,imageSecondary:i,top:b,bottom:b+c.displaySize[1],left:g,right:g+c.displaySize[0]}}function CM(c,i,a,u,m,h){const g=c.imagePrimary;let b;if(g.content){const k=g.content,F=g.pixelRatio||1;b=[k[0]/F,k[1]/F,g.displaySize[0]-k[2]/F,g.displaySize[1]-k[3]/F]}const E=i.left*h,R=i.right*h;let v,S,C,T;a==="width"||a==="both"?(T=m[0]+E-u[3],S=m[0]+R+u[1]):(T=m[0]+(E+R-g.displaySize[0])/2,S=T+g.displaySize[0]);const I=i.top*h,D=i.bottom*h;return a==="height"||a==="both"?(v=m[1]+I-u[0],C=m[1]+D+u[2]):(v=m[1]+(I+D-g.displaySize[1])/2,C=v+g.displaySize[1]),{imagePrimary:g,imageSecondary:void 0,top:v,right:S,bottom:C,left:T,collisionPadding:b}}class Hc extends St{constructor(i,a,u,m,h){super(i,a),this.angle=m,this.z=u,h!==void 0&&(this.segment=h)}clone(){return new Hc(this.x,this.y,this.z,this.angle,this.segment)}}function RM(c,i,a,u,m){if(i.segment===void 0)return!0;let h=i,g=i.segment+1,b=0;for(;b>-a/2;){if(g--,g<0)return!1;b-=c[g].dist(h),h=c[g]}b+=c[g].dist(c[g+1]),g++;const E=[];let R=0;for(;b<a/2;){const v=c[g],S=c[g+1];if(!S)return!1;let C=c[g-1].angleTo(v)-v.angleTo(S);for(C=Math.abs((C+3*Math.PI)%(2*Math.PI)-Math.PI),E.push({distance:b,angleDelta:C}),R+=C;b-E[0].distance>u;)R-=E.shift().angleDelta;if(R>m)return!1;g++,b+=v.dist(S)}return!0}function DM(c){let i=0;for(let a=0;a<c.length-1;a++)i+=c[a].dist(c[a+1]);return i}function PM(c,i,a){return c?.6*i*a:0}function LM(c,i){return Math.max(c?c.right-c.left:0,i?i.right-i.left:0)}function p5(c,i,a,u,m,h){const g=PM(a,m,h),b=LM(a,u)*h;let E=0;const R=DM(c)/2;for(let v=0;v<c.length-1;v++){const S=c[v],C=c[v+1],T=S.dist(C);if(E+T>R){const I=(R-E)/T,D=ei(S.x,C.x,I),k=ei(S.y,C.y,I),F=new Hc(D,k,0,C.angleTo(S),v);return!g||RM(c,F,b,g,i)?F:void 0}E+=T}}function m5(c,i,a,u,m,h,g,b,E){const R=PM(u,h,g),v=LM(u,m),S=v*g,C=c[0].x===0||c[0].x===E||c[0].y===0||c[0].y===E;return i-S<i/4&&(i=S+i/4),zM(c,C?i/2*b%i:(v/2+2*h)*g*b%i,i,R,a,S,C,!1,E)}function zM(c,i,a,u,m,h,g,b,E){const R=h/2,v=DM(c);let S=0,C=i-a,T=[];for(let I=0;I<c.length-1;I++){const D=c[I],k=c[I+1],F=D.dist(k),q=k.angleTo(D);for(;C+a<S+F;){C+=a;const H=(C-S)/F,U=ei(D.x,k.x,H),$=ei(D.y,k.y,H);if(U>=0&&U<E&&$>=0&&$<E&&C-R>=0&&C+R<=v){const Y=new Hc(U,$,0,q,I);u&&!RM(c,Y,h,u,m)||T.push(Y)}}S+=F}return b||T.length||g||(T=zM(c,S/2,a,u,m,h,g,!0,E)),T}function OM(c,i,a,u,m){const h=[];for(let g=0;g<c.length;g++){const b=c[g];let E;for(let R=0;R<b.length-1;R++){let v=b[R],S=b[R+1];v.x<i&&S.x<i||(v.x<i?v=new St(i,v.y+(i-v.x)/(S.x-v.x)*(S.y-v.y))._round():S.x<i&&(S=new St(i,v.y+(i-v.x)/(S.x-v.x)*(S.y-v.y))._round()),v.y<a&&S.y<a||(v.y<a?v=new St(v.x+(a-v.y)/(S.y-v.y)*(S.x-v.x),a)._round():S.y<a&&(S=new St(v.x+(a-v.y)/(S.y-v.y)*(S.x-v.x),a)._round()),v.x>=u&&S.x>=u||(v.x>=u?v=new St(u,v.y+(u-v.x)/(S.x-v.x)*(S.y-v.y))._round():S.x>=u&&(S=new St(u,v.y+(u-v.x)/(S.x-v.x)*(S.y-v.y))._round()),v.y>=m&&S.y>=m||(v.y>=m?v=new St(v.x+(m-v.y)/(S.y-v.y)*(S.x-v.x),m)._round():S.y>=m&&(S=new St(v.x+(m-v.y)/(S.y-v.y)*(S.x-v.x),m)._round()),E&&v.equals(E[E.length-1])||(E=[v],h.push(E)),E.push(S)))))}}return h}function kM(c){let i=0,a=0;for(const g of c)i+=g.w*g.h,a=Math.max(a,g.w);c.sort((g,b)=>b.h-g.h);const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),a),h:1/0}];let m=0,h=0;for(const g of c)for(let b=u.length-1;b>=0;b--){const E=u[b];if(!(g.w>E.w||g.h>E.h)){if(g.x=E.x,g.y=E.y,h=Math.max(h,g.y+g.h),m=Math.max(m,g.x+g.w),g.w===E.w&&g.h===E.h){const R=u.pop();b<u.length&&(u[b]=R)}else g.h===E.h?(E.x+=g.w,E.w-=g.w):g.w===E.w?(E.y+=g.h,E.h-=g.h):(u.push({x:E.x+g.w,y:E.y,w:E.w-g.w,h:g.h}),E.y+=g.h,E.h-=g.h);break}}return{w:m,h,fill:i/(m*h)||0}}Gt(Hc,"Anchor");const __=1;class y_{static getImagePositionScale(i,a,u){return a&&i&&i.options&&i.options.transform?{x:i.options.transform.a,y:i.options.transform.d}:{x:u,y:u}}constructor(i,{pixelRatio:a,version:u,stretchX:m,stretchY:h,content:g,sdf:b,usvg:E},R,v){this.paddedRect=i,this.pixelRatio=a,this.stretchX=m,this.stretchY=h,this.content=g,this.version=u,this.padding=R,this.sdf=b,this.scale=y_.getImagePositionScale(v,E,a)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}class NM{constructor(i,a,u){const m={},h={};this.haveRenderCallbacks=[];const g=[];this.addImages(i,m,__,g),this.addImages(a,h,2,g);const{w:b,h:E}=kM(g),R=new Kr({width:b||1,height:E||1});for(const v in i){const S=i[v],C=m[v].paddedRect;Kr.copy(S.data,R,{x:0,y:0},{x:C.x+__,y:C.y+__},S.data,u,S.sdf)}for(const v in a){const S=a[v],C=h[v].paddedRect;let T=h[v].padding;const I=C.x+T,D=C.y+T,k=S.data.width,F=S.data.height;T=T>1?T-1:T,Kr.copy(S.data,R,{x:0,y:0},{x:I,y:D},S.data,u),Kr.copy(S.data,R,{x:0,y:F-T},{x:I,y:D-T},{width:k,height:T},u),Kr.copy(S.data,R,{x:0,y:0},{x:I,y:D+F},{width:k,height:T},u),Kr.copy(S.data,R,{x:k-T,y:0},{x:I-T,y:D},{width:T,height:F},u),Kr.copy(S.data,R,{x:0,y:0},{x:I+k,y:D},{width:T,height:F},u),Kr.copy(S.data,R,{x:k-T,y:F-T},{x:I-T,y:D-T},{width:T,height:T},u),Kr.copy(S.data,R,{x:0,y:F-T},{x:I+k,y:D-T},{width:T,height:T},u),Kr.copy(S.data,R,{x:0,y:0},{x:I+k,y:D+F},{width:T,height:T},u),Kr.copy(S.data,R,{x:k-T,y:0},{x:I-T,y:D+F},{width:T,height:T},u)}this.lut=u,this.image=R,this.iconPositions=m,this.patternPositions=h}addImages(i,a,u,m){for(const h in i){const g=i[h],b={x:0,y:0,w:g.data.width+2*u,h:g.data.height+2*u};m.push(b);const E=_a.deserializeFromString(h);a[h]=new y_(b,g,u,E),g.hasRenderCallback&&this.haveRenderCallbacks.push(E.id)}}patchUpdatedImages(i,a,u){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(m=>i.hasImage(m,u)),i.dispatchRenderCallbacks(this.haveRenderCallbacks,u);for(const m in i.getUpdatedImages(u)){for(const h of Object.keys(this.iconPositions))_a.deserializeId(h)===m&&this.patchUpdatedImage(this.iconPositions[h],i.getImage(m,u),a);for(const h of Object.keys(this.patternPositions))_a.deserializeId(h)===m&&this.patchUpdatedImage(this.patternPositions[h],i.getImage(m,u),a)}}patchUpdatedImage(i,a,u){if(!i||!a||i.version===a.version)return;i.version=a.version;const[m,h]=i.tl,g=i.sdf;if(this.lut||g){const b={width:a.data.width,height:a.data.height},E=new Kr(b);Kr.copy(a.data,E,{x:0,y:0},{x:0,y:0},b,this.lut,g),u.update(E,{position:{x:m,y:h}})}else u.update(a.data,{position:{x:m,y:h}})}}Gt(y_,"ImagePosition"),Gt(NM,"ImageAtlas");const v_=1e20;function FM(c,i,a,u,m,h,g,b,E){for(let R=i;R<i+u;R++)BM(c,a*h+R,h,m,g,b,E);for(let R=a;R<a+m;R++)BM(c,R*h+i,1,u,g,b,E)}function BM(c,i,a,u,m,h,g){h[0]=0,g[0]=-v_,g[1]=v_,m[0]=c[i];for(let b=1,E=0,R=0;b<u;b++){m[b]=c[i+b*a];const v=b*b;do{const S=h[E];R=(m[b]-m[S]+v-S*S)/(b-S)/2}while(R<=g[E]&&--E>-1);E++,h[E]=b,g[E]=R,g[E+1]=v_}for(let b=0,E=0;b<u;b++){for(;g[E+1]<b;)E++;const R=h[E],v=b-R;c[i+b*a]=m[R]+v*v}}const fl=2,Hw={none:0,ideographs:1,all:2};class Ip{constructor(i,a,u){this.requestManager=i,this.localGlyphMode=a,this.localFontFamily=u,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(i,a){this.urls[a]=i}getGlyphs(i,a,u){const m=[],h=this.urls[a]||Kn.GLYPHS_URL;for(const g in i)for(const b of i[g])m.push({stack:g,id:b});Yn(m,({stack:g,id:b},E)=>{let R=this.entries[g];R||(R=this.entries[g]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let v=R.glyphs[b];if(v!==void 0)return void E(null,{stack:g,id:b,glyph:v});if(v=this._tinySDF(R,g,b),v)return R.glyphs[b]=v,void E(null,{stack:g,id:b,glyph:v});const S=Math.floor(b/256);if(256*S>65535)return yi("glyphs > 65535 not supported"),void E(null,{stack:g,id:b,glyph:v});if(R.ranges[S])return void E(null,{stack:g,id:b,glyph:v});let C=R.requests[S];C||(C=R.requests[S]=[],Ip.loadGlyphRange(g,S,h,this.requestManager,(T,I)=>{if(I){R.ascender=I.ascender,R.descender=I.descender;for(const D in I.glyphs)this._doesCharSupportLocalGlyph(+D)||(R.glyphs[+D]=I.glyphs[+D]);R.ranges[S]=!0}for(const D of C)D(T,I);delete R.requests[S]})),C.push((T,I)=>{T?E(T):I&&E(null,{stack:g,id:b,glyph:I.glyphs[b]||null})})},(g,b)=>{if(g)u(g);else if(b){const E={};for(const{stack:R,id:v,glyph:S}of b)E[R]===void 0&&(E[R]={}),E[R].glyphs===void 0&&(E[R].glyphs={}),E[R].glyphs[v]=S&&{id:S.id,bitmap:S.bitmap.clone(),metrics:S.metrics},E[R].ascender=this.entries[R].ascender,E[R].descender=this.entries[R].descender;u(null,E)}})}_doesCharSupportLocalGlyph(i){return this.localGlyphMode!==Hw.none&&(this.localGlyphMode===Hw.all?!!this.localFontFamily:!!this.localFontFamily&&(Wt["CJK Unified Ideographs"](i)||Wt["Hangul Syllables"](i)||Wt.Hiragana(i)||Wt.Katakana(i)||Wt["CJK Symbols and Punctuation"](i)||Wt["CJK Unified Ideographs Extension A"](i)||Wt["CJK Unified Ideographs Extension B"](i)||Wt.Osage(i)))}_tinySDF(i,a,u){const m=this.localFontFamily;if(!m||!this._doesCharSupportLocalGlyph(u))return;let h=i.tinySDF;if(!h){let D="400";/bold/i.test(a)?D="900":/medium/i.test(a)?D="500":/light/i.test(a)&&(D="200"),h=i.tinySDF=new Ip.TinySDF({fontFamily:m,fontWeight:D,fontSize:24*fl,buffer:3*fl,radius:8*fl}),h.fontWeight=D}if(this.localGlyphs[h.fontWeight][u])return this.localGlyphs[h.fontWeight][u];const g=String.fromCodePoint(u),{data:b,width:E,height:R,glyphWidth:v,glyphHeight:S,glyphLeft:C,glyphTop:T,glyphAdvance:I}=h.draw(g);return this.localGlyphs[h.fontWeight][u]={id:u,bitmap:new eh({width:E,height:R},b),metrics:{width:v/fl,height:S/fl,left:C/fl,top:T/fl-27,advance:I/fl,localGlyph:!0}}}}Ip.loadGlyphRange=function(c,i,a,u,m){const h=256*i,g=h+255,b=u.transformRequest(u.normalizeGlyphsURL(a).replace("{fontstack}",c).replace("{range}",`${h}-${g}`),Ui.Glyphs);Qn(b,(E,R)=>{if(E)m(E);else if(R){const v={},S=function(C){return new Sv(C).readFields(l5,{})}(R);for(const C of S.glyphs)v[C.id]=C;m(null,{glyphs:v,ascender:S.ascender,descender:S.descender})}})},Ip.TinySDF=class{constructor({fontSize:c=24,buffer:i=3,radius:a=8,cutoff:u=.25,fontFamily:m="sans-serif",fontWeight:h="normal",fontStyle:g="normal"}={}){this.buffer=i,this.cutoff=u,this.radius=a;const b=this.size=c+4*i,E=this._createCanvas(b),R=this.ctx=E.getContext("2d",{willReadFrequently:!0});R.font=`${g} ${h} ${c}px ${m}`,R.textBaseline="alphabetic",R.textAlign="left",R.fillStyle="black",this.gridOuter=new Float64Array(b*b),this.gridInner=new Float64Array(b*b),this.f=new Float64Array(b),this.z=new Float64Array(b+1),this.v=new Uint16Array(b)}_createCanvas(c){const i=document.createElement("canvas");return i.width=i.height=c,i}draw(c){const{width:i,actualBoundingBoxAscent:a,actualBoundingBoxDescent:u,actualBoundingBoxLeft:m,actualBoundingBoxRight:h}=this.ctx.measureText(c),g=Math.ceil(a),b=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(h-m))),E=Math.min(this.size-this.buffer,g+Math.ceil(u)),R=b+2*this.buffer,v=E+2*this.buffer,S=Math.max(R*v,0),C=new Uint8ClampedArray(S),T={data:C,width:R,height:v,glyphWidth:b,glyphHeight:E,glyphTop:g,glyphLeft:0,glyphAdvance:i};if(b===0||E===0)return T;const{ctx:I,buffer:D,gridInner:k,gridOuter:F}=this;I.clearRect(D,D,b,E),I.fillText(c,D,D+g);const q=I.getImageData(D,D,b,E);F.fill(v_,0,S),k.fill(0,0,S);for(let H=0;H<E;H++)for(let U=0;U<b;U++){const $=q.data[4*(H*b+U)+3]/255;if($===0)continue;const Y=(H+D)*R+U+D;if($===1)F[Y]=0,k[Y]=v_;else{const ie=.5-$;F[Y]=ie>0?ie*ie:0,k[Y]=ie<0?ie*ie:0}}FM(F,0,0,R,v,R,this.f,this.v,this.z),FM(k,D,D,b,E,R,this.f,this.v,this.z);for(let H=0;H<S;H++){const U=Math.sqrt(F[H])-Math.sqrt(k[H]);C[H]=Math.round(255-255*(U/this.radius+this.cutoff))}return T}};const ih=__;function VM(c,i){return c+i[1]-i[0]}function UM(c,i,a,u,m=1){const h=[],g=c.imagePrimary,b=g.pixelRatio,E=g.paddedRect.w-2*ih,R=g.paddedRect.h-2*ih,v=(c.right-c.left)*m,S=(c.bottom-c.top)*m,C=g.stretchX||[[0,E]],T=g.stretchY||[[0,R]],I=C.reduce(VM,0),D=T.reduce(VM,0),k=E-I,F=R-D;let q=0,H=I,U=0,$=D,Y=0,ie=k,he=0,ue=F;if(g.content&&u){const Ie=g.content;q=Iv(C,0,Ie[0]),U=Iv(T,0,Ie[1]),H=Iv(C,Ie[0],Ie[2]),$=Iv(T,Ie[1],Ie[3]),Y=Ie[0]-q,he=Ie[1]-U,ie=Ie[2]-Ie[0]-H,ue=Ie[3]-Ie[1]-$}const ce=(Ie,de,Me,ze)=>{const Pe=Mv(Ie.stretch-q,H,v,c.left*m),Ne=Cv(Ie.fixed-Y,ie,Ie.stretch,I),qe=Mv(de.stretch-U,$,S,c.top*m),Ze=Cv(de.fixed-he,ue,de.stretch,D),Be=Mv(Me.stretch-q,H,v,c.left*m),ct=Cv(Me.fixed-Y,ie,Me.stretch,I),yt=Mv(ze.stretch-U,$,S,c.top*m),lt=Cv(ze.fixed-he,ue,ze.stretch,D),Lt=new St(Pe,qe),Dt=new St(Be,qe),wt=new St(Be,yt),vt=new St(Pe,yt),Zt=new St(Ne/b,Ze/b),zt=new St(ct/b,lt/b),Ft=i*Math.PI/180;if(Ft){const Ri=Math.sin(Ft),dn=Math.cos(Ft),rn=[dn,-Ri,Ri,dn];Lt._matMult(rn),Dt._matMult(rn),vt._matMult(rn),wt._matMult(rn)}const hi=Ie.stretch+Ie.fixed,xi=Me.stretch+Me.fixed,Ti=de.stretch+de.fixed,Ei=ze.stretch+ze.fixed,Ci=c.imageSecondary;return{tl:Lt,tr:Dt,bl:vt,br:wt,texPrimary:{x:g.paddedRect.x+ih+hi,y:g.paddedRect.y+ih+Ti,w:xi-hi,h:Ei-Ti},texSecondary:Ci?{x:Ci.paddedRect.x+ih+hi,y:Ci.paddedRect.y+ih+Ti,w:xi-hi,h:Ei-Ti}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Zt,pixelOffsetBR:zt,minFontScaleX:ie/b/v,minFontScaleY:ue/b/S,isSDF:a}};if(u&&(g.stretchX||g.stretchY)){const Ie=jM(C,k,I),de=jM(T,F,D);for(let Me=0;Me<Ie.length-1;Me++){const ze=Ie[Me],Pe=Ie[Me+1];for(let Ne=0;Ne<de.length-1;Ne++)h.push(ce(ze,de[Ne],Pe,de[Ne+1]))}}else h.push(ce({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:E+1},{fixed:0,stretch:R+1}));return h}function Iv(c,i,a){let u=0;for(const m of c)u+=Math.max(i,Math.min(a,m[1]))-Math.max(i,Math.min(a,m[0]));return u}function jM(c,i,a){const u=[{fixed:-ih,stretch:0}];for(const[m,h]of c){const g=u[u.length-1];u.push({fixed:m-g.stretch,stretch:g.stretch}),u.push({fixed:m-g.stretch,stretch:g.stretch+(h-m)})}return u.push({fixed:i+ih,stretch:a}),u}function Mv(c,i,a,u){return c/i*a+u}function Cv(c,i,a,u){return c-i*a/u}function g5(c,i,a,u){const m=i+c.positionedLines[u].lineOffset;return u===0?a+m/2:a+(m+(i+c.positionedLines[u-1].lineOffset))/2}function _5(c,i=1,a=!1){let u=1/0,m=1/0,h=-1/0,g=-1/0;const b=c[0];for(let T=0;T<b.length;T++){const I=b[T];(!T||I.x<u)&&(u=I.x),(!T||I.y<m)&&(m=I.y),(!T||I.x>h)&&(h=I.x),(!T||I.y>g)&&(g=I.y)}const E=Math.min(h-u,g-m);let R=E/2;const v=new Yr([],y5);if(E===0)return new St(u,m);for(let T=u;T<h;T+=E)for(let I=m;I<g;I+=E)v.push(new Mp(T+R,I+R,R,c));let S=function(T){let I=0,D=0,k=0;const F=T[0];for(let q=0,H=F.length,U=H-1;q<H;U=q++){const $=F[q],Y=F[U],ie=$.x*Y.y-Y.x*$.y;D+=($.x+Y.x)*ie,k+=($.y+Y.y)*ie,I+=3*ie}return new Mp(D/I,k/I,0,T)}(c),C=v.length;for(;v.length;){const T=v.pop();(T.d>S.d||!S.d)&&(S=T,a&&console.log("found best %d after %d probes",Math.round(1e4*T.d)/1e4,C)),T.max-S.d<=i||(R=T.h/2,v.push(new Mp(T.p.x-R,T.p.y-R,R,c)),v.push(new Mp(T.p.x+R,T.p.y-R,R,c)),v.push(new Mp(T.p.x-R,T.p.y+R,R,c)),v.push(new Mp(T.p.x+R,T.p.y+R,R,c)),C+=4)}return a&&(console.log(`num probes: ${C}`),console.log(`best distance: ${S.d}`)),S.p}function y5(c,i){return i.max-c.max}class Mp{constructor(i,a,u,m){this.p=new St(i,a),this.h=u,this.d=function(h,g){let b=!1,E=1/0;for(let R=0;R<g.length;R++){const v=g[R];for(let S=0,C=v.length,T=C-1;S<C;T=S++){const I=v[S],D=v[T];I.y>h.y!=D.y>h.y&&h.x<(D.x-I.x)*(h.y-I.y)/(D.y-I.y)+I.x&&(b=!b),E=Math.min(E,_e(h,I,D))}}return(b?1:-1)*Math.sqrt(E)}(this.p,m),this.max=this.d+this.h*Math.SQRT2}}const $w=Number.POSITIVE_INFINITY,v5=Math.sqrt(2);function qM(c,[i,a]){let u=0,m=0;if(a===$w){i<0&&(i=0);const h=i/v5;switch(c){case"top-right":case"top-left":m=h-7;break;case"bottom-right":case"bottom-left":m=7-h;break;case"bottom":m=7-i;break;case"top":m=i-7}switch(c){case"top-right":case"bottom-right":u=-h;break;case"top-left":case"bottom-left":u=h;break;case"left":u=i;break;case"right":u=-i}}else{switch(i=Math.abs(i),a=Math.abs(a),c){case"top-right":case"top-left":case"top":m=a-7;break;case"bottom-right":case"bottom-left":case"bottom":m=7-a}switch(c){case"top-right":case"bottom-right":case"right":u=-i;break;case"top-left":case"bottom-left":case"left":u=i}}return[u,m]}function Zw(c){switch(c){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function x5(c,i,a,u,m,h,g,b,E,R,v,S,C,T,I){let D=h.textMaxSize.evaluate(i,{},S);D===void 0?D=g*h.textScaleFactor:D*=h.textScaleFactor;const k=c.layers[0].layout,F=k.get("icon-offset").evaluate(i,{},S),q=HM(a.horizontal)||a.vertical,H=C.name==="globe",U=fs,$=g*h.textScaleFactor/U,Y=c.tilePixelRatio*D/U,ie=(Pe=c.overscaling,c.zoom>18&&Pe>2&&(Pe>>=1),Math.max(Pt/(512*Pe),1)*k.get("symbol-spacing")),he=k.get("text-padding")*c.tilePixelRatio,ue=k.get("icon-padding")*c.tilePixelRatio,ce=Li(k.get("text-max-angle")),Ie=k.get("text-rotation-alignment")==="map"&&k.get("symbol-placement")!=="point",de=k.get("icon-rotation-alignment")==="map"&&k.get("symbol-placement")!=="point",Me=k.get("symbol-placement"),ze=ie/2;var Pe;const Ne=k.get("icon-text-fit").evaluate(i,{},S),qe=k.get("icon-text-fit-padding").evaluate(i,{},S),Ze=Ne!=="none";let Be;c.hasAnyIconTextFit===!1&&Ze&&(c.hasAnyIconTextFit=!0),u&&Ze&&(c.allowVerticalPlacement&&a.vertical&&(Be=CM(u,a.vertical,Ne,qe,F,$)),q&&(u=CM(u,q,Ne,qe,F,$)));const ct=(yt,lt,Lt)=>{if(lt.x<0||lt.x>=Pt||lt.y<0||lt.y>=Pt)return;let Dt=null;if(H){const{x:wt,y:vt,z:Zt}=C.projectTilePoint(lt.x,lt.y,Lt);Dt={anchor:new Hc(wt,vt,Zt,0,void 0),up:C.upVector(Lt,lt.x,lt.y)}}(function(wt,vt,Zt,zt,Ft,hi,xi,Ti,Ei,Ci,Ri,dn,rn,pi,Ji,tn,In,tr,mr,ir,jn,ar,wr,ps,wn,Sa,_l){const Po=wt.addToLineVertexArray(vt,zt);let Lo,Yd,oh,Kd,F_,SR,AR,IR=0,MR=0,CR=0,RR=0,MT=-1,CT=-1;const Jl={};let DR=an("");const Qd=Zt?Zt.anchor:vt,RT=Ei.layout.get("icon-text-fit").evaluate(jn,{},wn)!=="none";let DT=0,PT=0;if(Ei._unevaluatedLayout.getValue("text-radial-offset")===void 0?[DT,PT]=Ei.layout.get("text-offset").evaluate(jn,{},wn).map(so=>so*fs):(DT=Ei.layout.get("text-radial-offset").evaluate(jn,{},wn)*fs,PT=$w),wt.allowVerticalPlacement&&Ft.vertical){const so=Ft.vertical;if(Ji)SR=Ww(so),Ti&&(AR=Ww(Ti));else{const Aa=Ei.layout.get("text-rotate").evaluate(jn,{},wn)+90;oh=Rv(Ci,Qd,vt,Ri,dn,rn,so,pi,Aa,tn),Ti&&(Kd=Rv(Ci,Qd,vt,Ri,dn,rn,Ti,tr,Aa))}}if(hi){const so=wt.iconSizeData,Aa=Ei.layout.get("icon-rotate").evaluate(jn,{},wn),B_=UM(hi,Aa,wr,RT,ar.iconScaleFactor),zT=Ti?UM(Ti,Aa,wr,RT,ar.iconScaleFactor):void 0;Yd=Rv(Ci,Qd,vt,Ri,dn,rn,hi,tr,Aa,null),IR=4*B_.length;let Jd=null;so.kind==="source"?(Jd=[dl*Ei.layout.get("icon-size").evaluate(jn,{},wn)*ar.iconScaleFactor],Jd[0]>nh&&yi(`${wt.layerIds[0]}: Value for "icon-size" is >= ${x_}. Reduce your "icon-size".`)):so.kind==="composite"&&(Jd=[dl*ar.compositeIconSizes[0].evaluate(jn,{},wn)*ar.iconScaleFactor,dl*ar.compositeIconSizes[1].evaluate(jn,{},wn)*ar.iconScaleFactor],(Jd[0]>nh||Jd[1]>nh)&&yi(`${wt.layerIds[0]}: Value for "icon-size" is >= ${x_}. Reduce your "icon-size".`)),wt.addSymbols(wt.icon,B_,Jd,ir,mr,jn,!1,Zt,vt,Po.lineStartIndex,Po.lineLength,-1,ps,wn,Sa,_l),MT=wt.icon.placedSymbolArray.length-1,zT&&(MR=4*zT.length,wt.addSymbols(wt.icon,zT,Jd,ir,mr,jn,no.vertical,Zt,vt,Po.lineStartIndex,Po.lineLength,-1,ps,wn,Sa,_l),CT=wt.icon.placedSymbolArray.length-1)}for(const so in Ft.horizontal){const Aa=Ft.horizontal[so];Lo||(DR=an(Aa.text),Ji?F_=Ww(Aa):Lo=Rv(Ci,Qd,vt,Ri,dn,rn,Aa,pi,Ei.layout.get("text-rotate").evaluate(jn,{},wn),tn));const B_=Aa.positionedLines.length===1;if(CR+=GM(wt,Zt,vt,Aa,xi,Ei,Ji,jn,tn,Po,Ft.vertical?no.horizontal:no.horizontalOnly,B_?Object.keys(Ft.horizontal):[so],Jl,MT,ar,ps,wn,Sa),B_)break}Ft.vertical&&(RR+=GM(wt,Zt,vt,Ft.vertical,xi,Ei,Ji,jn,tn,Po,no.vertical,["vertical"],Jl,CT,ar,ps,wn,Sa));let lh=-1;const LT=(so,Aa)=>so?Math.max(so,Aa):Aa;lh=LT(F_,lh),lh=LT(SR,lh),lh=LT(AR,lh);const JB=lh>-1?1:0;wt.glyphOffsetArray.length>=65535&&yi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),jn.sortKey!==void 0&&wt.addToSortKeyRanges(wt.symbolInstances.length,jn.sortKey),wt.symbolInstances.emplaceBack(vt.x,vt.y,Qd.x,Qd.y,Qd.z,Jl.right>=0?Jl.right:-1,Jl.center>=0?Jl.center:-1,Jl.left>=0?Jl.left:-1,Jl.vertical>=0?Jl.vertical:-1,MT,CT,DR,Lo!==void 0?Lo:wt.collisionBoxArray.length,Lo!==void 0?Lo+1:wt.collisionBoxArray.length,oh!==void 0?oh:wt.collisionBoxArray.length,oh!==void 0?oh+1:wt.collisionBoxArray.length,Yd!==void 0?Yd:wt.collisionBoxArray.length,Yd!==void 0?Yd+1:wt.collisionBoxArray.length,Kd||wt.collisionBoxArray.length,Kd?Kd+1:wt.collisionBoxArray.length,Ri,CR,RR,IR,MR,JB,0,DT,PT,lh,0,RT?1:0)})(c,lt,Dt,yt,a,u,m,Be,c.layers[0],c.collisionBoxArray,i.index,i.sourceLayerIndex,c.index,he,Ie,E,0,ue,de,F,i,h,R,v,S,T,I)};if(Me==="line")for(const yt of OM(i.geometry,0,0,Pt,Pt)){const lt=m5(yt,ie,ce,a.vertical||q,u,U,Y,c.overscaling,Pt);for(const Lt of lt)q&&b5(c,q.text,ze,Lt)||ct(yt,Lt,S)}else if(Me==="line-center"){for(const yt of i.geometry)if(yt.length>1){const lt=p5(yt,ce,a.vertical||q,u,U,Y);lt&&ct(yt,lt,S)}}else if(i.type==="Polygon")for(const yt of _v(i.geometry,0)){const lt=_5(yt,16);ct(yt[0],new Hc(lt.x,lt.y,0,0,void 0),S)}else if(i.type==="LineString")for(const yt of i.geometry)ct(yt,new Hc(yt[0].x,yt[0].y,0,0,void 0),S);else if(i.type==="Point")for(const yt of i.geometry)for(const lt of yt)ct([lt],new Hc(lt.x,lt.y,0,0,void 0),S)}const x_=255,nh=x_*dl;function GM(c,i,a,u,m,h,g,b,E,R,v,S,C,T,I,D,k,F){const q=function($,Y,ie,he,ue,ce,Ie,de){const Me=[];if(Y.positionedLines.length===0)return Me;const ze=he.layout.get("text-rotate").evaluate(ce,{})*Math.PI/180,Pe=function(ct){const yt=ct[0],lt=ct[1],Lt=yt*lt;return Lt>0?[yt,-lt]:Lt<0?[-yt,lt]:yt===0?[lt,yt]:[lt,-yt]}(ie);let Ne=Math.abs(Y.top-Y.bottom);for(const ct of Y.positionedLines)Ne-=ct.lineOffset;const qe=Y.positionedLines.length,Ze=Ne/qe;let Be=Y.top-ie[1];for(let ct=0;ct<qe;++ct){const yt=Y.positionedLines[ct];Be=g5(Y,Ze,Be,ct);for(const lt of yt.positionedGlyphs){if(!lt.rect)continue;const Lt=lt.rect||{};let Dt=TM+1,wt=!0,vt=1,Zt=0;if(lt.imageName){const ir=Ie[Fn.build(lt.imageName).getSerializedPrimary()];if(!ir)continue;if(ir.sdf){yi("SDF images are not supported in formatted text and will be ignored.");continue}wt=!1,vt=ir.pixelRatio,Dt=__/vt}const zt=(ue||de)&&lt.vertical,Ft=lt.metrics.advance*lt.scale/2,hi=lt.metrics,xi=lt.rect;if(xi===null)continue;de&&Y.verticalizable&&(Zt=lt.imageName?Ft-lt.metrics.width*lt.scale/2:0);const Ti=ue?[lt.x+Ft,lt.y]:[0,0];let Ei=[0,0],Ci=[0,0],Ri=!1;ue||(zt?(Ci=[lt.x+Ft+Pe[0],lt.y+Pe[1]-Zt],Ri=!0):Ei=[lt.x+Ft+ie[0],lt.y+ie[1]-Zt]);const dn=xi.w*lt.scale/(vt*(lt.localGlyph?fl:1)),rn=xi.h*lt.scale/(vt*(lt.localGlyph?fl:1));let pi,Ji,tn,In;if(zt){const ir=lt.y-Be,jn=new St(-Ft,Ft-ir),ar=-Math.PI/2,wr=new St(...Ci);pi=new St(-Ft+Ei[0],Ei[1]),pi._rotateAround(ar,jn)._add(wr),pi.x+=-ir+Ft,pi.y-=(hi.left-Dt)*lt.scale;const ps=lt.imageName?hi.advance*lt.scale:fs*lt.scale,wn=String.fromCodePoint(lt.glyph);s5(wn)?pi.x+=(1-Dt)*lt.scale:a5(wn)?pi.x+=ps-hi.height*lt.scale+(-Dt-1)*lt.scale:pi.x+=lt.imageName||hi.width+2*Dt===xi.w&&hi.height+2*Dt===xi.h?(ps-rn)/2:(ps-(hi.height+2*Dt)*lt.scale)/2,Ji=new St(pi.x,pi.y-dn),tn=new St(pi.x+rn,pi.y),In=new St(pi.x+rn,pi.y-dn)}else{const ir=(hi.left-Dt)*lt.scale-Ft+Ei[0],jn=(-hi.top-Dt)*lt.scale+Ei[1],ar=ir+dn,wr=jn+rn;pi=new St(ir,jn),Ji=new St(ar,jn),tn=new St(ir,wr),In=new St(ar,wr)}if(ze){let ir;ir=ue?new St(0,0):Ri?new St(Pe[0],Pe[1]):new St(ie[0],ie[1]),pi._rotateAround(ze,ir),Ji._rotateAround(ze,ir),tn._rotateAround(ze,ir),In._rotateAround(ze,ir)}const tr=new St(0,0),mr=new St(0,0);Me.push({tl:pi,tr:Ji,bl:tn,br:In,texPrimary:Lt,texSecondary:void 0,writingMode:Y.writingMode,glyphOffset:Ti,sectionIndex:lt.sectionIndex,isSDF:wt,pixelOffsetTL:tr,pixelOffsetBR:mr,minFontScaleX:0,minFontScaleY:0})}}return Me}(0,u,E,h,g,b,m,c.allowVerticalPlacement),H=c.textSizeData;let U=null;H.kind==="source"?(U=[dl*h.layout.get("text-size").evaluate(b,{},k)*I.textScaleFactor],U[0]>nh&&yi(`${c.layerIds[0]}: Value for "text-size" is >= ${x_}. Reduce your "text-size".`)):H.kind==="composite"&&(U=[dl*I.compositeTextSizes[0].evaluate(b,{},k)*I.textScaleFactor,dl*I.compositeTextSizes[1].evaluate(b,{},k)*I.textScaleFactor],(U[0]>nh||U[1]>nh)&&yi(`${c.layerIds[0]}: Value for "text-size" is >= ${x_}. Reduce your "text-size".`)),c.addSymbols(c.text,q,U,E,g,b,v,i,a,R.lineStartIndex,R.lineLength,T,D,k,F,!1);for(const $ of S)C[$]=c.text.placedSymbolArray.length-1;return 4*q.length}function HM(c){for(const i in c)return c[i];return null}function Rv(c,i,a,u,m,h,g,b,E,R){let v=g.top,S=g.bottom,C=g.left,T=g.right;const I=g.collisionPadding;if(I&&(C-=I[0],v-=I[1],T+=I[2],S+=I[3]),E){const D=new St(C,v),k=new St(T,v),F=new St(C,S),q=new St(T,S),H=Li(E);let U=new St(0,0);R&&(U=new St(R[0],R[1])),D._rotateAround(H,U),k._rotateAround(H,U),F._rotateAround(H,U),q._rotateAround(H,U),C=Math.min(D.x,k.x,F.x,q.x),T=Math.max(D.x,k.x,F.x,q.x),v=Math.min(D.y,k.y,F.y,q.y),S=Math.max(D.y,k.y,F.y,q.y)}return c.emplaceBack(i.x,i.y,i.z,a.x,a.y,C,v,T,S,b,u,m,h),c.length-1}function Ww(c){c.collisionPadding&&(c.top-=c.collisionPadding[1],c.bottom+=c.collisionPadding[3]);const i=c.bottom-c.top;return i>0?Math.max(10,i):null}function b5(c,i,a,u){const m=c.compareText;if(i in m){const h=m[i];for(let g=h.length-1;g>=0;g--)if(u.dist(h[g])<a)return!0}else m[i]=[];return m[i].push(u),!1}function $M(c,i){const a=c.fovAboveCenter,u=c.elevation?c.elevation.getMinElevationBelowMSL()*i:0,m=(c._camera.position[2]*c.worldSize-u)/Math.cos(c._pitch),h=Math.sin(a)*m/Math.sin(Math.max(Math.PI/2-c._pitch-a,.01));let g=Math.sin(c._pitch)*h+m;const b=m*(1/c._horizonShift);if(!c.elevation||c.elevation.exaggeration()===0){let E=Math.max(c.zoom-17,0);c.isOrthographic&&(E/=10),g*=1+E}return Math.min(1.01*g,b)}function b_(c,i){if(!i.isReprojectedInTileSpace)return{scale:1<<c.z,x:c.x,y:c.y,x2:c.x+1,y2:c.y+1,projection:i};const a=Math.pow(2,-c.z),u=c.x*a,m=(c.x+1)*a,h=c.y*a,g=(c.y+1)*a,b=ra(u),E=ra(m),R=Hr(h),v=Hr(g),S=i.project(b,R),C=i.project(E,R),T=i.project(E,v),I=i.project(b,v);let D=Math.min(S.x,C.x,T.x,I.x),k=Math.min(S.y,C.y,T.y,I.y),F=Math.max(S.x,C.x,T.x,I.x),q=Math.max(S.y,C.y,T.y,I.y);const H=a/16;function U(Y,ie,he,ue,ce,Ie){const de=(he+ce)/2,Me=(ue+Ie)/2,ze=i.project(ra(de),Hr(Me)),Pe=Math.max(0,D-ze.x,k-ze.y,ze.x-F,ze.y-q);D=Math.min(D,ze.x),F=Math.max(F,ze.x),k=Math.min(k,ze.y),q=Math.max(q,ze.y),Pe>H&&(U(Y,ze,he,ue,de,Me),U(ze,ie,de,Me,ce,Ie))}U(S,C,u,h,m,h),U(C,T,m,h,m,g),U(T,I,m,g,u,g),U(I,S,u,g,u,h),D-=H,k-=H,F+=H,q+=H;const $=1/Math.max(F-D,q-k);return{scale:$,x:D*$,y:k*$,x2:F*$,y2:q*$,projection:i}}function ZM(c,{x:i,y:a},u=0){return new St(((i-u)*c.scale-c.x)*Pt,(a*c.scale-c.y)*Pt)}const w5=ke.mat4.identity(new Float32Array(16));class rh{constructor(i){this.spec=i,this.name=i.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(i,a){return{x:0,y:0,z:0}}unproject(i,a){return new Gi(0,0)}projectTilePoint(i,a,u){return{x:i,y:a,z:0}}locationPoint(i,a,u=!0){return i._coordinatePoint(i.locationCoordinate(a),u)}pixelsPerMeter(i,a){return Ts(1,i)*a}pixelSpaceConversion(i,a,u){return 1}farthestPixelDistance(i){return $M(i,i.pixelsPerMeter)}pointCoordinate(i,a,u,m){const h=i.horizonLineFromTop(!1),g=new St(a,Math.max(h,u));return i.rayIntersectionCoordinate(i.pointRayIntersection(g,m))}pointCoordinate3D(i,a,u){const m=new St(a,u);if(i.elevation)return i.elevation.pointCoordinate(m);{const h=this.pointCoordinate(i,m.x,m.y,0);return[h.x,h.y,h.z]}}isPointAboveHorizon(i,a){if(i.elevation&&i.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(i,a.x,a.y);const u=i.horizonLineFromTop();return a.y<u}createInversionMatrix(i,a){return w5}createTileMatrix(i,a,u){let m,h,g;const b=u.canonical,E=ke.mat4.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const R=b_(b,this);m=1,h=R.x+u.wrap*R.scale,g=R.y,ke.mat4.scale(E,E,[m/R.scale,m/R.scale,i.pixelsPerMeter/a])}else m=a/i.zoomScale(b.z),h=(b.x+Math.pow(2,b.z)*u.wrap)*m,g=b.y*m;return ke.mat4.translate(E,E,[h,g,0]),ke.mat4.scale(E,E,[m/Pt,m/Pt,1]),E}upVector(i,a,u){return[0,0,1]}upVectorScale(i,a,u){return{metersToTile:1}}}class T5 extends rh{constructor(i){super(i),this.range=[4,7],this.center=i.center||[-96,37.5];const[a,u]=this.parallels=i.parallels||[29.5,45.5],m=Math.sin(Li(a));this.n=(m+Math.sin(Li(u)))/2,this.c=1+m*(2*this.n-m),this.r0=Math.sqrt(this.c)/this.n}project(i,a){const{n:u,c:m,r0:h}=this,g=Li(i-this.center[0]),b=Li(a),E=Math.sqrt(m-2*u*Math.sin(b))/u;return{x:E*Math.sin(g*u),y:E*Math.cos(g*u)-h,z:0}}unproject(i,a){const{n:u,c:m,r0:h}=this,g=h+a;let b=Math.atan2(i,Math.abs(g))*Math.sign(g);g*u<0&&(b-=Math.PI*Math.sign(i)*Math.sign(g));const E=Li(this.center[0])*u;b=Ps(b,-Math.PI-E,Math.PI-E);const R=bi(vr(b/u)+this.center[0],-180,180),v=Math.asin(bi((m-(i*i+g*g)*u*u)/(2*u),-1,1)),S=bi(vr(v),-Zn,Zn);return new Gi(R,S)}}const w_=1.340264,T_=-.081106,E_=893e-6,S_=.003796,Dv=Math.sqrt(3)/2;class E5 extends rh{project(i,a){a=a/180*Math.PI,i=i/180*Math.PI;const u=Math.asin(Dv*Math.sin(a)),m=u*u,h=m*m*m;return{x:.5*(i*Math.cos(u)/(Dv*(w_+3*T_*m+h*(7*E_+9*S_*m)))/Math.PI+.5),y:1-.5*(u*(w_+T_*m+h*(E_+S_*m))/Math.PI+1),z:0}}unproject(i,a){i=(2*i-.5)*Math.PI;let u=a=(2*(1-a)-1)*Math.PI,m=u*u,h=m*m*m;for(let v,S,C,T=0;T<12&&(S=u*(w_+T_*m+h*(E_+S_*m))-a,C=w_+3*T_*m+h*(7*E_+9*S_*m),v=S/C,u=bi(u-v,-Math.PI/3,Math.PI/3),m=u*u,h=m*m*m,!(Math.abs(v)<1e-12));++T);const g=Dv*i*(w_+3*T_*m+h*(7*E_+9*S_*m))/Math.cos(u),b=Math.asin(Math.sin(u)/Dv),E=bi(180*g/Math.PI,-180,180),R=bi(180*b/Math.PI,-Zn,Zn);return new Gi(E,R)}}class S5 extends rh{constructor(i){super(i),this.wrap=!0,this.supportsWorldCopies=!0}project(i,a){return{x:.5+i/360,y:.5-a/360,z:0}}unproject(i,a){const u=360*(i-.5),m=bi(360*(.5-a),-Zn,Zn);return new Gi(u,m)}}const Cp=Math.PI/2;function Pv(c){return Math.tan((Cp+c)/2)}class A5 extends rh{constructor(i){super(i),this.center=i.center||[0,30];const[a,u]=this.parallels=i.parallels||[30,30];let m=Li(a),h=Li(u);this.southernCenter=m+h<0,this.southernCenter&&(m=-m,h=-h);const g=Math.cos(m),b=Pv(m);this.n=m===h?Math.sin(m):Math.log(g/Math.cos(h))/Math.log(Pv(h)/b),this.f=g*Math.pow(Pv(m),this.n)/this.n}project(i,a){a=Li(a),this.southernCenter&&(a=-a),i=Li(i-this.center[0]);const u=1e-6,{n:m,f:h}=this;h>0?a<-Cp+u&&(a=-Cp+u):a>Cp-u&&(a=Cp-u);const g=h/Math.pow(Pv(a),m);let b=g*Math.sin(m*i),E=h-g*Math.cos(m*i);return b=.5*(b/Math.PI+.5),E=.5*(E/Math.PI+.5),{x:b,y:this.southernCenter?E:1-E,z:0}}unproject(i,a){i=(2*i-.5)*Math.PI,this.southernCenter&&(a=1-a),a=(2*(1-a)-.5)*Math.PI;const{n:u,f:m}=this,h=m-a,g=Math.sign(h),b=Math.sign(u)*Math.sqrt(i*i+h*h);let E=Math.atan2(i,Math.abs(h))*g;h*u<0&&(E-=Math.PI*Math.sign(i)*g);const R=bi(vr(E/u)+this.center[0],-180,180),v=bi(vr(2*Math.atan(Math.pow(m/b,1/u))-Cp),-Zn,Zn);return new Gi(R,this.southernCenter?-v:v)}}class WM extends rh{constructor(i){super(i),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(i,a){return{x:Mo(i),y:io(a),z:0}}unproject(i,a){const u=ra(i),m=Hr(a);return new Gi(u,m)}}const XM=Li(Zn);class I5 extends rh{project(i,a){const u=(a=Li(a))*a,m=u*u;return{x:.5*((i=Li(i))*(.8707-.131979*u+m*(m*(.003971*u-.001529*m)-.013791))/Math.PI+.5),y:1-.5*(a*(1.007226+u*(.015085+m*(.028874*u-.044475-.005916*m)))/Math.PI+1),z:0}}unproject(i,a){i=(2*i-.5)*Math.PI;let u=a=(2*(1-a)-1)*Math.PI,m=25,h=0,g=u*u;do{g=u*u;const R=g*g;h=(u*(1.007226+g*(.015085+R*(.028874*g-.044475-.005916*R)))-a)/(1.007226+g*(.045255+R*(.259866*g-.311325-.005916*11*R))),u=bi(u-h,-XM,XM)}while(Math.abs(h)>1e-6&&--m>0);g=u*u;const b=bi(vr(i/(.8707+g*(g*(g*g*g*(.003971-.001529*g)-.013791)-.131979))),-180,180),E=vr(u);return new Gi(b,E)}}const YM=Li(Zn);class M5 extends rh{project(i,a){a=Li(a),i=Li(i);const u=Math.cos(a),m=2/Math.PI,h=Math.acos(u*Math.cos(i/2)),g=Math.sin(h)/h,b=.5*(i*m+2*u*Math.sin(i/2)/g)||0,E=.5*(a+Math.sin(a)/g)||0;return{x:.5*(b/Math.PI+.5),y:1-.5*(E/Math.PI+1),z:0}}unproject(i,a){let u=i=(2*i-.5)*Math.PI,m=a=(2*(1-a)-1)*Math.PI,h=25;const g=1e-6;let b=0,E=0;do{const R=Math.cos(m),v=Math.sin(m),S=2*v*R,C=v*v,T=R*R,I=Math.cos(u/2),D=Math.sin(u/2),k=2*I*D,F=D*D,q=1-T*I*I,H=q?1/q:0,U=q?Math.acos(R*I)*Math.sqrt(1/q):0,$=.5*(2*U*R*D+2*u/Math.PI)-i,Y=.5*(U*v+m)-a,ie=.5*H*(T*F+U*R*I*C)+1/Math.PI,he=H*(k*S/4-U*v*D),ue=.125*H*(S*D-U*v*T*k),ce=.5*H*(C*I+U*F*R)+.5,Ie=he*ue-ce*ie;b=(Y*he-$*ce)/Ie,E=($*ue-Y*ie)/Ie,u=bi(u-b,-Math.PI,Math.PI),m=bi(m-E,-YM,YM)}while((Math.abs(b)>g||Math.abs(E)>g)&&--h>0);return new Gi(vr(u),vr(m))}}class KM extends rh{constructor(i){super(i),this.center=i.center||[0,0],this.parallels=i.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Li(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(i,a){const{scale:u,cosPhi:m}=this;return{x:Li(i)*m*u+.5,y:-Math.sin(Li(a))/m*u+.5,z:0}}unproject(i,a){const{scale:u,cosPhi:m}=this,h=-(a-.5)/u,g=bi(vr((i-.5)/u)/m,-180,180),b=Math.asin(bi(h*m,-1,1)),E=bi(vr(b),-Zn,Zn);return new Gi(g,E)}}class C5 extends WM{constructor(i){super(i),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(i,a,u){const m=ln(i,a,u),h=Cr(dr(u));return ke.vec3.transformMat4(m,m,h),{x:m[0],y:m[1],z:m[2]}}locationPoint(i,a){const u=Uc(a.lat,a.lng),m=ke.vec3.normalize([],u),h=i.elevation?i.elevation.getAtPointOrZero(i.locationCoordinate(a),i._centerAltitude):i._centerAltitude,g=Ts(1,0)*Pt*h;ke.vec3.scaleAndAdd(u,u,m,g);const b=ke.mat4.identity(new Float64Array(16));return ke.mat4.multiply(b,i.pixelMatrix,i.globeMatrix),ke.vec3.transformMat4(u,u,b),new St(u[0],u[1])}pixelsPerMeter(i,a){return Ts(1,0)*a}pixelSpaceConversion(i,a,u){const m=Ts(1,i)*a,h=ei(Ts(1,45)*a,m,u);return this.pixelsPerMeter(i,a)/h}createTileMatrix(i,a,u){const m=un(dr(u.canonical));return ke.mat4.multiply(new Float64Array(16),i.globeMatrix,m)}createInversionMatrix(i,a){const{center:u}=i,m=Cr(dr(a));return ke.mat4.rotateY(m,m,Li(u.lng)),ke.mat4.rotateX(m,m,Li(u.lat)),ke.mat4.scale(m,m,[i._pixelsPerMercatorPixel,i._pixelsPerMercatorPixel,1]),Float32Array.from(m)}pointCoordinate(i,a,u,m){return Yi(i,a,u,!0)||new o(0,0)}pointCoordinate3D(i,a,u){const m=this.pointCoordinate(i,a,u,0);return[m.x,m.y,m.z]}isPointAboveHorizon(i,a){return!Yi(i,a.x,a.y,!1)}farthestPixelDistance(i){const a=function(m,h){const g=m.cameraToCenterDistance,b=m._centerAltitude*h,E=m._camera,R=m._camera.forward(),v=ke.vec3.add([],ke.vec3.scale([],R,-g),[0,0,b]),S=m.worldSize/(2*Math.PI),C=[0,0,-S],T=m.width/m.height,I=Math.tan(m.fovAboveCenter),D=ke.vec3.scale([],E.up(),I),k=ke.vec3.scale([],E.right(),I*T),F=ke.vec3.normalize([],ke.vec3.add([],ke.vec3.add([],R,D),k)),q=[];let H;if(new fi(v,F).closestPointOnSphere(C,S,q)){const U=ke.vec3.add([],q,C),$=ke.vec3.sub([],U,v);H=Math.cos(m.fovAboveCenter)*ke.vec3.length($)}else{const U=ke.vec3.sub([],v,C),$=ke.vec3.sub([],C,v);ke.vec3.normalize($,$);const Y=ke.vec3.length(U)-S;H=Math.sqrt(Y*(Y+2*S));const ie=Math.acos(H/(S+Y))-Math.acos(ke.vec3.dot(R,$));H*=Math.cos(ie)}return 1.01*H}(i,this.pixelsPerMeter(i.center.lat,i.worldSize)),u=Fs(i.zoom);if(u>0){const m=$M(i,Ts(1,i.center.lat)*i.worldSize),h=i.worldSize/(2*Math.PI),g=Math.max(i.width,i.height)/i.worldSize*Math.PI;return ei(a,m+h*(1-Math.cos(g)),Math.pow(u,10))}return a}upVector(i,a,u){return ln(a,u,i,1)}upVectorScale(i){return{metersToTile:Di(Bi(dr(i)))}}}function QM(c){const i=c.parallels,a=!!i&&Math.abs(i[0]+i[1])<.01;switch(c.name){case"mercator":return new WM(c);case"equirectangular":return new S5(c);case"naturalEarth":return new I5(c);case"equalEarth":return new E5(c);case"winkelTripel":return new M5(c);case"albers":return a?new KM(c):new T5(c);case"lambertConformalConic":return a?new KM(c):new A5(c);case"globe":return new C5(c)}throw new Error(`Invalid projection name: ${c.name}`)}const R5=Ep.VectorTileFeature.types,D5=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Lv(c,i,a,u,m,h,g,b,E,R,v,S,C){const T=b?Math.min(nh,Math.round(b[0])):0,I=b?Math.min(nh,Math.round(b[1])):0;c.emplaceBack(i,a,Math.round(32*u),Math.round(32*m),h,g,(T<<1)+(E?1:0),I,16*R,16*v,256*S,256*C)}function zv(c,i,a){c.emplaceBack(i,a)}function Ov(c,i,a,u,m,h,g){c.emplaceBack(i,a,u,m,h,g)}function kv(c,i,a,u,m){c.emplaceBack(i,a,u,m),c.emplaceBack(i,a,u,m),c.emplaceBack(i,a,u,m),c.emplaceBack(i,a,u,m)}function P5(c){for(const i of c.sections)if(Pg(i.text))return!0;return!1}class Xw{constructor(i){this.layoutVertexArray=new Vg,this.indexArray=new Gr,this.programConfigurations=i,this.segments=new $n,this.dynamicLayoutVertexArray=new Nc,this.opacityVertexArray=new jg,this.placedSymbolArray=new tv,this.iconTransitioningVertexArray=new Zl,this.globeExtVertexArray=new Ug,this.zOffsetVertexArray=new Pd}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(i,a,u,m,h){this.isEmpty()||(u&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,XF.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,a),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,KF.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,D5,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=i.createVertexBuffer(this.iconTransitioningVertexArray,JF.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=i.createVertexBuffer(this.globeExtVertexArray,YF.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||h)&&(this.zOffsetVertexBuffer=i.createVertexBuffer(this.zOffsetVertexArray,QF.members,!0)),this.opacityVertexBuffer.itemSize=1),(u||m)&&this.programConfigurations.upload(i))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Gt(Xw,"SymbolBuffers");class Yw{constructor(i,a,u){this.layoutVertexArray=new i,this.layoutAttributes=a,this.indexArray=new u,this.segments=new $n,this.collisionVertexArray=new Hg,this.collisionVertexArrayExt=new Nc}upload(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,e5.members,!0),this.collisionVertexBufferExt=i.createVertexBuffer(this.collisionVertexArrayExt,t5.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Gt(Yw,"CollisionBuffers");class Nv{constructor(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.lut=i.lut,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(g=>g.fqid),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ke.mat4.identity([]),this.placementViewportMatrix=ke.mat4.identity([]);const a=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Bw(this.zoom,a["text-size"]),this.iconSizeData=Bw(this.zoom,a["icon-size"]);const u=this.layers[0].layout,m=u.get("symbol-sort-key"),h=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=h!=="viewport-y"&&m.constantOr(1)!==void 0,this.sortFeaturesByY=(h==="viewport-y"||h==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=u.get("text-writing-mode").map(g=>no[g]),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=i.sourceID,this.projection=i.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=u.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new Xw(new Yl(this.layers,{zoom:this.zoom,lut:this.lut},i=>i.startsWith("text")||i.startsWith("symbol"))),this.icon=new Xw(new Yl(this.layers,{zoom:this.zoom,lut:this.lut},i=>i.startsWith("icon")||i.startsWith("symbol"))),this.glyphOffsetArray=new rv,this.lineVertexArray=new sv,this.symbolInstances=new nv}calculateGlyphDependencies(i,a,u,m,h){for(const g of i){const b=g.codePointAt(0);if(b===void 0)break;if(a[b]=!0,m&&h&&b<=65535){const E=m_[g];E&&(a[E.charCodeAt(0)]=!0)}}}updateFootprints(i,a){}updateReplacement(i,a){if(a.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=a.updateTime;const u=a.getReplacementRegionsForTile(i.toUnwrapped(),!0);return!Dw(this.activeReplacements,u)&&(this.activeReplacements=u,!0)}populate(i,a,u,m){const h=this.layers[0],g=h.layout,b=this.projection.name==="globe",E=g.get("text-font"),R=g.get("text-field"),v=g.get("icon-image"),[S,C]=g.get("icon-size-scale-range"),T=bi(a.scaleFactor||1,S,C),I=(R.value.kind!=="constant"||R.value.value instanceof br&&!R.value.value.isEmpty()||R.value.value.toString().length>0)&&(E.value.kind!=="constant"||E.value.value.length>0),D=v.value.kind!=="constant"||!!v.value.value||Object.keys(v.parameters).length>0,k=g.get("symbol-sort-key");if(this.features=[],!I&&!D)return;const F=a.iconDependencies,q=a.glyphDependencies,H=a.availableImages,U=new vn(this.zoom);for(const{feature:$,id:Y,index:ie,sourceLayerIndex:he}of i){const ue=h._featureFilter.needGeometry,ce=B($,ue);if(!h._featureFilter.filter(U,ce,u))continue;if(ue||(ce.geometry=O($,u,m)),b&&$.type!==1&&u.z<=5){const Pe=ce.geometry,Ne=.98078528056,qe=(Ze,Be)=>{const ct=ln(Ze.x,Ze.y,u,1),yt=ln(Be.x,Be.y,u,1);return ke.vec3.dot(ct,yt)<Ne};for(let Ze=0;Ze<Pe.length;Ze++)Pe[Ze]=w(Pe[Ze],qe)}let Ie,de;if(I){const Pe=h.getValueAndResolveTokens("text-field",ce,u,H),Ne=br.factory(Pe);P5(Ne)&&(this.hasRTLText=!0),(!this.hasRTLText||sp()==="unavailable"||this.hasRTLText&&xa.isParsed())&&(Ie=r5(Ne,h,ce))}if(D){const Pe=h.getValueAndResolveTokens("icon-image",ce,u,H);de=Pe instanceof Fn?Pe:Fn.build(Pe)}if(!Ie&&!de)continue;const Me=this.sortFeaturesByKey?k.evaluate(ce,{},u):void 0,ze={id:Y,text:Ie,icon:de,index:ie,sourceLayerIndex:he,geometry:ce.geometry,properties:$.properties,type:R5[$.type],sortKey:Me};if(this.features.push(ze),de){const Pe=Fw(this.iconSizeData,this.layers[0]._unevaluatedLayout._values["icon-size"],u,this.zoom,ze)*T*this.pixelRatio,Ne=de.getPrimary().scaleSelf(Pe);if(F[Ne.id]=F[Ne.id]||[],F[Ne.id].push(Ne),de.nameSecondary){const qe=de.getSecondary().scaleSelf(Pe);F[qe.id]=F[qe.id]||[],F[qe.id].push(qe)}}if(Ie){const Pe=E.evaluate(ce,{},u).join(","),Ne=g.get("text-rotation-alignment")==="map"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(no.vertical)>=0;for(const qe of Ie.sections)if(qe.image){const Ze=qe.image.getPrimary().scaleSelf(this.pixelRatio);F[Ze.id]=F[Ze.id]||[],F[Ze.id].push(Ze)}else{const Ze=Cg(Ie.toString()),Be=qe.fontStack||Pe,ct=q[Be]=q[Be]||{};this.calculateGlyphDependencies(qe.text,ct,Ne,this.allowVerticalPlacement,Ze)}}}g.get("symbol-placement")==="line"&&(this.features=function($){const Y={},ie={},he=[];let ue=0;function ce(ze){he.push($[ze]),ue++}function Ie(ze,Pe,Ne){const qe=ie[ze];return delete ie[ze],ie[Pe]=qe,he[qe].geometry[0].pop(),he[qe].geometry[0]=he[qe].geometry[0].concat(Ne[0]),qe}function de(ze,Pe,Ne){const qe=Y[Pe];return delete Y[Pe],Y[ze]=qe,he[qe].geometry[0].shift(),he[qe].geometry[0]=Ne[0].concat(he[qe].geometry[0]),qe}function Me(ze,Pe,Ne){const qe=Ne?Pe[0][Pe[0].length-1]:Pe[0][0];return`${ze}:${qe.x}:${qe.y}`}for(let ze=0;ze<$.length;ze++){const Pe=$[ze],Ne=Pe.geometry,qe=Pe.text?Pe.text.toString():null;if(!qe){ce(ze);continue}const Ze=Me(qe,Ne),Be=Me(qe,Ne,!0);if(Ze in ie&&Be in Y&&ie[Ze]!==Y[Be]){const ct=de(Ze,Be,Ne),yt=Ie(Ze,Be,he[ct].geometry);delete Y[Ze],delete ie[Be],ie[Me(qe,he[yt].geometry,!0)]=yt,he[ct].geometry=null}else Ze in ie?Ie(Ze,Be,Ne):Be in Y?de(Ze,Be,Ne):(ce(ze),Y[Ze]=ue-1,ie[Be]=ue-1)}return he.filter(ze=>ze.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort(($,Y)=>$.sortKey-Y.sortKey)}update(i,a,u,m,h,g,b){this.text.programConfigurations.updatePaintArrays(i,a,h,u,m,g,b),this.icon.programConfigurations.updatePaintArrays(i,a,h,u,m,g,b)}updateZOffset(){const i=(h,g,b)=>{u+=g,u>h.length&&h.resize(u);for(let E=-g;E<0;E++)h.emplace(E+u,b)},a=(h,g,b)=>{m+=g,m>h.length&&h.resize(m);for(let E=-g;E<0;E++)h.emplace(E+m,b)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let u=0,m=0;for(let h=0;h<this.symbolInstances.length;h++){const g=this.symbolInstances.get(h),{numHorizontalGlyphVertices:b,numVerticalGlyphVertices:E,numIconVertices:R}=g,v=g.zOffset,S=R>0;if((b>0||E>0)&&(i(this.text.zOffsetVertexArray,b,v),i(this.text.zOffsetVertexArray,E,v)),S){const{placedIconSymbolIndex:C,verticalPlacedIconSymbolIndex:T}=g;C>=0&&a(this.icon.zOffsetVertexArray,R,v),T>=0&&a(this.icon.zOffsetVertexArray,g.numVerticalIconVertices,v)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=QM(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,a){const u=this.lineVertexArray.length;if(i.segment!==void 0)for(const{x:m,y:h}of a)this.lineVertexArray.emplaceBack(m,h);return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(i,a,u,m,h,g,b,E,R,v,S,C,T,I,D,k){const F=i.indexArray,q=i.layoutVertexArray,H=i.globeExtVertexArray,U=i.segments.prepareSegment(4*a.length,q,F,this.canOverlap?g.sortKey:void 0),$=this.glyphOffsetArray.length,Y=U.vertexLength,ie=this.allowVerticalPlacement&&b===no.vertical?Math.PI/2:0,he=g.text&&g.text.sections;for(let ce=0;ce<a.length;ce++){const{tl:Ie,tr:de,bl:Me,br:ze,texPrimary:Pe,texSecondary:Ne,pixelOffsetTL:qe,pixelOffsetBR:Ze,minFontScaleX:Be,minFontScaleY:ct,glyphOffset:yt,isSDF:lt,sectionIndex:Lt}=a[ce],Dt=U.vertexLength,wt=yt[1];if(Lv(q,R.x,R.y,Ie.x,wt+Ie.y,Pe.x,Pe.y,u,lt,qe.x,qe.y,Be,ct),Lv(q,R.x,R.y,de.x,wt+de.y,Pe.x+Pe.w,Pe.y,u,lt,Ze.x,qe.y,Be,ct),Lv(q,R.x,R.y,Me.x,wt+Me.y,Pe.x,Pe.y+Pe.h,u,lt,qe.x,Ze.y,Be,ct),Lv(q,R.x,R.y,ze.x,wt+ze.y,Pe.x+Pe.w,Pe.y+Pe.h,u,lt,Ze.x,Ze.y,Be,ct),E){const{x:vt,y:Zt,z:zt}=E.anchor,[Ft,hi,xi]=E.up;Ov(H,vt,Zt,zt,Ft,hi,xi),Ov(H,vt,Zt,zt,Ft,hi,xi),Ov(H,vt,Zt,zt,Ft,hi,xi),Ov(H,vt,Zt,zt,Ft,hi,xi),kv(i.dynamicLayoutVertexArray,vt,Zt,zt,ie)}else kv(i.dynamicLayoutVertexArray,R.x,R.y,R.z,ie);if(k){const vt=Ne||Pe;zv(i.iconTransitioningVertexArray,vt.x,vt.y),zv(i.iconTransitioningVertexArray,vt.x+vt.w,vt.y),zv(i.iconTransitioningVertexArray,vt.x,vt.y+vt.h),zv(i.iconTransitioningVertexArray,vt.x+vt.w,vt.y+vt.h)}F.emplaceBack(Dt,Dt+1,Dt+2),F.emplaceBack(Dt+1,Dt+2,Dt+3),U.vertexLength+=4,U.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(yt[0]),ce!==a.length-1&&Lt===a[ce+1].sectionIndex||i.programConfigurations.populatePaintArrays(q.length,g,g.index,{},T,I,D,he&&he[Lt])}const ue=E?E.anchor:R;i.placedSymbolArray.emplaceBack(ue.x,ue.y,ue.z,R.x,R.y,$,this.glyphOffsetArray.length-$,Y,v,S,R.segment,u?u[0]:0,u?u[1]:0,m[0],m[1],b,0,!1,0,C,0)}_commitLayoutVertex(i,a,u,m,h,g,b){i.emplaceBack(a,u,m,h,g,Math.round(b.x),Math.round(b.y))}_addCollisionDebugVertices(i,a,u,m,h,g,b){const E=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),R=E.vertexLength,v=b.tileAnchorX,S=b.tileAnchorY;for(let T=0;T<4;T++)u.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(u.collisionVertexArrayExt,a,i.padding,b.zOffset),this._commitLayoutVertex(u.layoutVertexArray,m,h,g,v,S,new St(i.x1,i.y1)),this._commitLayoutVertex(u.layoutVertexArray,m,h,g,v,S,new St(i.x2,i.y1)),this._commitLayoutVertex(u.layoutVertexArray,m,h,g,v,S,new St(i.x2,i.y2)),this._commitLayoutVertex(u.layoutVertexArray,m,h,g,v,S,new St(i.x1,i.y2)),E.vertexLength+=4;const C=u.indexArray;C.emplaceBack(R,R+1),C.emplaceBack(R+1,R+2),C.emplaceBack(R+2,R+3),C.emplaceBack(R+3,R),E.primitiveLength+=4}_addTextDebugCollisionBoxes(i,a,u,m,h,g){for(let b=m;b<h;b++){const E=u.get(b),R=this.getSymbolInstanceTextSize(i,g,a,b);this._addCollisionDebugVertices(E,R,this.textCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,g)}}_addIconDebugCollisionBoxes(i,a,u,m,h,g){for(let b=m;b<h;b++){const E=u.get(b),R=this.getSymbolInstanceIconSize(i,a,g.placedIconSymbolIndex);this._addCollisionDebugVertices(E,R,this.iconCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,g)}}generateCollisionDebugBuffers(i,a,u){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Yw(fp,vM.members,Zl),this.iconCollisionBox=new Yw(fp,vM.members,Zl);const m=Sp(this.iconSizeData,i),h=Sp(this.textSizeData,i,u);for(let g=0;g<this.symbolInstances.length;g++){const b=this.symbolInstances.get(g);this._addTextDebugCollisionBoxes(h,i,a,b.textBoxStartIndex,b.textBoxEndIndex,b),this._addTextDebugCollisionBoxes(h,i,a,b.verticalTextBoxStartIndex,b.verticalTextBoxEndIndex,b),this._addIconDebugCollisionBoxes(m,i,a,b.iconBoxStartIndex,b.iconBoxEndIndex,b),this._addIconDebugCollisionBoxes(m,i,a,b.verticalIconBoxStartIndex,b.verticalIconBoxEndIndex,b)}}getSymbolInstanceTextSize(i,a,u,m){const h=this.text.placedSymbolArray.get(a.rightJustifiedTextSymbolIndex>=0?a.rightJustifiedTextSymbolIndex:a.centerJustifiedTextSymbolIndex>=0?a.centerJustifiedTextSymbolIndex:a.leftJustifiedTextSymbolIndex>=0?a.leftJustifiedTextSymbolIndex:a.verticalPlacedTextSymbolIndex>=0?a.verticalPlacedTextSymbolIndex:m),g=Ev(this.textSizeData,i,h)/fs;return this.tilePixelRatio*g}getSymbolInstanceIconSize(i,a,u){const m=this.icon.placedSymbolArray.get(u),h=Ev(this.iconSizeData,i,m);return this.tilePixelRatio*h}_commitDebugCollisionVertexUpdate(i,a,u,m){i.emplaceBack(a,-u,-u,m),i.emplaceBack(a,u,-u,m),i.emplaceBack(a,u,u,m),i.emplaceBack(a,-u,u,m)}_updateTextDebugCollisionBoxes(i,a,u,m,h,g,b){for(let E=m;E<h;E++){const R=u.get(E),v=this.getSymbolInstanceTextSize(i,g,a,E);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,v,R.padding,g.zOffset)}}_updateIconDebugCollisionBoxes(i,a,u,m,h,g,b){for(let E=m;E<h;E++){const R=u.get(E),v=this.getSymbolInstanceIconSize(i,a,g.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,v,R.padding,g.zOffset)}}updateCollisionDebugBuffers(i,a,u,m){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const h=Sp(this.iconSizeData,i,m),g=Sp(this.textSizeData,i,u);for(let b=0;b<this.symbolInstances.length;b++){const E=this.symbolInstances.get(b);this._updateTextDebugCollisionBoxes(g,i,a,E.textBoxStartIndex,E.textBoxEndIndex,E,u),this._updateTextDebugCollisionBoxes(g,i,a,E.verticalTextBoxStartIndex,E.verticalTextBoxEndIndex,E,u),this._updateIconDebugCollisionBoxes(h,i,a,E.iconBoxStartIndex,E.iconBoxEndIndex,E,m),this._updateIconDebugCollisionBoxes(h,i,a,E.verticalIconBoxStartIndex,E.verticalIconBoxEndIndex,E,m)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(i,a,u,m,h,g,b,E,R){const v={};if(a<u){const{x1:S,y1:C,x2:T,y2:I,padding:D,projectedAnchorX:k,projectedAnchorY:F,projectedAnchorZ:q,tileAnchorX:H,tileAnchorY:U,featureIndex:$}=i.get(a);v.textBox={x1:S,y1:C,x2:T,y2:I,padding:D,projectedAnchorX:k,projectedAnchorY:F,projectedAnchorZ:q,tileAnchorX:H,tileAnchorY:U},v.textFeatureIndex=$}if(m<h){const{x1:S,y1:C,x2:T,y2:I,padding:D,projectedAnchorX:k,projectedAnchorY:F,projectedAnchorZ:q,tileAnchorX:H,tileAnchorY:U,featureIndex:$}=i.get(m);v.verticalTextBox={x1:S,y1:C,x2:T,y2:I,padding:D,projectedAnchorX:k,projectedAnchorY:F,projectedAnchorZ:q,tileAnchorX:H,tileAnchorY:U},v.verticalTextFeatureIndex=$}if(g<b){const{x1:S,y1:C,x2:T,y2:I,padding:D,projectedAnchorX:k,projectedAnchorY:F,projectedAnchorZ:q,tileAnchorX:H,tileAnchorY:U,featureIndex:$}=i.get(g);v.iconBox={x1:S,y1:C,x2:T,y2:I,padding:D,projectedAnchorX:k,projectedAnchorY:F,projectedAnchorZ:q,tileAnchorX:H,tileAnchorY:U},v.iconFeatureIndex=$}if(E<R){const{x1:S,y1:C,x2:T,y2:I,padding:D,projectedAnchorX:k,projectedAnchorY:F,projectedAnchorZ:q,tileAnchorX:H,tileAnchorY:U,featureIndex:$}=i.get(E);v.verticalIconBox={x1:S,y1:C,x2:T,y2:I,padding:D,projectedAnchorX:k,projectedAnchorY:F,projectedAnchorZ:q,tileAnchorX:H,tileAnchorY:U},v.verticalIconFeatureIndex=$}return v}deserializeCollisionBoxes(i){this.collisionArrays=[];for(let a=0;a<this.symbolInstances.length;a++){const u=this.symbolInstances.get(a);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(i,a){const u=i.placedSymbolArray.get(a),m=u.vertexStartIndex+4*u.numGlyphs;for(let h=u.vertexStartIndex;h<m;h+=4)i.indexArray.emplaceBack(h,h+1,h+2),i.indexArray.emplaceBack(h+1,h+2,h+3)}getSortedSymbolIndexes(i){if(this.sortedAngle===i&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const a=Math.sin(i),u=Math.cos(i),m=[],h=[],g=[];for(let b=0;b<this.symbolInstances.length;++b){g.push(b);const E=this.symbolInstances.get(b);m.push(0|Math.round(a*E.tileAnchorX+u*E.tileAnchorY)),h.push(E.featureIndex)}return g.sort((b,E)=>m[b]-m[E]||h[E]-h[b]),g}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let i=0;i<this.symbolInstances.length;++i)this.symbolInstanceIndexesSortedZOffset.push(i)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((i,a)=>this.symbolInstances.get(a).zOffset-this.symbolInstances.get(i).zOffset)}addToSortKeyRanges(i,a){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===a?u.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:a,symbolInstanceStart:i,symbolInstanceEnd:i+1})}sortFeatures(i){if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const a of this.symbolInstanceIndexes){const u=this.symbolInstances.get(a);this.featureSortOrder.push(u.featureIndex);const{rightJustifiedTextSymbolIndex:m,centerJustifiedTextSymbolIndex:h,leftJustifiedTextSymbolIndex:g,verticalPlacedTextSymbolIndex:b,placedIconSymbolIndex:E,verticalPlacedIconSymbolIndex:R}=u;m>=0&&this.addIndicesForPlacedSymbol(this.text,m),h>=0&&h!==m&&this.addIndicesForPlacedSymbol(this.text,h),g>=0&&g!==h&&g!==m&&this.addIndicesForPlacedSymbol(this.text,g),b>=0&&this.addIndicesForPlacedSymbol(this.text,b),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E),R>=0&&this.addIndicesForPlacedSymbol(this.icon,R)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let JM,eC,Kw;Gt(Nv,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Nv.addDynamicAttributes=kv;class tC{constructor(i){this.type=i.property.overrides?i.property.overrides.runtimeType:sl,this.defaultValue=i}evaluate(i){if(i.formattedSection){const a=this.defaultValue.property.overrides;if(a&&a.hasOverride(i.formattedSection))return a.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default}eachChild(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Gt(tC,"FormatSectionOverride",{omit:["defaultValue"]});const Qw=()=>Kw||(Kw={layout:JM||(JM=new zn({"symbol-placement":new Et(Qe.layout_symbol["symbol-placement"]),"symbol-spacing":new Et(Qe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Et(Qe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new kt(Qe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Et(Qe.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Et(Qe.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Et(Qe.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Et(Qe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Et(Qe.layout_symbol["icon-ignore-placement"]),"icon-optional":new Et(Qe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Et(Qe.layout_symbol["icon-rotation-alignment"]),"icon-size":new kt(Qe.layout_symbol["icon-size"]),"icon-size-scale-range":new Et(Qe.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new kt(Qe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new kt(Qe.layout_symbol["icon-text-fit-padding"]),"icon-image":new kt(Qe.layout_symbol["icon-image"]),"icon-rotate":new kt(Qe.layout_symbol["icon-rotate"]),"icon-padding":new Et(Qe.layout_symbol["icon-padding"]),"icon-keep-upright":new Et(Qe.layout_symbol["icon-keep-upright"]),"icon-offset":new kt(Qe.layout_symbol["icon-offset"]),"icon-anchor":new kt(Qe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Et(Qe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Et(Qe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Et(Qe.layout_symbol["text-rotation-alignment"]),"text-field":new kt(Qe.layout_symbol["text-field"]),"text-font":new kt(Qe.layout_symbol["text-font"]),"text-size":new kt(Qe.layout_symbol["text-size"]),"text-size-scale-range":new Et(Qe.layout_symbol["text-size-scale-range"]),"text-max-width":new kt(Qe.layout_symbol["text-max-width"]),"text-line-height":new kt(Qe.layout_symbol["text-line-height"]),"text-letter-spacing":new kt(Qe.layout_symbol["text-letter-spacing"]),"text-justify":new kt(Qe.layout_symbol["text-justify"]),"text-radial-offset":new kt(Qe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Et(Qe.layout_symbol["text-variable-anchor"]),"text-anchor":new kt(Qe.layout_symbol["text-anchor"]),"text-max-angle":new Et(Qe.layout_symbol["text-max-angle"]),"text-writing-mode":new Et(Qe.layout_symbol["text-writing-mode"]),"text-rotate":new kt(Qe.layout_symbol["text-rotate"]),"text-padding":new Et(Qe.layout_symbol["text-padding"]),"text-keep-upright":new Et(Qe.layout_symbol["text-keep-upright"]),"text-transform":new kt(Qe.layout_symbol["text-transform"]),"text-offset":new kt(Qe.layout_symbol["text-offset"]),"text-allow-overlap":new Et(Qe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Et(Qe.layout_symbol["text-ignore-placement"]),"text-optional":new Et(Qe.layout_symbol["text-optional"]),visibility:new Et(Qe.layout_symbol.visibility)})),paint:eC||(eC=new zn({"icon-opacity":new kt(Qe.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new kt(Qe.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new kt(Qe.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new kt(Qe.paint_symbol["text-emissive-strength"]),"icon-color":new kt(Qe.paint_symbol["icon-color"]),"icon-halo-color":new kt(Qe.paint_symbol["icon-halo-color"]),"icon-halo-width":new kt(Qe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new kt(Qe.paint_symbol["icon-halo-blur"]),"icon-translate":new Et(Qe.paint_symbol["icon-translate"]),"icon-translate-anchor":new Et(Qe.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new kt(Qe.paint_symbol["icon-image-cross-fade"]),"text-opacity":new kt(Qe.paint_symbol["text-opacity"]),"text-occlusion-opacity":new kt(Qe.paint_symbol["text-occlusion-opacity"]),"text-color":new kt(Qe.paint_symbol["text-color"],{runtimeType:jr,getOverride:c=>c.textColor,hasOverride:c=>!!c.textColor}),"text-halo-color":new kt(Qe.paint_symbol["text-halo-color"]),"text-halo-width":new kt(Qe.paint_symbol["text-halo-width"]),"text-halo-blur":new kt(Qe.paint_symbol["text-halo-blur"]),"text-translate":new Et(Qe.paint_symbol["text-translate"]),"text-translate-anchor":new Et(Qe.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Et(Qe.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Et(Qe.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Et(Qe.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Et(Qe.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new kt(Qe.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},Kw);class Fv extends Nr{constructor(i,a,u,m){super(i,Qw(),a,u,m),this._colorAdjustmentMatrix=ke.mat4.identity([]),this.hasInitialOcclusionOpacityProperties=i.paint!==void 0&&("icon-occlusion-opacity"in i.paint||"text-occlusion-opacity"in i.paint)}recalculate(i,a){super.recalculate(i,a),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const u=this.layout.get("text-writing-mode");if(u){const m=[];for(const h of u)m.indexOf(h)<0&&m.push(h);this.layout._values["text-writing-mode"]=m}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(i,a,u,m){return this._saturation===i&&this._contrast===a&&this._brightnessMin===u&&this._brightnessMax===m||(this._colorAdjustmentMatrix=function(h,g,b,E){h=xo(h),g=yc(g);const R=ke.mat4.create(),v=h/3,S=1-2*v,C=[S,v,v,0,v,S,v,0,v,v,S,0,0,0,0,1],T=.5-.5*g,I=E-b;return ke.mat4.multiply(R,[I,0,0,0,0,I,0,0,0,0,I,0,b,b,b,1],[g,0,0,0,0,g,0,0,0,0,g,0,T,T,T,1]),ke.mat4.multiply(R,R,C),R}(i,a,u,m),this._saturation=i,this._contrast=a,this._brightnessMin=u,this._brightnessMax=m),this._colorAdjustmentMatrix}getValueAndResolveTokens(i,a,u,m){const h=this.layout.get(i).evaluate(a,{},u,m),g=this._unevaluatedLayout._values[i];return g.isDataDriven()||Fu(g.value)||!h?h:function(b,E){return E.replace(/{([^{}]+)}/g,(R,v)=>v in b?String(b[v]):"")}(a.properties,h)}createBucket(i){return new Nv(i)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const i of Qw().paint.overridableProperties){if(!Fv.hasPaintOverride(this.layout,i))continue;const a=this.paint.get(i),u=new tC(a),m=new ep(u,a.property.specification,this.scope,this.options);let h=null;h=a.value.kind==="constant"||a.value.kind==="source"?new tp("source",m):new wd("composite",m,a.value.zoomStops,a.value._interpolationType),this.paint._values[i]=new ju(a.property,h,a.parameters)}}_handleOverridablePaintPropertyUpdate(i,a,u){return!(!this.layout||a.isDataDriven()||u.isDataDriven())&&Fv.hasPaintOverride(this.layout,i)}static hasPaintOverride(i,a){const u=i.get("text-field"),m=Qw().paint.properties[a];let h=!1;const g=b=>{for(const E of b)if(m.overrides&&m.overrides.hasOverride(E))return void(h=!0)};if(u.value.kind==="constant"&&u.value.value instanceof br)g(u.value.value.sections);else if(u.value.kind==="source"){const b=R=>{h||(R instanceof ur&&yn(R.value)===xs?g(R.value.sections):R instanceof al?g(R.sections):R.eachChild(b))},E=u.value;E._styleExpression&&b(E._styleExpression.expression)}return h}getProgramIds(){return["symbol"]}getDefaultProgramParams(i,a,u){return{config:new Vc(this,{zoom:a,lut:u}),overrideFog:!1}}}let iC,nC,rC,sC;var Jw=Xi([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function eT(c){switch(c){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function tT(c){switch(c){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class iT{constructor(i,a,u,m){this.context=i,this.format=u,this.useMipmap=m&&m.useMipmap,this.texture=i.gl.createTexture(),this.update(a,{premultiply:m&&m.premultiply})}update(i,a){const u=i&&i instanceof HTMLVideoElement&&i.width===0?i.videoWidth:i.width,m=i&&i instanceof HTMLVideoElement&&i.height===0?i.videoHeight:i.height,{context:h}=this,{gl:g}=h,{x:b,y:E}=a&&a.position?a.position:{x:0,y:0},R=b+u,v=E+m;!this.size||this.size[0]===R&&this.size[1]===v||(g.bindTexture(g.TEXTURE_2D,null),g.deleteTexture(this.texture),this.texture=g.createTexture(),this.size=null),g.bindTexture(g.TEXTURE_2D,this.texture),h.pixelStoreUnpackFlipY.set(!1),h.pixelStoreUnpack.set(1),h.pixelStoreUnpackPremultiplyAlpha.set(this.format===g.RGBA8&&(!a||a.premultiply!==!1));const S=i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||ImageBitmap&&i instanceof ImageBitmap;if(!this.size&&R>0&&v>0){const C=this.useMipmap?Math.floor(Math.log2(Math.max(R,v)))+1:1;g.texStorage2D(g.TEXTURE_2D,C,this.format,R,v),this.size=[R,v]}if(this.size)if(S)g.texSubImage2D(g.TEXTURE_2D,0,b,E,eT(this.format),tT(this.format),i);else{const C=i.data;C&&g.texSubImage2D(g.TEXTURE_2D,0,b,E,u,m,eT(this.format),tT(this.format),C)}this.useMipmap&&g.generateMipmap(g.TEXTURE_2D)}bind(i,a,u=!1){const{context:m}=this,{gl:h}=m;h.bindTexture(h.TEXTURE_2D,this.texture),i!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,i),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,this.useMipmap&&!u?i===h.NEAREST?h.NEAREST_MIPMAP_NEAREST:h.LINEAR_MIPMAP_LINEAR:i),this.minFilter=i),a!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,a),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,a),this.wrapS=a)}bindExtraParam(i,a,u,m){const{context:h}=this,{gl:g}=h;g.bindTexture(g.TEXTURE_2D,this.texture),a!==this.magFilter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,a),this.magFilter=a),i!==this.minFilter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,this.useMipmap?i===g.NEAREST?g.NEAREST_MIPMAP_NEAREST:g.LINEAR_MIPMAP_LINEAR:i),this.minFilter=i),u!==this.wrapS&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,u),this.wrapS=u),m!==this.wrapT&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,m),this.wrapT=m)}destroy(){const{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}}class Bv{constructor(i,a){this.context=i,this.texture=a}bind(i,a){const{context:u}=this,{gl:m}=u;m.bindTexture(m.TEXTURE_2D,this.texture),i!==this.minFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,i),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,i),this.minFilter=i),a!==this.wrapS&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,a),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,a),this.wrapS=a)}}function Vv(c,i,a,u,m,h,g,b){const E=[c,i,1,a,u,1,m,h,1],R=[g,b,1],v=ke.mat3.adjoint([],E),[S,C,T]=ke.vec3.transformMat3(R,R,v);return ke.mat3.multiply(E,E,[S,0,0,0,C,0,0,0,T])}function aC(c,i,a,u,m,h,g,b){const E=function(R,v,S,C,T,I,D,k){const F=Vv(0,0,1,0,1,1,0,1),q=Vv(R,v,S,C,T,I,D,k),H=ke.mat3.adjoint([],F);return ke.mat3.multiply(q,q,H)}(c,i,a,u,m,h,g,b);return[E[2]/E[8]/Pt,E[5]/E[8]/Pt]}function Uv(c){return[c[0],Math.min(Math.max(c[1],-Zn),Zn)]}class oC extends Xa{constructor(i,a,u,m){super(),this.id=i,this.dispatcher=u,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(m),this.options=a,this._dirty=!1}load(i,a){if(this._loaded=a||!1,this.fire(new zs("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return i&&(this.coordinates=i),this._loaded=!0,void this._finishLoading();this._imageRequest=Eu(this.map._requestManager.transformRequest(this.url,Ui.Image),(u,m)=>{this._imageRequest=null,this._loaded=!0,u?this.fire(new bo(u)):m&&(this.image=m instanceof HTMLImageElement?ye.getImageData(m):m,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,i&&(this.coordinates=i),this._finishLoading())})}loaded(){return this._loaded}updateImage(i){return i.url?(this._imageRequest&&i.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=i.url,this.load(i.coordinates,this._loaded),this):this}setTexture(i){if(!(i.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Bv(this.map.painter.context,i.handle),this.width=i.dimensions[0],this.height=i.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new zs("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(i){this.map=i,this.load()}onRemove(i){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Bv||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(i){if(this.coordinates=i,this._boundsArray=void 0,this._unsupportedCoords=!1,!i.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let a=i[0][1],u=i[0][1];for(const h of i)h[1]>u&&(u=h[1]),h[1]<a&&(a=h[1]);const m=(u+a)/2;if(m>Zn?this.onNorthPole=!0:m<-Zn&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const h=i.map(o.fromLngLat);this.tileID=function(g){let b=1/0,E=1/0,R=-1/0,v=-1/0;for(const D of g)b=Math.min(b,D.x),E=Math.min(E,D.y),R=Math.max(R,D.x),v=Math.max(v,D.y);const S=Math.max(R-b,v-E),C=Math.max(0,Math.floor(-Math.log(S)/Math.LN2)),T=Math.pow(2,C);let I=Math.floor((b+R)/2*T);return I>1&&(I-=1),new _t(C,I,Math.floor((E+v)/2*T))}(h),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new zs("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(i){for(const F in this.tiles){const q=this.tiles[F];q.state!=="loaded"&&(q.state="loaded",q.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const a=b_(new _t(0,0,0),this.map.transform.projection),u=[a.projection.project(this.coordinates[0][0],this.coordinates[0][1]),a.projection.project(this.coordinates[1][0],this.coordinates[1][1]),a.projection.project(this.coordinates[2][0],this.coordinates[2][1]),a.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(F){const q=F[1].x-F[0].x,H=F[1].y-F[0].y,U=F[2].x-F[1].x,$=F[2].y-F[1].y,Y=F[3].x-F[2].x,ie=F[3].y-F[2].y,he=F[0].x-F[3].x,ue=F[0].y-F[3].y,ce=q*$-U*H,Ie=U*ie-Y*$,de=Y*ue-he*ie,Me=he*H-q*ue;return ce>0&&Ie>0&&de>0&&Me>0||ce<0&&Ie<0&&de<0&&Me<0}(u))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const m=b_(this.tileID,this.map.transform.projection),[h,g,b,E]=this.coordinates.map(F=>{const q=m.projection.project(F[0],F[1]);return ZM(m,q)._round()});this.perspectiveTransform=aC(h.x,h.y,g.x,g.y,b.x,b.y,E.x,E.y);const R=this._boundsArray=new ul;R.emplaceBack(h.x,h.y,0,0),R.emplaceBack(g.x,g.y,Pt,0),R.emplaceBack(E.x,E.y,0,Pt),R.emplaceBack(b.x,b.y,Pt,Pt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=i.createVertexBuffer(R,Jw.members),this.boundsSegments=$n.simpleSegment(0,0,4,2);const v=[],S=[Uv((C=this.coordinates)[0]),Uv(C[1]),Uv(C[2]),Uv(C[3])];var C;const[T,I,D,k]=function(F){let q=F[0][0],H=q,U=F[0][1],$=U;for(let Y=1;Y<F.length;Y++)F[Y][0]<q?q=F[Y][0]:F[Y][0]>H&&(H=F[Y][0]),F[Y][1]<U?U=F[Y][1]:F[Y][1]>$&&($=F[Y][1]);return[q,U,H-q,$-U]}(S);{const F=new ul,[q,H,U,$]=function(qe){let Ze=qe[0].x,Be=Ze,ct=qe[0].y,yt=ct;for(let lt=1;lt<qe.length;lt++)qe[lt].x<Ze?Ze=qe[lt].x:qe[lt].x>Be&&(Be=qe[lt].x),qe[lt].y<ct?ct=qe[lt].y:qe[lt].y>yt&&(yt=qe[lt].y);return[Ze,ct,Be-Ze,yt-ct]}(u),Y=qe=>[(qe.x-q)/U,(qe.y-H)/$],[ie,he,ue,ce]=u.map(Y),Ie=function(qe,Ze,Be,ct,yt,lt,Lt,Dt){const wt=Vv(0,0,1,0,1,1,0,1),vt=Vv(qe,Ze,Be,ct,yt,lt,Lt,Dt),Zt=ke.mat3.adjoint([],vt);return ke.mat3.multiply(wt,wt,Zt)}(ie[0],ie[1],he[0],he[1],ue[0],ue[1],ce[0],ce[1]);this.elevatedGlobePerspectiveTransform=aC(ie[0],ie[1],he[0],he[1],ue[0],ue[1],ce[0],ce[1]);const de=(qe,Ze)=>{v.push(qe.lng);const Be=Math.round((qe.lng-T)/D*Pt),ct=Math.round((qe.lat-I)/k*Pt),yt=Y(Ze),lt=ke.vec3.transformMat3([],[yt[0],yt[1],1],Ie),Lt=Math.round(lt[0]/lt[2]*Pt),Dt=Math.round(lt[1]/lt[2]*Pt);F.emplaceBack(Be,ct,Lt,Dt)},Me=u[3].x-u[0].x,ze=u[3].y-u[0].y,Pe=u[2].x-u[1].x,Ne=u[2].y-u[1].y;for(let qe=0;qe<65;qe++){const Ze=qe/64,Be=[u[0].x+Ze*Me,u[0].y+Ze*ze],ct=[u[1].x+Ze*Pe,u[1].y+Ze*Ne],yt=ct[0]-Be[0],lt=ct[1]-Be[1];for(let Lt=0;Lt<65;Lt++){const Dt=Lt/64,wt={x:Be[0]+yt*Dt,y:Be[1]+lt*Dt,z:0};de(a.projection.unproject(wt.x,wt.y),wt)}}this.elevatedGlobeVertexBuffer=i.createVertexBuffer(F,Jw.members)}{this.maxLongitudeTriangleSize=0;let F=[],q=new Gr;const H=(U,$,Y)=>{q.emplaceBack(U,$,Y);const ie=v[U],he=v[$],ue=v[Y],ce=Math.min(Math.min(ie,he),ue),Ie=Math.max(Math.max(ie,he),ue)-ce;Ie>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Ie),F.push(ce+Ie/2)};for(let U=0;U<64;U++)for(let $=0;$<64;$++){const Y=65*U+$,ie=Y+1,he=Y+65,ue=he+1;H(Y,he,ie),H(ie,he,ue)}[F,q]=function(U,$){const Y=Array.from({length:U.length},(ue,ce)=>ce);Y.sort((ue,ce)=>U[ue]-U[ce]);const ie=[],he=new Gr;for(let ue=0;ue<Y.length;ue++){const ce=Y[ue];ie.push(U[ce]);const Ie=3*ce,de=Ie+1;he.emplaceBack($.uint16[Ie],$.uint16[de],$.uint16[de+1])}return[ie,he]}(F,q),this.elevatedGlobeTrianglesCenterLongitudes=F,this.elevatedGlobeIndexBuffer=i.createIndexBuffer(q)}this.elevatedGlobeSegments=$n.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,D/Pt,0,k/Pt,0,0,I,T,0])}prepare(){const i=Object.keys(this.tiles).length!==0;if(this.tileID&&!i)return;const a=this.map.painter.context,u=a.gl;!this._dirty||this.texture instanceof Bv||(this.texture?this.texture.update(this.image):(this.texture=new iT(a,this.image,u.RGBA8),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE)),this._dirty=!1),i&&this._prepareData(a)}loadTile(i,a){this.tileID&&this.tileID.equals(i.tileID.canonical)?(this.tiles[String(i.tileID.wrap)]=i,i.buckets={},a(null)):(i.state="errored",a(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(i){const a=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!a)return null;const u=this.elevatedGlobeTrianglesCenterLongitudes;let m=(h=i+180)+360*Math.round((u[0]-h)/360);var h;const g=new $n,b=(S,C)=>{g.segments.push({vertexOffset:0,primitiveOffset:S,vertexLength:a.segments[0].vertexLength,primitiveLength:C,sortKey:void 0,vaos:{}})},E=.51*this.maxLongitudeTriangleSize;if(Math.abs(u[0]-m)<=E){const S=Ha(u,0,u.length,m+E);return S===u.length||b(S,_c(u,S+1,u.length,m+360-E)-S),g}m<u[0]&&(m+=360);const R=_c(u,0,u.length,m-E);if(R===u.length)return b(0,u.length),g;b(0,R-0);const v=Ha(u,R+1,u.length,m+E);return v!==u.length&&b(v,u.length-v),g}}const L5=(Math.pow(256,2)-1)/16907520;class lC extends Nr{constructor(i,a,u,m){super(i,{layout:rC||(rC=new zn({visibility:new Et(Qe.layout_raster.visibility)})),paint:sC||(sC=new zn({"raster-opacity":new Et(Qe.paint_raster["raster-opacity"]),"raster-color":new Gu(Qe.paint_raster["raster-color"]),"raster-color-mix":new Et(Qe.paint_raster["raster-color-mix"]),"raster-color-range":new Et(Qe.paint_raster["raster-color-range"]),"raster-hue-rotate":new Et(Qe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Et(Qe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Et(Qe.paint_raster["raster-brightness-max"]),"raster-saturation":new Et(Qe.paint_raster["raster-saturation"]),"raster-contrast":new Et(Qe.paint_raster["raster-contrast"]),"raster-resampling":new Et(Qe.paint_raster["raster-resampling"]),"raster-fade-duration":new Et(Qe.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Et(Qe.paint_raster["raster-emissive-strength"]),"raster-array-band":new Et(Qe.paint_raster["raster-array-band"]),"raster-elevation":new Et(Qe.paint_raster["raster-elevation"]),"raster-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},a,u,m),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(i){return!(i&&i._source instanceof oC&&(i._source.onNorthPole||i._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(i){i!=="raster-color"&&i!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(i){if(!this.hasColorMap()||!this._curRampRange)return;const a=this._transitionablePaint._values["raster-color"].value.expression,[u,m]=i||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(u)&&isNaN(m)||u===this._curRampRange[0]&&m===this._curRampRange[1]||(this.colorRamp=s_({expression:a,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:u,end:m}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[u,m])}}let cC,uC,hC,dC,fC;class pC extends Nr{constructor(i,a,u,m){super(i,{layout:cC||(cC=new zn({visibility:new Et(Qe["layout_raster-particle"].visibility)})),paint:uC||(uC=new zn({"raster-particle-array-band":new Et(Qe["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Et(Qe["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Gu(Qe["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Et(Qe["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Et(Qe["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Et(Qe["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Et(Qe["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Et(Qe["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},a,u,m),this._updateColorRamp(),this.lastInvalidatedAt=ye.now()}onRemove(i){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(i){return!1}_handleSpecialPaintPropertyUpdate(i){i!=="raster-particle-color"&&i!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),i==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const i=this._transitionablePaint._values["raster-particle-color"].value.expression,a=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=s_({expression:i,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:a}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=ye.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class z5 extends Nr{constructor(i,a){super(i,{},a,null),this.implementation=i,i.slot&&(this.slot=i.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(i){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(i){this.implementation.onAdd&&this.implementation.onAdd(i,i.painter.context.gl)}onRemove(i){this.implementation.onRemove&&this.implementation.onRemove(i,i.painter.context.gl)}}function nT(c,i,a){const u=[0,0,1],m=ke.quat.identity([]);return ke.quat.rotateY(m,m,a?-Li(c)+Math.PI:Li(c)),ke.quat.rotateX(m,m,-Li(i)),ke.vec3.transformQuat(u,u,m),ke.vec3.normalize(u,u)}function mC(c,i){const a=jv(c.projection,c.zoom,c.width,c.height),u=function(h,g,b,E,R){const v=new Gi(b.lng-180*sh,b.lat),S=new Gi(b.lng+180*sh,b.lat),C=h.project(v.lng,v.lat),T=h.project(S.lng,S.lat),I=-Math.atan2(T.y-C.y,T.x-C.x),D=o.fromLngLat(b);D.y=bi(D.y,-1+sh,1-sh);const k=D.toLngLat(),F=h.project(k.lng,k.lat),q=o.fromLngLat(k);q.x+=sh;const H=q.toLngLat(),U=h.project(H.lng,H.lat),$=_C(U.x-F.x,U.y-F.y,I),Y=o.fromLngLat(k);Y.y+=sh;const ie=Y.toLngLat(),he=h.project(ie.lng,ie.lat),ue=_C(he.x-F.x,he.y-F.y,I),ce=Math.abs($.x)/Math.abs(ue.y),Ie=ke.mat4.identity([]);ke.mat4.rotateZ(Ie,Ie,-I*(1-(R?0:E)));const de=ke.mat4.identity([]);return ke.mat4.scale(de,de,[1,1-(1-ce)*E,1]),de[4]=-ue.x/ue.y*E,ke.mat4.rotateZ(de,de,I),ke.mat4.multiply(de,Ie,de),de}(c.projection,0,c.center,a,i),m=gC(c);return ke.mat4.scale(u,u,[m,m,1]),u}function gC(c){const i=c.projection,a=jv(c.projection,c.zoom,c.width,c.height),u=rT(i,c.center),m=rT(i,Gi.convert(i.center));return Math.pow(2,u*a+(1-a)*m)}function jv(c,i,a,u,m=1/0){const h=c.range;if(!h)return 0;const g=Math.min(m,Math.max(a,u)),b=Math.log(g/1024)/Math.LN2;return Ws(h[0]+b,h[1]+b,i)}const sh=1/4e4;function rT(c,i){const a=bi(i.lat,-Zn,Zn),u=new Gi(i.lng-180*sh,a),m=new Gi(i.lng+180*sh,a),h=c.project(u.lng,a),g=c.project(m.lng,a),b=o.fromLngLat(u),E=o.fromLngLat(m),R=g.x-h.x,v=g.y-h.y,S=E.x-b.x,C=E.y-b.y,T=Math.sqrt((S*S+C*C)/(R*R+v*v));return Math.log(T)/Math.LN2}function _C(c,i,a){const u=Math.cos(a),m=Math.sin(a);return{x:c*u-i*m,y:c*m+i*u}}function yC(c,i,a){ke.mat4.identity(c),ke.mat4.rotateZ(c,c,Li(i[2])),ke.mat4.rotateX(c,c,Li(i[0])),ke.mat4.rotateY(c,c,Li(i[1])),ke.mat4.scale(c,c,a),ke.mat4.multiply(c,c,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function qv(c,i,a,u,m,h,g,b){const E=[a[0]-i[0],a[1]-i[1],0],R=[u[0]-i[0],u[1]-i[1],0];if(ke.vec3.length(E)<1e-12||ke.vec3.length(R)<1e-12)return ke.quat.identity(c);const v=ke.vec3.cross([],E,R);ke.vec3.normalize(v,v),ke.vec3.subtract(R,u,i),E[2]=(h-m)*b,R[2]=(g-m)*b;const S=E;return ke.vec3.cross(S,E,R),ke.vec3.normalize(S,S),ke.quat.rotationTo(c,v,S)}function sT(c,i,a=!1){const u=Fs(i.zoom),m=function(h,g,b){const E=g.worldSize,R=[h[12],h[13],h[14]],v=Hr(R[1]/E),S=ra(R[0]/E),C=ke.mat4.identity([]),T=Ts(1,v)*E,I=Ts(1,0)*E*Qu(v,g.zoom),D=1/ds(E);let k=I*D;if(b){const U=jv(g.projection,g.zoom,g.width,g.height,1024);k=D*g.projection.pixelSpaceConversion(g.center.lat,E,U)}const F=Uc(v,S);ke.vec3.add(F,F,ke.vec3.scale([],ke.vec3.normalize([],F),T*k*R[2]));const q=function(U){const $=[U[0],U[1],U[2]];let Y=[0,1,0];const ie=ke.vec3.cross([],Y,$);return ke.vec3.cross(Y,$,ie),ke.vec3.squaredLength(Y)===0&&(Y=[0,1,0],ke.vec3.cross(ie,$,Y)),ke.vec3.normalize(ie,ie),ke.vec3.normalize(Y,Y),ke.vec3.normalize($,$),[ie[0],ie[1],ie[2],0,Y[0],Y[1],Y[2],0,$[0],$[1],$[2],0,U[0],U[1],U[2],1]}(F);ke.mat4.scale(C,C,[k,k,k*T]),ke.mat4.translate(C,C,[-R[0],-R[1],-R[2]]);const H=ke.mat4.multiply([],g.globeMatrix,q);return ke.mat4.multiply(H,H,C),ke.mat4.multiply(H,H,h),H}(c,i,a);if(u>0){const h=function(g,b){const E=b.worldSize,R=Ts(1,0)*E*Qu(b.center.lat,b.zoom)/ds(E),v=Ts(1,b.center.lat)*E,S=ke.mat4.identity([]);return ke.mat4.rotateY(S,S,Li(b.center.lng)),ke.mat4.rotateX(S,S,Li(b.center.lat)),ke.mat4.translate(S,S,[0,0,ws]),ke.mat4.scale(S,S,[R,R,R*v]),ke.mat4.translate(S,S,[b.point.x-.5*E,b.point.y-.5*E,0]),ke.mat4.multiply(S,S,g),ke.mat4.multiply(S,b.globeMatrix,S)}(c,i);return function(g,b,E){const R=(I,D,k)=>{const F=ke.vec3.length(I),q=ke.vec3.length(D),H=fr(I,D,k);return ke.vec3.scale(H,H,1/ke.vec3.length(H)*ei(F,q,k))},v=R([g[0],g[1],g[2]],[b[0],b[1],b[2]],E),S=R([g[4],g[5],g[6]],[b[4],b[5],b[6]],E),C=R([g[8],g[9],g[10]],[b[8],b[9],b[10]],E),T=fr([g[12],g[13],g[14]],[b[12],b[13],b[14]],E);return[v[0],v[1],v[2],0,S[0],S[1],S[2],0,C[0],C[1],C[2],0,T[0],T[1],T[2],1]}(m,h,u)}return m}function vC(c,i,a,u){const m=Xt.projectAabbCorners(u,a);let h=Number.MAX_VALUE,g=-1;for(let R=0;R<m.length;++R){const v=m[R];v[0]=(.5*v[0]+.5)*i.width,v[1]=(.5-.5*v[1])*i.height,v[2]<h&&(g=R,h=v[2])}const b=R=>new St(m[R][0],m[R][1]);let E;switch(g){case 0:case 6:E=[b(1),b(5),b(4),b(7),b(3),b(2),b(1)];break;case 1:case 7:E=[b(0),b(4),b(5),b(6),b(2),b(3),b(0)];break;case 3:case 5:E=[b(1),b(0),b(4),b(7),b(6),b(2),b(1)];break;default:E=[b(1),b(5),b(6),b(7),b(3),b(0),b(1)]}if(W(c,E))return h}const O5=Xi([{name:"a_pos_3f",components:3,type:"Float32"}]),k5=Xi([{name:"a_color_3f",components:3,type:"Float32"}]),N5=Xi([{name:"a_color_4f",components:4,type:"Float32"}]),F5=Xi([{name:"a_uv_2f",components:2,type:"Float32"}]),B5=Xi([{name:"a_normal_3f",components:3,type:"Float32"}]),V5=Xi([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),U5=Xi([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),xC={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class Gv{constructor(i,a,u,m){this.message=(i?`${i}: `:"")+u,m&&(this.identifier=m),a!=null&&a.__line__&&(this.line=a.__line__)}}function bC(c,i){const a=c.indexOf("://")===-1;try{return new URL(c,a&&i?"http://example.com":void 0),!0}catch{return!1}}class wC{constructor(i,a){this.feature=i,this.instancedDataOffset=a,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class TC{constructor(){this.instancedDataArray=new Ld,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class aT{constructor(i){this.zoom=i.zoom,this.canonical=i.canonical,this.layers=i.layers,this.layerIds=this.layers.map(a=>a.fqid),this.projection=i.projection,this.index=i.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(i,a){}populate(i,a,u,m){this.tileToMeter=r(u);const h=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:g,id:b,index:E,sourceLayerIndex:R}of i){const v=b??(g.properties&&g.properties.hasOwnProperty("id")?g.properties.id:void 0),S=B(g,h);if(!this.layers[0]._featureFilter.filter(new vn(this.zoom),S,u))continue;const C={id:v,sourceLayerIndex:R,index:E,geometry:h?S.geometry:O(g,u,m),properties:g.properties,type:g.type,patterns:{}},T=this.addFeature(C,C.geometry,S);T&&a.featureIndex.insert(g,C.geometry,E,R,this.index,this.instancesPerModel[T].instancedDataArray.length,Pt/32)}this.lookup=null}update(i,a,u,m){for(const h in this.instancesPerModel){const g=this.instancesPerModel[h];for(const b in i)g.idToFeaturesIndex.hasOwnProperty(b)&&(this.evaluate(g.features[g.idToFeaturesIndex[b]],i[b],g,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let i=!1;for(const a in this.instancesPerModel){const u=this.instancesPerModel[a];for(const m of u.features){const h=this.layers[0],g=m.feature,b=this.canonical,E=h.paint.get("model-rotation").evaluate(g,{},b),R=h.paint.get("model-scale").evaluate(g,{},b),v=h.paint.get("model-translation").evaluate(g,{},b);ke.vec3.exactEquals(m.rotation,E)&&ke.vec3.exactEquals(m.scale,R)&&ke.vec3.exactEquals(m.translation,v)||(this.evaluate(m,m.featureStates,u,!0),i=!0)}}return i}updateReplacement(i,a,u,m){if(a.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=a.updateTime;const h=a.getReplacementRegionsForTile(i.toUnwrapped(),!0);if(Dw(this.activeReplacements,h))return!1;this.activeReplacements=h;let g=!1;for(const b in this.instancesPerModel){const E=this.instancesPerModel[b],R=E.instancedDataArray;for(const v of E.features){const S=v.instancedDataOffset,C=v.instancedDataCount;for(let T=0;T<C;T++){const I=16*(T+S);let D=R.float32[I+0];const k=D>Pt;D=k?D-Pt:D;const F=Math.floor(D),q=R.float32[I+1];let H=!1;for(const U of this.activeReplacements)if(!NI(U,u,xC.Model,m)&&!(U.min.x>F||F>U.max.x||U.min.y>q||q>U.max.y)&&(H=qI(jI(F,q,i.canonical,U.footprintTileId.canonical),U.footprint),H))break;R.float32[I]=H?D+Pt:D,g=g||H!==k}}}return g}isEmpty(){for(const i in this.instancesPerModel)if(this.instancesPerModel[i].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(i){if(!this.uploaded)for(const a in this.instancesPerModel){const u=this.instancesPerModel[a];u.instancedDataArray.length<0||u.instancedDataArray.length===0||(u.instancedDataBuffer?u.instancedDataBuffer.updateData(u.instancedDataArray):u.instancedDataBuffer=i.createVertexBuffer(u.instancedDataArray,V5.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const a in this.instancesPerModel){const u=this.instancesPerModel[a];u.instancedDataArray.length!==0&&u.instancedDataBuffer&&u.instancedDataBuffer.destroy()}const i=this.layers[0].modelManager;if(i&&this.modelUris)for(const a of this.modelUris)i.removeModel(a,"")}addFeature(i,a,u){const m=this.layers[0],h=m.layout.get("model-id").evaluate(u,{},this.canonical);if(!h)return yi(`modelId is not evaluated for layer ${m.id} and it is not going to get rendered.`),h;bC(h,!1)&&(this.modelUris.includes(h)||this.modelUris.push(h)),this.instancesPerModel[h]||(this.instancesPerModel[h]=new TC);const g=this.instancesPerModel[h],b=g.instancedDataArray,E=new wC(u,b.length);for(const R of a)for(const v of R){if(v.x<0||v.x>=Pt||v.y<0||v.y>=Pt)continue;const S=(this.lookupDim-1)/Pt,C=this.lookupDim*(v.y*S|0)+v.x*S|0;if(this.lookup){if(this.lookup[C]!==0)continue;this.lookup[C]=1}this.instanceCount++;const T=b.length;b.resize(T+1),g.instancesEvaluatedElevation.push(0),b.float32[16*T]=v.x,b.float32[16*T+1]=v.y}return E.instancedDataCount=g.instancedDataArray.length-E.instancedDataOffset,E.instancedDataCount>0&&(i.id&&(g.idToFeaturesIndex[i.id]=g.features.length),g.features.push(E),this.evaluate(E,{},g,!1)),h}getModelUris(){return this.modelUris}evaluate(i,a,u,m){const h=this.layers[0],g=i.feature,b=this.canonical,E=i.rotation=h.paint.get("model-rotation").evaluate(g,a,b),R=i.scale=h.paint.get("model-scale").evaluate(g,a,b),v=i.translation=h.paint.get("model-translation").evaluate(g,a,b),S=h.paint.get("model-color").evaluate(g,a,b);S.a=h.paint.get("model-color-mix-intensity").evaluate(g,a,b);const C=[];this.maxVerticalOffset<v[2]&&(this.maxVerticalOffset=v[2]),this.maxScale=Math.max(Math.max(this.maxScale,R[0]),Math.max(R[1],R[2])),yC(C,E,R);const T=Math.round(100*S.a)+S.b/1.05;for(let I=0;I<i.instancedDataCount;++I){const D=i.instancedDataOffset+I,k=16*D,F=u.instancedDataArray.float32;let q=0;m&&(q=F[k+6]-u.instancesEvaluatedElevation[D]);const H=0|F[k+1];F[k]=(0|F[k])+S.r/1.05,F[k+1]=H+S.g/1.05,F[k+2]=T,F[k+3]=1/(b.z>10?this.tileToMeter:r(b,H)),F[k+4]=v[0],F[k+5]=v[1],F[k+6]=v[2]+q,F[k+7]=C[0],F[k+8]=C[1],F[k+9]=C[2],F[k+10]=C[4],F[k+11]=C[5],F[k+12]=C[6],F[k+13]=C[8],F[k+14]=C[9],F[k+15]=C[10],u.instancesEvaluatedElevation[D]=v[2]}}}let EC,SC;Gt(aT,"ModelBucket",{omit:["layers"]}),Gt(TC,"PerModelAttributes"),Gt(wC,"ModelFeature");const $d=64,Rp={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function AC(c,i,a,u,m,h,g,b,E,R=!1){const v=a.zoom,S=a.project(u),C=Qu(u.lat,v),T=1/C;ke.mat4.identity(c),ke.mat4.translate(c,c,[S.x+g[0]*T,S.y+g[1]*T,g[2]]);let I=1,D=1;const k=a.worldSize;if(R){if(a.projection.name==="mercator"){let U=0;a.elevation&&(U=a.elevation.getAtPointOrZero(new o(S.x/k,S.y/k),0));const $=ke.vec4.transformMat4([],[S.x,S.y,U,1],a.projMatrix)[3]/a.cameraToCenterDistance;I=$,D=$*Qu(a.center.lat,v)}else if(a.projection.name==="globe"){const U=sT(c,a),$=ke.mat4.multiply([],a.projMatrix,U),Y=[0,0,0,1];ke.vec4.transformMat4(Y,Y,$);const ie=Y[3]/a.cameraToCenterDistance,he=Fs(v),ue=a.projection.pixelsPerMeter(u.lat,k)*Qu(u.lat,v),ce=a.projection.pixelsPerMeter(a.center.lat,k)*Qu(a.center.lat,v);I=ie/ei(ue,n_(a.center.lat),he),D=ie*C/ue,I*=ce,D*=ce}}else I=T;ke.mat4.scale(c,c,[I,I,D]);const F=[...c],q=i.orientation,H=[];if(yC(H,[q[0]+m[0],q[1]+m[1],q[2]+m[2]],h),ke.mat4.multiply(c,F,H),b&&a.elevation){let U=0;const $=[];if(E&&a.elevation){U=function(he,ue,ce,Ie,de){const Me=ue.elevation;if(!Me)return 0;const ze=Xt.projectAabbCorners(ce,Ie),Pe=Ts(1,de.lat)*ue.worldSize,Ne=function(Zt,zt){const Ft=[0,0,1],hi=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const xi of hi){const Ti=Zt[xi.corners[0]],Ei=Zt[xi.corners[1]],Ci=Zt[xi.corners[2]],Ri=[Ei[0]-Ti[0],Ei[1]-Ti[1],zt*(Ei[2]-Ti[2])],dn=ke.vec3.cross(Ri,Ri,[Ci[0]-Ti[0],Ci[1]-Ti[1],zt*(Ci[2]-Ti[2])]);ke.vec3.normalize(dn,dn),xi.dotProductWithUp=ke.vec3.dot(dn,Ft)}return hi.sort((xi,Ti)=>xi.dotProductWithUp-Ti.dotProductWithUp),hi[0].corners}(ze,Pe),qe=ze[Ne[0]],Ze=ze[Ne[1]],Be=ze[Ne[2]],ct=ze[Ne[3]],yt=Me.getAtPointOrZero(new o(qe[0]/ue.worldSize,qe[1]/ue.worldSize),0),lt=Me.getAtPointOrZero(new o(Ze[0]/ue.worldSize,Ze[1]/ue.worldSize),0),Lt=Me.getAtPointOrZero(new o(Be[0]/ue.worldSize,Be[1]/ue.worldSize),0),Dt=Me.getAtPointOrZero(new o(ct[0]/ue.worldSize,ct[1]/ue.worldSize),0),wt=(yt+Dt)/2,vt=(lt+Lt)/2;return wt>vt?lt<Lt?qv(he,Ze,ct,qe,lt,Dt,yt,Pe):qv(he,Be,qe,ct,Lt,yt,Dt,Pe):yt<Dt?qv(he,qe,Ze,Be,yt,lt,Lt,Pe):qv(he,ct,Be,Ze,Dt,Lt,lt,Pe),Math.max(wt,vt)}($,a,i.aabb,c,u);const Y=ke.mat4.fromQuat([],$),ie=ke.mat4.multiply([],Y,H);ke.mat4.multiply(c,F,ie)}else U=a.elevation.getAtPointOrZero(new o(S.x/k,S.y/k),0);U!==0&&(c[14]+=U)}}function A_(c,i,a=!1){c.uploaded||(c.gfxTexture=new iT(i,c.image,a?i.gl.R8:i.gl.RGBA8,{useMipmap:c.sampler.minFilter>=i.gl.NEAREST_MIPMAP_NEAREST}),c.uploaded=!0,c.image=null)}function j5(c,i,a){c.indexBuffer=i.createIndexBuffer(c.indexArray,!1,!0),c.vertexBuffer=i.createVertexBuffer(c.vertexArray,O5.members,!1,!0),c.normalArray&&(c.normalBuffer=i.createVertexBuffer(c.normalArray,B5.members,!1,!0)),c.texcoordArray&&(c.texcoordBuffer=i.createVertexBuffer(c.texcoordArray,F5.members,!1,!0)),c.colorArray&&(c.colorBuffer=i.createVertexBuffer(c.colorArray,(c.colorArray.bytesPerElement===12?k5:N5).members,!1,!0)),c.featureArray&&(c.pbrBuffer=i.createVertexBuffer(c.featureArray,U5.members,!0)),c.segments=$n.simpleSegment(0,0,c.vertexArray.length,c.indexArray.length);const u=c.material;u.pbrMetallicRoughness.baseColorTexture&&A_(u.pbrMetallicRoughness.baseColorTexture,i),u.pbrMetallicRoughness.metallicRoughnessTexture&&A_(u.pbrMetallicRoughness.metallicRoughnessTexture,i),u.normalTexture&&A_(u.normalTexture,i),u.occlusionTexture&&A_(u.occlusionTexture,i,a),u.emissionTexture&&A_(u.emissionTexture,i)}function oT(c,i,a){if(c.meshes)for(const u of c.meshes)j5(u,i,a);if(c.children)for(const u of c.children)oT(u,i,a)}function Hv(c){if(c.meshes)for(const i of c.meshes)i.indexArray.destroy(),i.vertexArray.destroy(),i.colorArray&&i.colorArray.destroy(),i.normalArray&&i.normalArray.destroy(),i.texcoordArray&&i.texcoordArray.destroy(),i.featureArray&&i.featureArray.destroy();if(c.children)for(const i of c.children)Hv(i)}function lT(c){if(c.meshes)for(const a of c.meshes)a.vertexBuffer&&(a.vertexBuffer.destroy(),a.indexBuffer.destroy(),a.normalBuffer&&a.normalBuffer.destroy(),a.texcoordBuffer&&a.texcoordBuffer.destroy(),a.colorBuffer&&a.colorBuffer.destroy(),a.pbrBuffer&&a.pbrBuffer.destroy(),a.segments.destroy(),a.material&&((i=a.material).pbrMetallicRoughness.baseColorTexture&&i.pbrMetallicRoughness.baseColorTexture.gfxTexture&&i.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),i.pbrMetallicRoughness.metallicRoughnessTexture&&i.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&i.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),i.normalTexture&&i.normalTexture.gfxTexture&&i.normalTexture.gfxTexture.destroy(),i.emissionTexture&&i.emissionTexture.gfxTexture&&i.emissionTexture.gfxTexture.destroy(),i.occlusionTexture&&i.occlusionTexture.gfxTexture&&i.occlusionTexture.gfxTexture.destroy()));var i;if(c.children)for(const a of c.children)lT(a)}class Dp{constructor(i,a,u){this._demTile=i,this._dem=this._demTile.dem,this._scale=a,this._offset=u}static create(i,a,u){const m=u||i.findDEMTileFor(a);if(!m||!m.dem)return;const h=m.dem,g=m.tileID,b=1<<a.canonical.z-g.canonical.z;return new Dp(m,h.dim/Pt/b,[(a.canonical.x/b-g.canonical.x)*h.dim,(a.canonical.y/b-g.canonical.y)*h.dim])}tileCoordToPixel(i,a){const u=a*this._scale+this._offset[1],m=Math.floor(i*this._scale+this._offset[0]),h=Math.floor(u);return new St(m,h)}getElevationAt(i,a,u,m){const h=i*this._scale+this._offset[0],g=a*this._scale+this._offset[1],b=Math.floor(h),E=Math.floor(g),R=this._dem;return m=!!m,u?ei(ei(R.get(b,E,m),R.get(b,E+1,m),g-E),ei(R.get(b+1,E,m),R.get(b+1,E+1,m),g-E),h-b):R.get(b,E,m)}getElevationAtPixel(i,a,u){return this._dem.get(i,a,!!u)}getMeterToDEM(i){return(1<<this._demTile.tileID.canonical.z)*Ts(1,i)*this._dem.stride}}const cT=new Float32Array(262144),Zd=new Uint8Array(262144);function IC(c){let i=0;if(c.meshes)for(const a of c.meshes)i=Math.max(i,a.aabb.max[2]);if(c.children)for(const a of c.children)i=Math.max(i,IC(a));return i}function MC(c,i,a){if(c.meshes)for(const u of c.meshes){if(u.aabb.min[0]===1/0)continue;const m=Xt.applyTransform(u.aabb,c.matrix);a.insert(i,m.min[0],m.min[1],m.max[0],m.max[1])}if(c.children)for(const u of c.children)MC(u,i,a)}const CC=["","wall","door","roof","window","lamp","logo"];class RC{constructor(i){this.node=i,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:i.id,geometry:[],properties:{height:IC(i)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Xt([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let i=0;const a=new Xt([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const u of this.node.meshes)this.node.lightMeshIndex!==i&&(u.transformedAabb=Xt.applyTransformFast(u.aabb,this.node.matrix),a.encapsulate(u.transformedAabb)),i++;this.aabb=a}return this.aabb}}class $v{constructor(i,a,u,m,h,g,b){this.id=u,this.layers=i,this.layerIds=this.layers.map(E=>E.fqid),this.stateDependentLayerIds=this.layers.filter(E=>E.isStateDependent()).map(E=>E.id),this.modelTraits|=Rp.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,m&&(this.modelTraits|=Rp.HasMapboxMeshFeatures),h&&(this.modelTraits|=Rp.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=g,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const E of a)this.nodesInfo.push(new RC(E)),MC(E,b.featureIndexArray.length,b.grid),b.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,b.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(i,a){for(const u of this.getNodesInfo()){const m=u.node;m.footprint&&a.push({footprint:m.footprint,id:i})}}update(i){const a=Object.keys(i).length!==0;if(a&&!this.stateDependentLayers.length)return;const u=a?this.stateDependentLayers:this.layers;if(!cr(i,this.states))for(const m of u)this.evaluate(m,i);this.states=structuredClone(i)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(i){if(!this.needsUpload)return;const a=this.getNodesInfo();for(const u of a){const m=u.node;this.uploaded?this.updatePbrBuffer(m):oT(m,i,!0)}for(const u of a)Hv(u.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(i){let a=!1;if(!i.meshes)return a;for(const u of i.meshes)u.pbrBuffer&&(u.pbrBuffer.updateData(u.featureArray),a=!0);return a}needsReEvaluation(i,a,u){const m=i.transform.projectionOptions,h=i.style.getBrightness(),g=this.brightness!==h;if(!this.uploaded||this.dirty||m.name!==this.projection.name||I_(u.paint.get("model-color").value,g)||I_(u.paint.get("model-color-mix-intensity").value,g)||I_(u.paint.get("model-roughness").value,g)||I_(u.paint.get("model-emissive-strength").value,g)||I_(u.paint.get("model-height-based-emissive-strength-multiplier").value,g)){this.projection=m,this.brightness=h;const b=this.getNodesInfo();for(const E of b)E.state=null;return!0}return!1}evaluateScale(i,a){if(i.transform.zoom===this.zoom)return;this.zoom=i.transform.zoom;const u=this.getNodesInfo(),m=this.id.canonical;for(const h of u){const g=h.feature;h.evaluatedScale=a.paint.get("model-scale").evaluate(g,{},m)}}evaluate(i,a){const u=this.getNodesInfo();for(const m of u){if(!m.node.meshes)continue;const h=m.feature,g=a&&a[h.id];if(cr(g,m.state))continue;m.state=structuredClone(g);const b=m.node.meshes&&m.node.meshes[0].featureData,E=m.evaluatedColor[2],R=m.evaluatedRMEA[2],v=this.id.canonical;if(m.hasTranslucentParts=!1,b){for(let S=0;S<CC.length;S++){const C=CC[S];C.length&&(h.properties.part=C);const T=i.paint.get("model-color").evaluate(h,g,v).toRenderColor(null),I=i.paint.get("model-color-mix-intensity").evaluate(h,g,v);m.evaluatedColor[S]=[T.r,T.g,T.b,I],m.evaluatedRMEA[S][0]=i.paint.get("model-roughness").evaluate(h,g,v),m.evaluatedRMEA[S][2]=i.paint.get("model-emissive-strength").evaluate(h,g,v),m.evaluatedRMEA[S][3]=T.a,m.emissionHeightBasedParams[S]=i.paint.get("model-height-based-emissive-strength-multiplier").evaluate(h,g,v),!m.hasTranslucentParts&&T.a<1&&(m.hasTranslucentParts=!0)}delete h.properties.part,G5(m,E!==m.evaluatedColor[2]||R!==m.evaluatedRMEA[2],this.modelTraits)}else m.evaluatedRMEA[0][2]=i.paint.get("model-emissive-strength").evaluate(h,g,v);m.evaluatedScale=i.paint.get("model-scale").evaluate(h,g,v),this.updatePbrBuffer(m.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(i,a,u,m){const h=i.findDEMTileFor(u);if(h&&(h.tileID.canonical!==this.terrainTile||a!==this.terrainExaggeration)){if(h.dem&&h.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=h.tileID.overscaledZ;const g=Dp.create(i,u,h);if(!g)return;this.modelTraits&Rp.HasMapboxMeshFeatures&&this.updateDEM(i,g,u,m);for(const b of this.getNodesInfo()){const E=b.node;if(!E.footprint||!E.footprint.vertices||!E.footprint.vertices.length)continue;const R=E.footprint.vertices;let v=g.getElevationAt(R[0].x,R[0].y,!0,!0);for(let S=1;S<R.length;S++)v=Math.min(v,g.getElevationAt(R[S].x,R[S].y,!0,!0));E.elevation=v}}this.terrainTile=h.tileID.canonical,this.terrainExaggeration=a}}updateDEM(i,a,u,m){let h=a._dem._modifiedForSources[m];if(h===void 0&&(a._dem._modifiedForSources[m]=[],h=a._dem._modifiedForSources[m]),h.includes(u.canonical))return;const g=a._dem.dim;h.push(u.canonical);let b=!1;for(const E of this.getNodesInfo()){const R=E.node;if(!R.footprint||!R.footprint.grid)continue;const v=R.footprint.grid,S=a.tileCoordToPixel(v.min.x,v.min.y),C=a.tileCoordToPixel(v.max.x,v.max.y),T=Math.min(Math.min(g-C.y,S.x),Math.min(S.y,g-C.x));if(T<0)continue;const I=bi(T,2,5);let D=Math.max(0,S.x-I),k=Math.max(0,S.y-I),F=Math.min(C.x+I,g-1),q=Math.min(C.y+I,g-1);for(let Y=k;Y<=q;++Y)for(let ie=D;ie<=F;++ie)Zd[Y*g+ie]=255;let H=0,U=0;for(let Y=0;Y<v.cellsY;++Y)for(let ie=0;ie<v.cellsX;++ie){if(!v.cells[Y*v.cellsX+ie])continue;const he=a.tileCoordToPixel(v.min.x+ie/v.xScale,v.min.y+Y/v.yScale),ue=a.tileCoordToPixel(v.min.x+(ie+1)/v.xScale,v.min.y+(Y+1)/v.yScale);for(let ce=he.y;ce<=Math.min(ue.y+1,g-1);++ce)for(let Ie=he.x;Ie<=Math.min(ue.x+1,g-1);++Ie)Zd[ce*g+Ie]===255&&(Zd[ce*g+Ie]=0,H+=a.getElevationAtPixel(Ie,ce),U++)}const $=H/U;D=Math.max(1,S.x-I),k=Math.max(1,S.y-I),F=Math.min(C.x+I,g-2),q=Math.min(C.y+I,g-2),b=!0;for(let Y=k;Y<=q;++Y)for(let ie=D;ie<=F;++ie)Zd[Y*g+ie]===0&&(cT[Y*g+ie]=a._dem.set(ie,Y,$));for(let Y=1;Y<I;++Y){D=Math.max(1,S.x-Y),k=Math.max(1,S.y-Y),F=Math.min(C.x+Y,g-2),q=Math.min(C.y+Y,g-2);for(let ie=k;ie<=q;++ie)for(let he=D;he<=F;++he){const ue=ie*g+he;if(Zd[ue]===255){let ce=0,Ie=0,de=-1,Me=-1;for(let ze=-1;ze<=1;++ze)for(let Pe=-1;Pe<=1;++Pe){const Ne=(ie+ze)*g+he+Pe;if(Zd[Ne]>=Y)continue;const qe=cT[Ne],Ze=Math.abs(qe);Ze>Ie&&(ce=qe,Ie=Ze,de=Pe,Me=ze)}if(Ie>.1){const ze=1-(Y+.5*Math.abs(de*Me))/I;let Pe=a._dem.get(he,ie)+ce*ze;const Ne=a._dem.get(he+de,ie+Me),qe=a._dem.get(he-de,ie-Me,!0);(Pe-Ne)*(Pe-qe)>0&&(Pe=(Ne+qe)/2),cT[ue]=a._dem.set(he,ie,Pe),Zd[ue]=Y}}}}}b&&(a._demTile.needsDEMTextureUpload=!0,a._dem._timestamp=ye.now())}getNodesInfo(){return this.nodesInfo}destroy(){const i=this.getNodesInfo();for(const a of i)Hv(a.node),lT(a.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(i,a){if(a.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=a.updateTime;const u=a.getReplacementRegionsForTile(i.toUnwrapped()),m=this.getNodesInfo();for(let h=0;h<this.nodesInfo.length;h++){const g=m[h].node;m[h].hiddenByReplacement=!!g.footprint&&!u.find(b=>b.footprint===g.footprint)}}getHeightAtTileCoord(i,a){const u=this.getNodesInfo(),m=[],h=[0,0,0],g=ke.mat4.identity([]);for(let b=0;b<this.nodesInfo.length;b++){const E=u[b],R=E.node.meshes[0],v=R.transformedAabb;if(i<v.min[0]||a<v.min[1]||i>v.max[0]||a>v.max[1])continue;if(E.node.hidden===!0)return{height:1/0,maxHeight:E.feature.properties.height,hidden:!1,verticalScale:E.evaluatedScale[2]};ke.mat4.invert(g,E.node.matrix),h[0]=i,h[1]=a,ke.vec3.transformMat4(h,h,g);const S=(h[0]-R.aabb.min[0])/(R.aabb.max[0]-R.aabb.min[0])*$d|0,C=Math.min(63,(h[1]-R.aabb.min[1])/(R.aabb.max[1]-R.aabb.min[1])*$d|0)*$d+Math.min(63,S),T=R.heightmap[C];if(!(T<0&&E.node.footprint))return E.hiddenByReplacement?void 0:{height:T,maxHeight:E.feature.properties.height,hidden:!1,verticalScale:E.evaluatedScale[2]};if(E.node.footprint.grid.query(new St(i,a),new St(i,a),m),m.length>0)return{height:void 0,maxHeight:E.feature.properties.height,hidden:E.hiddenByReplacement,verticalScale:E.evaluatedScale[2]}}}}function I_(c,i){return!c.isLightConstant&&i}function q5(c,i,a,u,m,h,g,b){let E=(61440&i|(61440&i)>>4)>>8,R=(3840&i|(3840&i)>>4)>>4,v=240&i|(240&i)>>4;a[3]>0&&(E=ei(E,255*a[0],a[3]),R=ei(R,255*a[1],a[3]),v=ei(v,255*a[2],a[3]));const S=E<<8|R,C=v<<8|Math.floor(255*u[3]),T=function(Y){const ie=bi(Y,0,2);return Math.min(Math.round(.5*ie*255),255)}(u[2])<<8|15*u[0]<<4|15*u[1],I=bi(m[0],0,1),D=bi(m[1],0,1),k=bi(m[2],0,1),F=bi(m[3],0,1);let q,H,U,$;if(I!==D&&g!==h&&D!==I){const Y=g-h;H=1/(Y*(D-I)),U=-(h+Y*I)/(Y*(D-I));const ie=bi(m[4],-1,1);$=Math.pow(10,ie),q=255*k<<8|255*F}else q=65535,H=0,U=1,$=1;if(c.emplaceBack(S,C,T,q,H,U,$),b){const Y=b.length;b.clear();for(let ie=0;ie<Y;ie++)b.emplaceBack(S,C,T,q,H,U,$)}}function G5(c,i,a){const u=c.node;let m=0;const h=a&Rp.HasMeshoptCompression;for(const g of u.meshes){if(u.lights&&u.lightMeshIndex===m||!g.featureData)continue;g.featureArray=new zd,g.featureArray.reserve(g.featureData.length);let b=i;for(const E of g.featureData){const R=h?65535&E:E>>16&65535,v=h?E>>16&65535:65535&E,S=(15&v)<8?15&v:0,C=c.evaluatedRMEA[S],T=c.evaluatedColor[S],I=c.emissionHeightBasedParams[S];let D;if(b&&S===2&&u.lights&&(D=new zd,D.resize(10*u.lights.length)),q5(g.featureArray,R,T,C,I,g.aabb.min[2],g.aabb.max[2],D),D&&b){b=!1;const k=u.meshes[u.lightMeshIndex];k.featureArray=D,k.featureArray._trim()}}g.featureArray._trim(),m++}}function DC(c,i,a,u){const m=1<<c.z;i.lat=Hr((u/Pt+c.y)/m),i.lng=ra((a/Pt+c.x)/m)}Gt($v,"Tiled3dModelBucket",{omit:["layers"]}),Gt(RC,"Tiled3dModelFeature");const H5={circle:class extends Nr{constructor(c,i,a,u){super(c,{layout:xt||(xt=new zn({"circle-sort-key":new kt(Qe.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Et(Qe.layout_circle["circle-elevation-reference"]),visibility:new Et(Qe.layout_circle.visibility)})),paint:He||(He=new zn({"circle-radius":new kt(Qe.paint_circle["circle-radius"]),"circle-color":new kt(Qe.paint_circle["circle-color"]),"circle-blur":new kt(Qe.paint_circle["circle-blur"]),"circle-opacity":new kt(Qe.paint_circle["circle-opacity"]),"circle-translate":new Et(Qe.paint_circle["circle-translate"]),"circle-translate-anchor":new Et(Qe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Et(Qe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Et(Qe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new kt(Qe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new kt(Qe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new kt(Qe.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Et(Qe.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},i,a,u)}createBucket(c){return new Q(c)}queryRadius(c){const i=c;return ht("circle-radius",this,i)+ht("circle-stroke-width",this,i)+ut(this.paint.get("circle-translate"))}queryIntersectsFeature(c,i,a,u,m,h,g,b){const E=st(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),h.angle,c.pixelToTileUnitsFactor),R=this.paint.get("circle-radius").evaluate(i,a)+this.paint.get("circle-stroke-width").evaluate(i,a);return wp(c,u,h,g,b,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",E,R)}getProgramIds(){return["circle"]}getDefaultProgramParams(c,i,a){const u=Ju(this);return{config:new Vc(this,{zoom:i,lut:a}),defines:u,overrideFog:!1}}},heatmap:class extends Nr{createBucket(c){return new cI(c)}constructor(c,i,a,u){super(c,{layout:uI||(uI=new zn({visibility:new Et(Qe.layout_heatmap.visibility)})),paint:hI||(hI=new zn({"heatmap-radius":new kt(Qe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new kt(Qe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Et(Qe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Gu(Qe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Et(Qe.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},i,a,u),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(c){c==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=s_({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(c){return ht("heatmap-radius",this,c)}queryIntersectsFeature(c,i,a,u,m,h,g,b){const E=this.paint.get("heatmap-radius").evaluate(i,a);return wp(c,u,h,g,b,!0,!0,new St(0,0),E)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(c,i,a){return c==="heatmap"?{config:new Vc(this,{zoom:i,lut:a}),overrideFog:!1}:{}}},hillshade:class extends Nr{constructor(c,i,a,u){super(c,{layout:dI||(dI=new zn({visibility:new Et(Qe.layout_hillshade.visibility)})),paint:fI||(fI=new zn({"hillshade-illumination-direction":new Et(Qe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Et(Qe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Et(Qe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Et(Qe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Et(Qe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Et(Qe.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Et(Qe.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},i,a,u)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(c,i,a){return{overrideFog:!1}}},fill:class extends Nr{constructor(c,i,a,u){super(c,{layout:wI||(wI=new zn({"fill-sort-key":new kt(Qe.layout_fill["fill-sort-key"]),visibility:new Et(Qe.layout_fill.visibility),"fill-elevation-reference":new Et(Qe.layout_fill["fill-elevation-reference"])})),paint:TI||(TI=new zn({"fill-antialias":new Et(Qe.paint_fill["fill-antialias"]),"fill-opacity":new kt(Qe.paint_fill["fill-opacity"]),"fill-color":new kt(Qe.paint_fill["fill-color"]),"fill-outline-color":new kt(Qe.paint_fill["fill-outline-color"]),"fill-translate":new Et(Qe.paint_fill["fill-translate"]),"fill-translate-anchor":new Et(Qe.paint_fill["fill-translate-anchor"]),"fill-pattern":new kt(Qe.paint_fill["fill-pattern"]),"fill-emissive-strength":new Et(Qe.paint_fill["fill-emissive-strength"]),"fill-z-offset":new kt(Qe.paint_fill["fill-z-offset"]),"fill-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},i,a,u)}getProgramIds(){const c=this.paint.get("fill-pattern"),i=c&&c.constantOr(1),a=[i?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&a.push(i&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),a}getDefaultProgramParams(c,i,a){return{config:new Vc(this,{zoom:i,lut:a}),overrideFog:!1}}recalculate(c,i){super.recalculate(c,i);const a=this.paint._values["fill-outline-color"];a.value.kind==="constant"&&a.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(c){return new Sw(c)}queryRadius(){return ut(this.paint.get("fill-translate"))}queryIntersectsFeature(c,i,a,u,m,h){return!c.queryGeometry.isAboveHorizon&&ee($e(c.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),h.angle,c.pixelToTileUnitsFactor),u)}isTileClipped(){return!0}is3D(){return this.paint.get("fill-z-offset").constantOr(1)!==0}},"fill-extrusion":class extends Nr{constructor(c,i,a,u){super(c,{layout:rM||(rM=new zn({visibility:new Et(Qe["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Et(Qe["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:sM||(sM=new zn({"fill-extrusion-opacity":new Et(Qe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new kt(Qe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Et(Qe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Et(Qe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new kt(Qe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new kt(Qe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new kt(Qe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Et(Qe["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Et(Qe["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Et(Qe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Et(Qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Et(Qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Et(Qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Et(Qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Et(Qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Et(Qe["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Et(Qe["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new kt(Qe["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new kt(Qe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Et(Qe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Et(Qe["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Et(Qe["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Et(Qe["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new kt(Qe["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new kt(Qe["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Et(Qe["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},i,a,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(c){return new Tv(c)}queryRadius(){return ut(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(c,i,a,u,m,h,g,b,E){const R=st(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),h.angle,c.pixelToTileUnitsFactor),v=this.paint.get("fill-extrusion-height").evaluate(i,a),S=this.paint.get("fill-extrusion-base").evaluate(i,a),C=[0,0],T=b&&h.elevation,I=h.elevation?h.elevation.exaggeration():1,D=c.tile.getBucket(this);if(T&&D instanceof Tv){const U=D.centroidVertexArray,$=E+1;$<U.length&&(C[0]=U.geta_centroid_pos0($),C[1]=U.geta_centroid_pos1($))}if(C[0]===0&&C[1]===1)return!1;h.projection.name==="globe"&&(u=nM([u],[new St(0,0),new St(Pt,Pt)],c.tileID.canonical).map(U=>U.polygon).flat());const k=T?b:null,[F,q]=function(U,$,Y,ie,he,ue,ce,Ie,de,Me,ze){return U.projection.name==="globe"?function(Pe,Ne,qe,Ze,Be,ct,yt,lt,Lt,Dt,wt){const vt=[],Zt=[],zt=Pe.projection.upVectorScale(wt,Pe.center.lat,Pe.worldSize).metersToTile,Ft=[0,0,0,1],hi=[0,0,0,1],xi=(Ei,Ci,Ri,dn)=>{Ei[0]=Ci,Ei[1]=Ri,Ei[2]=dn,Ei[3]=1},Ti=iM();qe>0&&(qe+=Ti),Ze+=Ti;for(const Ei of Ne){const Ci=[],Ri=[];for(const dn of Ei){const rn=dn.x+Be.x,pi=dn.y+Be.y,Ji=Pe.projection.projectTilePoint(rn,pi,wt),tn=Pe.projection.upVector(wt,dn.x,dn.y);let In=qe,tr=Ze;if(yt){const mr=oM(rn,pi,qe,Ze,yt,lt,Lt,Dt);In+=mr.base,tr+=mr.top}qe!==0?xi(Ft,Ji.x+tn[0]*zt*In,Ji.y+tn[1]*zt*In,Ji.z+tn[2]*zt*In):xi(Ft,Ji.x,Ji.y,Ji.z),xi(hi,Ji.x+tn[0]*zt*tr,Ji.y+tn[1]*zt*tr,Ji.z+tn[2]*zt*tr),ke.vec3.transformMat4(Ft,Ft,ct),ke.vec3.transformMat4(hi,hi,ct),Ci.push(new Hd(Ft[0],Ft[1],Ft[2])),Ri.push(new Hd(hi[0],hi[1],hi[2]))}vt.push(Ci),Zt.push(Ri)}return[vt,Zt]}(U,$,Y,ie,he,ue,ce,Ie,de,Me,ze):ce?function(Pe,Ne,qe,Ze,Be,ct,yt,lt,Lt){const Dt=[],wt=[],vt=[0,0,0,1];for(const Zt of Pe){const zt=[],Ft=[];for(const hi of Zt){const xi=hi.x+Ze.x,Ti=hi.y+Ze.y,Ei=oM(xi,Ti,Ne,qe,ct,yt,lt,Lt);vt[0]=xi,vt[1]=Ti,vt[2]=Ei.base,vt[3]=1,ke.vec4.transformMat4(vt,vt,Be),vt[3]=Math.max(vt[3],1e-5);const Ci=new Hd(vt[0]/vt[3],vt[1]/vt[3],vt[2]/vt[3]);vt[0]=xi,vt[1]=Ti,vt[2]=Ei.top,vt[3]=1,ke.vec4.transformMat4(vt,vt,Be),vt[3]=Math.max(vt[3],1e-5);const Ri=new Hd(vt[0]/vt[3],vt[1]/vt[3],vt[2]/vt[3]);zt.push(Ci),Ft.push(Ri)}Dt.push(zt),wt.push(Ft)}return[Dt,wt]}($,Y,ie,he,ue,ce,Ie,de,Me):function(Pe,Ne,qe,Ze,Be){const ct=[],yt=[],lt=Be[8]*Ne,Lt=Be[9]*Ne,Dt=Be[10]*Ne,wt=Be[11]*Ne,vt=Be[8]*qe,Zt=Be[9]*qe,zt=Be[10]*qe,Ft=Be[11]*qe;for(const hi of Pe){const xi=[],Ti=[];for(const Ei of hi){const Ci=Ei.x+Ze.x,Ri=Ei.y+Ze.y,dn=Be[0]*Ci+Be[4]*Ri+Be[12],rn=Be[1]*Ci+Be[5]*Ri+Be[13],pi=Be[2]*Ci+Be[6]*Ri+Be[14],Ji=Be[3]*Ci+Be[7]*Ri+Be[15],tn=dn+lt,In=rn+Lt,tr=pi+Dt,mr=Math.max(Ji+wt,1e-5),ir=dn+vt,jn=rn+Zt,ar=pi+zt,wr=Math.max(Ji+Ft,1e-5);xi.push(new Hd(tn/mr,In/mr,tr/mr)),Ti.push(new Hd(ir/wr,jn/wr,ar/wr))}ct.push(xi),yt.push(Ti)}return[ct,yt]}($,Y,ie,he,ue)}(h,u,S,v,R,g,k,C,I,h.center.lat,c.tileID.canonical),H=c.queryGeometry;return function(U,$,Y){let ie=1/0;ee(Y,$)&&(ie=aM(Y,$[0]));for(let he=0;he<$.length;he++){const ue=$[he],ce=U[he];for(let Ie=0;Ie<ue.length-1;Ie++){const de=ue[Ie],Me=[de,ue[Ie+1],ce[Ie+1],ce[Ie],de];W(Y,Me)&&(ie=Math.min(ie,aM(Y,Me)))}}return ie!==1/0&&ie}(F,q,H.isPointQuery()?H.screenBounds:H.screenGeometry)}},line:class extends Nr{constructor(c,i,a,u){const m=_M();super(c,m,i,a,u),m.layout&&(this.layout=new qu(m.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(c){if(c==="line-gradient"){const i=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=i._styleExpression&&i._styleExpression.expression instanceof Lu,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(c,i){super.recalculate(c,i),this.paint._values["line-floorwidth"]=(()=>{if(p_)return p_;const a=_M();return p_=new WF(a.paint.properties["line-width"].specification),p_.useIntegerZoom=!0,p_})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,c)}createBucket(c){return new Ow(c)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(c,i,a){const u=mM(this);return{config:new Vc(this,{zoom:i,lut:a}),defines:u,overrideFog:!1}}queryRadius(c){const i=c,a=yM(ht("line-width",this,i),ht("line-gap-width",this,i)),u=ht("line-offset",this,i);return a/2+Math.abs(u)+ut(this.paint.get("line-translate"))}queryIntersectsFeature(c,i,a,u,m,h){if(c.queryGeometry.isAboveHorizon)return!1;const g=$e(c.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),h.angle,c.pixelToTileUnitsFactor),b=c.pixelToTileUnitsFactor/2*yM(this.paint.get("line-width").evaluate(i,a),this.paint.get("line-gap-width").evaluate(i,a)),E=this.paint.get("line-offset").evaluate(i,a);return E&&(u=function(R,v){const S=[],C=new St(0,0);for(let T=0;T<R.length;T++){const I=R[T],D=[];for(let k=0;k<I.length;k++){const F=I[k],q=I[k+1],H=k===0?C:F.sub(I[k-1])._unit()._perp(),U=k===I.length-1?C:q.sub(F)._unit()._perp(),$=H._add(U)._unit();$._mult(1/($.x*U.x+$.y*U.y)),D.push($._mult(v)._add(F))}S.push(D)}return S}(u,E*c.pixelToTileUnitsFactor)),function(R,v,S){for(let C=0;C<v.length;C++){const T=v[C];if(R.length>=3){for(let I=0;I<T.length;I++)if(ge(R,T[I]))return!0}if(le(R,T,S))return!0}return!1}(g,u,b)}isTileClipped(){return!0}isDraped(c){return!this.hasElevatedBuckets}},symbol:Fv,background:class extends Nr{constructor(c,i,a,u){super(c,{layout:iC||(iC=new zn({visibility:new Et(Qe.layout_background.visibility)})),paint:nC||(nC=new zn({"background-pitch-alignment":new Et(Qe.paint_background["background-pitch-alignment"]),"background-color":new Et(Qe.paint_background["background-color"]),"background-pattern":new Et(Qe.paint_background["background-pattern"]),"background-opacity":new Et(Qe.paint_background["background-opacity"]),"background-emissive-strength":new Et(Qe.paint_background["background-emissive-strength"]),"background-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},i,a,u)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(c,i,a){return{overrideFog:!1}}is3D(){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:lC,"raster-particle":pC,sky:class extends Nr{constructor(c,i,a,u){super(c,{layout:hC||(hC=new zn({visibility:new Et(Qe.layout_sky.visibility)})),paint:dC||(dC=new zn({"sky-type":new Et(Qe.paint_sky["sky-type"]),"sky-atmosphere-sun":new Et(Qe.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Et(Qe.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Et(Qe.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Et(Qe.paint_sky["sky-gradient-radius"]),"sky-gradient":new Gu(Qe.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Et(Qe.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Et(Qe.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Et(Qe.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},i,a,u),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(c){c==="sky-gradient"?this._updateColorRamp():c!=="sky-atmosphere-sun"&&c!=="sky-atmosphere-halo-color"&&c!=="sky-atmosphere-color"&&c!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=s_({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(c){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const i=c.style.light.properties.get("position");return this._lightPosition.azimuthal!==i.azimuthal||this._lightPosition.polar!==i.polar}return!1}getCenter(c,i){if(this.paint.get("sky-type")==="atmosphere"){const u=this.paint.get("sky-atmosphere-sun"),m=!u,h=c.style.light,g=h.properties.get("position");return m&&h.properties.get("anchor")==="viewport"&&yi("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),m?nT(g.azimuthal,90-g.polar,i):nT(u[0],90-u[1],i)}const a=this.paint.get("sky-gradient-center");return nT(a[0],90-a[1],i)}isSky(){return!0}markSkyboxValid(c){this._skyboxInvalidated=!1,this._lightPosition=c.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const c=this.paint.get("sky-type");return c==="atmosphere"?["skyboxCapture","skybox"]:c==="gradient"?["skyboxGradient"]:null}},slot:class extends Nr{constructor(c,i,a,u){super(c,{paint:fC||(fC=new zn({}))},i,null)}},model:class extends Nr{constructor(c,i,a,u){super(c,{layout:EC||(EC=new zn({visibility:new Et(Qe.layout_model.visibility),"model-id":new kt(Qe.layout_model["model-id"])})),paint:SC||(SC=new zn({"model-opacity":new kt(Qe.paint_model["model-opacity"]),"model-rotation":new kt(Qe.paint_model["model-rotation"]),"model-scale":new kt(Qe.paint_model["model-scale"]),"model-translation":new kt(Qe.paint_model["model-translation"]),"model-color":new kt(Qe.paint_model["model-color"]),"model-color-mix-intensity":new kt(Qe.paint_model["model-color-mix-intensity"]),"model-type":new Et(Qe.paint_model["model-type"]),"model-cast-shadows":new Et(Qe.paint_model["model-cast-shadows"]),"model-receive-shadows":new Et(Qe.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Et(Qe.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new kt(Qe.paint_model["model-emissive-strength"]),"model-roughness":new kt(Qe.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new kt(Qe.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Et(Qe.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Et(Qe.paint_model["model-front-cutoff"]),"model-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},i,a,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(c){return new aT(c)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(c){return c instanceof $v?Pt-1:0}queryIntersectsFeature(c,i,a,u,m,h){if(!this.modelManager)return!1;const g=this.modelManager,b=c.tile.getBucket(this);if(!(b&&b instanceof aT))return!1;for(const E in b.instancesPerModel){const R=b.instancesPerModel[E],v=i.id!==void 0?i.id:i.properties&&i.properties.hasOwnProperty("id")?i.properties.id:void 0;if(R.idToFeaturesIndex.hasOwnProperty(v)){const S=R.features[R.idToFeaturesIndex[v]],C=g.getModel(E,this.scope);if(!C)return!1;let T=ke.mat4.create();const I=new Gi(0,0),D=b.canonical;let k=Number.MAX_VALUE;for(let F=0;F<S.instancedDataCount;++F){const q=16*(S.instancedDataOffset+F),H=R.instancedDataArray.float32,U=[H[q+4],H[q+5],H[q+6]];DC(D,I,H[q],0|H[q+1]),AC(T,C,h,I,S.rotation,S.scale,U,!1,!1,!1),h.projection.name==="globe"&&(T=sT(T,h));const $=ke.mat4.multiply([],h.projMatrix,T),Y=c.queryGeometry,ie=vC(Y.isPointQuery()?Y.screenBounds:Y.screenGeometry,h,$,C.aabb);ie!=null&&(k=Math.min(ie,k))}return k!==Number.MAX_VALUE&&k}}return!1}_handleOverridablePaintPropertyUpdate(c,i,a){return!(!this.layout||i.isDataDriven()||a.isDataDriven()||c!=="model-color"&&c!=="model-color-mix-intensity"&&c!=="model-rotation"&&c!=="model-scale"&&c!=="model-translation"&&c!=="model-emissive-strength")}_isPropertyZoomDependent(c){const i=this._transitionablePaint._values[c];return i!=null&&i.value!=null&&i.value.expression!=null&&i.value.expression instanceof wd}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Nr{constructor(c,i,a,u){super(c,{layout:EI||(EI=new zn({"clip-layer-types":new Et(Qe.layout_clip["clip-layer-types"]),"clip-layer-scope":new Et(Qe.layout_clip["clip-layer-scope"])})),paint:SI||(SI=new zn({}))},i,a,u)}recalculate(c,i){super.recalculate(c,i)}createBucket(c){return new AI(c)}isTileClipped(){return!0}is3D(){return!0}}};class $5{constructor(i){this._callback=i,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Z5{constructor(){this.tasks={},this.taskQueue=[],Rl(["process"],this),this.invoker=new $5(this.process),this.nextId=0}add(i,a){const u=this.nextId++,m=function({type:h,isSymbolTile:g,zoom:b}){return b=b||0,h==="message"?0:h!=="maybePrepare"||g?h!=="parseTile"||g?h==="parseTile"&&g?300-b:h==="maybePrepare"&&g?400-b:500:200-b:100-b}(a);if(m===0){try{i()}finally{}return null}return this.tasks[u]={fn:i,metadata:a,priority:m,id:u},this.taskQueue.push(u),this.invoker.trigger(),{cancel:()=>{delete this.tasks[u]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(u=>!!this.tasks[u]),!this.taskQueue.length)return;const i=this.pick();if(i===null)return;const a=this.tasks[i];if(delete this.tasks[i],this.taskQueue.length&&this.invoker.trigger(),!a)return;a.fn()}finally{}}pick(){let i=null,a=1/0;for(let m=0;m<this.taskQueue.length;m++){const h=this.tasks[this.taskQueue[m]];h.priority<a&&(a=h.priority,i=m)}if(i===null)return null;const u=this.taskQueue[i];return this.taskQueue.splice(i,1),u}remove(){this.invoker.remove()}}class PC{constructor(i,a,u){this.target=i,this.parent=a,this.mapId=u,this.callbacks={},this.cancelCallbacks={},Rl(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new Z5}send(i,a,u,m,h=!1,g){const b=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(u.metadata=g,this.callbacks[b]=u);const E=new Set;return this.target.postMessage({id:b,type:i,hasCallback:!!u,targetMapId:m,mustQueue:h,sourceMapId:this.mapId,data:Gl(a,E)},E),{cancel:()=>{u&&delete this.callbacks[b],this.target.postMessage({id:b,type:"<cancel>",targetMapId:m,sourceMapId:this.mapId})}}}receive(i){const a=i.data,u=a.id;if(u&&(!a.targetMapId||this.mapId===a.targetMapId))if(a.type==="<cancel>"){const m=this.cancelCallbacks[u];delete this.cancelCallbacks[u],m&&m.cancel()}else if(a.mustQueue||Ls()){const m=this.callbacks[u],h=this.scheduler.add(()=>this.processTask(u,a),m&&m.metadata||{type:"message"});h&&(this.cancelCallbacks[u]=h)}else this.processTask(u,a)}processTask(i,a){if(delete this.cancelCallbacks[i],a.type==="<response>"){const u=this.callbacks[i];delete this.callbacks[i],u&&(a.error?u(Oc(a.error)):u(null,Oc(a.data)))}else{const u=new Set,m=a.hasCallback?(g,b)=>{this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:g?Gl(g):null,data:Gl(b,u)},u)}:()=>{},h=Oc(a.data);if(this.parent[a.type])this.parent[a.type](a.sourceMapId,h,m);else if(this.parent.getWorkerSource){const g=a.type.split(".");this.parent.getWorkerSource(a.sourceMapId,g[0],h.source,h.scope)[g[1]](h,m)}else m(new Error(`Could not find function ${a.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var M_={workerUrl:"",workerClass:null,workerParams:void 0};const uT="mapboxgl_preloaded_worker_pool";class Wd{constructor(){this.active={}}acquire(i,a=Wd.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<a;)this.workers.push(M_.workerClass!=null?new M_.workerClass:new self.Worker(M_.workerUrl,M_.workerParams));return this.active[i]=!0,this.workers.slice()}release(i){delete this.active[i],this.workers&&this.numActive()===0&&(this.workers.forEach(a=>{a.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[uT]}numActive(){return Object.keys(this.active).length}}Wd.workerCount=2;class Pp{constructor(i,a,u="Worker",m=Wd.workerCount){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=_o();const h=this.workerPool.acquire(this.id,m);for(let g=0;g<h.length;g++){const b=new Pp.Actor(h[g],a,this.id);b.name=`${u} ${g}`,this.actors.push(b)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(i,a,u){Yn(this.actors,(m,h)=>{m.send(i,a,h)},u=u||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(i=>{i.remove()}),this.actors=[],this.workerPool.release(this.id)}}let C_,hT;function Zv(){return C_||(C_=new Wd),C_}Pp.Actor=PC;const dT=new $i(0,0,0);var fT=(c=>(c[c.PATH_RULE_UNSPECIFIED=0]="PATH_RULE_UNSPECIFIED",c[c.PATH_RULE_NON_ZERO=1]="PATH_RULE_NON_ZERO",c[c.PATH_RULE_EVEN_ODD=2]="PATH_RULE_EVEN_ODD",c))(fT||{}),Wv=(c=>(c[c.LINE_CAP_UNSPECIFIED=0]="LINE_CAP_UNSPECIFIED",c[c.LINE_CAP_BUTT=1]="LINE_CAP_BUTT",c[c.LINE_CAP_ROUND=2]="LINE_CAP_ROUND",c[c.LINE_CAP_SQUARE=3]="LINE_CAP_SQUARE",c))(Wv||{}),R_=(c=>(c[c.LINE_JOIN_UNSPECIFIED=0]="LINE_JOIN_UNSPECIFIED",c[c.LINE_JOIN_MITER=1]="LINE_JOIN_MITER",c[c.LINE_JOIN_MITER_CLIP=2]="LINE_JOIN_MITER_CLIP",c[c.LINE_JOIN_ROUND=3]="LINE_JOIN_ROUND",c[c.LINE_JOIN_BEVEL=4]="LINE_JOIN_BEVEL",c))(R_||{}),LC=(c=>(c[c.PAINT_ORDER_UNSPECIFIED=0]="PAINT_ORDER_UNSPECIFIED",c[c.PAINT_ORDER_FILL_AND_STROKE=1]="PAINT_ORDER_FILL_AND_STROKE",c[c.PAINT_ORDER_STROKE_AND_FILL=2]="PAINT_ORDER_STROKE_AND_FILL",c))(LC||{}),Lp=(c=>(c[c.PATH_COMMAND_UNSPECIFIED=0]="PATH_COMMAND_UNSPECIFIED",c[c.PATH_COMMAND_MOVE=1]="PATH_COMMAND_MOVE",c[c.PATH_COMMAND_LINE=2]="PATH_COMMAND_LINE",c[c.PATH_COMMAND_QUAD=3]="PATH_COMMAND_QUAD",c[c.PATH_COMMAND_CUBIC=4]="PATH_COMMAND_CUBIC",c[c.PATH_COMMAND_CLOSE=5]="PATH_COMMAND_CLOSE",c))(Lp||{}),zC=(c=>(c[c.MASK_TYPE_UNSPECIFIED=0]="MASK_TYPE_UNSPECIFIED",c[c.MASK_TYPE_LUMINANCE=1]="MASK_TYPE_LUMINANCE",c[c.MASK_TYPE_ALPHA=2]="MASK_TYPE_ALPHA",c))(zC||{});function W5(c,i,a){c===1&&i.icons.push(function(u,m){return function(h){if(h.usvg_tree.height||(h.usvg_tree.height=h.usvg_tree.width),!h.metadata)return h;const{metadata:g}=h;if(g.content_area){const{content_area:b}=g;b.top==null&&(b.top=b.left),b.width==null&&(b.width=h.usvg_tree.width),b.height==null&&(b.height=b.width)}return g.stretch_x&&g.stretch_x.length&&OC(g,"x"),g.stretch_y&&g.stretch_y.length&&OC(g,"y"),h}(u.readFields(X5,{name:void 0},m))}(a,a.readVarint()+a.pos))}function OC(c,i){const a=[],u=c[`stretch_${i}`];let m=null;for(let h=0;h<u.length;h++)m===null?m=a.length===0?u[0]:a[a.length-1][1]+u[h]:(a.push([m,m+u[h]]),m=null);c[`stretch_${i}_areas`]=a}function X5(c,i,a){c===1?i.name=a.readString():c===2?i.metadata=function(u,m){return u.readFields(Y5,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},m)}(a,a.readVarint()+a.pos):c===3&&(i.usvg_tree=function(u,m){return u.readFields(J5,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},m)}(a,a.readVarint()+a.pos),i.data="usvg_tree")}function Y5(c,i,a){c===1?i.stretch_x=a.readPackedVarint():c===2?i.stretch_y=a.readPackedVarint():c===3?i.content_area=function(u,m){return u.readFields(K5,{left:0},m)}(a,a.readVarint()+a.pos):c===4&&i.variables.push(function(u,m){return u.readFields(Q5,{name:void 0},m)}(a,a.readVarint()+a.pos))}function K5(c,i,a){c===1?i.left=a.readVarint():c===2?i.width=a.readVarint():c===3?i.top=a.readVarint():c===4&&(i.height=a.readVarint())}function Q5(c,i,a){c===1?i.name=a.readString():c===2&&(i.rgb_color=Kv(a.readVarint()),i.value="rgb_color")}function J5(c,i,a){c===1?i.width=i.height=a.readVarint():c===2?i.height=a.readVarint():c===3?i.children.push(Xv(a,a.readVarint()+a.pos)):c===4?i.linear_gradients.push(function(u,m){return u.readFields(aB,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},m)}(a,a.readVarint()+a.pos)):c===5?i.radial_gradients.push(function(u,m){return u.readFields(lB,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},m)}(a,a.readVarint()+a.pos)):c===7?i.clip_paths.push(function(u,m){return u.readFields(cB,{children:[]},m)}(a,a.readVarint()+a.pos)):c===8&&i.masks.push(function(u,m){const h=u.readFields(uB,{left:0,width:20,mask_type:1,children:[]},m);return h.height==null&&(h.height=h.width),h.top==null&&(h.top=h.left),h}(a,a.readVarint()+a.pos))}function Xv(c,i){return c.readFields(eB,{},i)}function eB(c,i,a){c===1?(i.group=function(u,m){return u.readFields(tB,{opacity:255,children:[]},m)}(a,a.readVarint()+a.pos),i.node="group"):c===2&&(i.path=function(u,m){return u.readFields(nB,{paint_order:1,commands:[],step:1,diffs:[],rule:1},m)}(a,a.readVarint()+a.pos),i.node="path")}function tB(c,i,a){c===1?i.transform=Yv(a,a.readVarint()+a.pos):c===2?i.opacity=a.readVarint():c===5?i.clip_path_idx=a.readVarint():c===6?i.mask_idx=a.readVarint():c===7&&i.children.push(Xv(a,a.readVarint()+a.pos))}function Yv(c,i){return c.readFields(iB,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},i)}function iB(c,i,a){c===1?i.sx=a.readFloat():c===2?i.ky=a.readFloat():c===3?i.kx=a.readFloat():c===4?i.sy=a.readFloat():c===5?i.tx=a.readFloat():c===6&&(i.ty=a.readFloat())}function nB(c,i,a){c===1?i.fill=function(u,m){return u.readFields(rB,{rgb_color:dT,paint:"rgb_color",opacity:255},m)}(a,a.readVarint()+a.pos):c===2?i.stroke=function(u,m){return u.readFields(sB,{rgb_color:dT,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},m)}(a,a.readVarint()+a.pos):c===3?i.paint_order=a.readVarint():c===5?a.readPackedVarint(i.commands):c===6?i.step=a.readFloat():c===7?a.readPackedSVarint(i.diffs):c===8&&(i.rule=a.readVarint())}function rB(c,i,a){c===1?(i.rgb_color=Kv(a.readVarint()),i.paint="rgb_color"):c===2?(i.linear_gradient_idx=a.readVarint(),i.paint="linear_gradient_idx"):c===3?(i.radial_gradient_idx=a.readVarint(),i.paint="radial_gradient_idx"):c===5&&(i.opacity=a.readVarint())}function Kv(c){return new $i((c>>16&255)/255,(c>>8&255)/255,(255&c)/255,1)}function sB(c,i,a){c===1?(i.rgb_color=Kv(a.readVarint()),i.paint="rgb_color"):c===2?(i.linear_gradient_idx=a.readVarint(),i.paint="linear_gradient_idx"):c===3?(i.radial_gradient_idx=a.readVarint(),i.paint="radial_gradient_idx"):c===5?a.readPackedFloat(i.dasharray):c===6?i.dashoffset=a.readFloat():c===7?i.miterlimit=a.readFloat():c===8?i.opacity=a.readVarint():c===9?i.width=a.readFloat():c===10?i.linecap=a.readVarint():c===11&&(i.linejoin=a.readVarint())}function aB(c,i,a){c===1?i.transform=Yv(a,a.readVarint()+a.pos):c===2?i.spread_method=a.readVarint():c===3?i.stops.push(kC(a,a.readVarint()+a.pos)):c===4?i.x1=a.readFloat():c===5?i.y1=a.readFloat():c===6?i.x2=a.readFloat():c===7&&(i.y2=a.readFloat())}function kC(c,i){return c.readFields(oB,{offset:0,opacity:255,rgb_color:dT},i)}function oB(c,i,a){c===1?i.offset=a.readFloat():c===2?i.opacity=a.readVarint():c===3&&(i.rgb_color=Kv(a.readVarint()))}function lB(c,i,a){c===1?i.transform=Yv(a,a.readVarint()+a.pos):c===2?i.spread_method=a.readVarint():c===3?i.stops.push(kC(a,a.readVarint()+a.pos)):c===4?i.cx=a.readFloat():c===5?i.cy=a.readFloat():c===6?i.r=a.readFloat():c===7?i.fx=a.readFloat():c===8?i.fy=a.readFloat():c===9&&(i.fr=a.readFloat())}function cB(c,i,a){c===1?i.transform=Yv(a,a.readVarint()+a.pos):c===2?i.clip_path_idx=a.readVarint():c===3&&i.children.push(Xv(a,a.readVarint()+a.pos))}function uB(c,i,a){c===1?i.left=i.top=a.readFloat():c===2?i.width=i.height=a.readFloat():c===3?i.top=a.readFloat():c===4?i.height=a.readFloat():c===5?i.mask_type=a.readVarint():c===6?i.mask_idx=a.readVarint():c===7&&i.children.push(Xv(a,a.readVarint()+a.pos))}class hB{static calculate(i,a){const u=new Map,m=new Map;if(Object.keys(i).length===0)return u;a.forEach(h=>{m.set(h.name,h.rgb_color||new $i(0,0,0))});for(const[h,g]of Object.entries(i))m.has(h)?u.set(m.get(h).toStringPremultipliedAlpha(),g):console.warn(`Ignoring unknown image variable "${h}"`);return u}}function zp(c,i=255,a){const u=i/255,m=c.toStringPremultipliedAlpha(),h=a.has(m)?a.get(m).clone():c.clone();return h.a=u,h.toString()}function D_(c,i){if(!oe()){const a=document.createElement("canvas");return a.width=c,a.height=i,a}return new OffscreenCanvas(c,i)}function dB(c,i){const a=hB.calculate(i.params,c.metadata?c.metadata.variables:[]),u=c.usvg_tree,m=u.width,h=u.height,g=i.transform?i.transform:new DOMMatrix,b=Math.max(1,Math.round(m*g.a)),E=Math.max(1,Math.round(h*g.d)),R=new DOMMatrix([b/m,0,0,E/h,0,0]),v=D_(b,E).getContext("2d");return pT(v,R,u,u,a),v.getImageData(0,0,b,E)}function pT(c,i,a,u,m){for(const h of u.children)NC(c,i,a,h,m)}function NC(c,i,a,u,m){u.group?(c.save(),function(h,g,b,E,R){const v=E.mask_idx!=null?b.masks[E.mask_idx]:null,S=E.clip_path_idx!=null?b.clip_paths[E.clip_path_idx]:null;if(E.transform&&(g=Qv(E.transform).preMultiplySelf(g)),!function(I,D,k){return I.opacity!==255||D||k}(E,S!=null,v!=null))return void pT(h,g,b,E,R);const C=D_(h.canvas.width,h.canvas.height),T=C.getContext("2d");pT(T,g,b,E,R),S&&GC(T,g,b,S),v&&HC(T,g,b,v,R),h.globalAlpha=E.opacity/255,h.drawImage(C,0,0)}(c,i,a,u.group,m),c.restore()):u.path&&(c.save(),function(h,g,b,E,R){const v=$C(E);h.setTransform(g),E.paint_order===LC.PAINT_ORDER_FILL_AND_STROKE?(FC(h,b,E,v,R),VC(h,b,E,v,R)):(VC(h,b,E,v,R),FC(h,b,E,v,R))}(c,i,a,u.path,m),c.restore())}function FC(c,i,a,u,m){const h=a.fill;if(!h)return;const g=h.opacity/255;switch(h.paint){case"rgb_color":c.fillStyle=zp(h.rgb_color,h.opacity,m);break;case"linear_gradient_idx":c.fillStyle=UC(c,i.linear_gradients[h.linear_gradient_idx],g,m);break;case"radial_gradient_idx":c.fillStyle=jC(c,i.radial_gradients[h.radial_gradient_idx],g,m)}c.fill(u,BC(a))}function BC(c){return c.rule===fT.PATH_RULE_NON_ZERO?"nonzero":c.rule===fT.PATH_RULE_EVEN_ODD?"evenodd":void 0}function VC(c,i,a,u,m){const h=a.stroke;if(!h)return;c.lineWidth=h.width,c.miterLimit=h.miterlimit,c.setLineDash(h.dasharray),c.lineDashOffset=h.dashoffset;const g=h.opacity/255;switch(h.paint){case"rgb_color":c.strokeStyle=zp(h.rgb_color,h.opacity,m);break;case"linear_gradient_idx":c.strokeStyle=UC(c,i.linear_gradients[h.linear_gradient_idx],g,m);break;case"radial_gradient_idx":c.strokeStyle=jC(c,i.radial_gradients[h.radial_gradient_idx],g,m)}switch(h.linejoin){case R_.LINE_JOIN_MITER_CLIP:case R_.LINE_JOIN_MITER:c.lineJoin="miter";break;case R_.LINE_JOIN_ROUND:c.lineJoin="round";break;case R_.LINE_JOIN_BEVEL:c.lineJoin="bevel"}switch(h.linecap){case Wv.LINE_CAP_BUTT:c.lineCap="butt";break;case Wv.LINE_CAP_ROUND:c.lineCap="round";break;case Wv.LINE_CAP_SQUARE:c.lineCap="square"}c.stroke(u)}function UC(c,i,a,u){if(i.stops.length===1){const C=i.stops[0];return zp(C.rgb_color,C.opacity*a,u)}const m=Qv(i.transform),{x1:h,y1:g,x2:b,y2:E}=i,R=m.transformPoint(new DOMPoint(h,g)),v=m.transformPoint(new DOMPoint(b,E)),S=c.createLinearGradient(R.x,R.y,v.x,v.y);for(const C of i.stops)S.addColorStop(C.offset,zp(C.rgb_color,C.opacity*a,u));return S}function jC(c,i,a,u){if(i.stops.length===1){const C=i.stops[0];return zp(C.rgb_color,C.opacity*a,u)}const m=Qv(i.transform),{fx:h,fy:g,cx:b,cy:E}=i,R=m.transformPoint(new DOMPoint(h,g)),v=m.transformPoint(new DOMPoint(b,E)),S=c.createRadialGradient(R.x,R.y,0,v.x,v.y,i.r*((m.a+m.d)/2));for(const C of i.stops)S.addColorStop(C.offset,zp(C.rgb_color,C.opacity*a,u));return S}function qC(c,i,a,u){const m=u.transform?Qv(u.transform).preMultiplySelf(i):i,h=D_(c.canvas.width,c.canvas.height),g=h.getContext("2d");for(const E of u.children)if(E.group)qC(g,m,a,E.group);else if(E.path){const R=E.path,v=new Path2D;v.addPath($C(R),m),g.fill(v,BC(R))}const b=u.clip_path_idx!=null?a.clip_paths[u.clip_path_idx]:null;b&&GC(g,m,a,b),c.globalCompositeOperation="source-over",c.drawImage(h,0,0)}function GC(c,i,a,u){const m=D_(c.canvas.width,c.canvas.height);qC(m.getContext("2d"),i,a,u),c.globalCompositeOperation="destination-in",c.drawImage(m,0,0)}function HC(c,i,a,u,m){if(u.children.length===0)return;const h=u.mask_idx!=null?a.masks[u.mask_idx]:null;h&&HC(c,i,a,h,m);const g=c.canvas.width,b=c.canvas.height,E=D_(g,b),R=E.getContext("2d"),v=u.width,S=u.height,C=u.left,T=u.top,I=new Path2D,D=new Path2D;D.rect(C,T,v,S),I.addPath(D,i),R.clip(I);for(const q of u.children)NC(R,i,a,q,m);const k=R.getImageData(0,0,g,b),F=k.data;if(u.mask_type===zC.MASK_TYPE_LUMINANCE)for(let q=0;q<F.length;q+=4)F[q+3]=F[q+3]/255*(.2126*F[q]+.7152*F[q+1]+.0722*F[q+2]);R.putImageData(k,0,0),c.globalCompositeOperation="destination-in",c.drawImage(E,0,0)}function Qv(c){return c?new DOMMatrix([c.sx,c.ky,c.kx,c.sy,c.tx,c.ty]):new DOMMatrix}function $C(c){const i=new Path2D,a=c.step;let u=c.diffs[0]*a,m=c.diffs[1]*a;i.moveTo(u,m);for(let h=0,g=2;h<c.commands.length;h++)switch(c.commands[h]){case Lp.PATH_COMMAND_MOVE:u+=c.diffs[g++]*a,m+=c.diffs[g++]*a,i.moveTo(u,m);break;case Lp.PATH_COMMAND_LINE:u+=c.diffs[g++]*a,m+=c.diffs[g++]*a,i.lineTo(u,m);break;case Lp.PATH_COMMAND_QUAD:{const b=u+c.diffs[g++]*a,E=m+c.diffs[g++]*a;u=b+c.diffs[g++]*a,m=E+c.diffs[g++]*a,i.quadraticCurveTo(b,E,u,m);break}case Lp.PATH_COMMAND_CUBIC:{const b=u+c.diffs[g++]*a,E=m+c.diffs[g++]*a,R=b+c.diffs[g++]*a,v=E+c.diffs[g++]*a;u=R+c.diffs[g++]*a,m=v+c.diffs[g++]*a,i.bezierCurveTo(b,E,R,v,u,m);break}case Lp.PATH_COMMAND_CLOSE:i.closePath()}return i}class mT{constructor(i){this.capacity=i,this.cache=new Map}get(i){if(!this.cache.has(i))return;const a=this.cache.get(i);return this.cache.delete(i),this.cache.set(i,a),a}put(i,a){this.cache.has(i)?this.cache.delete(i):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(i,a)}delete(i){this.cache.delete(i)}}class gT{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(i){return new Kr(i,i.data)}getFromCache(i,a,u){return this.cacheMap.has(u)||this.cacheMap.set(u,new mT(150)),this.cacheMap.get(u).get(Eo(i.serialize(),a))}setInCache(i,a,u,m){this.cacheDependenciesMap.has(m)||this.cacheDependenciesMap.set(m,new Map),this.cacheMap.has(m)||this.cacheMap.set(m,new mT(150));const h=this.cacheDependenciesMap.get(m);h.get(Eo(i.id,u))||h.set(Eo(i.id,u),new Set);const g=this.cacheMap.get(m),b=i.serialize();h.get(Eo(i.id,u)).add(b),g.put(Eo(i.serialize(),u),a)}removeImagesFromCacheByIds(i,a,u=""){if(!this.cacheMap.has(u)||!this.cacheDependenciesMap.has(u))return;const m=this.cacheMap.get(u),h=this.cacheDependenciesMap.get(u);for(const g of i)if(h.has(Eo(g,a))){for(const b of h.get(Eo(g,a)))m.delete(b);h.delete(Eo(g,a))}}rasterize(i,a,u,m,h=dB){const g=this.getFromCache(i,u,m);if(g)return g.clone();const b=h(a.icon,i.options),E=gT._getImage(b);return this.setInCache(i,E,u,m),E.clone()}}class ZC{constructor(i){this.size=i,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(i,a){const u=this.toIdx(i,a);return{min:this.minimums[u],max:this.maximums[u]}}isLeaf(i,a){return this.leaves[this.toIdx(i,a)]}toIdx(i,a){return a*this.size+i}}function WC(c,i,a,u){let m=0,h=Number.MAX_VALUE;for(let g=0;g<3;g++)if(Math.abs(u[g])<1e-15){if(a[g]<c[g]||a[g]>i[g])return null}else{const b=1/u[g];let E=(c[g]-a[g])*b,R=(i[g]-a[g])*b;if(E>R){const v=E;E=R,R=v}if(E>m&&(m=E),R<h&&(h=R),m>h)return null}return m}function XC(c,i,a,u,m,h,g,b,E,R,v){const S=u-c,C=m-i,T=h-a,I=g-c,D=b-i,k=E-a,F=v[1]*k-v[2]*D,q=v[2]*I-v[0]*k,H=v[0]*D-v[1]*I,U=S*F+C*q+T*H;if(Math.abs(U)<1e-15)return null;const $=1/U,Y=R[0]-c,ie=R[1]-i,he=R[2]-a,ue=(Y*F+ie*q+he*H)*$;if(ue<0||ue>1)return null;const ce=ie*T-he*C,Ie=he*S-Y*T,de=Y*C-ie*S,Me=(v[0]*ce+v[1]*Ie+v[2]*de)*$;return Me<0||ue+Me>1?null:(I*ce+D*Ie+k*de)*$}function YC(c,i,a){return(c-i)/(a-i)}function KC(c,i,a,u,m,h,g,b,E){const R=1<<a,v=h-u,S=g-m,C=(c+1)/R*v+u,T=(i+0)/R*S+m,I=(i+1)/R*S+m;b[0]=(c+0)/R*v+u,b[1]=T,E[0]=C,E[1]=I}class QC{constructor(i){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=i,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const a=function(h){const g=Math.ceil(Math.log2(h.dim/8)),b=[];let E=Math.ceil(Math.pow(2,g));const R=1/E,v=(T,I,D,k,F)=>{const q=k?1:0,H=(T+1)*D-q,U=I*D,$=(I+1)*D-q;F[0]=T*D,F[1]=U,F[2]=H,F[3]=$};let S=new ZC(E);const C=[];for(let T=0;T<E*E;T++){v(T%E,Math.floor(T/E),R,!1,C);const I=ah(C[0],C[1],h),D=ah(C[2],C[1],h),k=ah(C[2],C[3],h),F=ah(C[0],C[3],h);S.minimums.push(Math.min(I,D,k,F)),S.maximums.push(Math.max(I,D,k,F)),S.leaves.push(1)}for(b.push(S),E/=2;E>=1;E/=2){const T=b[b.length-1];S=new ZC(E);for(let I=0;I<E*E;I++){v(I%E,Math.floor(I/E),2,!0,C);const D=T.getElevation(C[0],C[1]),k=T.getElevation(C[2],C[1]),F=T.getElevation(C[2],C[3]),q=T.getElevation(C[0],C[3]),H=T.isLeaf(C[0],C[1]),U=T.isLeaf(C[2],C[1]),$=T.isLeaf(C[2],C[3]),Y=T.isLeaf(C[0],C[3]),ie=Math.min(D.min,k.min,F.min,q.min),he=Math.max(D.max,k.max,F.max,q.max),ue=H&&U&&$&&Y;S.maximums.push(he),S.minimums.push(ie),S.leaves.push(he-ie<=5&&ue?1:0)}b.push(S)}return b}(this.dem),u=a.length-1,m=a[u];this._addNode(m.minimums[0],m.maximums[0],m.leaves[0]),this._construct(a,0,0,u,0)}raycastRoot(i,a,u,m,h,g,b=1){return WC([i,a,-100],[u,m,this.maximums[0]*b],h,g)}raycast(i,a,u,m,h,g,b=1){if(!this.nodeCount)return null;const E=this.raycastRoot(i,a,u,m,h,g,b);if(E==null)return null;const R=[],v=[],S=[],C=[],T=[{idx:0,t:E,nodex:0,nodey:0,depth:0}];for(;T.length>0;){const{idx:I,t:D,nodex:k,nodey:F,depth:q}=T.pop();if(this.leaves[I]){KC(k,F,q,i,a,u,m,S,C);const U=1<<q,$=(k+0)/U,Y=(k+1)/U,ie=(F+0)/U,he=(F+1)/U,ue=ah($,ie,this.dem)*b,ce=ah(Y,ie,this.dem)*b,Ie=ah(Y,he,this.dem)*b,de=ah($,he,this.dem)*b,Me=XC(S[0],S[1],ue,C[0],S[1],ce,C[0],C[1],Ie,h,g),ze=XC(C[0],C[1],Ie,S[0],C[1],de,S[0],S[1],ue,h,g),Pe=Math.min(Me!==null?Me:Number.MAX_VALUE,ze!==null?ze:Number.MAX_VALUE);if(Pe!==Number.MAX_VALUE)return Pe;{const Ne=ke.vec3.scaleAndAdd([],h,g,D);if(JC(ue,ce,de,Ie,YC(Ne[0],S[0],C[0]),YC(Ne[1],S[1],C[1]))>=Ne[2])return D}continue}let H=0;for(let U=0;U<this._siblingOffset.length;U++){KC((k<<1)+this._siblingOffset[U][0],(F<<1)+this._siblingOffset[U][1],q+1,i,a,u,m,S,C),S[2]=-100,C[2]=this.maximums[this.childOffsets[I]+U]*b;const $=WC(S,C,h,g);if($!=null){const Y=$;R[U]=Y;let ie=!1;for(let he=0;he<H&&!ie;he++)Y>=R[v[he]]&&(v.splice(he,0,U),ie=!0);ie||(v[H]=U),H++}}for(let U=0;U<H;U++){const $=v[U];T.push({idx:this.childOffsets[I]+$,t:R[$],nodex:(k<<1)+this._siblingOffset[$][0],nodey:(F<<1)+this._siblingOffset[$][1],depth:q+1})}}return null}_addNode(i,a,u){return this.minimums.push(i),this.maximums.push(a),this.leaves.push(u),this.childOffsets.push(0),this.nodeCount++}_construct(i,a,u,m,h){if(i[m].isLeaf(a,u)===1)return;this.childOffsets[h]||(this.childOffsets[h]=this.nodeCount);const g=m-1,b=i[g];let E=0,R=0;for(let v=0;v<this._siblingOffset.length;v++){const S=2*a+this._siblingOffset[v][0],C=2*u+this._siblingOffset[v][1],T=b.getElevation(S,C),I=b.isLeaf(S,C),D=this._addNode(T.min,T.max,I);I&&(E|=1<<v),R||(R=D)}for(let v=0;v<this._siblingOffset.length;v++)E&1<<v||this._construct(i,2*a+this._siblingOffset[v][0],2*u+this._siblingOffset[v][1],g,R+v)}}function JC(c,i,a,u,m,h){return ei(ei(c,a,h),ei(i,u,h),m)}function ah(c,i,a){const u=a.dim,m=bi(c*u-.5,0,u-1),h=bi(i*u-.5,0,u-1),g=Math.floor(m),b=Math.floor(h),E=Math.min(g+1,u-1),R=Math.min(b+1,u-1);return JC(a.get(g,b),a.get(E,b),a.get(g,R),a.get(E,R),m-g,h-b)}const fB={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function pB(c,i,a){return(256*c*256+256*i+a)/10-1e4}function mB(c,i,a){return 256*c+i+a/256-32768}class Jv{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(i,a,u,m=!1){if(this.uid=i,a.height!==a.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return void yi(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=a.height;const h=this.dim=a.height-2,g=new Uint32Array(a.data.buffer);if(this.pixels=new Uint8Array(a.data.buffer),this.floatView=new Float32Array(a.data.buffer),this.borderReady=m,this._modifiedForSources={},!m){for(let E=0;E<h;E++)g[this._idx(-1,E)]=g[this._idx(0,E)],g[this._idx(h,E)]=g[this._idx(h-1,E)],g[this._idx(E,-1)]=g[this._idx(E,0)],g[this._idx(E,h)]=g[this._idx(E,h-1)];g[this._idx(-1,-1)]=g[this._idx(0,0)],g[this._idx(h,-1)]=g[this._idx(h-1,0)],g[this._idx(-1,h)]=g[this._idx(0,h-1)],g[this._idx(h,h)]=g[this._idx(h-1,h-1)]}const b=u==="terrarium"?mB:pB;for(let E=0;E<g.length;++E){const R=4*E;this.floatView[E]=b(this.pixels[R],this.pixels[R+1],this.pixels[R+2])}this._timestamp=ye.now()}_buildQuadTree(){this._tree=new QC(this)}get(i,a,u=!1){u&&(i=bi(i,-1,this.dim),a=bi(a,-1,this.dim));const m=this._idx(i,a);return this.floatView[m]}set(i,a,u){const m=this._idx(i,a),h=this.floatView[m];return this.floatView[m]=u,u-h}static getUnpackVector(i){return fB[i]}_idx(i,a){if(i<-1||i>=this.dim+1||a<-1||a>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(a+1)*this.stride+(i+1)}static pack(i,a){const u=[0,0,0,0],m=Jv.getUnpackVector(a);let h=Math.floor((i+m[3])/m[2]);return u[2]=h%256,h=Math.floor(h/256),u[1]=h%256,h=Math.floor(h/256),u[0]=h,u}getPixels(){return new gI({width:this.stride,height:this.stride},this.pixels)}backfillBorder(i,a,u){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");let m=a*this.dim,h=a*this.dim+this.dim,g=u*this.dim,b=u*this.dim+this.dim;switch(a){case-1:m=h-1;break;case 1:h=m+1}switch(u){case-1:g=b-1;break;case 1:b=g+1}const E=-a*this.dim,R=-u*this.dim;for(let v=g;v<b;v++)for(let S=m;S<h;S++){const C=4*this._idx(S,v),T=4*this._idx(S+E,v+R);this.pixels[C+0]=i.pixels[T+0],this.pixels[C+1]=i.pixels[T+1],this.pixels[C+2]=i.pixels[T+2],this.pixels[C+3]=i.pixels[T+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function gB(c,i,a){c===1?i.headerLength=a.readFixed32():c===2?i.x=a.readVarint():c===3?i.y=a.readVarint():c===4?i.z=a.readVarint():c===5&&i.layers.push(function(u,m){return u.readFields(bB,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},m)}(a,a.readVarint()+a.pos))}function _B(c,i,a){c===1?(i.delta_filter=function(u,m){return u.readFields(yB,{blockSize:0},m)}(a,a.readVarint()+a.pos),i.filter="delta_filter"):c===2?(a.readVarint(),i.filter="zigzag_filter"):c===3?(a.readVarint(),i.filter="bitshuffle_filter"):c===4&&(a.readVarint(),i.filter="byteshuffle_filter")}function yB(c,i,a){c===1&&(i.blockSize=a.readVarint())}function vB(c,i,a){c===1?(a.readVarint(),i.codec="gzip_data"):c===2?(a.readVarint(),i.codec="jpeg_image"):c===3?(a.readVarint(),i.codec="webp_image"):c===4&&(a.readVarint(),i.codec="png_image")}function xB(c,i,a){let u=0,m=0;c===1?i.firstByte=a.readFixed64():c===2?i.lastByte=a.readFixed64():c===3?i.filters.push(function(h,g){return h.readFields(_B,{},g)}(a,a.readVarint()+a.pos)):c===4?i.codec=function(h,g){return h.readFields(vB,{},g)}(a,a.readVarint()+a.pos):c===5?m=a.readFloat():c===6?u=a.readFloat():c===7?i.bands.push(a.readString()):c===8?i.offset=a.readDouble():c===9&&(i.scale=a.readDouble()),i.offset===0&&(i.offset=m),i.scale===0&&(i.scale=u)}function bB(c,i,a){c===1?i.version=a.readVarint():c===2?i.name=a.readString():c===3?i.units=a.readString():c===4?i.tileSize=a.readVarint():c===5?i.buffer=a.readVarint():c===6?i.pixelFormat=a.readVarint():c===7&&i.dataIndex.push(function(u,m){return u.readFields(xB,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},m)}(a,a.readVarint()+a.pos))}function wB(c,i,a){if(c===2)(function(u,m,h){u.readFields(TB,h,m)})(a,a.readVarint()+a.pos,i);else if(c===3)throw new Error("Not implemented")}function TB(c,i,a){if(c===1){let u=0;const m=a.readVarint()+a.pos;for(;a.pos<m;)i[u++]=a.readVarint()}}function EB(c,i){if(i.length!==4)throw new Error(`Expected data of dimension 4 but got ${i.length}.`);let a=i[3];for(let u=2;u>=1;u--){const m=u===1?1:0,h=u===2?1:0;for(let g=0;g<i[0];g++){const b=i[1]*g;for(let E=m;E<i[1];E++){const R=i[2]*(E+b);for(let v=h;v<i[2];v++){const S=i[3]*(v+R);for(let C=0;C<i[3];C++){const T=S+C;c[T]+=c[T-a]}}}}a*=i[u]}return c}function SB(c){for(let i=0,a=c.length;i<a;i++)c[i]=c[i]>>>1^-(1&c[i]);return c}function AB(c,i){switch(i){case"uint32":return c;case"uint16":for(let a=0;a<c.length;a+=2){const u=c[a],m=c[a+1];c[a]=(240&u)>>4|(61440&u)>>8|(240&m)<<4|61440&m,c[a+1]=15&u|(3840&u)>>4|(15&m)<<8|(3840&m)<<4}return c;case"uint8":for(let a=0;a<c.length;a+=4){const u=c[a],m=c[a+1],h=c[a+2],g=c[a+3];c[a+0]=(192&u)>>6|(192&m)>>4|(192&h)>>2|192&g,c[a+1]=(48&u)>>4|(48&m)>>2|48&h|(48&g)<<2,c[a+2]=(12&u)>>2|12&m|(12&h)<<2|(12&g)<<4,c[a+3]=3&u|(3&m)<<2|(3&h)<<4|(3&g)<<6}return c;default:throw new Error(`Invalid pixel format, "${i}"`)}}Gt(Jv,"DEMData"),Gt(QC,"DemMinMaxQuadTree",{omit:["dem"]});var ro=Uint8Array,P_=Uint16Array,IB=Int32Array,eR=new ro([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),tR=new ro([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),MB=new ro([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),iR=function(c,i){for(var a=new P_(31),u=0;u<31;++u)a[u]=i+=1<<c[u-1];var m=new IB(a[30]);for(u=1;u<30;++u)for(var h=a[u];h<a[u+1];++h)m[h]=h-a[u]<<5|u;return{b:a,r:m}},nR=iR(eR,2),rR=nR.b,CB=nR.r;rR[28]=258,CB[258]=28;for(var RB=iR(tR,0).b,sR=new P_(32768),pr=0;pr<32768;++pr){var Op=(43690&pr)>>1|(21845&pr)<<1;sR[pr]=((65280&(Op=(61680&(Op=(52428&Op)>>2|(13107&Op)<<2))>>4|(3855&Op)<<4))>>8|(255&Op)<<8)>>1}var L_=function(c,i,a){for(var u=c.length,m=0,h=new P_(i);m<u;++m)c[m]&&++h[c[m]-1];var g,b=new P_(i);for(m=1;m<i;++m)b[m]=b[m-1]+h[m-1]<<1;g=new P_(1<<i);var E=15-i;for(m=0;m<u;++m)if(c[m])for(var R=m<<4|c[m],v=i-c[m],S=b[c[m]-1]++<<v,C=S|(1<<v)-1;S<=C;++S)g[sR[S]>>E]=R;return g},z_=new ro(288);for(pr=0;pr<144;++pr)z_[pr]=8;for(pr=144;pr<256;++pr)z_[pr]=9;for(pr=256;pr<280;++pr)z_[pr]=7;for(pr=280;pr<288;++pr)z_[pr]=8;var aR=new ro(32);for(pr=0;pr<32;++pr)aR[pr]=5;var DB=L_(z_,9),PB=L_(aR,5),_T=function(c){for(var i=c[0],a=1;a<c.length;++a)c[a]>i&&(i=c[a]);return i},pl=function(c,i,a){var u=i/8|0;return(c[u]|c[u+1]<<8)>>(7&i)&a},yT=function(c,i){var a=i/8|0;return(c[a]|c[a+1]<<8|c[a+2]<<16)>>(7&i)},LB=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],ml=function(c,i,a){var u=new Error(i||LB[c]);if(u.code=c,Error.captureStackTrace&&Error.captureStackTrace(u,ml),!a)throw u;return u},zB=new ro(0),OB=typeof TextDecoder<"u"&&new TextDecoder;try{OB.decode(zB,{stream:!0})}catch{}const kB={gzip_data:"gzip"};class Do extends Error{constructor(i){super(i),this.name="MRTError"}}const NB={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},oR={uint32:1,uint16:2,uint8:4},FB={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let vT;class xT{constructor(i=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=i}getLayer(i){const a=this.layers[i];if(!a)throw new Do(`Layer '${i}' not found`);return a}getHeaderLength(i){const a=new Uint8Array(i),u=new DataView(i);if(a[0]!==13)throw new Do("File is not a valid MRT.");return u.getUint32(1,!0)}parseHeader(i){const a=new Uint8Array(i),u=this.getHeaderLength(i);if(a.length<u)throw new Do(`Expected header with length >= ${u} but got buffer of length ${a.length}`);const m=function(h,g){return h.readFields(gB,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new vT(a.subarray(0,u)));if(!isNaN(this.x)&&(this.x!==m.x||this.y!==m.y||this.z!==m.z))throw new Do(`Invalid attempt to parse header ${m.z}/${m.x}/${m.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=m.x,this.y=m.y,this.z=m.z;for(const h of m.layers)this.layers[h.name]=new BB(h,{cacheSize:this._cacheSize});return this}createDecodingTask(i){const a=[],u=this.getLayer(i.layerName);for(let m of i.blockIndices){const h=u.dataIndex[m],g=h.firstByte-i.firstByte,b=h.lastByte-i.firstByte;if(u._blocksInProgress.has(m))continue;const E={layerName:u.name,firstByte:g,lastByte:b,pixelFormat:u.pixelFormat,blockIndex:m,blockShape:[h.bands.length].concat(u.bandShape),buffer:u.buffer,codec:h.codec.codec,filters:h.filters.map(R=>R.filter)};u._blocksInProgress.add(m),a.push(E)}return new lR(a,()=>{a.forEach(m=>u._blocksInProgress.delete(m.blockIndex))},(m,h)=>{if(a.forEach(g=>u._blocksInProgress.delete(g.blockIndex)),m)throw m;h.forEach(g=>{this.getLayer(g.layerName).processDecodedData(g)})})}}class BB{constructor({version:i,name:a,units:u,tileSize:m,pixelFormat:h,buffer:g,dataIndex:b},E){if(this.version=i,this.version!==1)throw new Do(`Cannot parse raster layer encoded with MRT version ${i}`);this.name=a,this.units=u,this.tileSize=m,this.buffer=g,this.pixelFormat=NB[h],this.dataIndex=b,this.bandShape=[m+2*g,m+2*g,oR[this.pixelFormat]],this._decodedBlocks=new mT(E?E.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return oR[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:i})=>i).flat()}processDecodedData(i){const a=i.blockIndex.toString();this._decodedBlocks.get(a)||this._decodedBlocks.put(a,i.data)}getBlockForBand(i){let a=0;switch(typeof i){case"string":for(const[u,m]of this.dataIndex.entries()){for(const[h,g]of m.bands.entries())if(g===i)return{bandIndex:a+h,blockIndex:u,blockBandIndex:h};a+=m.bands.length}break;case"number":for(const[u,m]of this.dataIndex.entries()){if(i>=a&&i<a+m.bands.length)return{bandIndex:i,blockIndex:u,blockBandIndex:i-a};a+=m.bands.length}break;default:throw new Do(`Invalid band \`${JSON.stringify(i)}\`. Expected string or integer.`)}throw new Do(`Band not found: ${JSON.stringify(i)}`)}getDataRange(i){let a=1/0,u=-1/0;const m=[],h=new Set;for(const g of i){const{blockIndex:b}=this.getBlockForBand(g);if(b<0)throw new Do(`Invalid band: ${JSON.stringify(g)}`);const E=this.dataIndex[b];m.includes(b)||m.push(b),h.add(b),a=Math.min(a,E.firstByte),u=Math.max(u,E.lastByte)}if(h.size>this.cacheSize)throw new Do(`Number of blocks to decode (${h.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:a,lastByte:u,blockIndices:m}}hasBand(i){const{blockIndex:a}=this.getBlockForBand(i);return a>=0}hasDataForBand(i){const{blockIndex:a}=this.getBlockForBand(i);return a>=0&&!!this._decodedBlocks.get(a.toString())}getBandView(i){const{blockIndex:a,blockBandIndex:u}=this.getBlockForBand(i),m=this._decodedBlocks.get(a.toString());if(!m)throw new Do(`Data for band ${JSON.stringify(i)} of layer "${this.name}" not decoded.`);const h=this.dataIndex[a],g=this.bandShape.reduce((R,v)=>R*v,1),b=u*g,E=m.subarray(b,b+g);return{data:E,bytes:new Uint8Array(E.buffer).subarray(E.byteOffset,E.byteOffset+E.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:h.offset,scale:h.scale}}}xT.setPbf=function(c){vT=c};class lR{constructor(i,a,u){this.tasks=i,this._onCancel=a,this._onComplete=u,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(i,a){this._finalized||(this._onComplete(i,a),this._finalized=!0)}}xT.performDecoding=function(c,i){const a=new Uint8Array(c);return Promise.all(i.tasks.map(u=>{const{layerName:m,firstByte:h,lastByte:g,pixelFormat:b,blockShape:E,blockIndex:R,filters:v,codec:S}=u,C=a.subarray(h,g+1),T=new Uint32Array(E[0]*E[1]*E[2]);let I;if(S!=="gzip_data")throw new Do(`Unhandled codec: ${S}`);return I=function(D,k){if(!globalThis.DecompressionStream&&k==="gzip_data")return Promise.resolve(((U=function(ie){ie[0]==31&&ie[1]==139&&ie[2]==8||ml(6,"invalid gzip data");var he=ie[3],ue=10;4&he&&(ue+=2+(ie[10]|ie[11]<<8));for(var ce=(he>>3&1)+(he>>4&1);ce>0;ce-=!ie[ue++]);return ue+(2&he)}(H=D))+8>H.length&&ml(6,"invalid gzip data"),function(ie,he,ue,ce){var Ie=ie.length;if(!Ie||he.f&&!he.l)return ue||new ro(0);var de=!ue,Me=de||he.i!=2,ze=he.i;de&&(ue=new ro(3*Ie));var Pe,Ne,qe=function(oh){var Kd=ue.length;if(oh>Kd){var F_=new ro(Math.max(2*Kd,oh));F_.set(ue),ue=F_}},Ze=he.f||0,Be=he.p||0,ct=he.b||0,yt=he.l,lt=he.d,Lt=he.m,Dt=he.n,wt=8*Ie;do{if(!yt){Ze=pl(ie,Be,1);var vt=pl(ie,Be+1,3);if(Be+=3,!vt){var Zt=ie[(pi=4+((Be+7)/8|0))-4]|ie[pi-3]<<8,zt=pi+Zt;if(zt>Ie){ze&&ml(0);break}Me&&qe(ct+Zt),ue.set(ie.subarray(pi,zt),ct),he.b=ct+=Zt,he.p=Be=8*zt,he.f=Ze;continue}if(vt==1)yt=DB,lt=PB,Lt=9,Dt=5;else if(vt==2){var Ft=pl(ie,Be,31)+257,hi=pl(ie,Be+10,15)+4,xi=Ft+pl(ie,Be+5,31)+1;Be+=14;for(var Ti=new ro(xi),Ei=new ro(19),Ci=0;Ci<hi;++Ci)Ei[MB[Ci]]=pl(ie,Be+3*Ci,7);Be+=3*hi;var Ri=_T(Ei),dn=(1<<Ri)-1,rn=L_(Ei,Ri);for(Ci=0;Ci<xi;){var pi,Ji=rn[pl(ie,Be,dn)];if(Be+=15&Ji,(pi=Ji>>4)<16)Ti[Ci++]=pi;else{var tn=0,In=0;for(pi==16?(In=3+pl(ie,Be,3),Be+=2,tn=Ti[Ci-1]):pi==17?(In=3+pl(ie,Be,7),Be+=3):pi==18&&(In=11+pl(ie,Be,127),Be+=7);In--;)Ti[Ci++]=tn}}var tr=Ti.subarray(0,Ft),mr=Ti.subarray(Ft);Lt=_T(tr),Dt=_T(mr),yt=L_(tr,Lt),lt=L_(mr,Dt)}else ml(1);if(Be>wt){ze&&ml(0);break}}Me&&qe(ct+131072);for(var ir=(1<<Lt)-1,jn=(1<<Dt)-1,ar=Be;;ar=Be){var wr=(tn=yt[yT(ie,Be)&ir])>>4;if((Be+=15&tn)>wt){ze&&ml(0);break}if(tn||ml(2),wr<256)ue[ct++]=wr;else{if(wr==256){ar=Be,yt=null;break}var ps=wr-254;wr>264&&(ps=pl(ie,Be,(1<<(_l=eR[Ci=wr-257]))-1)+rR[Ci],Be+=_l);var wn=lt[yT(ie,Be)&jn],Sa=wn>>4;if(wn||ml(3),Be+=15&wn,mr=RB[Sa],Sa>3){var _l=tR[Sa];mr+=yT(ie,Be)&(1<<_l)-1,Be+=_l}if(Be>wt){ze&&ml(0);break}Me&&qe(ct+131072);var Po=ct+ps;if(ct<mr){var Lo=0-mr,Yd=Math.min(mr,Po);for(Lo+ct<0&&ml(3);ct<Yd;++ct)ue[ct]=(void 0)[Lo+ct]}for(;ct<Po;++ct)ue[ct]=ue[ct-mr]}}he.l=yt,he.p=ar,he.b=ct,he.f=Ze,yt&&(Ze=1,he.m=Lt,he.d=lt,he.n=Dt)}while(!Ze);return ct!=ue.length&&de?(Pe=ue,((Ne=ct)==null||Ne>Pe.length)&&(Ne=Pe.length),new ro(Pe.subarray(0,Ne))):ue.subarray(0,ct)}(H.subarray(U,-8),{i:2},new ro(((F=H)[(q=F.length)-4]|F[q-3]<<8|F[q-2]<<16|F[q-1]<<24)>>>0))));var F,q,H,U;const $=kB[k];if(!$)throw new Error(`Unhandled codec: ${k}`);const Y=new globalThis.DecompressionStream($);return new Response(new Blob([D]).stream().pipeThrough(Y)).arrayBuffer().then(ie=>new Uint8Array(ie))}(C,S).then(D=>(function(k,F){k.readFields(wB,F)}(new vT(D),T),new FB[b](T.buffer))),I.then(D=>{for(let k=v.length-1;k>=0;k--)switch(v[k]){case"delta_filter":EB(D,E);break;case"zigzag_filter":SB(D);break;case"bitshuffle_filter":AB(D,b);break;default:throw new Do(`Unhandled filter "${v[k]}"`)}return{layerName:m,blockIndex:R,data:D}}).catch(D=>{throw D})}))},Gt(lR,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});let O_,bT,gl,kp,wT,Np=null;function cR(){return Ls()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:bT||Kn.DRACO_URL}function uR(){if(Ls()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(kp)return kp;const c=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return kp=WebAssembly.validate(c)?Kn.MESHOPT_SIMD_URL:Kn.MESHOPT_URL,kp}const ex={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},VB={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},k_={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function hR(c,i,a){const u=a.json.bufferViews.length,m=a.buffers.length;i.bufferView=u,a.json.bufferViews[u]={buffer:m,byteLength:c.byteLength},a.buffers[m]=c}const TT="KHR_draco_mesh_compression";function UB(c,i){const a=c.extensions&&c.extensions[TT];if(!a)return;const u=new gl.Decoder,m=mR(i,a.bufferView),h=new gl.Mesh;if(!u.DecodeArrayToMesh(m,m.byteLength,h))throw new Error("Failed to decode Draco mesh");const g=i.json.accessors[c.indices],b=ex[g.componentType],E=g.count*b.BYTES_PER_ELEMENT,R=gl._malloc(E);b===Uint16Array?u.GetTrianglesUInt16Array(h,E,R):u.GetTrianglesUInt32Array(h,E,R),hR(gl.memory.buffer.slice(R,R+E),g,i),gl._free(R);for(const v of Object.keys(a.attributes)){const S=u.GetAttributeByUniqueId(h,a.attributes[v]),C=i.json.accessors[c.attributes[v]],T=VB[C.componentType],I=C.count*k_[C.type]*ex[C.componentType].BYTES_PER_ELEMENT,D=gl._malloc(I);u.GetAttributeDataArrayForAllPoints(h,S,gl[T],I,D),hR(gl.memory.buffer.slice(D,D+I),C,i),gl._free(D)}u.destroy(),h.destroy(),delete c.extensions[TT]}const tx="EXT_meshopt_compression";function jB(c,i){if(!c.extensions||!c.extensions[tx])return;const a=c.extensions[tx],u=new Uint8Array(i.buffers[a.buffer],a.byteOffset||0,a.byteLength||0),m=new Uint8Array(a.count*a.byteStride);wT.decodeGltfBuffer(m,a.count,a.byteStride,u,a.mode,a.filter),c.buffer=i.buffers.length,c.byteOffset=0,i.buffers[c.buffer]=m.buffer,delete c.extensions[tx]}const dR=1179937895,fR=new TextDecoder("utf8");function pR(c,i){return new URL(c,i).href}function qB(c,i,a,u){return fetch(pR(c.uri,u)).then(m=>m.arrayBuffer()).then(m=>{i.buffers[a]=m})}function mR(c,i){const a=c.json.bufferViews[i];return new Uint8Array(c.buffers[a.buffer],a.byteOffset||0,a.byteLength)}function GB(c,i,a,u){if(c.uri){const m=pR(c.uri,u);return fetch(m).then(h=>h.blob()).then(h=>createImageBitmap(h)).then(h=>{i.images[a]=h})}if(c.bufferView!==void 0){const m=mR(i,c.bufferView),h=new Blob([m],{type:c.mimeType});return createImageBitmap(h).then(g=>{i.images[a]=g})}}function gR(c,i=0,a){const u={json:null,images:[],buffers:[]};if(new Uint32Array(c,i,1)[0]===dR){const v=new Uint32Array(c,i);let S=2;const C=(v[S++]>>2)-3,T=v[S++]>>2;if(S++,u.json=JSON.parse(fR.decode(v.subarray(S,S+T))),S+=T,S<C){const I=v[S++];S++;const D=i+(S<<2);u.buffers[0]=c.slice(D,D+I)}}else u.json=JSON.parse(fR.decode(new Uint8Array(c,i)));const{buffers:m,images:h,meshes:g,extensionsUsed:b,bufferViews:E}=u.json;let R=Promise.resolve();if(m){const v=[];for(let S=0;S<m.length;S++){const C=m[S];C.uri?v.push(qB(C,u,S,a)):u.buffers[S]||(u.buffers[S]=null)}R=Promise.all(v)}return R.then(()=>{const v=[],S=b&&b.includes(TT),C=b&&b.includes(tx);if(S&&v.push(function(){if(!gl)return O_??(O_=function(T){let I,D=null;function k(){I=new Uint8Array(D.buffer)}function F(){throw new Error("Unexpected Draco error.")}const q={a:{a:F,d:function(H,U,$){return I.copyWithin(H,U,U+$)},c:function(H){const U=I.length,$=Math.max(H>>>0,Math.ceil(1.2*U)),Y=Math.ceil(($-U)/65536);try{return D.grow(Y),k(),!0}catch{return!1}},b:F}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(T,q):T.then(H=>H.arrayBuffer()).then(H=>WebAssembly.instantiate(H,q))).then(H=>{const{Rb:U,Qb:$,P:Y,T:ie,X:he,Ja:ue,La:ce,Qa:Ie,Va:de,Wa:Me,eb:ze,jb:Pe,f:Ne,e:qe,yb:Ze,zb:Be,Ab:ct,Bb:yt,Db:lt,Gb:Lt}=H.instance.exports;D=qe;const Dt=(()=>{let wt=0,vt=0,Zt=0,zt=0;return Ft=>{Zt&&(U(zt),U(wt),vt+=Zt,Zt=wt=0),wt||(vt+=128,wt=$(vt));const hi=Ft.length+7&-8;let xi=wt;hi>=vt&&(Zt=hi,xi=zt=$(hi));for(let Ti=0;Ti<Ft.length;Ti++)I[xi+Ti]=Ft[Ti];return xi}})();return k(),Ne(),{memory:qe,_free:U,_malloc:$,Mesh:class{constructor(){this.ptr=Y()}destroy(){ie(this.ptr)}},Decoder:class{constructor(){this.ptr=ue()}destroy(){Pe(this.ptr)}DecodeArrayToMesh(wt,vt,Zt){const zt=Dt(wt),Ft=ce(this.ptr,zt,vt,Zt.ptr);return!!he(Ft)}GetAttributeByUniqueId(wt,vt){return{ptr:Ie(this.ptr,wt.ptr,vt)}}GetTrianglesUInt16Array(wt,vt,Zt){de(this.ptr,wt.ptr,vt,Zt)}GetTrianglesUInt32Array(wt,vt,Zt){Me(this.ptr,wt.ptr,vt,Zt)}GetAttributeDataArrayForAllPoints(wt,vt,Zt,zt,Ft){ze(this.ptr,wt.ptr,vt.ptr,Zt,zt,Ft)}},DT_INT8:Ze(),DT_UINT8:Be(),DT_INT16:ct(),DT_UINT16:yt(),DT_UINT32:lt(),DT_FLOAT32:Lt()}})}(fetch(cR())),O_.then(T=>{gl=T,O_=void 0}))}()),C&&v.push(function(){if(wT)return;const T=function(I){let D;const k=WebAssembly.instantiateStreaming(I,{}).then(H=>{D=H.instance,D.exports.__wasm_call_ctors()}),F={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},q={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:k,supported:!0,decodeGltfBuffer(H,U,$,Y,ie,he){(function(ue,ce,Ie,de,Me,ze,Pe){const Ne=ue.exports.sbrk,qe=de+3&-4,Ze=Ne(qe*Me),Be=Ne(ze.length),ct=new Uint8Array(ue.exports.memory.buffer);ct.set(ze,Be);const yt=ce(Ze,de,Me,Be,ze.length);if(yt===0&&Pe&&Pe(Ze,qe,Me),Ie.set(ct.subarray(Ze,Ze+de*Me)),Ne(Ze-Ne(0)),yt!==0)throw new Error(`Malformed buffer data: ${yt}`)})(D,D.exports[q[ie]],H,U,$,Y,D.exports[F[he]])}}}(fetch(uR()));return T.ready.then(()=>{wT=T})}()),h)for(let T=0;T<h.length;T++)v.push(GB(h[T],u,T,a));return(v.length?Promise.all(v):Promise.resolve()).then(()=>{if(S&&g)for(const{primitives:T}of g)for(const I of T)UB(I,u);if(C&&g&&E)for(const T of E)jB(T,u);return u})})}function Xd(c,i){const a=c.json.bufferViews[i.bufferView],u=ex[i.componentType];return new u(c.buffers[a.buffer],(i.byteOffset||0)+(a.byteOffset||0),i.count*(a.byteStride&&a.byteStride!==k_[i.type]*u.BYTES_PER_ELEMENT?a.byteStride/u.BYTES_PER_ELEMENT:k_[i.type]))}function ET(c,i,a,u){const m=ex[i.componentType],h=function(v){switch(v){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(m),g=c.json.bufferViews[i.bufferView],b=g.byteStride?g.byteStride/m.BYTES_PER_ELEMENT:k_[i.type],E=a.float32,R=E.length/a.capacity;for(let v=0,S=0;v<i.count*b;v+=b,S+=R)for(let C=0;C<R;C++)E[S+C]=u[v+C]*h;a._trim()}function HB(c,i,a){const u=c.indices,m=c.attributes,h={};h.indexArray=new Gr;const g=i.json.accessors[u],b=g.count/3;h.indexArray.reserve(b);const E=Xd(i,g);for(let C=0;C<b;C++)h.indexArray.emplaceBack(E[3*C],E[3*C+1],E[3*C+2]);h.indexArray._trim(),h.vertexArray=new So;const R=i.json.accessors[m.POSITION];h.vertexArray.reserve(R.count);const v=Xd(i,R);for(let C=0;C<R.count;C++)h.vertexArray.emplaceBack(v[3*C],v[3*C+1],v[3*C+2]);if(h.vertexArray._trim(),h.aabb=new Xt(R.min,R.max),h.centroid=function(C,T){const I=[0,0,0],D=C.length;if(D>0){for(let k=0;k<D;k++){const F=3*C[k];I[0]+=T[F],I[1]+=T[F+1],I[2]+=T[F+2]}I[0]/=D,I[1]/=D,I[2]/=D}return I}(E,v),m.COLOR_0!==void 0){const C=i.json.accessors[m.COLOR_0],T=k_[C.type],I=Xd(i,C);h.colorArray=T===3?new So:new Nc,h.colorArray.resize(C.count),ET(i,C,h.colorArray,I)}if(m.NORMAL!==void 0){h.normalArray=new So;const C=i.json.accessors[m.NORMAL];h.normalArray.resize(C.count);const T=Xd(i,C);ET(i,C,h.normalArray,T)}if(m.TEXCOORD_0!==void 0&&a.length>0){h.texcoordArray=new Zu;const C=i.json.accessors[m.TEXCOORD_0];h.texcoordArray.resize(C.count);const T=Xd(i,C);ET(i,C,h.texcoordArray,T)}if(m._FEATURE_ID_RGBA4444!==void 0){const C=i.json.accessors[m._FEATURE_ID_RGBA4444];i.json.extensionsUsed&&i.json.extensionsUsed.includes("EXT_meshopt_compression")&&(h.featureData=Xd(i,C))}m._FEATURE_RGBA4444!==void 0&&(h.featureData=new Uint32Array(Xd(i,i.json.accessors[m._FEATURE_RGBA4444]).buffer));const S=c.material;return h.material=function(C,T){const{emissiveFactor:I=[0,0,0],alphaMode:D="OPAQUE",alphaCutoff:k=.5,normalTexture:F,occlusionTexture:q,emissiveTexture:H,doubleSided:U}=C,{baseColorFactor:$=[1,1,1,1],metallicFactor:Y=1,roughnessFactor:ie=1,baseColorTexture:he,metallicRoughnessTexture:ue}=C.pbrMetallicRoughness||{},ce=q?T[q.index]:void 0;if(q&&q.extensions&&q.extensions.KHR_texture_transform&&ce){const Ie=q.extensions.KHR_texture_transform;ce.offsetScale=[Ie.offset[0],Ie.offset[1],Ie.scale[0],Ie.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new $i(...$),metallicFactor:Y,roughnessFactor:ie,baseColorTexture:he?T[he.index]:void 0,metallicRoughnessTexture:ue?T[ue.index]:void 0},doubleSided:U,emissiveFactor:I,alphaMode:D,alphaCutoff:k,normalTexture:F?T[F.index]:void 0,occlusionTexture:ce,emissionTexture:H?T[H.index]:void 0,defined:C.defined===void 0}}(S!==void 0?i.json.materials[S]:{defined:!1},a),h}function _R(c,i,a){const{matrix:u,rotation:m,translation:h,scale:g,mesh:b,extras:E,children:R}=c,v={};if(v.matrix=u||ke.mat4.fromRotationTranslationScale([],m||[0,0,0,1],h||[0,0,0],g||[1,1,1]),b!==void 0){v.meshes=a[b];const S=v.anchor=[0,0];for(const C of v.meshes){const{min:T,max:I}=C.aabb;S[0]+=T[0]+I[0],S[1]+=T[1]+I[1]}S[0]=Math.floor(S[0]/v.meshes.length/2),S[1]=Math.floor(S[1]/v.meshes.length/2)}if(E&&(E.id&&(v.id=E.id),E.lights&&(v.lights=function(S){if(!S.length)return[];const C=function(F){const q=atob(F),H=new Uint8Array(q.length);for(let U=0;U<q.length;U++)H[U]=q.codePointAt(U);return H}(S),T=[],I=C.length/24,D=new Uint16Array(C.buffer),k=new Float32Array(C.buffer);for(let F=0;F<I;F++){const q=D[2*F*6]/30,H=D[2*F*6+1]/30,U=D[2*F*6+10]/100,$=k[6*F+1],Y=k[6*F+2],ie=k[6*F+3],he=k[6*F+4],ue=ie-$,ce=he-Y,Ie=Math.hypot(ue,ce);T.push({pos:[$+.5*ue,Y+.5*ce,H],normal:[ce/Ie,-ue/Ie,0],width:Ie,height:q,depth:U,points:[$,Y,ie,he]})}return T}(E.lights))),R){const S=[];for(const C of R)S.push(_R(i.json.nodes[C],i,a));v.children=S}return v}function $B(c){if(c.vertices.length===0||c.indices.length===0)return null;const i=new Aw(c.vertices,c.indices,8,256),[a,u]=[i.min.clone(),i.max.clone()];return{vertices:c.vertices,indices:c.indices,grid:i,min:a,max:u}}function ZB(c){if(!c.extras||!c.extras.ground)return null;const i=c.extras.ground;if(!i||!Array.isArray(i)||i.length===0)return null;const a=i[0];if(!a||!Array.isArray(a)||a.length===0)return null;const u=[];for(const g of a){if(!Array.isArray(g)||g.length!==2)continue;const b=g[0],E=g[1];typeof b=="number"&&typeof E=="number"&&u.push(new St(b,E))}if(u.length<3)return null;u.length>1&&u[u.length-1].equals(u[0])&&u.pop();let m=0;for(let g=0;g<u.length;g++){const b=u[g],E=u[(g+1)%u.length],R=u[(g+2)%u.length];m+=(b.x-E.x)*(R.y-E.y)-(R.x-E.x)*(b.y-E.y)}m>0&&u.reverse();const h=a_(u.flatMap(g=>[g.x,g.y]),[]);return h.length===0?null:{vertices:u,indices:h}}function WB(c,i){const a=[],u=[];let m=0;const h=[];for(const g of c){m=a.length;const b=g.vertexArray.float32,E=g.indexArray.uint16;for(let R=0;R<g.vertexArray.length;R++)h[0]=b[3*R+0],h[1]=b[3*R+1],h[2]=b[3*R+2],ke.vec3.transformMat4(h,h,i),a.push(new St(h[0],h[1]));for(let R=0;R<3*g.indexArray.length;R++)u.push(E[R]+m)}if(u.length%3!=0)return null;for(let g=0;g<u.length;g+=3){const b=a[u[g+0]],E=a[u[g+1]],R=a[u[g+2]];(b.x-E.x)*(R.y-E.y)-(R.x-E.x)*(b.y-E.y)>0&&([u[g+1],u[g+2]]=[u[g+2],u[g+1]])}return{vertices:a,indices:u}}function yR(c){const i=function(E,R){const v=[],S=WebGL2RenderingContext;if(E.json.textures)for(const C of E.json.textures){const T={magFilter:S.LINEAR,minFilter:S.NEAREST,wrapS:S.REPEAT,wrapT:S.REPEAT};C.sampler!==void 0&&Object.assign(T,E.json.samplers[C.sampler]),v.push({image:R[C.source],sampler:T,uploaded:!1})}return v}(c,c.images),a=function(E,R){const v=[];for(const S of E.json.meshes){const C=[];for(const T of S.primitives)C.push(HB(T,E,R));v.push(C)}return v}(c,i),{scenes:u,scene:m,nodes:h}=c.json,g=u?u[m||0].nodes:h,b=[];for(const E of g)b.push(_R(h[E],c,a));return function(E,R,v){const S={},C=new Set;for(let T=0;T<E.length;T++){const I=v[R[T]];if(!I.extras)continue;const D=I.extras["mapbox:footprint:version"],k=I.extras["mapbox:footprint:id"];(D||k)&&C.add(T),D==="1.0.0"&&k&&(S[k]=T)}for(let T=0;T<E.length;T++){if(C.has(T))continue;const I=E[T],D=v[R[T]];if(!D.extras)continue;let k=null;I.id in S&&(k=WB(E[S[I.id]].meshes,I.matrix)),k||(k=ZB(D)),k&&(I.footprint=$B(k))}if(C.size>0){const T=Array.from(C.values()).sort((I,D)=>I-D);for(let I=T.length-1;I>=0;I--)E.splice(T[I],1)}}(b,g,c.json.nodes),b}function XB(c){c.heightmap=new Float32Array(4096),c.heightmap.fill(-1);const i=c.vertexArray.float32,a=c.aabb.min[0]-1,u=c.aabb.min[1]-1,m=$d/(c.aabb.max[0]-a+2),h=$d/(c.aabb.max[1]-u+2);for(let g=0;g<i.length;g+=3){const b=i[g+2],E=(i[g+0]-a)*m|0,R=(i[g+1]-u)*h|0;b>c.heightmap[R*$d+E]&&(c.heightmap[R*$d+E]=b)}}function YB(c,i){const a={};a.indexArray=new Gr,a.indexArray.reserve(4*c.length),a.vertexArray=new So,a.vertexArray.reserve(10*c.length),a.colorArray=new Nc,a.vertexArray.reserve(10*c.length);let u=0;for(const g of c){const b=Math.min(10,Math.max(4,1.3*g.height))*i,E=[-g.normal[1],g.normal[0],0],R=Math.min(.29,.1*g.width/g.depth),v=g.width-2*g.depth*i*(R+.01),S=ke.vec3.scaleAndAdd([],g.pos,E,v/2),C=ke.vec3.scaleAndAdd([],g.pos,E,-v/2),T=[S[0],S[1],S[2]+g.height],I=[C[0],C[1],C[2]+g.height],D=ke.vec3.scaleAndAdd([],g.normal,E,R);ke.vec3.scale(D,D,b);const k=ke.vec3.scaleAndAdd([],g.normal,E,-R);ke.vec3.scale(k,k,b),ke.vec3.add(D,S,D),ke.vec3.add(k,C,k),S[2]+=.1,C[2]+=.1,a.vertexArray.emplaceBack(D[0],D[1],D[2]),a.vertexArray.emplaceBack(k[0],k[1],k[2]),a.vertexArray.emplaceBack(S[0],S[1],S[2]),a.vertexArray.emplaceBack(C[0],C[1],C[2]),a.vertexArray.emplaceBack(T[0],T[1],T[2]),a.vertexArray.emplaceBack(I[0],I[1],I[2]),a.vertexArray.emplaceBack(S[0],S[1],S[2]),a.vertexArray.emplaceBack(C[0],C[1],C[2]),a.vertexArray.emplaceBack(D[0],D[1],D[2]),a.vertexArray.emplaceBack(k[0],k[1],k[2]);const F=v/b/2;a.colorArray.emplaceBack(-F-R,-1,F,.8),a.colorArray.emplaceBack(F+R,-1,F,.8),a.colorArray.emplaceBack(-F,0,F,1.3),a.colorArray.emplaceBack(F,0,F,1.3),a.colorArray.emplaceBack(F+R,-.8,F,.7),a.colorArray.emplaceBack(F+R,-.8,F,.7),a.colorArray.emplaceBack(0,0,F,1.3),a.colorArray.emplaceBack(0,0,F,1.3),a.colorArray.emplaceBack(F+R,-1.2,F,.8),a.colorArray.emplaceBack(F+R,-1.2,F,.8),a.indexArray.emplaceBack(6+u,4+u,8+u),a.indexArray.emplaceBack(7+u,9+u,5+u),a.indexArray.emplaceBack(0+u,1+u,2+u),a.indexArray.emplaceBack(1+u,3+u,2+u),u+=10}const m={defined:!0,emissiveFactor:[0,0,0]},h={};return h.baseColorFactor=$i.white,m.pbrMetallicRoughness=h,a.material=m,a.aabb=new Xt([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),a}class vR{constructor(i){this._stringToNumber={},this._numberToString=[];for(let a=0;a<i.length;a++){const u=i[a];this._stringToNumber[u]=a,this._numberToString[a]=u}}encode(i){return this._stringToNumber[i]}decode(i){return this._numberToString[i]}}const KB=["id","tile","layer","source","sourceLayer","state"];class Fp{constructor(i,a,u,m,h){this.type="Feature",this._vectorTileFeature=i,this._z=a,this._x=u,this._y=m,this.properties=i.properties,this.id=h}clone(){const i=new Fp(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(i.state=Object.assign({},this.state)),this.layer&&(i.layer=Object.assign({},this.layer)),this.source&&(i.source=this.source),this.sourceLayer&&(i.sourceLayer=this.sourceLayer),i}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(i){this._geometry=i}toJSON(){const i={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const a of KB)this[a]!==void 0&&(i[a]=this[a]);return i}}class xR{constructor(i,a){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new zc(Pt,16,0),this.featureIndexArray=new Nd,this.promoteId=a,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(i,a,u,m,h,g=0,b=0){const E=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,m,h,g);const R=this.grid;for(let v=0;v<a.length;v++){const S=a[v],C=[1/0,1/0,-1/0,-1/0];for(let T=0;T<S.length;T++){const I=S[T];C[0]=Math.min(C[0],I.x),C[1]=Math.min(C[1],I.y),C[2]=Math.max(C[2],I.x),C[3]=Math.max(C[3],I.y)}b!==0&&(C[0]-=b,C[1]-=b,C[2]+=b,C[3]+=b),C[0]<Pt&&C[1]<Pt&&C[2]>=0&&C[3]>=0&&R.insert(E,C[0],C[1],C[2],C[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Ep.VectorTile(new Sv(this.rawTileData)).layers,this.sourceLayerCoder=new vR(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const i in this.vtLayers)this.vtFeatures[i]=[]}return this.vtLayers}query(i,a){const{tilespaceGeometry:u,transform:m,tileTransform:h,pixelPosMatrix:g,availableImages:b}=a;this.loadVTLayers(),this.serializedLayersCache.clear();const E=u.bufferedTilespaceBounds,R=this.grid.query(E.min.x,E.min.y,E.max.x,E.max.y,(T,I,D,k)=>Re(u.bufferedTilespaceGeometry,T,I,D,k));R.sort(QB);let v=null;m.elevation&&R.length>0&&(v=Dp.create(m.elevation,this.tileID));const S={};let C;for(let T=0;T<R.length;T++){const I=R[T];if(I===C)continue;C=I;const D=this.featureIndexArray.get(I);let k=null;this.is3DTile?this.loadMatchingModelFeature(S,D,i,u,m):this.loadMatchingFeature(S,D,i,b,(F,q,H,U=0)=>(k||(k=O(F,this.tileID.canonical,h)),q.queryIntersectsFeature(u,F,H,k,this.z,m,g,v,U)))}return S}loadMatchingFeature(i,a,u,m,h){const{featureIndex:g,bucketIndex:b,sourceLayerIndex:E,layoutVertexArrayOffset:R}=a,v=this.bucketLayerIDs[b],S=u.layers,C=Object.keys(S);if(C.length&&!function(F,q){for(let H=0;H<F.length;H++)if(q.indexOf(F[H])>=0)return!0;return!1}(C,v))return;const T=u.sourceCache,I=this.sourceLayerCoder.decode(E),D=this.vtLayers[I].feature(g),k=this.getId(D,I);for(let F=0;F<v.length;F++){const q=v[F];if(!S[q])continue;const{styleLayer:H,targets:U}=S[q];let $={};k!==void 0&&($=T.getFeatureState(H.sourceLayer,k));const Y=!h||h(D,H,$,R);if(!Y)continue;const ie=new Fp(D,this.z,this.x,this.y,k);ie.tile=this.tileID.canonical,ie.state=$;let he=this.serializedLayersCache.get(q);he||(he=H.serialize(),he.id=q,this.serializedLayersCache.set(q,he)),ie.source=he.source,ie.sourceLayer=he["source-layer"],ie.layer=Sn({},he),ie.layer.paint=bR(he.paint,H.paint,D,$,m),ie.layer.layout=bR(he.layout,H.layout,D,$,m);let ue=!1;for(const ce of U){this.updateFeatureProperties(ie,ce);const{filter:Ie}=ce;if(Ie){if(D.properties=ie.properties,Ie.needGeometry){const de=B(D,!0);if(!Ie.filter(new vn(this.tileID.overscaledZ),de,this.tileID.canonical))continue}else if(!Ie.filter(new vn(this.tileID.overscaledZ),D))continue}ue=!0,ce.targetId&&this.addFeatureVariant(ie,ce)}ue&&this.appendToResult(i,q,g,ie,Y)}}loadMatchingModelFeature(i,a,u,m,h){const g=this.bucketLayerIDs[0][0],b=u.layers;if(!b[g])return;const{styleLayer:E,targets:R}=b[g];if(E.type!=="model")return;const v=m.tile,S=a.featureIndex,C=v.getBucket(E);if(!(C&&C instanceof $v))return;const T=function(he,ue,ce,Ie){const de=he.getNodesInfo()[ue];if(de.hiddenByReplacement||!de.node.meshes)return;let Me=Number.MAX_VALUE;const ze=de.node,Pe=ce.tile,Ne=Ie.calculatePosMatrix(Pe.tileID.toUnwrapped(),Ie.worldSize),qe=de.evaluatedScale;let Ze=0;Ie.elevation&&ze.elevation&&(Ze=ze.elevation*Ie.elevation.exaggeration()),ke.mat4.translate(Ne,Ne,[(ze.anchor?ze.anchor[0]:0)*(qe[0]-1),(ze.anchor?ze.anchor[1]:0)*(qe[1]-1),Ze]),ke.mat4.scale(Ne,Ne,qe);const Be=ce.queryGeometry,ct=Be.isPointQuery()?Be.screenBounds:Be.screenGeometry,yt=function(Lt){const Dt=ke.mat4.multiply([],Ne,Lt.matrix);ke.mat4.multiply(Dt,Ie.expandedFarZProjMatrix,Dt);for(let wt=0;wt<Lt.meshes.length;++wt){const vt=Lt.meshes[wt];if(wt===Lt.lightMeshIndex)continue;const Zt=vC(ct,Ie,Dt,vt.aabb);Zt!=null&&(Me=Math.min(Zt,Me))}if(Lt.children)for(const wt of Lt.children)yt(wt)};if(yt(ze),Me===Number.MAX_VALUE)return;const lt=new Gi(0,0);return DC(Pe.tileID.canonical,lt,de.node.anchor[0],de.node.anchor[1]),{intersectionZ:Me,position:lt,feature:de.feature}}(C,S,m,h);if(!T)return;const{z:I,x:D,y:k}=v.tileID.canonical,{feature:F,intersectionZ:q,position:H}=T;let U={};F.id!==void 0&&(U=u.sourceCache.getFeatureState(E.sourceLayer,F.id));const $=new Fp({},I,D,k,F.id);$.tile=this.tileID.canonical,$.state=U,$.properties=F.properties,$.geometry={type:"Point",coordinates:[H.lng,H.lat]};let Y=this.serializedLayersCache.get(g);Y||(Y=E.serialize(),Y.id=g,this.serializedLayersCache.set(g,Y)),$.source=Y.source,$.sourceLayer=Y["source-layer"],$.layer=Sn({},Y);let ie=!1;for(const he of R){this.updateFeatureProperties($,he);const{filter:ue}=he;if(ue){if(F.properties=$.properties,ue.needGeometry){if(!ue.filter(new vn(this.tileID.overscaledZ),F,this.tileID.canonical))continue}else if(!ue.filter(new vn(this.tileID.overscaledZ),F))continue}ie=!0,he.targetId&&this.addFeatureVariant($,he)}ie&&this.appendToResult(i,g,S,$,q)}updateFeatureProperties(i,a,u){if(a.properties){const m={};for(const h in a.properties){const g=a.properties[h].evaluate({zoom:this.z},i._vectorTileFeature,i.state,i.tile,u);g!=null&&(m[h]=g)}i.properties=m}}addFeatureVariant(i,a,u){const m={target:a.target,namespace:a.namespace,uniqueFeatureID:a.uniqueFeatureID};a.properties&&(m.properties=i.properties),i.variants=i.variants||{},i.variants[a.targetId]=i.variants[a.targetId]||[],i.variants[a.targetId].push(m)}appendToResult(i,a,u,m,h){let g=i[a];g===void 0&&(g=i[a]=[]),g.push({featureIndex:u,feature:m,intersectionZ:h})}lookupSymbolFeatures(i,a,u,m,h){const g={};this.loadVTLayers();for(const b of i)this.loadMatchingFeature(g,{bucketIndex:a,sourceLayerIndex:u,featureIndex:b,layoutVertexArrayOffset:0},m,h);return g}loadFeature(i){const{featureIndex:a,sourceLayerIndex:u}=i;this.loadVTLayers();const m=this.sourceLayerCoder.decode(u),h=this.vtFeatures[m];if(h[a])return h[a];const g=this.vtLayers[m].feature(a);return h[a]=g,g}hasLayer(i){for(const a of this.bucketLayerIDs)for(const u of a)if(i===u)return!0;return!1}getId(i,a){let u=i.id;if(this.promoteId){const m=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[a];if(m!=null)if(Array.isArray(m)){if(!this.promoteIdExpression){const h=Bu(m);if(h.result!=="success"){const g=h.value.map(b=>`${b.key}: ${b.message}`).join(", ");return void yi(`Failed to create expression for promoteId: ${g}`)}this.promoteIdExpression=h.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new Ec),u=this.promoteIdExpression.evaluate({zoom:0},i)}else u=i.properties[m];typeof u=="boolean"&&(u=Number(u))}return u}}function bR(c,i,a,u,m){return el(c,(h,g)=>{const b=i instanceof qu?i.get(g):null;return b&&b.evaluate?b.evaluate(a,u,m):b})}function QB(c,i){return i-c}Gt(xR,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const wR=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class ST{static from(i){if(!(i instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[a,u]=new Uint8Array(i,0,2);if(a!==219)throw new Error("Data does not appear to be in a KDBush format.");const m=u>>4;if(m!==1)throw new Error(`Got v${m} data when expected v1.`);const h=wR[15&u];if(!h)throw new Error("Unrecognized array type.");const[g]=new Uint16Array(i,2,1),[b]=new Uint32Array(i,4,1);return new ST(b,g,h,i)}constructor(i,a=64,u=Float64Array,m){if(isNaN(i)||i<0)throw new Error(`Unpexpected numItems value: ${i}.`);this.numItems=+i,this.nodeSize=Math.min(Math.max(+a,2),65535),this.ArrayType=u,this.IndexArrayType=i<65536?Uint16Array:Uint32Array;const h=wR.indexOf(this.ArrayType),g=2*i*this.ArrayType.BYTES_PER_ELEMENT,b=i*this.IndexArrayType.BYTES_PER_ELEMENT,E=(8-b%8)%8;if(h<0)throw new Error(`Unexpected typed array class: ${u}.`);m&&m instanceof ArrayBuffer?(this.data=m,this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+b+E,2*i),this._pos=2*i,this._finished=!0):(this.data=new ArrayBuffer(8+g+b+E),this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+b+E,2*i),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+h]),new Uint16Array(this.data,2,1)[0]=a,new Uint32Array(this.data,4,1)[0]=i)}add(i,a){const u=this._pos>>1;return this.ids[u]=u,this.coords[this._pos++]=i,this.coords[this._pos++]=a,u}finish(){const i=this._pos>>1;if(i!==this.numItems)throw new Error(`Added ${i} items when expected ${this.numItems}.`);return AT(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(i,a,u,m){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:g,nodeSize:b}=this,E=[0,h.length-1,0],R=[];for(;E.length;){const v=E.pop()||0,S=E.pop()||0,C=E.pop()||0;if(S-C<=b){for(let k=C;k<=S;k++){const F=g[2*k],q=g[2*k+1];F>=i&&F<=u&&q>=a&&q<=m&&R.push(h[k])}continue}const T=C+S>>1,I=g[2*T],D=g[2*T+1];I>=i&&I<=u&&D>=a&&D<=m&&R.push(h[T]),(v===0?i<=I:a<=D)&&(E.push(C),E.push(T-1),E.push(1-v)),(v===0?u>=I:m>=D)&&(E.push(T+1),E.push(S),E.push(1-v))}return R}within(i,a,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:h,nodeSize:g}=this,b=[0,m.length-1,0],E=[],R=u*u;for(;b.length;){const v=b.pop()||0,S=b.pop()||0,C=b.pop()||0;if(S-C<=g){for(let k=C;k<=S;k++)ER(h[2*k],h[2*k+1],i,a)<=R&&E.push(m[k]);continue}const T=C+S>>1,I=h[2*T],D=h[2*T+1];ER(I,D,i,a)<=R&&E.push(m[T]),(v===0?i-u<=I:a-u<=D)&&(b.push(C),b.push(T-1),b.push(1-v)),(v===0?i+u>=I:a+u>=D)&&(b.push(T+1),b.push(S),b.push(1-v))}return E}}function AT(c,i,a,u,m,h){if(m-u<=a)return;const g=u+m>>1;TR(c,i,g,u,m,h),AT(c,i,a,u,g-1,1-h),AT(c,i,a,g+1,m,1-h)}function TR(c,i,a,u,m,h){for(;m>u;){if(m-u>600){const R=m-u+1,v=a-u+1,S=Math.log(R),C=.5*Math.exp(2*S/3),T=.5*Math.sqrt(S*C*(R-C)/R)*(v-R/2<0?-1:1);TR(c,i,a,Math.max(u,Math.floor(a-v*C/R+T)),Math.min(m,Math.floor(a+(R-v)*C/R+T)),h)}const g=i[2*a+h];let b=u,E=m;for(N_(c,i,u,a),i[2*m+h]>g&&N_(c,i,u,m);b<E;){for(N_(c,i,b,E),b++,E--;i[2*b+h]<g;)b++;for(;i[2*E+h]>g;)E--}i[2*u+h]===g?N_(c,i,u,E):(E++,N_(c,i,E,m)),E<=a&&(u=E+1),a<=E&&(m=E-1)}}function N_(c,i,a,u){IT(c,a,u),IT(i,2*a,2*u),IT(i,2*a+1,2*u+1)}function IT(c,i,a){const u=c[i];c[i]=c[a],c[a]=u}function ER(c,i,a,u){const m=c-a,h=i-u;return m*m+h*h}s.$=Ng,s.A=Fn,s.B=2,s.C=y_,s.D=Pp,s.E=Xa,s.F=kM,s.G=class extends Gv{},s.H=cs,s.I=gT,s.J=wc,s.K=Z0,s.L=bd,s.M=xd,s.N=Jf,s.O=Fu,s.P=St,s.Q=lp,s.R=Ui,s.S=G0,s.T=iT,s.U=Bu,s.V=Gv,s.W=pd,s.X=Dc,s.Y=Du,s.Z=Xr,s._=Js,s.a=function(c){return Kn.API_CDN_URL_REGEX.test(c)},s.a$=Fp,s.a0=Eg,s.a1=U0,s.a2=function(c){const i=c.value;let a=[];if(!i)return a;const u=cs(i);return u!=="string"?(a=a.concat([new Gv(c.key,i,`string expected, "${u}" found`)]),a):(bC(i,!0)||(a=a.concat([new Gv(c.key,i,`invalid url "${i}"`)])),a)},s.a3=Qe,s.a4=op,s.a5=zn,s.a6=Et,s.a7=class{constructor(c){this.specification=c}possiblyEvaluate(c,i){return os(c.expression.evaluate(i))}interpolate(c,i,a){return{x:ei(c.x,i.x,a),y:ei(c.y,i.y,a),z:ei(c.z,i.z,a),azimuthal:ei(c.azimuthal,i.azimuthal,a),polar:ei(c.polar,i.polar,a)}}},s.a8=vn,s.a9=wd,s.aA=io,s.aB=class{constructor(c){this.entries={},this.scheduler=c}request(c,i,a,u){const m=this.entries[c]=this.entries[c]||{callbacks:[]};if(m.result){const[h,g]=m.result;return this.scheduler?this.scheduler.add(()=>{u(h,g)},i):u(h,g),()=>{}}return m.callbacks.push(u),m.cancel||(m.cancel=a((h,g)=>{m.result=[h,g];for(const b of m.callbacks)this.scheduler?this.scheduler.add(()=>{b(h,g)},i):b(h,g);setTimeout(()=>delete this.entries[c],3e3)})),()=>{m.result||(m.callbacks=m.callbacks.filter(h=>h!==u),m.callbacks.length||(m.cancel(),delete this.entries[c]))}}},s.aC=Eo,s.aD=function(c,i,a){const u=JSON.stringify(c.request);return c.data&&(this.deduped.entries[u]={result:[null,c.data]}),this.deduped.request(u,{type:"parseTile",isSymbolTile:c.isSymbolTile,zoom:c.tileZoom},m=>{const h=Qn(c.request,(g,b,E,R)=>{g?m(g):b&&m(null,{vectorTile:a?void 0:new Ep.VectorTile(new Sv(b)),rawData:b,cacheControl:E,expires:R})});return()=>{h.cancel(),m()}},i)},s.aE=function(c){Jt++,Jt>et&&(c.getActor().send("enforceCacheSizeLimit",Oe),Jt=0)},s.aF=function(c){return c<=1?1:Math.pow(2,Math.floor(Math.log(c)/Math.LN2))},s.aG=bt,s.aH=lC,s.aI=pC,s.aJ=oC,s.aK=function(c,i){const a=document.createElement("video");a.muted=!0,a.onloadstart=function(){i(null,a)};for(let u=0;u<c.length;u++){const m=document.createElement("source");Ur(c[u])||(a.crossOrigin="Anonymous"),m.src=c[u],a.appendChild(m)}return{cancel:()=>{}}},s.aL=Bv,s.aM=function(c){return fetch(c).then(i=>i.arrayBuffer()).then(i=>gR(i,0,c))},s.aN=yR,s.aO=class{constructor(c,i,a,u){this.id=c,this.position=i!=null?new Gi(i[0],i[1]):new Gi(0,0),this.orientation=a??[0,0,0],this.nodes=u,this.uploaded=!1,this.aabb=new Xt([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(c,i){if(ke.mat4.multiply(c.matrix,i,c.matrix),c.meshes)for(const a of c.meshes){const u=Xt.applyTransformFast(a.aabb,c.matrix);this.aabb.encapsulate(u)}if(c.children)for(const a of c.children)this._applyTransformations(a,c.matrix)}computeBoundsAndApplyParent(){const c=ke.mat4.identity([]);for(const i of this.nodes)this._applyTransformations(i,c)}computeModelMatrix(c,i,a,u,m,h,g=!1){AC(this.matrix,this,c.transform,this.position,i,a,u,m,h,g)}upload(c){if(!this.uploaded){for(const i of this.nodes)oT(i,c);for(const i of this.nodes)Hv(i);this.uploaded=!0}}destroy(){for(const c of this.nodes)lT(c)}},s.aP=Rl,s.aQ=b_,s.aR=ra,s.aS=Hr,s.aT=ul,s.aU=Gr,s.aV=_o,s.aW=Kg,s.aX=Nv,s.aY=function(){xa.isLoading()||xa.isLoaded()||sp()!=="deferred"||Ad()},s.aZ=W0,s.a_=B,s.aa=o,s.ab=ke,s.ac=Ws,s.ad=qu,s.ae=Fs,s.af=ei,s.ag=Pt,s.ah=cd,s.ai=Li,s.aj=$i,s.ak=class{constructor(c){this.specification=c}possiblyEvaluate(c,i){return function([a,u]){const m=os([1,a,u]);return{x:m.x,y:m.y,z:m.z}}(c.expression.evaluate(i))}interpolate(c,i,a){return{x:ei(c.x,i.x,a),y:ei(c.y,i.y,a),z:ei(c.z,i.z,a)}}},s.al=function(c,i,a=0,u=!0){const m=new St(a,a),h=c.sub(m),g=i.add(m),b=[h,new St(g.x,h.y),g,new St(h.x,g.y)];return u&&b.push(h.clone()),b},s.am=function(c,i){const a=[];for(let u=0;u<c.length;u++){const m=Ps(u-1,-1,c.length-1),h=Ps(u+1,-1,c.length-1),g=c[u],b=c[h],E=c[m].sub(g).unit(),R=b.sub(g).unit(),v=R.angleWithSep(E.x,E.y),S=E.add(R).unit().mult(-1*i/Math.sin(v/2));a.push(g.add(S))}return a},s.an=ZM,s.ao=Re,s.ap=function(c,i,a=0){return ke.vec3.fromValues(((i.x-a)*c.scale-c.x)*Pt,(i.y*c.scale-c.y)*Pt,fv(i.z,i.y))},s.aq=fi,s.ar=hM,s.as=function(c){let i=1/0,a=1/0,u=-1/0,m=-1/0;for(const h of c)i=Math.min(i,h.x),a=Math.min(a,h.y),u=Math.max(u,h.x),m=Math.max(m,h.y);return{min:new St(i,a),max:new St(u,m)}},s.at=Mo,s.au=ge,s.av=_,s.aw=bi,s.ax=ws,s.ay=function(c,i){const a={};for(let u=0;u<i.length;u++){const m=i[u];m in c&&(a[m]=c[m])}return a},s.az=Kl,s.b=function(c){return Kn.API_FONTS_REGEX.test(c)},s.b$=jv,s.b0=yo,s.b1=Ow,s.b2=Sw,s.b3=O,s.b4=cl,s.b5=Xg,s.b6=ri,s.b7=$n,s.b8=a_,s.b9=Jw,s.bA=qI,s.bB=Zw,s.bC=qM,s.bD=Gw,s.bE=ST,s.bF=Ps,s.bG=Ks,s.bH=Ts,s.bI=function(c,i,a){c[4*i+0]=a[0],c[4*i+1]=a[1],c[4*i+2]=a[2],c[4*i+3]=a[3]},s.bJ=qd,s.bK=ka,s.bL=Wu,s.bM=Jn,s.bN=Ud,s.bO=Gi,s.bP=QM,s.bQ=dt,s.bR=ji,s.bS=gC,s.bT=_t,s.bU=hs,s.bV=function(c,i,a,u,m,h,g,b,E){if(E.name==="globe")return hs(c,i,new _t(a,u,m),!1);const R=b_({z:a,x:u,y:m},E);return new Xt([(h+R.x/R.scale)*i,i*(R.y/R.scale),g],[(h+R.x2/R.scale)*i,i*(R.y2/R.scale),b])},s.bW=function(c,i,a){let u=0;for(let m=0;m<2;++m)c[m]>0&&(u+=(c[m]-0)*(c[m]-0)),i[m]<0&&(u+=(0-i[m])*(0-i[m]));return u},s.bX=Zn,s.bY=hv,s.bZ=function(c){const i=ke.mat4.identity(new Float64Array(16));ke.mat4.multiply(i,c.pixelMatrix,c.globeMatrix);const a=[0,ba,0],u=[0,wa,0];return ke.vec3.transformMat4(a,a,i),ke.vec3.transformMat4(u,u,i),[a[0]>0&&a[0]<=c.width&&a[1]>0&&a[1]<=c.height&&!Fa(c,new Gi(c.center.lat,90)),u[0]>0&&u[0]<=c.width&&u[1]>0&&u[1]<=c.height&&!Fa(c,new Gi(c.center.lat,-90))]},s.b_=function(c,i){const{scale:a}=c.tileTransform,u=a*Pt/(c.tileSize*Math.pow(2,i.zoom-c.tileID.overscaledZ+c.tileID.canonical.z));return ke.mat2.scale(new Float32Array(4),i.inverseAdjustmentMatrix,[u,u])},s.ba=function(c,i){const a=Fs(i.zoom);if(a===0)return dr(c);const u=kn(c),m=hn(u),h=Mo(u.getWest())*i.worldSize,g=Mo(u.getEast())*i.worldSize,b=io(u.getNorth())*i.worldSize,E=io(u.getSouth())*i.worldSize,R=[h,b,0],v=[g,b,0],S=[h,E,0],C=[g,E,0],T=ke.mat4.invert([],i.globeMatrix);return ke.vec3.transformMat4(R,R,T),ke.vec3.transformMat4(v,v,T),ke.vec3.transformMat4(S,S,T),ke.vec3.transformMat4(C,C,T),m[0]=fr(m[0],S,a),m[1]=fr(m[1],C,a),m[2]=fr(m[2],v,a),m[3]=fr(m[3],R,a),Xt.fromPoints(m)},s.bb=Cr,s.bc=ln,s.bd=fr,s.be=$u,s.bf=ti,s.bg=xT,s.bh=Sv,s.bi=Qn,s.bj=function(c){const i=[];for(const a in c)i.push(c[a]);return i},s.bk=function(c,i){const a=[];for(const u in c)u in i||a.push(u);return a},s.bl=Yn,s.bm=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.bn=cr,s.bo=function(c,i){const{x:a,y:u}=c.point,m=sa(a,u,c.worldSize/c._pixelsPerMercatorPixel,0,0);return ke.mat4.multiply(m,m,un(dr(i)))},s.bp=Sp,s.bq=no,s.br=Ev,s.bs=function(c,i,a,u,m){const h=5*i+2;c.float32[h+0]=a,c.float32[h+1]=u,c.float32[h+2]=m},s.bt=kv,s.bu=OM,s.bv=W,s.bw=fs,s.bx=NI,s.by=xC,s.bz=jI,s.c=vc,s.c$=(c,i,a,u,m,h,g,b)=>{const E=c.transform,R=E.pitch<15?dM(.07,.7,bi((14-E.zoom)/5,0,1)):.07,v=a.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:pM(c,i,a,u),u_texsize:i.imageAtlasTexture?i.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:E.calculatePixelsToTileUnitsMatrix(i),u_device_pixel_ratio:m,u_width_scale:h,u_floor_width_scale:g,u_image:0,u_tile_units_to_pixels:fM(i,E),u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:b,u_trim_fade_range:a.paint.get("line-trim-fade-range"),u_trim_color:a.paint.get("line-trim-color").toRenderColor(v?null:a.lut).toArray01(),u_emissive_strength:a.paint.get("line-emissive-strength"),u_zbias_factor:R,u_tile_to_meter:r(i.tileID.canonical,0)}},s.c0=mC,s.c1=function(c){const i=mC(c,!0);return ke.mat2.invert([],[i[0],i[1],i[4],i[5]])},s.c2=ki,s.c3=function(c){const{x:i,y:a}=c.point,{lng:u,lat:m}=c._center;return sa(i,a,c.worldSize,u,m)},s.c4=vr,s.c5=It,s.c6=Xu,s.c7=function(c){const i=Math.round((c+45+360)%360/90)%4;return Ds[i]},s.c8=45,s.c9=bp,s.cA=class extends Io{constructor(c){super(c),this.current=Jg}set(c,i,a){if(this.fetchUniformLocation(c,i)){for(let u=0;u<9;u++)if(a[u]!==this.current[u]){this.current=a,this.gl.uniformMatrix3fv(this.location,!1,a);break}}}},s.cB=Da,s.cC=function(c,i,a){const u=Fs(a.zoom),m=c.style.map._antialias,h=c.terrain&&c.terrain.exaggeration()>0;return u===0&&!m&&!h},s.cD=function(c){const i=c.pixelsPerMeter,a=i/Ts(1,c.center.lat),u=ke.mat4.identity(new Float64Array(16));return ke.mat4.translate(u,u,[c.point.x,c.point.y,0]),ke.mat4.scale(u,u,[a,a,i]),Float32Array.from(u)},s.cE=kn,s.cF=function(c){const i=Zn-5;c=bi(c,-i,i)/i*90;const a=Math.pow(Math.abs(Math.sin(Li(c))),3);return Math.round(a*(xp.length-1))},s.cG=function(c,i,a,u){const m=i.getNorth(),h=i.getSouth(),g=i.getWest(),b=i.getEast(),E=1<<c.z,R=b-g,v=m-h,S=R/Yu,C=-v/xp[a],T=[0,S,0,C,0,0,m,g,0];if(c.z>0){const I=180/u;ke.mat3.multiply(T,T,[I/R+1,0,0,0,I/v+1,0,-.5*I/S,.5*I/C,1])}return T[2]=E,T[5]=c.x,T[8]=c.y,T},s.cH=dr,s.cI=function(c,i,a){const u=ke.mat4.identity(new Float64Array(16)),m=(i/(1<<c)-.5)*Math.PI*2;return ke.mat4.rotateY(u,a.globeMatrix,m),Float32Array.from(u)},s.cJ=class{isDataAvailableAtPoint(c){const i=this._source();if(this.isUsingMockSource()||!i||c.y<0||c.y>1)return!1;const a=i.getSource().maxzoom,u=1<<a,m=Math.floor(c.x),h=Math.floor((c.x-m)*u),g=Math.floor(c.y*u),b=this.findDEMTileFor(new bt(a,m,a,h,g));return!(!b||!b.dem)}getAtPointOrZero(c,i=0){return this.getAtPoint(c,i)||0}getAtPoint(c,i,a=!0){if(this.isUsingMockSource())return null;i==null&&(i=null);const u=this._source();if(!u||c.y<0||c.y>1)return i;const m=u.getSource().maxzoom,h=1<<m,g=Math.floor(c.x),b=c.x-g,E=new bt(m,g,m,Math.floor(b*h),Math.floor(c.y*h)),R=this.findDEMTileFor(E);if(!R||!R.dem)return i;const v=R.dem,S=1<<R.tileID.canonical.z,C=(b*S-R.tileID.canonical.x)*v.dim,T=(c.y*S-R.tileID.canonical.y)*v.dim,I=Math.floor(C),D=Math.floor(T);return(a?this.exaggeration():1)*ei(ei(v.get(I,D),v.get(I,D+1),T-D),ei(v.get(I+1,D),v.get(I+1,D+1),T-D),C-I)}getAtTileOffset(c,i,a){const u=1<<c.canonical.z;return this.getAtPointOrZero(new o(c.wrap+(c.canonical.x+i/Pt)/u,(c.canonical.y+a/Pt)/u))}getAtTileOffsetFunc(c,i,a,u){return m=>{const h=this.getAtTileOffset(c,m.x,m.y),g=u.upVector(c.canonical,m.x,m.y),b=u.upVectorScale(c.canonical,i,a).metersToTile;return ke.vec3.scale(g,g,h*b),g}}getForTilePoints(c,i,a,u){if(this.isUsingMockSource())return!1;const m=Dp.create(this,c,u);return!!m&&(i.forEach(h=>{h[2]=this.exaggeration()*m.getElevationAt(h[0],h[1],a)}),!0)}getMinMaxForTile(c){if(this.isUsingMockSource())return null;const i=this.findDEMTileFor(c);if(!i||!i.dem)return null;const a=i.dem.tree,u=i.tileID,m=1<<c.canonical.z-u.canonical.z;let h=c.canonical.x/m-u.canonical.x,g=c.canonical.y/m-u.canonical.y,b=0;for(let E=0;E<c.canonical.z-u.canonical.z&&!a.leaves[b];E++){h*=2,g*=2;const R=2*Math.floor(g)+Math.floor(h);b=a.childOffsets[b]+R,h%=1,g%=1}return{min:this.exaggeration()*a.minimums[b],max:this.exaggeration()*a.maximums[b]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(c,i,a){throw new Error("Pure virtual method called.")}pointCoordinate(c){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(c){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const c=this.visibleDemTiles;if(c.length===0)return null;let i=!1,a=Number.MAX_VALUE,u=Number.MIN_VALUE;for(const m of c){const h=this.getMinMaxForTile(m.tileID);h&&(a=Math.min(a,h.min),u=Math.max(u,h.max),i=!0)}return i?{min:a,max:u}:null}},s.cK=gI,s.cL=Di,s.cM=function(c,i){return[Math.pow(c[0],2.2)*i,Math.pow(c[1],2.2)*i,Math.pow(c[2],2.2)*i]},s.cN=Na,s.cO=xo,s.cP=yc,s.cQ=256,s.cR=function(c,i){const a=[0,0,0],u=Cr(dr(i.canonical));return ke.vec3.transformMat4(a,a,u),ke.vec3.transformMat4(a,a,c),a},s.cS=c=>({u_camera_to_center_distance:new Jn(c),u_extrude_scale:new e_(c),u_device_pixel_ratio:new Jn(c),u_matrix:new qd(c),u_inv_rot_matrix:new qd(c),u_merc_center:new ka(c),u_tile_id:new Wu(c),u_zoom_transition:new Jn(c),u_up_dir:new Wu(c),u_emissive_strength:new Jn(c)}),s.cT=c=>({u_matrix:new qd(c),u_pixels_to_tile_units:new e_(c),u_device_pixel_ratio:new Jn(c),u_width_scale:new Jn(c),u_floor_width_scale:new Jn(c),u_units_to_pixels:new ka(c),u_dash_image:new Ud(c),u_gradient_image:new Ud(c),u_image_height:new Jn(c),u_texsize:new ka(c),u_tile_units_to_pixels:new Jn(c),u_alpha_discard_threshold:new Jn(c),u_trim_offset:new ka(c),u_trim_fade_range:new ka(c),u_trim_color:new jd(c),u_emissive_strength:new Jn(c),u_zbias_factor:new Jn(c),u_tile_to_meter:new Jn(c)}),s.cU=c=>({u_matrix:new qd(c),u_texsize:new ka(c),u_pixels_to_tile_units:new e_(c),u_device_pixel_ratio:new Jn(c),u_width_scale:new Jn(c),u_floor_width_scale:new Jn(c),u_image:new Ud(c),u_units_to_pixels:new ka(c),u_tile_units_to_pixels:new Jn(c),u_alpha_discard_threshold:new Jn(c),u_trim_offset:new ka(c),u_trim_fade_range:new ka(c),u_trim_color:new jd(c),u_emissive_strength:new Jn(c),u_zbias_factor:new Jn(c),u_tile_to_meter:new Jn(c)}),s.cV=Gg,s.cW=i5,s.cX=n5,s.cY=Ju,s.cZ=(c,i,a,u,m,h)=>{const g=c.transform,b=g.projection.name==="globe";let E;if(h.paint.get("circle-pitch-alignment")==="map")if(b){const v=Na(g.zoom,i.canonical)*g._pixelsPerMercatorPixel;E=Float32Array.from([v,0,0,v])}else E=g.calculatePixelsToTileUnitsMatrix(a);else E=new Float32Array([g.pixelsToGLUnits[0],0,0,g.pixelsToGLUnits[1]]);const R={u_camera_to_center_distance:c.transform.getCameraToCenterDistance(g.projection),u_matrix:c.translatePosMatrix(i.projMatrix,a,h.paint.get("circle-translate"),h.paint.get("circle-translate-anchor")),u_device_pixel_ratio:ye.devicePixelRatio,u_extrude_scale:E,u_inv_rot_matrix:Gc,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:h.paint.get("circle-emissive-strength")};if(b){R.u_inv_rot_matrix=u,R.u_merc_center=m,R.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],R.u_zoom_transition=Fs(g.zoom);const v=m[0]*Pt,S=m[1]*Pt;R.u_up_dir=g.projection.upVector(new _t(0,0,0),v,S)}return R},s.c_=mM,s.ca=jd,s.cb=function(c,i,a){const u=Math.sqrt(c*c+i*i+a*a),m=u>0?Math.acos(a/u)*Ko:0;let h=c!==0||i!==0?Math.atan2(-i,-c)*Ko+90:0;return h<0&&(h+=360),[u,h,m]},s.cc=r,s.cd=Xt,s.ce=os,s.cf=function(c){return[Math.pow(c[0],1/2.2),Math.pow(c[1],1/2.2),Math.pow(c[2],1/2.2)]},s.cg=function(c,i){return c.readFields(W5,{icons:[]},i)},s.ch=function(c){return c({pluginStatus:ia,pluginURL:Hl}),Vu.on("pluginStateChange",c),c},s.ci=Zv,s.cj=Ip,s.ck=Hw,s.cl=ma,s.cm=zg,s.cn=Le,s.co=an,s.cp=as,s.cq=function(c){const i=c.indexOf(up);return i>=0?c.slice(0,i):c},s.cr=function(c){return c.indexOf(up)>=0},s.cs=function(c){const i=c.indexOf(up);return i>=0?c.slice(i+1):""},s.ct=function(c){const i=[],a=c.id;return a===void 0&&i.push({message:`layers.${a}: missing required property "id"`}),c.render===void 0&&i.push({message:`layers.${a}: missing required method "render"`}),c.renderingMode&&c.renderingMode!=="2d"&&c.renderingMode!=="3d"&&i.push({message:`layers.${a}: property "renderingMode" must be either "2d" or "3d"`}),i},s.cu=function(c,i,a,u){return c.type==="custom"?new z5(c,i):new H5[c.type](c,i,a,u)},s.cv=tl,s.cw=class extends Fp{constructor(c,i){super(c._vectorTileFeature,c._z,c._x,c._y,c.id),c.state&&(this.state=Object.assign({},c.state)),this.target=i.target,this.namespace=i.namespace,i.properties&&(this.properties=i.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=c.source,this.sourceLayer=c.sourceLayer,this.layer=c.layer)}toJSON(){const c=super.toJSON();return c.target=this.target,c.namespace=this.namespace,c}},s.cx=Vu,s.cy=qn,s.cz=lv,s.d=function(c){return Kn.API_TILEJSON_REGEX.test(c)},s.d$=xR,s.d0=(c,i,a,u,m,h,g,b,E)=>{const R=c.transform,v=R.calculatePixelsToTileUnitsMatrix(i),S=a.paint.get("line-trim-color-use-theme").constantOr("default")==="none",C=R.pitch<15?dM(.07,.7,bi((14-R.zoom)/5,0,1)):.07;return{u_matrix:pM(c,i,a,u),u_pixels_to_tile_units:v,u_device_pixel_ratio:h,u_width_scale:g,u_floor_width_scale:b,u_units_to_pixels:[1/R.pixelsToGLUnits[0],1/R.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:m,u_texsize:gM(a)&&i.lineAtlasTexture?i.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:fM(i,c.transform),u_alpha_discard_threshold:0,u_trim_offset:E,u_trim_fade_range:a.paint.get("line-trim-fade-range"),u_trim_color:a.paint.get("line-trim-color").toRenderColor(S?null:a.lut).toArray01(),u_emissive_strength:a.paint.get("line-emissive-strength"),u_zbias_factor:C,u_tile_to_meter:r(i.tileID.canonical,0)}},s.d1=Jo,s.d2=s_,s.d3=iM,s.d4=Ot,s.d5=Tv,s.d6=th,s.d7=450,s.d8=7,s.d9=L5,s.dA=Qo,s.dB=f,s.dC=Uc,s.dD=function([c,i,a]){const u=Math.hypot(c,i,a),m=Math.atan2(c,a),h=.5*Math.PI-Math.acos(-i/u);return new Gi(vr(m),vr(h))},s.dE=rT,s.dF=function(c){const i=c.navigator?c.navigator.userAgent:null;return!!function(a){if(vo==null){const u=a.navigator?a.navigator.userAgent:null;vo=!!a.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return vo}(c)&&i&&(i.match("Version/15.4")||i.match("Version/15.5")||i.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},s.dG=function(c,i){Oe=c,et=i},s.dH=Fa,s.dI=Co,s.dJ=function(c){const i=[0,0,0],a=ke.mat4.identity(new Float64Array(16));return ke.mat4.multiply(a,c.pixelMatrix,c.globeMatrix),ke.vec3.transformMat4(i,i,a),new St(i[0],i[1])},s.dK=function(c,i,a=!1){if(ia===Sd||ia===rp||ia===Lg)throw new Error("setRTLTextPlugin cannot be called multiple times.");Hl=ye.resolveURL(c),ia=Sd,To=i,Og(),a||Ad()},s.dL=sp,s.dM=function(){Zv().acquire(uT)},s.dN=function(){const c=C_;c&&(c.isPreloaded()&&c.numActive()===1?(c.release(uT),C_=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},s.dO=Wd,s.dP=function(c){const i=At();if(!i)return;const a=i.delete(Ge);c&&a.catch(c).then(()=>c())},s.dQ=M_,s.dR=cR,s.dS=function(c){bT=ye.resolveURL(c),Np||(Np=new Pp(Zv(),new Xa)),Np.broadcast("setDracoUrl",bT)},s.dT=uR,s.dU=function(c){kp=ye.resolveURL(c),Np||(Np=new Pp(Zv(),new Xa)),Np.broadcast("setMeshoptUrl",kp)},s.dV=Gt,s.dW=eh,s.dX=fl,s.dY=Ep,s.dZ=class{constructor(c,i){this.pos=c,this.dir=i}intersectsPlane(c,i,a){const u=ke.vec2.dot(i,this.dir);if(Math.abs(u)<1e-6)return!1;const m=((c[0]-this.pos[0])*i[0]+(c[1]-this.pos[1])*i[1])/u;return a[0]=this.pos[0]+this.dir[0]*m,a[1]=this.pos[1]+this.dir[1]*m,!0}},s.d_=vR,s.da=Xi,s.db=Yg,s.dc=256,s.dd=un,s.de=So,s.df=Wl,s.dg=pp,s.dh=function(c,i,a,u,m){return bi((c-i)/(a-i)*(m-u)+u,u,m)},s.di=Kf,s.dj=Qu,s.dk=class{constructor(c,i,a,u){this.context=c,this.format=u,this.size=a,this.texture=c.gl.createTexture();const[m,h,g]=this.size,{gl:b}=c;b.bindTexture(b.TEXTURE_3D,this.texture),c.pixelStoreUnpackFlipY.set(!1),c.pixelStoreUnpack.set(1),c.pixelStoreUnpackPremultiplyAlpha.set(!1),b.texImage3D(b.TEXTURE_3D,0,this.format,m,h,g,0,eT(this.format),tT(this.format),i.data)}bind(c,i){const{context:a}=this,{gl:u}=a;u.bindTexture(u.TEXTURE_3D,this.texture),c!==this.minFilter&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MAG_FILTER,c),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MIN_FILTER,c),this.minFilter=c),i!==this.wrapS&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_S,i),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_T,i),this.wrapS=i)}destroy(){const{gl:c}=this.context;c.deleteTexture(this.texture),this.texture=null}},s.dl=sT,s.dm=[1,1,1],s.dn=Dp,s.dp=Rp,s.dq=Zl,s.dr=Zu,s.ds=jc,s.dt=mp,s.du=Ao,s.dv=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new St(1/0,1/0),max:new St(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(c,i=!1){const a=BI(new St(0,0),new St(Pt,Pt),c),u=[];if(i&&!Rw(a,this._globalClipBounds))return u;for(const m of this._activeRegions){if(m.hiddenByOverlap||!Rw(a,m))continue;const h=CF(m.min,m.max,c);u.push({min:h.min,max:h.max,sourceId:this._sourceIds[m.priority],footprint:m.footprint,footprintTileId:m.tileId,order:m.order,clipMask:m.clipMask,clipScope:m.clipScope})}return u}setSources(c){this._setSources(c.map(i=>({getSourceId:()=>i.cache.id,getFootprints:()=>{const a=[];for(const u of i.cache.getVisibleCoordinates()){const m=i.cache.getTile(u).buckets[i.layer];m&&m.updateFootprints(u.toUnwrapped(),a)}return a},getOrder:()=>i.order,getClipMask:()=>i.clipMask,getClipScope:()=>i.clipScope})))}_addSource(c){const i=c.getFootprints();if(i.length===0)return;const a=c.getOrder(),u=c.getClipMask(),m=c.getClipScope();for(const h of i){if(!h.footprint)continue;const g=BI(h.footprint.min,h.footprint.max,h.id);this._activeRegions.push({min:g.min,max:g.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:h.id,footprint:h.footprint,order:a,clipMask:u,clipScope:m})}this._sourceIds.push(c.getSourceId())}_computeReplacement(){this._activeRegions.sort((i,a)=>i.priority-a.priority||bv(i.min,a.min)||bv(i.max,a.max)||i.order-a.order||i.clipMask-a.clipMask||function(u,m){const h=(g,b)=>g+b;return u.length-m.length||u.reduce(h,"").localeCompare(m.reduce(h,""))}(i.clipScope,a.clipScope));let c=this._activeRegions.length!==this._prevRegions.length;if(!c){let i=0;for(;!c&&i!==this._activeRegions.length;){const a=this._activeRegions[i],u=this._prevRegions[i];c=a.priority!==u.priority||!FI(a,u)||a.order!==u.order||a.clipMask!==u.clipMask||!cr(a.clipScope,u.clipScope),++i}}if(c){++this._updateTime;for(const a of this._activeRegions)a.order!==xv&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,a.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,a.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,a.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,a.max.y));const i=a=>{const u=this._activeRegions;if(a>=u.length)return a;const m=u[a].priority;for(;a<u.length&&u[a].priority===m;)++a;return a};if(this._sourceIds.length>1){let a=0,u=i(a);for(;a!==u;){let m=a;const h=a;for(;m!==u;){const g=this._activeRegions[m];g.hiddenByOverlap=!1;for(let b=0;b<h;b++){const E=this._activeRegions[b];if(!E.hiddenByOverlap&&g.order===xv&&Rw(g,E)&&(g.hiddenByOverlap=UI(g.footprint,g.tileId,E.footprint,E.tileId),g.hiddenByOverlap))break}++m}a=u,u=i(a)}}}}_setSources(c){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let i=c.length-1;i>=0;i--)this._addSource(c[i]);this._computeReplacement()}},s.dw=class{constructor(c){this._createGrid(c),this._createPoles(c)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const c of this._poleSegments)c.destroy();for(const c of this._gridSegments)c.withSkirts.destroy(),c.withoutSkirts.destroy()}_fillGridMeshWithLods(c,i){const a=new cl,u=new Gr,m=[],h=c+1+2,g=i[0]+1,b=i[0]+1+(1+i.length),E=(R,v,S)=>{let C=R===h-1?R-2:R===0?R:R-1;return C+=S?24575:0,[C,v]};for(let R=0;R<h;++R)a.emplaceBack(...E(R,0,!0));for(let R=0;R<g;++R)for(let v=0;v<h;++v)a.emplaceBack(...E(v,R,(v===0||v===h-1)&&!0));for(let R=0;R<i.length;++R){const v=i[R];for(let S=0;S<h;++S)a.emplaceBack(...E(S,v,!0))}for(let R=0;R<i.length;++R){const v=u.length,S=i[R]+1+2,C=new Gr;for(let D=0;D<S-1;D++){const k=D===S-2,F=k?h*(b-i.length+R-D):h;for(let q=0;q<h-1;q++){const H=D*h+q;D===0||k||q===0||q===h-2?(C.emplaceBack(H+1,H,H+F),C.emplaceBack(H+F,H+F+1,H+1)):(u.emplaceBack(H+1,H,H+F),u.emplaceBack(H+F,H+F+1,H+1))}}const T=$n.simpleSegment(0,v,a.length,u.length-v);for(let D=0;D<C.uint16.length;D+=3)u.emplaceBack(C.uint16[D],C.uint16[D+1],C.uint16[D+2]);const I=$n.simpleSegment(0,v,a.length,u.length-v);m.push({withoutSkirts:T,withSkirts:I})}return{vertices:a,indices:u,segments:m}}_createGrid(c){const i=this._fillGridMeshWithLods(Yu,xp);this._gridSegments=i.segments,this._gridBuffer=c.createVertexBuffer(i.vertices,ri.members),this._gridIndexBuffer=c.createIndexBuffer(i.indices,!0)}_createPoles(c){const i=new Gr;for(let g=0;g<=Yu;g++)i.emplaceBack(0,g+1,g+2);this._poleIndexBuffer=c.createIndexBuffer(i,!0);const a=new Wl,u=new Wl,m=new Wl,h=new Wl;this._poleSegments=[];for(let g=0,b=0;g<Xu;g++){const E=360/(1<<g);a.emplaceBack(0,-ws,0,.5,0),u.emplaceBack(0,-ws,0,.5,1),m.emplaceBack(0,-ws,0,.5,.5),h.emplaceBack(0,-ws,0,.5,.5);for(let R=0;R<=Yu;R++){let v=R/Yu,S=0;const C=ei(0,E,v),[T,I,D]=Ku(qc,Ro,C,ws);a.emplaceBack(T,I,D,v,S),u.emplaceBack(T,I,D,v,1-S);const k=Li(C);v=.5+.5*Math.sin(k),S=.5+.5*Math.cos(k),m.emplaceBack(T,I,D,v,S),h.emplaceBack(T,I,D,v,1-S)}this._poleSegments.push($n.simpleSegment(b,0,66,64)),b+=66}this._poleNorthVertexBuffer=c.createVertexBuffer(a,ui,!1),this._poleSouthVertexBuffer=c.createVertexBuffer(u,ui,!1),this._texturedPoleNorthVertexBuffer=c.createVertexBuffer(m,ui,!1),this._texturedPoleSouthVertexBuffer=c.createVertexBuffer(h,ui,!1)}getGridBuffers(c,i){return[this._gridBuffer,this._gridIndexBuffer,i?this._gridSegments[c].withSkirts:this._gridSegments[c].withoutSkirts]}getPoleBuffers(c,i){return[i?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,i?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[c]]}},s.dx=xv,s.dy=go,s.dz=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},s.e=Kn,s.e0=lM,s.e1=el,s.e2=_a,s.e3=NM,s.e4=function(c,i,a,u,m,h,g,b,E,R,v=1,S,C){c.createArrays(),c.tilePixelRatio=Pt/(512*c.overscaling),c.compareText={},c.iconsNeedLinear=!1;const T=c.layers[0].layout,I=c.layers[0]._unevaluatedLayout._values,D={};D.scaleFactor=v,D.textSizeScaleRange=T.get("text-size-scale-range"),D.iconSizeScaleRange=T.get("icon-size-scale-range");const[k,F]=D.textSizeScaleRange,[q,H]=D.iconSizeScaleRange;if(D.textScaleFactor=bi(D.scaleFactor,k,F),D.iconScaleFactor=bi(D.scaleFactor,q,H),c.textSizeData.kind==="composite"){const{minZoom:ie,maxZoom:he}=c.textSizeData;D.compositeTextSizes=[I["text-size"].possiblyEvaluate(new vn(ie),b),I["text-size"].possiblyEvaluate(new vn(he),b)]}if(c.iconSizeData.kind==="composite"){const{minZoom:ie,maxZoom:he}=c.iconSizeData;D.compositeIconSizes=[I["icon-size"].possiblyEvaluate(new vn(ie),b),I["icon-size"].possiblyEvaluate(new vn(he),b)]}D.layoutTextSize=I["text-size"].possiblyEvaluate(new vn(E+1),b),D.layoutIconSize=I["icon-size"].possiblyEvaluate(new vn(E+1),b),D.textMaxSize=I["text-size"].possiblyEvaluate(new vn(18),b);const U=T.get("text-rotation-alignment")==="map"&&T.get("symbol-placement")!=="point",$=T.get("text-size");let Y=!1;for(const ie of c.features)if(ie.icon&&ie.icon.nameSecondary){Y=!0;break}for(const ie of c.features){const he=T.get("text-font").evaluate(ie,{},b).join(","),ue=$.evaluate(ie,{},b)*D.textScaleFactor,ce=D.layoutTextSize.evaluate(ie,{},b)*D.textScaleFactor,Ie=(D.layoutIconSize.evaluate(ie,{},b),{horizontal:{},vertical:void 0}),de=ie.text;let Me,ze=[0,0];if(de){const qe=de.toString(),Ze=T.get("text-letter-spacing").evaluate(ie,{},b)*fs,Be=T.get("text-line-height").evaluate(ie,{},b)*fs,ct=aw(qe)?Ze:0,yt=T.get("text-anchor").evaluate(ie,{},b),lt=T.get("text-variable-anchor");if(!lt){const Zt=T.get("text-radial-offset").evaluate(ie,{},b);ze=Zt?qM(yt,[Zt*fs,$w]):T.get("text-offset").evaluate(ie,{},b).map(zt=>zt*fs)}let Lt=U?"center":T.get("text-justify").evaluate(ie,{},b);const Dt=T.get("symbol-placement")==="point",wt=Dt?T.get("text-max-width").evaluate(ie,{},b)*fs:1/0,vt=Zt=>{c.allowVerticalPlacement&&Cg(qe)&&(Ie.vertical=qw(de,i,a,m,he,wt,Be,yt,Zt,ct,ze,no.vertical,!0,ce,ue))};if(!U&&lt){const Zt=Lt==="auto"?lt.map(Ft=>Zw(Ft)):[Lt];let zt=!1;for(let Ft=0;Ft<Zt.length;Ft++){const hi=Zt[Ft];if(!Ie.horizontal[hi])if(zt)Ie.horizontal[hi]=Ie.horizontal[0];else{const xi=qw(de,i,a,m,he,wt,Be,"center",hi,ct,ze,no.horizontal,!1,ce,ue);xi&&(Ie.horizontal[hi]=xi,zt=xi.positionedLines.length===1)}}vt("left")}else{if(Lt==="auto"&&(Lt=Zw(yt)),Dt||T.get("text-writing-mode").indexOf("horizontal")>=0||!Cg(qe)){const Zt=qw(de,i,a,m,he,wt,Be,yt,Lt,ct,ze,no.horizontal,!1,ce,ue);Zt&&(Ie.horizontal[Lt]=Zt)}vt(Dt?"left":Lt)}}let Pe=!1;if(ie.icon&&ie.icon.namePrimary){const qe=Fw(c.iconSizeData,I["icon-size"],b,c.zoom,ie)*D.iconScaleFactor*S,Ze=ie.icon.getPrimary().scaleSelf(qe).serialize(),Be=u[Ze];Be&&(Me=f5(m[Ze],ie.icon.nameSecondary?m[ie.icon.getSecondary().scaleSelf(qe).serialize()]:void 0,T.get("icon-offset").evaluate(ie,{},b),T.get("icon-anchor").evaluate(ie,{},b)),Pe=Be.sdf,c.sdfIcons===void 0?c.sdfIcons=Be.sdf:c.sdfIcons!==Be.sdf&&yi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Be.pixelRatio!==c.pixelRatio||T.get("icon-rotate").constantOr(1)!==0)&&(c.iconsNeedLinear=!0))}const Ne=HM(Ie.horizontal)||Ie.vertical;c.iconsInText||(c.iconsInText=!!Ne&&Ne.iconsInText),(Ne||Me)&&x5(c,ie,Ie,Me,u,D,ce,0,ze,Pe,g,b,R,C,Y)}h&&c.generateCollisionDebugBuffers(E,c.collisionBoxArray,D.textScaleFactor)},s.e5=Jv,s.e6=Zs,s.e7=LI,s.e8=wM,s.e9=N,s.ea=function(c){let i=0;if(new Uint32Array(c,0,1)[0]!==dR){const a=new Uint32Array(c,0,7),[,,u,m,h,g]=a;i=a.byteLength+m+h+g+h,(u!==c.byteLength||i>=c.byteLength)&&yi("Invalid b3dm header information.")}return gR(c,i)},s.eb=function(c,i){const a=yR(c);for(const u of a){for(const m of u.meshes)XB(m);u.lights&&(u.lightMeshIndex=u.meshes.length,u.meshes.push(YB(u.lights,i)))}return a},s.ec=$v,s.ed=PC,s.ee=xa,s.ef=function(c){Rt(),tt!=null&&tt.then(i=>{i.keys().then(a=>{for(let u=0;u<a.length-c;u++)i.delete(a[u])})})},s.f=function(c){return c.indexOf("mapbox:")===0},s.g=function(c,i){return qn(Sn(c,{method:"GET"}),i)},s.h=Ir,s.i=function(c){return Kn.API_STYLE_REGEX.test(c)&&!vc(c)},s.j=function(c){return decodeURIComponent(atob(c).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join(""))},s.k=function(c){return btoa(encodeURIComponent(c).replace(/%([0-9A-F]{2})/g,(i,a)=>String.fromCharCode(+("0x"+a))))},s.l=Sn,s.m=si,s.n=function(c,i){return qn(Sn(c,{type:"json"}),i)},s.o=Eu,s.p=function(c,i){return qn(Sn(c,{method:"POST"}),i)},s.q=ye,s.r=Kr,s.s=function(c){try{const i=self[c];return i.setItem("_mapbox_test_",1),i.removeItem("_mapbox_test_"),!0}catch{return!1}},s.t=oe,s.u=function(){return function c(i){return i?(i^Math.random()*(16>>i/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,c)}()},s.v=function(c){return!!c&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(c)},s.w=yi,s.x=function(){return hT||(hT=new Wd),hT},s.y=bo,s.z=zs}),y(["./shared"],function(s){function N(nt){const X=nt?nt.url.toString():void 0;return X?performance.getEntriesByName(X):[]}function j(nt){if(typeof nt=="number"||typeof nt=="boolean"||typeof nt=="string"||nt==null)return JSON.stringify(nt);if(Array.isArray(nt)){let ne="[";for(const oe of nt)ne+=`${j(oe)},`;return`${ne}]`}let X="{";for(const ne of Object.keys(nt).sort())X+=`${ne}:${j(nt[ne])},`;return`${X}}`}function K(nt){let X="";for(const ne of s.bm)(nt.type!=="model"||ne!=="minzoom"&&ne!=="maxzoom")&&(X+=`/${j(nt[ne])}`);return X}class se{constructor(X){this.keyCache={},this._layers={},this._layerConfigs={},X&&this.replace(X)}replace(X,ne){this._layerConfigs={},this._layers={},this.update(X,[],ne)}update(X,ne,oe){this._options=oe;for(const ve of X)this._layerConfigs[ve.id]=ve,(this._layers[ve.id]=s.cu(ve,this.scope,null,this._options)).compileFilter(oe),this.keyCache[ve.id]&&delete this.keyCache[ve.id];for(const ve of ne)delete this.keyCache[ve],delete this._layerConfigs[ve],delete this._layers[ve];this.familiesBySource={};const ye=function(ve,Le){const Ge={};for(let et=0;et<ve.length;et++){const Je=ve[et];let tt=Le&&Le[Je.id];!tt&&(tt=K(Je),Je.type==="line"&&Je.paint)&&function At(Rt){return typeof Rt=="string"&&Rt==="line-progress"||(Array.isArray(Rt)?Rt.some(At):!(!Rt||typeof Rt!="object")&&Object.values(Rt).some(At))}(Je.paint["line-width"])&&(tt+=`/${j(Je.paint["line-width"])}`),Le&&(Le[Je.id]=tt);let mt=Ge[tt];mt||(mt=Ge[tt]=[]),mt.push(Je)}const Oe=[];for(const et in Ge)Oe.push(Ge[et]);return Oe}(s.bj(this._layerConfigs),this.keyCache);for(const ve of ye){const Le=ve.map(mt=>this._layers[mt.id]),Ge=Le[0];if(Ge.visibility==="none")continue;const Oe=Ge.source||"";let et=this.familiesBySource[Oe];et||(et=this.familiesBySource[Oe]={});const Je=Ge.sourceLayer||"_geojsonTileLayer";let tt=et[Je];tt||(tt=et[Je]=[]),tt.push(Le)}}}const ae=1*s.dX;class me{constructor(X){const ne={},oe=[];for(const Ge in X){const Oe=X[Ge],et=ne[Ge]={};for(const Je in Oe.glyphs){const tt=Oe.glyphs[+Je];if(!tt||tt.bitmap.width===0||tt.bitmap.height===0)continue;const mt=tt.metrics.localGlyph?ae:1,At={x:0,y:0,w:tt.bitmap.width+2*mt,h:tt.bitmap.height+2*mt};oe.push(At),et[Je]=At}}const{w:ye,h:ve}=s.F(oe),Le=new s.dW({width:ye||1,height:ve||1});for(const Ge in X){const Oe=X[Ge];for(const et in Oe.glyphs){const Je=Oe.glyphs[+et];if(!Je||Je.bitmap.width===0||Je.bitmap.height===0)continue;const tt=ne[Ge][et],mt=Je.metrics.localGlyph?ae:1;s.dW.copy(Je.bitmap,Le,{x:0,y:0},{x:tt.x+mt,y:tt.y+mt},Je.bitmap)}}this.image=Le,this.positions=ne}}s.dV(me,"GlyphAtlas");const Ue="3d_elevation_id",Xe="hd_road_elevation";class it{constructor(){this._valid=!1}reset(X){return this.feature=X,this._valid=!0,this._geometry=X.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(X,ne){return this._valid&&X(ne(this._geometry)),this}require(X,ne,oe){return this.get(X,!0,ne,oe)}optional(X,ne,oe){return this.get(X,!1,ne,oe)}success(){return this._valid}get(X,ne,oe,ye){const ve=this.feature.properties.hasOwnProperty(X)?+this.feature.properties[X]:void 0;return this._valid&&ve!==void 0?oe(ye?ye(ve):ve):ne&&(this._valid=!1),this}}class be{constructor(X,ne){this.featureFunc=X,this.vertexFunc=ne}parseFeature(X,ne,oe){return this.featureFunc(X,ne,oe)}parseVertex(X,ne,oe){return this.vertexFunc(X,ne,oe)}}const Ee=new be((nt,X,ne)=>nt.reset(X).require(Ue,oe=>{ne.id=oe}).optional("fixed_height_relative",oe=>{ne.constantHeight=oe},We.decodeRelativeHeight).geometry(oe=>{ne.bounds=oe},We.computeBounds).success(),(nt,X,ne)=>nt.reset(X).require(Ue,oe=>{ne.id=oe}).require("elevation_idx",oe=>{ne.idx=oe}).require("extent",oe=>{ne.extent=oe}).require("height_relative",oe=>{ne.height=oe},We.decodeRelativeHeight).geometry(oe=>{ne.position=oe},We.getPoint).success()),Ce=new be((nt,X,ne)=>nt.reset(X).require(Ue,oe=>{ne.id=oe}).optional("fixed_height",oe=>{ne.constantHeight=oe},We.decodeMetricHeight).geometry(oe=>{ne.bounds=oe},We.computeBounds).success(),(nt,X,ne)=>nt.reset(X).require(Ue,oe=>{ne.id=oe}).require("elevation_idx",oe=>{ne.idx=oe}).require("extent",oe=>{ne.extent=oe}).require("height",oe=>{ne.height=oe},We.decodeMetricHeight).geometry(oe=>{ne.position=oe},We.getPoint).success());class We{static computeBounds(X){const ne=new s.P(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),oe=new s.P(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const ye of X[0])ne.x>ye.x&&(ne.x=ye.x),ne.y>ye.y&&(ne.y=ye.y),oe.x<ye.x&&(oe.x=ye.x),oe.y<ye.y&&(oe.y=ye.y);return{min:ne,max:oe}}static getPoint(X){return s.ab.vec2.fromValues(X[0][0].x,X[0][0].y)}static decodeRelativeHeight(X){return 1e-4*X*5}static decodeMetricHeight(X){return 1e-4*X}static parse(X){const ne=[],oe=[],ye=X.length,ve=new it;for(let Ge=0;Ge<ye;Ge++){const Oe=X.feature(Ge),et=Oe.properties.hasOwnProperty("version")?String(Oe.properties.version):void 0,Je=(Le=et)?Le==="1.0.1"?Ce:void 0:Ee;if(Je===void 0){s.w(`Unknown elevation feature version number ${et||"(unknown)"}`);continue}const tt=Oe.properties.hasOwnProperty("type")?Oe.properties.type:void 0;if(tt){if(s.dY.VectorTileFeature.types[Oe.type]==="Point"&&tt==="curve_point"){const mt={};Je.parseVertex(ve,Oe,mt)&&ne.push(mt)}else if(s.dY.VectorTileFeature.types[Oe.type]==="Polygon"&&tt==="curve_meta"){const mt={};Je.parseFeature(ve,Oe,mt)&&oe.push(mt)}}}var Le;return{vertices:ne,features:oe}}}class Ct{constructor(X,ne,oe,ye,ve,Le){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=X,this.heightRange={min:oe,max:oe},this.safeArea=ne,this.constantHeight=oe,this.constantHeight==null&&(this.constantHeight!=null||ye.length!==0)){this.vertices=ye,this.edges=ve,this.edges=this.edges.filter(Ge=>Ge.a<this.vertices.length&&Ge.b<this.vertices.length&&!s.ab.vec2.exactEquals(this.vertices[Ge.a].position,this.vertices[Ge.b].position)),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const Ge of this.vertices)this.vertexProps.push({dir:s.ab.vec2.fromValues(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,Ge.height),this.heightRange.max=Math.max(this.heightRange.max,Ge.height);for(const Ge of this.edges){const Oe=this.vertices[Ge.a].position,et=this.vertices[Ge.b].position,Je=s.ab.vec2.subtract(s.ab.vec2.create(),et,Oe),tt=s.ab.vec2.length(Je),mt=s.ab.vec2.scale(s.ab.vec2.create(),Je,1/tt);this.edgeProps.push({vec:Je,dir:mt,len:tt});const At=this.vertexProps[Ge.a].dir,Rt=this.vertexProps[Ge.b].dir;s.ab.vec2.add(At,At,mt),s.ab.vec2.add(Rt,Rt,mt)}for(const Ge of this.vertexProps)Ge.dir[0]===0&&Ge.dir[1]===0||s.ab.vec2.normalize(Ge.dir,Ge.dir);this.tessellate(Le)}}pointElevation(X){if(this.constantHeight!=null)return this.constantHeight;const ne=this.getClosestEdge(X);if(ne==null)return 0;const[oe,ye]=ne;return(1-(ve=ye))*this.vertices[this.edges[oe].a].height+ve*this.vertices[this.edges[oe].b].height;var ve}getClosestEdge(X){if(this.edges.length===0)return;let ne=0,oe=Number.POSITIVE_INFINITY,ye=0;const ve=s.ab.vec2.fromValues(X.x,X.y);for(let Le=0;Le<this.edges.length;Le++){const Ge=this.edges[Le],Oe=this.edgeProps[Le].dir,et=new s.dZ(ve,this.edgeProps[Le].dir),Je=this.vertices[Ge.a].position,tt=this.vertices[Ge.b].position,mt=s.ab.vec2.create(),At=s.ab.vec2.create(),Rt=et.intersectsPlane(Je,this.vertexProps[Ge.a].dir,mt),Jt=et.intersectsPlane(tt,this.vertexProps[Ge.b].dir,At);if(!Rt||!Jt)continue;const si=s.ab.vec2.subtract(s.ab.vec2.create(),At,mt),ci=s.ab.vec2.subtract(s.ab.vec2.create(),ve,mt),ii=s.ab.vec2.dot(si,si),Si=ii>0?s.ab.vec2.dot(ci,si)/ii:0,Ii=s.aw(Si,0,1),wi=Math.abs((Si-Ii)*this.edgeProps[Le].len),Vi=s.ab.vec2.subtract(s.ab.vec2.create(),ve,Je),Ui=wi+Math.abs(s.ab.vec2.dot(Vi,s.ab.vec2.fromValues(Oe[1],-Oe[0])));Ui<oe&&(ne=Le,oe=Ui,ye=Ii)}return[ne,ye]}tessellate(X){for(let ne=this.edges.length-1;ne>=0;--ne){const oe=this.edges[ne].a,ye=this.edges[ne].b,{position:ve,height:Le,extent:Ge}=this.vertices[oe],{position:Oe,height:et,extent:Je}=this.vertices[ye],tt=this.vertexProps[oe].dir,mt=this.vertexProps[ye].dir,At=s.ab.vec3.fromValues(ve[0]/X,ve[1]/X,Le),Rt=s.ab.vec3.fromValues(Oe[0]/X,Oe[1]/X,et),Jt=s.ab.vec3.fromValues(tt[1],-tt[0],0);s.ab.vec3.scale(Jt,Jt,Ge);const si=s.ab.vec3.fromValues(mt[1],-mt[0],0);if(s.ab.vec3.scale(si,si,Je),this.distSqLines(s.ab.vec3.fromValues(At[0]+.5*Jt[0],At[1]+.5*Jt[1],At[2]+.5*Jt[2]),s.ab.vec3.fromValues(Rt[0]-.5*si[0],Rt[1]-.5*si[1],Rt[2]-.5*si[2]),s.ab.vec3.fromValues(At[0]-.5*Jt[0],At[1]-.5*Jt[1],At[2]-.5*Jt[2]),s.ab.vec3.fromValues(Rt[0]+.5*si[0],Rt[1]+.5*si[1],Rt[2]+.5*si[2]))<=.05*.05)continue;const ci=this.vertices.length,ii=s.ab.vec2.add(s.ab.vec2.create(),ve,Oe);this.vertices.push({position:s.ab.vec2.scale(ii,ii,.5),height:.5*(Le+et),extent:.5*(Ge+Je)});const Si=s.ab.vec2.add(s.ab.vec2.create(),tt,mt);this.vertexProps.push({dir:s.ab.vec2.normalize(Si,Si)}),this.edges.splice(ne,1),this.edgeProps.splice(ne,1),this.edges.push({a:oe,b:ci}),this.edges.push({a:ci,b:ye});const Ii=s.ab.vec2.subtract(s.ab.vec2.create(),this.vertices[ci].position,ve),wi=s.ab.vec2.length(Ii),Vi={vec:Ii,dir:s.ab.vec2.scale(s.ab.vec2.create(),Ii,1/wi),len:wi};this.edgeProps.push(Vi),this.edgeProps.push(Vi)}}distSqLines(X,ne,oe,ye){const ve=s.ab.vec3.subtract(s.ab.vec3.create(),ne,X),Le=s.ab.vec3.subtract(s.ab.vec3.create(),ye,oe),Ge=s.ab.vec3.subtract(s.ab.vec3.create(),X,oe),Oe=s.ab.vec3.dot(ve,ve),et=s.ab.vec3.dot(ve,Le),Je=s.ab.vec3.dot(ve,Ge),tt=s.ab.vec3.dot(Le,Le),mt=s.ab.vec3.dot(Le,Ge),At=Oe*tt-et*et;if(At===0){const ii=s.ab.vec3.dot(Ge,Le)/s.ab.vec3.dot(Le,Le),Si=s.ab.vec3.lerp(s.ab.vec3.create(),oe,ye,ii);return s.ab.vec3.squaredDistance(Si,X)}const Rt=(et*mt-Je*tt)/At,Jt=(Oe*mt-et*Je)/At,si=s.ab.vec3.lerp(s.ab.vec3.create(),X,ne,Rt),ci=s.ab.vec3.lerp(s.ab.vec3.create(),oe,ye,Jt);return s.ab.vec3.squaredDistance(si,ci)}}class Ut{static parseFrom(X,ne){const oe=We.parse(X);if(!oe)return[];let{vertices:ye,features:ve}=oe;const Le=1/s.cc(ne);ve.sort((Je,tt)=>Je.id-tt.id),ye.sort((Je,tt)=>Je.id-tt.id||Je.idx-tt.idx),ye=ye.filter((Je,tt,mt)=>tt===mt.findIndex(At=>At.id===Je.id&&At.idx===Je.idx));const Ge=new Array;let Oe=0;const et=ye.length;for(const Je of ve){if(Je.constantHeight){Ge.push(new Ct(Je.id,Je.bounds,Je.constantHeight));continue}for(;Oe!==et&&ye[Oe].id<Je.id;)Oe++;if(Oe===et||ye[Oe].id!==Je.id)continue;const tt=new Array,mt=new Array,At=Oe;for(;Oe!==et&&ye[Oe].id===Je.id;){const Rt=ye[Oe];if(tt.push({position:Rt.position,height:Rt.height,extent:Rt.extent}),Oe!==At&&ye[Oe-1].idx===Rt.idx-1){const Jt=Oe-At;mt.push({a:Jt-1,b:Jt})}Oe++}Ge.push(new Ct(Je.id,Je.bounds,void 0,tt,mt,Le))}return Ge}}s.dV(Ct,"ElevationFeature");class we{constructor(X){this.tileID=new s.aG(X.tileID.overscaledZ,X.tileID.wrap,X.tileID.canonical.z,X.tileID.canonical.x,X.tileID.canonical.y),this.tileZoom=X.tileZoom,this.uid=X.uid,this.zoom=X.zoom,this.lut=X.lut,this.canonical=X.tileID.canonical,this.pixelRatio=X.pixelRatio,this.tileSize=X.tileSize,this.source=X.source,this.scope=X.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=X.showCollisionBoxes,this.collectResourceTiming=!!X.request&&X.request.collectResourceTiming,this.promoteId=X.promoteId,this.isSymbolTile=X.isSymbolTile,this.tileTransform=s.aQ(X.tileID.canonical,X.projection),this.projection=X.projection,this.worldview=X.worldview,this.localizableLayerIds=X.localizableLayerIds,this.brightness=X.brightness,this.extraShadowCaster=!!X.extraShadowCaster,this.tessellationStep=X.tessellationStep,this.scaleFactor=X.scaleFactor}parse(X,ne,oe,ye,ve){this.status="parsing",this.data=X,this.collisionBoxArray=new s.aW;const Le=new s.d_(Object.keys(X.layers).sort()),Ge=new s.d$(this.tileID,this.promoteId);Ge.bucketLayerIDs=[];const Oe={},et=new s.e0(256,256),Je={featureIndex:Ge,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:et,availableImages:oe,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},tt=ne.familiesBySource[this.source];for(const ii in tt){const Si=X.layers[ii];if(!Si)continue;let Ii=!1,wi=!1,Vi=!1;for(const qn of tt[ii])qn[0].type==="symbol"?Ii=!0:wi=!0,qn[0].is3D()&&qn[0].type!=="model"&&(Vi=!0);if(this.extraShadowCaster&&!Vi||this.isSymbolTile===!0&&!Ii||this.isSymbolTile===!1&&!wi)continue;Si.version===1&&s.w(`Vector tile source "${this.source}" layer "${ii}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ui=Le.encode(ii),Un=[];let ma=!1;for(let qn=0,Qn=0;qn<Si.length;qn++){const Ur=Si.feature(qn),Dl=Ge.getId(Ur,ii);if(this.localizableLayerIds&&this.localizableLayerIds.has(ii)){const Za=Ur.properties?Ur.properties.worldview:null;if(this.worldview&&typeof Za=="string")if(Za==="all")Ur.properties.$localized=!0;else{if(!Za.split(",").includes(this.worldview))continue;Ur.properties.$localized=!0,Ur.properties.worldview=this.worldview}}!ma&&Ur.properties&&Ur.properties.hasOwnProperty(Ue)&&(ma=!0),Un.push({feature:Ur,id:Dl,index:Qn,sourceLayerIndex:Ui}),Qn++}ma&&X.layers.hasOwnProperty(Xe)&&(Je.elevationFeatures=Ut.parseFrom(X.layers[Xe],this.canonical));for(const qn of tt[ii]){const Qn=qn[0];(!this.extraShadowCaster||Qn.is3D()&&Qn.type!=="model")&&(this.isSymbolTile!==void 0&&Qn.type==="symbol"!==this.isSymbolTile||Qn.minzoom&&this.zoom<Math.floor(Qn.minzoom)||Qn.maxzoom&&this.zoom>=Qn.maxzoom||Qn.visibility!=="none"&&(Ae(qn,this.zoom,Je.brightness,oe),(Oe[Qn.id]=Qn.createBucket({index:Ge.bucketLayerIDs.length,layers:qn,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ui,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(Un,Je,this.tileID.canonical,this.tileTransform),Ge.bucketLayerIDs.push(qn.map(Ur=>s.aC(Ur.id,Ur.scope)))))}}let mt,At,Rt,Jt;et.trim();const si={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ci=()=>{if(mt)return this.status="done",ve(mt);if(this.extraShadowCaster)this.status="done",ve(null,{buckets:s.bj(Oe).filter(ii=>!ii.isEmpty()),featureIndex:Ge,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Je.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(At&&Rt&&Jt){const ii=new me(At),Si=new s.e3(Rt,Jt,this.lut);for(const Ii in Oe){const wi=Oe[Ii];wi instanceof s.aX?(Ae(wi.layers,this.zoom,Je.brightness,oe),s.e4(wi,At,ii.positions,Rt,Si.iconPositions,this.showCollisionBoxes,oe,this.tileID.canonical,this.tileZoom,this.projection,this.scaleFactor,this.pixelRatio,this.brightness)):wi.hasPattern&&(wi instanceof s.b1||wi instanceof s.b2||wi instanceof s.d5)&&(Ae(wi.layers,this.zoom,Je.brightness,oe),wi.addFeatures(Je,this.tileID.canonical,Si.patternPositions,oe,this.tileTransform,this.brightness))}this.status="done",ve(null,{buckets:s.bj(Oe).filter(Ii=>!Ii.isEmpty()),featureIndex:Ge,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ii.image,lineAtlas:et,imageAtlas:Si,brightness:Je.brightness})}};if(!this.extraShadowCaster){const ii=s.e1(Je.glyphDependencies,wi=>Object.keys(wi).map(Number));Object.keys(ii).length?ye.send("getGlyphs",{uid:this.uid,stacks:ii,scope:this.scope},(wi,Vi)=>{mt||(mt=wi,At=Vi,ci())},void 0,!1,si):At={};const Si=Object.keys(Je.iconDependencies);Si.length?ye.send("getImages",{icons:Si,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(wi,Vi)=>{if(mt)return;mt=wi;const Ui={};Object.values(Vi).some(Un=>Un.usvg)?this.rasterize(ye,Ui,Vi,Je.iconDependencies,()=>{Rt=Ui,ci()}):(this.fillImageMap(Ui,Je.iconDependencies,Vi),Rt=Ui,ci())},void 0,!1,si):Rt={};const Ii=Object.keys(Je.patternDependencies);Ii.length?ye.send("getImages",{icons:Ii,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(wi,Vi)=>{if(!mt){mt=wi;const Ui={};Object.values(Vi).some(Un=>Un.usvg)?this.rasterize(ye,Ui,Vi,Je.patternDependencies,()=>{Jt=Ui,ci()}):(this.fillImageMap(Ui,Je.patternDependencies,Vi),Jt=Ui,ci())}},void 0,!1,si):Jt={}}ci()}fillImageMap(X,ne,oe){for(const ye in oe){const ve=ne[ye]||[];for(const Le of ve)oe[Le.id].usvg||(X[Le.serialize()]=oe[Le.id])}}getImageTaskQueue(X,ne,oe){const ye={};for(const ve in ne){const Le=oe[ve]||[];for(const Ge of Le){const Oe=Ge.serialize();ne[Ge.id].usvg?ye[Oe]||(ye[Oe]=Ge):X[Oe]=ne[Ge.id]}}return ye}rasterize(X,ne,oe,ye,ve){const Le=this.getImageTaskQueue(ne,oe,ye);this.rasterizeTask=X.send("rasterizeImages",{scope:this.scope,imageTasks:Le},(Ge,Oe)=>{if(!Ge)for(const et in Oe){const{id:Je}=s.e2.deserializeFromString(et);ne[et]=Object.assign({},oe[Je],{data:Oe[et]})}ve()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function Ae(nt,X,ne,oe){const ye=new s.a8(X,{brightness:ne});for(const ve of nt)ve.recalculate(ye,oe)}class Ve extends s.E{constructor(X,ne,oe,ye,ve,Le){super(),this.actor=X,this.layerIndex=ne,this.availableImages=oe,this.loadVectorData=ve||s.aD,this.loading={},this.loaded={},this.deduped=new s.aB(X.scheduler),this.isSpriteLoaded=ye,this.scheduler=X.scheduler,this.brightness=Le}loadTile(X,ne){const oe=X.uid,ye=X&&X.request,ve=ye&&ye.collectResourceTiming,Le=this.loading[oe]=new we(X);Le.abort=this.loadVectorData(X,(Ge,Oe)=>{const et=!this.loading[oe];if(delete this.loading[oe],Le.cancelRasterize(),et||Ge||!Oe)return Le.status="done",et||(this.loaded[oe]=Le),ne(Ge);const Je=Oe.rawData,tt={};Oe.expires&&(tt.expires=Oe.expires),Oe.cacheControl&&(tt.cacheControl=Oe.cacheControl),Le.vectorTile=Oe.vectorTile||new s.dY.VectorTile(new s.bh(Je));const mt=()=>{Le.parse(Le.vectorTile,this.layerIndex,this.availableImages,this.actor,(At,Rt)=>{if(At||!Rt)return ne(At);const Jt={};if(ve){const si=N(ye);si.length>0&&(Jt.resourceTiming=JSON.parse(JSON.stringify(si)))}ne(null,s.l({rawTileData:Je.slice(0)},Rt,tt,Jt))})};this.isSpriteLoaded?mt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(mt,{type:"parseTile",isSymbolTile:X.isSymbolTile,zoom:X.tileZoom}):mt()}),this.loaded=this.loaded||{},this.loaded[oe]=Le})}reloadTile(X,ne){const oe=this.loaded,ye=X.uid;if(oe&&oe[ye]){const ve=oe[ye];ve.scaleFactor=X.scaleFactor,ve.showCollisionBoxes=X.showCollisionBoxes,ve.projection=X.projection,ve.brightness=X.brightness,ve.tileTransform=s.aQ(X.tileID.canonical,X.projection),ve.extraShadowCaster=X.extraShadowCaster,ve.lut=X.lut;const Le=(Ge,Oe)=>{const et=ve.reloadCallback;et&&(delete ve.reloadCallback,ve.parse(ve.vectorTile,this.layerIndex,this.availableImages,this.actor,et)),ne(Ge,Oe)};ve.status==="parsing"?ve.reloadCallback=Le:ve.status==="done"&&(ve.vectorTile?ve.parse(ve.vectorTile,this.layerIndex,this.availableImages,this.actor,Le):Le())}else ne(null,void 0)}abortTile(X,ne){const oe=X.uid,ye=this.loading[oe];ye&&(ye.abort&&ye.abort(),delete this.loading[oe]),ne()}removeTile(X,ne){const oe=this.loaded,ye=X.uid;oe&&oe[ye]&&delete oe[ye],ne()}}class De{loadTile(X,ne){const{uid:oe,encoding:ye,rawImageData:ve,padding:Le}=X,Ge=ImageBitmap&&ve instanceof ImageBitmap?this.getImageData(ve,Le):ve;ne(null,new s.e5(oe,Ge,ye,Le<1))}getImageData(X,ne){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(X.width,X.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=X.width,this.offscreenCanvas.height=X.height,this.offscreenCanvasContext.drawImage(X,0,0,X.width,X.height);const oe=this.offscreenCanvasContext.getImageData(-ne,-ne,X.width+2*ne,X.height+2*ne);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),oe}}s.bg.setPbf(s.bh);class je{decodeRasterArray({task:X,buffer:ne},oe){s.bg.performDecoding(ne,X).then(ye=>{oe(null,ye)},ye=>{oe(ye)})}}const pt=s.dY.VectorTileFeature.prototype.toGeoJSON;class Ye{constructor(X){this._feature=X,this.extent=s.ag,this.type=X.type,this.properties=X.tags,"id"in X&&!isNaN(X.id)&&(this.id=parseInt(X.id,10))}loadGeometry(){if(this._feature.type===1){const X=[];for(const ne of this._feature.geometry)X.push([new s.P(ne[0],ne[1])]);return X}{const X=[];for(const ne of this._feature.geometry){const oe=[];for(const ye of ne)oe.push(new s.P(ye[0],ye[1]));X.push(oe)}return X}}toGeoJSON(X,ne,oe){return pt.call(this,X,ne,oe)}}class Or{constructor(X){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.ag,this.length=X.length,this._features=X}feature(X){return new Ye(this._features[X])}}const di=64/4096,Qt=128;class Ai{constructor(){this.features=new Map}clear(){this.features.clear()}load(X=[],ne){for(const oe of X){const ye=oe.id;if(ye==null)continue;let ve=this.features.get(ye);ve&&this.updateCache(ve,ne),oe.geometry?(ve=ai(oe),this.updateCache(ve,ne),this.features.set(ye,ve)):this.features.delete(ye),this.updateCache(ve,ne)}}updateCache(X,ne){for(const{canonical:oe,uid:ye}of Object.values(ne)){const{z:ve,x:Le,y:Ge}=oe;Mi(X,Math.pow(2,ve),Le,Ge)&&delete ne[ye]}}getTile(X,ne,oe){const ye=Math.pow(2,X),ve=[];for(const Le of this.features.values())Mi(Le,ye,ne,oe)&&ve.push($t(Le,ye,ne,oe));return{features:ve}}getFeatures(){return[...this.features.values()]}}function Mi({minX:nt,minY:X,maxX:ne,maxY:oe},ye,ve,Le){return nt<(ve+1+di)/ye&&X<(Le+1+di)/ye&&ne>(ve-di)/ye&&oe>(Le-di)/ye}function ai(nt){const{id:X,geometry:ne,properties:oe}=nt;if(!ne)return;if(ne.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:ye,coordinates:ve}=ne,Le={id:X,type:1,geometry:[],tags:oe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Ge=Le.geometry;if(ye==="Point")pn(ve,Ge,Le);else if(ye==="MultiPoint")for(const Oe of ve)pn(Oe,Ge,Le);else if(ye==="LineString")Le.type=2,oi(ve,Ge,Le);else if(ye==="MultiLineString")Le.type=2,Wi(ve,Ge,Le);else if(ye==="Polygon")Le.type=3,Wi(ve,Ge,Le,!0);else{if(ye!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Le.type=3;for(const Oe of ve)Wi(Oe,Ge,Le,!0)}return Le}function pn([nt,X],ne,oe){const ye=s.at(nt);let ve=s.aA(X);ve=ve<0?0:ve>1?1:ve,ne.push(ye,ve),oe.minX=Math.min(oe.minX,ye),oe.minY=Math.min(oe.minY,ve),oe.maxX=Math.max(oe.maxX,ye),oe.maxY=Math.max(oe.maxY,ve)}function oi(nt,X,ne,oe=!1,ye=!1){const ve=[];for(const Le of nt)pn(Le,ve,ne);X.push(ve),oe&&function(Le,Ge){let Oe=0;for(let et=0,Je=Le.length,tt=Je-2;et<Je;tt=et,et+=2)Oe+=(Le[et]-Le[tt])*(Le[et+1]+Le[tt+1]);if(Oe>0===Ge)for(let et=0,Je=Le.length;et<Je/2;et+=2){const tt=Le[et],mt=Le[et+1];Le[et]=Le[Je-2-et],Le[et+1]=Le[Je-1-et],Le[Je-2-et]=tt,Le[Je-1-et]=mt}}(ve,ye)}function Wi(nt,X,ne,oe=!1){for(let ye=0;ye<nt.length;ye++)oi(nt[ye],X,ne,oe,ye===0)}function $t(nt,X,ne,oe){const{id:ye,type:ve,geometry:Le,tags:Ge}=nt,Oe=[];if(ve===1)(function(et,Je,tt,mt,At){for(let Rt=0;Rt<et.length;Rt+=2){const Jt=Math.round(s.ag*(et[Rt+0]*Je-tt)),si=Math.round(s.ag*(et[Rt+1]*Je-mt));At.push([Jt,si])}})(Le,X,ne,oe,Oe);else for(const et of Le)Nn(et,X,ne,oe,Oe);return{id:ye,type:ve,geometry:Oe,tags:Ge}}function Nn(nt,X,ne,oe,ye){const ve=-Qt,Le=s.ag+Qt;let Ge;for(let Oe=0;Oe<nt.length-2;Oe+=2){let et=Math.round(s.ag*(nt[Oe+0]*X-ne)),Je=Math.round(s.ag*(nt[Oe+1]*X-oe)),tt=Math.round(s.ag*(nt[Oe+2]*X-ne)),mt=Math.round(s.ag*(nt[Oe+3]*X-oe));const At=tt-et,Rt=mt-Je;et<ve&&tt<ve||(et<ve?(Je+=Math.round(Rt*((ve-et)/At)),et=ve):tt<ve&&(mt=Je+Math.round(Rt*((ve-et)/At)),tt=ve),Je<ve&&mt<ve||(Je<ve?(et+=Math.round(At*((ve-Je)/Rt)),Je=ve):mt<ve&&(tt=et+Math.round(At*((ve-Je)/Rt)),mt=ve),et>=Le&&tt>=Le||(et>=Le?(Je+=Math.round(Rt*((Le-et)/At)),et=Le):tt>=Le&&(mt=Je+Math.round(Rt*((Le-et)/At)),tt=Le),Je>=Le&&mt>=Le||(Je>=Le?(et+=Math.round(At*((Le-Je)/Rt)),Je=Le):mt>=Le&&(tt=et+Math.round(At*((Le-Je)/Rt)),mt=Le),Ge&&et===Ge[Ge.length-1][0]&&Je===Ge[Ge.length-1][1]||(Ge=[[et,Je]],ye.push(Ge)),Ge.push([tt,mt])))))}}var _n,Sr,Cs,Rs={exports:{}},ss=function(){if(Cs)return Rs.exports;Cs=1;var nt=s.e8(),X=function(){if(Sr)return _n;Sr=1;var Je=s.e6(),tt=s.e7().VectorTileFeature;function mt(Rt,Jt){this.options=Jt||{},this.features=Rt,this.length=Rt.length}function At(Rt,Jt){this.id=typeof Rt.id=="number"?Rt.id:void 0,this.type=Rt.type,this.rawGeometry=Rt.type===1?[Rt.geometry]:Rt.geometry,this.properties=Rt.tags,this.extent=Jt||4096}return _n=mt,mt.prototype.feature=function(Rt){return new At(this.features[Rt],this.options.extent)},At.prototype.loadGeometry=function(){var Rt=this.rawGeometry;this.geometry=[];for(var Jt=0;Jt<Rt.length;Jt++){for(var si=Rt[Jt],ci=[],ii=0;ii<si.length;ii++)ci.push(new Je(si[ii][0],si[ii][1]));this.geometry.push(ci)}return this.geometry},At.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Rt=this.geometry,Jt=1/0,si=-1/0,ci=1/0,ii=-1/0,Si=0;Si<Rt.length;Si++)for(var Ii=Rt[Si],wi=0;wi<Ii.length;wi++){var Vi=Ii[wi];Jt=Math.min(Jt,Vi.x),si=Math.max(si,Vi.x),ci=Math.min(ci,Vi.y),ii=Math.max(ii,Vi.y)}return[Jt,ci,si,ii]},At.prototype.toGeoJSON=tt.prototype.toGeoJSON,_n}();function ne(Je){var tt=new nt;return function(mt,At){for(var Rt in mt.layers)At.writeMessage(3,oe,mt.layers[Rt])}(Je,tt),tt.finish()}function oe(Je,tt){var mt;tt.writeVarintField(15,Je.version||1),tt.writeStringField(1,Je.name||""),tt.writeVarintField(5,Je.extent||4096);var At={keys:[],values:[],keycache:{},valuecache:{}};for(mt=0;mt<Je.length;mt++)At.feature=Je.feature(mt),tt.writeMessage(2,ye,At);var Rt=At.keys;for(mt=0;mt<Rt.length;mt++)tt.writeStringField(3,Rt[mt]);var Jt=At.values;for(mt=0;mt<Jt.length;mt++)tt.writeMessage(4,et,Jt[mt])}function ye(Je,tt){var mt=Je.feature;mt.id!==void 0&&tt.writeVarintField(1,mt.id),tt.writeMessage(2,ve,Je),tt.writeVarintField(3,mt.type),tt.writeMessage(4,Oe,mt)}function ve(Je,tt){var mt=Je.feature,At=Je.keys,Rt=Je.values,Jt=Je.keycache,si=Je.valuecache;for(var ci in mt.properties){var ii=mt.properties[ci],Si=Jt[ci];if(ii!==null){Si===void 0&&(At.push(ci),Jt[ci]=Si=At.length-1),tt.writeVarint(Si);var Ii=typeof ii;Ii!=="string"&&Ii!=="boolean"&&Ii!=="number"&&(ii=JSON.stringify(ii));var wi=Ii+":"+ii,Vi=si[wi];Vi===void 0&&(Rt.push(ii),si[wi]=Vi=Rt.length-1),tt.writeVarint(Vi)}}}function Le(Je,tt){return(tt<<3)+(7&Je)}function Ge(Je){return Je<<1^Je>>31}function Oe(Je,tt){for(var mt=Je.loadGeometry(),At=Je.type,Rt=0,Jt=0,si=mt.length,ci=0;ci<si;ci++){var ii=mt[ci],Si=1;At===1&&(Si=ii.length),tt.writeVarint(Le(1,Si));for(var Ii=At===3?ii.length-1:ii.length,wi=0;wi<Ii;wi++){wi===1&&At!==1&&tt.writeVarint(Le(2,Ii-1));var Vi=ii[wi].x-Rt,Ui=ii[wi].y-Jt;tt.writeVarint(Ge(Vi)),tt.writeVarint(Ge(Ui)),Rt+=Vi,Jt+=Ui}At===3&&tt.writeVarint(Le(7,1))}}function et(Je,tt){var mt=typeof Je;mt==="string"?tt.writeStringField(1,Je):mt==="boolean"?tt.writeBooleanField(7,Je):mt==="number"&&(Je%1!=0?tt.writeDoubleField(3,Je):Je<0?tt.writeSVarintField(6,Je):tt.writeVarintField(5,Je))}return Rs.exports=ne,Rs.exports.fromVectorTileJs=ne,Rs.exports.fromGeojsonVt=function(Je,tt){tt=tt||{};var mt={};for(var At in Je)mt[At]=new X(Je[At].features,tt),mt[At].name=At,mt[At].version=tt.version,mt[At].extent=tt.extent;return ne({layers:mt})},Rs.exports.GeoJSONWrapper=X,Rs.exports}(),ke=s.e9(ss);const rr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:nt=>nt},pa=Math.fround||(Zs=new Float32Array(1),nt=>(Zs[0]=+nt,Zs[0]));var Zs;const St=3,cr=5,Wr=6;class Ko{constructor(X){this.options=Object.assign(Object.create(rr),X),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(X){const{log:ne,minZoom:oe,maxZoom:ye}=this.options;ne&&console.time("total time");const ve=`prepare ${X.length} points`;ne&&console.time(ve),this.points=X;const Le=[];for(let Oe=0;Oe<X.length;Oe++){const et=X[Oe];if(!et.geometry)continue;const[Je,tt]=et.geometry.coordinates,mt=pa(Ds(Je)),At=pa(Da(tt));Le.push(mt,At,1/0,Oe,-1,1),this.options.reduce&&Le.push(0)}let Ge=this.trees[ye+1]=this._createTree(Le);ne&&console.timeEnd(ve);for(let Oe=ye;Oe>=oe;Oe--){const et=+Date.now();Ge=this.trees[Oe]=this._createTree(this._cluster(Ge,Oe)),ne&&console.log("z%d: %d clusters in %dms",Oe,Ge.numItems,+Date.now()-et)}return ne&&console.timeEnd("total time"),this}getClusters(X,ne){let oe=((X[0]+180)%360+360)%360-180;const ye=Math.max(-90,Math.min(90,X[1]));let ve=X[2]===180?180:((X[2]+180)%360+360)%360-180;const Le=Math.max(-90,Math.min(90,X[3]));if(X[2]-X[0]>=360)oe=-180,ve=180;else if(oe>ve){const tt=this.getClusters([oe,ye,180,Le],ne),mt=this.getClusters([-180,ye,ve,Le],ne);return tt.concat(mt)}const Ge=this.trees[this._limitZoom(ne)],Oe=Ge.range(Ds(oe),Da(Le),Ds(ve),Da(ye)),et=Ge.data,Je=[];for(const tt of Oe){const mt=this.stride*tt;Je.push(et[mt+cr]>1?Li(et,mt,this.clusterProps):this.points[et[mt+St]])}return Je}getChildren(X){const ne=this._getOriginId(X),oe=this._getOriginZoom(X),ye="No cluster with the specified id.",ve=this.trees[oe];if(!ve)throw new Error(ye);const Le=ve.data;if(ne*this.stride>=Le.length)throw new Error(ye);const Ge=this.options.radius/(this.options.extent*Math.pow(2,oe-1)),Oe=ve.within(Le[ne*this.stride],Le[ne*this.stride+1],Ge),et=[];for(const Je of Oe){const tt=Je*this.stride;Le[tt+4]===X&&et.push(Le[tt+cr]>1?Li(Le,tt,this.clusterProps):this.points[Le[tt+St]])}if(et.length===0)throw new Error(ye);return et}getLeaves(X,ne,oe){const ye=[];return this._appendLeaves(ye,X,ne=ne||10,oe=oe||0,0),ye}getTile(X,ne,oe){const ye=this.trees[this._limitZoom(X)],ve=Math.pow(2,X),{extent:Le,radius:Ge}=this.options,Oe=Ge/Le,et=(oe-Oe)/ve,Je=(oe+1+Oe)/ve,tt={features:[]};return this._addTileFeatures(ye.range((ne-Oe)/ve,et,(ne+1+Oe)/ve,Je),ye.data,ne,oe,ve,tt),ne===0&&this._addTileFeatures(ye.range(1-Oe/ve,et,1,Je),ye.data,ve,oe,ve,tt),ne===ve-1&&this._addTileFeatures(ye.range(0,et,Oe/ve,Je),ye.data,-1,oe,ve,tt),tt.features.length?tt:null}getClusterExpansionZoom(X){let ne=this._getOriginZoom(X)-1;for(;ne<=this.options.maxZoom;){const oe=this.getChildren(X);if(ne++,oe.length!==1)break;X=oe[0].properties.cluster_id}return ne}_appendLeaves(X,ne,oe,ye,ve){const Le=this.getChildren(ne);for(const Ge of Le){const Oe=Ge.properties;if(Oe&&Oe.cluster?ve+Oe.point_count<=ye?ve+=Oe.point_count:ve=this._appendLeaves(X,Oe.cluster_id,oe,ye,ve):ve<ye?ve++:X.push(Ge),X.length===oe)break}return ve}_createTree(X){const ne=new s.bE(X.length/this.stride|0,this.options.nodeSize,Float32Array);for(let oe=0;oe<X.length;oe+=this.stride)ne.add(X[oe],X[oe+1]);return ne.finish(),ne.data=X,ne}_addTileFeatures(X,ne,oe,ye,ve,Le){for(const Ge of X){const Oe=Ge*this.stride,et=ne[Oe+cr]>1;let Je,tt,mt;if(et)Je=vr(ne,Oe,this.clusterProps),tt=ne[Oe],mt=ne[Oe+1];else{const Jt=this.points[ne[Oe+St]];Je=Jt.properties;const[si,ci]=Jt.geometry.coordinates;tt=Ds(si),mt=Da(ci)}const At={type:1,geometry:[[Math.round(this.options.extent*(tt*ve-oe)),Math.round(this.options.extent*(mt*ve-ye))]],tags:Je};let Rt;Rt=et||this.options.generateId?ne[Oe+St]:this.points[ne[Oe+St]].id,Rt!==void 0&&(At.id=Rt),Le.features.push(At)}}_limitZoom(X){return Math.max(this.options.minZoom,Math.min(Math.floor(+X),this.options.maxZoom+1))}_cluster(X,ne){const{radius:oe,extent:ye,reduce:ve,minPoints:Le}=this.options,Ge=oe/(ye*Math.pow(2,ne)),Oe=X.data,et=[],Je=this.stride;for(let tt=0;tt<Oe.length;tt+=Je){if(Oe[tt+2]<=ne)continue;Oe[tt+2]=ne;const mt=Oe[tt],At=Oe[tt+1],Rt=X.within(Oe[tt],Oe[tt+1],Ge),Jt=Oe[tt+cr];let si=Jt;for(const ci of Rt){const ii=ci*Je;Oe[ii+2]>ne&&(si+=Oe[ii+cr])}if(si>Jt&&si>=Le){let ci,ii=mt*Jt,Si=At*Jt,Ii=-1;const wi=(tt/Je<<5)+(ne+1)+this.points.length;for(const Vi of Rt){const Ui=Vi*Je;if(Oe[Ui+2]<=ne)continue;Oe[Ui+2]=ne;const Un=Oe[Ui+cr];ii+=Oe[Ui]*Un,Si+=Oe[Ui+1]*Un,Oe[Ui+4]=wi,ve&&(ci||(ci=this._map(Oe,tt,!0),Ii=this.clusterProps.length,this.clusterProps.push(ci)),ve(ci,this._map(Oe,Ui)))}Oe[tt+4]=wi,et.push(ii/si,Si/si,1/0,wi,-1,si),ve&&et.push(Ii)}else{for(let ci=0;ci<Je;ci++)et.push(Oe[tt+ci]);if(si>1)for(const ci of Rt){const ii=ci*Je;if(!(Oe[ii+2]<=ne)){Oe[ii+2]=ne;for(let Si=0;Si<Je;Si++)et.push(Oe[ii+Si])}}}}return et}_getOriginId(X){return X-this.points.length>>5}_getOriginZoom(X){return(X-this.points.length)%32}_map(X,ne,oe){if(X[ne+cr]>1){const Le=this.clusterProps[X[ne+Wr]];return oe?Object.assign({},Le):Le}const ye=this.points[X[ne+St]].properties,ve=this.options.map(ye);return oe&&ve===ye?Object.assign({},ve):ve}}function Li(nt,X,ne){return{type:"Feature",id:nt[X+St],properties:vr(nt,X,ne),geometry:{type:"Point",coordinates:[(oe=nt[X],360*(oe-.5)),go(nt[X+1])]}};var oe}function vr(nt,X,ne){const oe=nt[X+cr],ye=oe>=1e4?`${Math.round(oe/1e3)}k`:oe>=1e3?Math.round(oe/100)/10+"k":oe,ve=nt[X+Wr],Le=ve===-1?{}:Object.assign({},ne[ve]);return Object.assign(Le,{cluster:!0,cluster_id:nt[X+St],point_count:oe,point_count_abbreviated:ye})}function Ds(nt){return nt/360+.5}function Da(nt){const X=Math.sin(nt*Math.PI/180),ne=.5-.25*Math.log((1+X)/(1-X))/Math.PI;return ne<0?0:ne>1?1:ne}function go(nt){const X=(180-360*nt)*Math.PI/180;return 360*Math.atan(Math.exp(X))/Math.PI-90}function Qo(nt,X,ne,oe){let ye=oe;const ve=X+(ne-X>>1);let Le,Ge=ne-X;const Oe=nt[X],et=nt[X+1],Je=nt[ne],tt=nt[ne+1];for(let mt=X+3;mt<ne;mt+=3){const At=bi(nt[mt],nt[mt+1],Oe,et,Je,tt);if(At>ye)Le=mt,ye=At;else if(At===ye){const Rt=Math.abs(mt-ve);Rt<Ge&&(Le=mt,Ge=Rt)}}ye>oe&&(Le-X>3&&Qo(nt,X,Le,oe),nt[Le+2]=ye,ne-Le>3&&Qo(nt,Le,ne,oe))}function bi(nt,X,ne,oe,ye,ve){let Le=ye-ne,Ge=ve-oe;if(Le!==0||Ge!==0){const Oe=((nt-ne)*Le+(X-oe)*Ge)/(Le*Le+Ge*Ge);Oe>1?(ne=ye,oe=ve):Oe>0&&(ne+=Le*Oe,oe+=Ge*Oe)}return Le=nt-ne,Ge=X-oe,Le*Le+Ge*Ge}function Ws(nt,X,ne,oe){const ye={id:nt??null,type:X,geometry:ne,tags:oe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(X==="Point"||X==="MultiPoint"||X==="LineString")Ps(ye,ne);else if(X==="Polygon")Ps(ye,ne[0]);else if(X==="MultiLineString")for(const ve of ne)Ps(ye,ve);else if(X==="MultiPolygon")for(const ve of ne)Ps(ye,ve[0]);return ye}function Ps(nt,X){for(let ne=0;ne<X.length;ne+=3)nt.minX=Math.min(nt.minX,X[ne]),nt.minY=Math.min(nt.minY,X[ne+1]),nt.maxX=Math.max(nt.maxX,X[ne]),nt.maxY=Math.max(nt.maxY,X[ne+1])}function Yn(nt,X,ne,oe){if(!X.geometry)return;const ye=X.geometry.coordinates;if(ye&&ye.length===0)return;const ve=X.geometry.type,Le=Math.pow(ne.tolerance/((1<<ne.maxZoom)*ne.extent),2);let Ge=[],Oe=X.id;if(ne.promoteId?Oe=X.properties[ne.promoteId]:ne.generateId&&(Oe=oe||0),ve==="Point")Sn(ye,Ge);else if(ve==="MultiPoint")for(const et of ye)Sn(et,Ge);else if(ve==="LineString")Xs(ye,Ge,Le,!1);else if(ve==="MultiLineString"){if(ne.lineMetrics){for(const et of ye)Ge=[],Xs(et,Ge,Le,!1),nt.push(Ws(Oe,"LineString",Ge,X.properties));return}_o(ye,Ge,Le,!1)}else if(ve==="Polygon")_o(ye,Ge,Le,!0);else{if(ve!=="MultiPolygon"){if(ve==="GeometryCollection"){for(const et of X.geometry.geometries)Yn(nt,{id:Oe,geometry:et,properties:X.properties},ne,oe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const et of ye){const Je=[];_o(et,Je,Le,!0),Ge.push(Je)}}nt.push(Ws(Oe,ve,Ge,X.properties))}function Sn(nt,X){X.push(Jo(nt[0]),Rl(nt[1]),0)}function Xs(nt,X,ne,oe){let ye,ve,Le=0;for(let Oe=0;Oe<nt.length;Oe++){const et=Jo(nt[Oe][0]),Je=Rl(nt[Oe][1]);X.push(et,Je,0),Oe>0&&(Le+=oe?(ye*Je-et*ve)/2:Math.sqrt(Math.pow(et-ye,2)+Math.pow(Je-ve,2))),ye=et,ve=Je}const Ge=X.length-3;X[2]=1,Qo(X,0,Ge,ne),X[Ge+2]=1,X.size=Math.abs(Le),X.start=0,X.end=X.size}function _o(nt,X,ne,oe){for(let ye=0;ye<nt.length;ye++){const ve=[];Xs(nt[ye],ve,ne,oe),X.push(ve)}}function Jo(nt){return nt/360+.5}function Rl(nt){const X=Math.sin(nt*Math.PI/180),ne=.5-.25*Math.log((1+X)/(1-X))/Math.PI;return ne<0?0:ne>1?1:ne}function Ar(nt,X,ne,oe,ye,ve,Le,Ge){if(oe/=X,ve>=(ne/=X)&&Le<oe)return nt;if(Le<ne||ve>=oe)return null;const Oe=[];for(const et of nt){const Je=et.geometry;let tt=et.type;const mt=ye===0?et.minX:et.minY,At=ye===0?et.maxX:et.maxY;if(mt>=ne&&At<oe){Oe.push(et);continue}if(At<ne||mt>=oe)continue;let Rt=[];if(tt==="Point"||tt==="MultiPoint")el(Je,Rt,ne,oe,ye);else if(tt==="LineString")tl(Je,Rt,ne,oe,ye,!1,Ge.lineMetrics);else if(tt==="MultiLineString")il(Je,Rt,ne,oe,ye,!1);else if(tt==="Polygon")il(Je,Rt,ne,oe,ye,!0);else if(tt==="MultiPolygon")for(const Jt of Je){const si=[];il(Jt,si,ne,oe,ye,!0),si.length&&Rt.push(si)}if(Rt.length){if(Ge.lineMetrics&&tt==="LineString"){for(const Jt of Rt)Oe.push(Ws(et.id,tt,Jt,et.tags));continue}tt!=="LineString"&&tt!=="MultiLineString"||(Rt.length===1?(tt="LineString",Rt=Rt[0]):tt="MultiLineString"),tt!=="Point"&&tt!=="MultiPoint"||(tt=Rt.length===3?"Point":"MultiPoint"),Oe.push(Ws(et.id,tt,Rt,et.tags))}}return Oe.length?Oe:null}function el(nt,X,ne,oe,ye){for(let ve=0;ve<nt.length;ve+=3){const Le=nt[ve+ye];Le>=ne&&Le<=oe&&yi(X,nt[ve],nt[ve+1],nt[ve+2])}}function tl(nt,X,ne,oe,ye,ve,Le){let Ge=as(nt);const Oe=ye===0?Ys:gc;let et,Je,tt=nt.start;for(let si=0;si<nt.length-3;si+=3){const ci=nt[si],ii=nt[si+1],Si=nt[si+2],Ii=nt[si+3],wi=nt[si+4],Vi=ye===0?ci:ii,Ui=ye===0?Ii:wi;let Un=!1;Le&&(et=Math.sqrt(Math.pow(ci-Ii,2)+Math.pow(ii-wi,2))),Vi<ne?Ui>ne&&(Je=Oe(Ge,ci,ii,Ii,wi,ne),Le&&(Ge.start=tt+et*Je)):Vi>oe?Ui<oe&&(Je=Oe(Ge,ci,ii,Ii,wi,oe),Le&&(Ge.start=tt+et*Je)):yi(Ge,ci,ii,Si),Ui<ne&&Vi>=ne&&(Je=Oe(Ge,ci,ii,Ii,wi,ne),Un=!0),Ui>oe&&Vi<=oe&&(Je=Oe(Ge,ci,ii,Ii,wi,oe),Un=!0),!ve&&Un&&(Le&&(Ge.end=tt+et*Je),X.push(Ge),Ge=as(nt)),Le&&(tt+=et)}let mt=nt.length-3;const At=nt[mt],Rt=nt[mt+1],Jt=ye===0?At:Rt;Jt>=ne&&Jt<=oe&&yi(Ge,At,Rt,nt[mt+2]),mt=Ge.length-3,ve&&mt>=3&&(Ge[mt]!==Ge[0]||Ge[mt+1]!==Ge[1])&&yi(Ge,Ge[0],Ge[1],Ge[2]),Ge.length&&X.push(Ge)}function as(nt){const X=[];return X.size=nt.size,X.start=nt.start,X.end=nt.end,X}function il(nt,X,ne,oe,ye,ve){for(const Le of nt)tl(Le,X,ne,oe,ye,ve,!1)}function yi(nt,X,ne,oe){nt.push(X,ne,oe)}function Ys(nt,X,ne,oe,ye,ve){const Le=(ve-X)/(oe-X);return yi(nt,ve,ne+(ye-ne)*Le,1),Le}function gc(nt,X,ne,oe,ye,ve){const Le=(ve-ne)/(ye-ne);return yi(nt,X+(oe-X)*Le,ve,1),Le}function os(nt,X){const ne=[];for(let oe=0;oe<nt.length;oe++){const ye=nt[oe],ve=ye.type;let Le;if(ve==="Point"||ve==="MultiPoint"||ve==="LineString")Le=Ls(ye.geometry,X);else if(ve==="MultiLineString"||ve==="Polygon"){Le=[];for(const Ge of ye.geometry)Le.push(Ls(Ge,X))}else if(ve==="MultiPolygon"){Le=[];for(const Ge of ye.geometry){const Oe=[];for(const et of Ge)Oe.push(Ls(et,X));Le.push(Oe)}}ne.push(Ws(ye.id,ve,Le,ye.tags))}return ne}function Ls(nt,X){const ne=[];ne.size=nt.size,nt.start!==void 0&&(ne.start=nt.start,ne.end=nt.end);for(let oe=0;oe<nt.length;oe+=3)ne.push(nt[oe]+X,nt[oe+1],nt[oe+2]);return ne}function yo(nt,X){if(nt.transformed)return nt;const ne=1<<nt.z,oe=nt.x,ye=nt.y;for(const ve of nt.features){const Le=ve.geometry,Ge=ve.type;if(ve.geometry=[],Ge===1)for(let Oe=0;Oe<Le.length;Oe+=2)ve.geometry.push(vo(Le[Oe],Le[Oe+1],X,ne,oe,ye));else for(let Oe=0;Oe<Le.length;Oe++){const et=[];for(let Je=0;Je<Le[Oe].length;Je+=2)et.push(vo(Le[Oe][Je],Le[Oe][Je+1],X,ne,oe,ye));ve.geometry.push(et)}}return nt.transformed=!0,nt}function vo(nt,X,ne,oe,ye,ve){return[Math.round(ne*(nt*oe-ye)),Math.round(ne*(X*oe-ve))]}function Ks(nt,X,ne,oe,ye){const ve=X===ye.maxZoom?0:ye.tolerance/((1<<X)*ye.extent),Le={features:[],numPoints:0,numSimplified:0,numFeatures:nt.length,source:null,x:ne,y:oe,z:X,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Ge of nt)_c(Le,Ge,ve,ye);return Le}function _c(nt,X,ne,oe){const ye=X.geometry,ve=X.type,Le=[];if(nt.minX=Math.min(nt.minX,X.minX),nt.minY=Math.min(nt.minY,X.minY),nt.maxX=Math.max(nt.maxX,X.maxX),nt.maxY=Math.max(nt.maxY,X.maxY),ve==="Point"||ve==="MultiPoint")for(let Ge=0;Ge<ye.length;Ge+=3)Le.push(ye[Ge],ye[Ge+1]),nt.numPoints++,nt.numSimplified++;else if(ve==="LineString")Ha(Le,ye,nt,ne,!1,!1);else if(ve==="MultiLineString"||ve==="Polygon")for(let Ge=0;Ge<ye.length;Ge++)Ha(Le,ye[Ge],nt,ne,ve==="Polygon",Ge===0);else if(ve==="MultiPolygon")for(let Ge=0;Ge<ye.length;Ge++){const Oe=ye[Ge];for(let et=0;et<Oe.length;et++)Ha(Le,Oe[et],nt,ne,!0,et===0)}if(Le.length){let Ge=X.tags||null;if(ve==="LineString"&&oe.lineMetrics){Ge={};for(const et in X.tags)Ge[et]=X.tags[et];Ge.mapbox_clip_start=ye.start/ye.size,Ge.mapbox_clip_end=ye.end/ye.size}const Oe={geometry:Le,type:ve==="Polygon"||ve==="MultiPolygon"?3:ve==="LineString"||ve==="MultiLineString"?2:1,tags:Ge};X.id!==null&&(Oe.id=X.id),nt.features.push(Oe)}}function Ha(nt,X,ne,oe,ye,ve){const Le=oe*oe;if(oe>0&&X.size<(ye?Le:oe))return void(ne.numPoints+=X.length/3);const Ge=[];for(let Oe=0;Oe<X.length;Oe+=3)(oe===0||X[Oe+2]>Le)&&(ne.numSimplified++,Ge.push(X[Oe],X[Oe+1])),ne.numPoints++;ye&&function(Oe,et){let Je=0;for(let tt=0,mt=Oe.length,At=mt-2;tt<mt;At=tt,tt+=2)Je+=(Oe[tt]-Oe[At])*(Oe[tt+1]+Oe[At+1]);if(Je>0===et)for(let tt=0,mt=Oe.length;tt<mt/2;tt+=2){const At=Oe[tt],Rt=Oe[tt+1];Oe[tt]=Oe[mt-2-tt],Oe[tt+1]=Oe[mt-1-tt],Oe[mt-2-tt]=At,Oe[mt-1-tt]=Rt}}(Ge,ve),nt.push(Ge)}const yc={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class xo{constructor(X,ne){const oe=(ne=this.options=function(ve,Le){for(const Ge in Le)ve[Ge]=Le[Ge];return ve}(Object.create(yc),ne)).debug;if(oe&&console.time("preprocess data"),ne.maxZoom<0||ne.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ne.promoteId&&ne.generateId)throw new Error("promoteId and generateId cannot be used together.");let ye=function(ve,Le){const Ge=[];if(ve.type==="FeatureCollection")for(let Oe=0;Oe<ve.features.length;Oe++)Yn(Ge,ve.features[Oe],Le,Oe);else Yn(Ge,ve.type==="Feature"?ve:{geometry:ve},Le);return Ge}(X,ne);this.tiles={},this.tileCoords=[],oe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ne.indexMaxZoom,ne.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ye=function(ve,Le){const Ge=Le.buffer/Le.extent;let Oe=ve;const et=Ar(ve,1,-1-Ge,Ge,0,-1,2,Le),Je=Ar(ve,1,1-Ge,2+Ge,0,-1,2,Le);return(et||Je)&&(Oe=Ar(ve,1,-Ge,1+Ge,0,-1,2,Le)||[],et&&(Oe=os(et,1).concat(Oe)),Je&&(Oe=Oe.concat(os(Je,-1)))),Oe}(ye,ne),ye.length&&this.splitTile(ye,0,0,0),oe&&(ye.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(X,ne,oe,ye,ve,Le,Ge){const Oe=[X,ne,oe,ye],et=this.options,Je=et.debug;for(;Oe.length;){ye=Oe.pop(),oe=Oe.pop(),ne=Oe.pop(),X=Oe.pop();const tt=1<<ne,mt=Kn(ne,oe,ye);let At=this.tiles[mt];if(!At&&(Je>1&&console.time("creation"),At=this.tiles[mt]=Ks(X,ne,oe,ye,et),this.tileCoords.push({z:ne,x:oe,y:ye}),Je)){Je>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ne,oe,ye,At.numFeatures,At.numPoints,At.numSimplified),console.timeEnd("creation"));const Un=`z${ne}`;this.stats[Un]=(this.stats[Un]||0)+1,this.total++}if(At.source=X,ve==null){if(ne===et.indexMaxZoom||At.numPoints<=et.indexMaxPoints)continue}else{if(ne===et.maxZoom||ne===ve)continue;if(ve!=null){const Un=ve-ne;if(oe!==Le>>Un||ye!==Ge>>Un)continue}}if(At.source=null,X.length===0)continue;Je>1&&console.time("clipping");const Rt=.5*et.buffer/et.extent,Jt=.5-Rt,si=.5+Rt,ci=1+Rt;let ii=null,Si=null,Ii=null,wi=null,Vi=Ar(X,tt,oe-Rt,oe+si,0,At.minX,At.maxX,et),Ui=Ar(X,tt,oe+Jt,oe+ci,0,At.minX,At.maxX,et);X=null,Vi&&(ii=Ar(Vi,tt,ye-Rt,ye+si,1,At.minY,At.maxY,et),Si=Ar(Vi,tt,ye+Jt,ye+ci,1,At.minY,At.maxY,et),Vi=null),Ui&&(Ii=Ar(Ui,tt,ye-Rt,ye+si,1,At.minY,At.maxY,et),wi=Ar(Ui,tt,ye+Jt,ye+ci,1,At.minY,At.maxY,et),Ui=null),Je>1&&console.timeEnd("clipping"),Oe.push(ii||[],ne+1,2*oe,2*ye),Oe.push(Si||[],ne+1,2*oe,2*ye+1),Oe.push(Ii||[],ne+1,2*oe+1,2*ye),Oe.push(wi||[],ne+1,2*oe+1,2*ye+1)}}getTile(X,ne,oe){X=+X,ne=+ne,oe=+oe;const ye=this.options,{extent:ve,debug:Le}=ye;if(X<0||X>24)return null;const Ge=1<<X,Oe=Kn(X,ne=ne+Ge&Ge-1,oe);if(this.tiles[Oe])return yo(this.tiles[Oe],ve);Le>1&&console.log("drilling down to z%d-%d-%d",X,ne,oe);let et,Je=X,tt=ne,mt=oe;for(;!et&&Je>0;)Je--,tt>>=1,mt>>=1,et=this.tiles[Kn(Je,tt,mt)];return et&&et.source?(Le>1&&(console.log("found parent tile z%d-%d-%d",Je,tt,mt),console.time("drilling down")),this.splitTile(et.source,Je,tt,mt,X,ne,oe),Le>1&&console.timeEnd("drilling down"),this.tiles[Oe]?yo(this.tiles[Oe],ve):null):null}}function Kn(nt,X,ne){return 32*((1<<nt)*ne+X)+nt}function Ir(nt,X){const ne=nt.tileID.canonical;if(!this._geoJSONIndex)return void X(null,null);const oe=this._geoJSONIndex.getTile(ne.z,ne.x,ne.y);if(!oe)return void X(null,null);const ye=new Or(oe.features);let ve=ke(ye);ve.byteOffset===0&&ve.byteLength===ve.buffer.byteLength||(ve=new Uint8Array(ve)),X(null,{vectorTile:ye,rawData:ve.buffer})}class vc extends Ve{constructor(X,ne,oe,ye,ve,Le){super(X,ne,oe,ye,Ir,Le),ve&&(this.loadGeoJSON=ve),this._dynamicIndex=new Ai}loadData(X,ne){const oe=X&&X.request,ye=oe&&oe.collectResourceTiming;this.loadGeoJSON(X,(ve,Le)=>{if(ve||!Le)return ne(ve);if(typeof Le!="object")return ne(new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`));{try{if(X.filter){const Oe=s.U(X.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Oe.result==="error")throw new Error(Oe.value.map(et=>`${et.key}: ${et.message}`).join(", "));Le.features=Le.features.filter(et=>Oe.value.evaluate({zoom:0},et))}X.dynamic?(Le.type==="Feature"&&(Le={type:"FeatureCollection",features:[Le]}),X.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Le.features,this.loaded),X.cluster&&(Le.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=X.cluster?new Ko(function({superclusterOptions:Oe,clusterProperties:et}){if(!et||!Oe)return Oe;const Je={},tt={},mt={accumulated:null,zoom:0},At={properties:null},Rt=Object.keys(et);for(const Jt of Rt){const[si,ci]=et[Jt],ii=s.U(ci),Si=s.U(typeof si=="string"?[si,["accumulated"],["get",Jt]]:si);Je[Jt]=ii.value,tt[Jt]=Si.value}return Oe.map=Jt=>{At.properties=Jt;const si={};for(const ci of Rt)si[ci]=Je[ci].evaluate(mt,At);return si},Oe.reduce=(Jt,si)=>{At.properties=si;for(const ci of Rt)mt.accumulated=Jt[ci],Jt[ci]=tt[ci].evaluate(mt,At)},Oe}(X)).load(Le.features):X.dynamic?this._dynamicIndex:function(Oe,et){return new xo(Oe,et)}(Le,X.geojsonVtOptions)}catch(Oe){return ne(Oe)}const Ge={};if(ye){const Oe=N(oe);Oe&&(Ge.resourceTiming={},Ge.resourceTiming[X.source]=JSON.parse(JSON.stringify(Oe)))}ne(null,Ge)}})}reloadTile(X,ne){const oe=this.loaded;return oe&&oe[X.uid]?X.partial?ne(null,void 0):super.reloadTile(X,ne):this.loadTile(X,ne)}loadGeoJSON(X,ne){if(X.request)s.n(X.request,ne);else{if(typeof X.data!="string")return ne(new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`));try{return ne(null,JSON.parse(X.data))}catch{return ne(new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(X,ne){try{ne(null,this._geoJSONIndex.getClusterExpansionZoom(X.clusterId))}catch(oe){ne(oe)}}getClusterChildren(X,ne){try{ne(null,this._geoJSONIndex.getChildren(X.clusterId))}catch(oe){ne(oe)}}getClusterLeaves(X,ne){try{ne(null,this._geoJSONIndex.getLeaves(X.clusterId,X.limit,X.offset))}catch(oe){ne(oe)}}}class $a{constructor(X,ne){this.tileID=new s.aG(X.tileID.overscaledZ,X.tileID.wrap,X.tileID.canonical.z,X.tileID.canonical.x,X.tileID.canonical.y),this.tileZoom=X.tileZoom,this.uid=X.uid,this.zoom=X.zoom,this.canonical=X.tileID.canonical,this.pixelRatio=X.pixelRatio,this.tileSize=X.tileSize,this.source=X.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=X.projection,this.brightness=ne}parse(X,ne,oe,ye){this.status="parsing";const ve=new s.aG(oe.tileID.overscaledZ,oe.tileID.wrap,oe.tileID.canonical.z,oe.tileID.canonical.x,oe.tileID.canonical.y),Le=[],Ge=ne.familiesBySource[oe.source],Oe=new s.d$(ve,oe.promoteId);return Oe.bucketLayerIDs=[],Oe.is3DTile=!0,s.ea(X).then(et=>{if(!et)return ye(new Error("Could not parse tile"));const Je=s.eb(et,1/s.cc(oe.tileID.canonical)),tt=et.json.extensionsUsed&&et.json.extensionsUsed.includes("MAPBOX_mesh_features")||et.json.asset.extras&&et.json.asset.extras.MAPBOX_mesh_features,mt=et.json.extensionsUsed&&et.json.extensionsUsed.includes("EXT_meshopt_compression"),At=new s.a8(this.zoom,{brightness:this.brightness});for(const Rt in Ge)for(const Jt of Ge[Rt]){const si=Jt[0];Oe.bucketLayerIDs.push(Jt.map(ii=>s.aC(ii.id,ii.scope))),si.recalculate(At,[]);const ci=new s.ec(Jt,Je,ve,tt,mt,this.brightness,Oe);tt||(ci.needsUpload=!0),Le.push(ci),ci.evaluate(si)}this.status="done",ye(null,{buckets:Le,featureIndex:Oe,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(et=>ye(new Error(et.message)))}}class sr{constructor(X,ne,oe,ye,ve,Le){this.actor=X,this.layerIndex=ne,this.availableImages=oe,this.brightness=Le,this.loading={},this.loaded={}}loadTile(X,ne){const oe=X.uid,ye=this.loading[oe]=new $a(X,this.brightness);s.bi(X.request,(ve,Le)=>{const Ge=!this.loading[oe];return delete this.loading[oe],Ge||ve?(ye.status="done",Ge||(this.loaded[oe]=ye),ne(ve)):Le&&Le.byteLength!==0?void ye.parse(Le,this.layerIndex,X,(Oe,et)=>{ye.status="done",this.loaded=this.loaded||{},this.loaded[oe]=ye,Oe||!et?ne(Oe):ne(null,et)}):(ye.status="done",this.loaded[oe]=ye,ne())})}reloadTile(X,ne){const oe=this.loaded,ye=X.uid;if(oe&&oe[ye]){const ve=oe[ye];ve.projection=X.projection,ve.brightness=X.brightness;const Le=(Ge,Oe)=>{ve.reloadCallback&&(delete ve.reloadCallback,this.loadTile(X,ne)),ne(Ge,Oe)};ve.status==="parsing"?ve.reloadCallback=Le:ve.status==="done"&&this.loadTile(X,ne)}}abortTile(X,ne){const oe=X.uid;this.loading[oe]&&delete this.loading[oe],ne()}removeTile(X,ne){const oe=this.loaded,ye=X.uid;oe&&oe[ye]&&delete oe[ye],ne()}}class Pa{constructor(X){this.self=X,this.actor=new s.ed(X,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.imageRasterizer=new s.I,this.projections={},this.defaultProjection=s.bP({name:"mercator"}),this.workerSourceTypes={vector:Ve,geojson:vc,"batched-model":sr},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(ne,oe)=>{if(this.workerSourceTypes[ne])throw new Error(`Worker source with name "${ne}" already registered.`);this.workerSourceTypes[ne]=oe},this.self.registerRTLTextPlugin=ne=>{if(s.ee.isParsed())throw new Error("RTL text plugin already registered.");s.ee.applyArabicShaping=ne.applyArabicShaping,s.ee.processBidirectionalText=ne.processBidirectionalText,s.ee.processStyledBidirectionalText=ne.processStyledBidirectionalText}}clearCaches(X,ne,oe){delete this.layerIndexes[X],delete this.availableImages[X],delete this.workerSources[X],delete this.demWorkerSources[X],delete this.rasterArrayWorkerSource,oe()}checkIfReady(X,ne,oe){oe()}setReferrer(X,ne){this.referrer=ne}spriteLoaded(X,{scope:ne,isLoaded:oe}){if(this.isSpriteLoaded[X]||(this.isSpriteLoaded[X]={}),this.isSpriteLoaded[X][ne]=oe,this.workerSources[X]&&this.workerSources[X][ne])for(const ye in this.workerSources[X][ne]){const ve=this.workerSources[X][ne][ye];for(const Le in ve){const Ge=ve[Le];Ge instanceof Ve&&(Ge.isSpriteLoaded=oe,Ge.fire(new s.z("isSpriteLoaded")))}}}setImages(X,{scope:ne,images:oe},ye){if(this.availableImages[X]||(this.availableImages[X]={}),this.availableImages[X][ne]=oe,this.workerSources[X]&&this.workerSources[X][ne]){for(const ve in this.workerSources[X][ne]){const Le=this.workerSources[X][ne][ve];for(const Ge in Le)Le[Ge].availableImages=oe}ye()}else ye()}setProjection(X,ne){this.projections[X]=s.bP(ne)}setBrightness(X,ne,oe){this.brightness=ne,oe()}setLayers(X,ne,oe){this.getLayerIndex(X,ne.scope).replace(ne.layers,ne.options),oe()}updateLayers(X,ne,oe){this.getLayerIndex(X,ne.scope).update(ne.layers,ne.removedIds,ne.options),oe()}loadTile(X,ne,oe){ne.projection=this.projections[X]||this.defaultProjection,this.getWorkerSource(X,ne.type,ne.source,ne.scope).loadTile(ne,oe)}loadDEMTile(X,ne,oe){this.getDEMWorkerSource(X,ne.source,ne.scope).loadTile(ne,oe)}decodeRasterArray(X,ne,oe){this.getRasterArrayWorkerSource().decodeRasterArray(ne,oe)}reloadTile(X,ne,oe){ne.projection=this.projections[X]||this.defaultProjection,this.getWorkerSource(X,ne.type,ne.source,ne.scope).reloadTile(ne,oe)}abortTile(X,ne,oe){this.getWorkerSource(X,ne.type,ne.source,ne.scope).abortTile(ne,oe)}removeTile(X,ne,oe){this.getWorkerSource(X,ne.type,ne.source,ne.scope).removeTile(ne,oe)}removeSource(X,ne,oe){if(!(this.workerSources[X]&&this.workerSources[X][ne.scope]&&this.workerSources[X][ne.scope][ne.type]&&this.workerSources[X][ne.scope][ne.type][ne.source]))return;const ye=this.workerSources[X][ne.scope][ne.type][ne.source];delete this.workerSources[X][ne.scope][ne.type][ne.source],ye.removeSource!==void 0?ye.removeSource(ne,oe):oe()}loadWorkerSource(X,ne,oe){try{this.self.importScripts(ne.url),oe()}catch(ye){oe(ye.toString())}}syncRTLPluginState(X,ne,oe){try{s.ee.setState(ne);const ye=s.ee.getPluginURL();if(s.ee.isLoaded()&&!s.ee.isParsed()&&ye!=null){this.self.importScripts(ye);const ve=s.ee.isParsed();oe(ve?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ye}`),ve)}}catch(ye){oe(ye.toString())}}setDracoUrl(X,ne){this.dracoUrl=ne}getAvailableImages(X,ne){this.availableImages[X]||(this.availableImages[X]={});let oe=this.availableImages[X][ne];return oe||(oe=[]),oe}getLayerIndex(X,ne){this.layerIndexes[X]||(this.layerIndexes[X]={});let oe=this.layerIndexes[X][ne];return oe||(oe=this.layerIndexes[X][ne]=new se,oe.scope=ne),oe}getWorkerSource(X,ne,oe,ye){return this.workerSources[X]||(this.workerSources[X]={}),this.workerSources[X][ye]||(this.workerSources[X][ye]={}),this.workerSources[X][ye][ne]||(this.workerSources[X][ye][ne]={}),this.isSpriteLoaded[X]||(this.isSpriteLoaded[X]={}),this.workerSources[X][ye][ne][oe]||(this.workerSources[X][ye][ne][oe]=new this.workerSourceTypes[ne]({send:(ve,Le,Ge,Oe,et,Je)=>{this.actor.send(ve,Le,Ge,X,et,Je)},scheduler:this.actor.scheduler},this.getLayerIndex(X,ye),this.getAvailableImages(X,ye),this.isSpriteLoaded[X][ye],void 0,this.brightness)),this.workerSources[X][ye][ne][oe]}rasterizeImages(X,ne,oe){const{imageTasks:ye,scope:ve}=ne,Le={};for(const Ge in ye){const{image:Oe,imageIdWithOptions:et}=ye[Ge];Le[Ge]=this.imageRasterizer.rasterize(et,Oe,ve,X)}oe(void 0,Le)}removeRasterizedImages(X,ne,oe){const{imageIds:ye,scope:ve}=ne;this.imageRasterizer.removeImagesFromCacheByIds(ye,ve,X),oe()}getDEMWorkerSource(X,ne,oe){return this.demWorkerSources[X]||(this.demWorkerSources[X]={}),this.demWorkerSources[X][oe]||(this.demWorkerSources[X][oe]={}),this.demWorkerSources[X][oe][ne]||(this.demWorkerSources[X][oe][ne]=new De),this.demWorkerSources[X][oe][ne]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new je),this.rasterArrayWorkerSource}enforceCacheSizeLimit(X,ne){s.ef(ne)}getWorkerPerformanceMetrics(X,ne,oe){oe(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Pa(self)),Pa}),y(["./shared"],function(s){var N="3.10.0";const j={create:"create",load:"load",fullLoad:"fullLoad"},K={mark(f){performance.mark(f)},measure(f,r,o){performance.measure(f,r,o)}};function se(f){const r=f.name.split("?")[0];return s.a(r)&&r.includes("mapbox-gl.js")?"javascript":s.a(r)&&r.includes("mapbox-gl.css")?"css":s.b(r)?"fontRange":s.c(r)?"sprite":s.i(r)?"style":s.d(r)?"tilejson":"other"}var ae,me={},Ue=function(){if(ae)return me;function f(p){return!r(p)}function r(p){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var x,w,M=new Blob([""],{type:"text/javascript"}),P=URL.createObjectURL(M);try{w=new Worker(P),x=!0}catch{x=!1}return w&&w.terminate(),URL.revokeObjectURL(P),x}()?function(){var x=document.createElement("canvas");x.width=x.height=1;var w=x.getContext("2d");if(!w)return!1;var M=w.getImageData(0,0,1,1);return M&&M.width===x.width}()?(o[_=p&&p.failIfMajorPerformanceCaveat]===void 0&&(o[_]=function(x){var w,M=function(P){var z=document.createElement("canvas"),O=Object.create(f.webGLContextAttributes);return O.failIfMajorPerformanceCaveat=P,z.getContext("webgl2",O)}(x);if(!M)return!1;try{w=M.createShader(M.VERTEX_SHADER)}catch{return!1}return!(!w||M.isContextLost())&&(M.shaderSource(w,"void main() {}"),M.compileShader(w),M.getShaderParameter(w,M.COMPILE_STATUS)===!0)}(_)),o[_]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var _}ae=1,me.supported=f,me.notSupportedReason=r;var o={};return f.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},me}();function Xe(f,r,o){const p=document.createElement(f);return r!=null&&(p.className=r),o&&o.appendChild(p),p}function it(f,r,o){const p=document.createElementNS("http://www.w3.org/2000/svg",f);for(const _ of Object.keys(r))p.setAttributeNS(null,_,String(r[_]));return o&&o.appendChild(p),p}const be=typeof document<"u"?document.documentElement&&document.documentElement.style:null,Ee=be&&be.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Ce;function We(){be&&Ee&&(Ce=be[Ee],be[Ee]="none")}function Ct(){be&&Ee&&(be[Ee]=Ce)}function Ut(f){f.preventDefault(),f.stopPropagation(),window.removeEventListener("click",Ut,!0)}function we(){window.addEventListener("click",Ut,!0),window.setTimeout(()=>{window.removeEventListener("click",Ut,!0)},0)}function Ae(f,r){const o=f.getBoundingClientRect();return je(f,o,r)}function Ve(f,r){const o=f.getBoundingClientRect(),p=[];for(let _=0;_<r.length;_++)p.push(je(f,o,r[_]));return p}function De(f){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&f.button===2&&f.ctrlKey?0:f.button}function je(f,r,o){const p=f.offsetWidth===r.width?1:f.offsetWidth/r.width;return new s.P((o.clientX-r.left)*p,(o.clientY-r.top)*p)}const pt="01",Ye="NO_ACCESS_TOKEN";class Or{constructor(r,o,p){this._transformRequestFn=r,this._customAccessToken=o,this._silenceAuthErrors=!!p,this._createSkuToken()}_createSkuToken(){const r=function(){let o="";for(let p=0;p<10;p++)o+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",pt,o].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=r.token,this._skuTokenExpiresAt=r.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(r,o){return this._transformRequestFn&&this._transformRequestFn(r,o)||{url:r}}normalizeStyleURL(r,o){if(!s.f(r))return r;const p=Qt(r);return p.params.push(`sdk=js-${N}`),p.path=`/styles/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||o)}normalizeGlyphsURL(r,o){if(!s.f(r))return r;const p=Qt(r);return p.path=`/fonts/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||o)}normalizeModelURL(r,o){if(!s.f(r))return r;const p=Qt(r);return p.path=`/models/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||o)}normalizeSourceURL(r,o,p,_){if(!s.f(r))return r;const x=Qt(r);return x.path=`/v4/${x.authority}.json`,x.params.push("secure"),p&&x.params.push(`language=${p}`),_&&x.params.push(`worldview=${_}`),this._makeAPIURL(x,this._customAccessToken||o)}normalizeIconsetURL(r,o){const p=Qt(r);return s.f(r)?(p.path=`/styles/v1${p.path}/iconset.pbf`,this._makeAPIURL(p,this._customAccessToken||o)):Ai(p)}normalizeSpriteURL(r,o,p,_){const x=Qt(r);return s.f(r)?(x.path=`/styles/v1${x.path}/sprite${o}${p}`,this._makeAPIURL(x,this._customAccessToken||_)):(x.path+=`${o}${p}`,Ai(x))}normalizeTileURL(r,o,p){if(this._isSkuTokenExpired()&&this._createSkuToken(),r&&!s.f(r))return r;const _=Qt(r);_.path=_.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${o||p&&_.authority!=="raster"&&p===512?"@2x":""}${s.m.supported?".webp":"$1"}`),_.authority==="raster"?_.path=`/${s.e.RASTER_URL_PREFIX}${_.path}`:_.authority==="rasterarrays"?_.path=`/${s.e.RASTERARRAYS_URL_PREFIX}${_.path}`:_.authority==="3dtiles"?_.path=`/${s.e.TILES3D_URL_PREFIX}${_.path}`:(_.path=_.path.replace(/^.+\/v4\//,"/"),_.path=`/${s.e.TILE_URL_VERSION}${_.path}`);const x=this._customAccessToken||function(w){for(const M of w){const P=M.match(/^access_token=(.*)$/);if(P)return P[1]}return null}(_.params)||s.e.ACCESS_TOKEN;return s.e.REQUIRE_ACCESS_TOKEN&&x&&this._skuToken&&_.params.push(`sku=${this._skuToken}`),this._makeAPIURL(_,x)}canonicalizeTileURL(r,o){const p=Qt(r);if(!p.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!p.path.match(/\.[\w]+$/))return r;let _="mapbox://";p.path.match(/^\/raster\/v1\//)?_+=`raster/${p.path.replace(`/${s.e.RASTER_URL_PREFIX}/`,"")}`:p.path.match(/^\/rasterarrays\/v1\//)?_+=`rasterarrays/${p.path.replace(`/${s.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:_+=`tiles/${p.path.replace(`/${s.e.TILE_URL_VERSION}/`,"")}`;let x=p.params;return o&&(x=x.filter(w=>!w.match(/^access_token=/))),x.length&&(_+=`?${x.join("&")}`),_}canonicalizeTileset(r,o){const p=!!o&&s.f(o),_=[];for(const x of r.tiles||[])s.h(x)?_.push(this.canonicalizeTileURL(x,p)):_.push(x);return _}_makeAPIURL(r,o){const p="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",_=Qt(s.e.API_URL);if(r.protocol=_.protocol,r.authority=_.authority,r.protocol==="http"){const x=r.params.indexOf("secure");x>=0&&r.params.splice(x,1)}if(_.path!=="/"&&(r.path=`${_.path}${r.path}`),!s.e.REQUIRE_ACCESS_TOKEN)return Ai(r);if(o=o||s.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!o)throw new Error(`An API access token is required to use Mapbox GL. ${p}`);if(o[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${p}`)}return r.params=r.params.filter(x=>x.indexOf("access_token")===-1),r.params.push(`access_token=${o||""}`),Ai(r)}}const di=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Qt(f){const r=f.match(di);if(!r)throw new Error("Unable to parse URL object");return{protocol:r[1],authority:r[2],path:r[3]||"/",params:r[4]?r[4].split("&"):[]}}function Ai(f){const r=f.params.length?`?${f.params.join("&")}`:"";return`${f.protocol}://${f.authority}${f.path}${r}`}const Mi="mapbox.eventData";function ai(f){if(!f)return null;const r=f.split(".");if(!r||r.length!==3)return null;try{return JSON.parse(s.j(r[1]))}catch{return null}}class pn{constructor(r){this.type=r,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(r){const o=ai(s.e.ACCESS_TOKEN);let p="";return p=o&&o.u?s.k(o.u):s.e.ACCESS_TOKEN||"",r?`${Mi}.${r}:${p}`:`${Mi}:${p}`}fetchEventData(){const r=s.s("localStorage"),o=this.getStorageKey(),p=this.getStorageKey("uuid");if(r)try{const _=localStorage.getItem(o);_&&(this.eventData=JSON.parse(_));const x=localStorage.getItem(p);x&&(this.anonId=x)}catch{s.w("Unable to read from LocalStorage")}}saveEventData(){const r=s.s("localStorage"),o=this.getStorageKey(),p=this.getStorageKey("uuid"),_=this.anonId;if(r&&_)try{localStorage.setItem(p,_),Object.keys(this.eventData).length>=1&&localStorage.setItem(o,JSON.stringify(this.eventData))}catch{s.w("Unable to write to LocalStorage")}}processRequests(r){}postEvent(r,o,p,_){if(!s.e.EVENTS_URL)return;const x=Qt(s.e.EVENTS_URL);x.params.push(`access_token=${_||s.e.ACCESS_TOKEN||""}`);const w={event:this.type,created:new Date(r).toISOString()},M=o?s.l(w,o):w,P={url:Ai(x),headers:{"Content-Type":"text/plain"},body:JSON.stringify([M])};this.pendingRequest=s.p(P,z=>{this.pendingRequest=null,p(z),this.saveEventData(),this.processRequests(_)})}queueRequest(r,o){this.queue.push(r),this.processRequests(o)}}const oi=new class extends pn{constructor(f){super("appUserTurnstile"),this._customAccessToken=f}postTurnstileEvent(f,r){s.e.EVENTS_URL&&s.e.ACCESS_TOKEN&&Array.isArray(f)&&f.some(o=>s.f(o)||s.h(o))&&this.queueRequest(Date.now(),r)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const r=ai(s.e.ACCESS_TOKEN),o=r?r.u:s.e.ACCESS_TOKEN;let p=o!==this.eventData.tokenU;s.v(this.anonId)||(this.anonId=s.u(),p=!0);const _=this.queue.shift();if(this.eventData.lastSuccess){const x=new Date(this.eventData.lastSuccess),w=new Date(_),M=(_-this.eventData.lastSuccess)/864e5;p=p||M>=1||M<-1||x.getDate()!==w.getDate()}else p=!0;p?this.postEvent(_,{sdkIdentifier:"mapbox-gl-js",sdkVersion:N,skuId:pt,"enabled.telemetry":!1,userId:this.anonId},x=>{x||(this.eventData.lastSuccess=_,this.eventData.tokenU=o)},f):this.processRequests()}},Wi=oi.postTurnstileEvent.bind(oi),$t=new class extends pn{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(f,r,o,p){this.skuToken=r,this.errorCb=p,s.e.EVENTS_URL&&(o||s.e.ACCESS_TOKEN?this.queueRequest({id:f,timestamp:Date.now()},o):this.errorCb(new Error(Ye)))}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{id:r,timestamp:o}=this.queue.shift();r&&this.success[r]||(this.anonId||this.fetchEventData(),s.v(this.anonId)||(this.anonId=s.u()),this.postEvent(o,{sdkIdentifier:"mapbox-gl-js",sdkVersion:N,skuId:pt,skuToken:this.skuToken,userId:this.anonId},p=>{p?this.errorCb(p):r&&(this.success[r]=!0)},f))}remove(){this.errorCb=null}},Nn=$t.postMapLoadEvent.bind($t),_n=new class extends pn{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(f){let r=this.mapInstanceIdMap.get(f);return r||(r=s.u(),this.mapInstanceIdMap.set(f,r)),r}getEventId(f){const r=this.eventIdPerMapInstanceMap.get(f)||0;return this.eventIdPerMapInstanceMap.set(f,r+1),r}postStyleLoadEvent(f,r){const{map:o,style:p,importedStyles:_}=r;if(!s.e.EVENTS_URL||!f&&!s.e.ACCESS_TOKEN)return;const x=this.getMapInstanceId(o),w={mapInstanceId:x,eventId:this.getEventId(x),style:p};_.length&&(w.importedStyles=_),this.queueRequest({timestamp:Date.now(),payload:w},f)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:r,payload:o}=this.queue.shift();this.postEvent(r,o,()=>{},f)}},Sr=_n.postStyleLoadEvent.bind(_n),Cs=new class extends pn{constructor(){super("gljs.performance")}postPerformanceEvent(f,r){s.e.EVENTS_URL&&(f||s.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:r},f)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:r,performanceData:o}=this.queue.shift(),p=function(_){const x=performance.getEntriesByType("resource"),w=performance.getEntriesByType("mark"),M=function(G){const Q={};if(G){for(const W in G)if(W!=="other")for(const te of G[W]){const ee=`${W}ResolveRangeMin`,le=`${W}ResolveRangeMax`,pe=`${W}RequestCount`,fe=`${W}RequestCachedCount`;Q[ee]=Math.min(Q[ee]||1/0,te.startTime),Q[le]=Math.max(Q[le]||-1/0,te.responseEnd);const Te=_e=>{Q[_e]===void 0&&(Q[_e]=0),++Q[_e]};te.transferSize!==void 0&&te.transferSize===0&&Te(fe),Te(pe)}}return Q}(function(G,Q){const W={};if(G)for(const te of G){const ee=Q(te);W[ee]===void 0&&(W[ee]=[]),W[ee].push(te)}return W}(x,se)),P=window.devicePixelRatio,z=navigator.connection||navigator.mozConnection||navigator.webkitConnection,O=z?z.effectiveType:void 0,B={counters:[],metadata:[],attributes:[]},V=(G,Q,W)=>{W!=null&&G.push({name:Q,value:W.toString()})};for(const G in M)V(B.counters,G,M[G]);if(_.interactionRange[0]!==1/0&&_.interactionRange[1]!==-1/0&&(V(B.counters,"interactionRangeMin",_.interactionRange[0]),V(B.counters,"interactionRangeMax",_.interactionRange[1])),w)for(const G of Object.keys(j)){const Q=j[G],W=w.find(te=>te.name===Q);W&&V(B.counters,Q,W.startTime)}return V(B.counters,"visibilityHidden",_.visibilityHidden),V(B.attributes,"style",function(G){if(G)for(const Q of G){const W=Q.name.split("?")[0];if(s.i(W)){const te=W.split("/").slice(-2);if(te.length===2)return`mapbox://styles/${te[0]}/${te[1]}`}}}(x)),V(B.attributes,"terrainEnabled",_.terrainEnabled?"true":"false"),V(B.attributes,"fogEnabled",_.fogEnabled?"true":"false"),V(B.attributes,"projection",_.projection),V(B.attributes,"zoom",_.zoom),V(B.metadata,"devicePixelRatio",P),V(B.metadata,"connectionEffectiveType",O),V(B.metadata,"navigatorUserAgent",navigator.userAgent),V(B.metadata,"screenWidth",window.screen.width),V(B.metadata,"screenHeight",window.screen.height),V(B.metadata,"windowWidth",window.innerWidth),V(B.metadata,"windowHeight",window.innerHeight),V(B.metadata,"mapWidth",_.width/P),V(B.metadata,"mapHeight",_.height/P),V(B.metadata,"webglRenderer",_.renderer),V(B.metadata,"webglVendor",_.vendor),V(B.metadata,"sdkVersion",N),V(B.metadata,"sdkIdentifier","mapbox-gl-js"),B}(o);for(const _ of p.metadata);for(const _ of p.counters);for(const _ of p.attributes);this.postEvent(r,p,()=>{},f)}},Rs=Cs.postPerformanceEvent.bind(Cs),ss=new class extends pn{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(f,r,o,p){if(!s.e.API_URL||!s.e.SESSION_PATH)return;const _=Qt(s.e.API_URL+s.e.SESSION_PATH);_.params.push(`sku=${r||""}`),_.params.push(`access_token=${p||s.e.ACCESS_TOKEN||""}`);const x={url:Ai(_),headers:{"Content-Type":"text/plain"}};this.pendingRequest=s.g(x,w=>{this.pendingRequest=null,o(w),this.saveEventData(),this.processRequests(p)})}getSessionAPI(f,r,o,p){this.skuToken=r,this.errorCb=p,s.e.SESSION_PATH&&s.e.API_URL&&(o||s.e.ACCESS_TOKEN?this.queueRequest({id:f,timestamp:Date.now()},o):this.errorCb(new Error(Ye)))}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{id:r,timestamp:o}=this.queue.shift();r&&this.success[r]||this.getSession(o,this.skuToken,p=>{p?this.errorCb(p):r&&(this.success[r]=!0)},f)}remove(){this.errorCb=null}},ke=ss.getSessionAPI.bind(ss),rr=new Set;function pa(f,r){r?rr.add(f):rr.delete(f)}class Zs{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(r,o){this._updatedSourceCaches[r]=o,this.setDirty()}discardSourceCacheUpdate(r){delete this._updatedSourceCaches[r]}updateLayer(r){const o=r.scope;this._updatedLayers[o]=this._updatedLayers[o]||new Set,this._updatedLayers[o].add(r.id),this.setDirty()}removeLayer(r){const o=r.scope;this._removedLayers[o]=this._removedLayers[o]||{},this._updatedLayers[o]=this._updatedLayers[o]||new Set,this._removedLayers[o][r.id]=r,this._updatedLayers[o].delete(r.id),this._updatedPaintProps.delete(r.fqid),this.setDirty()}getRemovedLayer(r){return this._removedLayers[r.scope]?this._removedLayers[r.scope][r.id]:null}discardLayerRemoval(r){this._removedLayers[r.scope]&&delete this._removedLayers[r.scope][r.id]}getLayerUpdatesByScope(){const r={};for(const o in this._updatedLayers)r[o]=r[o]||{},r[o].updatedIds=Array.from(this._updatedLayers[o].values());for(const o in this._removedLayers)r[o]=r[o]||{},r[o].removedIds=Object.keys(this._removedLayers[o]);return r}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(r){this._updatedPaintProps.add(r.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(r){this._updatedImages.add(r),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}function St(f){const{userImage:r}=f;return!!(r&&r.render&&r.render())&&(f.data.replace(new Uint8Array(r.data.buffer)),!0)}class cr extends s.E{constructor(r){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0,this.spriteFormat=r,r!=="raster"&&s.t()&&(this.imageRasterizerDispatcher=new s.D(s.x(),this,"Image Rasterizer Worker",1))}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new s.I),this._imageRasterizer}createScope(r){this.images[r]={},this.loaded[r]=!1,this.updatedImages[r]={},this.patterns[r]={},this.callbackDispatchedThisFrame[r]={},this.atlasImage[r]=new s.r({width:1,height:1})}isLoaded(){for(const r in this.loaded)if(!this.loaded[r])return!1;return!0}setLoaded(r,o){if(this.loaded[o]!==r&&(this.loaded[o]=r,r)){for(const{ids:p,callback:_}of this.requestors)this._notify(p,o,_);this.requestors=[]}}hasImage(r,o){return!!this.getImage(r,o)}getImage(r,o){return this.images[o][r]}addImage(r,o,p){this._validate(r,p)&&(this.images[o][r]=p)}_validate(r,o){let p=!0;return this._validateStretch(o.stretchX,o.data&&o.data.width)||(this.fire(new s.y(new Error(`Image "${r}" has invalid "stretchX" value`))),p=!1),this._validateStretch(o.stretchY,o.data&&o.data.height)||(this.fire(new s.y(new Error(`Image "${r}" has invalid "stretchY" value`))),p=!1),this._validateContent(o.content,o)||(this.fire(new s.y(new Error(`Image "${r}" has invalid "content" value`))),p=!1),p}_validateStretch(r,o){if(!r)return!0;let p=0;for(const _ of r){if(_[0]<p||_[1]<_[0]||o<_[1])return!1;p=_[1]}return!0}_validateContent(r,o){return r?r.length!==4||!o.usvg&&(r[0]<0||o.data.width<r[0]||r[1]<0||o.data.height<r[1]||r[2]<0||o.data.width<r[2]||r[3]<0||o.data.height<r[3])?!1:!(r[2]<r[0]||r[3]<r[1]):!0}updateImage(r,o,p){p.version=this.images[o][r].version+1,this.images[o][r]=p,this.updatedImages[o][r]=!0,this.removeFromImageRasterizerCache(r,o)}removeFromImageRasterizerCache(r,o){this.spriteFormat!=="raster"&&(s.t()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[r],scope:o}):this.imageRasterizer.removeImagesFromCacheByIds([r],o))}removeImage(r,o){const p=this.images[o][r];delete this.images[o][r],delete this.patterns[o][r],this.removeFromImageRasterizerCache(r,o),p.userImage&&p.userImage.onRemove&&p.userImage.onRemove()}listImages(r){return Object.keys(this.images[r])}getImages(r,o,p){let _=!0;const x=!!this.loaded[o];if(!x)for(const w of r)this.images[o][w]||(_=!1);x||_?this._notify(r,o,p):this.requestors.push({ids:r,scope:o,callback:p})}rasterizeImages({scope:r,imageTasks:o},p){const _={};for(const x in o){const w=o[x],M=this.getImage(w.id,r);M&&(_[x]={image:M,imageIdWithOptions:w})}s.t()?this.imageRasterizerDispatcher.getActor().send("rasterizeImages",{imageTasks:_,scope:r},p):this.rasterizeImagesInMainThread({imageTasks:_,scope:r},p)}rasterizeImagesInMainThread(r,o){const{imageTasks:p,scope:_}=r,x={};for(const w in p){const{image:M,imageIdWithOptions:P}=p[w];x[w]=this.imageRasterizer.rasterize(P,M,_,"")}o(void 0,x)}getUpdatedImages(r){return this.updatedImages[r]}_notify(r,o,p){const _={};for(const x of r){this.images[o][x]||this.fire(new s.z("styleimagemissing",{id:x}));const w=this.images[o][x];w?_[x]={data:w.usvg?null:w.data.clone(),pixelRatio:w.pixelRatio,sdf:w.sdf,usvg:w.usvg,version:w.version,stretchX:w.stretchX,stretchY:w.stretchY,content:w.content,hasRenderCallback:!!(w.userImage&&w.userImage.render)}:s.w(`Image "${x}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}p(null,_)}getPixelSize(r){const{width:o,height:p}=this.atlasImage[r];return{width:o,height:p}}getPattern(r,o,p){const _=this.patterns[o][r],x=this.getImage(r,o);if(!x)return null;if(_&&_.position.version===x.version)return _.position;if(_)_.position.version=x.version;else{x.usvg&&!x.data&&(x.data=this.imageRasterizer.rasterize(s.A.from(r).getPrimary(),x,o,""));const w={w:x.data.width+2*s.B,h:x.data.height+2*s.B,x:0,y:0},M=new s.C(w,x,s.B);this.patterns[o][r]={bin:w,position:M}}return this._updatePatternAtlas(o,p),this.patterns[o][r].position}bind(r,o){const p=r.gl;let _=this.atlasTexture[o];_?this.dirty&&(_.update(this.atlasImage[o]),this.dirty=!1):(_=new s.T(r,this.atlasImage[o],p.RGBA8),this.atlasTexture[o]=_),_.bind(p.LINEAR,p.CLAMP_TO_EDGE)}_updatePatternAtlas(r,o){const p=[];for(const M in this.patterns[r])p.push(this.patterns[r][M].bin);const{w:_,h:x}=s.F(p),w=this.atlasImage[r];w.resize({width:_||1,height:x||1});for(const M in this.patterns[r]){const{bin:P,position:z}=this.patterns[r][M];let O=z.padding;const B=P.x+O,V=P.y+O,G=this.images[r][M].data,Q=G.width,W=G.height;O=O>1?O-1:O,s.r.copy(G,w,{x:0,y:0},{x:B,y:V},{width:Q,height:W},o),s.r.copy(G,w,{x:0,y:W-O},{x:B,y:V-O},{width:Q,height:O},o),s.r.copy(G,w,{x:0,y:0},{x:B,y:V+W},{width:Q,height:O},o),s.r.copy(G,w,{x:Q-O,y:0},{x:B-O,y:V},{width:O,height:W},o),s.r.copy(G,w,{x:0,y:0},{x:B+Q,y:V},{width:O,height:W},o),s.r.copy(G,w,{x:Q-O,y:W-O},{x:B-O,y:V-O},{width:O,height:O},o),s.r.copy(G,w,{x:0,y:W-O},{x:B+Q,y:V-O},{width:O,height:O},o),s.r.copy(G,w,{x:0,y:0},{x:B+Q,y:V+W},{width:O,height:O},o),s.r.copy(G,w,{x:Q-O,y:0},{x:B-O,y:V+W},{width:O,height:O},o)}this.dirty=!0}beginFrame(){for(const r in this.images)this.callbackDispatchedThisFrame[r]={}}dispatchRenderCallbacks(r,o){for(const p of r){if(this.callbackDispatchedThisFrame[o][p])continue;this.callbackDispatchedThisFrame[o][p]=!0;const _=this.images[o][p];St(_)&&this.updateImage(p,o,_)}}}function Wr(f){const r=f.key,o=f.value,p=f.valueSpec||{},_=f.objectElementValidators||{},x=f.style,w=f.styleSpec;let M=[];const P=s.H(o);if(P!=="object")return[new s.V(r,o,`object expected, ${P} found`)];for(const z in o){const O=z.split(".")[0];let B;_[O]?B=_[O]:p[O]?B=yi:_["*"]?B=_["*"]:p["*"]&&(B=yi),B?M=M.concat(B({key:(r&&`${r}.`)+z,value:o[z],valueSpec:p[O]||p["*"],style:x,styleSpec:w,object:o,objectKey:z},o)):M.push(new s.G(r,o[z],`unknown property "${z}"`))}for(const z in p)_[z]||p[z].required&&p[z].default===void 0&&o[z]===void 0&&M.push(new s.V(r,o,`missing required property "${z}"`));return M}function Ko(f){const r=f.value,o=f.valueSpec,p=f.style,_=f.styleSpec,x=f.key,w=f.arrayElementValidator||yi;if(s.H(r)!=="array")return[new s.V(x,r,`array expected, ${s.H(r)} found`)];if(o.length&&r.length!==o.length)return[new s.V(x,r,`array length ${o.length} expected, length ${r.length} found`)];if(o["min-length"]&&r.length<o["min-length"])return[new s.V(x,r,`array length at least ${o["min-length"]} expected, length ${r.length} found`)];let M={type:o.value,values:o.values,minimum:o.minimum,maximum:o.maximum,function:void 0};_.$version<7&&(M.function=o.function),s.H(o.value)==="object"&&(M=o.value);let P=[];for(let z=0;z<r.length;z++)P=P.concat(w({array:r,arrayIndex:z,value:r[z],valueSpec:M,style:p,styleSpec:_,key:`${x}[${z}]`},!0));return P}function Li(f){const r=f.key,o=f.value,p=f.valueSpec;let _=s.H(o);if(_==="number"&&o!=o&&(_="NaN"),_!=="number")return[new s.V(r,o,`number expected, ${_} found`)];if("minimum"in p){let x=p.minimum;if(s.H(p.minimum)==="array"&&(x=p.minimum[f.arrayIndex]),o<x)return[new s.V(r,o,`${o} is less than the minimum value ${x}`)]}if("maximum"in p){let x=p.maximum;if(s.H(p.maximum)==="array"&&(x=p.maximum[f.arrayIndex]),o>x)return[new s.V(r,o,`${o} is greater than the maximum value ${x}`)]}return[]}function vr(f){const r=f.valueSpec,o=s.K(f.value.type);let p,_,x,w={};const M=o!=="categorical"&&f.value.property===void 0,P=!M,z=s.H(f.value.stops)==="array"&&s.H(f.value.stops[0])==="array"&&s.H(f.value.stops[0][0])==="object",O=Wr({key:f.key,value:f.value,valueSpec:f.styleSpec.function,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{stops:function(G){if(o==="identity")return[new s.V(G.key,G.value,'identity function may not have a "stops" property')];let Q=[];const W=G.value;return Q=Q.concat(Ko({key:G.key,value:W,valueSpec:G.valueSpec,style:G.style,styleSpec:G.styleSpec,arrayElementValidator:B})),s.H(W)==="array"&&W.length===0&&Q.push(new s.V(G.key,W,"array must have at least one stop")),Q},default:function(G){return yi({key:G.key,value:G.value,valueSpec:r,style:G.style,styleSpec:G.styleSpec})}}});return o==="identity"&&M&&O.push(new s.V(f.key,f.value,'missing required property "property"')),o==="identity"||f.value.stops||O.push(new s.V(f.key,f.value,'missing required property "stops"')),o==="exponential"&&f.valueSpec.expression&&!s.L(f.valueSpec)&&O.push(new s.V(f.key,f.value,"exponential functions not supported")),f.styleSpec.$version>=8&&(P&&!s.M(f.valueSpec)?O.push(new s.V(f.key,f.value,"property functions not supported")):M&&!s.N(f.valueSpec)&&O.push(new s.V(f.key,f.value,"zoom functions not supported"))),o!=="categorical"&&!z||f.value.property!==void 0||O.push(new s.V(f.key,f.value,'"property" property is required')),O;function B(G){let Q=[];const W=G.value,te=G.key;if(s.H(W)!=="array")return[new s.V(te,W,`array expected, ${s.H(W)} found`)];if(W.length!==2)return[new s.V(te,W,`array length 2 expected, length ${W.length} found`)];if(z){if(s.H(W[0])!=="object")return[new s.V(te,W,`object expected, ${s.H(W[0])} found`)];if(W[0].zoom===void 0)return[new s.V(te,W,"object stop key must have zoom")];if(W[0].value===void 0)return[new s.V(te,W,"object stop key must have value")];const ee=s.K(W[0].zoom);if(typeof ee!="number")return[new s.V(te,W[0].zoom,"stop zoom values must be numbers")];if(x&&x>ee)return[new s.V(te,W[0].zoom,"stop zoom values must appear in ascending order")];ee!==x&&(x=ee,_=void 0,w={}),Q=Q.concat(Wr({key:`${te}[0]`,value:W[0],valueSpec:{zoom:{}},style:G.style,styleSpec:G.styleSpec,objectElementValidators:{zoom:Li,value:V}}))}else Q=Q.concat(V({key:`${te}[0]`,value:W[0],valueSpec:{},style:G.style,styleSpec:G.styleSpec},W));return s.O(s.Q(W[1]))?Q.concat([new s.V(`${te}[1]`,W[1],"expressions are not allowed in function stops.")]):Q.concat(yi({key:`${te}[1]`,value:W[1],valueSpec:r,style:G.style,styleSpec:G.styleSpec}))}function V(G,Q){const W=s.H(G.value),te=s.K(G.value),ee=G.value!==null?G.value:Q;if(p){if(W!==p)return[new s.V(G.key,ee,`${W} stop domain type must match previous stop domain type ${p}`)]}else p=W;if(W!=="number"&&W!=="string"&&W!=="boolean"&&typeof te!="number"&&typeof te!="string"&&typeof te!="boolean")return[new s.V(G.key,ee,"stop domain value must be a number, string, or boolean")];if(W!=="number"&&o!=="categorical"){let le=`number expected, ${W} found`;return s.M(r)&&o===void 0&&(le+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new s.V(G.key,ee,le)]}return o!=="categorical"||W!=="number"||typeof te=="number"&&isFinite(te)&&Math.floor(te)===te?o!=="categorical"&&W==="number"&&typeof te=="number"&&typeof _=="number"&&_!==void 0&&te<_?[new s.V(G.key,ee,"stop domain values must appear in ascending order")]:(_=te,o==="categorical"&&te in w?[new s.V(G.key,ee,"stop domain values must be unique")]:(w[te]=!0,[])):[new s.V(G.key,ee,`integer expected, found ${String(te)}`)]}}function Ds(f){const r=(f.expressionContext==="property"?s.S:s.U)(s.Q(f.value),f.valueSpec);if(r.result==="error")return r.value.map(p=>new s.V(`${f.key}${p.key}`,f.value,p.message));const o=r.value.expression||r.value._styleExpression.expression;if(f.expressionContext==="property"&&f.propertyKey==="text-font"&&!o.outputDefined())return[new s.V(f.key,f.value,`Invalid data expression for "${f.propertyKey}". Output values must be contained as literals within the expression.`)];if(f.expressionContext==="property"&&f.propertyType==="layout"&&!s.W(o))return[new s.V(f.key,f.value,'"feature-state" data expressions are not supported with layout properties.')];if(f.expressionContext==="filter")return Da(o,f);if(f.expressionContext&&f.expressionContext.indexOf("cluster")===0){if(!s.X(o,["zoom","feature-state"]))return[new s.V(f.key,f.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(f.expressionContext==="cluster-initial"&&!s.Y(o))return[new s.V(f.key,f.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Da(f,r){const o=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(r.valueSpec&&r.valueSpec.expression)for(const _ of r.valueSpec.expression.parameters)o.delete(_);if(o.size===0)return[];const p=[];return f instanceof s.Z&&o.has(f.name)?[new s.V(r.key,r.value,`["${f.name}"] expression is not supported in a filter for a ${r.object.type} layer with id: ${r.object.id}`)]:(f.eachChild(_=>{p.push(...Da(_,r))}),p)}function go(f){const r=f.key,o=f.value,p=f.valueSpec,_=[];return Array.isArray(p.values)?p.values.indexOf(s.K(o))===-1&&_.push(new s.V(r,o,`expected one of [${p.values.join(", ")}], ${JSON.stringify(o)} found`)):Object.keys(p.values).indexOf(s.K(o))===-1&&_.push(new s.V(r,o,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(o)} found`)),_}function Qo(f){return s.$(s.Q(f.value))?Ds(s.J({},f,{expressionContext:"filter",valueSpec:f.styleSpec[`filter_${f.layerType||"fill"}`]})):bi(f)}function bi(f){const r=f.value,o=f.key;if(s.H(r)!=="array")return[new s.V(o,r,`array expected, ${s.H(r)} found`)];const p=f.styleSpec;let _,x=[];if(r.length<1)return[new s.V(o,r,"filter array must have at least 1 element")];switch(x=x.concat(go({key:`${o}[0]`,value:r[0],valueSpec:p.filter_operator,style:f.style,styleSpec:f.styleSpec})),s.K(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&s.K(r[1])==="$type"&&x.push(new s.V(o,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":r.length!==3&&x.push(new s.V(o,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(_=s.H(r[1]),_!=="string"&&x.push(new s.V(`${o}[1]`,r[1],`string expected, ${_} found`)));for(let w=2;w<r.length;w++)_=s.H(r[w]),s.K(r[1])==="$type"?x=x.concat(go({key:`${o}[${w}]`,value:r[w],valueSpec:p.geometry_type,style:f.style,styleSpec:f.styleSpec})):_!=="string"&&_!=="number"&&_!=="boolean"&&x.push(new s.V(`${o}[${w}]`,r[w],`string, number, or boolean expected, ${_} found`));break;case"any":case"all":case"none":for(let w=1;w<r.length;w++)x=x.concat(bi({key:`${o}[${w}]`,value:r[w],style:f.style,styleSpec:f.styleSpec}));break;case"has":case"!has":_=s.H(r[1]),r.length!==2?x.push(new s.V(o,r,`filter array for "${r[0]}" operator must have 2 elements`)):_!=="string"&&x.push(new s.V(`${o}[1]`,r[1],`string expected, ${_} found`))}return x}function Ws(f,r){const o=f.key,p=f.style,_=f.layer,x=f.styleSpec,w=f.value,M=f.objectKey,P=x[`${r}_${f.layerType}`];if(!P)return[];const z=M.match(/^(.*)-use-theme$/);if(r==="paint"&&z&&P[z[1]])return s.O(w)?[].concat(yi({key:f.key,value:w,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:p,styleSpec:x,expressionContext:"property",propertyType:r,propertyKey:M})):yi({key:o,value:w,valueSpec:{type:"string"},style:p,styleSpec:x});const O=M.match(/^(.*)-transition$/);if(r==="paint"&&O&&P[O[1]]&&P[O[1]].transition)return yi({key:o,value:w,valueSpec:x.transition,style:p,styleSpec:x});const B=f.valueSpec||P[M];if(!B)return[new s.G(o,w,`unknown property "${M}"`)];let V;if(s.H(w)==="string"&&s.M(B)&&!B.tokens&&(V=/^{([^}]+)}$/.exec(w))){const Q=`\`{ "type": "identity", "property": ${V?JSON.stringify(V[1]):'"_"'} }\``;return[new s.V(o,w,`"${M}" does not support interpolation syntax
Use an identity property function instead: ${Q}.`)]}const G=[];if(f.layerType==="symbol")M!=="text-field"||!p||p.glyphs||p.imports||G.push(new s.V(o,w,'use of "text-field" requires a style "glyphs" property')),M==="text-font"&&s.a0(s.Q(w))&&s.K(w.type)==="identity"&&G.push(new s.V(o,w,'"text-font" does not support identity functions'));else if(f.layerType==="model"&&r==="paint"&&_&&_.layout&&_.layout.hasOwnProperty("model-id")&&s.M(B)&&(s.a1(B)||s.N(B))){const Q=s.S(s.Q(w),B),W=Q.value.expression||Q.value._styleExpression.expression;W&&!s.X(W,["measure-light"])&&(M==="model-emissive-strength"&&s.Y(W)&&s.W(W)||G.push(new s.V(o,w,`${M} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return G.concat(yi({key:f.key,value:w,valueSpec:B,style:p,styleSpec:x,expressionContext:"property",propertyType:r,propertyKey:M}))}function Ps(f){return Ws(f,"paint")}function Yn(f){return Ws(f,"layout")}function Sn(f){let r=[];const o=f.value,p=f.key,_=f.style,x=f.styleSpec;o.type||o.ref||r.push(new s.V(p,o,'either "type" or "ref" is required'));let w=s.K(o.type);const M=s.K(o.ref);if(o.id){const P=s.K(o.id);for(let z=0;z<f.arrayIndex;z++){const O=_.layers[z];s.K(O.id)===P&&r.push(new s.V(p,o.id,`duplicate layer id "${o.id}", previously used at line ${O.id.__line__}`))}}if("ref"in o){let P;["type","source","source-layer","filter","layout"].forEach(z=>{z in o&&r.push(new s.V(p,o[z],`"${z}" is prohibited for ref layers`))}),_.layers.forEach(z=>{s.K(z.id)===M&&(P=z)}),P?P.ref?r.push(new s.V(p,o.ref,"ref cannot reference another ref layer")):w=s.K(P.type):typeof M=="string"&&r.push(new s.V(p,o.ref,`ref layer "${M}" not found`))}else if(w!=="background"&&w!=="sky"&&w!=="slot")if(o.source){const P=_.sources&&_.sources[o.source],z=P&&s.K(P.type);P?z==="vector"&&w==="raster"?r.push(new s.V(p,o.source,`layer "${o.id}" requires a raster source`)):z==="raster"&&w!=="raster"?r.push(new s.V(p,o.source,`layer "${o.id}" requires a vector source`)):z!=="vector"||o["source-layer"]?z==="raster-dem"&&w!=="hillshade"?r.push(new s.V(p,o.source,"raster-dem source can only be used with layer type 'hillshade'.")):z!=="raster-array"||["raster","raster-particle"].includes(w)?w!=="line"||!o.paint||!o.paint["line-gradient"]&&!o.paint["line-trim-offset"]||z==="geojson"&&P.lineMetrics?w==="raster-particle"&&z!=="raster-array"&&r.push(new s.V(p,o.source,`layer "${o.id}" requires a 'raster-array' source.`)):r.push(new s.V(p,o,`layer "${o.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new s.V(p,o.source,"raster-array source can only be used with layer type 'raster'.")):r.push(new s.V(p,o,`layer "${o.id}" must specify a "source-layer"`)):r.push(new s.V(p,o.source,`source "${o.source}" not found`))}else r.push(new s.V(p,o,'missing required property "source"'));return r=r.concat(Wr({key:p,value:o,valueSpec:x.layer,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{"*":()=>[],type:()=>yi({key:`${p}.type`,value:o.type,valueSpec:x.layer.type,style:f.style,styleSpec:f.styleSpec,object:o,objectKey:"type"}),filter:P=>Qo(s.J({layerType:w},P)),layout:P=>Wr({layer:o,key:P.key,value:P.value,valueSpec:{},style:P.style,styleSpec:P.styleSpec,objectElementValidators:{"*":z=>Yn(s.J({layerType:w},z))}}),paint:P=>Wr({layer:o,key:P.key,value:P.value,valueSpec:{},style:P.style,styleSpec:P.styleSpec,objectElementValidators:{"*":z=>Ps(s.J({layerType:w,layer:o},z))}})}})),r}function Xs(f){const r=f.value,o=f.key,p=s.H(r);return p!=="string"?[new s.V(o,r,`string expected, ${p} found`)]:[]}const _o={promoteId:function f({key:r,value:o}){if(s.H(o)==="string")return Xs({key:r,value:o});if(Array.isArray(o)){const p=[],_=s.Q(o),x=s.U(_);return x.result==="error"&&x.value.forEach(w=>{p.push(new s.V(`${r}${w.key}`,null,`${w.message}`))}),s.X(x.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||p.push(new s.V(`${r}`,null,"promoteId expression should be only feature dependent")),p}{const p=[];for(const _ in o)p.push(...f({key:`${r}.${_}`,value:o[_]}));return p}}};function Jo(f){const r=f.value,o=f.key,p=f.styleSpec,_=f.style;if(!r.type)return[new s.V(o,r,'"type" is required')];const x=s.K(r.type);let w=[];switch(["vector","raster","raster-dem","raster-array"].includes(x)&&(r.url||r.tiles||w.push(new s.G(o,r,'Either "url" or "tiles" is required.'))),x){case"vector":case"raster":case"raster-dem":case"raster-array":return w=w.concat(Wr({key:o,value:r,valueSpec:p[`source_${x.replace("-","_")}`],style:f.style,styleSpec:p,objectElementValidators:_o})),w;case"geojson":if(w=Wr({key:o,value:r,valueSpec:p.source_geojson,style:_,styleSpec:p,objectElementValidators:_o}),r.cluster)for(const M in r.clusterProperties){const[P,z]=r.clusterProperties[M],O=typeof P=="string"?[P,["accumulated"],["get",M]]:P;w.push(...Ds({key:`${o}.${M}.map`,value:z,expressionContext:"cluster-map"})),w.push(...Ds({key:`${o}.${M}.reduce`,value:O,expressionContext:"cluster-reduce"}))}return w;case"video":return Wr({key:o,value:r,valueSpec:p.source_video,style:_,styleSpec:p});case"image":return Wr({key:o,value:r,valueSpec:p.source_image,style:_,styleSpec:p});case"canvas":return[new s.V(o,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return go({key:`${o}.type`,value:r.type,valueSpec:{values:Rl(p)},style:_,styleSpec:p})}}function Rl(f){return f.source.reduce((r,o)=>{const p=f[o];return p.type.type==="enum"&&(r=r.concat(Object.keys(p.type.values))),r},[])}function Ar(f){const r=f.value,o=f.styleSpec,p=o.light,_=f.style;let x=[];const w=s.H(r);if(r===void 0)return x;if(w!=="object")return x=x.concat([new s.V("light",r,`object expected, ${w} found`)]),x;for(const M in r){const P=M.match(/^(.*)-transition$/),z=M.match(/^(.*)-use-theme$/);x=x.concat(z&&p[z[1]]?yi({key:M,value:r[M],valueSpec:{type:"string"},style:_,styleSpec:o}):P&&p[P[1]]&&p[P[1]].transition?yi({key:M,value:r[M],valueSpec:o.transition,style:_,styleSpec:o}):p[M]?yi({key:M,value:r[M],valueSpec:p[M],style:_,styleSpec:o}):[new s.V(M,r[M],`unknown property "${M}"`)])}return x}function el(f){const r=f.value;let o=[];if(!r)return o;const p=s.H(r);if(p!=="object")return o=o.concat([new s.V("light-3d",r,`object expected, ${p} found`)]),o;const _=f.styleSpec,x=_["light-3d"],w=f.key,M=f.style,P=f.style.lights;for(const B of["type","id"])if(!(B in r))return o=o.concat([new s.V("light-3d",r,`missing property ${B} on light`)]),o;if(r.type&&P)for(let B=0;B<f.arrayIndex;B++){const V=s.K(r.type),G=P[B];s.K(G.type)===V&&o.push(new s.V(w,r.id,`duplicate light type "${r.type}", previously defined at line ${G.id.__line__}`))}const z=`properties_light_${r.type}`;if(!(z in _))return o=o.concat([new s.V("light-3d",r,`Invalid light type ${r.type}`)]),o;const O=_[z];for(const B in r)if(B==="properties"){const V=r[B],G=s.H(V);if(G!=="object")return o=o.concat([new s.V("properties",V,`object expected, ${G} found`)]),o;for(const Q in V)o=o.concat(O[Q]?yi({key:Q,value:V[Q],valueSpec:O[Q],style:M,styleSpec:_}):[new s.G(f.key,V[Q],`unknown property "${Q}"`)])}else{const V=B.match(/^(.*)-transition$/),G=B.match(/^(.*)-use-theme$/);o=o.concat(G&&x[G[1]]?yi({key:B,value:r[B],valueSpec:{type:"string"},style:M,styleSpec:_}):V&&x[V[1]]&&x[V[1]].transition?yi({key:B,value:r[B],valueSpec:_.transition,style:M,styleSpec:_}):x[B]?yi({key:B,value:r[B],valueSpec:x[B],style:M,styleSpec:_}):[new s.G(B,r[B],`unknown property "${B}"`)])}return o}function tl(f){const r=f.value,o=f.key,p=f.style,_=f.styleSpec,x=_.terrain;let w=[];const M=s.H(r);if(r===void 0||M==="null")return w;if(M!=="object")return w=w.concat([new s.V("terrain",r,`object expected, ${M} found`)]),w;for(const P in r){const z=P.match(/^(.*)-transition$/),O=P.match(/^(.*)-use-theme$/);w=w.concat(O&&x[O[1]]?yi({key:P,value:r[P],valueSpec:{type:"string"},style:p,styleSpec:_}):z&&x[z[1]]&&x[z[1]].transition?yi({key:P,value:r[P],valueSpec:_.transition,style:p,styleSpec:_}):x[P]?yi({key:P,value:r[P],valueSpec:x[P],style:p,styleSpec:_}):[new s.G(P,r[P],`unknown property "${P}"`)])}if(r.source){const P=p.sources&&p.sources[r.source],z=P&&s.K(P.type);P?z!=="raster-dem"&&w.push(new s.V(o,r.source,`terrain cannot be used with a source of type ${String(z)}, it only be used with a "raster-dem" source type`)):w.push(new s.V(o,r.source,`source "${r.source}" not found`))}else w.push(new s.V(o,r,'terrain is missing required property "source"'));return w}function as(f){const r=f.value,o=f.style,p=f.styleSpec,_=p.fog;let x=[];const w=s.H(r);if(r===void 0)return x;if(w!=="object")return x=x.concat([new s.V("fog",r,`object expected, ${w} found`)]),x;for(const M in r){const P=M.match(/^(.*)-transition$/),z=M.match(/^(.*)-use-theme$/);x=x.concat(z&&_[z[1]]?yi({key:M,value:r[M],valueSpec:{type:"string"},style:o,styleSpec:p}):P&&_[P[1]]&&_[P[1]].transition?yi({key:M,value:r[M],valueSpec:p.transition,style:o,styleSpec:p}):_[M]?yi({key:M,value:r[M],valueSpec:_[M],style:o,styleSpec:p}):[new s.G(M,r[M],`unknown property "${M}"`)])}return x}const il={"*":()=>[],array:Ko,boolean:function(f){const r=f.value,o=f.key,p=s.H(r);return p!=="boolean"?[new s.V(o,r,`boolean expected, ${p} found`)]:[]},number:Li,color:function(f){const r=f.key,o=f.value,p=s.H(o);return p!=="string"?[new s.V(r,o,`color expected, ${p} found`)]:s._.parseCSSColor(o)===null?[new s.V(r,o,`color expected, "${o}" found`)]:[]},enum:go,filter:Qo,function:vr,layer:Sn,object:Wr,source:Jo,model:s.a2,light:Ar,"light-3d":el,terrain:tl,fog:as,string:Xs,formatted:function(f){return Xs(f).length===0?[]:Ds(f)},resolvedImage:function(f){return Xs(f).length===0?[]:Ds(f)},projection:function(f){const r=f.value,o=f.styleSpec,p=o.projection,_=f.style;let x=[];const w=s.H(r);if(w==="object")for(const M in r)x=x.concat(yi({key:M,value:r[M],valueSpec:p[M],style:_,styleSpec:o}));else w!=="string"&&(x=x.concat([new s.V("projection",r,`object or string expected, ${w} found`)]));return x},import:function(f){const{value:r,styleSpec:o}=f,{data:p,..._}=r;Object.defineProperty(_,"__line__",{value:r.__line__,enumerable:!1});let x=Wr(s.J({},f,{value:_,valueSpec:o.import}));return s.K(_.id)===""&&x.push(new s.V(`${f.key}.id`,_,"import id can't be an empty string")),p&&(x=x.concat(gc(p,o,{key:`${f.key}.data`}))),x}};function yi(f,r=!1){const o=f.value,p=f.valueSpec,_=f.styleSpec;if(p.expression&&s.a0(s.K(o)))return vr(f);if(p.expression&&s.O(s.Q(o)))return Ds(f);if(p.type&&il[p.type]){const x=il[p.type](f);return r===!0&&x.length>0&&s.H(f.value)==="array"?Ds(f):x}return Wr(s.J({},f,{valueSpec:p.type?_[p.type]:p}))}function Ys(f){const r=f.value,o=f.key,p=Xs(f);return p.length||(r.indexOf("{fontstack}")===-1&&p.push(new s.V(o,r,'"glyphs" url must include a "{fontstack}" token')),r.indexOf("{range}")===-1&&p.push(new s.V(o,r,'"glyphs" url must include a "{range}" token'))),p}function gc(f,r=s.a3,o={}){return yi({key:o.key||"",value:f,valueSpec:r.$root,styleSpec:r,style:f,objectElementValidators:{glyphs:Ys,"*":()=>[]}})}function os(f,r=s.a3){return sr(gc(f,r))}const Ls=f=>sr(Jo(f)),yo=f=>sr(Ar(f)),vo=f=>sr(el(f)),Ks=f=>sr(tl(f)),_c=f=>sr(as(f)),Ha=f=>sr(function(r){const o=r.value,p=r.style,_=r.styleSpec,x=_.snow;let w=[];const M=s.H(o);if(o===void 0)return w;if(M!=="object")return w=w.concat([new s.V("snow",o,`object expected, ${M} found`)]),w;for(const P in o){const z=P.match(/^(.*)-transition$/);w=w.concat(z&&x[z[1]]&&x[z[1]].transition?yi({key:P,value:o[P],valueSpec:_.transition,style:p,styleSpec:_}):x[P]?yi({key:P,value:o[P],valueSpec:x[P],style:p,styleSpec:_}):[new s.G(P,o[P],`unknown property "${P}"`)])}return w}(f)),yc=f=>sr(function(r){const o=r.value,p=r.style,_=r.styleSpec,x=_.rain;let w=[];const M=s.H(o);if(o===void 0)return w;if(M!=="object")return w=w.concat([new s.V("rain",o,`object expected, ${M} found`)]),w;for(const P in o){const z=P.match(/^(.*)-transition$/);w=w.concat(z&&x[z[1]]&&x[z[1]].transition?yi({key:P,value:o[P],valueSpec:_.transition,style:p,styleSpec:_}):x[P]?yi({key:P,value:o[P],valueSpec:x[P],style:p,styleSpec:_}):[new s.G(P,o[P],`unknown property "${P}"`)])}return w}(f)),xo=f=>sr(Sn(f)),Kn=f=>sr(Qo(f)),Ir=f=>sr(Ps(f)),vc=f=>sr(Yn(f)),$a=f=>sr(s.a2(f));function sr(f){return f.slice().sort((r,o)=>r.line&&o.line?r.line-o.line:0)}function Pa(f,r){let o=!1;if(r&&r.length)for(const p of r)p instanceof s.G?s.w(p.message):(f.fire(new s.y(new Error(p.message))),o=!0);return o}let nt;class X extends s.E{constructor(r,o="flat"){super(),this._transitionable=new s.a4(nt||(nt=new s.a5({anchor:new s.a6(s.a3.light.anchor),position:new s.a7(s.a3.light.position),color:new s.a6(s.a3.light.color),intensity:new s.a6(s.a3.light.intensity)}))),this.setLight(r,o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,o,p={}){this._validate(yo,r,p)||(this._transitionable.setTransitionOrValue(r),this.id=o)}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,o,p){return(!p||p.validate!==!1)&&Pa(this,r.call(os,s.l({value:o,style:{glyphs:!0,sprite:!0},styleSpec:s.a3})))}}let ne=class extends s.E{constructor(f,r,o,p){super(),this.scope=o,this._transitionable=new s.a4(new s.a5({source:new s.a6(s.a3.terrain.source),exaggeration:new s.a6(s.a3.terrain.exaggeration)}),o,p),this._transitionable.setTransitionOrValue(f,p),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=r}get(){return this._transitionable.serialize()}set(f,r){this._transitionable.setTransitionOrValue(f,r)}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}getExaggeration(f){return this._transitioning.possiblyEvaluate(new s.a8(f)).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const f=this._transitionable._values.exaggeration;if(!f)return null;const r=f.value.expression;if(!r)return null;let o=-1,p=-1,_=1;for(const x of r.zoomStops)_=r.evaluate(new s.a8(x)),_>.01?(o=x,p=-1):p=x;return _<.01&&o>0&&p>o?[o,p]:null}isZoomDependent(){const f=this._transitionable._values.exaggeration;return f!=null&&f.value!=null&&f.value.expression!=null&&f.value.expression instanceof s.a9}};const oe=45,ye=65,ve=.05;function Le(f,r,o,p){const _=s.ac(oe,ye,o),[x,w]=Ge(f,p);let M=1-Math.min(1,Math.exp((r-x)/(w-x)*-6));return M*=M*M,M=Math.min(1,1.00747*M),M*_*f.alpha}function Ge(f,r){const o=.5/Math.tan(.5*r);return[f.range[0]+o,f.range[1]+o]}function Oe(f,r,o,p,_){const x=s.ab.vec3.transformMat4([],[r,o,p],_.mercatorFogMatrix);return Le(f,s.ab.vec3.length(x),_.pitch,_._fov)}function et(f,r,o,p,_,x,w){const M=[[o,p,0],[_,p,0],[_,x,0],[o,x,0]];let P=Number.MAX_VALUE,z=-Number.MAX_VALUE;for(const O of M){const B=s.ab.vec3.transformMat4([],O,r),V=s.ab.vec3.length(B);P=Math.min(P,V),z=Math.max(z,V)}return[Le(f,P,w.pitch,w._fov),Le(f,z,w.pitch,w._fov)]}class Je extends s.E{constructor(r,o,p,_){super();const x=new s.a5({range:new s.a6(s.a3.fog.range),color:new s.a6(s.a3.fog.color),"color-use-theme":new s.a6({type:"string","property-type":"data-constant",default:"default"}),"high-color":new s.a6(s.a3.fog["high-color"]),"high-color-use-theme":new s.a6({type:"string","property-type":"data-constant",default:"default"}),"space-color":new s.a6(s.a3.fog["space-color"]),"space-color-use-theme":new s.a6({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new s.a6(s.a3.fog["horizon-blend"]),"star-intensity":new s.a6(s.a3.fog["star-intensity"]),"vertical-range":new s.a6(s.a3.fog["vertical-range"])});this._transitionable=new s.a4(x,p,new Map(_)),this.set(r,_),this._transitioning=this._transitionable.untransitioned(),this._transform=o,this.properties=new s.ad(x),this.scope=p}get state(){const r=this._transform,o=r.projection.name==="globe",p=s.ae(r.zoom),_=this.properties.get("range"),x=[.5,3];return{range:o?[s.af(x[0],_[0],p),s.af(x[1],_[1],p)]:_,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(r,o,p={}){if(this._validate(_c,r,p))return;const _=s.l({},r);for(const x of Object.keys(s.a3.fog))_[x]===void 0&&(_[x]=s.a3.fog[x].default);this._options=_,this._transitionable.setTransitionOrValue(this._options,o)}getOpacity(r){if(!this._transform.projection.supportsFog)return 0;const o=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:s.ac(oe,ye,r))*o.a}getOpacityAtLatLng(r,o){return this._transform.projection.supportsFog?function(p,_,x){const w=s.aa.fromLngLat(_),M=x.elevation?x.elevation.getAtPointOrZero(w):0;return Oe(p,w.x,w.y,M,x)}(this.state,r,o):0}getOpacityForTile(r){if(!this._transform.projection.supportsFog)return[1,1];const o=this._transform.calculateFogTileMatrix(r.toUnwrapped());return et(this.state,o,0,0,s.ag,s.ag,this._transform)}getOpacityForBounds(r,o,p,_,x){return this._transform.projection.supportsFog?et(this.state,r,o,p,_,x,this._transform):[1,1]}getFovAdjustedRange(r){return this._transform.projection.supportsFog?Ge(this.state,r):[0,1]}isVisibleOnFrustum(r){if(!this._transform.projection.supportsFog)return!1;const o=[4,5,6,7];for(const p of o){const _=r.points[p];let x;if(_[2]>=0)x=_;else{const w=r.points[p-4];x=s.ah(w,_,w[2]/(w[2]-_[2]))}if(Oe(this.state,x[0],x[1],0,this._transform)>=ve)return!0}return!1}updateConfig(r){this._transitionable.setTransitionOrValue(this._options,new Map(r))}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,o,p){return(!p||p.validate!==!1)&&Pa(this,r.call(os,s.l({value:o,style:{glyphs:!0,sprite:!0},styleSpec:s.a3})))}}let tt,mt,At,Rt,Jt=class extends s.E{constructor(f,r,o,p){super();const _=tt||(tt=new s.a5({density:new s.a6(s.a3.snow.density),intensity:new s.a6(s.a3.snow.intensity),color:new s.a6(s.a3.snow.color),opacity:new s.a6(s.a3.snow.opacity),vignette:new s.a6(s.a3.snow.vignette),"vignette-color":new s.a6(s.a3.snow["vignette-color"]),"center-thinning":new s.a6(s.a3.snow["center-thinning"]),direction:new s.a6(s.a3.snow.direction),"flake-size":new s.a6(s.a3.snow["flake-size"])}));this._transitionable=new s.a4(_,o,new Map(p)),this.set(f,p),this._transitioning=this._transitionable.untransitioned(),this.properties=new s.ad(_),this.scope=o}get state(){const f=this.properties.get("opacity"),r=this.properties.get("color"),o=this.properties.get("direction"),p=s.ai(o[0]),_=-Math.max(s.ai(o[1]),.01),x=[Math.cos(p)*Math.cos(_),Math.sin(p)*Math.cos(_),Math.sin(_)],w=this.properties.get("vignette"),M=this.properties.get("vignette-color");return M.a=w,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new s.aj(r.r,r.g,r.b,r.a*f),direction:x,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:M}}get(){return this._transitionable.serialize()}set(f,r,o={}){if(this._validate(Ha,f,o))return;const p=s.l({},f);for(const _ of Object.keys(s.a3.snow))p[_]===void 0&&(p[_]=s.a3.snow[_].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,r)}updateConfig(f){this._transitionable.setTransitionOrValue(this._options,new Map(f))}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}_validate(f,r,o){return(!o||o.validate!==!1)&&Pa(this,f.call(os,s.l({value:r,style:{glyphs:!0,sprite:!0},styleSpec:s.a3})))}},si=class extends s.E{constructor(f,r,o,p){super();const _=mt||(mt=new s.a5({density:new s.a6(s.a3.rain.density),intensity:new s.a6(s.a3.rain.intensity),color:new s.a6(s.a3.rain.color),opacity:new s.a6(s.a3.rain.opacity),vignette:new s.a6(s.a3.rain.vignette),"vignette-color":new s.a6(s.a3.rain["vignette-color"]),"center-thinning":new s.a6(s.a3.rain["center-thinning"]),direction:new s.a6(s.a3.rain.direction),"droplet-size":new s.a6(s.a3.rain["droplet-size"]),"distortion-strength":new s.a6(s.a3.rain["distortion-strength"])}));this._transitionable=new s.a4(_,o,new Map(p)),this.set(f,p),this._transitioning=this._transitionable.untransitioned(),this.properties=new s.ad(_),this.scope=o}get state(){const f=this.properties.get("opacity"),r=this.properties.get("color"),o=this.properties.get("direction"),p=s.ai(o[0]),_=-Math.max(s.ai(o[1]),.01),x=[Math.cos(p)*Math.cos(_),Math.sin(p)*Math.cos(_),Math.sin(_)],w=this.properties.get("vignette-color");return w.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new s.aj(r.r,r.g,r.b,r.a*f),direction:x,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:w}}get(){return this._transitionable.serialize()}set(f,r,o={}){if(this._validate(yc,f,o))return;const p=s.l({},f);for(const _ of Object.keys(s.a3.rain))p[_]===void 0&&(p[_]=s.a3.rain[_].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,r)}updateConfig(f){this._transitionable.setTransitionOrValue(this._options,new Map(f))}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}_validate(f,r,o){return(!o||o.validate!==!1)&&Pa(this,f.call(os,s.l({value:r,style:{glyphs:!0,sprite:!0},styleSpec:s.a3})))}};class ci extends s.E{constructor(r,o,p,_){super(),this.scope=p,this._options=r,this.properties=new s.ad(o),this._transitionable=new s.a4(o,p,new Map(_)),this._transitionable.setTransitionOrValue(r.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(r){this._transitionable.setTransitionOrValue(this._options.properties,new Map(r))}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(r,o){this._options=r,this._transitionable.setTransitionOrValue(r.properties,o)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class ii{constructor(r,o,p,_){this.screenBounds=r,this.cameraPoint=o,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=p,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,_)}static createFromScreenPoints(r,o){let p,_;if(r instanceof s.P||typeof r[0]=="number"){const x=s.P.convert(r);p=[x],_=o.isPointAboveHorizon(x)}else{const x=s.P.convert(r[0]),w=s.P.convert(r[1]);p=[x,w],_=s.al(x,w).every(M=>o.isPointAboveHorizon(M))}return new ii(p,o.getCameraPoint(),_,o)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(r){return s.al(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],r)}bufferedCameraGeometry(r){const o=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],_=s.al(o,p,0,!1);return this.cameraPoint.y>p.y&&(this.cameraPoint.x>o.x&&this.cameraPoint.x<p.x?_.splice(3,0,this.cameraPoint):this.cameraPoint.x>=p.x?_[2]=this.cameraPoint:this.cameraPoint.x<=o.x&&(_[3]=this.cameraPoint)),s.am(_,r)}bufferedCameraGeometryGlobe(r){const o=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],_=s.al(o,p,r),x=this.cameraPoint.clone();switch(3*((x.y>o.y)+(x.y>p.y))+((x.x>o.x)+(x.x>p.x))){case 0:_[0]=x,_[4]=x.clone();break;case 1:_.splice(1,0,x);break;case 2:_[1]=x;break;case 3:_.splice(4,0,x);break;case 5:_.splice(2,0,x);break;case 6:_[3]=x;break;case 7:_.splice(3,0,x);break;case 8:_[2]=x}return _}containsTile(r,o,p,_=0){const x=r.queryPadding/o._pixelsPerMercatorPixel+1,w=p?this._bufferedCameraMercator(x,o):this._bufferedScreenMercator(x,o);let M=r.tileID.wrap+(w.unwrapped?_:0);const P=w.polygon.map(te=>s.an(r.tileTransform,te,M));if(!s.ao(P,0,0,s.ag,s.ag))return;M=r.tileID.wrap+(this.screenGeometryMercator.unwrapped?_:0);const z=this.screenGeometryMercator.polygon.map(te=>s.ap(r.tileTransform,te,M)),O=z.map(te=>new s.P(te[0],te[1])),B=o.getFreeCameraOptions().position||new s.aa(0,0,0),V=s.ap(r.tileTransform,B,M),G=z.map(te=>{const ee=s.ab.vec3.sub(te,te,V);return s.ab.vec3.normalize(ee,ee),new s.aq(V,ee)}),Q=s.ar(r,1,o.zoom)*o._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:O,tilespaceRays:G,bufferedTilespaceGeometry:P,bufferedTilespaceBounds:(W=s.as(P),W.min.x=s.aw(W.min.x,0,s.ag),W.min.y=s.aw(W.min.y,0,s.ag),W.max.x=s.aw(W.max.x,0,s.ag),W.max.y=s.aw(W.max.y,0,s.ag),W),tile:r,tileID:r.tileID,pixelToTileUnitsFactor:Q};var W}_bufferedScreenMercator(r,o){const p=wi(r);if(this._screenRaycastCache[p])return this._screenRaycastCache[p];{let _;return _=o.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(r),o):{polygon:this.bufferedScreenGeometry(r).map(x=>o.pointCoordinate3D(x)),unwrapped:!0},this._screenRaycastCache[p]=_,_}}_bufferedCameraMercator(r,o){const p=wi(r);if(this._cameraRaycastCache[p])return this._cameraRaycastCache[p];{let _;return _=o.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(r),o):{polygon:this.bufferedCameraGeometry(r).map(x=>o.pointCoordinate3D(x)),unwrapped:!0},this._cameraRaycastCache[p]=_,_}}_projectAndResample(r,o){const p=function(x,w){const M=s.ab.mat4.multiply([],w.pixelMatrix,w.globeMatrix),P=[0,-s.ax,0,1],z=[0,s.ax,0,1],O=[0,0,0,1];s.ab.vec4.transformMat4(P,P,M),s.ab.vec4.transformMat4(z,z,M),s.ab.vec4.transformMat4(O,O,M);const B=new s.P(P[0]/P[3],P[1]/P[3]),V=new s.P(z[0]/z[3],z[1]/z[3]),G=s.au(x,B)&&P[3]<O[3],Q=s.au(x,V)&&z[3]<O[3];if(!G&&!Q)return null;const W=function(xe,ge,Re){for(let Fe=1;Fe<xe.length;Fe++){const rt=Ii(ge.pointCoordinate3D(xe[Fe-1]).x),Ke=Ii(ge.pointCoordinate3D(xe[Fe]).x);if(Re<0){if(rt<Ke)return{idx:Fe,t:-rt/(Ke-1-rt)}}else if(Ke<rt)return{idx:Fe,t:(1-rt)/(Ke+1-rt)}}return null}(x,w,G?-1:1);if(!W)return null;const{idx:te,t:ee}=W;let le=te>1?Si(x.slice(0,te),w):[],pe=te<x.length?Si(x.slice(te),w):[];le=le.map(xe=>new s.P(Ii(xe.x),xe.y)),pe=pe.map(xe=>new s.P(Ii(xe.x),xe.y));const fe=[...le];fe.length===0&&fe.push(pe[pe.length-1]);const Te=s.af(fe[fe.length-1].y,(pe.length===0?le[0]:pe[0]).y,ee);let _e;return _e=G?[new s.P(0,Te),new s.P(0,0),new s.P(1,0),new s.P(1,Te)]:[new s.P(1,Te),new s.P(1,1),new s.P(0,1),new s.P(0,Te)],fe.push(..._e),pe.length===0?fe.push(le[0]):fe.push(...pe),{polygon:fe.map(xe=>new s.aa(xe.x,xe.y)),unwrapped:!1}}(r,o);if(p)return p;const _=function(x,w){let M=!1,P=-1/0,z=0;for(let B=0;B<x.length-1;B++)x[B].x>P&&(P=x[B].x,z=B);for(let B=0;B<x.length-1;B++){const V=(z+B)%(x.length-1),G=x[V],Q=x[V+1];Math.abs(G.x-Q.x)>.5&&(G.x<Q.x?(G.x+=1,V===0&&(x[x.length-1].x+=1)):(Q.x+=1,V+1===x.length-1&&(x[0].x+=1)),M=!0)}const O=s.at(w.center.lng);return M&&O<Math.abs(O-1)&&x.forEach(B=>{B.x-=1}),{polygon:x,unwrapped:M}}(Si(r,o).map(x=>new s.P(Ii(x.x),x.y)),o);return{polygon:_.polygon.map(x=>new s.aa(x.x,x.y)),unwrapped:_.unwrapped}}}function Si(f,r){return s.av(f,o=>{const p=r.pointCoordinate3D(o);o.x=p.x,o.y=p.y},1/256)}function Ii(f){return f<0?1+f%1:f%1}function wi(f){return 100*f|0}function Vi(f,r,o,p,_){const x=function(M,P){if(M)return _(M);if(P){if(f.url&&P.tiles&&f.tiles&&delete f.tiles,P.variants){if(!Array.isArray(P.variants))return _(new Error("variants must be an array"));for(const O of P.variants){if(O==null||typeof O!="object"||O.constructor!==Object)return _(new Error("variant must be an object"));if(!Array.isArray(O.capabilities))return _(new Error("capabilities must be an array"));if(O.capabilities.length===1&&O.capabilities[0]==="meshopt"){P=s.l(P,O);break}}}const z=s.ay(s.l({},P,f),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);z.tiles=r.canonicalizeTileset(z,f.url),_(null,z)}},w=function(M,P,z){if(!M)return null;if(!P&&!z)return M;z=z||M.worldview_default;const O=Object.values(M.language||{});if(O.length===0)return null;const B=Object.values(M.worldview||{});if(B.length===0)return null;const V=O.every(Q=>Q===P),G=B.every(Q=>Q===z);return V&&G?M:P in(M.language_options||{})||z in(M.worldview_options||{})?null:M.language_options&&M.worldview_options?M:null}(f.data,o,p);return w?s.q.frame(()=>x(null,w)):f.url?s.n(r.transformRequest(r.normalizeSourceURL(f.url,null,o,p),s.R.Source),x):s.q.frame(()=>{const{data:M,...P}=f;x(null,P)})}class Ui{constructor(r,o,p){this.bounds=s.az.convert(this.validateBounds(r)),this.minzoom=o||0,this.maxzoom=p||24}validateBounds(r){return Array.isArray(r)&&r.length===4?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}contains(r){const o=Math.pow(2,r.z),p=Math.floor(s.at(this.bounds.getWest())*o),_=Math.floor(s.aA(this.bounds.getNorth())*o),x=Math.ceil(s.at(this.bounds.getEast())*o),w=Math.ceil(s.aA(this.bounds.getSouth())*o);return r.x>=p&&r.x<x&&r.y>=_&&r.y<w}}class Un extends s.E{constructor(r,o,p,_){if(super(),this.id=r,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.l(this,s.ay(o,["url","scheme","tileSize","promoteId"])),this._options=s.l({type:"vector"},o),this._collectResourceTiming=!!o.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_),this._tileWorkers={},this._deduped=new s.aB}load(r){this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"}));const o=Array.isArray(this.map._language)?this.map._language.join():this.map._language,p=this.map.getWorldview();this._tileJSONRequest=Vi(this._options,this.map._requestManager,o,p,(_,x)=>{if(this._tileJSONRequest=null,this._loaded=!0,_)o&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${o}`),p&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${p}`),this.fire(new s.y(_));else if(x){if(s.l(this,x),this.hasWorldviews=!!x.worldview_options,x.worldview_default&&(this.worldviewDefault=x.worldview_default),x.vector_layers){this.vectorLayers=x.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const w of x.vector_layers)this.vectorLayerIds.push(w.id),x.worldview&&x.worldview[w.source]&&this.localizableLayerIds.add(w.id)}x.bounds&&(this.tileBounds=new Ui(x.bounds,this.minzoom,this.maxzoom)),Wi(x.tiles,this.map._requestManager._customAccessToken),this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))}r&&r(_)})}loaded(){return this._loaded}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest();const r=s.aC(this.id,this.scope);this.load(()=>this.map.style.clearSource(r))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(r){this.cancelTileJSONRequest()}serialize(){return s.l({},this._options)}loadTile(r,o){const p=r.tileID.canonical.url(this.tiles,this.scheme),_=this.map._requestManager.normalizeTileURL(p),x=this.map._requestManager.transformRequest(_,s.R.Tile),w=this.map.style?this.map.style.getLut(this.scope):null,M=w?{image:w.image.clone()}:null,P={request:x,data:void 0,uid:r.uid,tileID:r.tileID,tileZoom:r.tileZoom,zoom:r.tileID.overscaledZ,maxZoom:this.maxzoom,lut:M,tileSize:this.tileSize*r.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:s.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:r.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:r.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor()};if(this.hasWorldviews&&s.f(p)&&(P.worldview=this.map.getWorldview()||this.worldviewDefault,P.localizableLayerIds=this.localizableLayerIds),P.request.collectResourceTiming=this._collectResourceTiming,r.actor&&r.state!=="expired")r.state==="loading"?r.reloadCallback=o:r.request=r.actor.send("reloadTile",P,z.bind(this));else if(r.actor=this._tileWorkers[_]=this._tileWorkers[_]||this.dispatcher.getActor(),this.dispatcher.ready)r.request=r.actor.send("loadTile",P,z.bind(this),void 0,!0);else{const O=s.aD.call({deduped:this._deduped},P,(B,V)=>{B||!V?z.call(this,B):(P.data={cacheControl:V.cacheControl,expires:V.expires,rawData:V.rawData.slice(0)},r.actor&&r.actor.send("loadTile",P,z.bind(this),void 0,!0))},!0);r.request={cancel:O}}function z(O,B){return delete r.request,r.aborted?o(null):O&&O.status!==404?o(O):(B&&B.resourceTiming&&(r.resourceTiming=B.resourceTiming),this.map._refreshExpiredTiles&&B&&r.setExpiryData(B),r.loadVectorData(B,this.map.painter),s.aE(this.dispatcher),o(null),void(r.reloadCallback&&(this.loadTile(r,r.reloadCallback),r.reloadCallback=null)))}}abortTile(r){r.request&&(r.request.cancel(),delete r.request),r.actor&&r.actor.send("abortTile",{uid:r.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(r,o){r.actor&&r.actor.send("removeTile",{uid:r.uid,type:this.type,source:this.id,scope:this.scope}),r.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class ma extends s.E{constructor(r,o,p,_){super(),this.id=r,this.dispatcher=p,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.l({type:"raster"},o),s.l(this,s.ay(o,["url","scheme","tileSize"]))}load(r){this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"})),this._tileJSONRequest=Vi(this._options,this.map._requestManager,null,null,(o,p)=>{this._tileJSONRequest=null,this._loaded=!0,o?this.fire(new s.y(o)):p&&(s.l(this,p),p.raster_layers&&(this.rasterLayers=p.raster_layers,this.rasterLayerIds=this.rasterLayers.map(_=>_.id)),p.bounds&&(this.tileBounds=new Ui(p.bounds,this.minzoom,this.maxzoom)),Wi(p.tiles),this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))),r&&r(o)})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest();const r=s.aC(this.id,this.scope);this.load(()=>this.map.style.clearSource(r))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(r){this.cancelTileJSONRequest()}serialize(){return s.l({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r,o){const p=s.q.devicePixelRatio>=2,_=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),p,this.tileSize);r.request=s.o(this.map._requestManager.transformRequest(_,s.R.Tile),(x,w,M,P)=>(delete r.request,r.aborted?(r.state="unloaded",o(null)):x?(r.state="errored",o(x)):w?(this.map._refreshExpiredTiles&&r.setExpiryData({cacheControl:M,expires:P}),r.setTexture(w,this.map.painter),r.state="loaded",s.aE(this.dispatcher),void o(null)):o(null)))}abortTile(r,o){r.request&&(r.request.cancel(),delete r.request),o&&o()}unloadTile(r,o){r.texture&&r.texture instanceof s.T?(r.destroy(!0),r.texture&&r.texture instanceof s.T&&this.map.painter.saveTileTexture(r.texture)):r.destroy(),o&&o()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class qn extends ma{constructor(r,o,p,_){super(r,o,p,_),this.type="raster-array",this.maxzoom=22,this._options=s.l({type:"raster-array"},o)}triggerRepaint(r){const o=this.map.painter._terrain,p=this.map.style.getSourceCache(this.id);o&&o.enabled&&p&&o._clearRenderCacheForTile(p.id,r.tileID),this.map.triggerRepaint()}loadTile(r,o){const p=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),_=this.map._requestManager.transformRequest(p,s.R.Tile);r.requestParams=_,r.actor||(r.actor=this.dispatcher.getActor()),r.request=r.fetchHeader(void 0,(x,w,M,P)=>{if(delete r.request,r.aborted)return r.state="unloaded",o(null);if(x)return x.code===20?void 0:(r.state="errored",o(x));this.map._refreshExpiredTiles&&r.setExpiryData({cacheControl:M,expires:P}),r.state="empty",o(null)})}unloadTile(r,o){const p=r.texture;p&&p instanceof s.T?(r.destroy(!0),this.map.painter.saveTileTexture(p)):(r.destroy(),r.flushQueues(),r._isHeaderLoaded=!1,delete r._mrt,delete r.textureDescriptor),r.fbo&&(r.fbo.destroy(),delete r.fbo),delete r.request,delete r.requestParams,delete r.neighboringTiles,r.state="unloaded"}prepareTile(r,o,p){r._isHeaderLoaded&&(r.state!=="empty"&&(r.state="reloading"),r.fetchBand(o,p,(_,x)=>{if(_)return r.state="errored",this.fire(new s.y(_)),void this.triggerRepaint(r);x&&(r.setTexture(x,this.map.painter),r.state="loaded",this.triggerRepaint(r))}))}getInitialBand(r){if(!this.rasterLayers)return 0;const o=this.rasterLayers.find(({id:x})=>x===r),p=o&&o.fields,_=p&&p.bands&&p.bands;return _?_[0]:0}getTextureDescriptor(r,o,p){if(!r)return;const _=o.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!_)return;let x=null;o instanceof s.aH?x=o.paint.get("raster-array-band"):o instanceof s.aI&&(x=o.paint.get("raster-particle-array-band"));const w=x||this.getInitialBand(_);if(w!=null)if(r.textureDescriptor){if(!r.updateNeeded(_,w)||p)return Object.assign({},r.textureDescriptor,{texture:r.texture})}else this.prepareTile(r,_,w)}}const Qn={vector:Un,raster:ma,"raster-dem":class extends ma{constructor(f,r,o,p){super(f,r,o,p),this.type="raster-dem",this.maxzoom=22,this._options=s.l({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}loadTile(f,r){const o=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function p(_,x){_&&(f.state="errored",r(_)),x&&(f.dem=x,f.dem.onDeserialize(),f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0,f.state="loaded",r(null))}f.request=s.o(this.map._requestManager.transformRequest(o,s.R.Tile),(function(_,x,w,M){if(delete f.request,f.aborted)f.state="unloaded",r(null);else if(_)f.state="errored",r(_);else if(x){this.map._refreshExpiredTiles&&f.setExpiryData({cacheControl:w,expires:M});const P=ImageBitmap&&x instanceof ImageBitmap&&s.t(),z=1-(x.width-s.aF(x.width))/2;z<1||f.neighboringTiles||(f.neighboringTiles=this._getNeighboringTiles(f.tileID));const O=P?x:s.q.getImageData(x,z),B={uid:f.uid,coord:f.tileID,source:this.id,scope:this.scope,rawImageData:O,encoding:this.encoding,padding:z};f.actor&&f.state!=="expired"||(f.actor=this.dispatcher.getActor(),f.actor.send("loadDEMTile",B,p.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(f){const r=f.canonical,o=Math.pow(2,r.z),p=(r.x-1+o)%o,_=r.x===0?f.wrap-1:f.wrap,x=(r.x+1+o)%o,w=r.x+1===o?f.wrap+1:f.wrap,M={};return M[new s.aG(f.overscaledZ,_,r.z,p,r.y).key]={backfilled:!1},M[new s.aG(f.overscaledZ,w,r.z,x,r.y).key]={backfilled:!1},r.y>0&&(M[new s.aG(f.overscaledZ,_,r.z,p,r.y-1).key]={backfilled:!1},M[new s.aG(f.overscaledZ,f.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},M[new s.aG(f.overscaledZ,w,r.z,x,r.y-1).key]={backfilled:!1}),r.y+1<o&&(M[new s.aG(f.overscaledZ,_,r.z,p,r.y+1).key]={backfilled:!1},M[new s.aG(f.overscaledZ,f.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},M[new s.aG(f.overscaledZ,w,r.z,x,r.y+1).key]={backfilled:!1}),M}},"raster-array":qn,geojson:class extends s.E{constructor(f,r,o,p){super(),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=o.getActor(),this.setEventedParent(p),this._data=r.data,this._options=s.l({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.minzoom!==void 0&&(this.minzoom=r.minzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;const _=s.ag/this.tileSize;this.workerOptions=s.l({source:this.id,scope:this.scope,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(r.buffer!==void 0?r.buffer:128)*_,tolerance:(r.tolerance!==void 0?r.tolerance:.375)*_,extent:s.ag,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:r.clusterMaxZoom!==void 0?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:s.ag,radius:(r.clusterRadius!==void 0?r.clusterRadius:50)*_,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter,dynamic:r.dynamic},r.workerOptions)}onAdd(f){this.map=f,this.setData(this._data)}setData(f){return this._data=f,this._updateWorkerData(),this}updateData(f){if(!this._options.dynamic)return this.fire(new s.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof f!="string"&&(f.type==="Feature"&&(f={type:"FeatureCollection",features:[f]}),f.type!=="FeatureCollection"))return this.fire(new s.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof f!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const r=new Map;for(const o of this._data.features)r.set(o.id,o);for(const o of f.features)r.set(o.id,o);this._data.features=[...r.values()]}else this._data=f;return this._updateWorkerData(!0),this}getClusterExpansionZoom(f,r){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id,scope:this.scope},r),this}getClusterChildren(f,r){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id,scope:this.scope},r),this}getClusterLeaves(f,r,o,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:f,limit:r,offset:o},p),this}_updateWorkerData(f=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.z("dataloading",{dataType:"source"})),this._loaded=!1;const r=s.l({append:f},this.workerOptions);r.scope=this.scope;const o=this._data;typeof o=="string"?(r.request=this.map._requestManager.transformRequest(s.q.resolveURL(o),s.R.Source),r.request.collectResourceTiming=this._collectResourceTiming):r.data=JSON.stringify(o),this._pendingLoad=this.actor.send(`${this.type}.loadData`,r,(p,_)=>{if(this._loaded=!0,this._pendingLoad=null,p)this.fire(new s.y(p));else{const x={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&_&&_.resourceTiming&&_.resourceTiming[this.id]&&(x.resourceTiming=_.resourceTiming[this.id]),f&&(this._partialReload=!0),this.fire(new s.z("data",x)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(f),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const f=s.aC(this.id,this.scope);this.map.style.clearSource(f),this._updateWorkerData()}loadTile(f,r){const o=f.actor?"reloadTile":"loadTile";f.actor=this.actor;const p=this.map.style?this.map.style.getLut(this.scope):null,_=p?{image:p.image.clone()}:null,x=this._partialReload,w={type:this.type,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:_,scope:this.scope,pixelRatio:s.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,scaleFactor:this.map.getScaleFactor(),partial:x};f.request=this.actor.send(o,w,(M,P)=>x&&!P?(f.state="loaded",r(null)):(delete f.request,f.destroy(),f.aborted?r(null):M?r(M):(f.loadVectorData(P,this.map.painter,o==="reloadTile"),r(null))),void 0,o==="loadTile")}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0}unloadTile(f,r){this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id,scope:this.scope}),f.destroy()}onRemove(f){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return s.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends s.aJ{constructor(f,r,o,p){super(f,r,o,p),this.roundZoom=!0,this.type="video",this.options=r}load(){this._loaded=!1;const f=this.options;this.urls=[];for(const r of f.urls)this.urls.push(this.map._requestManager.transformRequest(r,s.R.Source).url);s.aK(this.urls,(r,o)=>{this._loaded=!0,r?this.fire(new s.y(r)):o&&(this.video=o,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(f){if(this.video){const r=this.video.seekable;f<r.start(0)||f>r.end(0)?this.fire(new s.y(new s.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=f}}getVideo(){return this.video}onAdd(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const f=this.map.painter.context,r=f.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new s.T(f,this.video,r.RGBA8),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(f)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:s.aJ,model:class extends s.E{constructor(f,r,o,p){super(),this.id=f,this.type="model",this.models=[],this._loaded=!1,this._options=r}load(){const f=[];for(const r in this._options.models){const o=this._options.models[r],p=s.aM(this.map._requestManager.transformRequest(o.uri,s.R.Model).url).then(_=>{if(!_)return;const x=s.aN(_),w=new s.aO(r,o.position,o.orientation,x);w.computeBoundsAndApplyParent(),this.models.push(w)}).catch(_=>{this.fire(new s.y(new Error(`Could not load model ${r} from ${o.uri}: ${_.message}`)))});f.push(p)}return Promise.allSettled(f).then(()=>{this._loaded=!0,this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(r=>{this.fire(new s.y(new Error(`Could not load models: ${r.message}`)))})}onAdd(f){this.map=f,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(f,r){}serialize(){return{type:"model"}}},"batched-model":class extends s.E{constructor(f,r,o,p){super(),this.type="batched-model",this.id=f,this.tileSize=512,this._options=r,this.tiles=this._options.tiles,this.maxzoom=r.maxzoom||19,this.minzoom=r.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=o,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(p)}onAdd(f){this.map=f,this.load()}reload(){this.cancelTileJSONRequest();const f=s.aC(this.id,this.scope);this.load(()=>this.map.style.clearSource(f))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(f){this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"}));const r=Array.isArray(this.map._language)?this.map._language.join():this.map._language,o=this.map.getWorldview();this._tileJSONRequest=Vi(this._options,this.map._requestManager,r,o,(p,_)=>{this._tileJSONRequest=null,this._loaded=!0,p?(r&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${r}`),o&&o.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${o}`),this.fire(new s.y(p))):_&&(s.l(this,_),_.bounds&&(this.tileBounds=new Ui(_.bounds,this.minzoom,this.maxzoom)),Wi(_.tiles,this.map._requestManager._customAccessToken),this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))),f&&f(p)})}hasTransition(){return!1}hasTile(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)}loaded(){return this._loaded}loadTile(f,r){const o=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme)),p={request:this.map._requestManager.transformRequest(o,s.R.Tile),data:void 0,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,tileSize:this.tileSize*f.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:f.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,lut:null,maxZoom:null,promoteId:null,pixelRatio:null,scaleFactor:null};if(f.actor&&f.state!=="expired")if(f.state==="loading")f.reloadCallback=r;else{if(f.buckets){const x=Object.values(f.buckets);for(const w of x)w.dirty=!0;return void(f.state="loaded")}f.request=f.actor.send("reloadTile",p,_.bind(this))}else f.actor=this.dispatcher.getActor(),f.request=f.actor.send("loadTile",p,_.bind(this),void 0,!0);function _(x,w){return f.aborted?r(null):x&&x.status!==404?r(x):(this.map._refreshExpiredTiles&&w&&f.setExpiryData(w),f.loadModelData(w,this.map.painter),f.state="loaded",void r(null))}}serialize(){return s.l({},this._options)}},canvas:class extends s.aJ{constructor(f,r,o,p){super(f,r,o,p),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some(_=>!Array.isArray(_)||_.length!==2||_.some(x=>typeof x!="number"))||this.fire(new s.y(new s.V(`sources.${f}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.y(new s.V(`sources.${f}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new s.y(new s.V(`sources.${f}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof HTMLCanvasElement||this.fire(new s.y(new s.V(`sources.${f}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.y(new s.V(`sources.${f}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()}onRemove(f){this.pause()}prepare(){let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const r=this.map.painter.context;this.texture?!f&&!this._playing||this.texture instanceof s.aL||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.T(r,this.canvas,r.gl.RGBA8,{premultiply:!0}),this._prepareData(r)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const f of[this.canvas.width,this.canvas.height])if(isNaN(f)||f<=0)return!0;return!1}},custom:class extends s.E{constructor(f,r,o,p){super(),this.id=f,this.type="custom",this._dataType="raster",this._dispatcher=o,this._implementation=r,this.setEventedParent(p),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new s.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new s.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Ui(this._implementation.bounds,this.minzoom,this.maxzoom)),r.update=this._update.bind(this),r.clearTiles=this._clearTiles.bind(this),r.coveringTiles=this._coveringTiles.bind(this),s.l(this,s.ay(r,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return s.ay(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(f){this.map=f,this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(f),this.load()}onRemove(f){this._implementation.onRemove&&this._implementation.onRemove(f)}hasTile(f){if(this._implementation.hasTile){const{x:r,y:o,z:p}=f.canonical;return this._implementation.hasTile({x:r,y:o,z:p})}return!this.tileBounds||this.tileBounds.contains(f.canonical)}loadTile(f,r){const{x:o,y:p,z:_}=f.tileID.canonical,x=new AbortController;f.request=Promise.resolve(this._implementation.loadTile({x:o,y:p,z:_},{signal:x.signal})).then((function(w){return delete f.request,f.aborted?(f.state="unloaded",r(null)):w===void 0?(f.state="errored",r(null)):w===null?(this.loadTileData(f,{width:this.tileSize,height:this.tileSize,data:null}),f.state="loaded",r(null)):function(M){return M instanceof ImageData||M instanceof HTMLCanvasElement||M instanceof ImageBitmap||M instanceof HTMLImageElement}(w)?(this.loadTileData(f,w),f.state="loaded",void r(null)):(f.state="errored",r(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(w=>{w.code!==20&&(f.state="errored",r(w))}),f.request.cancel=()=>x.abort()}loadTileData(f,r){f.setTexture(r,this.map.painter)}unloadTile(f,r){if(f.texture&&f.texture instanceof s.T?(f.destroy(!0),f.texture&&f.texture instanceof s.T&&this.map.painter.saveTileTexture(f.texture)):f.destroy(),this._implementation.unloadTile){const{x:o,y:p,z:_}=f.tileID.canonical;this._implementation.unloadTile({x:o,y:p,z:_})}r&&r()}abortTile(f,r){f.request&&f.request.cancel&&(f.request.cancel(),delete f.request),r&&r()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(f=>({x:f.canonical.x,y:f.canonical.y,z:f.canonical.z}))}_clearTiles(){const f=s.aC(this.id,this.scope);this.map.style.clearSource(f)}_update(){this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))}}},Ur=function(f,r,o,p){const _=new Qn[r.type](f,r,o,p);if(_.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${_.id}`);return s.aP(["load","abort","unload","serialize","prepare"],_),_};function Dl(f,r,o=""){return`${o}:${r.id||""}:${r.layer.id}:${function(p){if("layerId"in p)return`layer:${p.layerId}`;{const{featuresetId:_,importId:x}=p;return`featureset:${_}${x?`:import:${x}`:""}`}}(f.target)}`}function Za(f,r,o,p=""){if(f.uniqueFeatureID){const _=Dl(f,r,p);if(o.has(_))return!0;o.add(_)}return!1}function xc(f,r,o,p,_=!1){const x=r.sourceCache.transform,w=r.sourceCache.tilesIn(f,r.has3DLayers,_);w.sort(od);const M=[];for(const P of w){const z=P.tile.queryRenderedFeatures(r,P,o,p,x,_);Object.keys(z).length&&M.push({wrappedTileID:P.tile.tileID.wrapped().key,queryResults:z})}return M.length===0?{}:function(P){const z={},O={};for(const B of P){const V=B.queryResults,G=B.wrappedTileID,Q=O[G]=O[G]||{};for(const W in V){const te=V[W],ee=Q[W]=Q[W]||{},le=z[W]=z[W]||[];for(const pe of te)ee[pe.featureIndex]||(ee[pe.featureIndex]=!0,le.push(pe))}}return z}(M)}function Eu(f,r,o,p,_){const x={},w=p.queryRenderedSymbols(f),M=[];for(const P of Object.keys(w).map(Number))M.push(_[P]);M.sort(od);for(const P of M){const z=P.featureIndex.lookupSymbolFeatures(w[P.bucketInstanceId],P.bucketIndex,P.sourceLayerIndex,r,o);for(const O in z){const B=x[O]=x[O]||[],V=z[O];V.sort((G,Q)=>{const W=P.featureSortOrder;if(W){const te=W.indexOf(G.featureIndex);return W.indexOf(Q.featureIndex)-te}return Q.featureIndex-G.featureIndex});for(const G of V)B.push(G)}}return x}function ad(f,r){const o=f.getRenderableIds().map(x=>f.getTileByID(x)),p=[],_={};for(let x=0;x<o.length;x++){const w=o[x],M=w.tileID.canonical.key;_[M]||(_[M]=!0,w.querySourceFeatures(p,r))}return p}function od(f,r){const o=f.tileID,p=r.tileID;return o.overscaledZ-p.overscaledZ||o.canonical.y-p.canonical.y||o.wrap-p.wrap||o.canonical.x-p.canonical.x}function Wa(f,r){const o={};if(!r)return o;for(const p of f){const _=p.layerIds.map(x=>r.getLayer(x)).filter(Boolean);if(_.length!==0){p.layers=_,p.stateDependentLayerIds&&(p.stateDependentLayers=p.stateDependentLayerIds.map(x=>_.filter(w=>w.id===x)[0]));for(const x of _)o[x.fqid]=p}}return o}const Gn=32,vs=33,Qs=new Uint16Array(8184);for(let f=0;f<2046;f++){let r=f+2,o=0,p=0,_=0,x=0,w=0,M=0;for(1&r?_=x=w=Gn:o=p=M=Gn;(r>>=1)>1;){const z=o+_>>1,O=p+x>>1;1&r?(_=o,x=p,o=w,p=M):(o=_,p=x,_=w,x=M),w=z,M=O}const P=4*f;Qs[P+0]=o,Qs[P+1]=p,Qs[P+2]=_,Qs[P+3]=x}const ga=new Uint16Array(2178),an=new Uint8Array(1089),zs=new Uint16Array(1089);function bo(f){return f===0?-.03125:f===32?.03125:0}const nl=(()=>({type:2,extent:s.ag,loadGeometry:()=>[[new s.P(0,0),new s.P(s.ag+1,0),new s.P(s.ag+1,s.ag+1),new s.P(0,s.ag+1),new s.P(0,0)]]}))();class wo{constructor(r,o,p,_,x){this.tileID=r,this.uid=s.aV(),this.uses=0,this.tileSize=o,this.tileZoom=p,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=x,_&&_.style&&(this._lastUpdatedBrightness=_.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",_&&_.transform&&(this.projection=_.transform.projection)}registerFadeDuration(r){const o=r+this.timeAdded;o<s.q.now()||this.fadeEndTime&&o<this.fadeEndTime||(this.fadeEndTime=o)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=s.aQ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(r,o,p){if(this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=Wa(r.buckets,o.style),this.hasSymbolBuckets=!1;for(const _ in this.buckets){const x=this.buckets[_];if(x instanceof s.aX){if(this.hasSymbolBuckets=!0,!p)break;x.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const _ in this.buckets){const x=this.buckets[_];if(x instanceof s.aX&&x.hasRTLText){this.hasRTLText=!0,s.aY();break}}this.queryPadding=0;for(const _ in this.buckets){const x=this.buckets[_],w=o.style.getOwnLayer(_);if(!w)continue;const M=w.queryRadius(x);this.queryPadding=Math.max(this.queryPadding,M)}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage),r.lineAtlas&&(this.lineAtlas=r.lineAtlas),this._lastUpdatedBrightness=r.brightness}else this.collisionBoxArray=new s.aW}unloadVectorData(){if(this.hasData()){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(r,o,p){r&&(r.resourceTiming&&(this.resourceTiming=r.resourceTiming),this.buckets=Object.assign({},this.buckets,Wa(r.buckets,o.style)),r.featureIndex&&(this.latestFeatureIndex=r.featureIndex))}getBucket(r){return this.buckets[r.fqid]}upload(r){for(const _ in this.buckets){const x=this.buckets[_];x.uploadPending()&&x.upload(r)}const o=r.gl,p=this.imageAtlas;if(p&&!p.uploaded){const _=!!Object.keys(p.patternPositions).length;this.imageAtlasTexture=new s.T(r,p.image,o.RGBA8,{useMipmap:_}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new s.T(r,this.glyphAtlasImage,o.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new s.T(r,this.lineAtlas.image,o.R8),this.lineAtlas.uploaded=!0)}prepare(r,o,p){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture,p),!o||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const _=o.style.getBrightness();(this._lastUpdatedBrightness||_)&&(this._lastUpdatedBrightness&&_&&Math.abs(this._lastUpdatedBrightness-_)<.001||(this.updateBuckets(o,this._lastUpdatedBrightness!==_),this._lastUpdatedBrightness=_))}queryRenderedFeatures(r,o,p,_,x,w){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const M=function(P,z){const O=s.ab.mat4.fromScaling([],[.5*P.width,.5*-P.height,1]);return s.ab.mat4.translate(O,O,[1,-1,0]),s.ab.mat4.multiply(O,O,P.calculateProjMatrix(z.toUnwrapped())),Float32Array.from(O)}(x,this.tileID);return this.latestFeatureIndex.query(r,{tilespaceGeometry:o,pixelPosMatrix:M,transform:_,availableImages:p,tileTransform:this.tileTransform})}querySourceFeatures(r,o){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const _=p.loadVTLayers(),x=o?o.sourceLayer:"",w=_._geojsonTileLayer||_[x];if(!w)return;const M=s.aZ(o&&o.filter),{z:P,x:z,y:O}=this.tileID.canonical,B={z:P,x:z,y:O};for(let V=0;V<w.length;V++){const G=w.feature(V);if(M.needGeometry){const te=s.a_(G,!0);if(!M.filter(new s.a8(this.tileID.overscaledZ),te,this.tileID.canonical))continue}else if(!M.filter(new s.a8(this.tileID.overscaledZ),G))continue;const Q=p.getId(G,x),W=new s.a$(G,P,z,O,Q);W.tile=B,r.push(W)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(r){const o=this.expirationTime;if(r.cacheControl){const p=s.b0(r.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){const p=Date.now();let _=!1;if(this.expirationTime>p)_=!1;else if(o)if(this.expirationTime<o)_=!0;else{const x=this.expirationTime-o;x?this.expirationTime=p+Math.max(x,3e4):_=!0}else _=!0;_?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(r){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&r&&this.updateBuckets(r)}updateBuckets(r,o){if(!this.latestFeatureIndex||!r.style)return;const p=this.latestFeatureIndex.loadVTLayers(),_=r.style.listImages(),x=r.style.getBrightness();for(const w in this.buckets){if(!r.style.hasLayer(w))continue;const M=this.buckets[w],P=M.layers[0],z=P.sourceLayer||"_geojsonTileLayer",O=p[z],B=r.style.getLayerSourceCache(P);let V={};B&&(V=B._state.getState(z,void 0));const G=this.imageAtlas&&this.imageAtlas.patternPositions||{},Q=Object.keys(V).length>0&&!o;Q&&!M.stateDependentLayers.length&&!o||M.update(V,O,_,G,Q?M.stateDependentLayers:M.layers,o,x),(M instanceof s.b1||M instanceof s.b2)&&r._terrain&&r._terrain.enabled&&B&&M.programConfigurations.needsUpload&&r._terrain._clearRenderCacheForTile(B.id,this.tileID);const W=r&&r.style&&r.style.getOwnLayer(w);W&&(this.queryPadding=Math.max(this.queryPadding,W.queryRadius(M)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<s.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(r){this.symbolFadeHoldUntil=s.q.now()+r}setTexture(r,o){const p=o.context,_=p.gl;this.texture=this.texture||o.getTileTexture(r.width),this.texture&&this.texture instanceof s.T?this.texture.update(r):(this.texture=new s.T(p,r,_.RGBA8,{useMipmap:!0}),this.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE))}setDependencies(r,o){const p={};for(const _ of o)p[_]=!0;this.dependencies[r]=p}hasDependency(r,o){for(const p of r){const _=this.dependencies[p];if(_){for(const x of o)if(_[x])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(r,o){if(!o||o.name==="mercator"||this._tileDebugBuffer)return;const p=s.b3(nl,this.tileID.canonical,this.tileTransform)[0],_=new s.b4,x=new s.b5;for(let w=0;w<p.length;w++){const{x:M,y:P}=p[w];_.emplaceBack(M,P),x.emplaceBack(w)}x.emplaceBack(0),this._tileDebugIndexBuffer=r.createIndexBuffer(x),this._tileDebugBuffer=r.createVertexBuffer(_,s.b6.members),this._tileDebugSegments=s.b7.simpleSegment(0,0,_.length,x.length)}_makeTileBoundsBuffers(r,o){if(this._tileBoundsBuffer||!o||o.name==="mercator")return;const p=s.b3(nl,this.tileID.canonical,this.tileTransform)[0];let _,x;if(this.isRaster){const w=function(M,P){const z=s.aQ(M,P),O=Math.pow(2,M.z);for(let te=0;te<vs;te++)for(let ee=0;ee<vs;ee++){const le=s.aR((M.x+(ee+bo(ee))/Gn)/O),pe=s.aS((M.y+(te+bo(te))/Gn)/O),fe=P.project(le,pe),Te=te*vs+ee;ga[2*Te+0]=Math.round((fe.x*z.scale-z.x)*s.ag),ga[2*Te+1]=Math.round((fe.y*z.scale-z.y)*s.ag)}an.fill(0),zs.fill(0);for(let te=2045;te>=0;te--){const ee=4*te,le=Qs[ee+0],pe=Qs[ee+1],fe=Qs[ee+2],Te=Qs[ee+3],_e=le+fe>>1,xe=pe+Te>>1,ge=_e+xe-pe,Re=xe+le-_e,Fe=pe*vs+le,rt=Te*vs+fe,Ke=xe*vs+_e,ht=Math.hypot((ga[2*Fe+0]+ga[2*rt+0])/2-ga[2*Ke+0],(ga[2*Fe+1]+ga[2*rt+1])/2-ga[2*Ke+1])>=16;an[Ke]=an[Ke]||(ht?1:0),te<1022&&(an[Ke]=an[Ke]||an[(pe+Re>>1)*vs+(le+ge>>1)]||an[(Te+Re>>1)*vs+(fe+ge>>1)])}const B=new s.aT,V=new s.aU;let G=0;function Q(te,ee){const le=ee*vs+te;return zs[le]===0&&(B.emplaceBack(ga[2*le+0],ga[2*le+1],te*s.ag/Gn,ee*s.ag/Gn),zs[le]=++G),zs[le]-1}function W(te,ee,le,pe,fe,Te){const _e=te+le>>1,xe=ee+pe>>1;if(Math.abs(te-fe)+Math.abs(ee-Te)>1&&an[xe*vs+_e])W(fe,Te,te,ee,_e,xe),W(le,pe,fe,Te,_e,xe);else{const ge=Q(te,ee),Re=Q(le,pe),Fe=Q(fe,Te);V.emplaceBack(ge,Re,Fe)}}return W(0,0,Gn,Gn,Gn,0),W(Gn,Gn,0,0,0,Gn),{vertices:B,indices:V}}(this.tileID.canonical,o);_=w.vertices,x=w.indices}else{_=new s.aT,x=new s.aU;for(const{x:M,y:P}of p)_.emplaceBack(M,P,0,0);const w=s.b8(_.int16,void 0,4);for(let M=0;M<w.length;M+=3)x.emplaceBack(w[M],w[M+1],w[M+2])}this._tileBoundsBuffer=r.createVertexBuffer(_,s.b9.members),this._tileBoundsIndexBuffer=r.createIndexBuffer(x),this._tileBoundsSegments=s.b7.simpleSegment(0,0,_.length,x.length)}_makeGlobeTileDebugBuffers(r,o){const p=o.projection;if(!p||p.name!=="globe"||o.freezeTileCoverage)return;const _=this.tileID.canonical,x=s.ba(_,o),w=s.bb(x),M=s.ae(o.zoom);let P;M>0&&(P=s.ab.mat4.invert(new Float64Array(16),o.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(r,_,o,w,P,M),this._makeGlobeTileDebugTextBuffer(r,_,o,w,P,M)}_globePoint(r,o,p,_,x,w,M){let P=s.bc(r,o,p);if(w){const z=1<<p.z,O=s.at(_.center.lng),B=s.aA(_.center.lat),V=(p.x+.5)/z-O;let G=0;V>.5?G=-1:V<-.5&&(G=1);let Q=(r/s.ag+p.x)/z+G,W=(o/s.ag+p.y)/z;Q=(Q-O)*_._pixelsPerMercatorPixel+O,W=(W-B)*_._pixelsPerMercatorPixel+B;const te=[Q*_.worldSize,W*_.worldSize,0];s.ab.vec3.transformMat4(te,te,w),P=s.bd(P,te,M)}return s.ab.vec3.transformMat4(P,P,x)}_makeGlobeTileDebugBorderBuffer(r,o,p,_,x,w){const M=new s.b4,P=new s.b5,z=new s.be,O=(V,G,Q,W,te)=>{const ee=(Q-V)/(te-1),le=(W-G)/(te-1),pe=M.length;for(let fe=0;fe<te;fe++){const Te=V+fe*ee,_e=G+fe*le;M.emplaceBack(Te,_e);const xe=this._globePoint(Te,_e,o,p,_,x,w);z.emplaceBack(xe[0],xe[1],xe[2]),P.emplaceBack(pe+fe)}},B=s.ag;O(0,0,B,0,16),O(B,0,B,B,16),O(B,B,0,B,16),O(0,B,0,0,16),this._tileDebugIndexBuffer=r.createIndexBuffer(P),this._tileDebugBuffer=r.createVertexBuffer(M,s.b6.members),this._globeTileDebugBorderBuffer=r.createVertexBuffer(z,s.bf.members),this._tileDebugSegments=s.b7.simpleSegment(0,0,M.length,P.length)}_makeGlobeTileDebugTextBuffer(r,o,p,_,x,w){const M=s.ag/4,P=new s.b4,z=new s.aU,O=new s.be,B=25;z.reserve(32),P.reserve(B),O.reserve(B);const V=(G,Q)=>B*G+Q;for(let G=0;G<B;G++){const Q=G*M;for(let W=0;W<B;W++){const te=W*M;P.emplaceBack(te,Q);const ee=this._globePoint(te,Q,o,p,_,x,w);O.emplaceBack(ee[0],ee[1],ee[2])}}for(let G=0;G<4;G++)for(let Q=0;Q<4;Q++){const W=V(G,Q),te=V(G,Q+1),ee=V(G+1,Q),le=V(G+1,Q+1);z.emplaceBack(W,te,ee),z.emplaceBack(ee,te,le)}this._tileDebugTextIndexBuffer=r.createIndexBuffer(z),this._tileDebugTextBuffer=r.createVertexBuffer(P,s.b6.members),this._globeTileDebugTextBuffer=r.createVertexBuffer(O,s.bf.members),this._tileDebugTextSegments=s.b7.simpleSegment(0,0,B,32)}destroy(r=!1){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!r&&this.texture&&this.texture instanceof s.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}s.bg.setPbf(s.bh);class Xa extends wo{constructor(r,o,p,_,x){super(r,o,p,_,x),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(r,o){const p=o.context,_=p.gl;this.texture=this.texture||o.getTileTexture(r.width),this.texture&&this.texture instanceof s.T?this.texture.update(r,{premultiply:!1}):this.texture=new s.T(p,r,_.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(r=16384,o){const p=this._mrt=new s.bg(30),_=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(r-1)}});return this.entireBuffer=null,this.request=s.bi(_,(x,w,M,P)=>{if(x)o(x);else try{const z=p.getHeaderLength(w);if(z>r)return void(this.request=this.fetchHeader(z,o));p.parseHeader(w),this._isHeaderLoaded=!0;let O=0;for(const B of Object.values(p.layers))O=Math.max(O,B.dataIndex[B.dataIndex.length-1].last_byte);w.byteLength>=O&&(this.entireBuffer=w),o(null,this.entireBuffer||w,M,P)}catch(z){o(z)}}),this.request}fetchBand(r,o,p){const _=this._mrt;if(!this._isHeaderLoaded||!_)return void p(new Error("Tile header is not ready"));const x=this.actor;if(!x)return void p(new Error("Can't fetch tile band without an actor"));let w;const M=(B,V)=>{w.complete(B,V),B?p(B):(this.updateTextureDescriptor(r,o),p(null,this.textureDescriptor&&this.textureDescriptor.img))},P=(B,V)=>{if(B)return p(B);const G=x.send("decodeRasterArray",{buffer:V,task:w},M,void 0,!0);this._workQueue.push(()=>{G&&G.cancel(),w.cancel()})},z=_.getLayer(r);if(!z)return void p(new Error(`Unknown sourceLayer "${r}"`));if(z.hasDataForBand(o))return this.updateTextureDescriptor(r,o),void p(null,this.textureDescriptor?this.textureDescriptor.img:null);const O=z.getDataRange([o]);if(w=_.createDecodingTask(O),!w||w.tasks.length)if(this.flushQueues(),this.entireBuffer)P(null,this.entireBuffer.slice(O.firstByte,O.lastByte+1));else{const B=Object.assign({},this.requestParams,{headers:{Range:`bytes=${O.firstByte}-${O.lastByte}`}}),V=s.bi(B,P);this._fetchQueue.push(()=>{V.cancel(),w.cancel()})}else p(null)}updateNeeded(r,o){return(!this.textureDescriptor||this.textureDescriptor.band!==o||this.textureDescriptor.layer!==r)&&this.state!=="errored"}updateTextureDescriptor(r,o){if(!this._mrt)return;const p=this._mrt.getLayer(r);if(!p||!p.hasBand(o)||!p.hasDataForBand(o))return;const{bytes:_,tileSize:x,buffer:w,offset:M,scale:P}=p.getBandView(o),z=x+2*w,O={data:_,width:z,height:z},B=this.texture;B&&B instanceof s.T&&B.update(O,{premultiply:!1}),this.textureDescriptor={layer:r,band:o,img:O,buffer:w,offset:M,tileSize:x,format:p.pixelFormat,mix:[P,256*P,65536*P,16777216*P]}}}class Ff{constructor(r,o){this.max=r,this.onRemove=o,this.reset()}reset(){for(const r in this.data)for(const o of this.data[r])o.timeout&&clearTimeout(o.timeout),this.onRemove(o.value);return this.data={},this.order=[],this}add(r,o,p){const _=r.wrapped().key;this.data[_]===void 0&&(this.data[_]=[]);const x={value:o,timeout:void 0};if(p!==void 0&&(x.timeout=setTimeout(()=>{this.remove(r,x)},p)),this.data[_].push(x),this.order.push(_),this.order.length>this.max){const w=this._getAndRemoveByKey(this.order[0]);w&&this.onRemove(w)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){const o=this.data[r].shift();return o.timeout&&clearTimeout(o.timeout),this.data[r].length===0&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),o.value}getByKey(r){const o=this.data[r];return o?o[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,o){if(!this.has(r))return this;const p=r.wrapped().key,_=o===void 0?0:this.data[p].indexOf(o),x=this.data[p][_];return this.data[p].splice(_,1),x.timeout&&clearTimeout(x.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(x.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){const o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}filter(r){const o=[];for(const p in this.data)for(const _ of this.data[p])r(_.value)||o.push(_);for(const p of o)this.remove(p.value.tileID,p)}}class ld{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(r,o,p){const _=String(o);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][_]=this.stateChanges[r][_]||{},s.l(this.stateChanges[r][_],p),this.deletedStates[r]===null){this.deletedStates[r]={};for(const x in this.state[r])x!==_&&(this.deletedStates[r][x]=null)}else if(this.deletedStates[r]&&this.deletedStates[r][_]===null){this.deletedStates[r][_]={};for(const x in this.state[r][_])p[x]||(this.deletedStates[r][_][x]=null)}else for(const x in p)this.deletedStates[r]&&this.deletedStates[r][_]&&this.deletedStates[r][_][x]===null&&delete this.deletedStates[r][_][x]}removeFeatureState(r,o,p){if(this.deletedStates[r]===null)return;const _=String(o);if(this.deletedStates[r]=this.deletedStates[r]||{},p&&o!==void 0)this.deletedStates[r][_]!==null&&(this.deletedStates[r][_]=this.deletedStates[r][_]||{},this.deletedStates[r][_][p]=null);else if(o!==void 0)if(this.stateChanges[r]&&this.stateChanges[r][_])for(p in this.deletedStates[r][_]={},this.stateChanges[r][_])this.deletedStates[r][_][p]=null;else this.deletedStates[r][_]=null;else this.deletedStates[r]=null}getState(r,o){const p=this.state[r]||{},_=this.stateChanges[r]||{},x=this.deletedStates[r];if(x===null)return{};if(o!==void 0){const M=String(o),P=s.l({},p[M],_[M]);if(x){const z=x[o];if(z===null)return{};for(const O in z)delete P[O]}return P}const w=s.l({},p,_);if(x)for(const M in x)delete w[M];return w}initializeTileState(r,o){r.refreshFeatureState(o)}coalesceChanges(r,o){const p={};for(const _ in this.stateChanges){this.state[_]=this.state[_]||{};const x={};for(const w in this.stateChanges[_])this.state[_][w]||(this.state[_][w]={}),s.l(this.state[_][w],this.stateChanges[_][w]),x[w]=this.state[_][w];p[_]=x}for(const _ in this.deletedStates){this.state[_]=this.state[_]||{};const x={};if(this.deletedStates[_]===null)for(const w in this.state[_])x[w]={},this.state[_][w]={};else for(const w in this.deletedStates[_]){if(this.deletedStates[_][w]===null)this.state[_][w]={};else if(this.state[_][w])for(const M of Object.keys(this.deletedStates[_][w]))delete this.state[_][w][M];x[w]=this.state[_][w]}p[_]=p[_]||{},s.l(p[_],x)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(const _ in r)r[_].refreshFeatureState(o)}}class Js extends s.E{constructor(r,o,p){super(),this.id=r,this._onlySymbols=p,o.on("data",_=>{_.dataType==="source"&&_.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&_.dataType==="source"&&_.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),o.on("error",()=>{this._sourceErrored=!0}),this._source=o,this._tiles={},this._cache=new Ff(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=o.minTileCacheSize,this._maxTileCacheSize=o.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new ld,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(r){this.map=r,this._minTileCacheSize=this._minTileCacheSize===void 0&&r?r._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&r?r._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const r in this._tiles){const o=this._tiles[r];if(o.state!=="loaded"&&o.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(r,o){return r.isSymbolTile=this._onlySymbols,r.isExtraShadowCaster=this._shadowCasterTiles[r.tileID.key],this._source.loadTile(r,o)}_unloadTile(r){if(this._source.unloadTile)return this._source.unloadTile(r)}_abortTile(r){if(this._source.abortTile)return this._source.abortTile(r)}serialize(){return this._source.serialize()}prepare(r){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const o in this._tiles){const p=this._tiles[o];p.upload(r),p.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return s.bj(this._tiles).map(r=>r.tileID).sort($i).map(r=>r.key)}getRenderableIds(r,o){const p=[];for(const _ in this._tiles)this._isIdRenderable(+_,r,o)&&p.push(this._tiles[_]);return r?p.sort((_,x)=>{const w=_.tileID,M=x.tileID,P=new s.P(w.canonical.x,w.canonical.y)._rotate(this.transform.angle),z=new s.P(M.canonical.x,M.canonical.y)._rotate(this.transform.angle);return w.overscaledZ-M.overscaledZ||z.y-P.y||z.x-P.x}).map(_=>_.tileID.key):p.map(_=>_.tileID).sort($i).map(_=>_.key)}hasRenderableParent(r){const o=this.findLoadedParent(r,0);return!!o&&this._isIdRenderable(o.tileID.key)}_isIdRenderable(r,o,p){return this._tiles[r]&&this._tiles[r].hasData()&&!this._coveredTiles[r]&&(o||!this._tiles[r].holdingForFade())&&(p||!this._shadowCasterTiles[r])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)this._tiles[r].state!=="errored"&&this._reloadTile(+r,"reloading")}}_reloadTile(r,o){const p=this._tiles[r];p&&(p.state!=="loading"&&(p.state=o),this._loadTile(p,this._tileLoaded.bind(this,p,r,o)))}_tileLoaded(r,o,p,_){if(_)if(r.state="errored",_.status!==404)this._source.fire(new s.y(_,{tile:r}));else{if(this._source.fire(new s.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:r})),!(r.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const x=this.map.painter.terrain;this.update(this.transform,x.getScaledDemTileSize(),!0),x.resetTileLookupCache(this.id)}else this.update(this.transform)}else r.timeAdded=s.q.now(),p==="expired"&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(o,r),this._source.type==="raster-dem"&&r.dem&&this._backfillDEM(r),this._state.initializeTileState(r,this.map?this.map.painter:null),this._source.fire(new s.z("data",{dataType:"source",tile:r,coord:r.tileID,sourceCacheId:this.id}))}_backfillDEM(r){const o=this.getRenderableIds();for(let _=0;_<o.length;_++){const x=o[_];if(r.neighboringTiles&&r.neighboringTiles[x]){const w=this.getTileByID(x);p(r,w),p(w,r)}}function p(_,x){if(!_.dem||_.dem.borderReady)return;_.needsHillshadePrepare=!0,_.needsDEMTextureUpload=!0;let w=x.tileID.canonical.x-_.tileID.canonical.x;const M=x.tileID.canonical.y-_.tileID.canonical.y,P=Math.pow(2,_.tileID.canonical.z),z=x.tileID.key;w===0&&M===0||Math.abs(M)>1||(Math.abs(w)>1&&(Math.abs(w+P)===1?w+=P:Math.abs(w-P)===1&&(w-=P)),x.dem&&_.dem&&(_.dem.backfillBorder(x.dem,w,M),_.neighboringTiles&&_.neighboringTiles[z]&&(_.neighboringTiles[z].backfilled=!0)))}}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._tiles[r]}_retainLoadedChildren(r,o,p,_){for(const x in this._tiles){let w=this._tiles[x];if(_[x]||!w.hasData()||w.tileID.overscaledZ<=o||w.tileID.overscaledZ>p)continue;let M=w.tileID;for(;w&&w.tileID.overscaledZ>o+1;){const z=w.tileID.scaledTo(w.tileID.overscaledZ-1);w=this._tiles[z.key],w&&w.hasData()&&(M=z)}let P=M;for(;P.overscaledZ>o;)if(P=P.scaledTo(P.overscaledZ-1),r[P.key]){_[M.key]=M;break}}}findLoadedParent(r,o){if(r.key in this._loadedParentTiles){const p=this._loadedParentTiles[r.key];return p&&p.tileID.overscaledZ>=o?p:null}for(let p=r.overscaledZ-1;p>=o;p--){const _=r.scaledTo(p),x=this._getLoadedTile(_);if(x)return x}}_getLoadedTile(r){const o=this._tiles[r.key];return o&&o.hasData()?o:this._cache.getByKey(this._source.reparseOverscaled?r.wrapped().key:r.canonical.key)}updateCacheSize(r,o){o=o||this._source.tileSize;const p=Math.ceil(r.width/o)+1,_=Math.ceil(r.height/o)+1,x=Math.floor(p*_*5),w=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,x):x,M=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,w):w;this._cache.setMaxSize(M)}handleWrapJump(r){const o=Math.round((r-(this._prevLng===void 0?r:this._prevLng))/360);if(this._prevLng=r,o){const p={};for(const _ in this._tiles){const x=this._tiles[_];x.tileID=x.tileID.unwrapTo(x.tileID.wrap+o),p[x.tileID.key]=x}this._tiles=p;for(const _ in this._timers)clearTimeout(this._timers[_]),delete this._timers[_];for(const _ in this._tiles)this._setTileReloadTimer(+_,this._tiles[_])}}update(r,o,p,_){if(this.transform=r,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!p)return;this.updateCacheSize(r,o),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const x=this._source.type==="batched-model";let w,M=this._source.maxzoom;const P=this.map&&this.map.painter?this.map.painter._terrain:null;if(P&&P.sourceCache===this&&P.attenuationRange()){const B=P.attenuationRange()[0],V=Math.floor(B)-Math.log2(P.getDemUpscale());M>V&&(M=V)}if(this.used||this.usedForTerrain){if(this._source.tileID)w=r.getVisibleUnwrappedCoordinates(this._source.tileID).map(B=>new s.aG(B.canonical.z,B.wrap,B.canonical.z,B.canonical.x,B.canonical.y));else if(this.tileCoverLift!==0){const B=r.clone();B.tileCoverLift=this.tileCoverLift,w=B.coveringTiles({tileSize:o||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:M,roundZoom:this._source.roundZoom&&!p,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:x}),this._source.minzoom<=1&&r.projection.name==="globe"&&(w.push(new s.aG(1,0,1,0,0)),w.push(new s.aG(1,0,1,1,0)),w.push(new s.aG(1,0,1,0,1)),w.push(new s.aG(1,0,1,1,1)))}else if(w=r.coveringTiles({tileSize:o||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:M,roundZoom:this._source.roundZoom&&!p,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:x}),this._source.hasTile){const B=this._source.hasTile.bind(this._source);w=w.filter(V=>B(V))}}else w=[];if(w.length>0&&this.castsShadows&&_&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!rl(this._source.type)){const B=r.coveringZoomLevel({tileSize:o||this._source.tileSize,roundZoom:this._source.roundZoom&&!p}),V=Math.min(B,this._source.maxzoom);if(x){const G=r.extendTileCover(w,V);for(const Q of G)w.push(Q)}else{const G=r.extendTileCover(w,V,_);for(const Q of G)this._shadowCasterTiles[Q.key]=!0,w.push(Q)}}const z=this._updateRetainedTiles(w);if(rl(this._source.type)&&w.length!==0){const B={},V={},G=Object.keys(z);for(const W of G){const te=z[W],ee=this._tiles[W];if(!ee||ee.fadeEndTime&&ee.fadeEndTime<=s.q.now())continue;const le=this.findLoadedParent(te,Math.max(te.overscaledZ-Js.maxOverzooming,this._source.minzoom));le&&(this._addTile(le.tileID),B[le.tileID.key]=le.tileID),V[W]=te}const Q=w[w.length-1].overscaledZ;for(const W in this._tiles){const te=this._tiles[W];if(z[W]||!te.hasData())continue;let ee=te.tileID;for(;ee.overscaledZ>Q;){ee=ee.scaledTo(ee.overscaledZ-1);const le=this._tiles[ee.key];if(le&&le.hasData()&&V[ee.key]){z[W]=te.tileID;break}}}for(const W in B)z[W]||(this._coveredTiles[W]=!0,z[W]=B[W])}for(const B in z)this._tiles[B].clearFadeHold();const O=s.bk(this._tiles,z);for(const B of O){const V=this._tiles[B];V.hasSymbolBuckets&&!V.holdingForFade()?V.setHoldDuration(this.map._fadeDuration):V.hasSymbolBuckets&&!V.symbolFadeFinished()||this._removeTile(+B)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const r in this._tiles)this._tiles[r].holdingForFade()&&this._removeTile(+r)}_updateRetainedTiles(r){const o={};if(r.length===0)return o;const p={},_=r.reduce((z,O)=>Math.min(z,O.overscaledZ),1/0),x=r[0].overscaledZ,w=Math.max(x-Js.maxOverzooming,this._source.minzoom),M=Math.max(x+Js.maxUnderzooming,this._source.minzoom),P={};for(const z of r){const O=this._addTile(z);o[z.key]=z,O.hasData()||_<this._source.maxzoom&&(P[z.key]=z)}this._retainLoadedChildren(P,_,M,o);for(const z of r){let O=this._tiles[z.key];if(O.hasData())continue;if(z.canonical.z>=this._source.maxzoom){const V=z.children(this._source.maxzoom)[0],G=this.getTile(V);if(G&&G.hasData()){o[V.key]=V;continue}}else{const V=z.children(this._source.maxzoom);if(o[V[0].key]&&o[V[1].key]&&o[V[2].key]&&o[V[3].key])continue}let B=O.wasRequested();for(let V=z.overscaledZ-1;V>=w;--V){const G=z.scaledTo(V);if(p[G.key]||(p[G.key]=!0,O=this.getTile(G),!O&&B&&(O=this._addTile(G)),O&&(o[G.key]=G,B=O.wasRequested(),O.hasData())))break}}return o}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const r in this._tiles){const o=[];let p,_=this._tiles[r].tileID;for(;_.overscaledZ>0;){if(_.key in this._loadedParentTiles){p=this._loadedParentTiles[_.key];break}o.push(_.key);const x=_.scaledTo(_.overscaledZ-1);if(p=this._getLoadedTile(x),p)break;_=x}for(const x of o)this._loadedParentTiles[x]=p}}_addTile(r){let o=this._tiles[r.key];if(o)return o.isExtraShadowCaster!==!0||this._shadowCasterTiles[r.key]||this._reloadTile(r.key,"reloading"),o;o=this._cache.getAndRemove(r),o&&(this._setTileReloadTimer(r.key,o),o.tileID=r,this._state.initializeTileState(o,this.map?this.map.painter:null),this._cacheTimers[r.key]&&(clearTimeout(this._cacheTimers[r.key]),delete this._cacheTimers[r.key],this._setTileReloadTimer(r.key,o)));const p=!!o;if(!p){const _=this.map?this.map.painter:null,x=this._source.tileSize*r.overscaleFactor();o=this._source.type==="raster-array"?new Xa(r,x,this.transform.tileZoom,_,this._isRaster):new wo(r,x,this.transform.tileZoom,_,this._isRaster),this._loadTile(o,this._tileLoaded.bind(this,o,r.key,o.state))}return o?(o.uses++,this._tiles[r.key]=o,p||this._source.fire(new s.z("dataloading",{tile:o,coord:o.tileID,dataType:"source"})),o):null}_setTileReloadTimer(r,o){r in this._timers&&(clearTimeout(this._timers[r]),delete this._timers[r]);const p=o.getExpiryTimeout();p&&(this._timers[r]=setTimeout(()=>{this._reloadTile(r,"expired"),delete this._timers[r]},p))}_removeTile(r){const o=this._tiles[r];o&&(o.uses--,delete this._tiles[r],this._timers[r]&&(clearTimeout(this._timers[r]),delete this._timers[r]),o.uses>0||(o.hasData()&&o.state!=="reloading"||o.state==="empty"?this._cache.add(o.tileID,o,o.getExpiryTimeout()):(o.aborted=!0,this._abortTile(o),this._unloadTile(o))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const r in this._tiles)this._removeTile(+r);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(r,o,p){const _=[],x=this.transform;if(!x)return _;const w=x.projection.name==="globe",M=s.at(x.center.lng);for(const P in this._tiles){const z=this._tiles[P];if(p&&z.clearQueryDebugViz(),z.holdingForFade())continue;let O;if(w){const B=z.tileID.canonical;if(B.z===0){const V=[Math.abs(s.aw(M,...ei(B,-1))-M),Math.abs(s.aw(M,...ei(B,1))-M)];O=[0,2*V.indexOf(Math.min(...V))-1]}else{const V=[Math.abs(s.aw(M,...ei(B,-1))-M),Math.abs(s.aw(M,...ei(B,0))-M),Math.abs(s.aw(M,...ei(B,1))-M)];O=[V.indexOf(Math.min(...V))-1]}}else O=[0];for(const B of O){const V=r.containsTile(z,x,o,B);V&&_.push(V)}}return _}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(r){return this._getRenderableCoordinates(r)}_getRenderableCoordinates(r,o){const p=this.getRenderableIds(r,o).map(x=>this._tiles[x].tileID),_=this.transform.projection.name==="globe";for(const x of p)x.projMatrix=this.transform.calculateProjMatrix(x.toUnwrapped()),x.expandedProjMatrix=_?this.transform.calculateProjMatrix(x.toUnwrapped(),!1,!0):x.projMatrix;return p}sortCoordinatesByDistance(r){const o=r.slice(),p=this.transform._camera.position,_=this.transform._camera.forward(),x={};for(const w of o){const M=1/(1<<w.canonical.z);x[w.key]=((w.canonical.x+.5)*M+w.wrap-p[0])*_[0]+((w.canonical.y+.5)*M-p[1])*_[1]-p[2]*_[2]}return o.sort((w,M)=>x[w.key]-x[M.key]),o}hasTransition(){if(this._source.hasTransition())return!0;if(rl(this._source.type))for(const r in this._tiles){const o=this._tiles[r];if(o.fadeEndTime!==void 0&&o.fadeEndTime>=s.q.now())return!0}return!1}setFeatureState(r,o,p){this._state.updateState(r=r||"_geojsonTileLayer",o,p)}removeFeatureState(r,o,p){this._state.removeFeatureState(r=r||"_geojsonTileLayer",o,p)}getFeatureState(r,o){return this._state.getState(r=r||"_geojsonTileLayer",o)}setDependencies(r,o,p){const _=this._tiles[r];_&&_.setDependencies(o,p)}reloadTilesForDependencies(r,o){for(const p in this._tiles)this._tiles[p].hasDependency(r,o)&&this._reloadTile(+p,"reloading");this._cache.filter(p=>!p.hasDependency(r,o))}_preloadTiles(r,o){if(!this._sourceLoaded){const P=()=>{this._sourceLoaded&&(this._source.off("data",P),this._preloadTiles(r,o))};return void this._source.on("data",P)}const p=new Map,_=Array.isArray(r)?r:[r],x=this.map.painter.terrain,w=this.usedForTerrain&&x?x.getScaledDemTileSize():this._source.tileSize;for(const P of _){const z=P.coveringTiles({tileSize:w,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const O of z)p.set(O.key,O);this.usedForTerrain&&P.updateElevation(!1)}const M=Array.from(p.values());s.bl(M,(P,z)=>{const O=new wo(P,this._source.tileSize*P.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(O,B=>{this._source.type==="raster-dem"&&O.dem&&this._backfillDEM(O),z(B,O)})},o)}}function $i(f,r){const o=Math.abs(2*f.wrap)-+(f.wrap<0),p=Math.abs(2*r.wrap)-+(r.wrap<0);return f.overscaledZ-r.overscaledZ||p-o||r.canonical.y-f.canonical.y||r.canonical.x-f.canonical.x}function rl(f){return f==="raster"||f==="image"||f==="video"||f==="custom"}function ei(f,r){const o=1<<f.z;return[f.x/o+r,(f.x+1)/o+r]}Js.maxOverzooming=10,Js.maxUnderzooming=3;class cd{constructor(r){this.style=r,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const r=!1,o=!1;for(const p in this.style._mergedLayers){const _=this.style._mergedLayers[p];if(_.type==="fill-extrusion")this.layers.push({layer:_,visible:r,visibilityChanged:o});else if(_.type==="model"){const x=this.style.getLayerSource(_);x&&x.type==="batched-model"&&this.layers.push({layer:_,visible:r,visibilityChanged:o})}}}onNewFrame(r){this.layersGotHidden=!1;for(const o of this.layers){const p=o.layer;let _=!1;p.type==="fill-extrusion"?_=!p.isHidden(r)&&p.paint.get("fill-extrusion-opacity")>0:p.type==="model"&&(_=!p.isHidden(r)&&p.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!_&&o.visible,o.visible=_}}updateZOffset(r,o){this.currentBuildingBuckets=[];for(const _ of this.layers){const x=_.layer,w=this.style.getLayerSourceCache(x);let M=1;x.type==="fill-extrusion"&&(M=_.visible?x.paint.get("fill-extrusion-vertical-scale"):0);let P=w?w.getTile(o):null;if(!P&&w&&o.canonical.z>w.getSource().minzoom){let z=o.scaledTo(Math.min(w.getSource().maxzoom,o.overscaledZ-1));for(;z.overscaledZ>=w.getSource().minzoom&&(P=w.getTile(z),!P&&z.overscaledZ!==0);)z=z.scaledTo(z.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:P?P.getBucket(x):null,tileID:P?P.tileID:o,verticalScale:M})}r.hasAnyZOffset=!1;let p=!1;for(let _=0;_<r.symbolInstances.length;_++){const x=r.symbolInstances.get(_),w=x.zOffset,M=this._getHeightAtTileOffset(o,x.tileAnchorX,x.tileAnchorY);x.zOffset=M!==Number.NEGATIVE_INFINITY?M:w,p||w===x.zOffset||(p=!0),r.hasAnyZOffset||x.zOffset===0||(r.hasAnyZOffset=!0)}p&&(r.zOffsetBuffersNeedUpload=!0,r.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(r,o,p,_){let x=o,w=p;if(r.canonical.z!==_.canonical.z){const M=_.canonical,P=1/(1<<r.canonical.z-M.z);x=(o+r.canonical.x*s.ag)*P-M.x*s.ag|0,w=(p+r.canonical.y*s.ag)*P-M.y*s.ag|0}return{tileX:x,tileY:w}}_getHeightAtTileOffset(r,o,p){let _,x;for(let w=0;w<this.layers.length;++w){if(this.layers[w].layer.type!=="fill-extrusion")continue;const{bucket:M,tileID:P,verticalScale:z}=this.currentBuildingBuckets[w];if(!M)continue;const{tileX:O,tileY:B}=this._mapCoordToOverlappingTile(r,o,p,P),V=M.getHeightAtTileCoord(O,B);V&&V.height!==void 0&&(V.hidden?_=V.height:x=Math.max(V.height*z,x||0))}if(x!==void 0)return x;for(let w=0;w<this.layers.length;++w){const M=this.layers[w];if(M.layer.type!=="model"||!M.visible)continue;const{bucket:P,tileID:z}=this.currentBuildingBuckets[w];if(!P)continue;const{tileX:O,tileY:B}=this._mapCoordToOverlappingTile(r,o,p,z),V=P.getHeightAtTileCoord(O,B);if(V&&!V.hidden)return V.height===void 0&&_!==void 0?Math.min(V.maxHeight,_)*V.verticalScale:V.height?V.height*V.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function bc(f,r){const o={};for(const p in f)p!=="ref"&&(o[p]=f[p]);return s.bm.forEach(p=>{p in r&&(o[p]=r[p])}),o}function wc(f){f=f.slice();const r=Object.create(null);for(let o=0;o<f.length;o++)r[f[o].id]=f[o];for(let o=0;o<f.length;o++)"ref"in f[o]&&(f[o]=bc(f[o],r[f[o].ref]));return f}const vi={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function Su(f,r,o){o.push({command:vi.addSource,args:[f,r[f]]})}function sl(f,r,o){r.push({command:vi.removeSource,args:[f]}),o[f]=!0}function qt(f,r,o,p){sl(f,o,p),Su(f,r,o)}function zi(f,r,o){let p;for(p in f[o])if(f[o].hasOwnProperty(p)&&p!=="data"&&!s.bn(f[o][p],r[o][p]))return!1;for(p in r[o])if(r[o].hasOwnProperty(p)&&p!=="data"&&!s.bn(f[o][p],r[o][p]))return!1;return!0}function Ni(f,r,o,p,_,x){let w;for(w in r=r||{},f=f||{})f.hasOwnProperty(w)&&(s.bn(f[w],r[w])||o.push({command:x,args:[p,w,r[w],_]}));for(w in r)r.hasOwnProperty(w)&&!f.hasOwnProperty(w)&&(s.bn(f[w],r[w])||o.push({command:x,args:[p,w,r[w],_]}))}function jr(f){return f.id}function ea(f,r){return f[r.id]=r,f}class Oi{constructor(r,o){this.reset(r,o)}reset(r,o){this.points=r||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(o||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(this.points.length===1)return this.points[0];r=s.aw(r,0,1);let o=1,p=this._distances[o];const _=r*this.paddedLength+this.padding;for(;p<_&&o<this._distances.length;)p=this._distances[++o];const x=o-1,w=this._distances[x],M=p-w,P=M>0?(_-w)/M:0;return this.points[x].mult(1-P).add(this.points[o].mult(P))}}class Pl{constructor(r,o,p){const _=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(r/p),this.yCellCount=Math.ceil(o/p);for(let w=0;w<this.xCellCount*this.yCellCount;w++)_.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=o,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/o,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,o,p,_,x){this._forEachCell(o,p,_,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(o),this.bboxes.push(p),this.bboxes.push(_),this.bboxes.push(x)}insertCircle(r,o,p,_){this._forEachCell(o-_,p-_,o+_,p+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(o),this.circles.push(p),this.circles.push(_)}_insertBoxCell(r,o,p,_,x,w){this.boxCells[x].push(w)}_insertCircleCell(r,o,p,_,x,w){this.circleCells[x].push(w)}_query(r,o,p,_,x,w){if(p<0||r>this.width||_<0||o>this.height)return!x&&[];const M=[];if(r<=0&&o<=0&&this.width<=p&&this.height<=_){if(x)return!0;for(let P=0;P<this.boxKeys.length;P++)M.push({key:this.boxKeys[P],x1:this.bboxes[4*P],y1:this.bboxes[4*P+1],x2:this.bboxes[4*P+2],y2:this.bboxes[4*P+3]});for(let P=0;P<this.circleKeys.length;P++){const z=this.circles[3*P],O=this.circles[3*P+1],B=this.circles[3*P+2];M.push({key:this.circleKeys[P],x1:z-B,y1:O-B,x2:z+B,y2:O+B})}return w?M.filter(w):M}return this._forEachCell(r,o,p,_,this._queryCell,M,{hitTest:x,seenUids:{box:{},circle:{}}},w),x?M.length>0:M}_queryCircle(r,o,p,_,x){const w=r-p,M=r+p,P=o-p,z=o+p;if(M<0||w>this.width||z<0||P>this.height)return!_&&[];const O=[];return this._forEachCell(w,P,M,z,this._queryCellCircle,O,{hitTest:_,circle:{x:r,y:o,radius:p},seenUids:{box:{},circle:{}}},x),_?O.length>0:O}query(r,o,p,_,x){return this._query(r,o,p,_,!1,x)}hitTest(r,o,p,_,x){return this._query(r,o,p,_,!0,x)}hitTestCircle(r,o,p,_){return this._queryCircle(r,o,p,!0,_)}_queryCell(r,o,p,_,x,w,M,P){const z=M.seenUids,O=this.boxCells[x];if(O!==null){const V=this.bboxes;for(const G of O)if(!z.box[G]){z.box[G]=!0;const Q=4*G;if(r<=V[Q+2]&&o<=V[Q+3]&&p>=V[Q+0]&&_>=V[Q+1]&&(!P||P(this.boxKeys[G]))){if(M.hitTest)return w.push(!0),!0;w.push({key:this.boxKeys[G],x1:V[Q],y1:V[Q+1],x2:V[Q+2],y2:V[Q+3]})}}}const B=this.circleCells[x];if(B!==null){const V=this.circles;for(const G of B)if(!z.circle[G]){z.circle[G]=!0;const Q=3*G;if(this._circleAndRectCollide(V[Q],V[Q+1],V[Q+2],r,o,p,_)&&(!P||P(this.circleKeys[G]))){if(M.hitTest)return w.push(!0),!0;{const W=V[Q],te=V[Q+1],ee=V[Q+2];w.push({key:this.circleKeys[G],x1:W-ee,y1:te-ee,x2:W+ee,y2:te+ee})}}}}}_queryCellCircle(r,o,p,_,x,w,M,P){const z=M.circle,O=M.seenUids,B=this.boxCells[x];if(B!==null){const G=this.bboxes;for(const Q of B)if(!O.box[Q]){O.box[Q]=!0;const W=4*Q;if(this._circleAndRectCollide(z.x,z.y,z.radius,G[W+0],G[W+1],G[W+2],G[W+3])&&(!P||P(this.boxKeys[Q])))return w.push(!0),!0}}const V=this.circleCells[x];if(V!==null){const G=this.circles;for(const Q of V)if(!O.circle[Q]){O.circle[Q]=!0;const W=3*Q;if(this._circlesCollide(G[W],G[W+1],G[W+2],z.x,z.y,z.radius)&&(!P||P(this.circleKeys[Q])))return w.push(!0),!0}}}_forEachCell(r,o,p,_,x,w,M,P){const z=this._convertToXCellCoord(r),O=this._convertToYCellCoord(o),B=this._convertToXCellCoord(p),V=this._convertToYCellCoord(_);for(let G=z;G<=B;G++)for(let Q=O;Q<=V;Q++)if(x.call(this,r,o,p,_,this.xCellCount*Q+G,w,M,P))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,o,p,_,x,w){const M=_-r,P=x-o,z=p+w;return z*z>M*M+P*P}_circleAndRectCollide(r,o,p,_,x,w,M){const P=(w-_)/2,z=Math.abs(r-(_+P));if(z>P+p)return!1;const O=(M-x)/2,B=Math.abs(o-(x+O));if(B>O+p)return!1;if(z<=P||B<=O)return!0;const V=z-P,G=B-O;return V*V+G*G<=p*p}}const xs={unknown:0,flipRequired:1,flipNotRequired:2},Ya=Math.tan(85*Math.PI/180);function xr(f,r,o,p,_,x,w){const M=s.ab.mat4.create();if(o)if(x.name==="globe"){const P=s.bo(_,r);s.ab.mat4.multiply(M,M,P)}else{const P=s.ab.mat2.invert([],w);M[0]=P[0],M[1]=P[1],M[4]=P[2],M[5]=P[3],p||s.ab.mat4.rotateZ(M,M,_.angle)}else s.ab.mat4.multiply(M,_.labelPlaneMatrix,f);return M}function Rn(f,r,o,p,_,x,w){const M=xr(f,r,o,p,_,x,w);return x.name==="globe"&&o||(M[2]=M[6]=M[10]=M[14]=0),M}function Hn(f,r,o,p,_,x,w){if(o){if(x.name==="globe"){const M=xr(f,r,o,p,_,x,w);return s.ab.mat4.invert(M,M),s.ab.mat4.multiply(M,f,M),M}{const M=s.ab.mat4.clone(f),P=s.ab.mat4.identity([]);return P[0]=w[0],P[1]=w[1],P[4]=w[2],P[5]=w[3],s.ab.mat4.multiply(M,M,P),p||s.ab.mat4.rotateZ(M,M,-_.angle),M}}return _.glCoordMatrix}function ls(f,r,o,p){const _=[f,r,o,1];o?s.ab.vec4.transformMat4(_,_,p):Os(_,_,p);const x=_[3];return _[0]/=x,_[1]/=x,_[2]/=x,_}function Au(f,r){return Math.min(.5+f/r*.5,1.5)}function Ll(f,r){const o=f[0]/f[3],p=f[1]/f[3];return o>=-r[0]&&o<=r[0]&&p>=-r[1]&&p<=r[1]}function Tc(f,r,o,p,_,x,w,M,P,z){const O=o.transform,B=p?f.textSizeData:f.iconSizeData,V=s.bp(B,o.transform.zoom),G=O.projection.name==="globe",Q=[256/o.width*2+1,256/o.height*2+1],W=p?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;W.clear();let te=null;G&&(te=p?f.text.globeExtVertexArray:f.icon.globeExtVertexArray);const ee=f.lineVertexArray,le=p?f.text.placedSymbolArray:f.icon.placedSymbolArray,pe=o.transform.width/o.transform.height;let fe,Te=!1;for(let _e=0;_e<le.length;_e++){const xe=le.get(_e),{numGlyphs:ge,writingMode:Re}=xe;if(Re!==s.bq.vertical||Te||fe===s.bq.horizontal||(Te=!0),fe=Re,(xe.hidden||Re===s.bq.vertical)&&!Te){yn(ge,W);continue}Te=!1;const Fe=new s.P(xe.tileAnchorX,xe.tileAnchorY);let{x:rt,y:Ke,z:ht}=O.projection.projectTilePoint(Fe.x,Fe.y,z.canonical);if(P){const[dt,bt,It]=P(Fe);rt+=dt,Ke+=bt,ht+=It}const ut=[rt,Ke,ht,1];if(s.ab.vec4.transformMat4(ut,ut,r),!Ll(ut,Q)){yn(ge,W);continue}const $e=ut[3],st=Au(o.transform.getCameraToCenterDistance(O.projection),$e),xt=s.br(B,V,xe),He=w?xt/st:xt*st,ft=ls(rt,Ke,ht,_);if(ft[3]<=0){yn(ge,W);continue}let at={};const Mt=w?null:P,_t=_a(xe,He,!1,M,r,_,x,f.glyphOffsetArray,ee,W,te,ft,Fe,at,pe,Mt,O.projection,z,w);Te=_t.useVertical,Mt&&_t.needsFlipping&&(at={}),(_t.notEnoughRoom||Te||_t.needsFlipping&&_a(xe,He,!0,M,r,_,x,f.glyphOffsetArray,ee,W,te,ft,Fe,at,pe,Mt,O.projection,z,w).notEnoughRoom)&&yn(ge,W)}p?(f.text.dynamicLayoutVertexBuffer.updateData(W),te&&f.text.globeExtVertexBuffer&&f.text.globeExtVertexBuffer.updateData(te)):(f.icon.dynamicLayoutVertexBuffer.updateData(W),te&&f.icon.globeExtVertexBuffer&&f.icon.globeExtVertexBuffer.updateData(te))}function zl(f,r,o,p,_,x,w,M,P,z,O,B,V,G,Q,W){const{lineStartIndex:te,glyphStartIndex:ee,segment:le}=M,pe=ee+M.numGlyphs,fe=te+M.lineLength,Te=r.getoffsetX(ee),_e=r.getoffsetX(pe-1),xe=Ka(f*Te,o,p,_,x,w,le,te,fe,P,z,O,B,V,!0,G,Q,W);if(!xe)return null;const ge=Ka(f*_e,o,p,_,x,w,le,te,fe,P,z,O,B,V,!0,G,Q,W);return ge?{first:xe,last:ge}:null}function br(f,r,o,p){return f===s.bq.horizontal&&Math.abs(p)>Math.abs(o)?{useVertical:!0}:f===s.bq.vertical?p>0?{needsFlipping:!0}:null:r!==xs.unknown&&function(_,x){return _===0||Math.abs(x/_)>Ya}(o,p)?r===xs.flipRequired?{needsFlipping:!0}:null:o<0?{needsFlipping:!0}:null}function _a(f,r,o,p,_,x,w,M,P,z,O,B,V,G,Q,W,te,ee,le){const pe=r/24,fe=f.lineOffsetX*pe,Te=f.lineOffsetY*pe,{lineStartIndex:_e,glyphStartIndex:xe,numGlyphs:ge,segment:Re,writingMode:Fe,flipState:rt}=f,Ke=_e+f.lineLength,ht=ut=>{if(O){const[He,ft,at]=ut.up,Mt=z.length;s.bs(O,Mt+0,He,ft,at),s.bs(O,Mt+1,He,ft,at),s.bs(O,Mt+2,He,ft,at),s.bs(O,Mt+3,He,ft,at)}const[$e,st,xt]=ut.point;s.bt(z,$e,st,xt,ut.angle)};if(ge>1){const ut=zl(pe,M,fe,Te,o,B,V,f,P,x,G,W,!1,te,ee,le);if(!ut)return{notEnoughRoom:!0};if(p&&!o){let[$e,st,xt]=ut.first.point,[He,ft,at]=ut.last.point;[$e,st]=ls($e,st,xt,w),[He,ft]=ls(He,ft,at,w);const Mt=br(Fe,rt,(He-$e)*Q,ft-st);if(f.flipState=Mt&&Mt.needsFlipping?xs.flipRequired:xs.flipNotRequired,Mt)return Mt}ht(ut.first);for(let $e=xe+1;$e<xe+ge-1;$e++){const st=Ka(pe*M.getoffsetX($e),fe,Te,o,B,V,Re,_e,Ke,P,x,G,W,!1,!1,te,ee,le);if(!st)return z.length-=4*($e-xe),{notEnoughRoom:!0};ht(st)}ht(ut.last)}else{if(p&&!o){const $e=ls(V.x,V.y,0,_),st=_e+Re+1,xt=new s.P(P.getx(st),P.gety(st)),He=ls(xt.x,xt.y,0,_),ft=He[3]>0?He:Iu(V,xt,$e,1,_,void 0,te,ee.canonical),at=br(Fe,rt,(ft[0]-$e[0])*Q,ft[1]-$e[1]);if(f.flipState=at&&at.needsFlipping?xs.flipRequired:xs.flipNotRequired,at)return at}const ut=Ka(pe*M.getoffsetX(xe),fe,Te,o,B,V,Re,_e,Ke,P,x,G,W,!1,!1,te,ee,le);if(!ut)return{notEnoughRoom:!0};ht(ut)}return{}}function Fn(f,r,o,p,_){const{x,y:w,z:M}=p.projectTilePoint(f.x,f.y,r);if(!_)return ls(x,w,M,o);const[P,z,O]=_(f);return ls(x+P,w+z,M+O,o)}function Iu(f,r,o,p,_,x,w,M){const P=Fn(f.sub(r)._unit()._add(f),M,_,w,x);return s.ab.vec3.sub(P,o,P),s.ab.vec3.normalize(P,P),s.ab.vec3.scaleAndAdd(P,o,P,p)}function Ka(f,r,o,p,_,x,w,M,P,z,O,B,V,G,Q,W,te,ee){const le=p?f-r:f+r;let pe=le>0?1:-1,fe=0;p&&(pe*=-1,fe=Math.PI),pe<0&&(fe+=Math.PI);let Te=M+w+(pe>0?0:1)|0,_e=_,xe=_,ge=0,Re=0;const Fe=Math.abs(le),rt=[],Ke=[];let ht=x,ut=ht;const $e=()=>Iu(ut,ht,xe,Fe-ge+1,O,V,W,te.canonical);for(;ge+Re<=Fe;){if(Te+=pe,Te<M||Te>=P)return null;if(xe=_e,ut=ht,rt.push(xe),G&&Ke.push(ut),ht=new s.P(z.getx(Te),z.gety(Te)),_e=B[Te],!_e){const bt=Fn(ht,te.canonical,O,W,V);_e=bt[3]>0?B[Te]=bt:$e()}ge+=Re,Re=s.ab.vec3.distance(xe,_e)}Q&&V&&(B[Te]&&(_e=$e(),Re=s.ab.vec3.distance(xe,_e)),B[Te]=_e);const st=(Fe-ge)/Re,xt=ht.sub(ut)._mult(st)._add(ut),He=s.ab.vec3.sub([],_e,xe),ft=s.ab.vec3.scaleAndAdd([],xe,He,st);let at=[0,0,1],Mt=He[0],_t=He[1];if(ee&&(at=W.upVector(te.canonical,xt.x,xt.y),at[0]!==0||at[1]!==0||at[2]!==1)){const bt=[at[2],0,-at[0]],It=s.ab.vec3.cross([],at,bt);s.ab.vec3.normalize(bt,bt),s.ab.vec3.normalize(It,It),Mt=s.ab.vec3.dot(He,bt),_t=s.ab.vec3.dot(He,It)}if(o){const bt=s.ab.vec3.cross([],at,He);s.ab.vec3.normalize(bt,bt),s.ab.vec3.scaleAndAdd(ft,ft,bt,o*pe)}const dt=fe+Math.atan2(_t,Mt);return rt.push(ft),G&&Ke.push(xt),{point:ft,angle:dt,path:rt,tilePath:Ke,up:at}}function yn(f,r){const o=r.length,p=o+4*f;r.resize(p),r.float32.fill(-1/0,4*o,4*p)}function Os(f,r,o){const p=r[0],_=r[1];return f[0]=o[0]*p+o[4]*_+o[12],f[1]=o[1]*p+o[5]*_+o[13],f[3]=o[3]*p+o[7]*_+o[15],f}const ur=100;class Ln{constructor(r,o,p=new Pl(r.width+200,r.height+200,25),_=new Pl(r.width+200,r.height+200,25)){this.transform=r,this.grid=p,this.ignoredGrid=_,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+ur,this.screenBottomBoundary=r.height+ur,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.fogState=o}placeCollisionBox(r,o,p,_,x,w,M,P){let z=p.projectedAnchorX,O=p.projectedAnchorY,B=p.projectedAnchorZ;const V=p.elevation,G=p.tileID,Q=r.getProjection();if(V&&G){const[_e,xe,ge]=Q.upVector(G.canonical,p.tileAnchorX,p.tileAnchorY),Re=Q.upVectorScale(G.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;z+=_e*V*Re,O+=xe*V*Re,B+=ge*V*Re}const W=this.projectAndGetPerspectiveRatio(M,z,O,B,p.tileID,Q.name==="globe"||!!V||this.transform.pitch>0,Q),te=w*W.perspectiveRatio,ee=(p.x1*o+_.x-p.padding)*te+W.point.x,le=(p.y1*o+_.y-p.padding)*te+W.point.y,pe=(p.x2*o+_.x+p.padding)*te+W.point.x,fe=(p.y2*o+_.y+p.padding)*te+W.point.y,Te=W.perspectiveRatio<=.55||W.occluded;return!this.isInsideGrid(ee,le,pe,fe)||!x&&this.grid.hitTest(ee,le,pe,fe,P)||Te?{box:[],offscreen:!1,occluded:W.occluded}:{box:[ee,le,pe,fe],offscreen:this.isOffscreen(ee,le,pe,fe),occluded:!1}}placeCollisionCircles(r,o,p,_,x,w,M,P,z,O,B,V,G,Q,W){const te=[],ee=this.transform.elevation,le=r.getProjection(),pe=ee?ee.getAtTileOffsetFunc(W,this.transform.center.lat,this.transform.worldSize,le):null,fe=new s.P(p.tileAnchorX,p.tileAnchorY);let{x:Te,y:_e,z:xe}=le.projectTilePoint(fe.x,fe.y,W.canonical);if(pe){const[xt,He,ft]=pe(fe);Te+=xt,_e+=He,xe+=ft}const ge=le.name==="globe",Re=this.projectAndGetPerspectiveRatio(M,Te,_e,xe,W,ge||!!ee||this.transform.pitch>0,le),{perspectiveRatio:Fe}=Re,rt=(B?w/Fe:w*Fe)/s.bw,Ke=ls(Te,_e,xe,P),ht=Re.signedDistanceFromCamera>0?zl(rt,x,p.lineOffsetX*rt,p.lineOffsetY*rt,!1,Ke,fe,p,_,P,{},ee&&!B?pe:null,B&&!!ee,le,W,B):null;let ut=!1,$e=!1,st=!0;if(ht&&!Re.occluded){const xt=.5*G*Fe+Q,He=new s.P(-100,-100),ft=new s.P(this.screenRightBoundary,this.screenBottomBoundary),at=new Oi,{first:Mt,last:_t}=ht,dt=Mt.path.length;let bt=[];for(let jt=dt-1;jt>=1;jt--)bt.push(Mt.path[jt]);for(let jt=1;jt<_t.path.length;jt++)bt.push(_t.path[jt]);const It=2.5*xt;z&&(bt=bt.map(([jt,ui,ti],ri)=>(pe&&!ge&&(ti=pe(ri<dt-1?Mt.tilePath[dt-1-ri]:_t.tilePath[ri-dt+2])[2]),ls(jt,ui,ti,z))),bt.some(jt=>jt[3]<=0)&&(bt=[]));let Ot=[];if(bt.length>0){let jt=1/0,ui=-1/0,ti=1/0,ri=-1/0;for(const fi of bt)jt=Math.min(jt,fi[0]),ti=Math.min(ti,fi[1]),ui=Math.max(ui,fi[0]),ri=Math.max(ri,fi[1]);ui>=He.x&&jt<=ft.x&&ri>=He.y&&ti<=ft.y&&(Ot=[bt.map(fi=>new s.P(fi[0],fi[1]))],(jt<He.x||ui>ft.x||ti<He.y||ri>ft.y)&&(Ot=s.bu(Ot,He.x,He.y,ft.x,ft.y)))}for(const jt of Ot){at.reset(jt,.25*xt);let ui=0;ui=at.length<=.5*xt?1:Math.ceil(at.paddedLength/It)+1;for(let ti=0;ti<ui;ti++){const ri=ti/Math.max(ui-1,1),fi=at.lerp(ri),ki=fi.x+ur,en=fi.y+ur;te.push(ki,en,xt,0);const Bn=ki-xt,bn=en-xt,_i=ki+xt,ji=en+xt;if(st=st&&this.isOffscreen(Bn,bn,_i,ji),$e=$e||this.isInsideGrid(Bn,bn,_i,ji),!o&&this.grid.hitTestCircle(ki,en,xt,V)&&(ut=!0,!O))return{circles:[],offscreen:!1,collisionDetected:ut,occluded:!1}}}}return{circles:!O&&ut||!$e?[]:te,offscreen:st,collisionDetected:ut,occluded:Re.occluded}}queryRenderedSymbols(r){if(r.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const o=[];let p=1/0,_=1/0,x=-1/0,w=-1/0;for(const O of r){const B=new s.P(O.x+ur,O.y+ur);p=Math.min(p,B.x),_=Math.min(_,B.y),x=Math.max(x,B.x),w=Math.max(w,B.y),o.push(B)}const M=this.grid.query(p,_,x,w).concat(this.ignoredGrid.query(p,_,x,w)),P={},z={};for(const O of M){const B=O.key;if(P[B.bucketInstanceId]===void 0&&(P[B.bucketInstanceId]={}),P[B.bucketInstanceId][B.featureIndex])continue;const V=[new s.P(O.x1,O.y1),new s.P(O.x2,O.y1),new s.P(O.x2,O.y2),new s.P(O.x1,O.y2)];s.bv(o,V)&&(P[B.bucketInstanceId][B.featureIndex]=!0,z[B.bucketInstanceId]===void 0&&(z[B.bucketInstanceId]=[]),z[B.bucketInstanceId].push(B.featureIndex))}return z}insertCollisionBox(r,o,p,_,x){(o?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:_,collisionGroupID:x},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,o,p,_,x){const w=o?this.ignoredGrid:this.grid,M={bucketInstanceId:p,featureIndex:_,collisionGroupID:x};for(let P=0;P<r.length;P+=4)w.insertCircle(M,r[P],r[P+1],r[P+2])}projectAndGetPerspectiveRatio(r,o,p,_,x,w,M){const P=[o,p,_,1];let z=!1;_||this.transform.pitch>0?(s.ab.vec4.transformMat4(P,P,r),this.fogState&&x&&M.name!=="globe"&&(z=function(V,G,Q,W,te,ee){const le=ee.calculateFogTileMatrix(te),pe=[G,Q,W];return s.ab.vec3.transformMat4(pe,pe,le),Le(V,s.ab.vec3.length(pe),ee.pitch,ee._fov)}(this.fogState,o,p,_,x.toUnwrapped(),this.transform)>.9)):Os(P,P,r);const O=P[3];return{point:new s.P((P[0]/O+1)/2*this.transform.width+ur,(-P[1]/O+1)/2*this.transform.height+ur),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(M)/O*.5,1.5),signedDistanceFromCamera:O,occluded:w&&P[2]>O||z}}isOffscreen(r,o,p,_){return p<ur||r>=this.screenRightBoundary||_<ur||o>this.screenBottomBoundary}isInsideGrid(r,o,p,_){return p>=0&&r<this.gridRightBoundary&&_>=0&&o<this.gridBottomBoundary}getViewportMatrix(){const r=s.ab.mat4.identity([]);return s.ab.mat4.translate(r,r,[-100,-100,0]),r}}function Ol(f,r,o){const p=r.createTileMatrix(f,f.worldSize,o.toUnwrapped());return s.ab.mat4.multiply(new Float32Array(16),f.projMatrix,p)}function bs(f,r,o){if(r.projection.name===o.projection.name)return f.projMatrix;const p=o.clone();return p.setProjection(r.projection),Ol(p,r.getProjection(),f)}function al(f,r,o){return r.name===o.projection.name?f.projMatrix:Ol(o,r,f)}class kl{constructor(r,o,p,_){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?o:-o))):_&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class cs{constructor(r,o,p,_,x,w=!1){this.text=new kl(r?r.text:null,o,p,x),this.icon=new kl(r?r.icon:null,o,_,x),this.clipped=w}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Mu{constructor(r,o,p,_=!1){this.text=r,this.icon=o,this.skipFade=p,this.clipped=_}}class La{constructor(){this.invProjMatrix=s.ab.mat4.create(),this.viewportMatrix=s.ab.mat4.create(),this.circles=[]}}class ud{constructor(r,o,p,_,x){this.bucketInstanceId=r,this.featureIndex=o,this.sourceLayerIndex=p,this.bucketIndex=_,this.tileID=x}}class Ec{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const o=++this.maxGroupID;this.collisionGroups[r]={ID:o,predicate:p=>p.collisionGroupID===o}}return this.collisionGroups[r]}}function Xr(f,r,o,p,_){const{horizontalAlign:x,verticalAlign:w}=s.bD(f),M=-(x-.5)*r,P=-(w-.5)*o,z=s.bC(f,p);return new s.P(M+z[0]*_,P+z[1]*_)}function Nl(f,r,o,p,_){const x=new s.P(f,r);return o&&x._rotate(p?_:-_),x}class Sc{constructor(r,o,p,_,x,w){this.transform=r.clone(),this.projection=r.projection.name,this.collisionIndex=new Ln(this.transform,x),this.buildingIndex=w,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=o,this.retainedQueryData={},this.collisionGroups=new Ec(p),this.collisionCircleArrays={},this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,o,p,_,x=1){const w=p.getBucket(o),M=p.latestFeatureIndex;if(!w||!M||o.fqid!==w.layerIds[0])return;const P=w.layers[0].layout,z=w.layers[0].paint,O=p.collisionBoxArray,B=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),V=p.tileSize/s.ag,G=p.tileID.toUnwrapped();this.transform.setProjection(w.projection);const Q=(W=p.tileID,te=w.getProjection(),ee=this.transform,te.name===this.projection?ee.calculateProjMatrix(W.toUnwrapped()):Ol(ee,te,W));var W,te,ee;const le=P.get("text-pitch-alignment")==="map",pe=P.get("text-rotation-alignment")==="map";o.compileFilter(o.options);const fe=o.dynamicFilter(),Te=o.dynamicFilterNeedsFeature(),_e=this.transform.calculatePixelsToTileUnitsMatrix(p),xe=Rn(Q,p.tileID.canonical,le,pe,this.transform,w.getProjection(),_e);let ge=null;if(le){const xt=Hn(Q,p.tileID.canonical,le,pe,this.transform,w.getProjection(),_e);ge=s.ab.mat4.multiply([],this.transform.labelPlaneMatrix,xt)}let Re=null;fe&&p.latestFeatureIndex&&(Re={unwrappedTileID:G,dynamicFilter:fe,dynamicFilterNeedsFeature:Te}),this.retainedQueryData[w.bucketInstanceId]=new ud(w.bucketInstanceId,M,w.sourceLayerIndex,w.index,p.tileID);const[Fe,rt]=w.layers[0].layout.get("text-size-scale-range"),Ke=s.aw(x,Fe,rt),[ht,ut]=P.get("icon-size-scale-range"),$e=s.aw(x,ht,ut),st={bucket:w,layout:P,paint:z,posMatrix:Q,textLabelPlaneMatrix:xe,labelToScreenMatrix:ge,clippingData:Re,scale:B,textPixelRatio:V,holdingForFade:p.holdingForFade(),collisionBoxArray:O,partiallyEvaluatedTextSize:s.bp(w.textSizeData,this.transform.zoom,Ke),partiallyEvaluatedIconSize:s.bp(w.iconSizeData,this.transform.zoom,$e),collisionGroup:this.collisionGroups.get(w.sourceID),latestFeatureIndex:p.latestFeatureIndex};if(_)for(const xt of w.sortKeyRanges){const{sortKey:He,symbolInstanceStart:ft,symbolInstanceEnd:at}=xt;r.push({sortKey:He,symbolInstanceStart:ft,symbolInstanceEnd:at,parameters:st})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:w.symbolInstances.length,parameters:st})}attemptAnchorPlacement(r,o,p,_,x,w,M,P,z,O,B,V,G,Q,W,te,ee,le){const{textOffset0:pe,textOffset1:fe,crossTileID:Te}=V,_e=[pe,fe],xe=Xr(r,p,_,_e,x),ge=this.collisionIndex.placeCollisionBox(Q,x,o,Nl(xe.x,xe.y,w,M,this.transform.angle),B,P,z,O.predicate);if(te){const Re=Q.getSymbolInstanceIconSize(le,this.transform.zoom,V.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(Q,Re,te,Nl(xe.x,xe.y,w,M,this.transform.angle),B,P,z,O.predicate).box.length===0)return}if(ge.box.length>0){let Re;return this.prevPlacement&&this.prevPlacement.variableOffsets[Te]&&this.prevPlacement.placements[Te]&&this.prevPlacement.placements[Te].text&&(Re=this.prevPlacement.variableOffsets[Te].anchor),this.variableOffsets[Te]={textOffset:_e,width:p,height:_,anchor:r,textScale:x,prevAnchor:Re},this.markUsedJustification(Q,r,V,W),Q.allowVerticalPlacement&&(this.markUsedOrientation(Q,W,V),this.placedOrientations[Te]=W),{shift:xe,placedGlyphBoxes:ge}}}placeLayerBucketPart(r,o,p,_,x=1){const{bucket:w,layout:M,paint:P,posMatrix:z,textLabelPlaneMatrix:O,labelToScreenMatrix:B,clippingData:V,textPixelRatio:G,holdingForFade:Q,collisionBoxArray:W,partiallyEvaluatedTextSize:te,partiallyEvaluatedIconSize:ee,collisionGroup:le,latestFeatureIndex:pe}=r.parameters,fe=M.get("text-optional"),Te=M.get("icon-optional"),_e=M.get("text-allow-overlap"),xe=M.get("icon-allow-overlap"),ge=M.get("text-rotation-alignment")==="map",Re=M.get("text-pitch-alignment")==="map",Fe=M.get("symbol-z-elevate"),rt=P.get("symbol-z-offset"),Ke=M.get("symbol-elevation-reference")==="sea",[ht,ut]=M.get("text-size-scale-range"),[$e,st]=M.get("icon-size-scale-range"),xt=s.aw(x,ht,ut),He=s.aw(x,$e,st);this.transform.setProjection(w.projection);let ft=_e&&(xe||!w.hasIconData()||Te),at=xe&&(_e||!w.hasTextData()||fe);const Mt=!rt.isConstant();!w.collisionArrays&&W&&w.deserializeCollisionBoxes(W),p&&_&&w.updateCollisionDebugBuffers(this.transform.zoom,W,xt,He);const _t=(dt,bt,It)=>{const{crossTileID:Ot,numVerticalGlyphVertices:jt}=dt;let ui=null;if(V&&V.dynamicFilterNeedsFeature||Mt){const hn=this.retainedQueryData[w.bucketInstanceId];ui=pe.loadFeature({featureIndex:dt.featureIndex,bucketIndex:hn.bucketIndex,sourceLayerIndex:hn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(V&&!(0,V.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},ui,this.retainedQueryData[w.bucketInstanceId].tileID.canonical,new s.P(dt.tileAnchorX,dt.tileAnchorY),this.transform.calculateDistanceTileData(V.unwrappedTileID)))return this.placements[Ot]=new Mu(!1,!1,!1,!0),void o.add(Ot);const ti=rt.evaluate(ui,{});if(o.has(Ot))return;if(Q)return void(this.placements[Ot]=new Mu(!1,!1,!1));let ri=!1,fi=!1,ki=!0,en=!1,Bn=!1,bn=null,_i={box:null,offscreen:null,occluded:null},ji={box:null,offscreen:null,occluded:null},Xt=null,Di=null,Zi=null,Yi=0,On=0,Mr=0;It.textFeatureIndex?Yi=It.textFeatureIndex:dt.useRuntimeCollisionCircles&&(Yi=dt.featureIndex),It.verticalTextFeatureIndex&&(On=It.verticalTextFeatureIndex);const dr=hn=>{hn.tileID=this.retainedQueryData[w.bucketInstanceId].tileID;const ln=this.transform.elevation;hn.elevation=Ke?ti:ti+(ln?ln.getAtTileOffset(hn.tileID,hn.tileAnchorX,hn.tileAnchorY):0),hn.elevation+=dt.zOffset},fr=It.textBox;if(fr){dr(fr);const hn=Bi=>{let er=s.bq.horizontal;if(w.allowVerticalPlacement&&!Bi&&this.prevPlacement){const Cr=this.prevPlacement.placedOrientations[Ot];Cr&&(this.placedOrientations[Ot]=Cr,er=Cr,this.markUsedOrientation(w,er,dt))}return er},ln=(Bi,er)=>{if(w.allowVerticalPlacement&&jt>0&&It.verticalTextBox){for(const Cr of w.writingModes)if(Cr===s.bq.vertical?(_i=er(),ji=_i):_i=Bi(),_i&&_i.box&&_i.box.length)break}else _i=Bi()};if(M.get("text-variable-anchor")){let Bi=M.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ot]){const un=this.prevPlacement.variableOffsets[Ot];Bi.indexOf(un.anchor)>0&&(Bi=Bi.filter(ds=>ds!==un.anchor),Bi.unshift(un.anchor))}const er=(un,ds,Na)=>{const sa=w.getSymbolInstanceTextSize(te,dt,this.transform.zoom,bt),Fs=(un.x2-un.x1)*sa+2*un.padding,Co=(un.y2-un.y1)*sa+2*un.padding,Fa=dt.hasIconTextFit&&!xe?ds:null;Fa&&dr(Fa);let Ea={box:[],offscreen:!1,occluded:!1};const qc=_e?2*Bi.length:Bi.length;for(let Ro=0;Ro<qc;++Ro){const Gc=this.attemptAnchorPlacement(Bi[Ro%Bi.length],un,Fs,Co,sa,ge,Re,G,z,le,Ro>=Bi.length,dt,bt,w,Na,Fa,te,ee);if(Gc&&(Ea=Gc.placedGlyphBoxes,Ea&&Ea.box&&Ea.box.length)){ri=!0,bn=Gc.shift;break}}return Ea};ln(()=>er(fr,It.iconBox,s.bq.horizontal),()=>{const un=It.verticalTextBox;return un&&dr(un),w.allowVerticalPlacement&&!(_i&&_i.box&&_i.box.length)&&jt>0&&un?er(un,It.verticalIconBox,s.bq.vertical):{box:null,offscreen:null,occluded:null}}),_i&&(ri=_i.box,ki=_i.offscreen,en=_i.occluded);const Cr=hn(!(!_i||!_i.box));if(!ri&&this.prevPlacement){const un=this.prevPlacement.variableOffsets[Ot];un&&(this.variableOffsets[Ot]=un,this.markUsedJustification(w,un.anchor,dt,Cr))}}else{const Bi=(er,Cr)=>{const un=w.getSymbolInstanceTextSize(te,dt,this.transform.zoom,bt,x),ds=this.collisionIndex.placeCollisionBox(w,un,er,new s.P(0,0),_e,G,z,le.predicate);return ds&&ds.box&&ds.box.length&&(this.markUsedOrientation(w,Cr,dt),this.placedOrientations[Ot]=Cr),ds};ln(()=>Bi(fr,s.bq.horizontal),()=>{const er=It.verticalTextBox;return w.allowVerticalPlacement&&jt>0&&er?(dr(er),Bi(er,s.bq.vertical)):{box:null,offscreen:null,occluded:null}}),hn(!!(_i&&_i.box&&_i.box.length))}}if(Xt=_i,ri=Xt&&Xt.box&&Xt.box.length>0,ki=Xt&&Xt.offscreen,en=Xt&&Xt.occluded,dt.useRuntimeCollisionCircles){const hn=w.text.placedSymbolArray.get(dt.centerJustifiedTextSymbolIndex>=0?dt.centerJustifiedTextSymbolIndex:dt.verticalPlacedTextSymbolIndex),ln=s.br(w.textSizeData,te,hn),Bi=M.get("text-padding");Di=this.collisionIndex.placeCollisionCircles(w,_e,hn,w.lineVertexArray,w.glyphOffsetArray,ln,z,O,B,p,Re,le.predicate,dt.collisionCircleDiameter*ln/s.bw,Bi,this.retainedQueryData[w.bucketInstanceId].tileID),ri=_e||Di.circles.length>0&&!Di.collisionDetected,ki=ki&&Di.offscreen,en=Di.occluded}if(It.iconFeatureIndex&&(Mr=It.iconFeatureIndex),It.iconBox){const hn=ln=>{dr(ln);const Bi=dt.hasIconTextFit&&bn?Nl(bn.x,bn.y,ge,Re,this.transform.angle):new s.P(0,0),er=w.getSymbolInstanceIconSize(ee,this.transform.zoom,dt.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(w,er,ln,Bi,xe,G,z,le.predicate)};ji&&ji.box&&ji.box.length&&It.verticalIconBox?(Zi=hn(It.verticalIconBox),fi=Zi.box.length>0):(Zi=hn(It.iconBox),fi=Zi.box.length>0),ki=ki&&Zi.offscreen,Bn=Zi.occluded}const Ta=fe||dt.numHorizontalGlyphVertices===0&&jt===0,hs=Te||dt.numIconVertices===0;if(Ta||hs?hs?Ta||(fi=fi&&ri):ri=fi&&ri:fi=ri=fi&&ri,ri&&Xt&&Xt.box&&this.collisionIndex.insertCollisionBox(Xt.box,M.get("text-ignore-placement"),w.bucketInstanceId,ji&&ji.box&&On?On:Yi,le.ID),fi&&Zi&&this.collisionIndex.insertCollisionBox(Zi.box,M.get("icon-ignore-placement"),w.bucketInstanceId,Mr,le.ID),Di&&(ri&&this.collisionIndex.insertCollisionCircles(Di.circles,M.get("text-ignore-placement"),w.bucketInstanceId,Yi,le.ID),p)){const hn=w.bucketInstanceId;let ln=this.collisionCircleArrays[hn];ln===void 0&&(ln=this.collisionCircleArrays[hn]=new La);for(let Bi=0;Bi<Di.circles.length;Bi+=4)ln.circles.push(Di.circles[Bi+0]),ln.circles.push(Di.circles[Bi+1]),ln.circles.push(Di.circles[Bi+2]),ln.circles.push(Di.collisionDetected?1:0)}const kn=w.projection.name!=="globe";ft=ft&&(kn||!en),at=at&&(kn||!Bn),this.placements[Ot]=new Mu(ri||ft,fi||at,ki||w.justReloaded),o.add(Ot)};if(Fe&&this.buildingIndex&&(this.buildingIndex.updateZOffset(w,this.retainedQueryData[w.bucketInstanceId].tileID),w.updateZOffset()),w.sortFeaturesByY){const dt=w.getSortedSymbolIndexes(this.transform.angle);for(let bt=dt.length-1;bt>=0;--bt){const It=dt[bt];_t(w.symbolInstances.get(It),It,w.collisionArrays[It])}w.hasAnyZOffset&&s.w(`${w.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(w.hasAnyZOffset){const dt=w.getSortedIndexesByZOffset();for(let bt=0;bt<dt.length;++bt){const It=dt[bt];_t(w.symbolInstances.get(It),It,w.collisionArrays[It])}}else for(let dt=r.symbolInstanceStart;dt<r.symbolInstanceEnd;dt++)_t(w.symbolInstances.get(dt),dt,w.collisionArrays[dt]);if(p&&w.bucketInstanceId in this.collisionCircleArrays){const dt=this.collisionCircleArrays[w.bucketInstanceId];s.ab.mat4.invert(dt.invProjMatrix,z),dt.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1}markUsedJustification(r,o,p,_){const{leftJustifiedTextSymbolIndex:x,centerJustifiedTextSymbolIndex:w,rightJustifiedTextSymbolIndex:M,verticalPlacedTextSymbolIndex:P,crossTileID:z}=p,O=s.bB(o),B=_===s.bq.vertical?P:O==="left"?x:O==="center"?w:O==="right"?M:-1;x>=0&&(r.text.placedSymbolArray.get(x).crossTileID=B>=0&&x!==B?0:z),w>=0&&(r.text.placedSymbolArray.get(w).crossTileID=B>=0&&w!==B?0:z),M>=0&&(r.text.placedSymbolArray.get(M).crossTileID=B>=0&&M!==B?0:z),P>=0&&(r.text.placedSymbolArray.get(P).crossTileID=B>=0&&P!==B?0:z)}markUsedOrientation(r,o,p){const _=o===s.bq.horizontal||o===s.bq.horizontalOnly?o:0,x=o===s.bq.vertical?o:0,{leftJustifiedTextSymbolIndex:w,centerJustifiedTextSymbolIndex:M,rightJustifiedTextSymbolIndex:P,verticalPlacedTextSymbolIndex:z}=p,O=r.text.placedSymbolArray;w>=0&&(O.get(w).placedOrientation=_),M>=0&&(O.get(M).placedOrientation=_),P>=0&&(O.get(P).placedOrientation=_),z>=0&&(O.get(z).placedOrientation=x)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const o=this.prevPlacement;let p=!1;this.prevZoomAdjustment=o?o.zoomAdjustment(this.transform.zoom):0;const _=o?o.symbolFadeChange(r):1,x=o?o.opacities:{},w=o?o.variableOffsets:{},M=o?o.placedOrientations:{};for(const P in this.placements){const z=this.placements[P],O=x[P];O?(this.opacities[P]=new cs(O,_,z.text,z.icon,null,z.clipped),p=p||z.text!==O.text.placed||z.icon!==O.icon.placed):(this.opacities[P]=new cs(null,_,z.text,z.icon,z.skipFade,z.clipped),p=p||z.text||z.icon)}for(const P in x){const z=x[P];if(!this.opacities[P]){const O=new cs(z,_,!1,!1);O.isHidden()||(this.opacities[P]=O,p=p||z.text.placed||z.icon.placed)}}for(const P in w)this.variableOffsets[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.variableOffsets[P]=w[P]);for(const P in M)this.placedOrientations[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.placedOrientations[P]=M[P]);p?this.lastPlacementChangeTime=r:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=o?o.lastPlacementChangeTime:r)}updateLayerOpacities(r,o,p,_){const x=new Set;for(const w of o){const M=w.getBucket(r);M&&w.latestFeatureIndex&&r.fqid===M.layerIds[0]&&(this.updateBucketOpacities(M,x,w,w.collisionBoxArray,p,_,w.tileID,r.scope),M.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(M,w.tileID),M.updateZOffset()))}}updateBucketOpacities(r,o,p,_,x,w,M,P){r.hasTextData()&&r.text.opacityVertexArray.clear(),r.hasIconData()&&r.icon.opacityVertexArray.clear(),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const z=r.layers[0].layout,O=r.layers[0].paint,B=!!r.layers[0].dynamicFilter(),V=new cs(null,0,!1,!1,!0),G=z.get("text-allow-overlap"),Q=z.get("icon-allow-overlap"),W=z.get("text-variable-anchor"),te=z.get("text-rotation-alignment")==="map",ee=z.get("text-pitch-alignment")==="map",le=O.get("symbol-z-offset"),pe=z.get("symbol-elevation-reference")==="sea",fe=!le.isConstant(),Te=new cs(null,0,G&&(Q||!r.hasIconData()||z.get("icon-optional")),Q&&(G||!r.hasTextData()||z.get("text-optional")),!0);!r.collisionArrays&&_&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(_);const _e=(ge,Re,Fe)=>{for(let rt=0;rt<Re/4;rt++)ge.opacityVertexArray.emplaceBack(Fe)};let xe=0;w&&r.updateReplacement(M,w);for(let ge=0;ge<r.symbolInstances.length;ge++){const Re=r.symbolInstances.get(ge),{numHorizontalGlyphVertices:Fe,numVerticalGlyphVertices:rt,crossTileID:Ke,numIconVertices:ht,tileAnchorX:ut,tileAnchorY:$e}=Re;let st=null;const xt=this.retainedQueryData[r.bucketInstanceId];fe&&Re&&xt&&(st=p.latestFeatureIndex.loadFeature({featureIndex:Re.featureIndex,bucketIndex:xt.bucketIndex,sourceLayerIndex:xt.sourceLayerIndex,layoutVertexArrayOffset:0}));const He=le.evaluate(st,{}),ft=o.has(Ke);let at=this.opacities[Ke];ft?at=V:at||(at=Te,this.opacities[Ke]=at),o.add(Ke);const Mt=Fe>0||rt>0,_t=ht>0,dt=this.placedOrientations[Ke],bt=dt===s.bq.vertical,It=dt===s.bq.horizontal||dt===s.bq.horizontalOnly;!Mt&&!_t||at.isHidden()||xe++;let Ot=!1;if((Mt||_t)&&w)for(const jt of r.activeReplacements){if(s.bx(jt,x,s.by.Symbol,P)||jt.min.x>ut||ut>jt.max.x||jt.min.y>$e||$e>jt.max.y)continue;const ui=s.bz(ut,$e,M.canonical,jt.footprintTileId.canonical);if(Ot=s.bA(ui,jt.footprint),Ot)break}if(Mt){const jt=Ot?za:Ru(at.text);_e(r.text,Fe,bt?za:jt),_e(r.text,rt,It?za:jt);const ui=at.text.isHidden(),{leftJustifiedTextSymbolIndex:ti,centerJustifiedTextSymbolIndex:ri,rightJustifiedTextSymbolIndex:fi,verticalPlacedTextSymbolIndex:ki}=Re,en=r.text.placedSymbolArray,Bn=ui||bt?1:0;ti>=0&&(en.get(ti).hidden=Bn),ri>=0&&(en.get(ri).hidden=Bn),fi>=0&&(en.get(fi).hidden=Bn),ki>=0&&(en.get(ki).hidden=ui||It?1:0);const bn=this.variableOffsets[Ke];bn&&this.markUsedJustification(r,bn.anchor,Re,dt);const _i=this.placedOrientations[Ke];_i&&(this.markUsedJustification(r,"left",Re,_i),this.markUsedOrientation(r,_i,Re))}if(_t){const jt=Ot?za:Ru(at.icon),{placedIconSymbolIndex:ui,verticalPlacedIconSymbolIndex:ti}=Re,ri=r.icon.placedSymbolArray,fi=at.icon.isHidden()?1:0;ui>=0&&(_e(r.icon,ht,bt?za:jt),ri.get(ui).hidden=fi),ti>=0&&(_e(r.icon,Re.numVerticalIconVertices,It?za:jt),ri.get(ti).hidden=fi)}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const jt=r.collisionArrays[ge];if(jt){let ui=new s.P(0,0),ti=!0;if(jt.textBox||jt.verticalTextBox){if(W){const fi=this.variableOffsets[Ke];fi?(ui=Xr(fi.anchor,fi.width,fi.height,fi.textOffset,fi.textScale),te&&ui._rotate(ee?this.transform.angle:-this.transform.angle)):ti=!1}B&&(ti=!at.clipped),jt.textBox&&Fl(r.textCollisionBox.collisionVertexArray,at.text.placed,!ti||bt,He,pe,ui.x,ui.y),jt.verticalTextBox&&Fl(r.textCollisionBox.collisionVertexArray,at.text.placed,!ti||It,He,pe,ui.x,ui.y)}const ri=ti&&!!(!It&&jt.verticalIconBox);jt.iconBox&&Fl(r.iconCollisionBox.collisionVertexArray,at.icon.placed,ri,He,pe,Re.hasIconTextFit?ui.x:0,Re.hasIconTextFit?ui.y:0),jt.verticalIconBox&&Fl(r.iconCollisionBox.collisionVertexArray,at.icon.placed,!ri,He,pe,Re.hasIconTextFit?ui.x:0,Re.hasIconTextFit?ui.y:0)}}}if(r.fullyClipped=xe===0,r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.bucketInstanceId in this.collisionCircleArrays){const ge=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=ge.invProjMatrix,r.placementViewportMatrix=ge.viewportMatrix,r.collisionCircleArray=ge.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return this.fadeDuration===0?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,o){const p=this.zoomAtLastRecencyCheck===o?1-this.zoomAdjustment(o):1;return this.zoomAtLastRecencyCheck=o,this.commitTime+this.fadeDuration*p>r}setStale(){this.stale=!0}}function Fl(f,r,o,p,_,x,w){f.emplaceBack(r?1:0,o?1:0,x||0,w||0,p,_?1:0),f.emplaceBack(r?1:0,o?1:0,x||0,w||0,p,_?1:0),f.emplaceBack(r?1:0,o?1:0,x||0,w||0,p,_?1:0),f.emplaceBack(r?1:0,o?1:0,x||0,w||0,p,_?1:0)}const ya=Math.pow(2,25),Bf=Math.pow(2,24),Vf=Math.pow(2,17),Bl=Math.pow(2,16),Vl=Math.pow(2,9),Cu=Math.pow(2,8),kr=Math.pow(2,1);function Ru(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;const r=f.placed?1:0,o=Math.floor(127*f.opacity);return o*ya+r*Bf+o*Vf+r*Bl+o*Vl+r*Cu+o*kr+r}const za=0;class ks{constructor(r){this._sortAcrossTiles=r.layout.get("symbol-z-order")!=="viewport-y"&&r.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(r,o,p,_,x,w){const M=this._bucketParts;for(;this._currentTileIndex<r.length;)if(o.getBucketParts(M,_,r[this._currentTileIndex],this._sortAcrossTiles,w),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,M.sort((P,z)=>P.sortKey-z.sortKey));this._currentPartIndex<M.length;){const P=M[this._currentPartIndex];if(o.placeLayerBucketPart(P,this._seenCrossTileIDs,p,P.symbolInstanceStart===0,w),this._currentPartIndex++,x())return!0}return!1}}class L{constructor(r,o,p,_,x,w,M,P,z){this.placement=new Sc(r,x,w,M,P,z),this._currentPlacementIndex=o.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(r,o,p,_,x){const w=s.q.now(),M=()=>{const P=s.q.now()-w;return!this._forceFullPlacement&&P>2};for(;this._currentPlacementIndex>=0;){const P=o[r[this._currentPlacementIndex]],z=this.placement.collisionIndex.transform.zoom;if(P.type==="symbol"&&(!P.minzoom||P.minzoom<=z)&&(!P.maxzoom||P.maxzoom>z)){const O=P,B=O.layout.get("symbol-z-elevate"),V=O.layout.get("symbol-sort-key").constantOr(1)!==void 0,G=O.layout.get("symbol-z-order"),Q=G==="viewport-y"||G==="auto"&&!(G!=="viewport-y"&&V),W=O.layout.get("text-allow-overlap")||O.layout.get("icon-allow-overlap")||O.layout.get("text-ignore-placement")||O.layout.get("icon-ignore-placement"),te=Q&&W,ee=this._inProgressLayer=this._inProgressLayer||new ks(O),le=s.aC(P.source,P.scope);if(ee.continuePlacement(B||te?_[le]:p[le],this.placement,this._showCollisionBoxes,P,M,x))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const Z=512/s.ag/2;class re{constructor(r,o,p){this.tileID=r,this.bucketInstanceId=p,this.index=new s.bE(o.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const _=r.canonical.x*s.ag,x=r.canonical.y*s.ag;for(let w=0;w<o.length;w++){const{key:M,crossTileID:P,tileAnchorX:z,tileAnchorY:O}=o.get(w),B=Math.floor((_+z)*Z),V=Math.floor((x+O)*Z);this.index.add(B,V),this.keys.push(M),this.crossTileIDs.push(P)}this.index.finish()}findMatches(r,o,p){const _=this.tileID.canonical.z<o.canonical.z?1:Math.pow(2,this.tileID.canonical.z-o.canonical.z),x=Z/Math.pow(2,o.canonical.z-this.tileID.canonical.z),w=o.canonical.x*s.ag,M=o.canonical.y*s.ag;for(let P=0;P<r.length;P++){const z=r.get(P);if(z.crossTileID)continue;const{key:O,tileAnchorX:B,tileAnchorY:V}=z,G=Math.floor((w+B)*x),Q=Math.floor((M+V)*x),W=this.index.range(G-_,Q-_,G+_,Q+_);for(const te of W){const ee=this.crossTileIDs[te];if(this.keys[te]===O&&!p.has(ee)){p.add(ee),z.crossTileID=ee;break}}}}}class Se{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class gt{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const o=Math.round((r-this.lng)/360);if(o!==0)for(const p in this.indexes){const _=this.indexes[p],x={};for(const w in _){const M=_[w];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+o),x[M.tileID.key]=M}this.indexes[p]=x}this.lng=r}addBucket(r,o,p){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===o.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let x=0;x<o.symbolInstances.length;x++)o.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]=new Set);const _=this.usedCrossTileIDs[r.overscaledZ];for(const x in this.indexes){const w=this.indexes[x];if(Number(x)>r.overscaledZ)for(const M in w){const P=w[M];P.tileID.isChildOf(r)&&P.findMatches(o.symbolInstances,r,_)}else{const M=w[r.scaledTo(Number(x)).key];M&&M.findMatches(o.symbolInstances,r,_)}}for(let x=0;x<o.symbolInstances.length;x++){const w=o.symbolInstances.get(x);w.crossTileID||(w.crossTileID=p.generate(),_.add(w.crossTileID))}return this.indexes[r.overscaledZ]===void 0&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new re(r,o.symbolInstances,o.bucketInstanceId),!0}removeBucketCrossTileIDs(r,o){for(const p of o.crossTileIDs)this.usedCrossTileIDs[r].delete(p)}removeStaleBuckets(r){let o=!1;for(const p in this.indexes){const _=this.indexes[p];for(const x in _)r[_[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,_[x]),delete _[x],o=!0)}return o}}class Tt{constructor(){this.layerIndexes={},this.crossTileIDs=new Se,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,o,p,_){let x=this.layerIndexes[r.fqid];x===void 0&&(x=this.layerIndexes[r.fqid]=new gt);let w=!1;const M={};_.name!=="globe"&&x.handleWrapJump(p);for(const P of o){const z=P.getBucket(r);z&&r.fqid===z.layerIds[0]&&(z.bucketInstanceId||(z.bucketInstanceId=++this.maxBucketInstanceId),x.addBucket(P.tileID,z,this.crossTileIDs)&&(w=!0),M[z.bucketInstanceId]=!0)}return x.removeStaleBuckets(M)&&(w=!0),w}pruneUnusedLayers(r){const o={};r.forEach(p=>{o[p]=!0});for(const p in this.layerIndexes)o[p]||delete this.layerIndexes[p]}}const Yt=771;class ni{constructor(r,o,p,_){this.blendFunction=r,this.blendColor=o,this.mask=p,this.blendEquation=_}}ni.Replace=[1,0,1,0],ni.disabled=new ni(ni.Replace,s.aj.transparent,[!1,!1,!1,!1]),ni.unblended=new ni(ni.Replace,s.aj.transparent,[!0,!0,!0,!0]),ni.alphaBlended=new ni([1,Yt,1,Yt],s.aj.transparent,[!0,!0,!0,!0]),ni.alphaBlendedNonPremultiplied=new ni([770,Yt,770,Yt],s.aj.transparent,[!0,!0,!0,!0]),ni.multiply=new ni([774,0,774,0],s.aj.transparent,[!0,!0,!0,!0]);class Ht{constructor(r,o,p){this.func=r,this.mask=o,this.range=p}}Ht.ReadOnly=!1,Ht.ReadWrite=!0,Ht.disabled=new Ht(519,Ht.ReadOnly,[0,1]);const on=7680;class Kt{constructor(r,o,p,_,x,w){this.test=r,this.ref=o,this.mask=p,this.fail=_,this.depthFail=x,this.pass=w}}Kt.disabled=new Kt({func:519,mask:0},0,0,on,on,on);const hr=1029,Qa=2305;class li{constructor(r,o,p){this.enable=r,this.mode=o,this.frontFace=p}}function Ja(f,r){const o=s.bG(f,3);s.ab.mat4.fromQuat(f,r),s.bI(f,3,o)}function eo(f,r){const o=s.ab.quat.identity([]);return s.ab.quat.rotateZ(o,o,-r),s.ab.quat.rotateX(o,o,-f),o}function tg(f,r){const o=[f[0],f[1],0],p=[r[0],r[1],0];if(s.ab.vec3.length(o)>=1e-15){const w=s.ab.vec3.normalize([],o);s.ab.vec3.scale(p,w,s.ab.vec3.dot(p,w)),r[0]=p[0],r[1]=p[1]}const _=s.ab.vec3.cross([],r,f);if(s.ab.vec3.len(_)<1e-15)return null;const x=Math.atan2(-_[1],_[0]);return eo(Math.atan2(Math.sqrt(f[0]*f[0]+f[1]*f[1]),-f[2]),x)}li.disabled=new li(!1,hr,Qa),li.backCCW=new li(!0,hr,Qa),li.backCW=new li(!0,hr,2304),li.frontCW=new li(!0,1028,2304),li.frontCCW=new li(!0,1028,Qa);class Uf{constructor(r,o){this.position=r,this.orientation=o}get position(){return this._position}set position(r){if(r){const o=r instanceof s.aa?r:new s.aa(r[0],r[1],r[2]);this._renderWorldCopies&&(o.x=s.bF(o.x,0,1)),this._position=o}else this._position=null}lookAtPoint(r,o){if(this.orientation=null,!this.position)return;const p=this.position,_=this._elevation?this._elevation.getAtPointOrZero(s.aa.fromLngLat(r)):0,x=s.aa.fromLngLat(r,_),w=[x.x-p.x,x.y-p.y,x.z-p.z];o||(o=[0,0,1]),o[2]=Math.abs(o[2]),this.orientation=tg(w,o)}setPitchBearing(r,o){this.orientation=eo(s.ai(r),s.ai(-o))}}class Ns{constructor(r,o){this._transform=s.ab.mat4.identity([]),this.orientation=o,this.position=r}get mercatorPosition(){const r=this.position;return new s.aa(r[0],r[1],r[2])}get position(){const r=s.bG(this._transform,3);return[r[0],r[1],r[2]]}set position(r){var o;r&&s.bI(this._transform,3,[(o=r)[0],o[1],o[2],1])}get orientation(){return this._orientation}set orientation(r){this._orientation=r||s.ab.quat.identity([]),r&&Ja(this._transform,this._orientation)}getPitchBearing(){const r=this.forward(),o=this.right();return{bearing:Math.atan2(-o[1],o[0]),pitch:Math.atan2(Math.sqrt(r[0]*r[0]+r[1]*r[1]),-r[2])}}setPitchBearing(r,o){this._orientation=eo(r,o),Ja(this._transform,this._orientation)}forward(){const r=s.bG(this._transform,2);return[-r[0],-r[1],-r[2]]}up(){const r=s.bG(this._transform,1);return[-r[0],-r[1],-r[2]]}right(){const r=s.bG(this._transform,0);return[r[0],r[1],r[2]]}getCameraToWorld(r,o){const p=new Float64Array(16);return s.ab.mat4.invert(p,this.getWorldToCamera(r,o)),p}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(r,o,p){const _=this.position;s.ab.vec3.scale(_,_,-r);const x=new Float64Array(16);return s.ab.mat4.fromScaling(x,[p,p,p]),s.ab.mat4.translate(x,x,_),x[10]*=o,x}getWorldToCamera(r,o){const p=new Float64Array(16),_=new Float64Array(4),x=this.position;return s.ab.quat.conjugate(_,this._orientation),s.ab.vec3.scale(x,x,-r),s.ab.mat4.fromQuat(p,_),s.ab.mat4.translate(p,p,x),p[1]*=-1,p[5]*=-1,p[9]*=-1,p[13]*=-1,p[8]*=o,p[9]*=o,p[10]*=o,p[11]*=o,p}getCameraToClipPerspective(r,o,p,_){const x=new Float64Array(16);return s.ab.mat4.perspective(x,r,o,p,_),x}getCameraToClipOrthographic(r,o,p,_,x,w){const M=new Float64Array(16);return s.ab.mat4.ortho(M,r,o,p,_,x,w),M}getDistanceToElevation(r,o=!1){const p=r===0?0:s.bH(r,o?s.aS(this.position[1]):this.position[1]),_=this.forward();return(p-this.position[2])/_[2]}clone(){return new Ns([...this.position],[...this.orientation])}}const Yr={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class Pt{constructor(r=0,o=0,p=0,_=0){if(isNaN(r)||r<0||isNaN(o)||o<0||isNaN(p)||p<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=o,this.left=p,this.right=_}interpolate(r,o,p){return o.top!=null&&r.top!=null&&(this.top=s.af(r.top,o.top,p)),o.bottom!=null&&r.bottom!=null&&(this.bottom=s.af(r.bottom,o.bottom,p)),o.left!=null&&r.left!=null&&(this.left=s.af(r.left,o.left,p)),o.right!=null&&r.right!=null&&(this.right=s.af(r.right,o.right,p)),this}getCenter(r,o){const p=s.aw((this.left+r-this.right)/2,0,r),_=s.aw((this.top+o-this.bottom)/2,0,o);return new s.P(p,_)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new Pt(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const ig=(f,r,o)=>(1-o)*f+o*r,jf=f=>f*f*f*f*f;class hd{constructor(r,o,p,_,x,w,M){this.tileSize=512,this._renderWorldCopies=x===void 0||x,this._minZoom=r||0,this._maxZoom=o||22,this._minPitch=p??0,this._maxPitch=_??60,this.setProjection(w),this.setMaxBounds(M),this.width=0,this.height=0,this._center=new s.bO(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Pt,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Ns,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const r=new hd(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return r._elevation=this._elevation,r._centerAltitude=this._centerAltitude,r._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,r.tileSize=this.tileSize,r.mercatorFromTransition=this.mercatorFromTransition,r.width=this.width,r.height=this.height,r.cameraElevationReference=this.cameraElevationReference,r._center=this._center,r._setZoom(this.zoom),r._seaLevelZoom=this._seaLevelZoom,r.angle=this.angle,r._fov=this._fov,r._pitch=this._pitch,r._nearZ=this._nearZ,r._farZ=this._farZ,r._averageElevation=this._averageElevation,r._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,r._unmodified=this._unmodified,r._edgeInsets=this._edgeInsets.clone(),r._camera=this._camera.clone(),r._calcMatrices(),r.freezeTileCoverage=this.freezeTileCoverage,r.frustumCorners=this.frustumCorners,r}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(r){this._elevation!==r&&(this._elevation=r,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(r,o=!1){const p=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||p)&&this._updateCameraOnTerrain(),(r||p)&&this._constrainCamera(o),this._calcMatrices()}getProjection(){return s.ay(this.projection,["name","center","parallels"])}setProjection(r){this.projectionOptions=r||{name:"mercator"};const o=this.projection?this.getProjection():void 0;this.projection=s.bP(this.projectionOptions);const p=this.getProjection(),_=!s.bn(o,p);return _&&this._calcMatrices(),this.mercatorFromTransition=!1,_}setOrthographicProjectionAtLowPitch(r){return this._orthographicProjectionAtLowPitch!==r&&(this._orthographicProjectionAtLowPitch=r,this._calcMatrices(),!0)}setMercatorFromTransition(){const r=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=s.bP({name:"mercator"});const o=r!==this.projection.name;return o&&this._calcMatrices(),o}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(r){r===void 0?r=!0:r===null&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get cameraWorldSize(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return s.bH(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return s.bF(this.rotation,-180,180)}set bearing(r){this.rotation=r}get rotation(){return-this.angle/Math.PI*180}set rotation(r){const o=-r*Math.PI/180;this.angle!==o&&(this._unmodified=!1,this.angle=o,this._calcMatrices(),this.rotationMatrix=s.ab.mat2.create(),s.ab.mat2.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(r){const o=s.aw(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==o&&(this._unmodified=!1,this._pitch=o,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const r=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/r)}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=s.ai(r),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(r){this._averageElevation=r,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(r){const o=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==o&&(this._unmodified=!1,this._setZoom(o),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(r){this._zoom=r,this.scale=this.zoomScale(r),this.tileZoom=Math.floor(r),this.zoomFraction=r-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(r){this._tileCoverLift!==r&&(this._tileCoverLift=r)}_updateCameraOnTerrain(){const r=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,o=this.elevation&&r===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||r===Number.NEGATIVE_INFINITY&&(!o||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const p=this._elevation;o||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&p.exaggeration()&&this._centerAltitudeValidForExaggeration!==p.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*p.exaggeration(),this._centerAltitudeValidForExaggeration=p.exaggeration()):(this._centerAltitude=r||0,this._centerAltitudeValidForExaggeration=p.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const r=this._elevation,o=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],p=this.horizonLineFromTop();let _=0,x=0;for(let w=0;w<o.length;w++){const M=new s.P(o[w][0]*this.width,p+o[w][1]*(this.height-p)),P=r.pointCoordinate(M);if(!P)continue;const z=1/Math.hypot(P[0]-this._camera.position[0],P[1]-this._camera.position[1]);_+=P[3]*z,x+=z}return x===0?NaN:_/x}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const r=this._seaLevelZoom,o=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),p=this.pixelsPerMeter/this.worldSize*o,_=this._mercatorZfromZoom(r),x=this._mercatorZfromZoom(this._maxZoom),w=Math.max(_-p,x);this._setZoom(this._zoomFromMercatorZ(w))}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}computeZoomRelativeTo(r){const o=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,r.toAltitude()));let p;p=r.z<this._camera.position[2]?[o.x,o.y,o.z]:[r.x,r.y,r.z];const _=s.ab.vec3.length(s.ab.vec3.sub([],this._camera.position,p));return s.aw(this._zoomFromMercatorZ(_),this._minZoom,this._maxZoom)}setFreeCameraOptions(r){if(!this.height||!r.position&&!r.orientation)return;this._updateCameraState();let o=!1;if(r.orientation&&!s.ab.quat.exactEquals(r.orientation,this._camera.orientation)&&(o=this._setCameraOrientation(r.orientation)),r.position){const p=[r.position.x,r.position.y,r.position.z];s.ab.vec3.exactEquals(p,this._camera.position)||(this._setCameraPosition(p),o=!0)}o&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const r=this._camera.position,o=new Uf;return o.position=new s.aa(r[0],r[1],r[2]),o.orientation=this._camera.orientation,o._elevation=this.elevation,o._renderWorldCopies=this.renderWorldCopies,o}_setCameraOrientation(r){if(!s.ab.quat.length(r))return!1;s.ab.quat.normalize(r,r);const o=s.ab.vec3.transformQuat([],[0,0,-1],r),p=s.ab.vec3.transformQuat([],[0,-1,0],r);if(p[2]<0)return!1;const _=tg(o,p);return!!_&&(this._camera.orientation=_,!0)}_setCameraPosition(r){const o=this.zoomScale(this.minZoom)*this.tileSize,p=this.zoomScale(this.maxZoom)*this.tileSize,_=this.cameraToCenterDistance;r[2]=s.aw(r[2],_/p,_/o),this._camera.position=r}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,o,p){this._unmodified=!1,this._edgeInsets.interpolate(r,o,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){const o=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,o)}getVisibleUnwrappedCoordinates(r){const o=[new s.bQ(0,r)];if(this.renderWorldCopies){const p=this.pointCoordinate(new s.P(0,0)),_=this.pointCoordinate(new s.P(this.width,0)),x=this.pointCoordinate(new s.P(this.width,this.height)),w=this.pointCoordinate(new s.P(0,this.height)),M=Math.floor(Math.min(p.x,_.x,x.x,w.x)),P=Math.floor(Math.max(p.x,_.x,x.x,w.x)),z=1;for(let O=M-z;O<=P+z;O++)O!==0&&o.push(new s.bQ(O,r))}return o}isLODDisabled(r){return(!r||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(r,o,p){let _=[];const x=p!==void 0,w=!x;if(w&&this.zoom<o||x&&p[0]===0&&p[1]===0)return _;const M=new Set,P=(O,B,V,G,Q)=>{const W=s.c5(B,O,V,G,Q);M.has(W)||(_.push(new s.aG(O,B,V,G,Q)),M.add(W))};for(let O=0;O<r.length;O++){const B=r[O];if(w&&B.canonical.z!==o)continue;const V=B.canonical,G=B.overscaledZ,Q=B.wrap,W=1<<V.z,te=V.x+1<W,ee=V.x>0,le=V.y+1<W,pe=V.y>0,fe=B.wrap-(ee?0:1),Te=B.wrap+(te?0:1),_e=ee?V.x-1:W-1,xe=te?V.x+1:0;if(x)p[0]<0?(P(G,Te,V.z,xe,V.y),p[1]<0&&le&&(P(G,Q,V.z,V.x,V.y+1),P(G,Te,V.z,xe,V.y+1)),p[1]>0&&pe&&(P(G,Q,V.z,V.x,V.y-1),P(G,Te,V.z,xe,V.y-1))):p[0]>0?(P(G,fe,V.z,_e,V.y),p[1]<0&&le&&(P(G,Q,V.z,V.x,V.y+1),P(G,fe,V.z,_e,V.y+1)),p[1]>0&&pe&&(P(G,Q,V.z,V.x,V.y-1),P(G,fe,V.z,_e,V.y-1))):p[1]<0&&le?P(G,Q,V.z,V.x,V.y+1):pe&&P(G,Q,V.z,V.x,V.y-1);else{const ge=B.visibleQuadrants;1&ge&&(P(G,fe,V.z,_e,V.y),pe&&(P(G,Q,V.z,V.x,V.y-1),P(G,fe,V.z,_e,V.y-1))),2&ge&&(P(G,Te,V.z,xe,V.y),pe&&(P(G,Q,V.z,V.x,V.y-1),P(G,Te,V.z,xe,V.y-1))),4&ge&&(P(G,fe,V.z,_e,V.y),le&&(P(G,Q,V.z,V.x,V.y+1),P(G,fe,V.z,_e,V.y+1))),8&ge&&(P(G,Te,V.z,xe,V.y),le&&(P(G,Q,V.z,V.x,V.y+1),P(G,Te,V.z,xe,V.y+1)))}}const z=[];for(const O of _)_.some(B=>O.isChildOf(B))||z.push(O);if(_=z.filter(O=>!r.some(B=>!!(O.overscaledZ<o&&B.isChildOf(O))||O.equals(B)||O.isChildOf(B))),w){const O=1<<o,B=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),V=[O*B.x,O*B.y],G=4,Q=G*G;_=_.filter(W=>{const te=W.canonical.x+.5-V[0],ee=W.canonical.y+.5-V[1];return te*te+ee*ee<Q})}return _}coveringTiles(r){let o=this.coveringZoomLevel(r);const p=o,_=this.elevation&&this.elevation.exaggeration(),x=_&&!r.isTerrainDEM,w=this.projection.name==="mercator";if(r.minzoom!==void 0&&o<r.minzoom)return[];r.maxzoom!==void 0&&o>r.maxzoom&&(o=r.maxzoom);const M=this.locationCoordinate(this.center),P=this.center.lat,z=1<<o,O=[z*M.x,z*M.y,0],B=this.projection.name==="globe",V=!B,G=s.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,o,V),Q=B?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),W=z*s.bH(1,this.center.lat),te=this._camera.position[2]/s.bH(1,this.center.lat),ee=[z*Q.x,z*Q.y,te*(V?1:W)],le=B||_,pe=this.cameraToCenterDistance/r.tileSize*(r.roundZoom?1:.502),fe=this.isLODDisabled(!0)?o:0;let Te;if(this._elevation&&r.isTerrainDEM)Te=1e4*this._elevation.exaggeration();else if(this._elevation){const He=this._elevation.getMinMaxForVisibleTiles();Te=He?He.max:this._centerAltitude}else Te=this._centerAltitude;const _e=r.isTerrainDEM?-Te:this._elevation?this._elevation.getMinElevationBelowMSL():0,xe=this.projection.isReprojectedInTileSpace?s.bS(this):1,ge=He=>{const at=new s.aa(He.x+25e-6,He.y,He.z),Mt=new s.aa(He.x,He.y+25e-6,He.z),_t=He.toLngLat(),dt=at.toLngLat(),bt=Mt.toLngLat(),It=this.locationCoordinate(_t),Ot=this.locationCoordinate(dt),jt=this.locationCoordinate(bt),ui=Math.hypot(Ot.x-It.x,Ot.y-It.y),ti=Math.hypot(jt.x-It.x,jt.y-It.y);return Math.sqrt(ui*ti)*xe/25e-6},Re=He=>{const ft=Te,at=_e;return{aabb:s.bV(this,z,0,0,0,He,at,ft,this.projection),zoom:0,x:0,y:0,minZ:at,maxZ:ft,wrap:He,fullyVisible:!1}},Fe=[];let rt=[];const Ke=o,ht=r.reparseOverscaled?p:o,ut=(te-this._centerAltitude)*W,$e=He=>{if(!this._elevation||!He.tileID||!w)return;const ft=this._elevation.getMinMaxForTile(He.tileID),at=He.aabb;ft?(at.min[2]=ft.min,at.max[2]=ft.max,at.center[2]=(at.min[2]+at.max[2])/2):(He.shouldSplit=xt(He),He.shouldSplit||(at.min[2]=at.max[2]=at.center[2]=this._centerAltitude))},st=(He,ft)=>{if(.707*ft<He)return 1;const at=ft/He;return at/(1.4144271570014144+(Math.pow(1.1,at-1.4144271570014144+1)-1)/(1.1-1)-1)},xt=He=>{if(He.zoom<fe)return!0;if(He.zoom===Ke)return!1;if(He.shouldSplit!=null)return He.shouldSplit;const ft=He.aabb.distanceX(ee),at=He.aabb.distanceY(ee);let Mt=ut,_t=1;if(B){Mt=He.aabb.distanceZ(ee);const ti=Math.pow(2,He.zoom),ri=s.aS((He.y+1)/ti),fi=s.aS(He.y/ti),ki=Math.min(Math.max(P,ri),fi),en=s.c9(ki)/s.c9(P);if(_t=ki===P?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,en/this._mercatorScaleRatio),this.zoom<=s.c6&&He.zoom===Ke-1&&en>=.9)return!0}else if(x&&(Mt=He.aabb.distanceZ(ee)*W),this.projection.isReprojectedInTileSpace&&p<=5){const ti=Math.pow(2,He.zoom),ri=ge(new s.aa((He.x+.5)/ti,(He.y+.5)/ti));_t=ri>.85?1:ri}if(!w){const ti=Math.sqrt(ft*ft+at*at+Mt*Mt);let ri=(1<<Ke-He.zoom)*pe*_t;return ri*=st(Math.max(Mt,ut),ti),ti<ri}let dt=Number.MAX_VALUE,bt=0;const It=He.aabb.getCorners(),Ot=[];for(const ti of It){s.ab.vec3.sub(Ot,ti,ee),B||(x?Ot[2]*=W:Ot[2]=ut);const ri=s.ab.vec3.dot(Ot,this._camera.forward());ri<dt&&(dt=ri,bt=Math.abs(Ot[2]))}let jt=(1<<Ke-He.zoom)*pe*_t;if(jt*=st(Math.max(bt,ut),dt),dt<jt)return!0;const ui=He.aabb.closestPoint(O);return ui[0]===O[0]&&ui[1]===O[1]};if(this.renderWorldCopies)for(let He=1;He<=3;He++)Fe.push(Re(-He)),Fe.push(Re(He));for(Fe.push(Re(0));Fe.length>0;){const He=Fe.pop(),ft=He.x,at=He.y;let Mt=He.fullyVisible;const _t=()=>this.projection.name==="globe"&&(He.y===0||He.y===(1<<He.zoom)-1);if(!Mt){let dt=le?He.aabb.intersects(G):He.aabb.intersectsFlat(G);if(dt===0&&_t()){const bt=new s.bT(He.zoom,ft,at);dt=s.bU(this,z,bt,!0).intersects(G)}if(dt===0)continue;Mt=dt===2}if(He.zoom!==Ke&&xt(He))for(let dt=0;dt<4;dt++){const bt=(ft<<1)+dt%2,It=(at<<1)+(dt>>1),Ot={aabb:w?He.aabb.quadrant(dt):s.bV(this,z,He.zoom+1,bt,It,He.wrap,He.minZ,He.maxZ,this.projection),zoom:He.zoom+1,x:bt,y:It,wrap:He.wrap,fullyVisible:Mt,tileID:void 0,shouldSplit:void 0,minZ:He.minZ,maxZ:He.maxZ};x&&!B&&(Ot.tileID=new s.aG(He.zoom+1===Ke?ht:He.zoom+1,He.wrap,He.zoom+1,bt,It),$e(Ot)),Fe.push(Ot)}else{const dt=He.zoom===Ke?ht:He.zoom;if(r.minzoom&&r.minzoom>dt)continue;let bt=0;if(!Mt){let ui=le?He.aabb.intersectsPrecise(G):He.aabb.intersectsPreciseFlat(G);if(ui===0&&_t()){const ti=new s.bT(He.zoom,ft,at);ui=s.bU(this,z,ti,!0).intersectsPrecise(G)}if(ui===0)continue;if(r.calculateQuadrantVisibility)if(G.containsPoint(He.aabb.center))bt=15;else for(let ti=0;ti<4;ti++)He.aabb.quadrant(ti).intersects(G)!==0&&(bt|=1<<ti)}const It=O[0]-(.5+ft+(He.wrap<<He.zoom))*(1<<o-He.zoom),Ot=O[1]-.5-at,jt=He.tileID?He.tileID:new s.aG(dt,He.wrap,He.zoom,ft,at);r.calculateQuadrantVisibility&&(jt.visibleQuadrants=bt),rt.push({tileID:jt,distanceSq:It*It+Ot*Ot})}}if(this.fogCullDistSq){const He=this.fogCullDistSq,ft=this.horizonLineFromTop();rt=rt.filter(at=>{const Mt=[0,0,0,1],_t=[s.ag,s.ag,0,1],dt=this.calculateFogTileMatrix(at.tileID.toUnwrapped());s.ab.vec4.transformMat4(Mt,Mt,dt),s.ab.vec4.transformMat4(_t,_t,dt);const bt=s.ab.vec4.min([],Mt,_t),It=s.ab.vec4.max([],Mt,_t),Ot=s.bW(bt,It);if(Ot===0)return!0;let jt=!1;const ui=this._elevation;if(ui&&Ot>He&&ft!==0){const ti=this.calculateProjMatrix(at.tileID.toUnwrapped());let ri;r.isTerrainDEM||(ri=ui.getMinMaxForTile(at.tileID)),ri||(ri={min:_e,max:Te});const fi=s.c7(this.rotation),ki=[fi[0]*s.ag,fi[1]*s.ag,ri.max];s.ab.vec3.transformMat4(ki,ki,ti),jt=(1-ki[1])*this.height*.5<ft}return Ot<He||jt})}return rt.sort((He,ft)=>He.distanceSq-ft.distanceSq).map(He=>He.tileID)}resize(r,o){this.width=r,this.height=o,this.pixelsToGLUnits=[2/r,-2/o],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log(r)/Math.LN2}project(r){const o=s.aw(r.lat,-s.bX,s.bX),p=this.projection.project(r.lng,o);return new s.P(p.x*this.worldSize,p.y*this.worldSize)}unproject(r){return this.projection.unproject(r.x/this.worldSize,r.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/s.bH(1,this.center.lat)/this.worldSize}setLocationAtPoint(r,o){let p,_;const x=this.centerPoint;if(this.projection.name==="globe"){const M=this.worldSize;p=(o.x-x.x)/M,_=(o.y-x.y)/M}else{const M=this.pointCoordinate(o),P=this.pointCoordinate(x);p=M.x-P.x,_=M.y-P.y}const w=this.locationCoordinate(r);this.setLocation(new s.aa(w.x-p,w.y-_))}setLocation(r){this.center=this.coordinateLocation(r),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(r){return this.projection.locationPoint(this,r)}locationPoint3D(r){return this.projection.locationPoint(this,r,!0)}pointLocation(r){return this.coordinateLocation(this.pointCoordinate(r))}pointLocation3D(r){return this.coordinateLocation(this.pointCoordinate3D(r))}locationCoordinate(r,o){const p=o?s.bH(o,r.lat):void 0,_=this.projection.project(r.lng,r.lat);return new s.aa(_.x,_.y,p)}coordinateLocation(r){return this.projection.unproject(r.x,r.y)}pointRayIntersection(r,o){const p=o??this._centerAltitude,_=[r.x,r.y,0,1],x=[r.x,r.y,1,1];s.ab.vec4.transformMat4(_,_,this.pixelMatrixInverse),s.ab.vec4.transformMat4(x,x,this.pixelMatrixInverse);const w=x[3];s.ab.vec4.scale(_,_,1/_[3]),s.ab.vec4.scale(x,x,1/w);const M=_[2],P=x[2];return{p0:_,p1:x,t:M===P?0:(p-M)/(P-M)}}screenPointToMercatorRay(r){const o=[r.x,r.y,0,1],p=[r.x,r.y,1,1];return s.ab.vec4.transformMat4(o,o,this.pixelMatrixInverse),s.ab.vec4.transformMat4(p,p,this.pixelMatrixInverse),s.ab.vec4.scale(o,o,1/o[3]),s.ab.vec4.scale(p,p,1/p[3]),o[2]=s.bH(o[2],this._center.lat)*this.worldSize,p[2]=s.bH(p[2],this._center.lat)*this.worldSize,s.ab.vec4.scale(o,o,1/this.worldSize),s.ab.vec4.scale(p,p,1/this.worldSize),new s.aq([o[0],o[1],o[2]],s.ab.vec3.normalize([],s.ab.vec3.sub([],p,o)))}rayIntersectionCoordinate(r){const{p0:o,p1:p,t:_}=r,x=s.bH(o[2],this._center.lat),w=s.bH(p[2],this._center.lat);return new s.aa(s.af(o[0],p[0],_)/this.worldSize,s.af(o[1],p[1],_)/this.worldSize,s.af(x,w,_))}pointCoordinate(r,o=this._centerAltitude){return this.projection.pointCoordinate(this,r.x,r.y,o)}pointCoordinate3D(r){if(!this.elevation)return this.pointCoordinate(r);let o=this.projection.pointCoordinate3D(this,r.x,r.y);if(o)return new s.aa(o[0],o[1],o[2]);let p=0,_=this.horizonLineFromTop();if(r.y>_)return this.pointCoordinate(r);const x=.02*_,w=r.clone();for(let M=0;M<10&&_-p>x;M++){w.y=s.af(p,_,.66);const P=this.projection.pointCoordinate3D(this,w.x,w.y);P?(_=w.y,o=P):p=w.y}return o?new s.aa(o[0],o[1],o[2]):this.pointCoordinate(r)}isPointAboveHorizon(r){return this.projection.isPointAboveHorizon(this,r)}isPointOnSurface(r){if(r.y<0||r.y>this.height||r.x<0||r.x>this.width)return!1;if(this.elevation||this.zoom>=s.bY)return!this.isPointAboveHorizon(r);const o=this.pointCoordinate(r);return o.y>=0&&o.y<=1}_coordinatePoint(r,o){const p=o&&this.elevation?this.elevation.getAtPointOrZero(r,this._centerAltitude):this._centerAltitude,_=[r.x*this.worldSize,r.y*this.worldSize,p+r.toAltitude(),1];return s.ab.vec4.transformMat4(_,_,this.pixelMatrix),_[3]>0?new s.P(_[0]/_[3],_[1]/_[3]):new s.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:r,left:o}=this._edgeInsets,p=this.height-this._edgeInsets.bottom,_=this.width-this._edgeInsets.right,x=this.pointLocation3D(new s.P(o,r)),w=this.pointLocation3D(new s.P(_,r)),M=this.pointLocation3D(new s.P(_,p)),P=this.pointLocation3D(new s.P(o,p));let z=Math.min(x.lng,w.lng,M.lng,P.lng),O=Math.max(x.lng,w.lng,M.lng,P.lng),B=Math.min(x.lat,w.lat,M.lat,P.lat),V=Math.max(x.lat,w.lat,M.lat,P.lat);const G=Math.pow(2,-this.zoom)/16*270,Q=this.projection.name==="globe"?1:4,W=(te,ee,le,pe,fe)=>{const Te=(te+le)/2,_e=(ee+pe)/2,xe=new s.P(Te,_e),{lng:ge,lat:Re}=this.pointLocation3D(xe),Fe=Math.max(0,z-ge,B-Re,ge-O,Re-V);z=Math.min(z,ge),O=Math.max(O,ge),B=Math.min(B,Re),V=Math.max(V,Re),(fe<Q||Fe>G)&&(W(te,ee,Te,_e,fe+1),W(Te,_e,le,pe,fe+1))};if(W(o,r,_,r,1),W(_,r,_,p,1),W(_,p,o,p,1),W(o,p,o,r,1),this.projection.name==="globe"){const[te,ee]=s.bZ(this);te?(V=90,O=180,z=-180):ee&&(B=-90,O=180,z=-180)}return new s.az(new s.bO(z,B),new s.bO(O,V))}_getBoundsRectangular(r,o){const{top:p,left:_}=this._edgeInsets,x=this.height-this._edgeInsets.bottom,w=this.width-this._edgeInsets.right,M=new s.P(_,p),P=new s.P(w,p),z=new s.P(w,x),O=new s.P(_,x);let B=this.pointCoordinate(M,r),V=this.pointCoordinate(P,r);const G=this.pointCoordinate(z,o),Q=this.pointCoordinate(O,o),W=(te,ee)=>(ee.y-te.y)/(ee.x-te.x);return B.y>1&&V.y>=0?B=new s.aa((1-Q.y)/W(Q,B)+Q.x,1):B.y<0&&V.y<=1&&(B=new s.aa(-Q.y/W(Q,B)+Q.x,0)),V.y>1&&B.y>=0?V=new s.aa((1-G.y)/W(G,V)+G.x,1):V.y<0&&B.y<=1&&(V=new s.aa(-G.y/W(G,V)+G.x,0)),new s.az().extend(this.coordinateLocation(B)).extend(this.coordinateLocation(V)).extend(this.coordinateLocation(Q)).extend(this.coordinateLocation(G))}_getBoundsRectangularTerrain(){const r=this.elevation;if(!r.visibleDemTiles.length||r.isUsingMockSource())return this._getBoundsRectangular(0,0);const o=r.visibleDemTiles.reduce((p,_)=>{if(_.dem){const x=_.dem.tree;p.min=Math.min(p.min,x.minimums[0]),p.max=Math.max(p.max,x.maximums[0])}return p},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(o.min*r.exaggeration(),o.max*r.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(r=!0){const o=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,p=this.height/2-o*(1-this._horizonShift);return r?Math.max(0,p):p}getMaxBounds(){return this.maxBounds}setMaxBounds(r){this.maxBounds=r,this.minLat=-s.bX,this.maxLat=s.bX,this.minLng=-180,this.maxLng=180,r&&(this.minLat=r.getSouth(),this.maxLat=r.getNorth(),this.minLng=r.getWest(),this.maxLng=r.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.at(this.minLng)*this.tileSize,this.worldMaxX=s.at(this.maxLng)*this.tileSize,this.worldMinY=s.aA(this.maxLat)*this.tileSize,this.worldMaxY=s.aA(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(r,o){return this.projection.createTileMatrix(this,o,r)}calculateDistanceTileData(r){const o=r.key,p=this._distanceTileDataCache;if(p[o])return p[o];const _=r.canonical,x=1/this.height,w=this.cameraWorldSize,M=w/this.zoomScale(_.z),P=(_.x+Math.pow(2,_.z)*r.wrap)*M,z=_.y*M,O=this.point;O.x*=w/this.worldSize,O.y*=w/this.worldSize;const B=this.angle,V=Math.sin(-B),G=-Math.cos(-B);return p[o]={bearing:[V,G],center:[(O.x-P)*x,(O.y-z)*x],scale:M/s.ag*x},p[o]}calculateFogTileMatrix(r){const o=r.key,p=this._fogTileMatrixCache;if(p[o])return p[o];const _=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,r);return s.ab.mat4.multiply(_,this.worldToFogMatrix,_),p[o]=new Float32Array(_),p[o]}calculateProjMatrix(r,o=!1,p=!1){const _=r.key;let x;if(x=p?this._expandedProjMatrixCache:o?this._alignedProjMatrixCache:this._projMatrixCache,x[_])return x[_];const w=this.calculatePosMatrix(r,this.worldSize);let M;return M=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:p?this.expandedFarZProjMatrix:o?this.alignedProjMatrix:this.projMatrix,s.ab.mat4.multiply(w,M,w),x[_]=new Float32Array(w),x[_]}calculatePixelsToTileUnitsMatrix(r){const o=r.tileID.key,p=this._pixelsToTileUnitsCache;if(p[o])return p[o];const _=s.b_(r,this);return p[o]=_,p[o]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const r=1/this.worldSize,o=s.ab.mat4.fromScaling([],[r,r,r]);return s.ab.mat4.multiply(o,o,this.globeMatrix),o}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const r=this._elevation;this._updateCameraState();const o=s.bH(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(o),_=this._camera.forward(),x=s.bH(1,this._center.lat);p[2]/=x,_[2]/=x,s.ab.vec3.normalize(_,_);const w=r.raycast(p,_,r.exaggeration());if(w){const M=s.ab.vec3.scaleAndAdd([],p,_,w),P=new s.aa(M[0],M[1],s.bH(M[2],s.aS(M[1]))),z=(P.z+s.ab.vec3.length([P.x-p[0],P.y-p[1],P.z-p[2]*x]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(z),this._centerAltitude=P.toAltitude(),this._center=this.coordinateLocation(P),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(r=!1){if(!this._elevation)return;const o=this._elevation,p=s.bH(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(p),x=o.getAtPointOrZero(new s.aa(..._)),w=this.pixelsPerMeter/this.worldSize*x,M=this._minimumHeightOverTerrain(),P=_[2]-w;if(P<=M)if(P<0||r){const z=this.locationCoordinate(this._center,this._centerAltitude),O=[_[0],_[1],z.z-_[2]],B=s.ab.vec3.length(O);O[2]-=(M-P)/this._pixelsPerMercatorPixel;const V=s.ab.vec3.length(O);if(V===0)return;s.ab.vec3.scale(O,O,B/V*this._pixelsPerMercatorPixel),this._camera.position=[_[0],_[1],z.z*this._pixelsPerMercatorPixel-O[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const r=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||r){const V=this.center;return V.lat=s.aw(V.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!r)&&(V.lng=s.aw(V.lng,this.minLng,this.maxLng)),this.center=V,void(this._constraining=!1)}const o=this._unmodified,{x:p,y:_}=this.point;let x=0,w=p,M=_;const P=this.width/2,z=this.height/2,O=this.worldMinY*this.scale,B=this.worldMaxY*this.scale;if(_-z<O&&(M=O+z),_+z>B&&(M=B-z),B-O<this.height&&(x=Math.max(x,this.height/(B-O)),M=(B+O)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const V=this.worldMinX*this.scale,G=this.worldMaxX*this.scale,Q=this.worldSize/2-(V+G)/2;w=(p+Q+this.worldSize)%this.worldSize-Q,w-P<V&&(w=V+P),w+P>G&&(w=G-P),G-V<this.width&&(x=Math.max(x,this.width/(G-V)),w=(G+V)/2)}w===p&&M===_||(this.center=this.unproject(new s.P(w,M))),x&&(this.zoom+=this.scaleZoom(x)),this._constrainCamera(),this._unmodified=o,this._constraining=!1}_minZoomForBounds(){let r=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(r=Math.max(r,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),r}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const r=this.centerOffset,o=this.projection.name==="globe",p=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=s.bH(1,this.center.lat)/s.bH(1,s.c8));const _=s.b$(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,_),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const x=this.projection.zAxisUnit==="meters"?p:1,w=this._camera.getWorldToCamera(this.worldSize,x);let M;const P=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(P[8]=2*-r.x/this.width,P[9]=2*r.y/this.height,this.isOrthographic){let Re=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Fe=Re*this.aspect,rt=-Fe,Ke=-Re;Fe-=r.x,rt-=r.x,Re+=r.y,Ke+=r.y,M=this._camera.getCameraToClipOrthographic(rt,Fe,Ke,Re,this._nearZ,this._farZ),((ht,ut,$e,st)=>{for(let xt=0;xt<16;xt++)ht[xt]=ig(ut[xt],$e[xt],st)})(M,M,P,jf(this.pitch>=15?1:this.pitch/15))}else M=P;const z=s.ab.mat4.mul([],P,w);let O=s.ab.mat4.mul([],M,w);if(this.projection.isReprojectedInTileSpace){const Re=this.locationCoordinate(this.center),Fe=s.ab.mat4.identity([]);s.ab.mat4.translate(Fe,Fe,[Re.x*this.worldSize,Re.y*this.worldSize,0]),s.ab.mat4.multiply(Fe,Fe,s.c0(this)),s.ab.mat4.translate(Fe,Fe,[-Re.x*this.worldSize,-Re.y*this.worldSize,0]),s.ab.mat4.multiply(O,O,Fe),s.ab.mat4.multiply(z,z,Fe),this.inverseAdjustmentMatrix=s.c1(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=s.ab.mat4.scale([],O,[this.worldSize,this.worldSize,this.worldSize/x,1]),this.projMatrix=O,this.invProjMatrix=s.ab.mat4.invert(new Float64Array(16),this.projMatrix),o){const Re=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Re[8]=2*-r.x/this.width,Re[9]=2*r.y/this.height,this.expandedFarZProjMatrix=s.ab.mat4.mul([],Re,w)}else this.expandedFarZProjMatrix=this.projMatrix;const B=s.ab.mat4.invert([],M);this.frustumCorners=s.c2.fromInvProjectionMatrix(B,this.horizonLineFromTop(),this.height),this.cameraFrustum=s.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!o);const V=new Float32Array(16);s.ab.mat4.identity(V),s.ab.mat4.scale(V,V,[1,-1,1]),s.ab.mat4.rotateX(V,V,this._pitch),s.ab.mat4.rotateZ(V,V,this.angle);const G=s.ab.mat4.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=s.ab.mat4.clone(G);const Q=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;G[8]=2*-r.x/this.width,G[9]=2*(r.y+Q)/this.height,this.skyboxMatrix=s.ab.mat4.multiply(V,G,V);const W=this.point,te=W.x,ee=W.y,le=this.width%2/2,pe=this.height%2/2,fe=Math.cos(this.angle),Te=Math.sin(this.angle),_e=te-Math.round(te)+fe*le+Te*pe,xe=ee-Math.round(ee)+fe*pe+Te*le,ge=new Float64Array(O);if(s.ab.mat4.translate(ge,ge,[_e>.5?_e-1:_e,xe>.5?xe-1:xe,0]),this.alignedProjMatrix=ge,O=s.ab.mat4.create(),s.ab.mat4.scale(O,O,[this.width/2,-this.height/2,1]),s.ab.mat4.translate(O,O,[1,-1,0]),this.labelPlaneMatrix=O,O=s.ab.mat4.create(),s.ab.mat4.scale(O,O,[1,-1,1]),s.ab.mat4.translate(O,O,[-1,-1,0]),s.ab.mat4.scale(O,O,[2/this.width,2/this.height,1]),this.glCoordMatrix=O,this.pixelMatrix=s.ab.mat4.multiply(new Float64Array(16),this.labelPlaneMatrix,z),this._calcFogMatrices(),this._distanceTileDataCache={},O=s.ab.mat4.invert(new Float64Array(16),this.pixelMatrix),!O)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=O,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=s.c3(this);const Re=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=s.ab.vec3.transformMat4(Re,Re,w),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=O;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const r=this.cameraWorldSizeForFog,o=this.cameraPixelsPerMeter,p=this._camera.position,_=1/this.height/this._pixelsPerMercatorPixel,x=[r,r,o];s.ab.vec3.scale(x,x,_),s.ab.vec3.scale(p,p,-1),s.ab.vec3.multiply(p,p,x);const w=s.ab.mat4.create();s.ab.mat4.translate(w,w,p),s.ab.mat4.scale(w,w,x),this.mercatorFogMatrix=w,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(r,o,_)}_computeCameraPosition(r){const o=(r=r||this.pixelsPerMeter)/this.pixelsPerMeter,p=this._camera.forward(),_=this.point,x=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*o-r/this.worldSize*this._centerAltitude;return[_.x/this.worldSize-p[0]*x,_.y/this.worldSize-p[1]*x,r/this.worldSize*this._centerAltitude-p[2]*x]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(r){const o=this._maxCameraBoundsDistance()*Math.cos(this._pitch),p=this._camera.position[2],_=r[2];let x=1;this.projection.wrap&&(this.center=this.center.wrap()),_>0&&(x=Math.min((o-p)/_,1)),this._camera.position=s.ab.vec3.scaleAndAdd([],this._camera.position,r,x),this._updateStateFromCamera()}_updateStateFromCamera(){const r=this._camera.position,o=this._camera.forward(),{pitch:p,bearing:_}=this._camera.getPitchBearing(),x=s.bH(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,w=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.ai(this._maxPitch)),M=Math.max((r[2]-x)/Math.cos(p),w),P=this._zoomFromMercatorZ(M);s.ab.vec3.scaleAndAdd(r,r,o,M),this._pitch=s.aw(p,s.ai(this.minPitch),s.ai(this.maxPitch)),this.angle=s.bF(_,-Math.PI,Math.PI),this._setZoom(s.aw(P,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new s.aa(r[0],r[1],r[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(r){return Math.pow(2,r)*this.tileSize}_mercatorZfromZoom(r){return this.cameraToCenterDistance/this._worldSizeFromZoom(r)}_minimumHeightOverTerrain(){const r=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(r)}_zoomFromMercatorZ(r){return this.scaleZoom(this.cameraToCenterDistance/(r*this.tileSize))}zoomFromMercatorZAdjusted(r){let o=0,p=s.bY,_=0,x=1/0;for(;p-o>1e-6&&p>o;){const w=o+.5*(p-o),M=this.tileSize*Math.pow(2,w),P=this.getCameraToCenterDistance(this.projection,w,M),z=this.scaleZoom(P/(r*this.tileSize)),O=Math.abs(w-z);O<x&&(x=O,_=w),w<z?o=w:p=w}return _}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(r,o){const p=Math.min(r.x,o.x),_=Math.max(r.x,o.x),x=Math.min(r.y,o.y),w=Math.max(r.y,o.y);if(x<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const M=[new s.P(p,x),new s.P(_,w),new s.P(p,w),new s.P(_,x)],P=this.renderWorldCopies?-3:0,z=this.renderWorldCopies?4:1;for(const O of M){const B=this.pointRayIntersection(O);if(B.t<0)return!0;const V=this.rayIntersectionCoordinate(B);if(V.x<P||V.y<0||V.x>z||V.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.c4(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.P(0,0),new s.P(this.width,this.height))}zoomDeltaToMovement(r,o){const p=s.ab.vec3.length(s.ab.vec3.sub([],this._camera.position,r)),_=this._zoomFromMercatorZ(p)+o;return p-this._mercatorZfromZoom(_)}getCameraPoint(){if(this.projection.name==="globe"){const r=function([o,p,_],x){const w=[o,p,_,1];s.ab.vec4.transformMat4(w,w,x);const M=w[3]=Math.max(w[3],1e-6);return w[0]/=M,w[1]/=M,w[2]/=M,w}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new s.P(r[0],r[1])}{const r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,r))}}getCameraToCenterDistance(r,o=this.zoom,p=this.worldSize){const _=s.b$(r,o,this.width,this.height,1024),x=r.pixelSpaceConversion(this.center.lat,p,_);let w=.5/Math.tan(.5*this._fov)*this.height*x;return this.isOrthographic&&(w=ig(1,w,jf(this.pitch>=15?1:this.pitch/15))),w}getWorldToCameraMatrix(){const r=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&s.ab.mat4.multiply(r,r,this.globeMatrix),r}getFrustum(r){return s.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,r,this.projection.zAxisUnit==="meters")}}const Ul=(f,r)=>{if(r>0&&f.terrain&&s.w("Cutoff is currently disabled on terrain"),r<=0||f.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const o=f.transform,p=Math.max(Math.abs(o._zoom-(f.minCutoffZoom-1)),1),_=o.isLODDisabled(!1)?s.ac(60,45,o.pitch):s.ac(30,15,o.pitch),x=o._farZ-o._nearZ,w=r*o.height,M=((1-(P=_))*o.cameraToCenterDistance+P*(o._farZ+w))*p;var P;return{shouldRenderCutoff:_<1,uniformValues:{u_cutoff_params:[o._nearZ,o._farZ,(M-o._nearZ)/x,(M-w-o._nearZ)/x]}}},qr={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class ol{constructor(r,o){this.aabb=r,this.lastCascade=o}}class ng{add(r,o){const p=this.receivers[r.key];p!==void 0?(p.aabb.min[0]=Math.min(p.aabb.min[0],o.min[0]),p.aabb.min[1]=Math.min(p.aabb.min[1],o.min[1]),p.aabb.min[2]=Math.min(p.aabb.min[2],o.min[2]),p.aabb.max[0]=Math.max(p.aabb.max[0],o.max[0]),p.aabb.max[1]=Math.max(p.aabb.max[1],o.max[1]),p.aabb.max[2]=Math.max(p.aabb.max[2],o.max[2])):this.receivers[r.key]=new ol(o,null)}clear(){this.receivers={}}get(r){return this.receivers[r.key]}computeRequiredCascades(r,o,p){const _=s.cd.fromPoints(r.points);let x=0;for(const w in this.receivers){const M=this.receivers[w];if(!M||!_.intersectsAabb(M.aabb))continue;M.aabb.min=_.closestPoint(M.aabb.min),M.aabb.max=_.closestPoint(M.aabb.max);const P=M.aabb.getCorners();for(let z=0;z<p.length;z++){let O=!0;for(const B of P){const V=[B[0]*o,B[1]*o,B[2]];if(s.ab.vec3.transformMat4(V,V,p[z].matrix),V[0]<-1||V[0]>1||V[1]<-1||V[1]>1){O=!1;break}}if(M.lastCascade=z,x=Math.max(x,z),O)break}}return x+1}}class Ac{constructor(r){this.painter=r,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new ng,this._depthMode=new Ht(r.context.gl.LEQUAL,Ht.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,r.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),r.tp.registerParameter(qr,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),r.tp.registerParameter(qr,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),r.tp.registerParameter(qr,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),r.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const r of this._cascades)r.texture.destroy(),r.framebuffer.destroy();this._cascades=[]}updateShadowParameters(r,o){const p=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!o||!o.properties)return;const _=o.properties.get("shadow-intensity");if(!o.shadowsEnabled()||_<=0||(this._shadowLayerCount=p.style.order.reduce((Q,W)=>{const te=p.style._mergedLayers[W];return Q+(te.hasShadowPass()&&!te.isHidden(r.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const x=p.context,w=qr.shadowMapResolution,M=qr.shadowMapResolution;if(this._cascades.length===0||qr.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let Q=0;Q<qr.cascadeCount;++Q){const W=p._shadowMapDebug,te=x.gl,ee=x.createFramebuffer(w,M,W,"texture"),le=new s.T(x,{width:w,height:M,data:null},te.DEPTH_COMPONENT16);if(ee.depthAttachment.set(le.texture),W){const pe=new s.T(x,{width:w,height:M,data:null},te.RGBA8);ee.colorAttachment.set(pe.texture)}this._cascades.push({framebuffer:ee,texture:le,matrix:[],far:0,boundingSphereRadius:0,frustum:new s.bR,scale:0})}}this.shadowDirection=Mc(o);let P=0;if(r.elevation){const Q=r.elevation,W=[1e4,-1e4];Q.visibleDemTiles.filter(te=>te.dem).forEach(te=>{const ee=te.dem.tree;W[0]=Math.min(W[0],ee.minimums[0]),W[1]=Math.max(W[1],ee.maximums[0])}),W[0]!==1e4&&(P=(W[1]-W[0])*Q.exaggeration())}const z=1.5*r.cameraToCenterDistance,O=3*z,B=new Float64Array(16);for(let Q=0;Q<this._cascades.length;++Q){const W=this._cascades[Q];let te=r.height/50,ee=1;qr.cascadeCount===1?ee=O:Q===0?ee=z:(te=z,ee=O);const[le,pe]=Gb(r,this.shadowDirection,te,ee,qr.shadowMapResolution,P);W.scale=r.scale,W.matrix=le,W.boundingSphereRadius=pe,s.ab.mat4.invert(B,W.matrix),W.frustum=s.bR.fromInvProjectionMatrix(B,1,0,!0),W.far=ee}const V=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[V].far,this._cascades[V].far],this._uniformValues.u_shadow_intensity=_,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/qr.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=qr.shadowMapResolution,this._uniformValues.u_shadowmap_0=Yr.ShadowMap0,this._uniformValues.u_shadowmap_1=Yr.ShadowMap0+1,this._groundShadowTiles=p.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const G=p.transform.elevation;for(const Q of this._groundShadowTiles){let W={min:0,max:0};if(G){const te=G.getMinMaxForTile(Q);te&&(W=te)}this.addShadowReceiver(Q.toUnwrapped(),W.min,W.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(r){this._enabled=r}drawShadowPass(r,o){if(!this.enabled)return;const p=this.painter,_=p.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(p.transform.getFrustum(0),p.transform.worldSize,this._cascades),_.viewport.set([0,0,qr.shadowMapResolution,qr.shadowMapResolution]);for(let x=0;x<this._numCascadesToRender;++x){p.currentShadowCascade=x,_.bindFramebuffer.set(this._cascades[x].framebuffer.framebuffer),_.clear({color:s.aj.white,depth:1});for(const w of r.order){const M=r._mergedLayers[w];if(!M.hasShadowPass()||M.isHidden(p.transform.zoom))continue;const P=r.getLayerSourceCache(M),z=P?o[P.id]:void 0;(M.type==="model"||z&&z.length)&&p.renderLayer(p,P,M,z)}}p.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const r=this.painter,o=r.style,p=r.context,_=o.directionalLight,x=o.ambientLight;if(!_||!x)return;const w=[],M=Ul(r,r.longestCutoffRange);M.shouldRenderCutoff&&w.push("RENDER_CUTOFF"),w.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&w.push("NORMAL_OFFSET");const P=rg(o,_,x),z=new Ht(p.gl.LEQUAL,Ht.ReadOnly,r.depthRangeFor3D);for(const O of this._groundShadowTiles){const B=O.toUnwrapped(),V=r.isTileAffectedByFog(O),G=r.getOrCreateProgram("groundShadow",{defines:w,overrideFog:V});this.setupShadows(B,G),r.uploadCommonUniforms(p,G,B,null,M);const Q={u_matrix:r.transform.calculateProjMatrix(B),u_ground_shadow_factor:P};G.draw(r,p.gl.TRIANGLES,z,Kt.disabled,ni.multiply,li.disabled,Q,"ground_shadow",r.tileExtentBuffer,r.quadTriangleIndexBuffer,r.tileExtentSegments,{},r.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?ni.unblended:ni.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(r){const o=this.painter.transform,p=o.calculatePosMatrix(r,o.worldSize);return s.ab.mat4.multiply(p,this._cascades[this.painter.currentShadowCascade].matrix,p),Float32Array.from(p)}calculateShadowPassMatrixFromMatrix(r){return s.ab.mat4.multiply(r,this._cascades[this.painter.currentShadowCascade].matrix,r),Float32Array.from(r)}setupShadows(r,o,p,_=0){if(!this.enabled)return;const x=this.painter.transform,w=this.painter.context,M=w.gl,P=this._uniformValues,z=new Float64Array(16),O=x.calculatePosMatrix(r,x.worldSize);for(let B=0;B<this._cascades.length;B++)s.ab.mat4.multiply(z,this._cascades[B].matrix,O),P[B===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(z),w.activeTexture.set(M.TEXTURE0+Yr.ShadowMap0+B),this._cascades[B].texture.bind(M.NEAREST,M.CLAMP_TO_EDGE);if(this.useNormalOffset=!!p,this.useNormalOffset){const B=s.cc(r.canonical),V=2/x.tileSize*s.ag/qr.shadowMapResolution,G=V*this._cascades[0].boundingSphereRadius,Q=V*this._cascades[this._cascades.length-1].boundingSphereRadius,W=(p==="vector-tile"?1:3)/Math.pow(2,_-r.canonical.z-(1-x.zoom+Math.floor(x.zoom)));P.u_shadow_normal_offset=[B,G*W,Q*W],P.u_shadow_bias=[6e-5,.0012,.012]}else P.u_shadow_bias=[36e-5,.0012,.012];o.setShadowUniformValues(w,P)}setupShadowsFromMatrix(r,o,p=!1){if(!this.enabled)return;const _=this.painter.context,x=_.gl,w=this._uniformValues,M=new Float64Array(16);for(let P=0;P<qr.cascadeCount;P++)s.ab.mat4.multiply(M,this._cascades[P].matrix,r),w[P===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(M),_.activeTexture.set(x.TEXTURE0+Yr.ShadowMap0+P),this._cascades[P].texture.bind(x.NEAREST,x.CLAMP_TO_EDGE);if(this.useNormalOffset=p,p){const P=qr.normalOffset;w.u_shadow_normal_offset=[1,P,P],w.u_shadow_bias=[6e-5,.0012,.012]}else w.u_shadow_bias=[36e-5,.0012,.012];o.setShadowUniformValues(_,w)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(r,o,p,_){if(_[2]>=0)return{};const x=function(P,z,O){const B=O/(1<<P.canonical.z);return new s.cd([P.canonical.x*B+P.wrap*O,P.canonical.y*B+P.wrap*O,0],[(P.canonical.x+1)*B+P.wrap*O,(P.canonical.y+1)*B+P.wrap*O,z])}(r,o,p).getCorners(),w=o/-_[2];_[0]<0?(s.ab.vec3.add(x[0],x[0],[_[0]*w,0,0]),s.ab.vec3.add(x[3],x[3],[_[0]*w,0,0])):_[0]>0&&(s.ab.vec3.add(x[1],x[1],[_[0]*w,0,0]),s.ab.vec3.add(x[2],x[2],[_[0]*w,0,0])),_[1]<0?(s.ab.vec3.add(x[0],x[0],[0,_[1]*w,0]),s.ab.vec3.add(x[1],x[1],[0,_[1]*w,0])):_[1]>0&&(s.ab.vec3.add(x[2],x[2],[0,_[1]*w,0]),s.ab.vec3.add(x[3],x[3],[0,_[1]*w,0]));const M={};return M.vertices=x,M.planes=[Ic(x[1],x[0],x[4]),Ic(x[2],x[1],x[5]),Ic(x[3],x[2],x[6]),Ic(x[0],x[3],x[7])],M}addShadowReceiver(r,o,p){this._receivers.add(r,s.cd.fromTileIdAndHeight(r,o,p))}getMaxCascadeForTile(r){const o=this._receivers.get(r);return o&&o.lastCascade?o.lastCascade:0}}function Ic(f,r,o){const p=s.ab.vec3.sub([],o,r),_=s.ab.vec3.sub([],f,r),x=s.ab.vec3.cross([],p,_),w=s.ab.vec3.length(x);return w===0?[0,0,1,0]:(s.ab.vec3.scale(x,x,1/w),[x[0],x[1],x[2],-s.ab.vec3.dot(x,r)])}function Mc(f){const r=f.properties.get("direction"),o=s.cb(r.x,r.y,r.z);o[2]=s.aw(o[2],0,75);const p=s.ce([o[0],o[1],o[2]]);return s.ab.vec3.fromValues(p.x,p.y,p.z)}function rg(f,r,o){const p=r.properties.get("color-use-theme")==="none",_=r.properties.get("color"),x=r.properties.get("intensity"),w=r.properties.get("direction"),M=[w.x,w.y,w.z],P=o.properties.get("color-use-theme")==="none",z=o.properties.get("color"),O=o.properties.get("intensity"),B=Math.max(s.ab.vec3.dot([0,0,1],M),0),V=[0,0,0];s.ab.vec3.scale(V,z.toRenderColor(P?null:f.getLut(r.scope)).toArray01Linear().slice(0,3),O);const G=[0,0,0];return s.ab.vec3.scale(G,_.toRenderColor(p?null:f.getLut(o.scope)).toArray01Linear().slice(0,3),B*x),s.cf([V[0]>0?V[0]/(V[0]+G[0]):0,V[1]>0?V[1]/(V[1]+G[1]):0,V[2]>0?V[2]/(V[2]+G[2]):0])}function Gb(f,r,o,p,_,x){const w=f.zoom,M=f.scale,P=f.worldSize,z=1/P,O=f.aspect,B=Math.sqrt(1+O*O)*Math.tan(.5*f.fovX),V=B*B,G=p-o,Q=p+o;let W,te;V>G/Q?(W=p,te=p*B):(W=.5*Q*(1+V),te=.5*Math.sqrt(G*G+2*(p*p+o*o)*V+Q*Q*V*V));const ee=f.projection.pixelsPerMeter(f.center.lat,P),le=f._camera.getCameraToWorldMercator(),pe=[0,0,-W*z];s.ab.vec3.transformMat4(pe,pe,le);let fe=te*z;const Te=f._edgeInsets;if(!(Te.left===0&&Te.top===0&&Te.right===0&&Te.bottom===0||Te.left===Te.right&&Te.top===Te.bottom)){const Mt=f._camera.getWorldToCamera(f.worldSize,f.projection.zAxisUnit==="meters"?ee:1),_t=f._camera.getCameraToClipPerspective(f._fov,f.width/f.height,o,p);_t[8]=2*-f.centerOffset.x/f.width,_t[9]=2*f.centerOffset.y/f.height;const dt=new Float64Array(16);s.ab.mat4.mul(dt,_t,Mt);const bt=new Float64Array(16);s.ab.mat4.invert(bt,dt);const It=s.bR.fromInvProjectionMatrix(bt,P,w,!0);for(const Ot of It.points){const jt=((_e=Ot)[0]/=M,_e[1]/=M,_e[2]=s.bH(_e[2],f._center.lat),_e);fe=Math.max(fe,s.ab.vec3.len(s.ab.vec3.subtract([],pe,jt)))}}var _e;fe*=_/(_-1);const xe=Math.acos(r[2]),ge=Math.atan2(-r[0],-r[1]),Re=new Ns;Re.position=pe,Re.setPitchBearing(xe,ge);const Fe=Re.getWorldToCamera(P,ee),rt=fe*P,Ke=Math.min(f._mercatorZfromZoom(17)*P*-2,-2*rt),ht=Re.getCameraToClipOrthographic(-rt,rt,-rt,rt,Ke,(rt+x*ee)/r[2]),ut=new Float64Array(16);s.ab.mat4.multiply(ut,ht,Fe);const $e=s.ab.vec3.fromValues(Math.floor(1e6*pe[0])/1e6*P,Math.floor(1e6*pe[1])/1e6*P,0),st=.5*_,xt=[0,0,0];s.ab.vec3.transformMat4(xt,$e,ut),s.ab.vec3.scale(xt,xt,st);const He=[Math.floor(xt[0]),Math.floor(xt[1]),Math.floor(xt[2])],ft=[0,0,0];s.ab.vec3.sub(ft,xt,He),s.ab.vec3.scale(ft,ft,-1/st);const at=new Float64Array(16);return s.ab.mat4.identity(at),s.ab.mat4.translate(at,at,ft),s.ab.mat4.multiply(ut,at,ut),[ut,rt]}class sg extends s.E{constructor(r){super(),this.requestManager=r,this.models={"":{}},this.modelUris={"":{}},this.numModelsLoading={}}loadModel(r,o){return s.aM(this.requestManager.transformRequest(o,s.R.Model).url).then(p=>{if(!p)return;const _=s.aN(p),x=new s.aO(r,void 0,void 0,_);return x.computeBoundsAndApplyParent(),x}).catch(p=>{if(p&&p.status===404)return null;this.fire(new s.y(new Error(`Could not load model ${r} from ${o}: ${p.message}`)))})}load(r,o,p={keepNumReferences:!1}){this.models[o]||(this.models[o]={});const _=Object.keys(r);this.numModelsLoading[o]=(this.numModelsLoading[o]||0)+_.length;const x=[];for(const w of _)x.push(this.loadModel(w,r[w]));Promise.allSettled(x).then(w=>{for(let M=0;M<w.length;M++){const{status:P,value:z}=w[M];if(P==="fulfilled"&&z){const O=this.models[o][_[M]];this.models[o][_[M]]={model:z,numReferences:p.keepNumReferences&&O?O.numReferences:1}}}this.numModelsLoading[o]-=_.length,this.fire(new s.z("data",{dataType:"style"}))}).catch(w=>{this.fire(new s.y(new Error(`Could not load models: ${w.message}`)))})}isLoaded(){for(const r in this.numModelsLoading)if(this.numModelsLoading[r]>0)return!1;return!0}hasModel(r,o){return!!this.getModel(r,o)}getModel(r,o){return this.models[o]||(this.models[o]={}),this.models[o][r]?this.models[o][r].model:void 0}addModel(r,o,p){this.models[p]||(this.models[p]={}),this.modelUris[p]||(this.modelUris[p]={}),this.hasModel(r,p)&&this.models[p][r].numReferences++,this.modelUris[p][r]=this.requestManager.normalizeModelURL(o),this.load({[r]:this.modelUris[p][r]},p)}addModels(r,o){this.models[o]||(this.models[o]={}),this.modelUris[o]||(this.modelUris[o]={});const p=this.modelUris[o];for(const _ in r)this.models[o][_]={},p[_]=this.requestManager.normalizeModelURL(r[_]);this.load(p,o,{keepNumReferences:!0})}reloadModels(r){this.load(this.modelUris[r],r)}addModelsFromBucket(r,o){this.models[o]||(this.models[o]={}),this.modelUris[o]||(this.modelUris[o]={});const p={};for(const _ of r)this.hasModel(_,o)?this.models[o][_].numReferences++:(this.modelUris[o][_]=this.requestManager.normalizeModelURL(_),p[_]=this.modelUris[o][_]);this.load(p,o)}removeModel(r,o){if(this.models[o]&&this.models[o][r]&&(this.models[o][r].numReferences--,this.models[o][r].numReferences===0)){const p=this.models[o][r].model;delete this.models[o][r],delete this.modelUris[o][r],p.destroy()}}listModels(r){return this.models[r]||(this.models[r]={}),Object.keys(this.models[r])}upload(r,o){this.models[o]||(this.models[o]={});for(const p in this.models[o])this.models[o][p].model&&this.models[o][p].model.upload(r.context)}}const Hb=new s.a5({data:new s.a6(s.a3.colorTheme.data)}),I0={"mbx-indoor-active-floorplans":{default:["literal",[]]},"mbx-indoor-underground":{default:["literal",!1]},"mbx-indoor-loaded-levels":{default:["literal",[]]},"mbx-indoor-level-height":{default:["literal",{}]},"mbx-indoor-level-base":{default:["literal",{}]},"mbx-indoor-level-selected":{default:["literal",{}]},"mbx-indoor-level-overlapped":{default:["literal",{}]}};function ag(f){return f=f||{},Object.assign(f,I0)}class og extends s.E{constructor(r){super(),this.mergeFloors=!0,this._scope=void 0,this._queryFeatureSetId=void 0,this._buildingEntryFeatureSetId=void 0,this._selectedFloorplan=void 0,this._indoorData=void 0,this._selectedLevel=void 0,this._floorplanStates={},s.aP(["_onLoad","_onMove","_checkFloorplanVisible"],this),this._map=r,this._checkFloorplanVisible(!0),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=void 0}_onLoad(){this._map.style.forEachFragmentStyle(r=>{r.stylesheet.indoor&&(this._queryFeatureSetId?this.fire(new s.y(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._queryFeatureSetId=r.stylesheet.indoor.floorplanFeaturesetId,this._buildingEntryFeatureSetId=r.stylesheet.indoor.buildingFeaturesetId,this._scope=r.scope))}),this._queryFeatureSetId&&this._buildingEntryFeatureSetId&&this._map.addInteraction("mbx-indoor-buildingclick",{type:"click",target:{featuresetId:this._buildingEntryFeatureSetId,importId:this._scope},handler:r=>(r.feature&&r.feature.properties.floorplan&&this.selectFloorplan(r.feature.properties.floorplan),!0)}),this._checkFloorplanVisible(!0)}_onMove(){this._checkFloorplanVisible(!1)}_checkFloorplanVisible(r){if(!this._queryFeatureSetId||!this._map.isStyleLoaded()||this._map.transform.zoom<13)return;this._indoorData&&!function(w,M){const[P,z]=w,{center:O,radius:B}=M,[V,G]=O,Q=Math.abs(P-V);return Math.sqrt((Q>180?360-Q:Q)**2+(z-G)**2)<=B}([this._map.getCenter().lng,this._map.getCenter().lat],this._indoorData.circumCircle)&&(this._indoorData=void 0,this._selectedFloorplan=void 0,this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[]]),this.fire(new s.z("floorplangone")));const o={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},p=new s.P(this._map.transform.width/2,this._map.transform.height/2),_=[new s.P(0,0),new s.P(this._map.transform.width,this._map.transform.height)],x=this._map.queryRenderedFeatures(r?_:p,o);x.length>0&&(this._selectedFloorplan&&x[0].properties.id===this._selectedFloorplan.properties.id||(this._selectedFloorplan=x[0],this._floorplanSelected(!1)))}_floorplanSelected(r){this._indoorData=JSON.parse(this._selectedFloorplan.properties["indoor-data"]),this._indoorData.id=this._selectedFloorplan.properties.id,this._indoorData.circumCircle=function(x){const[[w,M],[P,z]]=x,O=(P-w+360)%360,B=O>180?360-O:O;return{center:[(w+B/2+360)%360,(M+z)/2],radius:Math.sqrt(B**2+(z-M)**2)/2}}(this._indoorData.extent),this._floorplanStates[this._indoorData.id]||(this._floorplanStates[this._indoorData.id]={});const o=this._floorplanStates[this._indoorData.id].selectedBuilding,p=this._floorplanStates[this._indoorData.id].selectedLevel;let _;if(this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",this._indoorData.floorplanIDs),this._selectedLevel)for(const x of this._indoorData.levels)x.id===this._selectedLevel.id&&(_=x.id);if(this.fire(new s.z("floorplanselected",{buildings:this._indoorData.buildings,levels:this._indoorData.levels,selectedLevelId:_})),o){const x=this._indoorData.buildings.find(w=>w.id===o);this._buildingSelected(x,!1)}else this._indoorData.buildings.length>0&&this._buildingSelected(this._indoorData.buildings[0],!1);if(p){const x=this._indoorData.levels.find(w=>w.id===p);this._updateLevels(x,r)}else r&&this._indoorData["default-levels"].length>0&&this.selectLevel(this._indoorData["default-levels"][0])}_buildingSelected(r,o){o&&r&&r.extent&&this._map.fitBounds(r.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),this._floorplanStates[this._indoorData.id].selectedBuilding=r?r.id:void 0;const p=this._indoorData.levels.filter(_=>r.levels.includes(_.id));this.fire(new s.z("buildingselected",{buildingId:r.id,levels:p}))}_levelSelected(r){if(r==="overview")this._updateLevels(void 0,!0);else{const o=this._indoorData.levels.find(p=>p.id===r);this._updateLevels(o,!0)}this.fire(new s.z("levelselected",{levelId:r==="overview"?void 0:r}))}_updateLevels(r,o){if(!r)return this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",[]]),this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._floorplanStates[this._indoorData.id].selectedLevel=void 0,void(o&&this._indoorData.extent&&this._map.fitBounds(this._indoorData.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}));function p(z){const O=z.indexOf("/floor/");if(O===-1)return z;const B=O+7,V=z.indexOf("/",B);return V===-1?z.slice(B):z.slice(B,V)}this._selectedLevel=r,this._floorplanStates[this._indoorData.id].selectedLevel=r?r.id:void 0;const _=[],x={},w={},M={},P={};for(const z of this._indoorData.levels)if(_.push(z.id),x[z.id]=z.height,w[z.id]=z.base,r){if(this.mergeFloors){const O=p(r.id),B=p(z.id);M[z.id]=B===O?"true":"false"}else M[z.id]=z.id===r.id?"true":"false";P[z.id]=z.base<r.base?"true":"false"}else P[z.id]=!0;if(this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",_]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-height",["literal",x]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-base",["literal",w]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",M]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-overlapped",["literal",P]),r&&(this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!!r.isUnderground),o&&r.extent)){const z=this._map.cameraForBounds(r.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),O=this._map.getZoom(),B=z.zoom?Math.abs(O-z.zoom):0;this._map.fitBounds(r.extent,B>=1?{pitch:this._map.getPitch(),bearing:this._map.getBearing()}:{pitch:this._map.getPitch(),bearing:this._map.getBearing(),zoom:O})}}selectFloorplan(r){const o={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},p=[new s.P(0,0),new s.P(this._map.transform.width,this._map.transform.height)],_=this._map.queryRenderedFeatures(p,o);if(_.length>0){for(const x of _)if(JSON.parse(x.properties["indoor-data"]).floorplanIDs.includes(r)){this._selectedFloorplan=x,this._floorplanSelected(!0);break}}}selectBuilding(r){const o=this._indoorData.buildings.find(p=>p.id===r);this._buildingSelected(o,!0)}selectLevel(r){this._levelSelected(r)}}function $b(f){if(!f.metadata||!f.metadata.content_area)return;const r=s.q.devicePixelRatio,{left:o,top:p,width:_,height:x}=f.metadata.content_area,w=o*r,M=p*r;return[w,M,w+_*r,M+x*r]}function M0(f){if(f)return f.map(([r,o])=>[r*s.q.devicePixelRatio,o*s.q.devicePixelRatio])}const Cc=(f,r)=>Pa(f,r&&r.filter(o=>o.identifier!=="source.canvas")),Zb=s.ay(vi,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport"]),C0=s.ay(vi,["setCenter","setZoom","setBearing","setPitch"]),lg=new Set(["background","sky","slot","custom"]),dd={version:8,layers:[],sources:{}},R0={duration:300,delay:0};class Oa extends s.E{constructor(r,o={}){super(),this.map=r,this.scope=o.scope||"",this.globalId=null,this.fragments=[],this.importDepth=o.importDepth||0,this.importsCache=o.importsCache||new Map,this.resolvedImports=o.resolvedImports||new Set,this.transition=s.l({},R0),this._buildingIndex=new cd(this),this.crossTileSymbolIndex=new Tt,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=o.styleChanges||new Zs,this.dispatcher=o.dispatcher?o.dispatcher:new s.D(s.ci(),this),o.imageManager?this.imageManager=o.imageManager:(this.imageManager=new cr(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=o.glyphManager?o.glyphManager:new s.cj(r._requestManager,o.localFontFamily?s.ck.all:o.localIdeographFontFamily?s.ck.ideographs:s.ck.none,o.localFontFamily||o.localIdeographFontFamily),o.modelManager?this.modelManager=o.modelManager:(this.modelManager=new sg(r._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=o.configOptions?o.configOptions:new Map,this._configDependentLayers=o.configDependentLayers?o.configDependentLayers:new Set,this._config=o.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:o.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=o.initialConfig,this.dispatcher.broadcast("setReferrer",s.cl());const p=this;this._rtlTextPluginCallback=Oa.registerForPluginStateChange(_=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:_.pluginStatus,pluginURL:_.pluginURL},(x,w)=>{if(s.cm(x),w&&w.every(M=>M))for(const M in p._sourceCaches){const P=p._sourceCaches[M],z=P.getSource().type;z!=="vector"&&z!=="geojson"||P.reload()}})}),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const x=this.getOwnSource(_.sourceId);if(x&&x.vectorLayerIds)for(const w in this._layers){const M=this._layers[w];M.source===x.id&&this._validateLayer(M)}})}load(r){return r?(typeof r=="string"?this.loadURL(r):this.loadJSON(r),this):this}_getGlobalId(r){if(!r)return null;if(typeof r=="string"){if(s.f(r))return r;const o=s.cn(r);if(!o.startsWith("http"))try{return new URL(o,location.href).toString()}catch{return o}return o}return`json://${s.co(JSON.stringify(r))}`}_diffStyle(r,o,p){this.globalId=this._getGlobalId(r);const _=(x,w)=>{try{w(null,this.setState(x,p))}catch(M){w(M,!1)}};if(typeof r=="string"){const x=this.map._requestManager.normalizeStyleURL(r),w=this.map._requestManager.transformRequest(x,s.R.Style);s.n(w,(M,P)=>{M?this.fire(new s.y(M)):P&&_(P,o)})}else typeof r=="object"&&_(r,o)}loadURL(r,o={}){this.fire(new s.z("dataloading",{dataType:"style"}));const p=typeof o.validate=="boolean"?o.validate:!s.f(r);this.globalId=this._getGlobalId(r),r=this.map._requestManager.normalizeStyleURL(r,o.accessToken),this.resolvedImports.add(r);const _=this.importsCache.get(r);if(_)return this._load(_,p);const x=this.map._requestManager.transformRequest(r,s.R.Style);this._request=s.n(x,(w,M)=>{if(this._request=null,w)this.fire(new s.y(w));else if(M)return this.importsCache.set(r,M),this._load(M,p)})}loadJSON(r,o={}){this.fire(new s.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(r),this._request=s.q.frame(()=>{this._request=null,this._load(r,o.validate!==!1)})}loadEmpty(){this.fire(new s.z("dataloading",{dataType:"style"})),this._load(dd,!1)}_loadImports(r,o,p){if(this.importDepth>=4)return s.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const _=[];for(const x of r){const w=this._createFragmentStyle(x),M=new Promise(O=>{w.once("style.import.load",O),w.once("error",O)}).then(()=>this.mergeAll());if(_.push(M),this.resolvedImports.has(x.url)){w.loadEmpty();continue}const P=x.data||this.importsCache.get(x.url);P?(w.loadJSON(P,{validate:o}),this._isInternalStyle(P)&&(w.globalId=null)):x.url?w.loadURL(x.url,{validate:o}):w.loadEmpty();const z={style:w,id:x.id,config:x.config};if(p){const O=this.fragments.findIndex(({id:B})=>B===p);this.fragments=this.fragments.slice(0,O).concat(z).concat(this.fragments.slice(O))}else this.fragments.push(z)}return Promise.allSettled(_)}getImportGlobalIds(r=this,o=new Set){for(const p of r.fragments)p.style.globalId&&o.add(p.style.globalId),this.getImportGlobalIds(p.style,o);return[...o.values()]}_createFragmentStyle(r){const o=this.scope?s.aC(r.id,this.scope):r.id;let p;const _=this._initialConfig&&this._initialConfig[o];(r.config||_)&&(p=s.l({},r.config,_));const x=new Oa(this.map,{scope:o,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:p,configOptions:this.options,colorThemeOverride:r["color-theme"],configDependentLayers:this._configDependentLayers});return x.setEventedParent(this.map,{style:x}),x}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(r){return this.isRootStyle()&&(r.fragment||!!r.schema&&r.fragment!==!1)}_load(r,o){const p=r.indoor?ag(r.schema):r.schema;if(this._isInternalStyle(r)){const w=s.l({},dd,{imports:[{id:"basemap",data:r,url:""}]});return void this._load(w,o)}if(this.updateConfig(this._config,p),o&&Cc(this,os(r)))return;this._loaded=!0,this.stylesheet=s.cp(r);const _=()=>{for(const z in r.sources)this.addSource(z,r.sources[z],{validate:!1,isInitialLoad:!0});r.sprite?this._loadIconset(r.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(r.glyphs,this.scope);const w=wc(this.stylesheet.layers);if(this._order=w.map(z=>z.id),this.stylesheet.light&&s.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const z=this.stylesheet.lights[0];this.light=new X(z.properties,z.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new X(this.stylesheet.light)),this._layers={};for(const z of w){const O=s.cu(z,this.scope,this._styleColorTheme.lut,this.options);O.configDependencies.size!==0&&this._configDependentLayers.add(O.fqid),O.setEventedParent(this,{layer:{id:O.id}}),this._layers[O.id]=O;const B=this.getOwnLayerSourceCache(O),V=!!this.directionalLight&&this.directionalLight.shadowsEnabled();B&&O.canCastShadows()&&V&&(B.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const M=this.stylesheet.terrain;M&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(M,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new s.z("data",{dataType:"style"}));const P=this.isRootStyle();r.imports?this._loadImports(r.imports,o).then(()=>{this._reloadImports(),this.fire(new s.z(P?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new s.z(P?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const x=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(x){const w=this._evaluateColorThemeData(x);this._loadColorTheme(w).then(()=>{_()}).catch(M=>{s.w(`Couldn't load color theme from the stylesheet: ${M}`),_()})}else this._styleColorTheme.lut=null,_()}isRootStyle(){return this.importDepth===0}mergeAll(){let r,o,p,_,x,w,M,P,z,O;const B={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(V=>{if(V.stylesheet){if(V.light!=null&&(r=V.light),V.stylesheet.lights)for(const G of V.stylesheet.lights)G.type==="ambient"&&V.ambientLight!=null&&(o=V.ambientLight),G.type==="directional"&&V.directionalLight!=null&&(p=V.directionalLight);_=this._prioritizeTerrain(_,V.terrain,V.stylesheet.terrain),V.stylesheet.fog&&V.fog!=null&&(x=V.fog),V.stylesheet.snow&&V.snow!=null&&(w=V.snow),V.stylesheet.rain&&V.rain!=null&&(M=V.rain),V.stylesheet.camera!=null&&(O=V.stylesheet.camera),V.stylesheet.projection!=null&&(P=V.stylesheet.projection),V.stylesheet.transition!=null&&(z=V.stylesheet.transition),B[V.scope]=V._styleColorTheme}}),this.light=r,this.ambientLight=o,this.directionalLight=p,this.fog=x,this.snow=w,this.rain=M,this._styleColorThemeForScope=B,_===null?delete this.terrain:this.terrain=_,this.camera=O||{"camera-projection":"perspective"},this.projection=P||{name:"mercator"},this.transition=s.l({},R0,z),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(r){const o=p=>{for(const _ of p.fragments)o(_.style);r(p)};o(this)}_prioritizeTerrain(r,o,p){const _=r&&r.drapeRenderMode===0;return p===null?o&&o.drapeRenderMode===0?o:_?r:null:o!=null&&(!r||_||o&&o.drapeRenderMode===1)?o:r}mergeTerrain(){let r;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(o=>{r=this._prioritizeTerrain(r,o.terrain,o.stylesheet.terrain)}),r===null?delete this.terrain:this.terrain=r}mergeProjection(){let r;this.forEachFragmentStyle(o=>{o.stylesheet.projection!=null&&(r=o.stylesheet.projection)}),this.projection=r||{name:"mercator"}}mergeSources(){const r={},o={},p={};this.forEachFragmentStyle(_=>{for(const x in _._sourceCaches){const w=s.aC(x,_.scope);r[w]=_._sourceCaches[x]}for(const x in _._otherSourceCaches){const w=s.aC(x,_.scope);o[w]=_._otherSourceCaches[x]}for(const x in _._symbolSourceCaches){const w=s.aC(x,_.scope);p[w]=_._symbolSourceCaches[x]}}),this._mergedSourceCaches=r,this._mergedOtherSourceCaches=o,this._mergedSymbolSourceCaches=p}mergeLayers(){const r={},o=[],p={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(x=>{for(const w of x._order){const M=x._layers[w];if(M.type==="slot"){const P=s.cq(w);if(r[P])continue;r[P]=[]}M.slot&&r[M.slot]?r[M.slot].push(M):o.push(M)}}),this._mergedOrder=[];const _=(x=[])=>{for(const w of x)if(w.type==="slot"){const M=s.cq(w.id);r[M]&&_(r[M]),this._mergedSlots.push(M)}else{const M=s.aC(w.id,w.scope);this._mergedOrder.push(M),p[M]=w,w.is3D()&&(this._has3DLayers=!0),w.type==="circle"&&(this._hasCircleLayers=!0),w.type==="symbol"&&(this._hasSymbolLayers=!0),w.type==="clip"&&(this._clipLayerPresent=!0)}};_(o),this._mergedOrder.sort((x,w)=>{const M=p[x],P=p[w];return M.hasInitialOcclusionOpacityProperties?P.is3D()?1:0:M.is3D()&&P.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=p,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(r){return this.stylesheet.camera=s.l({},this.stylesheet.camera,r),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(r){return r.data?function(o,p,_){const x=s.l({},p);for(const M of Object.keys(s.a3.colorTheme))x[M]===void 0&&(x[M]=s.a3.colorTheme[M].default);const w=new s.a4(Hb,o,new Map(_));return w.setTransitionOrValue(x,_),w.untransitioned().possiblyEvaluate(new s.a8(0))}(this.scope,r,this.options).get("data"):null}_loadColorTheme(r){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const o=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((p,_)=>{const x="data:image/png;base64,";if(!r||r.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void p();let w=r;w.startsWith(x)||(w=x+w);const M="mapbox-reserved-lut",P=new Image;P.src=w,P.onerror=()=>{this._styleColorTheme.lutLoading=!1,_(new Error("Failed to load image data"))},P.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==o)return void p();this._styleColorTheme.lutLoading=!1;const{width:z,height:O,data:B}=s.q.getImageData(P);if(O>32)return void _(new Error("The height of the image must be less than or equal to 32 pixels."));if(z!==O*O)return void _(new Error("The width of the image must be equal to the height squared."));this.getImage(M)&&this.removeImage(M),this.addImage(M,{data:new s.r({width:z,height:O},B),pixelRatio:1,sdf:!1,usvg:!1,version:0});const V=this.imageManager.getImage(M,this.scope);V?(this._styleColorTheme.lut={image:V.data,data:r},p()):_(new Error("Missing LUT image."))}})}getLut(r){const o=this._styleColorThemeForScope[r];return o?o.lut:null}setProjection(r){r?this.stylesheet.projection=r:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(r){this._spriteRequest=function(o,p,_){let x,w,M;const P=s.q.devicePixelRatio>1?"@2x":"";let z=s.n(p.transformRequest(p.normalizeSpriteURL(o,P,".json"),s.R.SpriteJSON),(V,G)=>{z=null,M||(M=V,x=G,B())}),O=s.o(p.transformRequest(p.normalizeSpriteURL(o,P,".png"),s.R.SpriteImage),(V,G)=>{O=null,M||(M=V,w=G,B())});function B(){if(M)_(M);else if(x&&w){const V=s.q.getImageData(w),G={};for(const Q in x){const{width:W,height:te,x:ee,y:le,sdf:pe,pixelRatio:fe,stretchX:Te,stretchY:_e,content:xe}=x[Q],ge=new s.r({width:W,height:te});s.r.copy(V,ge,{x:ee,y:le},{x:0,y:0},{width:W,height:te},null),G[Q]={data:ge,pixelRatio:fe,sdf:pe,stretchX:Te,stretchY:_e,content:xe,usvg:!1}}_(null,G)}}return{cancel(){z&&(z.cancel(),z=null),O&&(O.cancel(),O=null)}}}(r,this.map._requestManager,(o,p)=>{if(this._spriteRequest=null,o)this.fire(new s.y(o));else if(p)for(const _ in p)this.imageManager.addImage(_,this.scope,p[_]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.z("data",{dataType:"style"}))})}_loadIconset(r){if(!s.f(r)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(r);const o=this.map._spriteFormat==="auto";var p,_;this._spriteRequest=(_=(x,w)=>{if(this._spriteRequest=null,x)o?this._loadSprite(r):this.fire(new s.y(x));else if(w)for(const M in w)this.imageManager.addImage(M,this.scope,w[M]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.z("data",{dataType:"style"}))},s.bi((p=this.map._requestManager).transformRequest(p.normalizeIconsetURL(r),s.R.Iconset),(x,w)=>{if(x)return void _(x);const M={},P=s.cg(new s.bh(w));for(const z of P.icons){const O={version:1,pixelRatio:s.q.devicePixelRatio,content:$b(z),stretchX:z.metadata?M0(z.metadata.stretch_x_areas):void 0,stretchY:z.metadata?M0(z.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:z};M[z.name]=O}_(null,M)}))}_validateLayer(r){const o=this.getOwnSource(r.source);if(!o)return;const p=r.sourceLayer;p&&(o.type==="geojson"||o.vectorLayerIds&&o.vectorLayerIds.indexOf(p)===-1)&&this.fire(new s.y(new Error(`Source layer "${p}" does not exist on source "${o.id}" as specified by style layer "${r.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const r in this._sourceCaches)if(!this._sourceCaches[r].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:r}of this.fragments)if(!r.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((r,o)=>{const p=this.fragments[o];return p&&p.style&&(r.data=p.style.serialize()),r})}_serializeSources(){const r={};for(const o in this._sourceCaches){const p=this._sourceCaches[o].getSource();r[p.id]||(r[p.id]=p.serialize())}return r}_serializeLayers(r){const o=[];for(const p of r){const _=this._layers[p];_&&_.type!=="custom"&&o.push(_.serialize())}return o}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const r in this._sourceCaches)if(this._sourceCaches[r].hasTransition())return!0;for(const r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(r){return r?this.order:this._mergedOrder}isLayerDraped(r){return!!this.terrain&&r.isDraped(this.getLayerSourceCache(r))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(r){const o=this.getOwnLayer(r);if(o)return o;this.fire(new s.y(new Error(`The layer '${r}' does not exist in the map's style.`)))}_checkSource(r){const o=this.getOwnSource(r);if(o)return o;this.fire(new s.y(new Error(`The source '${r}' does not exist in the map's style.`)))}precompilePrograms(r,o){const p=this.map.painter;if(p)for(let _=r.minzoom||0;_<(r.maxzoom||25.5);_++){const x=r.getProgramIds();if(x)for(const w of x){const M=r.getDefaultProgramParams(w,o.zoom,this._styleColorTheme.lut);M&&(p.style=this,this.fog&&(p._fogVisible=!0,M.overrideFog=!0,p.getOrCreateProgram(w,M)),p._fogVisible=!1,M.overrideFog=!1,p.getOrCreateProgram(w,M),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(M.overrideRtt=!0,p.getOrCreateProgram(w,M)))}}}update(r){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(r),this.directionalLight&&this.directionalLight.recalculate(r);const o=this.calculateLightsBrightness();r.brightness=o||0,o!==this._brightness&&(this._brightness=o,this.dispatcher.broadcast("setBrightness",o));const p=this._changes.isDirty();let _=!1;if(this._changes.isDirty()){const w=this._changes.getLayerUpdatesByScope();for(const M in w){const{updatedIds:P,removedIds:z}=w[M];(P||z)&&(this._updateWorkerLayers(M,P,z),_=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(r),this.light&&this.light.updateTransitions(r),this.ambientLight&&this.ambientLight.updateTransitions(r),this.directionalLight&&this.directionalLight.updateTransitions(r),this.fog&&this.fog.updateTransitions(r),this.snow&&this.snow.updateTransitions(r),this.rain&&this.rain.updateTransitions(r),this._changes.reset()}const x={};for(const w in this._mergedSourceCaches){const M=this._mergedSourceCaches[w];x[w]=M.used,M.used=!1,M.tileCoverLift=0}for(const w of this._mergedOrder){const M=this._mergedLayers[w];if(M.recalculate(r,this._availableImages),!M.isHidden(r.zoom)){const P=this.getLayerSourceCache(M);P&&(P.used=!0,P.tileCoverLift=Math.max(P.tileCoverLift,M.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(M,r)}):this.precompilePrograms(M,r))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&_&&this.mergeLayers();for(const w in x){const M=this._mergedSourceCaches[w];x[w]!==M.used&&M.getSource().fire(new s.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:M.getSource().id}))}this.light&&this.light.recalculate(r),this.terrain&&this.terrain.recalculate(r),this.fog&&this.fog.recalculate(r),this.snow&&this.snow.recalculate(r),this.rain&&this.rain.recalculate(r),this.z=r.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),p&&this.fire(new s.z("data",{dataType:"style"}))}_updateTilesForChangedImages(){const r=this._changes.getUpdatedImages();if(r.length){for(const o in this._sourceCaches)this._sourceCaches[o].reloadTilesForDependencies(["icons","patterns"],r);this._changes.resetUpdatedImages()}}_updateWorkerLayers(r,o,p){const _=this.getFragmentStyle(r);_&&this.dispatcher.broadcast("updateLayers",{layers:o?_._serializeLayers(o):[],scope:r,removedIds:p||[],options:_.options})}setState(r,o){if(this._checkLoaded(),Cc(this,os(r)))return!1;(r=s.cp(r)).layers=wc(r.layers);const p=function(w,M){if(!w)return[{command:vi.setStyle,args:[M]}];let P=[];try{if(!s.bn(w.version,M.version))return[{command:vi.setStyle,args:[M]}];if(s.bn(w.center,M.center)||P.push({command:vi.setCenter,args:[M.center]}),s.bn(w.zoom,M.zoom)||P.push({command:vi.setZoom,args:[M.zoom]}),s.bn(w.bearing,M.bearing)||P.push({command:vi.setBearing,args:[M.bearing]}),s.bn(w.pitch,M.pitch)||P.push({command:vi.setPitch,args:[M.pitch]}),s.bn(w.sprite,M.sprite)||P.push({command:vi.setSprite,args:[M.sprite]}),s.bn(w.glyphs,M.glyphs)||P.push({command:vi.setGlyphs,args:[M.glyphs]}),s.bn(w.imports,M.imports)||function(G=[],Q=[],W){Q=Q||[];const te=(G=G||[]).map(jr),ee=Q.map(jr),le=G.reduce(ea,{}),pe=Q.reduce(ea,{}),fe=te.slice();let Te,_e,xe,ge;for(Te=0,_e=0;Te<te.length;Te++)xe=te[Te],pe.hasOwnProperty(xe)?_e++:(W.push({command:vi.removeImport,args:[xe]}),fe.splice(fe.indexOf(xe,_e),1));for(Te=0,_e=0;Te<ee.length;Te++)xe=ee[ee.length-1-Te],fe[fe.length-1-Te]!==xe&&(le.hasOwnProperty(xe)?(W.push({command:vi.removeImport,args:[xe]}),fe.splice(fe.lastIndexOf(xe,fe.length-_e),1)):_e++,ge=fe[fe.length-Te],W.push({command:vi.addImport,args:[pe[xe],ge]}),fe.splice(fe.length-Te,0,xe));for(const Re of Q){const Fe=le[Re.id];Fe&&!s.bn(Fe,Re)&&W.push({command:vi.updateImport,args:[Re.id,Re]})}}(w.imports,M.imports,P),s.bn(w.transition,M.transition)||P.push({command:vi.setTransition,args:[M.transition]}),s.bn(w.light,M.light)||P.push({command:vi.setLight,args:[M.light]}),s.bn(w.fog,M.fog)||P.push({command:vi.setFog,args:[M.fog]}),s.bn(w.snow,M.snow)||P.push({command:vi.setSnow,args:[M.snow]}),s.bn(w.rain,M.rain)||P.push({command:vi.setRain,args:[M.rain]}),s.bn(w.projection,M.projection)||P.push({command:vi.setProjection,args:[M.projection]}),s.bn(w.lights,M.lights)||P.push({command:vi.setLights,args:[M.lights]}),s.bn(w.camera,M.camera)||P.push({command:vi.setCamera,args:[M.camera]}),!s.bn(w["color-theme"],M["color-theme"]))return[{command:vi.setStyle,args:[M]}];const z={},O=[];(function(G,Q,W,te){let ee;for(ee in Q=Q||{},G=G||{})G.hasOwnProperty(ee)&&(Q.hasOwnProperty(ee)||sl(ee,W,te));for(ee in Q){if(!Q.hasOwnProperty(ee))continue;const le=Q[ee];G.hasOwnProperty(ee)?s.bn(G[ee],le)||(G[ee].type==="geojson"&&le.type==="geojson"&&zi(G,Q,ee)?W.push({command:vi.setGeoJSONSourceData,args:[ee,le.data]}):qt(ee,Q,W,te)):Su(ee,Q,W)}})(w.sources,M.sources,O,z);const B=[];w.layers&&w.layers.forEach(G=>{G.source&&z[G.source]?P.push({command:vi.removeLayer,args:[G.id]}):B.push(G)});let V=w.terrain;V&&z[V.source]&&(P.push({command:vi.setTerrain,args:[void 0]}),V=void 0),P=P.concat(O),s.bn(V,M.terrain)||P.push({command:vi.setTerrain,args:[M.terrain]}),function(G,Q,W){Q=Q||[];const te=(G=G||[]).map(jr),ee=Q.map(jr),le=G.reduce(ea,{}),pe=Q.reduce(ea,{}),fe=te.slice(),Te=Object.create(null);let _e,xe,ge,Re,Fe,rt,Ke;for(_e=0,xe=0;_e<te.length;_e++)ge=te[_e],pe.hasOwnProperty(ge)?xe++:(W.push({command:vi.removeLayer,args:[ge]}),fe.splice(fe.indexOf(ge,xe),1));for(_e=0,xe=0;_e<ee.length;_e++)ge=ee[ee.length-1-_e],fe[fe.length-1-_e]!==ge&&(le.hasOwnProperty(ge)?(W.push({command:vi.removeLayer,args:[ge]}),fe.splice(fe.lastIndexOf(ge,fe.length-xe),1)):xe++,rt=fe[fe.length-_e],W.push({command:vi.addLayer,args:[pe[ge],rt]}),fe.splice(fe.length-_e,0,ge),Te[ge]=!0);for(_e=0;_e<ee.length;_e++)if(ge=ee[_e],Re=le[ge],Fe=pe[ge],!Te[ge]&&!s.bn(Re,Fe))if(s.bn(Re.source,Fe.source)&&s.bn(Re["source-layer"],Fe["source-layer"])&&s.bn(Re.type,Fe.type)){for(Ke in Ni(Re.layout,Fe.layout,W,ge,null,vi.setLayoutProperty),Ni(Re.paint,Fe.paint,W,ge,null,vi.setPaintProperty),s.bn(Re.slot,Fe.slot)||W.push({command:vi.setSlot,args:[ge,Fe.slot]}),s.bn(Re.filter,Fe.filter)||W.push({command:vi.setFilter,args:[ge,Fe.filter]}),s.bn(Re.minzoom,Fe.minzoom)&&s.bn(Re.maxzoom,Fe.maxzoom)||W.push({command:vi.setLayerZoomRange,args:[ge,Fe.minzoom,Fe.maxzoom]}),Re)Re.hasOwnProperty(Ke)&&Ke!=="layout"&&Ke!=="paint"&&Ke!=="filter"&&Ke!=="metadata"&&Ke!=="minzoom"&&Ke!=="maxzoom"&&Ke!=="slot"&&(Ke.indexOf("paint.")===0?Ni(Re[Ke],Fe[Ke],W,ge,Ke.slice(6),vi.setPaintProperty):s.bn(Re[Ke],Fe[Ke])||W.push({command:vi.setLayerProperty,args:[ge,Ke,Fe[Ke]]}));for(Ke in Fe)Fe.hasOwnProperty(Ke)&&!Re.hasOwnProperty(Ke)&&Ke!=="layout"&&Ke!=="paint"&&Ke!=="filter"&&Ke!=="metadata"&&Ke!=="minzoom"&&Ke!=="maxzoom"&&Ke!=="slot"&&(Ke.indexOf("paint.")===0?Ni(Re[Ke],Fe[Ke],W,ge,Ke.slice(6),vi.setPaintProperty):s.bn(Re[Ke],Fe[Ke])||W.push({command:vi.setLayerProperty,args:[ge,Ke,Fe[Ke]]}))}else W.push({command:vi.removeLayer,args:[ge]}),rt=fe[fe.lastIndexOf(ge)+1],W.push({command:vi.addLayer,args:[Fe,rt]})}(B,M.layers,P)}catch(z){console.warn("Unable to compute style diff:",z),P=[{command:vi.setStyle,args:[M]}]}return P}(this.serialize(),r).filter(w=>!(w.command in C0));if(p.length===0)return!1;const _=p.filter(w=>!(w.command in Zb));if(_.length>0)throw new Error(`Unimplemented: ${_.map(w=>w.command).join(", ")}.`);const x=[];return p.forEach(w=>{x.push(this[w.command].apply(this,w.args))}),o&&Promise.all(x).then(o),this.stylesheet=r,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(r,o){return this.getImage(r)?this.fire(new s.y(new Error("An image with this name already exists."))):(this.imageManager.addImage(r,this.scope,o),this._afterImageUpdated(r),this)}updateImage(r,o,p=!1){this.imageManager.updateImage(r,this.scope,o),p&&this._afterImageUpdated(r)}getImage(r){return this.imageManager.getImage(r,this.scope)}removeImage(r){return this.getImage(r)?(this.imageManager.removeImage(r,this.scope),this._afterImageUpdated(r),this):this.fire(new s.y(new Error("No image with this name exists.")))}_afterImageUpdated(r){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(r),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new s.z("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(r,o,p={}){return this._checkLoaded(),this._validate($a,`models.${r}`,o,null,p)||(this.modelManager.addModel(r,o,this.scope),this._changes.setDirty()),this}hasModel(r){return this.modelManager.hasModel(r,this.scope)}removeModel(r){return this.hasModel(r)?(this.modelManager.removeModel(r,this.scope),this):this.fire(new s.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(r,o,p={}){if(this._checkLoaded(),this.getOwnSource(r)!==void 0)throw new Error(`There is already a source with ID "${r}".`);if(!o.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(o).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(o.type)>=0&&this._validate(Ls,`sources.${r}`,o,null,p))return;this.map&&this.map._collectResourceTiming&&(o.collectResourceTiming=!0);const _=Ur(r,o,this.dispatcher,this);_.scope=this.scope,_.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(_.id),source:_.serialize(),sourceId:_.id}));const x=w=>{const M=(w?"symbol:":"other:")+_.id,P=s.aC(M,this.scope),z=this._sourceCaches[M]=new Js(P,_,w);(w?this._symbolSourceCaches:this._otherSourceCaches)[_.id]=z,z.onAdd(this.map)};x(!1),o.type!=="vector"&&o.type!=="geojson"||x(!0),_.onAdd&&_.onAdd(this.map),p.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(r){this._checkLoaded();const o=this.getOwnSource(r);if(!o)throw new Error("There is no source with this ID");for(const _ in this._layers)if(this._layers[_].source===r)return this.fire(new s.y(new Error(`Source "${r}" cannot be removed while layer "${_}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===r)return this.fire(new s.y(new Error(`Source "${r}" cannot be removed while terrain is using it.`)));const p=this.getOwnSourceCaches(r);for(const _ of p){const x=s.cq(_.id);delete this._sourceCaches[x],this._changes.discardSourceCacheUpdate(_.id),_.fire(new s.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:_.getSource().id})),_.setEventedParent(null),_.clearTiles()}return delete this._otherSourceCaches[r],delete this._symbolSourceCaches[r],this.mergeSources(),o.setEventedParent(null),o.onRemove&&o.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(r,o){this._checkLoaded(),this.getOwnSource(r).setData(o),this._changes.setDirty()}getOwnSource(r){const o=this.getOwnSourceCache(r);return o&&o.getSource()}getOwnSources(){const r=[];for(const o in this._otherSourceCaches){const p=this.getOwnSourceCache(o);p&&r.push(p.getSource())}return r}areTilesLoaded(){const r=this._mergedSourceCaches;for(const o in r){const p=r[o]._tiles;for(const _ in p){const x=p[_];if(x.state!=="loaded"&&x.state!=="errored")return!1}}return!0}setLights(r){if(this._checkLoaded(),!r)return delete this.ambientLight,void delete this.directionalLight;const o=this._getTransitionParameters();for(const _ of r){if(this._validate(vo,"lights",_))return;switch(_.type){case"ambient":if(this.ambientLight){const x=this.ambientLight;x.set(_),x.updateTransitions(o)}else this.ambientLight=new ci(_,At||(At=new s.a5({color:new s.a6(s.a3.properties_light_ambient.color),"color-use-theme":new s.a6({type:"string",default:"default","property-type":"data-constant"}),intensity:new s.a6(s.a3.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const x=this.directionalLight;x.set(_),x.updateTransitions(o)}else this.directionalLight=new ci(_,Rt||(Rt=new s.a5({direction:new s.ak(s.a3.properties_light_directional.direction),color:new s.a6(s.a3.properties_light_directional.color),"color-use-theme":new s.a6({type:"string",default:"default","property-type":"data-constant"}),intensity:new s.a6(s.a3.properties_light_directional.intensity),"cast-shadows":new s.a6(s.a3.properties_light_directional["cast-shadows"]),"shadow-quality":new s.a6(s.a3.properties_light_directional["shadow-quality"]),"shadow-intensity":new s.a6(s.a3.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const p=new s.a8(this.z||0,o);this.ambientLight&&this.ambientLight.recalculate(p),this.directionalLight&&this.directionalLight.recalculate(p),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const r=this.directionalLight,o=this.ambientLight;if(!r||!o)return;const p=V=>.2126*(V[0]<=.03928?V[0]/12.92:Math.pow((V[0]+.055)/1.055,2.4))+.7152*(V[1]<=.03928?V[1]/12.92:Math.pow((V[1]+.055)/1.055,2.4))+.0722*(V[2]<=.03928?V[2]/12.92:Math.pow((V[2]+.055)/1.055,2.4)),_=r.properties.get("color").toRenderColor(null).toArray01(),x=r.properties.get("intensity"),w=r.properties.get("direction"),M=1-s.cb(w.x,w.y,w.z)[2]/90,P=p(_)*x*M,z=o.properties.get("color").toRenderColor(null).toArray01(),O=o.properties.get("intensity"),B=p(z)*O;return Number(((P+B)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const r=[];return this.directionalLight&&r.push(this.directionalLight.get()),this.ambientLight&&r.push(this.ambientLight.get()),r}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(r){if(!r)return this;if(s.cr(r)){const o=s.cs(r),p=this.fragments.find(({id:x})=>x===o);if(!p)throw new Error(`Style import '${r}' not found`);const _=s.cq(r);return p.style.getFragmentStyle(_)}{const o=this.fragments.find(({id:p})=>p===r);return o?o.style:void 0}}setFeaturesetSelectors(r){if(!r)return;const o={},p=(_,x="")=>`${_}::${x}`;this._featuresetSelectors={};for(const _ in r){const x=this._featuresetSelectors[_]=[];for(const w of r[_].selectors){if(w.featureNamespace){const P=this.getOwnLayer(w.layer);if(!P){s.w(`Layer is undefined for selector: ${w.layer}`);continue}const z=p(P.source,P.sourceLayer);if(z in o&&o[z]!==w.featureNamespace){s.w(`"featureNamespace ${w.featureNamespace} of featureset ${_}'s selector is not associated to the same source, skip this selector`);continue}o[z]=w.featureNamespace}let M;if(w.properties)for(const P in w.properties){const z=s.U(w.properties[P]);z.result==="success"&&(M=M||{},M[P]=z.value)}x.push({layerId:w.layer,namespace:w.featureNamespace,properties:M,uniqueFeatureID:w._uniqueFeatureID})}}}getFeaturesetDescriptors(r){const o=this.getFragmentStyle(r);if(!o||!o.stylesheet.featuresets)return[];const p=[];for(const _ in o.stylesheet.featuresets)p.push({featuresetId:_,importId:o.scope?o.scope:void 0});return p}getFeaturesetLayers(r,o){const p=this.getFragmentStyle(o),_=p.stylesheet.featuresets;if(!_||!_[r])return this.fire(new s.y(new Error(`The featureset '${r}' does not exist in the map's style and cannot be queried.`))),[];const x=[];for(const w of _[r].selectors){const M=p.getOwnLayer(w.layer);M&&x.push(M)}return x}getConfigProperty(r,o){const p=this.getFragmentStyle(r);if(!p)return null;const _=s.aC(o,p.scope),x=p.options.get(_),w=x?x.value||x.default:null;return w?w.serialize():null}setConfigProperty(r,o,p){const _=this.getFragmentStyle(r);if(!_)return;const x=_.stylesheet.indoor?ag(_.stylesheet.schema):_.stylesheet.schema;if(!x||!x[o])return;const w=s.U(p);if(w.result!=="success")return void Cc(this,w.value);const M=w.value.expression,P=s.aC(o,_.scope),z=_.options.get(P);if(!z)return;let O;const{minValue:B,maxValue:V,stepValue:G,type:Q,values:W}=x[o],te=s.U(x[o].default);te.result==="success"&&(O=te.value.expression),O?(this.options.set(P,Object.assign({},z,{value:M,default:O,minValue:B,maxValue:V,stepValue:G,type:Q,values:W})),this.updateConfigDependencies(o)):this.fire(new s.y(new Error(`No schema defined for the config option "${o}" in the "${r}" fragment.`)))}getConfig(r){const o=this.getFragmentStyle(r);if(!o)return null;const p=o.stylesheet.schema;if(!p)return null;const _={};for(const x in p){const w=s.aC(x,o.scope),M=o.options.get(w),P=M?M.value||M.default:null;_[x]=P?P.serialize():null}return _}setConfig(r,o){const p=this.getFragmentStyle(r);p&&(p.updateConfig(o,p.stylesheet.schema),this.updateConfigDependencies())}getSchema(r){const o=this.getFragmentStyle(r);return o?o.stylesheet.schema:null}setSchema(r,o){const p=this.getFragmentStyle(r);p&&(p.stylesheet.schema=o,p.updateConfig(p._config,o),this.updateConfigDependencies())}updateConfig(r,o){if(this._config=r,r||o)if(o)for(const p in o){let _,x;const w=s.U(o[p].default);if(w.result==="success"&&(_=w.value.expression),r&&r[p]!==void 0){const V=s.U(r[p]);V.result==="success"&&(x=V.value.expression)}const{minValue:M,maxValue:P,stepValue:z,type:O,values:B}=o[p];if(_){const V=s.aC(p,this.scope);this.options.set(V,{default:_,value:x,minValue:M,maxValue:P,stepValue:z,type:O,values:B})}else this.fire(new s.y(new Error(`No schema defined for config option "${p}".`)))}else this.fire(new s.y(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(r){for(const o of this._configDependentLayers){const p=this.getLayer(o);if(p){if(r&&!p.configDependencies.has(r))continue;p.possiblyEvaluateVisibility(),this._updateLayer(p)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(o=>{const p=o._styleColorTheme.colorThemeOverride?o._styleColorTheme.colorThemeOverride:o._styleColorTheme.colorTheme;if(p){const _=o._evaluateColorThemeData(p);(!o._styleColorTheme.lut&&_!==""||o._styleColorTheme.lut&&_!==o._styleColorTheme.lut.data)&&o.setColorTheme(p)}}),this._changes.setDirty()}addLayer(r,o,p={}){this._checkLoaded();const _=r.id;if(this._layers[_])return void this.fire(new s.y(new Error(`Layer with id "${_}" already exists on this map`)));let x;if(r.type==="custom"){if(Cc(this,s.ct(r)))return;x=s.cu(r,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof r.source=="object"&&(this.addSource(_,r.source),r=s.cp(r),r=s.l(r,{source:_})),this._validate(xo,`layers.${_}`,r,{arrayIndex:-1},p))return;x=s.cu(r,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(x),x.setEventedParent(this,{layer:{id:_}})}x.configDependencies.size!==0&&this._configDependentLayers.add(x.fqid);let w=this._order.length;if(o){const O=this._order.indexOf(o);if(O===-1)return void this.fire(new s.y(new Error(`Layer with id "${o}" does not exist on this map.`)));x.slot===this._layers[o].slot?w=O:s.w(`Layer with id "${o}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(w,0,_),this._layerOrderChanged=!0,this._layers[_]=x;const M=this.getOwnLayerSourceCache(x),P=!!this.directionalLight&&this.directionalLight.shadowsEnabled();M&&x.canCastShadows()&&P&&(M.castsShadows=!0);const z=this._changes.getRemovedLayer(x);if(z&&x.source&&M&&x.type!=="custom"){this._changes.discardLayerRemoval(x);const O=s.aC(x.source,x.scope);z.type!==x.type?this._changes.updateSourceCache(O,"clear"):(this._changes.updateSourceCache(O,"reload"),M.pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map),x.scope=this.scope,this.mergeLayers()}moveLayer(r,o){this._checkLoaded();const p=this._checkLayer(r);if(!p||r===o)return;const _=this._order.indexOf(r);this._order.splice(_,1);let x=this._order.length;if(o){const w=this._order.indexOf(o);if(w===-1)return void this.fire(new s.y(new Error(`Layer with id "${o}" does not exist on this map.`)));p.slot===this._layers[o].slot?x=w:s.w(`Layer with id "${o}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(x,0,r),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(r){this._checkLoaded();const o=this._checkLayer(r);if(!o)return;o.setEventedParent(null);const p=this._order.indexOf(r);this._order.splice(p,1),delete this._layers[r],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(o.fqid),this._changes.removeLayer(o);const _=this.getOwnLayerSourceCache(o);if(_&&_.castsShadows){let x=!1;for(const w in this._layers)if(this._layers[w].source===o.source&&this._layers[w].canCastShadows()){x=!0;break}_.castsShadows=x}o.onRemove&&o.onRemove(this.map),this.mergeLayers()}getOwnLayer(r){return this._layers[r]}hasLayer(r){return r in this._mergedLayers}hasLayerType(r){for(const o in this._layers)if(this._layers[o].type===r)return!0;return!1}setLayerZoomRange(r,o,p){this._checkLoaded();const _=this._checkLayer(r);_&&(_.minzoom===o&&_.maxzoom===p||(o!=null&&(_.minzoom=o),p!=null&&(_.maxzoom=p),this._updateLayer(_)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(r,o){this._checkLoaded();const p=this._checkLayer(r);p&&p.slot!==o&&(p.slot=o,this._updateLayer(p))}setFilter(r,o,p={}){this._checkLoaded();const _=this._checkLayer(r);if(_&&!s.bn(_.filter,o))return o==null?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(Kn,`layers.${_.id}.filter`,o,{layerType:_.type},p)||(_.filter=s.cp(o),this._updateLayer(_)))}getFilter(r){const o=this._checkLayer(r);if(o)return s.cp(o.filter)}setLayoutProperty(r,o,p,_={}){this._checkLoaded();const x=this._checkLayer(r);if(x&&!s.bn(x.getLayoutProperty(o),p)){if(p!=null&&(!_||_.validate!==!1)&&Cc(x,vc.call(os,{key:`layers.${r}.layout.${o}`,layerType:x.type,objectKey:o,value:p,styleSpec:s.a3,style:{glyphs:!0,sprite:!0}})))return;x.setLayoutProperty(o,p),x.configDependencies.size!==0&&this._configDependentLayers.add(x.fqid),this._updateLayer(x)}}getLayoutProperty(r,o){const p=this._checkLayer(r);if(p)return p.getLayoutProperty(o)}setPaintProperty(r,o,p,_={}){this._checkLoaded();const x=this._checkLayer(r);if(!x||s.bn(x.getPaintProperty(o),p)||p!=null&&(!_||_.validate!==!1)&&Cc(x,Ir.call(os,{key:`layers.${r}.paint.${o}`,layerType:x.type,objectKey:o,value:p,styleSpec:s.a3})))return;const w=x.setPaintProperty(o,p);x.configDependencies.size!==0&&this._configDependentLayers.add(x.fqid),w&&this._updateLayer(x),this._changes.updatePaintProperties(x)}getPaintProperty(r,o){const p=this._checkLayer(r);if(p)return p.getPaintProperty(o)}setFeatureState(r,o){if(this._checkLoaded(),"target"in r){if("featuresetId"in r.target){const{featuresetId:P,importId:z}=r.target,O=this.getFragmentStyle(z),B=O.getFeaturesetLayers(P);for(const{source:V,sourceLayer:G}of B)O.setFeatureState({id:r.id,source:V,sourceLayer:G},o)}else if("layerId"in r.target){const{layerId:P}=r.target,z=this.getLayer(P);this.setFeatureState({id:r.id,source:z.source,sourceLayer:z.sourceLayer},o)}return}const p=r.source,_=r.sourceLayer,x=this._checkSource(p);if(!x)return;const w=x.type;if(w==="geojson"&&_)return void this.fire(new s.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(w==="vector"&&!_)return void this.fire(new s.y(new Error("The sourceLayer parameter must be provided for vector source types.")));r.id===void 0&&this.fire(new s.y(new Error("The feature id parameter must be provided.")));const M=this.getOwnSourceCaches(p);for(const P of M)P.setFeatureState(_,r.id,o)}removeFeatureState(r,o){if(this._checkLoaded(),"target"in r){if("featuresetId"in r.target){const{featuresetId:P,importId:z}=r.target,O=this.getFragmentStyle(z),B=O.getFeaturesetLayers(P);for(const{source:V,sourceLayer:G}of B)O.removeFeatureState({id:r.id,source:V,sourceLayer:G},o)}else if("layerId"in r.target){const{layerId:P}=r.target,z=this.getLayer(P);this.removeFeatureState({id:r.id,source:z.source,sourceLayer:z.sourceLayer},o)}return}const p=r.source,_=this._checkSource(p);if(!_)return;const x=_.type,w=x==="vector"?r.sourceLayer:void 0;if(x==="vector"&&!w)return void this.fire(new s.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(o&&typeof r.id!="string"&&typeof r.id!="number")return void this.fire(new s.y(new Error("A feature id is required to remove its specific state property.")));const M=this.getOwnSourceCaches(p);for(const P of M)P.removeFeatureState(w,r.id,o)}getFeatureState(r){if(this._checkLoaded(),"target"in r){let x;if("featuresetId"in r.target){const{featuresetId:w,importId:M}=r.target,P=this.getFragmentStyle(M),z=P.getFeaturesetLayers(w);for(const{source:O,sourceLayer:B}of z){const V=P.getFeatureState({id:r.id,source:O,sourceLayer:B});if(V&&!x)x=V;else if(!s.bn(x,V))return void this.fire(new s.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in r.target){const{layerId:w}=r.target,M=this.getLayer(w);x=this.getFeatureState({id:r.id,source:M.source,sourceLayer:M.sourceLayer})}return x}const o=r.source,p=r.sourceLayer,_=this._checkSource(o);if(_){if(_.type!=="vector"||p)return r.id===void 0&&this.fire(new s.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(o)[0].getFeatureState(p,r.id);this.fire(new s.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(r){return this.stylesheet.transition=s.l({},this.stylesheet.transition,r),this.transition=this.stylesheet.transition,this}getTransition(){return s.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();const r=this.getTerrain(),o=r&&this.terrain&&this.terrain.scope===this.scope?r:this.stylesheet.terrain;return s.cv({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:o,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},p=>p!==void 0)}_updateFilteredLayers(r){for(const o of Object.values(this._mergedLayers))r(o)&&this._updateLayer(o)}_updateLayer(r){this._changes.updateLayer(r);const o=this.getLayerSourceCache(r),p=s.aC(r.source,r.scope),_=this._changes.getUpdatedSourceCaches();r.source&&!_[p]&&o&&o.getSource().type!=="raster"&&(this._changes.updateSourceCache(p,"reload"),o.pause()),r.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(r){const o=M=>this._mergedLayers[M].is3D(),p=this.order,_={},x=[];for(let M=p.length-1;M>=0;M--){const P=p[M];if(o(P)){_[P]=M;for(const z of r){const O=z[P];if(O)for(const B of O)x.push(B)}}}x.sort((M,P)=>P.intersectionZ-M.intersectionZ);const w=[];for(let M=p.length-1;M>=0;M--){const P=p[M];if(o(P))for(let z=x.length-1;z>=0;z--){const O=x[z].feature;if(O.layer&&_[O.layer.id]<M)break;w.push(O),x.pop()}else for(const z of r){const O=z[P];if(O)for(const B of O)w.push(B.feature)}}return w}queryRenderedFeatures(r,o,p){let _;o&&!Array.isArray(o)&&o.filter&&(this._validate(Kn,"queryRenderedFeatures.filter",o.filter,null,o),_=s.aZ(o.filter));const x={},w=O=>{if(lg.has(O.type))return;const B=this.getOwnLayerSourceCache(O),V=x[B.id]=x[B.id]||{sourceCache:B,layers:{},has3DLayers:!1};O.is3D()&&(V.has3DLayers=!0),V.layers[O.fqid]=V.layers[O.fqid]||{styleLayer:O,targets:[]},V.layers[O.fqid].targets.push({filter:_})};if(o&&o.layers){if(!Array.isArray(o.layers))return this.fire(new s.y(new Error("parameters.layers must be an Array."))),[];for(const O of o.layers){const B=this._layers[O];if(!B)return this.fire(new s.y(new Error(`The layer '${O}' does not exist in the map's style and cannot be queried for features.`))),[];w(B)}}else for(const O in this._layers)w(this._layers[O]);const M=this._queryRenderedFeatures(r,x,p),P=this._flattenAndSortRenderedFeatures(M),z=[];for(const O of P)s.cs(O.layer.id)===this.scope&&z.push(O);return z}queryRenderedFeatureset(r,o,p){let _;o&&!Array.isArray(o)&&o.filter&&(this._validate(Kn,"queryRenderedFeatures.filter",o.filter,null,o),_=s.aZ(o.filter));const x="mock",w=[];if(o&&o.target)w.push(Object.assign({},o,{targetId:x,filter:_}));else{const O=this.getFeaturesetDescriptors();for(const B of O)w.push({targetId:x,filter:_,target:B});for(const{style:B}of this.fragments){const V=B.getFeaturesetDescriptors();for(const G of V)w.push({targetId:x,filter:_,target:G})}}const M=this.queryRenderedTargets(r,w,p),P=[],z=new Set;for(const O of M)for(const B of O.variants[x])Za(B,O,z)||P.push(new s.cw(O,B));return P}queryRenderedTargets(r,o,p){const _={},x=(M,P,z,O)=>{const B=_[P.id]=_[P.id]||{sourceCache:P,layers:{},has3DLayers:!1};if(B.layers[M.fqid]=B.layers[M.fqid]||{styleLayer:M,targets:[]},M.is3D()&&(B.has3DLayers=!0),!O)return z.uniqueFeatureID=!1,void B.layers[M.fqid].targets.push(z);B.layers[M.fqid].targets.push(Object.assign({},z,{namespace:O.namespace,properties:O.properties,uniqueFeatureID:O.uniqueFeatureID}))};for(const M of o)if("featuresetId"in M.target){const{featuresetId:P,importId:z}=M.target,O=this.getFragmentStyle(z);if(!O||!O._featuresetSelectors)continue;const B=O._featuresetSelectors[P];if(!B){this.fire(new s.y(new Error(`The featureset '${P}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const V of B){const G=O.getOwnLayer(V.layerId);G&&!lg.has(G.type)&&x(G,O.getOwnLayerSourceCache(G),M,V)}}else if("layerId"in M.target){const{layerId:P}=M.target,z=this.getLayer(P);if(!z||lg.has(z.type))continue;x(z,this.getLayerSourceCache(z),M)}const w=this._queryRenderedFeatures(r,_,p);return this._flattenAndSortRenderedFeatures(w)}_queryRenderedFeatures(r,o,p){const _=[],x=!!this.map._showQueryGeometry,w=ii.createFromScreenPoints(r,p);for(const M in o){const P=xc(w,o[M],this._availableImages,p,x);Object.keys(P).length&&_.push(P)}if(this.placement)for(const M in o){if(!o[M].sourceCache._onlySymbols)continue;const P=Eu(w.screenGeometry,o[M],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData);Object.keys(P).length&&_.push(P)}return _}querySourceFeatures(r,o){const p=o&&o.filter;p&&this._validate(Kn,"querySourceFeatures.filter",p,null,o);let _=[];const x=this.getOwnSourceCaches(r);for(const w of x)_=_.concat(ad(w,o));return _}addSourceType(r,o,p){return Oa.getSourceType(r)?p(new Error(`A source type called "${r}" already exists.`)):(Oa.setSourceType(r,o),o.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:r,url:o.workerSourceURL},p):p(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(r,o,p={}){this._checkLoaded();const _=this.light.getLight();let x=!1;for(const M in r)if(!s.bn(r[M],_[M])){x=!0;break}if(!x)return;const w=this._getTransitionParameters();this.light.setLight(r,o,p),this.light.updateTransitions(w)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=s.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&s.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(r,o=1){if(this._checkLoaded(),!r)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),o===0&&delete this.terrain,r===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let p=r;const _=r.source==null;if(o===1){if(this.disableElevatedTerrain)return;if(typeof p.source=="object"){const M="terrain-dem-src";this.addSource(M,p.source),p=s.cp(p),p=s.l(p,{source:M})}const x=s.l({},p),w={};if(this.terrain&&_){x.source=this.terrain.get().source;const M=this.terrain?this.getFragmentStyle(this.terrain.scope):null;M&&(w.style=M.serialize())}if(this._validate(Ks,"terrain",x,w))return}if(!this.terrain||this.terrain.scope!==this.scope&&!_||this.terrain&&o!==this.terrain.drapeRenderMode){if(!p)return;this._createTerrain(p,o),this.fire(new s.z("data",{dataType:"style"}))}else{const x=this.terrain,w=x.get();for(const M of Object.keys(s.a3.terrain))!p.hasOwnProperty(M)&&s.a3.terrain[M].default&&(p[M]=s.a3.terrain[M].default);for(const M in r)if(!s.bn(r[M],w[M])){x.set(r,this.options),this.stylesheet.terrain=r;const P=this._getTransitionParameters({duration:0});x.updateTransitions(P),this.fire(new s.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(r){const o=this.fog=new Je(r,this.map.transform,this.scope,this.options);this.stylesheet.fog=o.get();const p=this._getTransitionParameters({duration:0});o.updateTransitions(p)}_createSnow(r){const o=this.snow=new Jt(r,this.map.transform,this.scope,this.options);this.stylesheet.snow=o.get();const p=this._getTransitionParameters({duration:0});o.updateTransitions(p)}_createRain(r){const o=this.rain=new si(r,this.map.transform,this.scope,this.options);this.stylesheet.rain=o.get();const p=this._getTransitionParameters({duration:0});o.updateTransitions(p)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const r of this.map._markers)r._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(r){if(this._checkLoaded(),!r)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const o=this.fog;if(!s.bn(o.get(),r)){o.set(r,this.options),this.stylesheet.fog=o.get();const p=this._getTransitionParameters({duration:0});o.updateTransitions(p)}}else this._createFog(r);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(r){if(this._checkLoaded(),!r)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const o=this.snow;if(!s.bn(o.get(),r)){o.set(r,this.options),this.stylesheet.snow=o.get();const p=this._getTransitionParameters({duration:0});o.updateTransitions(p)}}else this._createSnow(r);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(r){if(this._checkLoaded(),!r)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const o=this.rain;if(!s.bn(o.get(),r)){o.set(r,this.options),this.stylesheet.rain=o.get();const p=this._getTransitionParameters({duration:0});o.updateTransitions(p)}}else this._createRain(r);this._markersNeedUpdate=!0}_reloadColorTheme(){const r=()=>{for(const _ in this._layers)this._layers[_].lut=this._styleColorTheme.lut;for(const _ in this._sourceCaches)this._sourceCaches[_].clearTiles()},o=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!o)return this._styleColorTheme.lut=null,void r();const p=this._evaluateColorThemeData(o);this._loadColorTheme(p).then(()=>{this.fire(new s.z("colorthemeset")),r()}).catch(_=>{s.w(`Couldn't set color theme: ${_}`)})}setColorTheme(r){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&s.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=r,this._reloadColorTheme()}setImportColorTheme(r,o){const p=this.getFragmentStyle(r);p&&(p._styleColorTheme.colorThemeOverride=o,p._reloadColorTheme())}_getTransitionParameters(r){return{now:s.q.now(),transition:s.l(this.transition,r)}}updateDrapeFirstLayers(){if(!this.terrain)return;const r=[],o=[];for(const p of this._mergedOrder)this.isLayerDraped(this._mergedLayers[p])?r.push(p):o.push(p);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...r),this._drapedFirstOrder.push(...o)}_createTerrain(r,o){const p=this.terrain=new ne(r,o,this.scope,this.options);o===1&&(this.stylesheet.terrain=r),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const _=this._getTransitionParameters({duration:0});p.updateTransitions(_)}_force3DLayerUpdate(){for(const r in this._layers){const o=this._layers[r];o.type==="fill-extrusion"&&this._updateLayer(o)}}_forceSymbolLayerUpdate(){for(const r in this._layers){const o=this._layers[r];o.type==="symbol"&&this._updateLayer(o)}}_validate(r,o,p,_,x={}){if(x&&x.validate===!1)return!1;const w=s.l({},this.serialize());return Cc(this,r.call(os,s.l({key:o,style:w,value:p,styleSpec:s.a3},_)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.cx.off("pluginStateChange",this._rtlTextPluginCallback);for(const r in this._mergedLayers)this._mergedLayers[r].setEventedParent(null);for(const r in this._mergedSourceCaches)this._mergedSourceCaches[r].clearTiles(),this._mergedSourceCaches[r].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(r){const o=this.getSourceCaches(r);for(const p of o)p.clearTiles()}clearSources(){for(const r in this._mergedSourceCaches)this._mergedSourceCaches[r].clearTiles()}reloadSource(r){const o=this.getSourceCaches(r);for(const p of o)p.resume(),p.reload()}reloadSources(){for(const r of this.getSources())r.reload&&r.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(r=>{r.modelManager.reloadModels(r.scope)})}updateSources(r){let o;this.directionalLight&&(o=Mc(this.directionalLight));for(const p in this._mergedSourceCaches)this._mergedSourceCaches[p].update(r,void 0,void 0,o)}_generateCollisionBoxes(){for(const r in this._sourceCaches){const o=this._sourceCaches[r];o.resume(),o.reload()}}_updatePlacement(r,o,p,_,x,w,M=!1){let P=!1,z=!1;const O={},B={};for(const V of this._mergedOrder){const G=this._mergedLayers[V];if(G.type!=="symbol")continue;const Q=s.aC(G.source,G.scope);let W=O[Q];if(!W){const ee=this.getLayerSourceCache(G);if(!ee)continue;const le=ee.getRenderableIds(!0).map(pe=>ee.getTileByID(pe));B[Q]=le.slice(),W=O[Q]=le.sort((pe,fe)=>fe.tileID.overscaledZ-pe.tileID.overscaledZ||(pe.tileID.isLessThan(fe.tileID)?-1:1))}const te=this.crossTileSymbolIndex.addLayer(G,W,o.center.lng,o.projection);P=P||te}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),M=M||this._layerOrderChanged||_===0,this._layerOrderChanged&&this.fire(new s.z("neworder")),(M||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.q.now(),o.zoom))&&(this.pauseablePlacement=new L(o,this._mergedOrder,M,p,_,x,this.placement,this.fog&&o.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,O,B,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.q.now()),z=!0),P&&this.pauseablePlacement.placement.setStale()),z||P){this._buildingIndex.onNewFrame(o.zoom);for(let V=0;V<this._mergedOrder.length;V++){const G=this._mergedLayers[this._mergedOrder[V]];if(G.type!=="symbol")continue;const Q=this.isLayerClipped(G);this.placement.updateLayerOpacities(G,O[s.aC(G.source,G.scope)],V,Q?w:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.q.now())}}_releaseSymbolFadeTiles(){for(const r in this._sourceCaches)this._sourceCaches[r].releaseSymbolFadeTiles()}addImport(r,o){this._checkLoaded();const p=this.stylesheet.imports=this.stylesheet.imports||[];if(p.findIndex(({id:x})=>x===r.id)!==-1)return void this.fire(new s.y(new Error(`Import with id '${r.id}' already exists in the map's style.`)));if(!o)return p.push(r),this._loadImports([r],!0);const _=p.findIndex(({id:x})=>x===o);return _===-1&&this.fire(new s.y(new Error(`Import with id "${o}" does not exist on this map.`))),this.stylesheet.imports=p.slice(0,_).concat(r).concat(p.slice(_)),this._loadImports([r],!0,o)}updateImport(r,o){this._checkLoaded();const p=this.stylesheet.imports||[],_=this.getImportIndex(r);return _===-1?this:typeof o=="string"?(this.setImportUrl(r,o),this):(o.url&&o.url!==p[_].url&&this.setImportUrl(r,o.url),s.bn(o.config,p[_].config)||this.setImportConfig(r,o.config,o.data.schema),s.bn(o.data,p[_].data)||this.setImportData(r,o.data),this)}moveImport(r,o){this._checkLoaded();let p=this.stylesheet.imports||[];const _=this.getImportIndex(r);if(_===-1)return this;const x=this.getImportIndex(o);if(x===-1)return this;const w=p[_],M=this.fragments[_];return p=p.filter(({id:P})=>P!==r),this.fragments=this.fragments.filter(({id:P})=>P!==r),this.stylesheet.imports=p.slice(0,x).concat(w).concat(p.slice(x)),this.fragments=this.fragments.slice(0,x).concat(M).concat(this.fragments.slice(x)),this.mergeLayers(),this}setImportUrl(r,o){this._checkLoaded();const p=this.stylesheet.imports||[],_=this.getImportIndex(r);if(_===-1)return this;p[_].url=o;const x=this.fragments[_];return x.style=this._createFragmentStyle(p[_]),x.style.on("style.import.load",()=>this.mergeAll()),x.style.loadURL(o),this}setImportData(r,o){this._checkLoaded();const p=this.getImportIndex(r),_=this.stylesheet.imports||[];return p===-1?this:o?(this.fragments[p].style.setState(o),this._reloadImports(),this):(delete _[p].data,this.setImportUrl(r,_[p].url))}setImportConfig(r,o,p){this._checkLoaded();const _=this.getImportIndex(r),x=this.stylesheet.imports||[];if(_===-1)return this;o?x[_].config=o:delete x[_].config;const w=this.fragments[_];p&&w.style.stylesheet&&(w.style.stylesheet.schema=p);const M=w.style.stylesheet&&w.style.stylesheet.schema;return w.config=o,w.style.updateConfig(o,M),this.updateConfigDependencies(),this}removeImport(r){this._checkLoaded();const o=this.stylesheet.imports||[],p=this.getImportIndex(r);p!==-1&&(o.splice(p,1),this.fragments[p].style._remove(),this.fragments.splice(p,1),this._reloadImports())}getImportIndex(r){const o=(this.stylesheet.imports||[]).findIndex(p=>p.id===r);return o===-1&&this.fire(new s.y(new Error(`Import '${r}' does not exist in the map's style and cannot be updated.`))),o}getLayer(r){return this._mergedLayers[r]}getSources(){const r=[];for(const o in this._mergedOtherSourceCaches){const p=this._mergedOtherSourceCaches[o];p&&r.push(p.getSource())}return r}getSource(r,o){const p=this.getSourceCache(r,o);return p&&p.getSource()}getLayerSource(r){const o=this.getLayerSourceCache(r);return o&&o.getSource()}getSourceCache(r,o){const p=s.aC(r,o);return this._mergedOtherSourceCaches[p]}getLayerSourceCache(r){const o=s.aC(r.source,r.scope);return r.type==="symbol"?this._mergedSymbolSourceCaches[o]:this._mergedOtherSourceCaches[o]}getSourceCaches(r){if(r==null)return Object.values(this._mergedSourceCaches);const o=[];return this._mergedOtherSourceCaches[r]&&o.push(this._mergedOtherSourceCaches[r]),this._mergedSymbolSourceCaches[r]&&o.push(this._mergedSymbolSourceCaches[r]),o}updateSourceCaches(){const r=this._changes.getUpdatedSourceCaches();for(const o in r){const p=r[o];p==="reload"?this.reloadSource(o):p==="clear"&&this.clearSource(o)}}updateLayers(r){const o=this._changes.getUpdatedPaintProperties();for(const p of o){const _=this.getLayer(p);_&&_.updateTransitions(r)}}getImages(r,o,p){this.imageManager.getImages(o.icons,o.scope,p),this._updateTilesForChangedImages();const _=x=>{x&&x.setDependencies(o.tileID.key,o.type,o.icons)};_(this._otherSourceCaches[o.source]),_(this._symbolSourceCaches[o.source])}rasterizeImages(r,o,p){this.imageManager.rasterizeImages(o,p)}getGlyphs(r,o,p){this.glyphManager.getGlyphs(o.stacks,o.scope,p)}getResource(r,o,p){return s.cy(o,p)}getOwnSourceCache(r){return this._otherSourceCaches[r]}getOwnLayerSourceCache(r){return r.type==="symbol"?this._symbolSourceCaches[r.source]:this._otherSourceCaches[r.source]}getOwnSourceCaches(r){const o=[];return this._otherSourceCaches[r]&&o.push(this._otherSourceCaches[r]),this._symbolSourceCaches[r]&&o.push(this._symbolSourceCaches[r]),o}_isSourceCacheLoaded(r){const o=this.getOwnSourceCaches(r);return o.length===0?(this.fire(new s.y(new Error(`There is no source with ID '${r}'`))),!1):o.every(p=>p.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(r,o){if(!this._clipLayerPresent&&r.type!=="fill-extrusion")return!1;const p=r.type==="fill-extrusion"&&r.sourceLayer==="building";if(r.is3D()){if(p||o&&o.type==="batched-model"||r.type==="model")return!0}else if(r.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(r=>{r.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Oa.getSourceType=function(f){return Qn[f]},Oa.setSourceType=function(f,r){Qn[f]=r},Oa.registerForPluginStateChange=s.ch;var qf=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,fd=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Gf=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,jl="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Hf=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,cg=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Rc=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Du=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,pd=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,md=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Dc=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef TEXTURE_GATHER
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz/=light_view_pos0.w;vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Pc=[];Lc(qf,Pc),Lc(Gf,Pc),Lc(fd,Pc);const Pu={"_prelude_fog.vertex.glsl":cg,"_prelude_terrain.vertex.glsl":Hf,"_prelude_shadow.vertex.glsl":md,"_prelude_fog.fragment.glsl":Rc,"_prelude_shadow.fragment.glsl":Dc,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Du,"_prelude_raster_particle.glsl":pd},gd={};Fi("",Hf),Fi(Rc,cg),Fi(Dc,md),Fi(Du,""),Fi(pd,"");const $f=Fi(fd,Gf),_d=qf;var Lu={background:Fi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Fi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Fi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Fi("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Fi(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Fi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Fi("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Fi("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Fi("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Fi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:Fi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Fi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Fi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Fi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Fi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Fi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Fi(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Fi(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Fi(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Fi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Fi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:Fi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:Fi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Fi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Fi("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Fi("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Fi(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Fi(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+(u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#else
z+=u_pitch_with_map ? (u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#endif
}`),terrainRaster:Fi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Fi("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Fi(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,jl),skyboxGradient:Fi(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,jl),skyboxCapture:Fi(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Fi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Fi(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Fi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Fi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Fi(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:Fi("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:Fi("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:Fi("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:Fi("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Lc(f,r){const o=f.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let p of o)if(p=p.trim(),p[0]==="#"&&p.includes("if")&&!p.includes("endif")){p=p.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const _=p.split(" ");for(const x of _)r.includes(x)||r.push(x)}}function Fi(f,r){const o=/#include\s+"([^"]+)"/g,p=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let _=r.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);_&&(_=_.map(z=>{const O=z.split(" ");return O[O.length-1]}),_=[...new Set(_)]);const x={},w=[],M=[];if(f=f.replace(o,(z,O)=>(M.push(O),"")),(r=r.replace(o,(z,O)=>(w.push(O),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let P=[...Pc];Lc(f,P),Lc(r,P);for(const z of[...w,...M])Pu[z]||console.error(`Undefined include: ${z}`),gd[z]||(gd[z]=[],Lc(Pu[z],gd[z])),P=[...P,...gd[z]];return{fragmentSource:f=f.replace(p,(z,O,B,V,G)=>(x[G]=!0,O==="define"?`
#ifndef HAS_UNIFORM_u_${G}
in ${B} ${V} ${G};
#else
uniform ${B} ${V} u_${G};
#endif
`:O==="initialize"?`
#ifdef HAS_UNIFORM_u_${G}
    ${B} ${V} ${G} = u_${G};
#endif
`:O==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${G}
    in ${B} ${V} ${G};
#endif
`:O==="initialize-attribute"?"":void 0)),vertexSource:r=r.replace(p,(z,O,B,V,G)=>{const Q=V==="float"?"vec2":V,W=G.match(/color/)?"color":Q;return O==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${G}
in ${B} ${V} a_${G};
#endif
`:x[G]?O==="define"?`
#ifndef HAS_UNIFORM_u_${G}
uniform lowp float u_${G}_t;
in ${B} ${Q} a_${G};
out ${B} ${V} ${G};
#else
uniform ${B} ${V} u_${G};
#endif
`:O==="initialize"?W==="vec4"?`
#ifndef HAS_UNIFORM_u_${G}
    ${G} = a_${G};
#else
    ${B} ${V} ${G} = u_${G};
#endif
`:`
#ifndef HAS_UNIFORM_u_${G}
    ${G} = unpack_mix_${W}(a_${G}, u_${G}_t);
#else
    ${B} ${V} ${G} = u_${G};
#endif
`:O==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${G}
    in ${B} ${V} a_${G};
    out ${B} ${V} ${G};
#endif
`:O==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${G}
    ${G} = a_${G};
#endif
`:void 0:O==="define"?`
#ifndef HAS_UNIFORM_u_${G}
uniform lowp float u_${G}_t;
in ${B} ${Q} a_${G};
#else
uniform ${B} ${V} u_${G};
#endif
`:O==="define-instanced"?W==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${G}0;
in vec4 a_${G}1;
in vec4 a_${G}2;
in vec4 a_${G}3;
#else
uniform ${B} ${V} u_${G};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${B} ${Q} a_${G};
#else
uniform ${B} ${V} u_${G};
#endif
`:O==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${G}
    ${B} ${V} ${G} = a_${G};
#endif
`:W==="vec4"?`
#ifndef HAS_UNIFORM_u_${G}
    ${B} ${V} ${G} = a_${G};
#else
    ${B} ${V} ${G} = u_${G};
#endif
`:`
#ifndef HAS_UNIFORM_u_${G}
    ${B} ${V} ${G} = unpack_mix_${W}(a_${G}, u_${G}_t);
#else
    ${B} ${V} ${G} = u_${G};
#endif
`}),staticAttributes:_,usedDefines:P,vertexIncludes:w,fragmentIncludes:M}}class D0{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(r,o,p,_,x,w,M,P){this.context=r;let z=this.boundPaintVertexBuffers.length!==_.length;for(let B=0;!z&&B<_.length;B++)this.boundPaintVertexBuffers[B]!==_[B]&&(z=!0);let O=this.boundDynamicVertexBuffers.length!==M.length;for(let B=0;!O&&B<M.length;B++)this.boundDynamicVertexBuffers[B]!==M[B]&&(O=!0);if(!this.vao||this.boundProgram!==o||this.boundLayoutVertexBuffer!==p||z||O||this.boundIndexBuffer!==x||this.boundVertexOffset!==w)this.freshBind(o,p,_,x,w,M,P);else{r.bindVertexArrayOES.set(this.vao);for(const B of M)B&&(B.bind(),P&&B.instanceCount&&B.setVertexAttribDivisor(r.gl,o,P));x&&x.dynamicDraw&&x.bind()}}freshBind(r,o,p,_,x,w,M){const P=r.numAttributes,z=this.context,O=z.gl;this.vao&&this.destroy(),this.vao=z.gl.createVertexArray(),z.bindVertexArrayOES.set(this.vao),this.boundProgram=r,this.boundLayoutVertexBuffer=o,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=_,this.boundVertexOffset=x,this.boundDynamicVertexBuffers=w,o.enableAttributes(O,r),o.bind(),o.setVertexAttribPointers(O,r,x);for(const B of p)B.enableAttributes(O,r),B.bind(),B.setVertexAttribPointers(O,r,x);for(const B of w)B&&(B.enableAttributes(O,r),B.bind(),B.setVertexAttribPointers(O,r,x),M&&B.instanceCount&&B.setVertexAttribDivisor(O,r,M));_&&_.bind(),z.currentNumAttributes=P}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function zu(f,r){const o=Math.pow(2,r.canonical.z),p=r.canonical.y;return[new s.aa(0,p/o).toLngLat().lat,new s.aa(0,(p+1)/o).toLngLat().lat]}function P0(f,r,o,p,_,x,w){const M=f.context,P=M.gl,z=o.hillshadeFBO;if(!z)return;f.prepareDrawTile();const O=f.isTileAffectedByFog(r),B=f.getOrCreateProgram("hillshade",{overrideFog:O});M.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,z.colorAttachment.get());const V=((te,ee,le,pe)=>{const fe=le.paint.get("hillshade-shadow-color"),Te=le.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",_e=le.paint.get("hillshade-highlight-color"),xe=le.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",ge=le.paint.get("hillshade-accent-color"),Re=le.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Fe=le.paint.get("hillshade-emissive-strength");let rt=s.ai(le.paint.get("hillshade-illumination-direction"));if(le.paint.get("hillshade-illumination-anchor")==="viewport")rt-=te.transform.angle;else if(te.style&&te.style.enable3dLights()&&te.style.directionalLight){const ht=te.style.directionalLight.properties.get("direction"),ut=s.cb(ht.x,ht.y,ht.z);rt=s.ai(ut[1])}const Ke=!te.options.moving;return{u_matrix:pe||te.transform.calculateProjMatrix(ee.tileID.toUnwrapped(),Ke),u_image:0,u_latrange:zu(0,ee.tileID),u_light:[le.paint.get("hillshade-exaggeration"),rt],u_shadow:fe.toRenderColor(Te?null:le.lut),u_highlight:_e.toRenderColor(xe?null:le.lut),u_emissive_strength:Fe,u_accent:ge.toRenderColor(Re?null:le.lut)}})(f,o,p,f.terrain?r.projMatrix:null);f.uploadCommonUniforms(M,B,r.toUnwrapped());const{tileBoundsBuffer:G,tileBoundsIndexBuffer:Q,tileBoundsSegments:W}=f.getTileBoundsBuffers(o);B.draw(f,P.TRIANGLES,_,x,w,li.disabled,V,p.id,G,Q,W)}function L0(f,r,o){if(!r.needsDEMTextureUpload)return;const p=f.context,_=p.gl;p.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||f.getTileTexture(o.stride);const x=o.getPixels();r.demTexture?r.demTexture.update(x,{premultiply:!1}):r.demTexture=new s.T(p,x,_.R32F,{premultiply:!1}),r.needsDEMTextureUpload=!1}function Wb(f,r,o){const p=f.context,_=p.gl;if(!r.dem)return;const x=r.dem;if(p.activeTexture.set(_.TEXTURE1),L0(f,r,x),!r.demTexture)return;r.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE);const w=x.dim;p.activeTexture.set(_.TEXTURE0);let M=r.hillshadeFBO;if(!M){const V=new s.T(p,{width:w,height:w,data:null},_.RGBA8);V.bind(_.LINEAR,_.CLAMP_TO_EDGE),M=r.hillshadeFBO=p.createFramebuffer(w,w,!0,"renderbuffer"),M.colorAttachment.set(V.texture)}p.bindFramebuffer.set(M.framebuffer),p.viewport.set([0,0,w,w]);const{tileBoundsBuffer:P,tileBoundsIndexBuffer:z,tileBoundsSegments:O}=f.getMercatorTileBoundsBuffers(),B=[];f.linearFloatFilteringSupported()&&B.push("TERRAIN_DEM_FLOAT_FORMAT"),f.getOrCreateProgram("hillshadePrepare",{defines:B}).draw(f,_.TRIANGLES,Ht.disabled,Kt.disabled,ni.unblended,li.disabled,((V,G)=>{const Q=G.stride,W=s.ab.mat4.create();return s.ab.mat4.ortho(W,0,s.ag,-s.ag,0,0,1),s.ab.mat4.translate(W,W,[0,-s.ag,0]),{u_matrix:W,u_image:1,u_dimension:[Q,Q],u_zoom:V.overscaledZ}})(r.tileID,x),o.id,P,z,O),r.needsHillshadePrepare=!1}class An{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ug extends An{getDefault(){return s.aj.transparent}set(r){const o=this.current;(r.r!==o.r||r.g!==o.g||r.b!==o.b||r.a!==o.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class hg extends An{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class dg extends An{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class fg extends An{getDefault(){return[!0,!0,!0,!0]}set(r){const o=this.current;(r[0]!==o[0]||r[1]!==o[1]||r[2]!==o[2]||r[3]!==o[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class z0 extends An{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class O0 extends An{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class Xb extends An{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const o=this.current;(r.func!==o.func||r.ref!==o.ref||r.mask!==o.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class yd extends An{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const o=this.current;(r[0]!==o[0]||r[1]!==o[1]||r[2]!==o[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class vd extends An{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const o=this.gl;r?o.enable(o.STENCIL_TEST):o.disable(o.STENCIL_TEST),this.current=r,this.dirty=!1}}class k0 extends An{getDefault(){return[0,1]}set(r){const o=this.current;(r[0]!==o[0]||r[1]!==o[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class ta extends An{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const o=this.gl;r?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST),this.current=r,this.dirty=!1}}class pg extends An{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class Zf extends An{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const o=this.gl;r?o.enable(o.BLEND):o.disable(o.BLEND),this.current=r,this.dirty=!1}}class Wf extends An{getDefault(){const r=this.gl;return[r.ONE,r.ZERO,r.ONE,r.ZERO]}set(r){const o=this.current;(r[0]!==o[0]||r[1]!==o[1]||r[2]!==o[2]||r[3]!==o[3]||this.dirty)&&(this.gl.blendFuncSeparate(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class mg extends An{getDefault(){return s.aj.transparent}set(r){const o=this.current;(r.r!==o.r||r.g!==o.g||r.b!==o.b||r.a!==o.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class gg extends An{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(r,r),this.current=r,this.dirty=!1)}}class Xf extends An{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const o=this.gl;r?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),this.current=r,this.dirty=!1}}class _g extends An{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class yg extends An{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}let Yf=class extends An{getDefault(){return null}set(f){(f!==this.current||this.dirty)&&(this.gl.useProgram(f),this.current=f,this.dirty=!1)}};class N0 extends An{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class F0 extends An{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const o=this.current;(r[0]!==o[0]||r[1]!==o[1]||r[2]!==o[2]||r[3]!==o[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Ou extends An{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const o=this.gl;o.bindFramebuffer(o.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class Yb extends An{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const o=this.gl;o.bindRenderbuffer(o.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class Kb extends An{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const o=this.gl;o.bindTexture(o.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class Qb extends An{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const o=this.gl;o.bindBuffer(o.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class Jb extends An{getDefault(){return null}set(r){const o=this.gl;o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class ew extends An{getDefault(){return null}set(r){this.gl&&(r!==this.current||this.dirty)&&(this.gl.bindVertexArray(r),this.current=r,this.dirty=!1)}}class tw extends An{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class vg extends An{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class xg extends An{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class Kf extends An{constructor(r,o){super(r),this.context=r,this.parent=o}getDefault(){return null}}class ku extends Kf{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class bg extends Kf{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,this.attachment(),o.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class B0 extends Kf{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,this.attachment(),o.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class V0 extends bg{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const wg=(f,r,o)=>({u_matrix:f,u_image0:0,u_skirt_height:r,u_ground_shadow_factor:o}),ql=(f,r,o,p,_,x,w,M,P,z,O,B,V,G,Q,W)=>({u_proj_matrix:Float32Array.from(f),u_globe_matrix:r,u_normalize_matrix:Float32Array.from(p),u_merc_matrix:o,u_zoom_transition:_,u_merc_center:x,u_image0:0,u_frustum_tl:w,u_frustum_tr:M,u_frustum_br:P,u_frustum_bl:z,u_globe_pos:O,u_globe_radius:B,u_viewport:V,u_grid_matrix:W?Float32Array.from(W):new Float32Array(9),u_skirt_height:G,u_far_z_cutoff:Q});function Tg(f,r){return f!=null&&r!=null&&!(!f.hasData()||!r.hasData())&&f.demTexture!=null&&r.demTexture!=null&&f.tileID.key!==r.tileID.key}const va=new class{constructor(){this.operations={}}newMorphing(f,r,o,p,_){if(f in this.operations){const x=this.operations[f];x.to.tileID.key!==o.tileID.key&&(x.queued=o)}else this.operations[f]={startTime:p,phase:0,duration:_,from:r,to:o,queued:null}}getMorphValuesForProxy(f){if(!(f in this.operations))return null;const r=this.operations[f];return{from:r.from,to:r.to,phase:r.phase}}update(f){for(const r in this.operations){const o=this.operations[r];for(o.phase=(f-o.startTime)/o.duration;o.phase>=1||!this._validOp(o);)if(!this._nextOp(o,f)){delete this.operations[r];break}}}_nextOp(f,r){return!!f.queued&&(f.from=f.to,f.to=f.queued,f.queued=null,f.phase=0,f.startTime=r,!0)}_validOp(f){return f.from.hasData()&&f.to.hasData()}},Qf={0:null,1:"TERRAIN_VERTEX_MORPHING"};function xd(f,r,o){if(r===0)return 0;const p=r<1&&o===514?.25/r:1;return 6*Math.pow(1.5,22-f)*Math.max(r,1)*p}function U0(f,r){const o=1<<f.z;return!r&&(f.x===0||f.x===o-1)||f.y===0||f.y===o-1}const Jf=f=>({u_matrix:f});function bd(f,r,o,p,_){if(_>0){const x=s.q.now(),w=(x-f.timeAdded)/_,M=r?(x-r.timeAdded)/_:-1,P=o.getSource(),z=p.coveringZoomLevel({tileSize:P.tileSize,roundZoom:P.roundZoom}),O=!r||Math.abs(r.tileID.overscaledZ-z)>Math.abs(f.tileID.overscaledZ-z),B=O&&f.refreshedUponExpiration?1:s.aw(O?w:1-M,0,1);return f.refreshedUponExpiration&&w>=1&&(f.refreshedUponExpiration=!1),r?{opacity:1,mix:1-B}:{opacity:B,mix:0}}return{opacity:1,mix:0}}class Eg extends Js{constructor(r){const o={type:"raster-dem",maxzoom:r.transform.maxZoom},p=new s.D(s.ci(),null),_=Ur("mock-dem",o,p,r.style);super("mock-dem",_,!1),_.setEventedParent(this),this._sourceLoaded=!0}_loadTile(r,o){r.state="loaded",o(null)}}class iw extends Js{constructor(r){const o=Ur("proxy",{type:"geojson",maxzoom:r.transform.maxZoom},new s.D(s.ci(),null),r.style);super("proxy",o,!1),o.setEventedParent(this),this.map=this.getSource().map=r,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(r,o,p){if(r.freezeTileCoverage)return;this.transform=r;const _=r.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((x,w)=>{if(x[w.key]="",!this._tiles[w.key]){const M=new wo(w,this._source.tileSize*w.overscaleFactor(),r.tileZoom);M.state="loaded",this._tiles[w.key]=M}return x},{});for(const x in this._tiles)x in _||(this.freeFBO(x),this._tiles[x].unloadVectorData(),delete this._tiles[x])}freeFBO(r){const o=this.proxyCachedFBO[r];if(o!==void 0){const p=Object.values(o);this.renderCachePool.push(...p),delete this.proxyCachedFBO[r]}}deallocRenderCache(){this.renderCache.forEach(r=>r.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Sg extends s.aG{constructor(r,o,p){super(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y),this.proxyTileKey=o,this.projMatrix=p}}class Nu extends s.cJ{constructor(r,o){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},r.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),r.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),r.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=r,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[p,_,x]=function(P){const z=new s.b4,O=new s.aU,B=131;z.reserve(17161),O.reserve(33800);const V=s.ag/128,G=s.ag+V/2,Q=G+V;for(let te=-V;te<Q;te+=V)for(let ee=-V;ee<Q;ee+=V){const le=ee<0||ee>G||te<0||te>G?24575:0,pe=s.aw(Math.round(ee),0,s.ag),fe=s.aw(Math.round(te),0,s.ag);z.emplaceBack(pe+le,fe)}const W=(te,ee)=>{const le=ee*B+te;O.emplaceBack(le+1,le,le+B),O.emplaceBack(le+B,le+B+1,le+1)};for(let te=1;te<129;te++)for(let ee=1;ee<129;ee++)W(ee,te);return[0,129].forEach(te=>{for(let ee=0;ee<130;ee++)W(ee,te),W(te,ee)}),[z,O,32768]}(),w=r.context;this.gridBuffer=w.createVertexBuffer(p,s.b6.members),this.gridIndexBuffer=w.createIndexBuffer(_),this.gridSegments=s.b7.simpleSegment(0,0,p.length,_.length),this.gridNoSkirtSegments=s.b7.simpleSegment(0,0,p.length,x),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new iw(o.map),this.orthoMatrix=s.ab.mat4.create(),s.ab.mat4.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,s.ag,0,s.ag,0,1);const M=w.gl;this._overlapStencilMode=new Kt({func:M.GEQUAL,mask:255},0,255,M.KEEP,M.KEEP,M.REPLACE),this._previousZoom=r.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=o,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Eg(o.map),this._pendingGroundEffectLayers=[]}set style(r){r.on("data",this._onStyleDataEvent.bind(this)),this._style=r,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(r,o,p){if(r&&r.terrain){this._style!==r&&(this.style=r,this._evaluationZoom=void 0);const _=r.terrain.properties,x=r.terrain.drapeRenderMode===0,w=r.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=s.q.now();const M=r.terrain&&r.terrain.scope,P=_.get("source"),z=x?this._mockSourceCache:r.getSourceCache(P,M);if(!z)return void s.w(`Couldn't find terrain source "${P}".`);if(this.sourceCache=z,this._attenuationRange=r.terrain.getAttenuationRange(),this._exaggeration=w?this.calculateExaggeration(o):_.get("exaggeration"),!o.projection.requiresDraping&&w&&this._exaggeration===0)return void this._disable();this.enabled=!0;const O=()=>{this.sourceCache.used&&s.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const B=this.getScaledDemTileSize();this.sourceCache.update(o,B,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,O(),this._initializing=!0),O(),o.updateElevation(!0,p),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(o),this._emptyDEMTextureDirty=!0,this._previousZoom=o.zoom}else this._disable()}calculateExaggeration(r){if(this._attenuationRange&&r.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(r.zoom);const o=this._previousCameraAltitude,p=r.getFreeCameraOptions().position.z/r.pixelsPerMeter*r.worldSize;this._previousCameraAltitude=p;const _=o!=null?p-o:Number.MAX_VALUE;if(Math.abs(_)<2)return this._exaggeration;const x=r.zoom,w=this._style.terrain;if(!this._previousUpdateTimestamp)return w.getExaggeration(x);let M=x-this._previousZoom;const P=this._previousUpdateTimestamp;let z=x;this._evaluationZoom!=null&&(z=this._evaluationZoom,Math.abs(x-z)>.5&&(M=.5*(x-z+M)),M*_<0&&(z+=M)),this._evaluationZoom=z;const O=w.getExaggeration(z),B=O===w.getExaggeration(Math.max(0,z-.1));if(B&&Math.abs(O-this._exaggeration)<.01)return O;let V=Math.min(.1,.00375*(this._updateTimestamp-P));return(B||O<.1||Math.abs(M)<1e-4)&&(V=Math.min(.2,4*V)),s.af(this._exaggeration,O,V)}resetTileLookupCache(r){this._findCoveringTileCache[r]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(r){r.coord&&r.dataType==="source"?this._clearRenderCacheForTile(r.sourceCacheId,r.coord):r.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const r in this._style._mergedSourceCaches)this._style._mergedSourceCaches[r].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(r=>r.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const r=2*this.proxySourceCache.getSource().tileSize;return[r,r]}set useVertexMorphing(r){this._useVertexMorphing=r}updateTileBinding(r){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const o=this.proxySourceCache,p=this.painter.transform;this._initializing&&(this._initializing=p._centerAltitude===0&&this.getAtPointOrZero(s.aa.fromLngLat(p.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const _=this.proxyCoords=o.getIds().map(P=>{const z=o.getTileByID(P).tileID;return z.projMatrix=p.calculateProjMatrix(z.toUnwrapped()),z});(function(P,z){const O=z.transform.pointCoordinate(z.transform.getCameraPoint()),B=new s.P(O.x,O.y);P.sort((V,G)=>{if(G.overscaledZ-V.overscaledZ)return G.overscaledZ-V.overscaledZ;const Q=new s.P(V.canonical.x+(1<<V.canonical.z)*V.wrap,V.canonical.y),W=new s.P(G.canonical.x+(1<<G.canonical.z)*G.wrap,G.canonical.y),te=B.mult(1<<V.canonical.z);return te.x-=.5,te.y-=.5,te.distSqr(Q)-te.distSqr(W)})})(_,this.painter);const x=this.proxyToSource||{};this.proxyToSource={},_.forEach(P=>{this.proxyToSource[P.key]={}}),this.terrainTileForTile={};const w=this._style._mergedSourceCaches;for(const P in w){const z=w[P];if(!z.used||(z!==this.sourceCache&&this.resetTileLookupCache(z.id),this._setupProxiedCoordsForOrtho(z,r[P],x),z.usedForTerrain))continue;const O=r[P];z.getSource().reparseOverscaled&&this._assignTerrainTiles(O)}this.proxiedCoords[o.id]=_.map(P=>new Sg(P,P.key,this.orthoMatrix)),this._assignTerrainTiles(_),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(x),this.renderingToTexture=!1;const M={};this._visibleDemTiles=[];for(const P of this.proxyCoords){const z=this.terrainTileForTile[P.key];if(!z)continue;const O=z.tileID.key;O in M||(this._visibleDemTiles.push(z),M[O]=O)}}_assignTerrainTiles(r){this._initializing||r.forEach(o=>{if(this.terrainTileForTile[o.key])return;const p=this._findTileCoveringTileID(o,this.sourceCache);p&&(this.terrainTileForTile[o.key]=p)})}_prepareDEMTextures(){const r=this.painter.context,o=r.gl;for(const p in this.terrainTileForTile){const _=this.terrainTileForTile[p],x=_.dem;!x||_.demTexture&&!_.needsDEMTextureUpload||(r.activeTexture.set(o.TEXTURE1),L0(this.painter,_,x))}}_prepareDemTileUniforms(r,o,p,_){if(!o||o.demTexture==null)return!1;const x=r.tileID.canonical,w=Math.pow(2,o.tileID.canonical.z-x.z),M=_||"";return p[`u_dem_tl${M}`]=[x.x*w%1,x.y*w%1],p[`u_dem_scale${M}`]=w,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let r=0;const o=this._visibleDemTiles.reduce((p,_)=>{if(!_.dem)return p;const x=_.dem.tree.minimums[0];return x>0&&r++,p+x},0);return r?o/r:0}_updateEmptyDEMTexture(){const r=this.painter.context,o=r.gl;r.activeTexture.set(o.TEXTURE2);const p=this._getLoadedAreaMinimum(),_=new s.cK({width:1,height:1},new Float32Array([p]));this._emptyDEMTextureDirty=!1;let x=this._emptyDEMTexture;return x?x.update(_,{premultiply:!1}):x=this._emptyDEMTexture=new s.T(r,_,o.R32F,{premultiply:!1}),x}setupElevationDraw(r,o,p){const _=this.painter.context,x=_.gl,w={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};w.u_exaggeration=this.exaggeration();let M=null,P=null,z=1;if(p&&p.morphing&&this._useVertexMorphing){const G=p.morphing.srcDemTile,Q=p.morphing.dstDemTile;z=p.morphing.phase,G&&Q&&(this._prepareDemTileUniforms(r,G,w,"_prev")&&(P=G),this._prepareDemTileUniforms(r,Q,w)&&(M=Q))}const O=G=>G&&G.demTexture&&this.painter.linearFloatFilteringSupported()?x.LINEAR:x.NEAREST;let B=null;var V;if(this.enabled?P&&M?(B=M.demTexture,_.activeTexture.set(x.TEXTURE4),P.demTexture.bind(O(P),x.CLAMP_TO_EDGE),w.u_dem_lerp=z):(M=this.terrainTileForTile[r.tileID.key],B=this._prepareDemTileUniforms(r,M,w)?M.demTexture:this.emptyDEMTexture):B=this.emptyDEMTexture,_.activeTexture.set(x.TEXTURE2),B&&(w.u_dem_size=(V=B).size[0]===1?1:V.size[0]-2,B.bind(O(M),x.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(p&&p.useDepthForOcclusion,o,w),p&&p.useMeterToDem&&M){const G=(1<<M.tileID.canonical.z)*s.bH(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;w.u_meter_to_dem=G}if(p&&p.labelPlaneMatrixInv&&(w.u_label_plane_matrix_inv=p.labelPlaneMatrixInv),o.setTerrainUniformValues(_,w),this.painter.transform.projection.name==="globe"){const G=this.globeUniformValues(this.painter.transform,r.tileID.canonical,p&&p.useDenormalizedUpVectorScale);o.setGlobeUniformValues(_,G)}}globeUniformValues(r,o,p){const _=r.projection;return{u_tile_tl_up:_.upVector(o,0,0),u_tile_tr_up:_.upVector(o,s.ag,0),u_tile_br_up:_.upVector(o,s.ag,s.ag),u_tile_bl_up:_.upVector(o,0,s.ag),u_tile_up_scale:p?s.cL(1):_.upVectorScale(o,r.center.lat,r.worldSize).metersToTile}}renderToBackBuffer(r){const o=this.painter,p=this.painter.context;r.length!==0&&(p.bindFramebuffer.set(null),p.viewport.set([0,0,o.width,o.height]),o.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(_,x,w,M,P){if(_.transform.projection.name==="globe")(function(z,O,B,V,G){const Q=z.context,W=Q.gl;let te,ee;const le=z.transform,pe=s.cC(z,Q,le),fe=(ht,ut)=>{if(ee===ut)return;const $e=[Qf[ut],"PROJECTION_GLOBE_VIEW"];pe&&$e.push("CUSTOM_ANTIALIASING");const st=z.isTileAffectedByFog(ht);te=z.getOrCreateProgram("globeRaster",{defines:$e,overrideFog:st}),ee=ut},Te=z.colorModeForRenderPass(),_e=new Ht(W.LEQUAL,Ht.ReadWrite,z.depthRangeFor3D);va.update(G);const xe=s.cD(le),ge=[s.at(le.center.lng),s.aA(le.center.lat)],Re=z.globeSharedBuffers,Fe=[le.width*s.q.devicePixelRatio,le.height*s.q.devicePixelRatio],rt=Float32Array.from(le.globeMatrix),Ke={useDenormalizedUpVectorScale:!0};{const ht=z.transform,ut=xd(ht.zoom,O.exaggeration(),O.sourceCache._source.tileSize);ee=-1;const $e=W.TRIANGLES;for(const st of V){const xt=B.getTile(st),He=Kt.disabled,ft=O.prevTerrainTileForTile[st.key],at=O.terrainTileForTile[st.key];Tg(ft,at)&&va.newMorphing(st.key,ft,at,G,250),Q.activeTexture.set(W.TEXTURE0),xt.texture&&xt.texture.bind(W.LINEAR,W.CLAMP_TO_EDGE);const Mt=va.getMorphValuesForProxy(st.key),_t=Mt?1:0;Mt&&s.J(Ke,{morphing:{srcDemTile:Mt.from,dstDemTile:Mt.to,phase:s.cB(Mt.phase)}});const dt=s.cE(st.canonical),bt=s.cF(dt.getCenter().lat),It=s.cG(st.canonical,dt,bt,ht.worldSize/ht._pixelsPerMercatorPixel),Ot=s.bb(s.cH(st.canonical)),jt=ql(ht.expandedFarZProjMatrix,rt,xe,Ot,s.ae(ht.zoom),ge,ht.frustumCorners.TL,ht.frustumCorners.TR,ht.frustumCorners.BR,ht.frustumCorners.BL,ht.globeCenterInViewSpace,ht.globeRadius,Fe,ut,ht._farZ,It);if(fe(st,_t),te&&(O.setupElevationDraw(xt,te,Ke),z.uploadCommonUniforms(Q,te,st.toUnwrapped()),Re)){const[ui,ti,ri]=Re.getGridBuffers(bt,ut!==0);te.draw(z,$e,_e,He,Te,li.backCCW,jt,"globe_raster",ui,ti,ri)}}}if(Re&&(z.renderDefaultNorthPole||z.renderDefaultSouthPole)){const ht=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];pe&&ht.push("CUSTOM_ANTIALIASING"),te=z.getOrCreateProgram("globeRaster",{defines:ht});for(const ut of V){const{x:$e,y:st,z:xt}=ut.canonical,He=st===0,ft=st===(1<<xt)-1,[at,Mt,_t,dt]=Re.getPoleBuffers(xt,!1);if(dt&&(He||ft)){const bt=B.getTile(ut);Q.activeTexture.set(W.TEXTURE0),bt.texture&&bt.texture.bind(W.LINEAR,W.CLAMP_TO_EDGE);let It=s.cI(xt,$e,le);const Ot=s.bb(s.cH(ut.canonical)),jt=(ui,ti)=>ui.draw(z,W.TRIANGLES,_e,Kt.disabled,Te,li.disabled,ql(le.expandedFarZProjMatrix,It,It,Ot,0,ge,le.frustumCorners.TL,le.frustumCorners.TR,le.frustumCorners.BR,le.frustumCorners.BL,le.globeCenterInViewSpace,le.globeRadius,Fe,0,le._farZ),"globe_pole_raster",ti,_t,dt);O.setupElevationDraw(bt,te,Ke),z.uploadCommonUniforms(Q,te,ut.toUnwrapped()),He&&z.renderDefaultNorthPole&&jt(te,at),ft&&z.renderDefaultSouthPole&&(It=s.ab.mat4.scale(s.ab.mat4.create(),It,[1,-1,1]),jt(te,Mt))}}}})(_,x,w,M,P);else{const z=_.context,O=z.gl;let B,V;const G=_.shadowRenderer,Q=Ul(_,_.longestCutoffRange),W=Te=>{if(V===Te)return;const _e=[];_e.push(Qf[Te]),Q.shouldRenderCutoff&&_e.push("RENDER_CUTOFF"),G&&(_e.push("RENDER_SHADOWS","DEPTH_TEXTURE"),G.useNormalOffset&&_e.push("NORMAL_OFFSET")),B=_.getOrCreateProgram("terrainRaster",{defines:_e}),V=Te},te=_.colorModeForRenderPass(),ee=new Ht(O.LEQUAL,Ht.ReadWrite,_.depthRangeFor3D);va.update(P);const le=_.transform,pe=xd(le.zoom,x.exaggeration(),x.sourceCache._source.tileSize);let fe=[0,0,0];if(G){const Te=_.style.directionalLight,_e=_.style.ambientLight;Te&&_e&&(fe=rg(_.style,Te,_e))}{V=-1;const Te=O.TRIANGLES,[_e,xe]=[x.gridIndexBuffer,x.gridSegments];for(const ge of M){const Re=w.getTile(ge),Fe=Kt.disabled,rt=x.prevTerrainTileForTile[ge.key],Ke=x.terrainTileForTile[ge.key];Tg(rt,Ke)&&va.newMorphing(ge.key,rt,Ke,P,250),z.activeTexture.set(O.TEXTURE0),Re.texture&&Re.texture.bind(O.LINEAR,O.CLAMP_TO_EDGE);const ht=va.getMorphValuesForProxy(ge.key),ut=ht?1:0;let $e;ht&&($e={morphing:{srcDemTile:ht.from,dstDemTile:ht.to,phase:s.cB(ht.phase)}});const st=wg(ge.projMatrix,U0(ge.canonical,le.renderWorldCopies)?pe/10:pe,fe);if(W(ut),!B)continue;x.setupElevationDraw(Re,B,$e);const xt=ge.toUnwrapped();G&&G.setupShadows(xt,B),_.uploadCommonUniforms(z,B,xt,null,Q),B.draw(_,Te,ee,Fe,te,li.backCCW,st,"terrain_raster",x.gridBuffer,_e,xe)}}}}(o,this,this.proxySourceCache,r,this._updateTimestamp),this.renderingToTexture=!0,o.gpuTimingDeferredRenderEnd(),r.splice(0,r.length))}renderBatch(r){if(this._drapedRenderBatches.length===0)return r+1;this.renderingToTexture=!0;const o=this.painter,p=this.painter.context,_=this.proxySourceCache,x=this.proxiedCoords[_.id],w=this._drapedRenderBatches.shift(),M=o.style.order,P=[];let z=0;for(const O of x){const B=_.getTileByID(O.proxyTileKey),V=_.proxyCachedFBO[O.key]?_.proxyCachedFBO[O.key][r]:void 0,G=V!==void 0?_.renderCache[V]:this.pool[z++],Q=V!==void 0;if(B.texture=G.tex,Q&&!G.dirty){P.push(B.tileID);continue}let W;p.bindFramebuffer.set(G.fb.framebuffer),this.renderedToTile=!1,G.dirty&&(p.clear({color:s.aj.transparent,stencil:0}),G.dirty=!1);for(let te=w.start;te<=w.end;++te){const ee=o.style._mergedLayers[M[te]];if(ee.isHidden(o.transform.zoom))continue;const le=o.style.getLayerSourceCache(ee),pe=le?this.proxyToSource[O.key][le.id]:[O];if(!pe)continue;const fe=pe;p.viewport.set([0,0,G.fb.width,G.fb.height]),W!==(le?le.id:null)&&(this._setupStencil(G,pe,ee,le),W=le?le.id:null),o.renderLayer(o,le,ee,fe)}if(this._drapedRenderBatches.length===0)for(const te of this._pendingGroundEffectLayers){const ee=o.style._mergedLayers[M[te]];if(ee.isHidden(o.transform.zoom))continue;const le=o.style.getLayerSourceCache(ee),pe=le?this.proxyToSource[O.key][le.id]:[O];if(!pe)continue;const fe=pe;p.viewport.set([0,0,G.fb.width,G.fb.height]),W!==(le?le.id:null)&&(this._setupStencil(G,pe,ee,le),W=le?le.id:null),o.renderLayer(o,le,ee,fe)}this.renderedToTile?(G.dirty=!0,P.push(B.tileID)):Q||--z,z===5&&(z=0,this.renderToBackBuffer(P))}return this.renderToBackBuffer(P),this.renderingToTexture=!1,p.bindFramebuffer.set(null),p.viewport.set([0,0,o.width,o.height]),w.end+1}postRender(){}isLayerOrderingCorrect(r){const o=r.order.length;let p=-1,_=o;for(let x=0;x<o;++x)this._style.isLayerDraped(r._mergedLayers[r.order[x]])?p=Math.max(p,x):_=Math.min(_,x);return _>p}getMinElevationBelowMSL(){let r=0;return this._visibleDemTiles.filter(o=>o.dem).forEach(o=>{r=Math.min(r,o.dem.tree.minimums[0])}),r===0?r:(r-30)*this._exaggeration}raycast(r,o,p){if(!this._visibleDemTiles)return null;const _=this._visibleDemTiles.filter(x=>x.dem).map(x=>{const w=x.tileID,M=1<<w.overscaledZ,{x:P,y:z}=w.canonical,O=P/M,B=(P+1)/M,V=z/M,G=(z+1)/M;return{minx:O,miny:V,maxx:B,maxy:G,t:x.dem.tree.raycastRoot(O,V,B,G,r,o,p),tile:x}});_.sort((x,w)=>(x.t!==null?x.t:Number.MAX_VALUE)-(w.t!==null?w.t:Number.MAX_VALUE));for(const x of _){if(x.t==null)return null;const w=x.tile.dem.tree.raycast(x.minx,x.miny,x.maxx,x.maxy,r,o,p);if(w!=null)return w}return null}_createFBO(){const r=this.painter.context,o=r.gl,p=this.drapeBufferSize;r.activeTexture.set(o.TEXTURE0);const _=new s.T(r,{width:p[0],height:p[1],data:null},o.RGBA8);_.bind(o.LINEAR,o.CLAMP_TO_EDGE);const x=r.createFramebuffer(p[0],p[1],!0,null);return x.colorAttachment.set(_.texture),x.depthAttachment=new V0(r,x.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=r.createRenderbuffer(r.gl.DEPTH_STENCIL,p[0],p[1]),this._stencilRef=0,x.depthAttachment.set(this._sharedDepthStencil),r.clear({stencil:0})):x.depthAttachment.set(this._sharedDepthStencil),r.extTextureFilterAnisotropic&&o.texParameterf(o.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax),{fb:x,tex:_,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const r in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[r].hasTransition())return!0;return this._style.order.some(r=>{const o=this._style._mergedLayers[r],p=o.isHidden(this.painter.transform.zoom);return o.type==="hillshade"||o.type==="custom"?!p&&o.shouldRedrape():!p&&o.hasTransition()})}_clearLineLayersFromRenderCache(){let r=!1;for(const p of this._style.getSources())if(p instanceof Un){r=!0;break}if(!r)return;const o={};for(let p=0;p<this._style.order.length;++p){const _=this._style._mergedLayers[this._style.order[p]],x=this._style.getLayerSourceCache(_);if(x&&!o[x.id]&&!_.isHidden(this.painter.transform.zoom)&&_.type==="line"&&_.widthExpression()instanceof s.a9){o[x.id]=!0;for(const w of this.proxyCoords){const M=this.proxyToSource[w.key][x.id];if(M)for(const P of M)this._clearRenderCacheForTile(x.id,P)}}}}_clearRasterLayersFromRenderCache(){let r=!1;for(const p in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[p]._source instanceof ma){r=!0;break}if(!r)return;const o={};for(let p=0;p<this._style.order.length;++p){const _=this._style._mergedLayers[this._style.order[p]],x=this._style.getLayerSourceCache(_);if(!x||o[x.id]||_.isHidden(this.painter.transform.zoom)||_.type!=="raster")continue;const w=_.paint.get("raster-fade-duration");for(const M of this.proxyCoords){const P=this.proxyToSource[M.key][x.id];if(P)for(const z of P){const O=bd(x.getTile(z),x.findLoadedParent(z,0),x,this.painter.transform,w);(O.opacity!==1||O.mix!==0)&&this._clearRenderCacheForTile(x.id,z)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const r=this._style.order,o=r.length;if(o===0)return;const p=[];this._pendingGroundEffectLayers=[];let _,x=0,w=this._style._mergedLayers[r[x]];for(;!this._style.isLayerDraped(w)&&w.isHidden(this.painter.transform.zoom)&&++x<o;)w=this._style._mergedLayers[r[x]];for(;x<o;++x){const M=this._style._mergedLayers[r[x]];M.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(M)?_===void 0&&(_=x):(M.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(x),_!==void 0&&(p.push({start:_,end:x-1}),_=void 0)))}if(_!==void 0&&p.push({start:_,end:x-1}),p.length!==0){const M=p[p.length-1];this._pendingGroundEffectLayers.every(P=>P>M.end)||s.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=p}_setupRenderCache(r){const o=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,o.renderCache.length>o.renderCachePool.length){const w=Object.values(o.proxyCachedFBO);o.proxyCachedFBO={};for(let M=0;M<w.length;++M){const P=Object.values(w[M]);o.renderCachePool.push(...P)}}return}this._clearRasterLayersFromRenderCache();const p=this.proxyCoords,_=this._tilesDirty;for(let w=p.length-1;w>=0;w--){const M=p[w];if(o.getTileByID(M.key),o.proxyCachedFBO[M.key]!==void 0){const P=r[M.key],z=this.proxyToSource[M.key];let O=0;for(const B in z){const V=z[B],G=P[B];if(!G||G.length!==V.length||V.some((Q,W)=>Q!==G[W]||_[B]&&_[B].hasOwnProperty(Q.key))){O=-1;break}++O}for(const B in o.proxyCachedFBO[M.key])o.renderCache[o.proxyCachedFBO[M.key][B]].dirty=O<0||O!==Object.values(P).length}}const x=[...this._drapedRenderBatches];x.sort((w,M)=>M.end-M.start-(w.end-w.start));for(const w of x)for(const M of p){if(o.proxyCachedFBO[M.key])continue;let P=o.renderCachePool.pop();P===void 0&&o.renderCache.length<50&&(P=o.renderCache.length,o.renderCache.push(this._createFBO())),P!==void 0&&(o.proxyCachedFBO[M.key]={},o.proxyCachedFBO[M.key][w.start]=P,o.renderCache[P].dirty=!0)}this._tilesDirty={}}_setupStencil(r,o,p,_){if(!_||!this._sourceTilesOverlap[_.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const x=this.painter.context,w=x.gl;if(o.length<=1)return void(this._overlapStencilType=!1);let M;if(p.isTileClipped())M=o.length,this._overlapStencilMode.test={func:w.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(o[0].overscaledZ>o[o.length-1].overscaledZ))return void(this._overlapStencilType=!1);M=1,this._overlapStencilMode.test={func:w.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+M>255&&(x.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=M,this._overlapStencilMode.ref=this._stencilRef,p.isTileClipped()&&this._renderTileClippingMasks(o,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(r){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[r.key]),this._overlapStencilMode):Kt.disabled}_renderTileClippingMasks(r,o){const p=this.painter,_=this.painter.context,x=_.gl;p._tileClippingMaskIDs={},_.setColorMode(ni.disabled),_.setDepthMode(Ht.disabled);const w=p.getOrCreateProgram("clippingMask");for(const M of r){const P=p._tileClippingMaskIDs[M.key]=--o;w.draw(p,x.TRIANGLES,Ht.disabled,new Kt({func:x.ALWAYS,mask:0},P,255,x.KEEP,x.KEEP,x.REPLACE),ni.disabled,li.disabled,Jf(M.projMatrix),"$clipping",p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}}pointCoordinate(r){const o=this.painter.transform;if(r.x<0||r.x>o.width||r.y<0||r.y>o.height)return null;const p=[r.x,r.y,1,1];s.ab.vec4.transformMat4(p,p,o.pixelMatrixInverse),s.ab.vec4.scale(p,p,1/p[3]),p[0]/=o.worldSize,p[1]/=o.worldSize;const _=o._camera.position,x=s.bH(1,o.center.lat),w=[_[0],_[1],_[2]/x,0],M=s.ab.vec3.subtract([],p.slice(0,3),w);s.ab.vec3.normalize(M,M);const P=this.raycast(w,M,this._exaggeration);return P!==null&&P?(s.ab.vec3.scaleAndAdd(w,w,M,P),w[3]=w[2],w[2]*=x,w):null}_setupProxiedCoordsForOrtho(r,o,p){if(r.getSource()instanceof s.aJ)return this._setupProxiedCoordsForImageSource(r,o,p);this._findCoveringTileCache[r.id]=this._findCoveringTileCache[r.id]||{};const _=this.proxiedCoords[r.id]=[],x=this.proxyCoords;for(let P=0;P<x.length;P++){const z=x[P],O=this._findTileCoveringTileID(z,r);if(O){const B=this._createProxiedId(z,O,p[z.key]&&p[z.key][r.id]);_.push(B),this.proxyToSource[z.key][r.id]=[B]}}let w=!1;const M=new Set;for(let P=0;P<o.length;P++){const z=r.getTile(o[P]);if(!z||!z.hasData())continue;const O=this._findTileCoveringTileID(z.tileID,this.proxySourceCache);if(O&&O.tileID.canonical.z!==z.tileID.canonical.z){const B=this.proxyToSource[O.tileID.key][r.id],V=this._createProxiedId(O.tileID,z,p[O.tileID.key]&&p[O.tileID.key][r.id]);B?B.splice(B.length-1,0,V):this.proxyToSource[O.tileID.key][r.id]=[V];const G=this.proxyToSource[O.tileID.key][r.id];M.has(G)||M.add(G),_.push(V),w=!0}}if(this._sourceTilesOverlap[r.id]=w,w&&this._debugParams.sortTilesHiZFirst)for(const P of M)P.sort((z,O)=>O.overscaledZ-z.overscaledZ)}_setupProxiedCoordsForImageSource(r,o,p){if(!r.getSource().loaded())return;const _=this.proxiedCoords[r.id]=[],x=this.proxyCoords,w=r.getSource(),M=w.tileID;if(!M)return;const P=new s.P(M.x,M.y)._div(1<<M.z),z=w.coordinates.map(s.aa.fromLngLat).reduce((B,V)=>(B.min.x=Math.min(B.min.x,V.x-P.x),B.min.y=Math.min(B.min.y,V.y-P.y),B.max.x=Math.max(B.max.x,V.x-P.x),B.max.y=Math.max(B.max.y,V.y-P.y),B),{min:new s.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),O=(B,V)=>{const G=B.wrap+B.canonical.x/(1<<B.canonical.z),Q=B.canonical.y/(1<<B.canonical.z),W=s.ag/(1<<B.canonical.z),te=V.wrap+V.canonical.x/(1<<V.canonical.z),ee=V.canonical.y/(1<<V.canonical.z);return G+W<te+z.min.x||G>te+z.max.x||Q+W<ee+z.min.y||Q>ee+z.max.y};for(let B=0;B<x.length;B++){const V=x[B];for(let G=0;G<o.length;G++){const Q=r.getTile(o[G]);if(!Q||!Q.hasData()||O(V,Q.tileID))continue;const W=this._createProxiedId(V,Q,p[V.key]&&p[V.key][r.id]),te=this.proxyToSource[V.key][r.id];te?te.push(W):this.proxyToSource[V.key][r.id]=[W],_.push(W)}}}_createProxiedId(r,o,p){let _=this.orthoMatrix;if(p){const x=p.find(w=>w.key===o.tileID.key);if(x)return x}if(o.tileID.key!==r.key){const x=r.canonical.z-o.tileID.canonical.z;let w,M,P;_=s.ab.mat4.create();const z=o.tileID.wrap-r.wrap<<r.overscaledZ;x>0?(w=s.ag>>x,M=w*((o.tileID.canonical.x<<x)-r.canonical.x+z),P=w*((o.tileID.canonical.y<<x)-r.canonical.y)):(w=s.ag<<-x,M=s.ag*(o.tileID.canonical.x-(r.canonical.x+z<<-x)),P=s.ag*(o.tileID.canonical.y-(r.canonical.y<<-x))),s.ab.mat4.ortho(_,0,w,0,w,0,1),s.ab.mat4.translate(_,_,[M,P,0])}return new Sg(o.tileID,r.key,_)}_findTileCoveringTileID(r,o){let p=o.getTile(r);if(p&&p.hasData())return p;const _=this._findCoveringTileCache[o.id],x=_[r.key];if(p=x?o.getTileByID(x):null,p&&p.hasData()||x===null)return p;let w=p?p.tileID:r,M=w.overscaledZ;const P=o.getSource().minzoom,z=[];if(!x){const B=o.getSource().maxzoom;if(r.canonical.z>=B){const V=r.canonical.z-B;o.getSource().reparseOverscaled?(M=Math.max(r.canonical.z+2,o.transform.tileZoom),w=new s.aG(M,r.wrap,B,r.canonical.x>>V,r.canonical.y>>V)):V!==0&&(M=B,w=new s.aG(M,r.wrap,B,r.canonical.x>>V,r.canonical.y>>V))}w.key!==r.key&&(z.push(w.key),p=o.getTile(w))}const O=B=>{z.forEach(V=>{_[V]=B}),z.length=0};for(M-=1;M>=P&&(!p||!p.hasData());M--){p&&O(p.tileID.key);const B=w.calculateScaledKey(M);if(p=o.getTileByID(B),p&&p.hasData())break;const V=_[B];if(V===null)break;V===void 0?z.push(B):p=o.getTileByID(V)}return O(p?p.tileID.key:null),p&&p.hasData()?p:null}findDEMTileFor(r){return this.enabled?this._findTileCoveringTileID(r,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(r,o){let p=this._tilesDirty[r];p||(p=this._tilesDirty[r]={}),p[o.key]=!0}}function nw(f,r,o){const p=function(M,P,z){const O=s.ab.vec3.dot(P,M),B=s.ab.vec3.dot(z,[.2126,.7152,.0722]),V=(Q,W,te)=>(1-te)*Q+te*W,G=V(1-.3*Math.min(B,1),1,Math.min(O+1,1));return V(.92,1,Math.asin(s.aw(P[2],-1,1))/Math.PI+.5)*G}(f,[0,0,1],r),_=[0,0,0];s.ab.vec3.scale(_,o.slice(0,3),p);const x=[0,0,0];s.ab.vec3.scale(x,r.slice(0,3),f[2]);const w=[0,0,0];return s.ab.vec3.add(w,_,x),s.cf(w)}const rw=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],j0=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","model","symbol"];class q0{static cacheKey(r,o,p,_){let x=`${o}${_?_.cacheKey:""}`;for(const w of p)r.usedDefines.includes(w)&&(x+=`/${w}`);return x}constructor(r,o,p,_,x,w){const M=r.gl;this.program=M.createProgram(),this.configuration=_,this.name=o,this.fixedDefines=[...w];const P=_?_.getBinderAttributes():[],z=(p.staticAttributes||[]).concat(P);let O=_?_.defines():[];O=O.concat(w.map(te=>`#define ${te}`));const B=`#version 300 es
`;let V=B+O.concat("precision mediump float;",_d,$f.fragmentSource).join(`
`);for(const te of p.fragmentIncludes)V+=`
${Pu[te]}`;V+=`
${p.fragmentSource}`;let G=B+O.concat("precision highp float;",_d,$f.vertexSource).join(`
`);for(const te of p.vertexIncludes)G+=`
${Pu[te]}`;this.forceManualRenderingForInstanceIDShaders=r.forceManualRenderingForInstanceIDShaders&&p.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(G+=`
uniform int u_instanceID;
`),G+=`
${p.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(G=G.replaceAll("gl_InstanceID","u_instanceID"));const Q=M.createShader(M.FRAGMENT_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);M.shaderSource(Q,V),M.compileShader(Q),M.attachShader(this.program,Q);const W=M.createShader(M.VERTEX_SHADER);if(M.isContextLost())this.failedToCreate=!0;else{M.shaderSource(W,G),M.compileShader(W),M.attachShader(this.program,W),this.attributes={},this.numAttributes=z.length;for(let te=0;te<this.numAttributes;te++)if(z[te]){const ee=z[te].startsWith("a_")?z[te]:`a_${z[te]}`;M.bindAttribLocation(this.program,te,ee),this.attributes[ee]=te}M.linkProgram(this.program),M.deleteShader(W),M.deleteShader(Q),this.fixedUniforms=x(r),this.binderUniforms=_?_.getUniforms(r):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(te=>({u_instanceID:new s.bN(te)}))(r)),(w.includes("TERRAIN")||o.indexOf("symbol")!==-1||o.indexOf("circle")!==-1)&&(this.terrainUniforms=(te=>({u_dem:new s.bN(te),u_dem_prev:new s.bN(te),u_dem_tl:new s.bK(te),u_dem_scale:new s.bM(te),u_dem_tl_prev:new s.bK(te),u_dem_scale_prev:new s.bM(te),u_dem_size:new s.bM(te),u_dem_lerp:new s.bM(te),u_exaggeration:new s.bM(te),u_depth:new s.bN(te),u_depth_size_inv:new s.bK(te),u_depth_range_unpack:new s.bK(te),u_occluder_half_size:new s.bM(te),u_occlusion_depth_offset:new s.bM(te),u_meter_to_dem:new s.bM(te),u_label_plane_matrix_inv:new s.bJ(te)}))(r)),w.includes("GLOBE")&&(this.globeUniforms=(te=>({u_tile_tl_up:new s.bL(te),u_tile_tr_up:new s.bL(te),u_tile_br_up:new s.bL(te),u_tile_bl_up:new s.bL(te),u_tile_up_scale:new s.bM(te)}))(r)),w.includes("FOG")&&(this.fogUniforms=(te=>({u_fog_matrix:new s.bJ(te),u_fog_range:new s.bK(te),u_fog_color:new s.ca(te),u_fog_horizon_blend:new s.bM(te),u_fog_vertical_limit:new s.bK(te),u_fog_temporal_offset:new s.bM(te),u_frustum_tl:new s.bL(te),u_frustum_tr:new s.bL(te),u_frustum_br:new s.bL(te),u_frustum_bl:new s.bL(te),u_globe_pos:new s.bL(te),u_globe_radius:new s.bM(te),u_globe_transition:new s.bM(te),u_is_globe:new s.bN(te),u_viewport:new s.bK(te)}))(r)),w.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(te=>({u_cutoff_params:new s.ca(te)}))(r)),w.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(te=>({u_lighting_ambient_color:new s.bL(te),u_lighting_directional_dir:new s.bL(te),u_lighting_directional_color:new s.bL(te),u_ground_radiance:new s.bL(te)}))(r)),w.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(te=>({u_light_matrix_0:new s.bJ(te),u_light_matrix_1:new s.bJ(te),u_fade_range:new s.bK(te),u_shadow_normal_offset:new s.bL(te),u_shadow_intensity:new s.bM(te),u_shadow_texel_size:new s.bM(te),u_shadow_map_resolution:new s.bM(te),u_shadow_direction:new s.bL(te),u_shadow_bias:new s.bL(te),u_shadowmap_0:new s.bN(te),u_shadowmap_1:new s.bN(te)}))(r))}}setTerrainUniformValues(r,o){if(!this.terrainUniforms)return;const p=this.terrainUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const _ in o)p[_]&&p[_].set(this.program,_,o[_])}}setGlobeUniformValues(r,o){if(!this.globeUniforms)return;const p=this.globeUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const _ in o)p[_]&&p[_].set(this.program,_,o[_])}}setFogUniformValues(r,o){if(!this.fogUniforms)return;const p=this.fogUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const _ in o)p[_].set(this.program,_,o[_])}}setCutoffUniformValues(r,o){if(!this.cutoffUniforms)return;const p=this.cutoffUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const _ in o)p[_].set(this.program,_,o[_])}}setLightsUniformValues(r,o){if(!this.lightsUniforms)return;const p=this.lightsUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const _ in o)p[_].set(this.program,_,o[_])}}setShadowUniformValues(r,o){if(this.failedToCreate||!this.shadowUniforms)return;const p=this.shadowUniforms;r.program.set(this.program);for(const _ in o)p[_].set(this.program,_,o[_])}_drawDebugWireframe(r,o,p,_,x,w,M,P,z,O){const B=r.options.wireframe;if(B.terrain===!1&&B.layers2D===!1&&B.layers3D===!1)return;const V=r.context;if(!(()=>!(!B.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!B.layers2D||r._terrain&&r._terrain.renderingToTexture||!rw.includes(this.name))||!(!B.layers3D||!j0.includes(this.name)))())return;const G=V.gl,Q=r.wireframeDebugCache.getLinesFromTrianglesBuffer(r.frameCounter,x,V);if(!Q)return;const W=[...this.fixedDefines];W.push("DEBUG_WIREFRAME");const te=r.getOrCreateProgram(this.name,{config:this.configuration,defines:W});V.program.set(te.program);const ee=(fe,Te,_e)=>{if(Te[fe]&&_e[fe])for(const xe in Te[fe])_e[fe][xe]&&_e[fe][xe].set(_e.program,xe,Te[fe][xe].current)};z&&z.setUniforms(te.program,V,te.binderUniforms,M,{zoom:P}),ee("fixedUniforms",this,te),ee("terrainUniforms",this,te),ee("globeUniforms",this,te),ee("fogUniforms",this,te),ee("lightsUniforms",this,te),ee("shadowUniforms",this,te),Q.bind(),V.setColorMode(new ni([G.ONE,G.ONE_MINUS_SRC_ALPHA,G.ZERO,G.ONE],s.aj.transparent,[!0,!0,!0,!1])),V.setDepthMode(new Ht(o.func===G.LESS?G.LEQUAL:o.func,Ht.ReadOnly,o.range)),V.setStencilMode(Kt.disabled);const le=3*w.primitiveLength*2,pe=3*w.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const fe=O||1;for(let Te=0;Te<fe;++Te)te.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Te),G.drawElements(G.LINES,le,G.UNSIGNED_SHORT,pe)}else O&&O>1?G.drawElementsInstanced(G.LINES,le,G.UNSIGNED_SHORT,pe,O):G.drawElements(G.LINES,le,G.UNSIGNED_SHORT,pe);x.bind(),V.program.set(this.program),V.setDepthMode(o),V.setStencilMode(p),V.setColorMode(_)}checkUniforms(r,o,p){if(this.fixedDefines.includes(o)){for(const _ of Object.keys(p))if(!p[_].initialized)throw new Error(`Program '${this.name}', from draw '${r}': uniform ${_} not set but required by ${o} being defined`)}}draw(r,o,p,_,x,w,M,P,z,O,B,V,G,Q,W,te){const ee=r.context,le=ee.gl;if(this.failedToCreate)return;ee.program.set(this.program),ee.setDepthMode(p),ee.setStencilMode(_),ee.setColorMode(x),ee.setCullFace(w);for(const Te of Object.keys(this.fixedUniforms))this.fixedUniforms[Te].set(this.program,Te,M[Te]);Q&&Q.setUniforms(this.program,ee,this.binderUniforms,V,{zoom:G});const pe={[le.POINTS]:1,[le.LINES]:2,[le.TRIANGLES]:3,[le.LINE_STRIP]:1}[o];this.checkUniforms(P,"RENDER_SHADOWS",this.shadowUniforms);const fe=te&&te>0?1:void 0;for(const Te of B.get()){const _e=Te.vaos||(Te.vaos={});if((_e[P]||(_e[P]=new D0)).bind(ee,this,z,Q?Q.getPaintVertexBuffers():[],O,Te.vertexOffset,W||[],fe),this.forceManualRenderingForInstanceIDShaders){const xe=te||1;for(let ge=0;ge<xe;++ge)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",ge),O?le.drawElements(o,Te.primitiveLength*pe,le.UNSIGNED_SHORT,Te.primitiveOffset*pe*2):le.drawArrays(o,Te.vertexOffset,Te.vertexLength)}else te&&te>1?le.drawElementsInstanced(o,Te.primitiveLength*pe,le.UNSIGNED_SHORT,Te.primitiveOffset*pe*2,te):O?le.drawElements(o,Te.primitiveLength*pe,le.UNSIGNED_SHORT,Te.primitiveOffset*pe*2):le.drawArrays(o,Te.vertexOffset,Te.vertexLength);o===le.TRIANGLES&&O&&this._drawDebugWireframe(r,p,_,x,O,Te,V,G,Q,te)}}}function ep(f,r){const o=Math.pow(2,r.tileID.overscaledZ),p=r.tileSize*Math.pow(2,f.transform.tileZoom)/o,_=p*(r.tileID.canonical.x+r.tileID.wrap*o),x=p*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture?r.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/s.ar(r,1,f.transform.tileZoom),u_pixel_coord_upper:[_>>16,x>>16],u_pixel_coord_lower:[65535&_,65535&x]}}const Fu={terrain:0,flat:1},Bu=s.ab.mat4.create(),tp=(f,r,o,p,_,x,w,M,P,z,O,B,V,G,Q,W,te,ee)=>{const le=r.style.light,pe=le.properties.get("position"),fe=[pe.x,pe.y,pe.z],Te=s.ab.mat3.create();le.properties.get("anchor")==="viewport"&&(s.ab.mat3.fromRotation(Te,-r.transform.angle),s.ab.vec3.transformMat3(fe,fe,Te));const _e=le.properties.get("color"),xe=r.transform,ge={u_matrix:f,u_lightpos:fe,u_lightintensity:le.properties.get("intensity"),u_lightcolor:[_e.r,_e.g,_e.b],u_vertical_gradient:+o,u_opacity:p,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Bu,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Fu[z],u_base_type:Fu[O],u_ao:_,u_edge_radius:x,u_width_scale:w,u_flood_light_color:Q,u_vertical_scale:W,u_flood_light_intensity:te,u_ground_shadow_factor:ee};return xe.projection.name==="globe"&&(ge.u_tile_id=[M.canonical.x,M.canonical.y,1<<M.canonical.z],ge.u_zoom_transition=B,ge.u_inv_rot_matrix=G,ge.u_merc_center=V,ge.u_up_dir=xe.projection.upVector(new s.bT(0,0,0),V[0]*s.ag,V[1]*s.ag),ge.u_height_lift=P),ge},wd=(f,r,o,p,_,x)=>({u_matrix:f,u_edge_radius:r,u_width_scale:o,u_vertical_scale:p,u_height_type:Fu[_],u_base_type:Fu[x]}),G0=(f,r,o,p,_,x,w,M,P,z,O,B,V,G,Q,W,te)=>{const ee=tp(f,r,o,p,_,x,w,M,z,O,B,V,G,Q,W,te,1,[0,0,0]),le={u_height_factor:-Math.pow(2,M.overscaledZ)/P.tileSize/8};return s.l(ee,ep(r,P),le)},Td=(f,r)=>({u_matrix:f,u_emissive_strength:r}),Ed=(f,r,o,p)=>s.l(Td(f,r),ep(o,p)),Ag=(f,r,o)=>({u_matrix:f,u_world:o,u_emissive_strength:r}),H0=(f,r,o,p,_)=>s.l(Ed(f,r,o,p),{u_world:_}),sw=(f,r,o,p)=>{const _=s.ag/o.tileSize;return{u_matrix:f,u_camera_to_center_distance:r.getCameraToCenterDistance(p),u_extrude_scale:[r.pixelsToGLUnits[0]/_,r.pixelsToGLUnits[1]/_]}},zc=(f,r,o=1)=>({u_matrix:f,u_color:r.toRenderColor(null),u_overlay:0,u_overlay_scale:o}),ip=s.ab.mat4.create(),Gt=(f,r,o,p,_,x,w)=>{const M=f.transform,P=M.projection.name==="globe",z=P?s.cN(M.zoom,r.canonical)*M._pixelsPerMercatorPixel:s.ar(o,1,x),O={u_matrix:r.projMatrix,u_extrude_scale:z,u_intensity:w,u_inv_rot_matrix:ip,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(P){O.u_inv_rot_matrix=p,O.u_merc_center=_,O.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],O.u_zoom_transition=s.ae(M.zoom);const B=_[0]*s.ag,V=_[1]*s.ag;O.u_up_dir=M.projection.upVector(new s.bT(0,0,0),B,V)}return O};function Ig(f,[r,o,p,_],[x,w]){if(x===w)return[0,0,0,0];const M=255*(f-1)/(f*(w-x));return[r*M,o*M,p*M,_*M]}function Mg(f,r,[o,p]){return o===p?0:.5/f+(r-o)*(f-1)/(f*(p-o))}const Gl=(f,r,o,p,_,x,w,M,P,z,O,B,V,G,Q,W,te,ee,le,pe,fe)=>({u_matrix:f,u_normalize_matrix:r,u_globe_matrix:o,u_merc_matrix:p,u_grid_matrix:_,u_tl_parent:x,u_scale_parent:z,u_fade_t:O.mix,u_opacity:O.opacity*B.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:B.paint.get("raster-brightness-min"),u_brightness_high:B.paint.get("raster-brightness-max"),u_saturation_factor:s.cO(B.paint.get("raster-saturation")),u_contrast_factor:s.cP(B.paint.get("raster-contrast")),u_spin_weights:Oc(B.paint.get("raster-hue-rotate")),u_perspective_transform:V,u_raster_elevation:G,u_zoom_transition:w,u_merc_center:M,u_cutoff_params:P,u_colorization_mix:Ig(s.cQ,W,ee),u_colorization_offset:Mg(s.cQ,te,ee),u_color_ramp:Q,u_texture_offset:[pe/(le+2*pe),le/(le+2*pe)],u_texture_res:[le+2*pe,le+2*pe],u_emissive_strength:fe});function Oc(f){f*=Math.PI/180;const r=Math.sin(f),o=Math.cos(f);return[(2*o+1)/3,(-Math.sqrt(3)*r-o+1)/3,(Math.sqrt(3)*r-o+1)/3]}const Wt=.05,Cg=(f,r,o,p,_,x,w,M,P,z,O,B)=>({u_matrix:f,u_normalize_matrix:r,u_globe_matrix:o,u_merc_matrix:p,u_grid_matrix:_,u_tl_parent:x,u_scale_parent:z,u_fade_t:O.mix,u_opacity:O.opacity,u_image0:0,u_image1:1,u_raster_elevation:B,u_zoom_transition:w,u_merc_center:M,u_cutoff_params:P}),aw=(f,r,o,p,_,x,w,M,P,z)=>({u_particle_texture:f,u_particle_texture_side_len:r,u_tile_offset:o,u_velocity:p,u_color_ramp:x,u_velocity_res:_,u_max_speed:w,u_uv_offset:M,u_data_scale:[255*P[0],255*P[1]],u_data_offset:z,u_particle_pos_scale:1.1,u_particle_pos_offset:[Wt,Wt]}),ow=(f,r,o,p,_,x,w,M,P,z)=>({u_particle_texture:f,u_particle_texture_side_len:r,u_velocity:o,u_velocity_res:p,u_max_speed:_,u_speed_factor:x,u_reset_rate:w,u_rand_seed:Math.random(),u_uv_offset:M,u_data_scale:[255*P[0],255*P[1]],u_data_offset:z,u_particle_pos_scale:1.1,u_particle_pos_offset:[Wt,Wt]}),np=s.ab.mat4.create(),Rg=(f,r,o,p,_,x,w,M,P,z,O,B,V,G,Q,W,te,ee,le,pe,fe,Te)=>{const _e=_.transform,xe={u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:_e.getCameraToCenterDistance(le),u_rotate_symbol:+o,u_aspect_ratio:_e.width/_e.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:x,u_label_plane_matrix:w,u_coord_matrix:M,u_is_text:+z,u_elevation_from_sea:P?1:0,u_pitch_with_map:+p,u_texsize:O,u_texsize_icon:B,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:np,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:np,u_up_vector:[0,-1,0],u_color_adj_mat:pe,u_icon_transition:fe||0,u_gamma_scale:p?_.transform.getCameraToCenterDistance(le)*Math.cos(_.terrain?0:_.transform._pitch):1,u_device_pixel_ratio:s.q.devicePixelRatio,u_is_halo:+V,u_scale_factor:Te||1};return le.name==="globe"&&(xe.u_tile_id=[G.canonical.x,G.canonical.y,1<<G.canonical.z],xe.u_zoom_transition=Q,xe.u_inv_rot_matrix=te,xe.u_merc_center=W,xe.u_camera_forward=_e._camera.forward(),xe.u_ecef_origin=s.cR(_e.globeMatrix,G.toUnwrapped()),xe.u_tile_matrix=Float32Array.from(_e.globeMatrix),xe.u_up_vector=ee),xe},Dg=(f,r,o,p)=>({u_matrix:f,u_emissive_strength:r,u_opacity:o,u_color:p}),$0=(f,r,o,p,_,x,w,M,P)=>s.l(function(z,O,B,V,G,Q){const{width:W,height:te}=V.imageManager.getPixelSize(O),ee=Math.pow(2,Q.tileID.overscaledZ),le=Q.tileSize*Math.pow(2,V.transform.tileZoom)/ee,pe=le*(Q.tileID.canonical.x+Q.tileID.wrap*ee),fe=le*Q.tileID.canonical.y;return{u_image:0,u_pattern_tl:B.tl,u_pattern_br:B.br,u_texsize:[W,te],u_pattern_size:B.displaySize,u_pattern_units_to_pixels:G?[V.transform.width,-1*V.transform.height]:[1/s.ar(Q,1,V.transform.tileZoom),1/s.ar(Q,1,V.transform.tileZoom)],u_pixel_coord_upper:[pe>>16,fe>>16],u_pixel_coord_lower:[65535&pe,65535&fe]}}(0,x,w,p,M,P),{u_matrix:f,u_emissive_strength:r,u_opacity:o}),Pg=new Float32Array(s.ab.mat4.identity([])),Sd=(f,r,o,p,_,x,w,M,P,z,O,B,V,G=[0,0,0],Q)=>{const W=_.style.light,te=W.properties.get("position"),ee=[-te.x,-te.y,te.z],le=s.ab.mat3.create();W.properties.get("anchor")==="viewport"&&(s.ab.mat3.fromRotation(le,-_.transform.angle),s.ab.vec3.transformMat3(ee,ee,le));const pe=O.alphaMode==="MASK",fe=W.properties.get("color").toRenderColor(null),Te=V.paint.get("model-ambient-occlusion-intensity"),_e=V.paint.get("model-color").constantOr(s.aj.white).toRenderColor(null),xe=V.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:f,u_lighting_matrix:r,u_normal_matrix:o,u_node_matrix:p||Pg,u_lightpos:ee,u_lightintensity:W.properties.get("intensity"),u_lightcolor:[fe.r,fe.g,fe.b],u_camera_pos:G,u_opacity:x,u_baseTextureIsAlpha:0,u_alphaMask:+pe,u_alphaCutoff:O.alphaCutoff,u_baseColorFactor:[w.r,w.g,w.b,w.a],u_emissiveFactor:[M[0],M[1],M[2],1],u_metallicFactor:P,u_roughnessFactor:z,u_baseColorTexture:Yr.BaseColor,u_metallicRoughnessTexture:Yr.MetallicRoughness,u_normalTexture:Yr.Normal,u_occlusionTexture:Yr.Occlusion,u_emissionTexture:Yr.Emission,u_lutTexture:Yr.LUT,u_color_mix:[_e.r,_e.g,_e.b,xe],u_aoIntensity:Te,u_emissive_strength:B,u_occlusionTextureTransform:Q||[0,0,0,0]}},rp=(f,r=Pg,o=Pg)=>({u_matrix:f,u_instance:r,u_node_matrix:o}),Lg={fillExtrusion:f=>({u_matrix:new s.bJ(f),u_lightpos:new s.bL(f),u_lightintensity:new s.bM(f),u_lightcolor:new s.bL(f),u_vertical_gradient:new s.bM(f),u_opacity:new s.bM(f),u_edge_radius:new s.bM(f),u_width_scale:new s.bM(f),u_ao:new s.bK(f),u_height_type:new s.bN(f),u_base_type:new s.bN(f),u_tile_id:new s.bL(f),u_zoom_transition:new s.bM(f),u_inv_rot_matrix:new s.bJ(f),u_merc_center:new s.bK(f),u_up_dir:new s.bL(f),u_height_lift:new s.bM(f),u_flood_light_color:new s.bL(f),u_vertical_scale:new s.bM(f),u_flood_light_intensity:new s.bM(f),u_ground_shadow_factor:new s.bL(f)}),fillExtrusionDepth:f=>({u_matrix:new s.bJ(f),u_edge_radius:new s.bM(f),u_width_scale:new s.bM(f),u_vertical_scale:new s.bM(f),u_height_type:new s.bN(f),u_base_type:new s.bN(f)}),fillExtrusionPattern:f=>({u_matrix:new s.bJ(f),u_lightpos:new s.bL(f),u_lightintensity:new s.bM(f),u_lightcolor:new s.bL(f),u_vertical_gradient:new s.bM(f),u_height_factor:new s.bM(f),u_edge_radius:new s.bM(f),u_width_scale:new s.bM(f),u_ao:new s.bK(f),u_height_type:new s.bN(f),u_base_type:new s.bN(f),u_tile_id:new s.bL(f),u_zoom_transition:new s.bM(f),u_inv_rot_matrix:new s.bJ(f),u_merc_center:new s.bK(f),u_up_dir:new s.bL(f),u_height_lift:new s.bM(f),u_image:new s.bN(f),u_texsize:new s.bK(f),u_pixel_coord_upper:new s.bK(f),u_pixel_coord_lower:new s.bK(f),u_tile_units_to_pixels:new s.bM(f),u_opacity:new s.bM(f)}),fillExtrusionGroundEffect:f=>({u_matrix:new s.bJ(f),u_opacity:new s.bM(f),u_ao_pass:new s.bM(f),u_meter_to_tile:new s.bM(f),u_ao:new s.bK(f),u_flood_light_intensity:new s.bM(f),u_flood_light_color:new s.bL(f),u_attenuation:new s.bM(f),u_edge_radius:new s.bM(f),u_fb:new s.bN(f),u_fb_size:new s.bM(f),u_dynamic_offset:new s.bM(f)}),fill:f=>({u_matrix:new s.bJ(f),u_emissive_strength:new s.bM(f)}),fillPattern:f=>({u_matrix:new s.bJ(f),u_emissive_strength:new s.bM(f),u_image:new s.bN(f),u_texsize:new s.bK(f),u_pixel_coord_upper:new s.bK(f),u_pixel_coord_lower:new s.bK(f),u_tile_units_to_pixels:new s.bM(f)}),fillOutline:f=>({u_matrix:new s.bJ(f),u_emissive_strength:new s.bM(f),u_world:new s.bK(f)}),fillOutlinePattern:f=>({u_matrix:new s.bJ(f),u_emissive_strength:new s.bM(f),u_world:new s.bK(f),u_image:new s.bN(f),u_texsize:new s.bK(f),u_pixel_coord_upper:new s.bK(f),u_pixel_coord_lower:new s.bK(f),u_tile_units_to_pixels:new s.bM(f)}),circle:s.cS,collisionBox:f=>({u_matrix:new s.bJ(f),u_camera_to_center_distance:new s.bM(f),u_extrude_scale:new s.bK(f)}),collisionCircle:f=>({u_matrix:new s.bJ(f),u_inv_matrix:new s.bJ(f),u_camera_to_center_distance:new s.bM(f),u_viewport_size:new s.bK(f)}),debug:f=>({u_color:new s.cz(f),u_matrix:new s.bJ(f),u_overlay:new s.bN(f),u_overlay_scale:new s.bM(f)}),clippingMask:f=>({u_matrix:new s.bJ(f)}),heatmap:f=>({u_extrude_scale:new s.bM(f),u_intensity:new s.bM(f),u_matrix:new s.bJ(f),u_inv_rot_matrix:new s.bJ(f),u_merc_center:new s.bK(f),u_tile_id:new s.bL(f),u_zoom_transition:new s.bM(f),u_up_dir:new s.bL(f)}),heatmapTexture:f=>({u_image:new s.bN(f),u_color_ramp:new s.bN(f),u_opacity:new s.bM(f)}),hillshade:f=>({u_matrix:new s.bJ(f),u_image:new s.bN(f),u_latrange:new s.bK(f),u_light:new s.bK(f),u_shadow:new s.cz(f),u_highlight:new s.cz(f),u_emissive_strength:new s.bM(f),u_accent:new s.cz(f)}),hillshadePrepare:f=>({u_matrix:new s.bJ(f),u_image:new s.bN(f),u_dimension:new s.bK(f),u_zoom:new s.bM(f)}),line:s.cT,linePattern:s.cU,raster:f=>({u_matrix:new s.bJ(f),u_normalize_matrix:new s.bJ(f),u_globe_matrix:new s.bJ(f),u_merc_matrix:new s.bJ(f),u_grid_matrix:new s.cA(f),u_tl_parent:new s.bK(f),u_scale_parent:new s.bM(f),u_fade_t:new s.bM(f),u_opacity:new s.bM(f),u_image0:new s.bN(f),u_image1:new s.bN(f),u_brightness_low:new s.bM(f),u_brightness_high:new s.bM(f),u_saturation_factor:new s.bM(f),u_contrast_factor:new s.bM(f),u_spin_weights:new s.bL(f),u_perspective_transform:new s.bK(f),u_raster_elevation:new s.bM(f),u_zoom_transition:new s.bM(f),u_merc_center:new s.bK(f),u_cutoff_params:new s.ca(f),u_colorization_mix:new s.ca(f),u_colorization_offset:new s.bM(f),u_color_ramp:new s.bN(f),u_texture_offset:new s.bK(f),u_texture_res:new s.bK(f),u_emissive_strength:new s.bM(f)}),rasterParticle:f=>({u_matrix:new s.bJ(f),u_normalize_matrix:new s.bJ(f),u_globe_matrix:new s.bJ(f),u_merc_matrix:new s.bJ(f),u_grid_matrix:new s.cA(f),u_tl_parent:new s.bK(f),u_scale_parent:new s.bM(f),u_fade_t:new s.bM(f),u_opacity:new s.bM(f),u_image0:new s.bN(f),u_image1:new s.bN(f),u_raster_elevation:new s.bM(f),u_zoom_transition:new s.bM(f),u_merc_center:new s.bK(f),u_cutoff_params:new s.ca(f)}),rasterParticleTexture:f=>({u_texture:new s.bN(f),u_opacity:new s.bM(f)}),rasterParticleDraw:f=>({u_particle_texture:new s.bN(f),u_particle_texture_side_len:new s.bM(f),u_tile_offset:new s.bK(f),u_velocity:new s.bN(f),u_color_ramp:new s.bN(f),u_velocity_res:new s.bK(f),u_max_speed:new s.bM(f),u_uv_offset:new s.bK(f),u_data_scale:new s.bK(f),u_data_offset:new s.bM(f),u_particle_pos_scale:new s.bM(f),u_particle_pos_offset:new s.bK(f)}),rasterParticleUpdate:f=>({u_particle_texture:new s.bN(f),u_particle_texture_side_len:new s.bM(f),u_velocity:new s.bN(f),u_velocity_res:new s.bK(f),u_max_speed:new s.bM(f),u_speed_factor:new s.bM(f),u_reset_rate:new s.bM(f),u_rand_seed:new s.bM(f),u_uv_offset:new s.bK(f),u_data_scale:new s.bK(f),u_data_offset:new s.bM(f),u_particle_pos_scale:new s.bM(f),u_particle_pos_offset:new s.bK(f)}),symbol:f=>({u_is_size_zoom_constant:new s.bN(f),u_is_size_feature_constant:new s.bN(f),u_size_t:new s.bM(f),u_size:new s.bM(f),u_camera_to_center_distance:new s.bM(f),u_rotate_symbol:new s.bN(f),u_aspect_ratio:new s.bM(f),u_fade_change:new s.bM(f),u_matrix:new s.bJ(f),u_label_plane_matrix:new s.bJ(f),u_coord_matrix:new s.bJ(f),u_is_text:new s.bN(f),u_elevation_from_sea:new s.bN(f),u_pitch_with_map:new s.bN(f),u_texsize:new s.bK(f),u_texsize_icon:new s.bK(f),u_texture:new s.bN(f),u_texture_icon:new s.bN(f),u_gamma_scale:new s.bM(f),u_device_pixel_ratio:new s.bM(f),u_tile_id:new s.bL(f),u_zoom_transition:new s.bM(f),u_inv_rot_matrix:new s.bJ(f),u_merc_center:new s.bK(f),u_camera_forward:new s.bL(f),u_tile_matrix:new s.bJ(f),u_up_vector:new s.bL(f),u_ecef_origin:new s.bL(f),u_is_halo:new s.bN(f),u_icon_transition:new s.bM(f),u_color_adj_mat:new s.bJ(f),u_scale_factor:new s.bM(f)}),background:f=>({u_matrix:new s.bJ(f),u_emissive_strength:new s.bM(f),u_opacity:new s.bM(f),u_color:new s.cz(f)}),backgroundPattern:f=>({u_matrix:new s.bJ(f),u_emissive_strength:new s.bM(f),u_opacity:new s.bM(f),u_image:new s.bN(f),u_pattern_tl:new s.bK(f),u_pattern_br:new s.bK(f),u_texsize:new s.bK(f),u_pattern_size:new s.bK(f),u_pixel_coord_upper:new s.bK(f),u_pixel_coord_lower:new s.bK(f),u_pattern_units_to_pixels:new s.bK(f)}),terrainRaster:f=>({u_matrix:new s.bJ(f),u_image0:new s.bN(f),u_skirt_height:new s.bM(f),u_ground_shadow_factor:new s.bL(f)}),skybox:f=>({u_matrix:new s.bJ(f),u_sun_direction:new s.bL(f),u_cubemap:new s.bN(f),u_opacity:new s.bM(f),u_temporal_offset:new s.bM(f)}),skyboxGradient:f=>({u_matrix:new s.bJ(f),u_color_ramp:new s.bN(f),u_center_direction:new s.bL(f),u_radius:new s.bM(f),u_opacity:new s.bM(f),u_temporal_offset:new s.bM(f)}),skyboxCapture:f=>({u_matrix_3f:new s.cA(f),u_sun_direction:new s.bL(f),u_sun_intensity:new s.bM(f),u_color_tint_r:new s.ca(f),u_color_tint_m:new s.ca(f),u_luminance:new s.bM(f)}),globeRaster:f=>({u_proj_matrix:new s.bJ(f),u_globe_matrix:new s.bJ(f),u_normalize_matrix:new s.bJ(f),u_merc_matrix:new s.bJ(f),u_zoom_transition:new s.bM(f),u_merc_center:new s.bK(f),u_image0:new s.bN(f),u_grid_matrix:new s.cA(f),u_skirt_height:new s.bM(f),u_far_z_cutoff:new s.bM(f),u_frustum_tl:new s.bL(f),u_frustum_tr:new s.bL(f),u_frustum_br:new s.bL(f),u_frustum_bl:new s.bL(f),u_globe_pos:new s.bL(f),u_globe_radius:new s.bM(f),u_viewport:new s.bK(f)}),globeAtmosphere:f=>({u_frustum_tl:new s.bL(f),u_frustum_tr:new s.bL(f),u_frustum_br:new s.bL(f),u_frustum_bl:new s.bL(f),u_horizon:new s.bM(f),u_transition:new s.bM(f),u_fadeout_range:new s.bM(f),u_color:new s.ca(f),u_high_color:new s.ca(f),u_space_color:new s.ca(f),u_temporal_offset:new s.bM(f),u_horizon_angle:new s.bM(f)}),model:f=>({u_matrix:new s.bJ(f),u_lighting_matrix:new s.bJ(f),u_normal_matrix:new s.bJ(f),u_node_matrix:new s.bJ(f),u_lightpos:new s.bL(f),u_lightintensity:new s.bM(f),u_lightcolor:new s.bL(f),u_camera_pos:new s.bL(f),u_opacity:new s.bM(f),u_baseColorFactor:new s.ca(f),u_emissiveFactor:new s.ca(f),u_metallicFactor:new s.bM(f),u_roughnessFactor:new s.bM(f),u_baseTextureIsAlpha:new s.bN(f),u_alphaMask:new s.bN(f),u_alphaCutoff:new s.bM(f),u_baseColorTexture:new s.bN(f),u_metallicRoughnessTexture:new s.bN(f),u_normalTexture:new s.bN(f),u_occlusionTexture:new s.bN(f),u_emissionTexture:new s.bN(f),u_lutTexture:new s.bN(f),u_color_mix:new s.ca(f),u_aoIntensity:new s.bM(f),u_emissive_strength:new s.bM(f),u_occlusionTextureTransform:new s.ca(f)}),modelDepth:f=>({u_matrix:new s.bJ(f),u_instance:new s.bJ(f),u_node_matrix:new s.bJ(f)}),groundShadow:f=>({u_matrix:new s.bJ(f),u_ground_shadow_factor:new s.bL(f)}),stars:f=>({u_matrix:new s.bJ(f),u_up:new s.bL(f),u_right:new s.bL(f),u_intensity_multiplier:new s.bM(f)}),snowParticle:f=>({u_modelview:new s.bJ(f),u_projection:new s.bJ(f),u_time:new s.bM(f),u_cam_pos:new s.bL(f),u_velocityConeAperture:new s.bM(f),u_velocity:new s.bM(f),u_horizontalOscillationRadius:new s.bM(f),u_horizontalOscillationRate:new s.bM(f),u_boxSize:new s.bM(f),u_billboardSize:new s.bM(f),u_simpleShapeParameters:new s.bK(f),u_screenSize:new s.bK(f),u_thinningCenterPos:new s.bK(f),u_thinningShape:new s.bL(f),u_thinningAffectedRatio:new s.bM(f),u_thinningParticleOffset:new s.bM(f),u_particleColor:new s.ca(f),u_direction:new s.bL(f)}),rainParticle:f=>({u_modelview:new s.bJ(f),u_projection:new s.bJ(f),u_time:new s.bM(f),u_cam_pos:new s.bL(f),u_texScreen:new s.bN(f),u_velocityConeAperture:new s.bM(f),u_velocity:new s.bM(f),u_boxSize:new s.bM(f),u_rainDropletSize:new s.bK(f),u_distortionStrength:new s.bM(f),u_rainDirection:new s.bL(f),u_color:new s.ca(f),u_screenSize:new s.bK(f),u_thinningCenterPos:new s.bK(f),u_thinningShape:new s.bL(f),u_thinningAffectedRatio:new s.bM(f),u_thinningParticleOffset:new s.bM(f),u_shapeDirectionalPower:new s.bM(f),u_shapeNormalPower:new s.bM(f),u_mode:new s.bM(f)}),vignette:f=>({u_vignetteShape:new s.bL(f),u_vignetteColor:new s.ca(f)}),occlusion:f=>({u_matrix:new s.bJ(f),u_anchorPos:new s.bL(f),u_screenSizePx:new s.bK(f),u_occluderSizePx:new s.bK(f),u_color:new s.ca(f)})};class To{constructor(r,o,p,_){this.id=To.uniqueIdxCounter,To.uniqueIdxCounter++,this.context=r;const x=r.gl;this.buffer=x.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||_||o.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){this.id=To.uniqueIdxCounter,To.uniqueIdxCounter++;const o=this.context.gl;this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}To.uniqueIdxCounter=0;const ia={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Hl{constructor(r,o,p,_,x,w){this.length=o.length,this.attributes=p,this.itemSize=o.bytesPerElement,this.dynamicDraw=_,this.instanceCount=w,this.context=r;const M=r.gl;this.buffer=M.createBuffer(),r.bindVertexBuffer.set(this.buffer),M.bufferData(M.ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?M.DYNAMIC_DRAW:M.STATIC_DRAW),this.dynamicDraw||x||o.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){const o=this.context.gl;this.bind(),o.bufferSubData(o.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,o){for(let p=0;p<this.attributes.length;p++){const _=o.attributes[this.attributes[p].name];_!==void 0&&r.enableVertexAttribArray(_)}}setVertexAttribPointers(r,o,p){for(let _=0;_<this.attributes.length;_++){const x=this.attributes[_],w=o.attributes[x.name];w!==void 0&&r.vertexAttribPointer(w,x.components,r[ia[x.type]],!1,this.itemSize,x.offset+this.itemSize*(p||0))}}setVertexAttribDivisor(r,o,p){for(let _=0;_<this.attributes.length;_++){const x=o.attributes[this.attributes[_].name];x!==void 0&&this.instanceCount&&this.instanceCount>0&&r.vertexAttribDivisor(x,p)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class zg{constructor(r,o,p,_,x){this.context=r,this.width=o,this.height=p;const w=this.framebuffer=r.gl.createFramebuffer();_&&(this.colorAttachment=new ku(r,w)),x&&(this.depthAttachmentType=x,this.depthAttachment=x==="renderbuffer"?new bg(r,w):new B0(r,w))}destroy(){const r=this.context.gl;if(this.colorAttachment){const o=this.colorAttachment.get();o&&r.deleteTexture(o)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const o=this.depthAttachment.get();o&&r.deleteRenderbuffer(o)}else{const o=this.depthAttachment.get();o&&r.deleteTexture(o)}r.deleteFramebuffer(this.framebuffer)}}class Og{constructor(r,o){this.gl=r,this.clearColor=new ug(this),this.clearDepth=new hg(this),this.clearStencil=new dg(this),this.colorMask=new fg(this),this.depthMask=new z0(this),this.stencilMask=new O0(this),this.stencilFunc=new Xb(this),this.stencilOp=new yd(this),this.stencilTest=new vd(this),this.depthRange=new k0(this),this.depthTest=new ta(this),this.depthFunc=new pg(this),this.blend=new Zf(this),this.blendFunc=new Wf(this),this.blendColor=new mg(this),this.blendEquation=new gg(this),this.cullFace=new Xf(this),this.cullFaceSide=new _g(this),this.frontFace=new yg(this),this.program=new Yf(this),this.activeTexture=new N0(this),this.viewport=new F0(this),this.bindFramebuffer=new Ou(this),this.bindRenderbuffer=new Yb(this),this.bindTexture=new Kb(this),this.bindVertexBuffer=new Qb(this),this.bindElementBuffer=new Jb(this),this.bindVertexArrayOES=new ew(this),this.pixelStoreUnpack=new tw(this),this.pixelStoreUnpackPremultiplyAlpha=new vg(this),this.pixelStoreUnpackFlipY=new xg(this),this.options=o?Object.assign({},o):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=r.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=r.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=r.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=o&&!!o.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=r.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=r.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=r.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),this.maxPointSize=r.getParameter(r.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,o,p){return new To(this,r,o,p)}createVertexBuffer(r,o,p,_,x){return new Hl(this,r,o,p,_,x)}createRenderbuffer(r,o,p){const _=this.gl,x=_.createRenderbuffer();return this.bindRenderbuffer.set(x),_.renderbufferStorage(_.RENDERBUFFER,r,o,p),this.bindRenderbuffer.set(null),x}createFramebuffer(r,o,p,_){return new zg(this,r,o,p,_)}clear({color:r,depth:o,stencil:p,colorMask:_}){const x=this.gl;let w=0;r&&(w|=x.COLOR_BUFFER_BIT,this.clearColor.set(r),this.colorMask.set(_||[!0,!0,!0,!0])),o!==void 0&&(w|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),p!==void 0&&(w|=x.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),x.clear(w)}setCullFace(r){r.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){s.bn(r.blendFunction,ni.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor),r.blendEquation?this.blendEquation.set(r.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(r.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Vu;function sp(f,r,o,p,_,x,w){const M=f.context,P=M.gl,z=f.transform,O=f.getOrCreateProgram("collisionBox"),B=[];let V=0,G=0;for(let fe=0;fe<p.length;fe++){const Te=p[fe],_e=r.getTile(Te),xe=_e.getBucket(o);if(!xe)continue;const ge=bs(Te,xe,z);let Re=ge;_[0]===0&&_[1]===0||(Re=f.translatePosMatrix(ge,_e,_,x));const Fe=w?xe.textCollisionBox:xe.iconCollisionBox,rt=xe.collisionCircleArray;if(rt.length>0){const Ke=s.ab.mat4.create(),ht=Re;s.ab.mat4.mul(Ke,xe.placementInvProjMatrix,z.glCoordMatrix),s.ab.mat4.mul(Ke,Ke,xe.placementViewportMatrix),B.push({circleArray:rt,circleOffset:G,transform:ht,invTransform:Ke,projection:xe.getProjection()}),V+=rt.length/4,G=V}Fe&&(f.terrain&&f.terrain.setupElevationDraw(_e,O),O.draw(f,P.LINES,Ht.disabled,Kt.disabled,f.colorModeForRenderPass(),li.disabled,sw(Re,z,_e,xe.getProjection()),o.id,Fe.layoutVertexBuffer,Fe.indexBuffer,Fe.segments,null,z.zoom,null,[Fe.collisionVertexBuffer,Fe.collisionVertexBufferExt]))}if(!w||!B.length)return;const Q=f.getOrCreateProgram("collisionCircle"),W=new s.cV;W.resize(4*V),W._trim();let te=0;for(const fe of B)for(let Te=0;Te<fe.circleArray.length/4;Te++){const _e=4*Te,xe=fe.circleArray[_e+0],ge=fe.circleArray[_e+1],Re=fe.circleArray[_e+2],Fe=fe.circleArray[_e+3];W.emplace(te++,xe,ge,Re,Fe,0),W.emplace(te++,xe,ge,Re,Fe,1),W.emplace(te++,xe,ge,Re,Fe,2),W.emplace(te++,xe,ge,Re,Fe,3)}(!Vu||Vu.length<2*V)&&(Vu=function(fe){const Te=2*fe,_e=new s.aU;_e.resize(Te),_e._trim();for(let xe=0;xe<Te;xe++){const ge=6*xe;_e.uint16[ge+0]=4*xe+0,_e.uint16[ge+1]=4*xe+1,_e.uint16[ge+2]=4*xe+2,_e.uint16[ge+3]=4*xe+2,_e.uint16[ge+4]=4*xe+3,_e.uint16[ge+5]=4*xe+0}return _e}(V));const ee=M.createIndexBuffer(Vu,!0),le=M.createVertexBuffer(W,s.cW.members,!0);for(const fe of B){const Te={u_matrix:fe.transform,u_inv_matrix:fe.invTransform,u_camera_to_center_distance:(pe=z).getCameraToCenterDistance(fe.projection),u_viewport_size:[pe.width,pe.height]};Q.draw(f,P.TRIANGLES,Ht.disabled,Kt.disabled,f.colorModeForRenderPass(),li.disabled,Te,o.id,le,ee,s.b7.simpleSegment(0,2*fe.circleOffset,fe.circleArray.length,fe.circleArray.length/2),null,z.zoom)}var pe;le.destroy(),ee.destroy()}const Ad=s.ab.mat4.create();function xa(f){const r=f._camera.getWorldToCamera(f.worldSize,1),o=s.ab.mat4.multiply([],r,f.globeMatrix);s.ab.mat4.invert(o,o);const p=[0,0,0],_=[0,1,0,0];return s.ab.vec4.transformMat4(_,_,o),p[0]=_[0],p[1]=_[1],p[2]=_[2],s.ab.vec3.normalize(p,p),p}function vn({width:f,height:r,anchor:o,textOffset:p,textScale:_},x){const{horizontalAlign:w,verticalAlign:M}=s.bD(o),P=-(w-.5)*f,z=-(M-.5)*r,O=s.bC(o,p);return new s.P((P/_+O[0])*x,(z/_+O[1])*x)}function ap(f,r,o,p,_,x,w,M,P,z,O){const B=f.text.placedSymbolArray,V=f.text.dynamicLayoutVertexArray,G=f.icon.dynamicLayoutVertexArray,Q={},W=f.getProjection(),te=al(M,W,x),ee=x.elevation,le=W.upVectorScale(M.canonical,x.center.lat,x.worldSize).metersToTile;V.clear();for(let pe=0;pe<B.length;pe++){const fe=B.get(pe),{tileAnchorX:Te,tileAnchorY:_e,numGlyphs:xe}=fe,ge=fe.hidden||!fe.crossTileID||f.allowVerticalPlacement&&!fe.placedOrientation?null:p[fe.crossTileID];if(ge){let Re=0,Fe=0,rt=0;if(ee){const at=ee?ee.getAtTileOffset(M,Te,_e):0,[Mt,_t,dt]=W.upVector(M.canonical,Te,_e);Re=at*Mt*le,Fe=at*_t*le,rt=at*dt*le}let[Ke,ht,ut,$e]=ls(fe.projectedAnchorX+Re,fe.projectedAnchorY+Fe,fe.projectedAnchorZ+rt,o?te:w);const st=Au(x.getCameraToCenterDistance(W),$e);let xt=_.evaluateSizeForFeature(f.textSizeData,z,fe)*st/s.bw;o&&(xt*=f.tilePixelRatio/P);const He=vn(ge,xt);o?({x:Ke,y:ht,z:ut}=W.projectTilePoint(Te+He.x,_e+He.y,M.canonical),[Ke,ht,ut]=ls(Ke+Re,ht+Fe,ut+rt,w)):(r&&He._rotate(-x.angle),Ke+=He.x,ht+=He.y,ut=0);const ft=f.allowVerticalPlacement&&fe.placedOrientation===s.bq.vertical?Math.PI/2:0;for(let at=0;at<xe;at++)s.bt(V,Ke,ht,ut,ft);O&&fe.associatedIconIndex>=0&&(Q[fe.associatedIconIndex]={x:Ke,y:ht,z:ut,angle:ft})}else yn(xe,V)}if(O){G.clear();const pe=f.icon.placedSymbolArray;for(let fe=0;fe<pe.length;fe++){const Te=pe.get(fe),{numGlyphs:_e}=Te,xe=Q[fe];if(Te.hidden||!xe)yn(_e,G);else{const{x:ge,y:Re,z:Fe,angle:rt}=xe;for(let Ke=0;Ke<_e;Ke++)s.bt(G,ge,Re,Fe,rt)}}f.icon.dynamicLayoutVertexBuffer.updateData(G)}f.text.dynamicLayoutVertexBuffer.updateData(V)}function Id(f,r,o,p,_,x,w={}){const M=o.paint.get("icon-translate"),P=o.paint.get("text-translate"),z=o.paint.get("icon-translate-anchor"),O=o.paint.get("text-translate-anchor"),B=o.layout.get("icon-rotation-alignment"),V=o.layout.get("text-rotation-alignment"),G=o.layout.get("icon-pitch-alignment"),Q=o.layout.get("text-pitch-alignment"),W=o.layout.get("icon-keep-upright"),te=o.layout.get("text-keep-upright"),ee=o.paint.get("icon-color-saturation"),le=o.paint.get("icon-color-contrast"),pe=o.paint.get("icon-color-brightness-min"),fe=o.paint.get("icon-color-brightness-max"),Te=o.layout.get("symbol-elevation-reference")==="sea",_e=f.context,xe=_e.gl,ge=f.transform,Re=B==="map",Fe=V==="map",rt=G==="map",Ke=Q==="map",ht=o.layout.get("symbol-sort-key").constantOr(1)!==void 0;let ut=!1;const $e=f.depthModeForSublayer(0,Ht.ReadOnly),st=[s.at(ge.center.lng),s.aA(ge.center.lat)],xt=o.layout.get("text-variable-anchor"),He=ge.projection.name==="globe",ft=[],at=[0,-1,0];for(const Mt of p){const _t=r.getTile(Mt),dt=_t.getBucket(o);if(!dt||dt.projection.name==="mercator"&&He||dt.fullyClipped)continue;const bt=dt.projection.name==="globe",It=bt?s.ae(ge.zoom):0,Ot=al(Mt,dt.getProjection(),ge),jt=ge.calculatePixelsToTileUnitsMatrix(_t),ui=xt&&dt.hasTextData(),ti=dt.hasIconTextFit()&&ui&&dt.hasIconData(),ri=dt.getProjection().createInversionMatrix(ge,Mt.canonical),fi=Zi=>{ge.depthOcclusionForSymbolsAndCircles&&(o.hasInitialOcclusionOpacityProperties||f.terrain)&&(Zi.push("DEPTH_D24"),Zi.push("DEPTH_OCCLUSION"))},ki=()=>{const Zi=Re&&o.layout.get("symbol-placement")!=="point",Yi=[];fi(Yi);const On=Zi||ti,Mr=o.paint.get("icon-image-cross-fade").constantOr(0);f.terrainRenderModeElevated()&&rt&&Yi.push("PITCH_WITH_MAP_TERRAIN"),bt&&(Yi.push("PROJECTION_GLOBE_VIEW"),On&&Yi.push("PROJECTED_POS_ON_VIEWPORT")),Mr>0&&Yi.push("ICON_TRANSITION"),dt.icon.zOffsetVertexBuffer&&Yi.push("Z_OFFSET"),ee===0&&le===0&&pe===0&&fe===1||Yi.push("COLOR_ADJUSTMENT"),dt.sdfIcons&&Yi.push("RENDER_SDF");const dr=dt.icon.programConfigurations.get(o.id),fr=f.getOrCreateProgram("symbol",{config:dr,defines:Yi}),Ta=_t.imageAtlasTexture?_t.imageAtlasTexture.size:[0,0],hs=dt.iconSizeData,kn=s.bp(hs,ge.zoom),hn=rt||ge.pitch!==0,ln=xr(Ot,_t.tileID.canonical,rt,Re,ge,dt.getProjection(),jt),Bi=Hn(Ot,_t.tileID.canonical,rt,Re,ge,dt.getProjection(),jt),er=f.translatePosMatrix(Bi,_t,M,z,!0),Cr=f.translatePosMatrix(Ot,_t,M,z),un=On?Ad:ln,ds=Re&&!rt&&!Zi;let Na=at;!He&&!ge.mercatorFromTransition||Re||(Na=xa(ge));const sa=bt?Na:at,Fs=o.getColorAdjustmentMatrix(ee,le,pe,fe),Co=Rg(hs.kind,kn,ds,rt,f,Cr,un,er,Te,!1,Ta,[0,0],!0,Mt,It,st,ri,sa,dt.getProjection(),Fs,Mr),Fa=_t.imageAtlasTexture?_t.imageAtlasTexture:null,Ea=o.layout.get("icon-size").constantOr(0)!==1||dt.iconsNeedLinear,qc=dt.sdfIcons||f.options.rotating||f.options.zooming||Ea||hn?xe.LINEAR:xe.NEAREST,Ro=dt.sdfIcons&&o.paint.get("icon-halo-width").constantOr(1)!==0,Gc=f.terrain&&rt&&Zi?s.ab.mat4.invert(s.ab.mat4.create(),ln):Ad;if(Zi&&dt.icon){const Ju=ge.elevation,wp=Ju?Ju.getAtTileOffsetFunc(Mt,ge.center.lat,ge.worldSize,dt.getProjection()):null,r_=Rn(Ot,_t.tileID.canonical,rt,Re,ge,dt.getProjection(),jt);Tc(dt,Ot,f,!1,r_,Bi,rt,W,wp,Mt)}return{program:fr,buffers:dt.icon,uniformValues:Co,atlasTexture:Fa,atlasTextureIcon:null,atlasInterpolation:qc,atlasInterpolationIcon:null,isSDF:dt.sdfIcons,hasHalo:Ro,tile:_t,labelPlaneMatrixInv:Gc}},en=()=>{const Zi=Fe&&o.layout.get("symbol-placement")!=="point",Yi=[],On=Zi||xt||ti;f.terrainRenderModeElevated()&&Ke&&Yi.push("PITCH_WITH_MAP_TERRAIN"),bt&&(Yi.push("PROJECTION_GLOBE_VIEW"),On&&Yi.push("PROJECTED_POS_ON_VIEWPORT")),dt.text.zOffsetVertexBuffer&&Yi.push("Z_OFFSET"),dt.iconsInText&&Yi.push("RENDER_TEXT_AND_SYMBOL"),Yi.push("RENDER_SDF"),fi(Yi);const Mr=dt.text.programConfigurations.get(o.id),dr=f.getOrCreateProgram("symbol",{config:Mr,defines:Yi});let fr,Ta=[0,0],hs=null;const kn=dt.textSizeData;dt.iconsInText&&(Ta=_t.imageAtlasTexture?_t.imageAtlasTexture.size:[0,0],hs=_t.imageAtlasTexture?_t.imageAtlasTexture:null,fr=Ke||ge.pitch!==0||f.options.rotating||f.options.zooming||kn.kind==="composite"||kn.kind==="camera"?xe.LINEAR:xe.NEAREST);const hn=_t.glyphAtlasTexture?_t.glyphAtlasTexture.size:[0,0],ln=o.layout.get("text-size-scale-range"),Bi=s.aw(f.scaleFactor,ln[0],ln[1]),er=s.bp(kn,ge.zoom,Bi),Cr=xr(Ot,_t.tileID.canonical,Ke,Fe,ge,dt.getProjection(),jt),un=Hn(Ot,_t.tileID.canonical,Ke,Fe,ge,dt.getProjection(),jt),ds=f.translatePosMatrix(un,_t,P,O,!0),Na=f.translatePosMatrix(Ot,_t,P,O),sa=On?Ad:Cr,Fs=Fe&&!Ke&&!Zi;let Co=at;!He&&!ge.mercatorFromTransition||Fe||(Co=xa(ge));const Fa=Rg(kn.kind,er,Fs,Ke,f,Na,sa,ds,Te,!0,hn,Ta,!0,Mt,It,st,ri,bt?Co:at,dt.getProjection(),null,null,Bi),Ea=_t.glyphAtlasTexture?_t.glyphAtlasTexture:null,qc=xe.LINEAR,Ro=o.paint.get("text-halo-width").constantOr(1)!==0,Gc=f.terrain&&Ke&&Zi?s.ab.mat4.invert(s.ab.mat4.create(),Cr):Ad;if(Zi&&dt.text){const Ju=ge.elevation,wp=Ju?Ju.getAtTileOffsetFunc(Mt,ge.center.lat,ge.worldSize,dt.getProjection()):null,r_=Rn(Ot,_t.tileID.canonical,Ke,Fe,ge,dt.getProjection(),jt);Tc(dt,Ot,f,!0,r_,un,Ke,te,wp,Mt)}return{program:dr,buffers:dt.text,uniformValues:Fa,atlasTexture:Ea,atlasTextureIcon:hs,atlasInterpolation:qc,atlasInterpolationIcon:fr,isSDF:!0,hasHalo:Ro,tile:_t,labelPlaneMatrixInv:Gc}},Bn=dt.icon.segments.get().length,bn=dt.text.segments.get().length,_i=Bn&&!w.onlyText?ki():null,ji=bn&&!w.onlyIcons?en():null,Xt=o.paint.get("icon-opacity").constantOr(1),Di=o.paint.get("text-opacity").constantOr(1);if(ht&&dt.canOverlap){ut=!0;const Zi=Xt&&!w.onlyText?dt.icon.segments.get():[],Yi=Di&&!w.onlyIcons?dt.text.segments.get():[];for(const On of Zi)ft.push({segments:new s.b7([On]),sortKey:On.sortKey,state:_i});for(const On of Yi)ft.push({segments:new s.b7([On]),sortKey:On.sortKey,state:ji})}else w.onlyText||ft.push({segments:Xt?dt.icon.segments:new s.b7([]),sortKey:0,state:_i}),w.onlyIcons||ft.push({segments:Di?dt.text.segments:new s.b7([]),sortKey:0,state:ji})}ut&&ft.sort((Mt,_t)=>Mt.sortKey-_t.sortKey);for(const Mt of ft){const _t=Mt.state;if(_t)if(f.terrain?f.terrain.setupElevationDraw(_t.tile,_t.program,{useDepthForOcclusion:ge.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:_t.labelPlaneMatrixInv}):f.setupDepthForOcclusion(ge.depthOcclusionForSymbolsAndCircles,_t.program),_e.activeTexture.set(xe.TEXTURE0),_t.atlasTexture&&_t.atlasTexture.bind(_t.atlasInterpolation,xe.CLAMP_TO_EDGE,!0),_t.atlasTextureIcon&&(_e.activeTexture.set(xe.TEXTURE1),_t.atlasTextureIcon&&_t.atlasTextureIcon.bind(_t.atlasInterpolationIcon,xe.CLAMP_TO_EDGE,!0)),f.uploadCommonLightUniforms(f.context,_t.program),_t.hasHalo){const dt=_t.uniformValues;dt.u_is_halo=1,op(_t.buffers,Mt.segments,o,f,_t.program,$e,_,x,dt,2),dt.u_is_halo=0}else{if(_t.isSDF){const dt=_t.uniformValues;_t.hasHalo&&(dt.u_is_halo=1,op(_t.buffers,Mt.segments,o,f,_t.program,$e,_,x,dt,1)),dt.u_is_halo=0}op(_t.buffers,Mt.segments,o,f,_t.program,$e,_,x,_t.uniformValues,1)}}}function op(f,r,o,p,_,x,w,M,P,z){const O=[f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer,f.iconTransitioningVertexBuffer,f.globeExtVertexBuffer,f.zOffsetVertexBuffer];_.draw(p,p.context.gl.TRIANGLES,x,w,M,li.disabled,P,o.id,f.layoutVertexBuffer,f.indexBuffer,r,o.paint,p.transform.zoom,f.programConfigurations.get(o.id),O,z)}function kg(f,r,o,p,_,x,w){const M=f.context.gl,P=o.paint.get("fill-pattern"),z=o.is3D(),O=z?f.stencilModeFor3D():Kt.disabled,B=P&&P.constantOr(1);let V,G,Q,W,te;w?(G=B&&!o.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",V=M.LINES):(G=B?"fillPattern":"fill",V=M.TRIANGLES);for(const ee of p){const le=r.getTile(ee);if(B&&!le.patternsLoaded())continue;const pe=le.getBucket(o);if(!pe)continue;f.prepareDrawTile();const fe=pe.programConfigurations.get(o.id),Te=f.isTileAffectedByFog(ee),_e=f.getOrCreateProgram(G,{config:fe,overrideFog:Te});B&&(f.context.activeTexture.set(M.TEXTURE0),le.imageAtlasTexture&&le.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),fe.updatePaintBuffers());const xe=P.constantOr(null);if(xe&&le.imageAtlas){const Fe=le.imageAtlas,rt=s.A.from(xe).getPrimary().scaleSelf(s.q.devicePixelRatio).serialize(),Ke=Fe.patternPositions[rt];Ke&&fe.setConstantPatternPositions(Ke)}const ge=f.translatePosMatrix(ee.projMatrix,le,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor")),Re=o.paint.get("fill-emissive-strength");if(w){W=pe.indexBuffer2,te=pe.segments2;const Fe=f.terrain&&f.terrain.renderingToTexture?f.terrain.drapeBufferSize:[M.drawingBufferWidth,M.drawingBufferHeight];Q=G==="fillOutlinePattern"&&B?H0(ge,Re,f,le,Fe):Ag(ge,Re,Fe)}else W=pe.indexBuffer,te=pe.segments,Q=B?Ed(ge,Re,f,le):Td(ge,Re);f.uploadCommonUniforms(f.context,_e,ee.toUnwrapped()),_e.draw(f,V,_,z?O:f.stencilModeForClipping(ee),x,li.disabled,Q,o.id,pe.layoutVertexBuffer,W,te,o.paint,f.transform.zoom,fe,void 0)}}function Md(f,r,o,p,_,x,w,M){o.resetLayerRenderingStats(f);const P=f.context,z=P.gl,O=f.transform,B=o.paint.get("fill-extrusion-pattern"),V=B.constantOr(1),G=o.paint.get("fill-extrusion-opacity"),Q=f.style.enable3dLights(),W=o.paint.get(Q&&!V?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),te=[o.paint.get("fill-extrusion-ambient-occlusion-intensity"),W],ee=o.layout.get("fill-extrusion-edge-radius"),le=ee>0&&!o.paint.get("fill-extrusion-rounded-roof"),pe=le?0:ee,fe=O.projection.name==="globe"?s.d3():0,Te=O.projection.name==="globe",_e=Te?s.ae(O.zoom):0,xe=[s.at(O.center.lng),s.aA(O.center.lat)],ge=o.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Re=o.paint.get("fill-extrusion-flood-light-color").toRenderColor(ge?null:o.lut).toArray01().slice(0,3),Fe=o.paint.get("fill-extrusion-flood-light-intensity"),rt=o.paint.get("fill-extrusion-vertical-scale"),Ke=o.paint.get("fill-extrusion-line-width").constantOr(1)!==0,ht=o.paint.get("fill-extrusion-height-alignment"),ut=o.paint.get("fill-extrusion-base-alignment"),$e=Ul(f,o.paint.get("fill-extrusion-cutoff-fade-range")),st=[];let xt;Te&&st.push("PROJECTION_GLOBE_VIEW"),te[0]>0&&st.push("FAUX_AO"),le&&st.push("ZERO_ROOF_RADIUS"),M&&st.push("HAS_CENTROID"),Fe>0&&st.push("FLOOD_LIGHT"),$e.shouldRenderCutoff&&st.push("RENDER_CUTOFF"),Ke&&st.push("RENDER_WALL_MODE");const He=f.renderPass==="shadow",ft=f.shadowRenderer,at=He&&!!ft;f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!0);let Mt=[0,0,0];if(ft){const bt=f.style.directionalLight,It=f.style.ambientLight;bt&&It&&(Mt=rg(f.style,bt,It)),He||(st.push("RENDER_SHADOWS","DEPTH_TEXTURE"),ft.useNormalOffset&&st.push("NORMAL_OFFSET")),xt=st.concat(["SHADOWS_SINGLE_CASCADE"])}const _t=at?"fillExtrusionDepth":V?"fillExtrusionPattern":"fillExtrusion",dt=o.getLayerRenderingStats();for(const bt of p){const It=r.getTile(bt),Ot=It.getBucket(o);if(!Ot||Ot.projection.name!==O.projection.name)continue;let jt=!1;ft&&(jt=ft.getMaxCascadeForTile(bt.toUnwrapped())===0);const ui=f.isTileAffectedByFog(bt),ti=Ot.programConfigurations.get(o.id),ri=f.getOrCreateProgram(_t,{config:ti,defines:jt?xt:st,overrideFog:ui});if(f.terrain&&f.terrain.setupElevationDraw(It,ri,{useMeterToDem:!0}),!Ot.centroidVertexBuffer){const ji=ri.attributes.a_centroid_pos;ji!==void 0&&z.vertexAttrib2f(ji,0,0)}!He&&ft&&ft.setupShadows(It.tileID.toUnwrapped(),ri,"vector-tile",It.tileID.overscaledZ),V&&(f.context.activeTexture.set(z.TEXTURE0),It.imageAtlasTexture&&It.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),ti.updatePaintBuffers());const fi=B.constantOr(null);if(fi&&It.imageAtlas){const ji=It.imageAtlas,Xt=s.A.from(fi).getPrimary().scaleSelf(s.q.devicePixelRatio),Di=ji.patternPositions[Xt.serialize()];Di&&ti.setConstantPatternPositions(Di)}const ki=o.paint.get("fill-extrusion-vertical-gradient"),en=1/Ot.tileToMeter;let Bn;if(He&&ft){if(Gu(It.tileID,Ot,f))continue;const ji=ft.calculateShadowPassMatrixFromTile(It.tileID.toUnwrapped());Bn=wd(ji,pe,en,rt,ht,ut)}else{const ji=f.translatePosMatrix(bt.expandedProjMatrix,It,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),Xt=O.projection.createInversionMatrix(O,bt.canonical);Bn=V?G0(ji,f,ki,G,te,pe,en,bt,It,fe,ht,ut,_e,xe,Xt,Re,rt):tp(ji,f,ki,G,te,pe,en,bt,fe,ht,ut,_e,xe,Xt,Re,rt,Fe,Mt)}f.uploadCommonUniforms(P,ri,bt.toUnwrapped(),null,$e);let bn=Ot.segments;if(O.projection.name==="mercator"&&!He&&(bn=Ot.getVisibleSegments(It.tileID,f.terrain,f.transform.getFrustum(0)),!bn.get().length))continue;if(dt)if(He)for(const ji of bn.get())dt.numRenderedVerticesInShadowPass+=ji.primitiveLength;else for(const ji of bn.get())dt.numRenderedVerticesInTransparentPass+=ji.primitiveLength;const _i=[];(f.terrain||M)&&_i.push(Ot.centroidVertexBuffer),Te&&_i.push(Ot.layoutVertexExtBuffer),Ke&&_i.push(Ot.wallVertexBuffer),ri.draw(f,P.gl.TRIANGLES,_,x,w,li.backCCW,Bn,o.id,Ot.layoutVertexBuffer,Ot.indexBuffer,bn,o.paint,f.transform.zoom,ti,_i)}f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!1)}function Uu(f,r,o,p,_,x,w,M,P,z,O,B,V,G,Q,W,te,ee,le){const pe=f.context,fe=pe.gl,Te=f.transform,_e=f.transform.zoom,xe=[],ge=Ul(f,o.paint.get("fill-extrusion-cutoff-fade-range"));z==="clear"?(xe.push("CLEAR_SUBPASS"),le&&(xe.push("CLEAR_FROM_TEXTURE"),pe.activeTexture.set(fe.TEXTURE0),le.bind(fe.LINEAR,fe.CLAMP_TO_EDGE))):z==="sdf"&&xe.push("SDF_SUBPASS"),te&&xe.push("HAS_CENTROID"),ge.shouldRenderCutoff&&xe.push("RENDER_CUTOFF");const Re=o.layout.get("fill-extrusion-edge-radius"),Fe=(rt,Ke,ht,ut,$e)=>{const st=Ke.programConfigurations.get(o.id),xt=f.isTileAffectedByFog(rt),He=f.getOrCreateProgram("fillExtrusionGroundEffect",{config:st,defines:xe,overrideFog:xt}),ft=((Mt,_t,dt,bt,It,Ot,jt,ui,ti,ri,fi)=>({u_matrix:_t,u_opacity:dt,u_ao_pass:bt?1:0,u_meter_to_tile:It,u_ao:Ot,u_flood_light_intensity:jt,u_flood_light_color:ui,u_attenuation:ti,u_edge_radius:ri,u_fb:0,u_fb_size:fi,u_dynamic_offset:1}))(0,ut,O,P,$e,[B,V*$e],G,Q,W,_e>=17?0:Re*$e,le?le.size[0]:0),at=[];te&&at.push(Ke.hiddenByLandmarkVertexBuffer),f.uploadCommonUniforms(pe,He,rt.toUnwrapped(),null,ge),He.draw(f,pe.gl.TRIANGLES,_,x,w,M,ft,o.id,Ke.vertexBuffer,Ke.indexBuffer,ht,o.paint,_e,st,at)};for(const rt of p){const Ke=r.getTile(rt),ht=Ke.getBucket(o);if(!ht||ht.projection.name!==Te.projection.name||!ht.groundEffect||ht.groundEffect&&!ht.groundEffect.hasData())continue;const ut=ht.groundEffect,$e=1/ht.tileToMeter;{const st=f.translatePosMatrix(rt.projMatrix,Ke,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),xt=ut.getDefaultSegment();Fe(rt,ut,xt,st,$e)}if(ee)for(let st=0;st<4;st++){const xt=s.d4[st](rt),He=r.getTile(xt);if(!He)continue;const ft=He.getBucket(o);if(!ft||ft.projection.name!==Te.projection.name||!ft.groundEffect||ft.groundEffect&&!ft.groundEffect.hasData())continue;const at=ft.groundEffect;let Mt,_t;st===0?(Mt=[-s.ag,0,0],_t=1):st===1?(Mt=[s.ag,0,0],_t=0):st===2?(Mt=[0,-s.ag,0],_t=3):(Mt=[0,s.ag,0],_t=2);const dt=at.regionSegments[_t];if(!dt)continue;const bt=new Float32Array(16);s.ab.mat4.translate(bt,rt.projMatrix,Mt),Fe(rt,at,dt,f.translatePosMatrix(bt,Ke,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),$e)}}}function ju(f,r,o,p,_,x,w){p.centroidVertexArray.length===0&&p.createCentroidsBuffer();const M=x?x.findDEMTileFor(o):null;if(!(M&&M.dem||w))return;x&&M&&M.dem&&p.selfDEMTileTimestamp!==M.dem._timestamp&&(p.borderDoneWithNeighborZ=[-1,-1,-1,-1],p.selfDEMTileTimestamp=M.dem._timestamp);const P=ee=>new s.P(Math.ceil((ee+s.d7)*s.d8),0),z=ee=>{const le=r.getSource().minzoom,pe=Te=>{const _e=r.getTileByID(Te);if(_e&&_e.hasData())return _e.getBucket(_)},fe=[0,-1,1];for(const Te of fe){if(ee.overscaledZ+Te<le)continue;const _e=pe(ee.calculateScaledKey(ee.overscaledZ+Te));if(_e)return _e}},O=[0,0,0],B=(ee,le)=>(O[0]=Math.min(ee.min.y,le.min.y),O[1]=Math.max(ee.max.y,le.max.y),O[2]=s.ag-le.min.x>ee.max.x?le.min.x-s.ag:ee.max.x,O),V=(ee,le)=>(O[0]=Math.min(ee.min.x,le.min.x),O[1]=Math.max(ee.max.x,le.max.x),O[2]=s.ag-le.min.y>ee.max.y?le.min.y-s.ag:ee.max.y,O),G=[(ee,le)=>B(ee,le),(ee,le)=>B(le,ee),(ee,le)=>V(ee,le),(ee,le)=>V(le,ee)],Q=(ee,le,pe,fe,Te,_e,xe)=>{if(!x)return 0;const ge=[[_e?pe:ee,_e?ee:pe,0],[_e?pe:le,_e?le:pe,0]],Re=xe<0?s.ag+xe:xe,Fe=[_e?Re:(ee+le)/2,_e?(ee+le)/2:Re,0];return pe===0&&xe<0||pe!==0&&xe>0?x.getForTilePoints(Te,[Fe],!0,fe):ge.push(Fe),x.getForTilePoints(o,ge,!0,M),Math.max(ge[0][2],ge[1][2],Fe[2])/x.exaggeration()};for(let ee=0;ee<4;ee++){const le=p.borderFeatureIndices[ee];if(le.length===0)continue;const pe=s.d4[ee](o),fe=z(pe);if(!(fe&&fe instanceof s.d5))continue;const Te=x?x.findDEMTileFor(pe):null;if(!(Te&&Te.dem||w)||(x&&Te&&Te.dem&&p.borderDEMTileTimestamp[ee]!==Te.dem._timestamp&&(p.borderDoneWithNeighborZ[ee]=-1,p.borderDEMTileTimestamp[ee]=Te.dem._timestamp),p.borderDoneWithNeighborZ[ee]===fe.canonical.z))continue;fe.centroidVertexArray.length===0&&fe.createCentroidsBuffer();const _e=(ee<2?1:5)-ee,xe=fe.borderDoneWithNeighborZ[_e]!==p.canonical.z,ge=fe.borderFeatureIndices[_e];let Re=0;if(p.canonical.z!==fe.canonical.z){for(const Fe of le)p.showCentroid(p.featuresOnBorder[Fe]);if(xe)for(const Fe of ge)fe.showCentroid(fe.featuresOnBorder[Fe]);p.borderDoneWithNeighborZ[ee]=fe.canonical.z,fe.borderDoneWithNeighborZ[_e]=p.canonical.z}for(const Fe of le){const rt=p.featuresOnBorder[Fe],Ke=p.centroidData[rt.centroidDataIndex],ht=rt.borders[ee];let ut;for(;Re<ge.length;){ut=fe.featuresOnBorder[ge[Re]];const $e=ut.borders[_e];if($e[1]>ht[0]+3||$e[0]>ht[0]-3)break;fe.showCentroid(ut),Re++}if(ut&&Re<ge.length){const $e=Re;let st=0;for(;!(ut.borders[_e][0]>ht[1]-3)&&(st++,++Re!==ge.length);)ut=fe.featuresOnBorder[ge[Re]];ut=fe.featuresOnBorder[ge[$e]];let xt=!1;if(st>=1){const at=ut.borders[_e];Math.abs(ht[0]-at[0])<3&&Math.abs(ht[1]-at[1])<3&&(st=1,xt=!0,Re=$e+1)}else if(st===0){p.showCentroid(rt);continue}const He=fe.centroidData[ut.centroidDataIndex];w&&xt&&(((W=Ke).flags|(te=He).flags)&s.d6?(W.flags|=s.d6,te.flags|=s.d6):(W.flags&=~s.d6,te.flags&=~s.d6));const ft=rt.intersectsCount()>1||ut.intersectsCount()>1;if(st>1)Re=$e,Ke.centroidXY=He.centroidXY=new s.P(0,0);else if(Te&&Te.dem&&!ft){const at=G[ee](Ke,He),Mt=ee%2?s.ag-1:0,_t=Q(at[0],Math.min(s.ag-1,at[1]),Mt,Te,pe,ee<2,at[2]);Ke.centroidXY=He.centroidXY=P(_t)}else ft?Ke.centroidXY=He.centroidXY=new s.P(0,0):(Ke.centroidXY=p.encodeBorderCentroid(rt),He.centroidXY=fe.encodeBorderCentroid(ut));p.writeCentroidToBuffer(Ke),fe.writeCentroidToBuffer(He)}else p.showCentroid(rt)}p.borderDoneWithNeighborZ[ee]=fe.canonical.z,fe.borderDoneWithNeighborZ[_e]=p.canonical.z}var W,te;(p.needsCentroidUpdate||!p.centroidVertexBuffer&&p.centroidVertexArray.length!==0)&&p.uploadCentroid(f)}const qu=[1,0,0],Et=[0,1,0],kt=[0,0,1];function Gu(f,r,o){const p=o.transform,_=o.shadowRenderer;if(!_)return!0;const x=f.toUnwrapped(),w=p.tileSize*_._cascades[o.currentShadowCascade].scale;let M=r.maxHeight;if(p.elevation){const W=p.elevation.getMinMaxForTile(f);W&&(M+=W.max)}const P=[..._.shadowDirection];P[2]=-P[2];const z=_.computeSimplifiedTileShadowVolume(x,M,w,P);if(!z)return!1;const O=[qu,Et,kt,P,[P[0],0,P[2]],[0,P[1],P[2]]],B=p.projection.name==="globe",V=p.scaleZoom(w),G=s.bR.fromInvProjectionMatrix(p.invProjMatrix,p.worldSize,V,!B),Q=_.getCurrentCascadeFrustum();return G.intersectsPrecise(z.vertices,z.planes,O)===0||Q.intersectsPrecise(z.vertices,z.planes,O)===0}function zn(f){return[f[0]*s.d9,f[1]*s.d9,f[2]*s.d9,0]}function Qe(f,r,o,p,_,x,w,M,P){const z=p.getSource(),O=o.globeSharedBuffers;if(!O)return;let B,V,G;if(r&&(B=p.getTile(r)),z instanceof s.aJ?(V=z.texture,G=s.cI(0,0,o.transform)):B&&r&&(V=B.texture,G=s.cI(r.canonical.z,r.canonical.x,o.transform)),!V||!G)return;f||(G=s.ab.mat4.scale(s.ab.mat4.create(),G,[1,-1,1]));const Q=o.context,W=Q.gl,te=_.paint.get("raster-resampling")==="nearest"?W.NEAREST:W.LINEAR,ee=o.colorModeForDrapableLayerRenderPass(x),le=w.defines;le.push("GLOBE_POLES");const pe=new Ht(W.LEQUAL,Ht.ReadWrite,o.depthRangeFor3D),fe=Float32Array.from(o.transform.expandedFarZProjMatrix),Te=Float32Array.from(s.bb(s.cH(new s.bT(0,0,0))));o.terrain&&o.terrain.prepareDrawTile(),Q.activeTexture.set(W.TEXTURE0),V.bind(te,W.CLAMP_TO_EDGE),Q.activeTexture.set(W.TEXTURE1),V.bind(te,W.CLAMP_TO_EDGE),V.useMipmap&&Q.extTextureFilterAnisotropic&&o.transform.pitch>20&&W.texParameterf(W.TEXTURE_2D,Q.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Q.extTextureFilterAnisotropicMax);const[_e,xe,ge,Re]=r?O.getPoleBuffers(r.canonical.z,!1):O.getPoleBuffers(0,!0),Fe=_.paint.get("raster-elevation");let rt;f?(rt=_e,o.renderDefaultNorthPole=Fe!==0):(rt=xe,o.renderDefaultSouthPole=Fe!==0);const Ke=zn(w.mix),ht=(($e,st,xt,He,ft,at,Mt,_t,dt,bt,It,Ot,jt)=>Gl($e,st,xt,new Float32Array(16),new Float32Array(9),[0,0],He,[0,0],[0,0,0,0],1,{opacity:1,mix:0},at,[0,0],_t,2,bt,It,Ot,1,0,jt))(fe,Te,G,s.ae(o.transform.zoom),0,_,0,Fe,0,Ke,w.offset,w.range,x),ut=o.getOrCreateProgram("raster",{defines:le});o.uploadCommonUniforms(Q,ut,null),ut.draw(o,W.TRIANGLES,pe,P,ee,M,ht,_.id,rt,ge,Re)}function Z0(f){const r=f._nearZ,o=f.projection.farthestPixelDistance(f),p=o-r,_=.2*f.height,x=r+_;return[r,o,(x-_-r)/p,(x-r)/p]}function lp(f,r,o,p){if(f)return r instanceof qn&&f instanceof Xa?r.getTextureDescriptor(f,o,!0):{texture:f.texture,mix:zn(p.mix),offset:p.offset,buffer:0,tileSize:1}}var Ng=s.da([{name:"a_index",type:"Int16",components:1}]);class W0{constructor(r,o,p,_){const x={width:p[0],height:p[1],data:null},w=r.gl;this.targetColorTexture=new s.T(r,x,w.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new s.T(r,x,w.RGBA8,{useMipmap:!1}),this.context=r,this.updateParticleTexture(o,_),this.lastInvalidatedAt=0}updateParticleTexture(r,o){if(this.particleTextureDimension===o.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const p=this.context.gl,_=o.width*o.height;this.particleTexture0=new s.T(this.context,o,p.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new s.T(this.context,o,p.RGBA8,{premultiply:!1,useMipmap:!1});const x=new s.db;x.reserve(_);for(let w=0;w<_;w++)x.emplaceBack(w);this.particleIndexBuffer=this.context.createVertexBuffer(x,Ng.members,!0),this.particleSegment=s.b7.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=o.width}update(r){return!(this.lastInvalidatedAt<r&&(this.lastInvalidatedAt=s.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function X0(f,r,o){if(!f)return null;const p=r.getTextureDescriptor(f,o,!0);if(!p)return null;let{texture:_,mix:x,offset:w,tileSize:M,buffer:P,format:z}=p;if(!_||!z)return null;let O=!1;return z==="uint32"&&(O=!0,x[3]=0,x=Ig(s.dc,x,[0,o.paint.get("raster-particle-max-speed")]),w=Mg(s.dc,w,[0,o.paint.get("raster-particle-max-speed")])),{texture:_,textureOffset:[P/(M+2*P),M/(M+2*P)],tileSize:M,scalarData:O,scale:x,offset:w,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[z]]}}function Y0(f){const r=f._nearZ,o=f.projection.farthestPixelDistance(f),p=o-r,_=.2*f.height,x=r+_;return[r,o,(x-_-r)/p,(x-r)/p]}const Hu=new s.aj(1,0,0,1),lw=new s.aj(0,1,0,1),cw=new s.aj(0,0,1,1),K0=new s.aj(1,0,1,1),cp=new s.aj(0,1,1,1);function $l(f,r,o,p,_,x,w){const M=f.context,P=f.transform,z=M.gl,O=P.projection.name==="globe",B=O?["PROJECTION_GLOBE_VIEW"]:[];let V=s.ab.mat4.clone(o.projMatrix);if(O&&s.ae(P.zoom)>0){const Ke=s.ba(o.canonical,P),ht=s.dd(Ke);V=s.ab.mat4.multiply(new Float32Array(16),P.globeMatrix,ht),s.ab.mat4.multiply(V,P.projMatrix,V)}const G=s.ab.mat4.create();G[12]+=2*_/(s.q.devicePixelRatio*P.width),G[13]+=2*x/(s.q.devicePixelRatio*P.height),s.ab.mat4.multiply(V,G,V);const Q=f.getOrCreateProgram("debug",{defines:B}),W=r.getTileByID(o.key);f.terrain&&f.terrain.setupElevationDraw(W,Q);const te=Ht.disabled,ee=Kt.disabled,le=f.colorModeForRenderPass(),pe="$debug";M.activeTexture.set(z.TEXTURE0),f.emptyTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),O?W._makeGlobeTileDebugBuffers(f.context,P):W._makeDebugTileBoundsBuffers(f.context,P.projection);const fe=W._tileDebugBuffer||f.debugBuffer,Te=W._tileDebugIndexBuffer||f.debugIndexBuffer,_e=W._tileDebugSegments||f.debugSegments;if(Q.draw(f,z.LINE_STRIP,te,ee,le,li.disabled,zc(V,p),pe,fe,Te,_e,null,null,null,[W._globeTileDebugBorderBuffer]),w){const Ke=W.latestRawTileData,ht=Math.floor((Ke&&Ke.byteLength||0)/1024);let ut=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(ut+=` => ${o.overscaledZ}`),ut+=` ${W.state}`,ut+=` ${ht}kb`,function($e,st){$e.initDebugOverlayCanvas();const xt=$e.debugOverlayCanvas,He=$e.context.gl,ft=$e.debugOverlayCanvas.getContext("2d");ft.clearRect(0,0,xt.width,xt.height),ft.shadowColor="white",ft.shadowBlur=2,ft.lineWidth=1.5,ft.strokeStyle="white",ft.textBaseline="top",ft.font="bold 36px Open Sans, sans-serif",ft.fillText(st,5,5),ft.strokeText(st,5,5),$e.debugOverlayTexture.update(xt),$e.debugOverlayTexture.bind(He.LINEAR,He.CLAMP_TO_EDGE)}(f,ut)}const xe=r.getTile(o).tileSize,ge=512/Math.min(xe,512)*(o.overscaledZ/P.zoom)*.5,Re=W._tileDebugTextBuffer||f.debugBuffer,Fe=W._tileDebugTextIndexBuffer||f.quadTriangleIndexBuffer,rt=W._tileDebugTextSegments||f.debugSegments;Q.draw(f,z.TRIANGLES,te,ee,ni.alphaBlended,li.disabled,zc(V,s.aj.transparent,ge),pe,Re,Fe,rt,null,null,null,[W._globeTileDebugTextBuffer])}function Fg(f,r,o,p){kc(f,0,r+o/2,f.transform.width,o,p)}function Bg(f,r,o,p){kc(f,r-o/2,0,o,f.transform.height,p)}function kc(f,r,o,p,_,x){const w=f.context,M=w.gl;M.enable(M.SCISSOR_TEST),M.scissor(r*s.q.devicePixelRatio,o*s.q.devicePixelRatio,p*s.q.devicePixelRatio,_*s.q.devicePixelRatio),w.clear({color:x}),M.disable(M.SCISSOR_TEST)}const up=s.da([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Eo}=up;function ll(f,r,o,p){f.emplaceBack(r,o,p)}class Q0{constructor(r){this.vertexArray=new s.de,this.indices=new s.aU,ll(this.vertexArray,-1,-1,1),ll(this.vertexArray,1,-1,1),ll(this.vertexArray,-1,1,1),ll(this.vertexArray,1,1,1),ll(this.vertexArray,-1,-1,-1),ll(this.vertexArray,1,-1,-1),ll(this.vertexArray,-1,1,-1),ll(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=r.createVertexBuffer(this.vertexArray,Eo),this.indexBuffer=r.createIndexBuffer(this.indices),this.segment=s.b7.simpleSegment(0,0,36,12)}}function Nr(f,r,o,p,_,x){const w=f.context.gl,M=r.paint.get("sky-atmosphere-color"),P=r.paint.get("sky-atmosphere-halo-color"),z=r.paint.get("sky-atmosphere-sun-intensity"),O=((B,V,G,Q,W)=>({u_matrix_3f:B,u_sun_direction:V,u_sun_intensity:G,u_color_tint_r:[Q.r,Q.g,Q.b,Q.a],u_color_tint_m:[W.r,W.g,W.b,W.a],u_luminance:5e-5}))(s.ab.mat3.fromMat4(s.ab.mat3.create(),p),_,z,M,P);w.framebufferTexture2D(w.FRAMEBUFFER,w.COLOR_ATTACHMENT0,w.TEXTURE_CUBE_MAP_POSITIVE_X+x,r.skyboxTexture,0),o.draw(f,w.TRIANGLES,Ht.disabled,Kt.disabled,ni.unblended,li.frontCW,O,"skyboxCapture",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}const uw=s.da([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Cd{constructor(r){const o=new s.df;o.emplaceBack(-1,1,1,0,0),o.emplaceBack(1,1,1,1,0),o.emplaceBack(1,-1,1,1,1),o.emplaceBack(-1,-1,1,0,1);const p=new s.aU;p.emplaceBack(0,1,2),p.emplaceBack(2,3,0),this.vertexBuffer=r.createVertexBuffer(o,uw.members),this.indexBuffer=r.createIndexBuffer(p),this.segments=s.b7.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const xn=s.da([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Xi{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class J0{constructor(r){this.colorModeAlphaBlendedWriteRGB=new ni([1,Yt,1,Yt],s.aj.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new ni([1,0,1,0],s.aj.transparent,[!1,!1,!1,!0]),this.params=new Xi,this.updateNeeded=!0,r.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),r.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),r.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),r.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(r){const o=r.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Cd(o);const p=this.params.sizeRange,_=this.params.intensityRange,x=function(O){const B=s.di(30),V=[];for(let G=0;G<O;++G){const Q=2*Math.PI*B(),W=Math.acos(1-2*B())-.5*Math.PI;V.push(s.ab.vec3.fromValues(Math.cos(W)*Math.cos(Q),Math.cos(W)*Math.sin(Q),Math.sin(W)))}return V}(this.params.starsCount),w=s.di(300),M=new s.dg,P=new s.aU;let z=0;for(let O=0;O<x.length;++O){const B=s.ab.vec3.scale([],x[O],200),V=Math.max(0,1+.01*p*(1*w()-.5)),G=Math.max(0,1+.01*_*(1*w()-.5));M.emplaceBack(B[0],B[1],B[2],-1,-1,V,G),M.emplaceBack(B[0],B[1],B[2],1,-1,V,G),M.emplaceBack(B[0],B[1],B[2],1,1,V,G),M.emplaceBack(B[0],B[1],B[2],-1,1,V,G),P.emplaceBack(z+0,z+1,z+2),P.emplaceBack(z+0,z+2,z+3),z+=4}this.starsVx=o.createVertexBuffer(M,xn.members),this.starsIdx=o.createIndexBuffer(P),this.starsSegments=s.b7.simpleSegment(0,0,M.length,P.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(r,o){const p=r.context,_=p.gl,x=r.transform,w=new Ht(_.LEQUAL,Ht.ReadOnly,[0,1]),M=s.ae(x.zoom),P=r.style.getLut(o.scope),z=o.properties.get("color-use-theme")==="none",O=o.properties.get("color").toRenderColor(z?null:P).toArray01(),B=o.properties.get("high-color-use-theme")==="none",V=o.properties.get("high-color").toRenderColor(B?null:P).toArray01(),G=o.properties.get("space-color-use-theme")==="none",Q=o.properties.get("space-color").toRenderColor(G?null:P).toArray01PremultipliedAlpha(),W=5e-4,te=s.dh(o.properties.get("horizon-blend"),0,1,W,.25),ee=s.cC(r,p,x)&&te===W?x.worldSize/(2*Math.PI*1.025)-1:x.globeRadius,le=r.frameCounter/1e3%1,pe=s.ab.vec3.length(x.globeCenterInViewSpace),fe=Math.sqrt(Math.pow(pe,2)-Math.pow(ee,2)),Te=Math.acos(fe/pe),_e=xe=>{const ge=x.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];xe&&ge.push("ALPHA_PASS");const Re=r.getOrCreateProgram("globeAtmosphere",{defines:ge}),Fe=((Ke,ht,ut,$e,st,xt,He,ft,at,Mt,_t,dt)=>({u_frustum_tl:Ke,u_frustum_tr:ht,u_frustum_br:ut,u_frustum_bl:$e,u_horizon:st,u_transition:xt,u_fadeout_range:He,u_color:ft,u_high_color:at,u_space_color:Mt,u_temporal_offset:_t,u_horizon_angle:dt}))(x.frustumCorners.TL,x.frustumCorners.TR,x.frustumCorners.BR,x.frustumCorners.BL,x.frustumCorners.horizon,M,te,O,V,Q,le,Te);r.uploadCommonUniforms(p,Re);const rt=this.atmosphereBuffer;rt&&Re.draw(r,_.TRIANGLES,w,Kt.disabled,xe?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,li.backCW,Fe,xe?"atmosphere_glow_alpha":"atmosphere_glow",rt.vertexBuffer,rt.indexBuffer,rt.segments)};_e(!1),_e(!0)}drawStars(r,o){const p=s.aw(o.properties.get("star-intensity"),0,1);if(p===0)return;const _=r.context,x=_.gl,w=r.transform,M=r.getOrCreateProgram("stars"),P=s.ab.quat.identity([]);s.ab.quat.rotateX(P,P,-w._pitch),s.ab.quat.rotateZ(P,P,-w.angle),s.ab.quat.rotateX(P,P,s.ai(w._center.lat)),s.ab.quat.rotateY(P,P,-s.ai(w._center.lng));const z=s.ab.mat4.fromQuat(new Float32Array(16),P),O=s.ab.mat4.multiply([],w.starsProjMatrix,z),B=s.ab.mat3.fromMat4([],z),V=s.ab.mat3.invert([],B),G=[0,1,0];s.ab.vec3.transformMat3(G,G,V),s.ab.vec3.scale(G,G,this.params.sizeMultiplier);const Q=[1,0,0];s.ab.vec3.transformMat3(Q,Q,V),s.ab.vec3.scale(Q,Q,this.params.sizeMultiplier);const W=(te=G,ee=Q,le=p,{u_matrix:Float32Array.from(O),u_up:te,u_right:ee,u_intensity_multiplier:le});var te,ee,le;r.uploadCommonUniforms(_,M),this.starsVx&&this.starsIdx&&M.draw(r,x.TRIANGLES,Ht.disabled,Kt.disabled,this.colorModeAlphaBlendedWriteRGB,li.disabled,W,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function cl(f,r){const o=[...f],p=r.cameraWorldSizeForFog/r.worldSize,_=s.ab.mat4.identity([]);return s.ab.mat4.scale(_,_,[p,p,1]),s.ab.mat4.multiply(o,_,o),s.ab.mat4.multiply(o,r.worldToFogMatrix,o),o}function $u(f,r,o,p,_){const x=o.material,w=p.context,{baseColorTexture:M,metallicRoughnessTexture:P}=x.pbrMetallicRoughness,{normalTexture:z,occlusionTexture:O,emissionTexture:B}=x;function V(Q,W,te){if(Q&&(f.push(W),w.activeTexture.set(w.gl.TEXTURE0+te),Q.gfxTexture)){const{minFilter:ee,magFilter:le,wrapS:pe,wrapT:fe}=Q.sampler;Q.gfxTexture.bindExtraParam(ee,le,pe,fe)}}V(M,"HAS_TEXTURE_u_baseColorTexture",Yr.BaseColor),V(P,"HAS_TEXTURE_u_metallicRoughnessTexture",Yr.MetallicRoughness),V(z,"HAS_TEXTURE_u_normalTexture",Yr.Normal),V(O,"HAS_TEXTURE_u_occlusionTexture",Yr.Occlusion),V(B,"HAS_TEXTURE_u_emissionTexture",Yr.Emission),_&&(_.texture||(_.texture=new s.dk(p.context,_.image,[_.image.height,_.image.height,_.image.height],w.gl.RGBA8)),w.activeTexture.set(w.gl.TEXTURE0+Yr.LUT),_.texture&&_.texture.bind(w.gl.LINEAR,w.gl.CLAMP_TO_EDGE),f.push("APPLY_LUT_ON_GPU")),o.texcoordBuffer&&(f.push("HAS_ATTRIBUTE_a_uv_2f"),r.push(o.texcoordBuffer)),o.colorBuffer&&(f.push(o.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),r.push(o.colorBuffer)),o.normalBuffer&&(f.push("HAS_ATTRIBUTE_a_normal_3f"),r.push(o.normalBuffer)),o.pbrBuffer&&(f.push("HAS_ATTRIBUTE_a_pbr"),f.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),r.push(o.pbrBuffer)),x.alphaMode!=="OPAQUE"&&x.alphaMode!=="MASK"||f.push("UNPREMULT_TEXTURE_IN_SHADER"),x.defined||f.push("DIFFUSE_SHADED");const G=p.shadowRenderer;G&&(f.push("RENDER_SHADOWS","DEPTH_TEXTURE"),G.useNormalOffset&&f.push("NORMAL_OFFSET"))}function ul(f,r,o,p,_,x){const w=o.paint.get("model-opacity").constantOr(1),M=r.context,P=new Ht(r.context.gl.LEQUAL,Ht.ReadWrite,r.depthRangeFor3D),z=r.transform,O=f.mesh,B=O.material,V=B.pbrMetallicRoughness,G=r.style.fog;let Q;Q=r.transform.projection.zAxisUnit==="pixels"?[...f.nodeModelMatrix]:s.ab.mat4.multiply([],p.zScaleMatrix,f.nodeModelMatrix),s.ab.mat4.multiply(Q,p.negCameraPosMatrix,Q);const W=s.ab.mat4.invert([],Q);s.ab.mat4.transpose(W,W);const te=o.paint.get("model-color-use-theme").constantOr("default")==="none",ee=o.paint.get("model-emissive-strength").constantOr(0),le=Sd(new Float32Array(f.worldViewProjection),new Float32Array(Q),new Float32Array(W),null,r,w,V.baseColorFactor.toRenderColor(null),B.emissiveFactor,V.metallicFactor,V.roughnessFactor,B,ee,o),pe={defines:[]},fe=[],Te=r.shadowRenderer;Te&&(Te.useNormalOffset=!1),$u(pe.defines,fe,O,r,te?null:o.lut);let _e=null;if(G){const Re=cl(f.nodeModelMatrix,r.transform);if(_e=new Float32Array(Re),z.projection.name!=="globe"){const Fe=O.aabb.min,rt=O.aabb.max,[Ke,ht]=G.getOpacityForBounds(Re,Fe[0],Fe[1],rt[0],rt[1]);pe.overrideFog=Ke>=ve||ht>=ve}}const xe=Ul(r,o.paint.get("model-cutoff-fade-range"));xe.shouldRenderCutoff&&pe.defines.push("RENDER_CUTOFF");const ge=r.getOrCreateProgram("model",pe);r.uploadCommonUniforms(M,ge,null,_e,xe),r.renderPass!=="shadow"&&Te&&Te.setupShadowsFromMatrix(f.nodeModelMatrix,ge),ge.draw(r,M.gl.TRIANGLES,P,_,x,O.material.doubleSided?li.disabled:li.backCCW,le,o.id,O.vertexBuffer,O.indexBuffer,O.segments,o.paint,r.transform.zoom,void 0,fe)}function hp(f,r,o,p,_,x,w){let M;M=f.projection.name==="globe"?s.dl(o,f):[...o],s.ab.mat4.multiply(M,M,r.matrix);const P=s.ab.mat4.multiply([],p,M);if(r.meshes)for(const z of r.meshes){if(z.material.alphaMode!=="BLEND"){w.push({mesh:z,depth:0,modelIndex:_,worldViewProjection:P,nodeModelMatrix:M});continue}const O=s.ab.vec3.transformMat4([],z.centroid,P);!f.isOrthographic&&O[2]<=0||x.push({mesh:z,depth:O[2],modelIndex:_,worldViewProjection:P,nodeModelMatrix:M})}if(r.children)for(const z of r.children)hp(f,z,o,p,_,x,w)}function Rd(f,r,o,p){const _=o.shadowRenderer;if(!_)return;const x=_.getShadowPassDepthMode(),w=_.getShadowPassColorMode(),M=_.calculateShadowPassMatrixFromMatrix(r),P=rp(M);o.getOrCreateProgram("modelDepth",{defines:o._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(o,o.context.gl.TRIANGLES,x,Kt.disabled,w,li.backCCW,P,p.id,f.vertexBuffer,f.indexBuffer,f.segments,p.paint,o.transform.zoom,void 0,void 0)}function So(f,r,o){const p=r.updateZoomBasedPaintProperties(),_=function(x,w,M){let P,z,O,B=x.terrain?x.terrain.exaggeration():0;if(x.terrain&&B>0){const V=x.terrain,G=V.findDEMTileFor(M);G&&G.dem?P=s.dn.create(V,M,G):B=0}if(B===0&&(w.terrainElevationMin=0,w.terrainElevationMax=0),B===w.validForExaggeration&&(B===0||P&&P._demTile&&P._demTile.tileID===w.validForDEMTile.id&&P._dem._timestamp===w.validForDEMTile.timestamp))return!1;for(const V in w.instancesPerModel){const G=w.instancesPerModel[V];for(let Q=0;Q<G.instancedDataArray.length;++Q){const W=(P?B*P.getElevationAt(0|G.instancedDataArray.float32[16*Q],0|G.instancedDataArray.float32[16*Q+1],!0,!0):0)+G.instancesEvaluatedElevation[Q];G.instancedDataArray.float32[16*Q+6]=W,z=z?Math.min(w.terrainElevationMin,W):W,O=O?Math.max(w.terrainElevationMax,W):W}}return w.terrainElevationMin=z||0,w.terrainElevationMax=O||0,w.validForExaggeration=B,w.validForDEMTile=P&&P._demTile?{id:P._demTile.tileID,timestamp:P._dem._timestamp}:{id:void 0,timestamp:0},!0}(f,r,o);(p||_)&&(r.uploaded=!1,r.upload(f.context))}const us={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new s.cd([0,0,0],[s.ag,s.ag,0])};function dp(f,r){const o=1<<f.canonical.z,p=r.getFreeCameraOptions().position,_=r.elevation,x=f.canonical.x/o,w=(f.canonical.x+1)/o,M=f.canonical.y/o,P=(f.canonical.y+1)/o;let z=r._centerAltitude;if(_){const G=_.getMinMaxForTile(f);G&&G.max>z&&(z=G.max)}const O=s.aw(p.x,x,w)-p.x,B=s.aw(p.y,M,P)-p.y,V=s.bH(z,r.center.lat)-p.z;return r._zoomFromMercatorZ(Math.sqrt(O*O+B*B+V*V))}function Dd(f,r,o,p,_,x,w){const M=f.context,P=f.renderPass==="shadow",z=f.shadowRenderer,O=P&&z?z.getShadowPassDepthMode():new Ht(M.gl.LEQUAL,Ht.ReadWrite,f.depthRangeFor3D),B=f.isTileAffectedByFog(x);if(o.meshes)for(const V of o.meshes){const G=["MODEL_POSITION_ON_GPU"],Q=[];let W,te,ee;p.instancedDataArray.length>20&&G.push("INSTANCED_ARRAYS");const le=Ul(f,r.paint.get("model-cutoff-fade-range"));if(le.shouldRenderCutoff&&G.push("RENDER_CUTOFF"),P&&z)W=f.getOrCreateProgram("modelDepth",{defines:G}),te=rp(w.shadowTileMatrix,w.shadowTileMatrix,Float32Array.from(o.matrix)),ee=z.getShadowPassColorMode();else{$u(G,Q,V,f,r.paint.get("model-color-use-theme").constantOr("default")==="none"?null:r.lut),W=f.getOrCreateProgram("model",{defines:G,overrideFog:B});const fe=V.material,Te=fe.pbrMetallicRoughness,_e=r.paint.get("model-opacity").constantOr(1),xe=r.paint.get("model-emissive-strength").constantOr(0);te=Sd(x.expandedProjMatrix,Float32Array.from(o.matrix),new Float32Array(16),null,f,_e,Te.baseColorFactor.toRenderColor(null),fe.emissiveFactor,Te.metallicFactor,Te.roughnessFactor,fe,xe,r,_),z&&(w.shadowUniformsInitialized?W.setShadowUniformValues(M,z.getShadowUniformValues()):(z.setupShadows(x.toUnwrapped(),W,"model-tile",x.overscaledZ),w.shadowUniformsInitialized=!0)),ee=le.shouldRenderCutoff||_e<1||fe.alphaMode!=="OPAQUE"?ni.alphaBlended:ni.unblended}f.uploadCommonUniforms(M,W,x.toUnwrapped(),null,le);const pe=V.material.doubleSided?li.disabled:li.backCCW;if(p.instancedDataArray.length>20)Q.push(p.instancedDataBuffer),W.draw(f,M.gl.TRIANGLES,O,Kt.disabled,ee,pe,te,r.id,V.vertexBuffer,V.indexBuffer,V.segments,r.paint,f.transform.zoom,void 0,Q,p.instancedDataArray.length);else{const fe=P?"u_instance":"u_normal_matrix";for(let Te=0;Te<p.instancedDataArray.length;++Te)te[fe]=new Float32Array(p.instancedDataArray.arrayBuffer,64*Te,16),W.draw(f,M.gl.TRIANGLES,O,Kt.disabled,ee,pe,te,r.id,V.vertexBuffer,V.indexBuffer,V.segments,r.paint,f.transform.zoom,void 0,Q)}}if(o.children)for(const V of o.children)Dd(f,r,V,p,_,x,w)}const Vg=[1,-1,1];function Ug(f,r,o,p){if(!o.modelManager)return!0;const _=o.modelManager;if(!o.shadowRenderer)return!0;const x=o.shadowRenderer,w=r.aabb;let M=!0,P=f.maxHeight;if(P===0){let O=0;for(const B in f.instancesPerModel){const V=_.getModel(B,p);V?O=Math.max(O,Math.max(Math.max(V.aabb.max[0],V.aabb.max[1]),V.aabb.max[2])):M=!1}P=f.maxScale*O*1.41+f.maxVerticalOffset,M&&(f.maxHeight=P)}w.max[2]=P,w.min[2]+=f.terrainElevationMin,w.max[2]+=f.terrainElevationMax,s.ab.vec3.transformMat4(w.min,w.min,r.tileMatrix),s.ab.vec3.transformMat4(w.max,w.max,r.tileMatrix);const z=w.intersects(x.getCurrentCascadeFrustum());return o.currentShadowCascade===0&&(f.isInsideFirstShadowMapFrustum=z===2),z===0}function Nc(f,r){const o=f.uniformValues.u_cutoff_params[0],p=f.uniformValues.u_cutoff_params[1],_=f.uniformValues.u_cutoff_params[2],x=f.uniformValues.u_cutoff_params[3];return p===o||x===_?1:s.aw(((r-o)/(p-o)-_)/(x-_),0,1)}function jg(f,r,o,p){if(r.pitch<20)return 1;const _=r.getWorldToCameraMatrix();s.ab.mat4.multiply(_,_,f);const x=s.ab.vec4.fromValues(o.min[0],o.min[1],o.min[2],1);let w=s.ab.vec4.transformMat4(s.ab.vec4.create(),x,_),M=w,P=w;x[1]=o.max[1],w=s.ab.vec4.transformMat4(s.ab.vec4.create(),x,_),M=w[1]<M[1]?w:M,P=w[1]>P[1]?w:P,x[0]=o.max[0],w=s.ab.vec4.transformMat4(s.ab.vec4.create(),x,_),M=w[1]<M[1]?w:M,P=w[1]>P[1]?w:P,x[1]=o.min[1],w=s.ab.vec4.transformMat4(s.ab.vec4.create(),x,_),M=w[1]<M[1]?w:M,P=w[1]>P[1]?w:P;const z=s.aw(p[0],0,1),O=100*r.pixelsPerMeter*s.aw(p[1],0,1),B=s.aw(p[2],0,1),V=s.ab.vec4.lerp(s.ab.vec4.create(),M,P,z),G=Math.tan(.5*r.fovX),Q=-V[2]*G;if(O===0)return V[1]<-Math.abs(Q)?B:1;const W=(-Math.abs(Q)-V[1])/O,te=(le,pe,fe)=>(1-fe)*le+fe*pe,ee=s.aw(te(1,B,W),B,1);return te(1,ee,s.aw((r.pitch-20)/20,0,1))}class Zl{}class qg{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(r,o,p){{const B=this._storage.get(o.id);if(B)return B.lastUsedFrameIdx=r,B.buf}const _=p.gl,x=_.getBufferParameter(_.ELEMENT_ARRAY_BUFFER,_.BUFFER_SIZE),w=new ArrayBuffer(x),M=new Int16Array(w);_.getBufferSubData(_.ELEMENT_ARRAY_BUFFER,0,new Int16Array(w));const P=new s.dq;for(let B=0;B<x/2;B+=3){const V=M[B],G=M[B+1],Q=M[B+2];P.emplaceBack(V,G),P.emplaceBack(G,Q),P.emplaceBack(Q,V)}const z=p.bindVertexArrayOES.current,O=new Zl;return O.buf=new To(p,P),O.lastUsedFrameIdx=r,this._storage.set(o.id,O),p.bindVertexArrayOES.set(z),O.buf}update(r){for(const[o,p]of this._storage)r-p.lastUsedFrameIdx>30&&(p.buf.destroy(),this._storage.delete(o))}destroy(){for(const[r,o]of this._storage)o.buf.destroy(),this._storage.delete(r)}}class fp{constructor(r){this.occluderSize=30,this.depthOffset=-1e-4,r.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),r.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const Gg=s.da([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class Hg{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class Gr{constructor(r,o){this.revealStart=11,this.revealRange=2,r.registerParameter(this,[...o,"Reveal"],"revealStart",{min:0,max:17,step:.05}),r.registerParameter(this,[...o,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const $g=s.da([{type:"Float32",name:"a_pos_2f",components:2}]);class Zg{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(r,o){const p=r.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const w=new s.dr,M=new s.aU;w.emplaceBack(-1,-1),w.emplaceBack(1,-1),w.emplaceBack(1,1),w.emplaceBack(-1,1),M.emplaceBack(0,1,2),M.emplaceBack(0,2,3),this.vignetteVx=r.context.createVertexBuffer(w,$g.members),this.vignetteIdx=r.context.createIndexBuffer(M)}const _=s.b7.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){r.uploadCommonUniforms(r.context,p);const w={u_vignetteShape:(x={vignetteShape:[o.start,o.range,Math.pow(10,o.fadePower)],vignetteColor:[o.color.r,o.color.g,o.color.b,o.color.a*o.strength]}).vignetteShape,u_vignetteColor:x.vignetteColor};p.draw(r,r.context.gl.TRIANGLES,Ht.disabled,Kt.disabled,ni.alphaBlended,li.disabled,w,"vignette",this.vignetteVx,this.vignetteIdx,_,{})}var x}}class Pd{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(r,o){const p=r.getFreeCameraOptions().position,_=p.toAltitude(),x=p.toLngLat(),w=s.ai(x.lng),M=s.ai(x.lat),P=r.pixelsPerMeter/o,z=w*s.ds,O=s.ds*Math.log(Math.tan(Math.PI/4+M/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const B=-this._offsetYPrev+O,V=-this._elevationPrev+_;this._accumulatedOffsetX+=(-this._offsetXPrev+z)*P,this._accumulatedOffsetY+=B*P,this._accumulatedElevation+=V*P,this._offsetXPrev=z,this._offsetYPrev=O,this._elevationPrev=_}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function Wl(f,r){return[-(f[0]-Math.floor(f[0]/r)*r),-(f[1]-Math.floor(f[1]/r)*r),-(f[2]-Math.floor(f[2]/r)*r)]}function pp(f){const r=s.di(1323123451230),o=[];for(let p=0;p<f;++p){const _=2*r()-1,x=2*r()-1,w=2*r()-1;o.push(s.ab.vec3.fromValues(_,x,w))}return o}function Ao(f,r,o,p,_){const x=s.aw((_-o)/(p-o),0,1);return(1-x)*f+x*r}class mp{constructor(r){this._movement=new Pd,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Zg,this._ppmScaleFactor=r}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(r,o){const p=r.transform;this._movement.update(p,this._ppmScaleFactor);const _=p.starsProjMatrix,x=s.ab.quat.identity([]);s.ab.quat.rotateX(x,x,s.ai(90)-p._pitch),s.ab.quat.rotateZ(x,x,-p.angle);const w=s.ab.mat4.fromQuat(new Float32Array(16),x),M=s.ab.mat4.fromValues(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),P=s.ab.mat4.transpose([],M),z=s.ab.mat4.multiply([],P,w),O=Date.now()/1e3;return this._accumulatedTimeFromStart+=(O-this._prevTime)*o,this._prevTime=O,{projectionMatrix:_,modelviewMatrix:z}}}class Zu extends mp{constructor(r){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Gr(r.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(r){const o=r.context;if(!this.particlesVx){const p=pp(this.particlesCount),_=new s.dt,x=new s.aU;let w=0;const M=s.di(1323123451230);for(let P=0;P<p.length;++P){const z=p[P],O=[2*M()-1,M(),M(),M()];_.emplaceBack(z[0],z[1],z[2],-1,-1,...O),_.emplaceBack(z[0],z[1],z[2],1,-1,...O),_.emplaceBack(z[0],z[1],z[2],1,1,...O),_.emplaceBack(z[0],z[1],z[2],-1,1,...O),x.emplaceBack(w+0,w+1,w+2),x.emplaceBack(w+0,w+2,w+3),w+=4}this.particlesVx=o.createVertexBuffer(_,Gg.members),this.particlesIdx=o.createIndexBuffer(x)}}draw(r){if(!this._params.overrideStyleParameters&&!r.style.rain)return;const o=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},p=r.transform.zoom;if(o.revealStart>p)return;const _=Ao(0,1,o.revealStart,o.revealStart+o.revealRange,p);if(!this.particlesVx||!this.particlesIdx)return;const x=structuredClone(this._params);let w=[-x.direction.x,x.direction.y,-100];s.ab.vec3.normalize(w,w);const M=structuredClone(this._vignetteParams);M.strength*=_,x.overrideStyleParameters||(x.intensity=r.style.rain.state.density,x.timeFactor=r.style.rain.state.intensity,x.color=structuredClone(r.style.rain.state.color),w=structuredClone(r.style.rain.state.direction),x.screenThinning.intensity=r.style.rain.state.centerThinning,x.dropletSizeX=r.style.rain.state.dropletSize[0],x.dropletSizeYScale=r.style.rain.state.dropletSize[1]/r.style.rain.state.dropletSize[0],x.distortionStrength=100*r.style.rain.state.distortionStrength,M.strength=1,M.color=structuredClone(r.style.rain.state.vignetteColor));const P=this.updateOnRender(r,x.timeFactor),z=r.context,O=z.gl,B=r.transform;this.screenTexture&&this.screenTexture.size[0]===r.width&&this.screenTexture.size[1]===r.height||(this.screenTexture=new s.T(z,{width:r.width,height:r.height,data:null},O.RGBA8)),x.distortionStrength>0&&(z.activeTexture.set(O.TEXTURE0),this.screenTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),O.copyTexSubImage2D(O.TEXTURE_2D,0,0,0,0,0,r.width,r.height));const V=r.getOrCreateProgram("rainParticle");r.uploadCommonUniforms(z,V),z.activeTexture.set(O.TEXTURE0),this.screenTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE);const G=[x.color.r,x.color.g,x.color.b,x.color.a],Q=(W,te)=>{const ee=Wl(this._movement.getPosition(),W),le=x.dropletSizeX,pe=x.dropletSizeX*x.dropletSizeYScale,fe=r.width/2,Te=r.height/2,_e=Ao(0,x.screenThinning.start,0,1,x.screenThinning.intensity),xe=Ao(.001,x.screenThinning.range,0,1,x.screenThinning.intensity),ge=Ao(0,x.screenThinning.particleOffset,0,1,x.screenThinning.intensity),Re=(Fe={modelview:P.modelviewMatrix,projection:P.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ee,velocityConeAperture:x.velocityConeAperture,velocity:x.velocity,boxSize:W,rainDropletSize:[le,pe],distortionStrength:x.distortionStrength,rainDirection:w,color:G,screenSize:[B.width,B.height],thinningCenterPos:[fe,Te],thinningShape:[_e,xe,Math.pow(10,x.screenThinning.fadePower)],thinningAffectedRatio:x.screenThinning.affectedRatio,thinningParticleOffset:ge,shapeDirectionalPower:x.shapeDirPower,shapeNormalPower:x.shapeNormalPower,mode:te?0:1},{u_modelview:Float32Array.from(Fe.modelview),u_projection:Float32Array.from(Fe.projection),u_time:Fe.time,u_cam_pos:Fe.camPos,u_texScreen:0,u_velocityConeAperture:Fe.velocityConeAperture,u_velocity:Fe.velocity,u_boxSize:Fe.boxSize,u_rainDropletSize:Fe.rainDropletSize,u_distortionStrength:Fe.distortionStrength,u_rainDirection:Fe.rainDirection,u_color:Fe.color,u_screenSize:Fe.screenSize,u_thinningCenterPos:Fe.thinningCenterPos,u_thinningShape:Fe.thinningShape,u_thinningAffectedRatio:Fe.thinningAffectedRatio,u_thinningParticleOffset:Fe.thinningParticleOffset,u_shapeDirectionalPower:Fe.shapeDirectionalPower,u_shapeNormalPower:Fe.shapeNormalPower,u_mode:Fe.mode});var Fe;const rt=Math.round(x.intensity*this.particlesCount),Ke=s.b7.simpleSegment(0,0,4*rt,2*rt);V.draw(r,O.TRIANGLES,Ht.disabled,Kt.disabled,ni.alphaBlended,li.disabled,Re,"rain_particles",this.particlesVx,this.particlesIdx,Ke,{})};x.distortionStrength>0&&Q(x.boxSize,!0),Q(x.boxSize,!1),this._vignette.draw(r,M)}}const Wg=s.da([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Xg extends mp{constructor(r){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Gr(r.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(r){const o=r.context;if(!this.particlesVx){const p=pp(this.particlesCount),_=new s.du,x=new s.aU;let w=0;const M=s.di(1323123451230);for(let P=0;P<p.length;++P){const z=p[P],O=M(),B=M(),V=M(),G=[P/p.length,O,B,V],Q=[M(),M()];_.emplaceBack(z[0],z[1],z[2],-1,-1,...G,...Q),_.emplaceBack(z[0],z[1],z[2],1,-1,...G,...Q),_.emplaceBack(z[0],z[1],z[2],1,1,...G,...Q),_.emplaceBack(z[0],z[1],z[2],-1,1,...G,...Q),x.emplaceBack(w+0,w+1,w+2),x.emplaceBack(w+0,w+2,w+3),w+=4}this.particlesVx=o.createVertexBuffer(_,Wg.members),this.particlesIdx=o.createIndexBuffer(x)}}draw(r){if(!this._params.overrideStyleParameters&&!r.style.snow)return;const o=structuredClone(this._params);let p=[-o.direction.x,o.direction.y,-100];s.ab.vec3.normalize(p,p);const _=structuredClone(this._vignetteParams),x=o.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},w=r.transform.zoom;if(x.revealStart>w)return;const M=Ao(0,1,x.revealStart,x.revealStart+x.revealRange,w);_.strength*=M,o.overrideStyleParameters||(o.intensity=r.style.snow.state.density,o.timeFactor=r.style.snow.state.intensity,o.color=structuredClone(r.style.snow.state.color),p=structuredClone(r.style.snow.state.direction),o.screenThinning.intensity=r.style.snow.state.centerThinning,o.billboardSize=2.79*r.style.snow.state.flakeSize,_.strength=1,_.color=structuredClone(r.style.snow.state.vignetteColor));const P=this.updateOnRender(r,o.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const z=r.context,O=z.gl,B=r.transform,V=r.getOrCreateProgram("snowParticle");r.uploadCommonUniforms(z,V),((G,Q,W)=>{const te=Wl(this._movement.getPosition(),G),ee=B.width/2,le=B.height/2,pe=Ao(0,W.screenThinning.start,0,1,W.screenThinning.intensity),fe=Ao(.001,W.screenThinning.range,0,1,W.screenThinning.intensity),Te=Ao(0,W.screenThinning.particleOffset,0,1,W.screenThinning.intensity),_e=(xe={modelview:P.modelviewMatrix,projection:P.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:te,velocityConeAperture:W.velocityConeAperture,velocity:W.velocity,horizontalOscillationRadius:W.horizontalOscillationRadius,horizontalOscillationRate:W.horizontalOscillationRate,boxSize:G,billboardSize:1*W.billboardSize,simpleShapeParameters:[W.shapeFadeStart,W.shapeFadePower],screenSize:[B.width,B.height],thinningCenterPos:[ee,le],thinningShape:[pe,fe,Math.pow(10,W.screenThinning.fadePower)],thinningAffectedRatio:W.screenThinning.affectedRatio,thinningParticleOffset:Te,color:[W.color.r,W.color.g,W.color.b,W.color.a],direction:p},{u_modelview:Float32Array.from(xe.modelview),u_projection:Float32Array.from(xe.projection),u_time:xe.time,u_cam_pos:xe.camPos,u_velocityConeAperture:xe.velocityConeAperture,u_velocity:xe.velocity,u_horizontalOscillationRadius:xe.horizontalOscillationRadius,u_horizontalOscillationRate:xe.horizontalOscillationRate,u_boxSize:xe.boxSize,u_billboardSize:xe.billboardSize,u_simpleShapeParameters:xe.simpleShapeParameters,u_screenSize:xe.screenSize,u_thinningCenterPos:xe.thinningCenterPos,u_thinningShape:xe.thinningShape,u_thinningAffectedRatio:xe.thinningAffectedRatio,u_thinningParticleOffset:xe.thinningParticleOffset,u_particleColor:xe.color,u_direction:xe.direction});var xe;const ge=Math.round(W.intensity*this.particlesCount),Re=s.b7.simpleSegment(0,0,4*ge,2*ge);this.particlesVx&&this.particlesIdx&&V.draw(r,O.TRIANGLES,Ht.disabled,Kt.disabled,ni.alphaBlended,li.disabled,_e,"snow_particles",this.particlesVx,this.particlesIdx,Re,{})})(o.boxSize,0,o),this._vignette.draw(r,_)}}const Ld={symbol:function(f,r,o,p,_){if(f.renderPass!=="translucent")return;const x=Kt.disabled,w=f.colorModeForRenderPass(),M=o.layout.get("text-variable-anchor"),P=o.layout.get("text-size-scale-range"),z=s.aw(f.scaleFactor,P[0],P[1]);M&&function(V,G,Q,W,te,ee,le,pe){const fe=G.transform,Te=te==="map",_e=ee==="map";for(const xe of V){const ge=W.getTile(xe),Re=ge.getBucket(Q);if(!Re||!Re.text||!Re.text.segments.get().length)continue;const Fe=s.bp(Re.textSizeData,fe.zoom,pe),rt=al(xe,Re.getProjection(),fe),Ke=fe.calculatePixelsToTileUnitsMatrix(ge),ht=xr(rt,ge.tileID.canonical,_e,Te,fe,Re.getProjection(),Ke),ut=Re.hasIconTextFit()&&Re.hasIconData();if(Fe){const $e=Math.pow(2,fe.zoom-ge.tileID.overscaledZ);ap(Re,Te,_e,le,s.cX,fe,ht,xe,$e,Fe,ut)}}}(p,f,o,r,o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),_,z);const O=o.paint.get("icon-opacity").constantOr(1)!==0,B=o.paint.get("text-opacity").constantOr(1)!==0;o.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(O||B)?Id(f,r,o,p,x,w):(O&&Id(f,r,o,p,x,w,{onlyIcons:!0}),B&&Id(f,r,o,p,x,w,{onlyText:!0})),r.map.showCollisionBoxes&&(sp(f,r,o,p,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),!0),sp(f,r,o,p,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),!1))},circle:function(f,r,o,p){if(f.renderPass!=="translucent")return;const _=o.paint.get("circle-opacity"),x=o.paint.get("circle-stroke-width"),w=o.paint.get("circle-stroke-opacity"),M=o.layout.get("circle-sort-key").constantOr(1)!==void 0,P=o.paint.get("circle-emissive-strength");if(_.constantOr(1)===0&&(x.constantOr(1)===0||w.constantOr(1)===0))return;const z=f.context,O=z.gl,B=f.transform,V=f.depthModeForSublayer(0,Ht.ReadOnly),G=Kt.disabled,Q=f.colorModeForDrapableLayerRenderPass(P),W=B.projection.name==="globe",te=[s.at(B.center.lng),s.aA(B.center.lat)],ee=[];for(let pe=0;pe<p.length;pe++){const fe=p[pe],Te=r.getTile(fe),_e=Te.getBucket(o);if(!_e||_e.projection.name!==B.projection.name)continue;const xe=_e.programConfigurations.get(o.id),ge=s.cY(o),Re=f.isTileAffectedByFog(fe);W&&ge.push("PROJECTION_GLOBE_VIEW"),ge.push("DEPTH_D24"),f.terrain&&B.depthOcclusionForSymbolsAndCircles&&ge.push("DEPTH_OCCLUSION");const Fe=f.getOrCreateProgram("circle",{config:xe,defines:ge,overrideFog:Re}),rt=_e.layoutVertexBuffer,Ke=_e.globeExtVertexBuffer,ht=_e.indexBuffer,ut=B.projection.createInversionMatrix(B,fe.canonical),$e={programConfiguration:xe,program:Fe,layoutVertexBuffer:rt,globeExtVertexBuffer:Ke,indexBuffer:ht,uniformValues:s.cZ(f,fe,Te,ut,te,o),tile:Te};if(M){const st=_e.segments.get();for(const xt of st)ee.push({segments:new s.b7([xt]),sortKey:xt.sortKey,state:$e})}else ee.push({segments:_e.segments,sortKey:0,state:$e})}M&&ee.sort((pe,fe)=>pe.sortKey-fe.sortKey);const le={useDepthForOcclusion:B.depthOcclusionForSymbolsAndCircles};for(const pe of ee){const{programConfiguration:fe,program:Te,layoutVertexBuffer:_e,globeExtVertexBuffer:xe,indexBuffer:ge,uniformValues:Re,tile:Fe}=pe.state,rt=pe.segments;f.terrain&&f.terrain.setupElevationDraw(Fe,Te,le),f.uploadCommonUniforms(z,Te,Fe.tileID.toUnwrapped()),Te.draw(f,O.TRIANGLES,V,G,Q,li.disabled,Re,o.id,_e,ge,rt,o.paint,B.zoom,fe,[xe])}},heatmap:function(f,r,o,p){if(o.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){const _=f.context,x=_.gl,w=Kt.disabled,M=new ni([x.ONE,x.ONE,x.ONE,x.ONE],s.aj.transparent,[!0,!0,!0,!0]);(function(G,Q,W,te){const ee=G.gl,le=Q.width*te,pe=Q.height*te;G.activeTexture.set(ee.TEXTURE1),G.viewport.set([0,0,le,pe]);let fe=W.heatmapFbo;if(!fe||fe&&(fe.width!==le||fe.height!==pe)){fe&&fe.destroy();const Te=ee.createTexture();ee.bindTexture(ee.TEXTURE_2D,Te),ee.texParameteri(ee.TEXTURE_2D,ee.TEXTURE_WRAP_S,ee.CLAMP_TO_EDGE),ee.texParameteri(ee.TEXTURE_2D,ee.TEXTURE_WRAP_T,ee.CLAMP_TO_EDGE),ee.texParameteri(ee.TEXTURE_2D,ee.TEXTURE_MIN_FILTER,ee.LINEAR),ee.texParameteri(ee.TEXTURE_2D,ee.TEXTURE_MAG_FILTER,ee.LINEAR),fe=W.heatmapFbo=G.createFramebuffer(le,pe,!0,null),function(_e,xe,ge,Re,Fe,rt){const Ke=_e.gl;Ke.texImage2D(Ke.TEXTURE_2D,0,_e.extRenderToTextureHalfFloat?Ke.RGBA16F:Ke.RGBA,Fe,rt,0,Ke.RGBA,_e.extRenderToTextureHalfFloat?Ke.HALF_FLOAT:Ke.UNSIGNED_BYTE,null),Re.colorAttachment.set(ge)}(G,0,Te,fe,le,pe)}else ee.bindTexture(ee.TEXTURE_2D,fe.colorAttachment.get()),G.bindFramebuffer.set(fe.framebuffer)})(_,f,o,f.transform.projection.name==="globe"?.5:.25),_.clear({color:s.aj.transparent});const P=f.transform,z=P.projection.name==="globe",O=z?["PROJECTION_GLOBE_VIEW"]:[],B=z?li.frontCCW:li.disabled,V=[s.at(P.center.lng),s.aA(P.center.lat)];for(let G=0;G<p.length;G++){const Q=p[G];if(r.hasRenderableParent(Q))continue;const W=r.getTile(Q),te=W.getBucket(o);if(!te||te.projection.name!==P.projection.name)continue;const ee=f.isTileAffectedByFog(Q),le=te.programConfigurations.get(o.id),pe=f.getOrCreateProgram("heatmap",{config:le,defines:O,overrideFog:ee}),{zoom:fe}=f.transform;f.terrain&&f.terrain.setupElevationDraw(W,pe),f.uploadCommonUniforms(_,pe,Q.toUnwrapped());const Te=P.projection.createInversionMatrix(P,Q.canonical);pe.draw(f,x.TRIANGLES,Ht.disabled,w,M,B,Gt(f,Q,W,Te,V,fe,o.paint.get("heatmap-intensity")),o.id,te.layoutVertexBuffer,te.indexBuffer,te.segments,o.paint,f.transform.zoom,le,z?[te.globeExtVertexBuffer]:null)}_.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),function(_,x){const w=_.context,M=w.gl,P=x.heatmapFbo;if(!P)return;w.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,P.colorAttachment.get()),w.activeTexture.set(M.TEXTURE1);let z=x.colorRampTexture;z||(z=x.colorRampTexture=new s.T(w,x.colorRamp,M.RGBA8)),z.bind(M.LINEAR,M.CLAMP_TO_EDGE),_.getOrCreateProgram("heatmapTexture").draw(_,M.TRIANGLES,Ht.disabled,Kt.disabled,_.colorModeForRenderPass(),li.disabled,((O,B,V,G)=>({u_image:0,u_color_ramp:1,u_opacity:B.paint.get("heatmap-opacity")}))(0,x),x.id,_.viewportBuffer,_.quadTriangleIndexBuffer,_.viewportSegments,x.paint,_.transform.zoom)}(f,o))},line:function(f,r,o,p){if(f.renderPass!=="translucent")return;const _=o.paint.get("line-opacity"),x=o.paint.get("line-width");if(_.constantOr(1)===0||x.constantOr(1)===0)return;const w=o.paint.get("line-emissive-strength"),M=o.paint.get("line-occlusion-opacity"),P=o.layout.get("line-elevation-reference"),z=o.layout.get("line-width-unit")==="meters",O=P==="sea",B=f.context,V=B.gl;if(o.hasElevatedBuckets&&f.transform.projection.name==="globe")return;const G=o.layout.get("line-cross-slope"),Q=G!==void 0,W=G<1,te=f.colorModeForDrapableLayerRenderPass(w),ee=f.terrain&&f.terrain.renderingToTexture,le=ee?1:s.q.devicePixelRatio,pe=o.paint.get("line-dasharray"),fe=pe.constantOr(1),Te=o.layout.get("line-cap"),_e=pe.constantOr(null),xe=Te.constantOr(null),ge=o.paint.get("line-pattern"),Re=ge.constantOr(1),Fe=ge.constantOr(null),rt=o.paint.get("line-opacity").constantOr(1);let Ke=!Re&&rt!==1||f.depthOcclusion&&M>0&&M<1;const ht=o.paint.get("line-gradient"),ut=Re?"linePattern":"line",$e=s.c_(o);let st;if(ee&&f.terrain&&f.terrain.clipOrMaskOverlapStencilType()&&(Ke=!1),M!==0&&f.depthOcclusion){const He=o.paint._values["line-opacity"];He&&He.value&&He.value.kind==="constant"?st=He.value:s.w(`Occlusion opacity for layer ${o.id} is supported only when line-opacity isn't data-driven.`)}x.value.kind!=="constant"&&x.value.isLineProgressConstant===!1&&$e.push("VARIABLE_LINE_WIDTH");const xt=(He,ft,at,Mt,_t)=>{for(const dt of He){const bt=r.getTile(dt);if(Re&&!bt.patternsLoaded())continue;const It=bt.getBucket(o);if(!It||It.hasZOffset&&!_t||!It.hasZOffset&&_t)continue;f.prepareDrawTile();const Ot=It.programConfigurations.get(o.id),jt=f.isTileAffectedByFog(dt),ui=f.getOrCreateProgram(ut,{config:Ot,defines:ft,overrideFog:jt,overrideRtt:!_t&&void 0});if(Fe&&bt.imageAtlas){const _i=s.A.from(Fe).getPrimary().scaleSelf(le).serialize(),ji=bt.imageAtlas.patternPositions[_i];ji&&Ot.setConstantPatternPositions(ji)}if(!Re&&_e&&xe&&bt.lineAtlas){const _i=bt.lineAtlas.getDash(_e,xe);_i&&Ot.setConstantPatternPositions(_i)}let[ti,ri]=o.paint.get("line-trim-offset");(xe==="round"||xe==="square")&&ti!==ri&&(ti===0&&(ti-=1),ri===1&&(ri+=1));const fi=ee?dt.projMatrix:null,ki=z?1/It.tileToMeter/s.ar(bt,1,f.transform.zoom):1,en=z?1/It.tileToMeter/s.ar(bt,1,Math.floor(f.transform.zoom)):1,Bn=Re?s.c$(f,bt,o,fi,le,ki,en,[ti,ri]):s.d0(f,bt,o,fi,It.lineClipsArray.length,le,ki,en,[ti,ri]);if(ht){const _i=It.gradients[o.id];let ji=_i.texture;if(o.gradientVersion!==_i.version){let Xt=256;if(o.stepInterpolant){const Di=r.getSource().maxzoom,Zi=dt.canonical.z===Di?Math.ceil(1<<f.transform.maxZoom-dt.canonical.z):1;Xt=s.aw(s.d1(It.maxLineLength/s.ag*1024*Zi),256,B.maxTextureSize)}_i.gradient=s.d2({expression:o.gradientExpression(),evaluationKey:"lineProgress",resolution:Xt,image:_i.gradient||void 0,clips:It.lineClipsArray}),_i.texture?_i.texture.update(_i.gradient):_i.texture=new s.T(B,_i.gradient,V.RGBA8),_i.version=o.gradientVersion,ji=_i.texture}B.activeTexture.set(V.TEXTURE1),ji.bind(o.stepInterpolant?V.NEAREST:V.LINEAR,V.CLAMP_TO_EDGE)}fe&&(B.activeTexture.set(V.TEXTURE0),bt.lineAtlasTexture&&bt.lineAtlasTexture.bind(V.LINEAR,V.REPEAT),Ot.updatePaintBuffers()),Re&&(B.activeTexture.set(V.TEXTURE0),bt.imageAtlasTexture&&bt.imageAtlasTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),Ot.updatePaintBuffers()),_t&&!O&&f.terrain.setupElevationDraw(bt,ui),f.uploadCommonUniforms(B,ui,dt.toUnwrapped());const bn=_i=>{st!=null&&(st.value=rt*M),ui.draw(f,V.TRIANGLES,at,_i,te,li.disabled,Bn,o.id,It.layoutVertexBuffer,It.indexBuffer,It.segments,o.paint,f.transform.zoom,Ot,[It.layoutVertexBuffer2,It.patternVertexBuffer,It.zOffsetVertexBuffer]),st!=null&&(st.value=rt)};if(Ke&&!_t){const _i=f.stencilModeForClipping(dt).ref;_i===0&&ee&&B.clear({stencil:0});const ji={func:V.EQUAL,mask:255};Bn.u_alpha_discard_threshold=.8,bn(new Kt(ji,_i,255,V.KEEP,V.KEEP,V.INVERT)),Bn.u_alpha_discard_threshold=0,bn(new Kt(ji,_i,255,V.KEEP,V.KEEP,V.KEEP))}else Ke&&_t&&(Bn.u_alpha_discard_threshold=.001),bn(_t?Mt:f.stencilModeForClipping(dt))}};if(o.hasNonElevatedBuckets){const He=!ee&&f.terrain;M!==0&&He?s.w(`Occlusion opacity for layer ${o.id} is supported on terrain only if the layer has line-z-offset enabled.`):He?s.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${o.id}.`):xt(p,$e,f.depthModeForSublayer(0,Ht.ReadOnly),Kt.disabled,!1)}if(o.hasElevatedBuckets){$e.push("ELEVATED"),Q&&$e.push(W?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),O&&$e.push("ELEVATION_REFERENCE_SEA");const He=Ke?f.stencilModeFor3D():Kt.disabled,ft=new Ht(f.depthOcclusion?V.GREATER:V.LEQUAL,Ht.ReadOnly,f.depthRangeFor3D);f.forceTerrainMode=!0,xt(p,$e,ft,He,!0),f.forceTerrainMode=!1}Ke&&(f.resetStencilClippingMasks(),ee&&B.clear({stencil:0})),M===0||f.depthOcclusion||ee||f.layersWithOcclusionOpacity.push(f.currentLayer)},fill:function(f,r,o,p){const _=o.paint.get("fill-color"),x=o.paint.get("fill-opacity"),w=o.is3D(),M=new Ht(f.context.gl.LEQUAL,Ht.ReadWrite,f.depthRangeFor3D);if(x.constantOr(1)===0)return;const P=o.paint.get("fill-emissive-strength"),z=f.colorModeForDrapableLayerRenderPass(P),O=o.paint.get("fill-pattern"),B=f.opaquePassEnabledForLayer()&&!O.constantOr(1)&&_.constantOr(s.aj.transparent).a===1&&x.constantOr(0)===1?"opaque":"translucent";if(f.renderPass===B){const V=w?M:f.depthModeForSublayer(1,f.renderPass==="opaque"?Ht.ReadWrite:Ht.ReadOnly);kg(f,r,o,p,V,z,!1)}if(!w&&f.renderPass==="translucent"&&o.paint.get("fill-antialias")){const V=w?M:f.depthModeForSublayer(o.getPaintProperty("fill-outline-color")?2:0,Ht.ReadOnly);kg(f,r,o,p,V,z,!0)}},"fill-extrusion":function(f,r,o,p){const _=o.paint.get("fill-extrusion-opacity"),x=f.context,w=x.gl,M=f.terrain,P=M&&M.renderingToTexture;if(_===0)return;const z=f.conflationActive&&f.style.isLayerClipped(o,r.getSource()),O=f.style.order.indexOf(o.fqid);if(z&&function(B,V,G,Q,W){for(const te of Q){const ee=V.getTile(te).getBucket(G);ee&&(ee.updateReplacement(te,B.replacementSource,W),ee.uploadCentroid(B.context))}}(f,r,o,p,O),M||z)for(const B of p){const V=r.getTile(B).getBucket(o);V&&ju(f.context,r,B,V,o,M,z)}if(f.renderPass==="shadow"&&f.shadowRenderer){const B=f.shadowRenderer;if(M&&_<.65&&o._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof s.a9)return;const V=B.getShadowPassDepthMode(),G=B.getShadowPassColorMode();Md(f,r,o,p,V,Kt.disabled,G,z)}else if(f.renderPass==="translucent"){const B=!o.paint.get("fill-extrusion-pattern").constantOr(1),V=o.paint.get("fill-extrusion-color").constantOr(s.aj.white);if(!P&&V.a!==0){const G=new Ht(f.context.gl.LEQUAL,Ht.ReadWrite,f.depthRangeFor3D);_===1&&B?Md(f,r,o,p,G,Kt.disabled,ni.unblended,z):(Md(f,r,o,p,G,Kt.disabled,ni.disabled,z),Md(f,r,o,p,G,f.stencilModeFor3D(),f.colorModeForRenderPass(),z),f.resetStencilClippingMasks())}if(f.style.enable3dLights()&&B&&(!M&&f.transform.projection.name!=="globe"||P)){const G=o.paint.get("fill-extrusion-opacity"),Q=o.paint.get("fill-extrusion-ambient-occlusion-intensity"),W=o.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),te=o.paint.get("fill-extrusion-flood-light-intensity"),ee=o.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",le=o.paint.get("fill-extrusion-flood-light-color").toRenderColor(ee?null:o.lut).toArray01().slice(0,3),pe=Q>0&&W>0,fe=te>0,Te=(xe,ge,Re)=>(1-Re)*xe+Re*ge,_e=xe=>{const ge=f.depthModeForSublayer(1,Ht.ReadOnly,w.LEQUAL,!0),Re=o.paint.get(xe?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Fe=Te(.1,3,Re),rt=f._showOverdrawInspector;if(!rt){const Ke=new Kt({func:w.ALWAYS,mask:255},255,255,w.KEEP,w.KEEP,w.REPLACE),ht=new ni([w.ONE,w.ONE,w.ONE,w.ONE],s.aj.transparent,[!1,!1,!1,!0],w.MIN);Uu(f,r,o,p,ge,Ke,ht,li.disabled,xe,"sdf",G,Q,W,te,le,Fe,z,!1)}{const Ke=rt?Kt.disabled:new Kt({func:w.EQUAL,mask:255},255,255,w.KEEP,w.DECR,w.DECR),ht=rt?f.colorModeForRenderPass():new ni([w.ONE_MINUS_DST_ALPHA,w.DST_ALPHA,w.ONE,w.ONE],s.aj.transparent,[!0,!0,!0,!0]);Uu(f,r,o,p,ge,Ke,ht,li.disabled,xe,"color",G,Q,W,te,le,Fe,z,!1)}};if(P){const xe=(ge,Re,Fe)=>{const rt=f.depthModeForSublayer(1,Ht.ReadOnly,w.LEQUAL,!1),Ke=o.paint.get(ge?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ht=Te(.1,3,Ke);{const ut=new ni([w.ONE,w.ONE,w.ONE,w.ONE],s.aj.transparent,[!1,!1,!1,!0]);Uu(f,r,o,p,rt,Kt.disabled,ut,li.disabled,ge,"clear",G,Q,W,te,le,ht,z,Re)}{const ut=new Kt({func:w.ALWAYS,mask:255},255,255,w.KEEP,w.KEEP,w.REPLACE),$e=new ni([w.ONE,w.ONE,w.ONE,w.ONE],s.aj.transparent,[!1,!1,!1,!0],w.MIN);Uu(f,r,o,p,rt,ut,$e,li.disabled,ge,"sdf",G,Q,W,te,le,ht,z,Re)}{const ut=ge?w.ZERO:w.ONE_MINUS_DST_ALPHA,$e=new Kt({func:w.EQUAL,mask:255},255,255,w.KEEP,w.DECR,w.DECR),st=new ni([ut,w.DST_ALPHA,w.ONE_MINUS_DST_ALPHA,w.ZERO],s.aj.transparent,[!0,!0,!0,!0]);Uu(f,r,o,p,rt,$e,st,li.disabled,ge,"color",G,Q,W,te,le,ht,z,Re)}{const ut=new ni([w.ONE,w.ONE,w.ONE,ge?w.ZERO:w.ONE],s.aj.transparent,[!1,!1,!1,!0],ge?w.FUNC_ADD:w.MAX);Uu(f,r,o,p,rt,Kt.disabled,ut,li.disabled,ge,"clear",G,Q,W,te,le,ht,z,Re,Fe)}};if(pe||fe){let ge;if(f.prepareDrawTile(),M){const Re=M.drapeBufferSize[0],Fe=M.drapeBufferSize[1];ge=M.framebufferCopyTexture,ge&&(!ge||ge.size[0]===Re&&ge.size[1]===Fe)||(ge&&ge.destroy(),ge=M.framebufferCopyTexture=new s.T(x,new s.r({width:Re,height:Fe}),w.RGBA8)),ge.bind(w.LINEAR,w.CLAMP_TO_EDGE),w.copyTexSubImage2D(w.TEXTURE_2D,0,0,0,0,0,Re,Fe)}pe&&xe(!0,!1,ge),fe&&xe(!1,!0,ge)}}else pe&&_e(!0),fe&&_e(!1),(pe||fe)&&f.resetStencilClippingMasks()}}},hillshade:function(f,r,o,p){if(f.renderPass!=="offscreen"&&f.renderPass!=="translucent"||f.style.disableElevatedTerrain)return;const _=f.context,x=f.terrain&&f.terrain.renderingToTexture,[w,M]=f.renderPass!=="translucent"||x?[{},p]:f.stencilConfigForOverlap(p);for(const P of M){const z=r.getTile(P);if(z.needsHillshadePrepare&&f.renderPass==="offscreen")Wb(f,z,o);else if(f.renderPass==="translucent"){const O=f.depthModeForSublayer(0,Ht.ReadOnly),B=o.paint.get("hillshade-emissive-strength"),V=f.colorModeForDrapableLayerRenderPass(B),G=x&&f.terrain?f.terrain.stencilModeForRTTOverlap(P):w[P.overscaledZ];P0(f,P,z,o,O,G,V)}}_.viewport.set([0,0,f.width,f.height]),f.resetStencilClippingMasks()},raster:function(f,r,o,p,_,x){if(f.renderPass!=="translucent"||o.paint.get("raster-opacity")===0)return;const w=f.transform.projection.name==="globe",M=o.paint.get("raster-elevation")!==0,P=M&&w;if(f.renderElevatedRasterBackface&&!P)return;const z=f.context,O=z.gl,B=r.getSource(),V=function(_e,xe,ge,Re){const Fe=xe.paint.get("raster-color"),rt=_e.type==="raster-array",Ke=[],ht=xe.paint.get("raster-resampling"),ut=xe.paint.get("raster-color-mix");let $e=xe.paint.get("raster-color-range");const st=[ut[0],ut[1],ut[2],0],xt=ut[3];let He=ht==="nearest"?Re.NEAREST:Re.LINEAR;if(rt&&(Ke.push("RASTER_ARRAY"),Fe||Ke.push("RASTER_COLOR"),ht==="linear"&&Ke.push("RASTER_ARRAY_LINEAR"),He=Re.NEAREST,!$e&&_e.rasterLayers)){const ft=_e.rasterLayers.find(({id:at})=>at===xe.sourceLayer);ft&&ft.fields&&ft.fields.range&&($e=ft.fields.range)}if($e=$e||[0,1],Fe){Ke.push("RASTER_COLOR"),ge.activeTexture.set(Re.TEXTURE2),xe.updateColorRamp($e);let ft=xe.colorRampTexture;ft||(ft=xe.colorRampTexture=new s.T(ge,xe.colorRamp,Re.RGBA8)),ft.bind(Re.LINEAR,Re.CLAMP_TO_EDGE)}return{mix:st,range:$e,offset:xt,defines:Ke,resampling:He}}(B,o,z,O);if(B instanceof s.aJ&&!p.length&&!w)return;const G=o.paint.get("raster-emissive-strength"),Q=f.colorModeForDrapableLayerRenderPass(G),W=f.terrain&&f.terrain.renderingToTexture,te=!f.options.moving,ee=o.paint.get("raster-resampling")==="nearest"?O.NEAREST:O.LINEAR;if(B instanceof s.aJ&&!p.length&&(B.onNorthPole||B.onSouthPole)){const _e=M?f.stencilModeFor3D():Kt.disabled;return void Qe(!!B.onNorthPole,null,f,r,o,G,V,li.disabled,_e)}if(!p.length)return;const[le,pe]=B instanceof s.aJ||W?[{},p]:f.stencilConfigForOverlap(p),fe=pe[pe.length-1].overscaledZ;P&&V.defines.push("PROJECTION_GLOBE_VIEW"),M&&V.defines.push("RENDER_CUTOFF");const Te=(_e,xe,ge)=>{for(const Re of _e){const Fe=Re.toUnwrapped(),rt=r.getTile(Re);if(W&&(!rt||!rt.hasData()))continue;z.activeTexture.set(O.TEXTURE0);const Ke=lp(rt,B,o,V);if(!Ke||!Ke.texture)continue;const{texture:ht,mix:ut,offset:$e,tileSize:st,buffer:xt}=Ke;let He,ft;W?(He=Ht.disabled,ft=Re.projMatrix):M?(He=new Ht(O.LEQUAL,Ht.ReadWrite,f.depthRangeFor3D),ft=w?Float32Array.from(f.transform.expandedFarZProjMatrix):f.transform.calculateProjMatrix(Fe,te)):(He=f.depthModeForSublayer(Re.overscaledZ-fe,o.paint.get("raster-opacity")===1?Ht.ReadWrite:Ht.ReadOnly,O.LESS),ft=f.transform.calculateProjMatrix(Fe,te));const at=f.terrain&&W?f.terrain.stencilModeForRTTOverlap(Re):le[Re.overscaledZ],Mt=x?0:o.paint.get("raster-fade-duration");rt.registerFadeDuration(Mt);const _t=r.findLoadedParent(Re,0),dt=bd(rt,_t,r,f.transform,Mt);let bt,It;f.terrain&&f.terrain.prepareDrawTile(),z.activeTexture.set(O.TEXTURE0),ht.bind(ee,O.CLAMP_TO_EDGE),z.activeTexture.set(O.TEXTURE1),_t?(_t.texture&&_t.texture.bind(ee,O.CLAMP_TO_EDGE),bt=Math.pow(2,_t.tileID.overscaledZ-rt.tileID.overscaledZ),It=[rt.tileID.canonical.x*bt%1,rt.tileID.canonical.y*bt%1]):ht.bind(ee,O.CLAMP_TO_EDGE),ht.useMipmap&&z.extTextureFilterAnisotropic&&f.transform.pitch>20&&O.texParameterf(O.TEXTURE_2D,z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,z.extTextureFilterAnisotropicMax);const Ot=f.transform;let jt;const ui=M?Z0(Ot):[0,0,0,0];let ti,ri,fi,ki,en,Bn=0;if(P&&B instanceof s.aJ&&B.coordinates.length>3)ti=Float32Array.from(s.bb(s.cH(new s.bT(0,0,0)))),ri=Float32Array.from(Ot.globeMatrix),fi=Float32Array.from(s.cD(Ot)),ki=[s.at(Ot.center.lng),s.aA(Ot.center.lat)],jt=B.elevatedGlobePerspectiveTransform,en=B.elevatedGlobeGridMatrix||new Float32Array(9);else if(P){const Xt=s.cE(Re.canonical);Bn=s.cF(Xt.getCenter().lat),ti=Float32Array.from(s.bb(s.cH(Re.canonical))),ri=Float32Array.from(Ot.globeMatrix),fi=Float32Array.from(s.cD(Ot)),ki=[s.at(Ot.center.lng),s.aA(Ot.center.lat)],jt=[0,0],en=Float32Array.from(s.cG(Re.canonical,Xt,Bn,Ot.worldSize/Ot._pixelsPerMercatorPixel))}else jt=B instanceof s.aJ?B.perspectiveTransform:[0,0],ti=new Float32Array(16),ri=new Float32Array(9),fi=new Float32Array(16),ki=[0,0],en=new Float32Array(9);const bn=Gl(ft,ti,ri,fi,en,It||[0,0],s.ae(f.transform.zoom),ki,ui,bt||1,dt,o,jt,M?o.paint.get("raster-elevation"):0,2,ut,$e,V.range,st,xt,G),_i=f.isTileAffectedByFog(Re),ji=f.getOrCreateProgram("raster",{defines:V.defines,overrideFog:_i});if(f.uploadCommonUniforms(z,ji,Fe),B instanceof s.aJ){const Xt=B.elevatedGlobeVertexBuffer,Di=B.elevatedGlobeIndexBuffer;if(W||!w)B.boundsBuffer&&B.boundsSegments&&ji.draw(f,O.TRIANGLES,He,Kt.disabled,Q,li.disabled,bn,o.id,B.boundsBuffer,f.quadTriangleIndexBuffer,B.boundsSegments);else if(Xt&&Di){const Zi=Ot.zoom<=s.c6?B.elevatedGlobeSegments:B.getSegmentsForLongitude(Ot.center.lng);Zi&&ji.draw(f,O.TRIANGLES,He,Kt.disabled,Q,xe,bn,o.id,Xt,Di,Zi)}}else if(P){He=new Ht(O.LEQUAL,Ht.ReadOnly,f.depthRangeFor3D);const Xt=f.globeSharedBuffers;if(Xt){const[Di,Zi,Yi]=Xt.getGridBuffers(Bn,!1);ji.draw(f,O.TRIANGLES,He,ge||at,f.colorModeForRenderPass(),xe,bn,o.id,Di,Zi,Yi)}}else{const{tileBoundsBuffer:Xt,tileBoundsIndexBuffer:Di,tileBoundsSegments:Zi}=f.getTileBoundsBuffers(rt);ji.draw(f,O.TRIANGLES,He,at,Q,li.disabled,bn,o.id,Xt,Di,Zi)}}if(!(B instanceof s.aJ)&&P)for(const Re of _e){const Fe=Re.canonical.y===(1<<Re.canonical.z)-1;Re.canonical.y===0&&Qe(!0,Re,f,r,o,G,V,xe,ge||Kt.disabled),Fe&&Qe(!1,Re,f,r,o,G,V,xe===li.frontCW?li.backCW:li.frontCW,ge||Kt.disabled)}};P?Te(pe,f.renderElevatedRasterBackface?li.backCW:li.frontCW,f.stencilModeFor3D()):Te(pe,li.disabled,void 0),f.resetStencilClippingMasks()},"raster-particle":function(f,r,o,p,_,x){f.renderPass==="offscreen"&&function(w,M,P,z){if(!z.length)return;const O=w.context,B=O.gl,V=M.getSource();if(!(V instanceof qn))return;const G=Math.ceil(Math.sqrt(P.paint.get("raster-particle-count")));let Q=P.particlePositionRGBAImage;if(!Q||Q.width!==G){const pe=function(fe){const Te=fe*fe,_e=new Uint8Array(4*Te),xe=function(Re){return Re|=0,Re=Math.imul(2747636419^Re,2654435769),Re=Math.imul(Re^Re>>>16,2654435769),((Re=Math.imul(Re^Re>>>16,2654435769))>>>0)/4294967296},ge=1/1.1;for(let Re=0;Re<Te;Re++){const Fe=ge*(xe(2*Re+0)+Wt),rt=ge*(xe(2*Re+1)+Wt),Ke=255*Fe%1,ht=255*rt%1,ut=Ke,$e=rt-ht/255,st=ht;_e[4*Re+0]=255*(Fe-Ke/255),_e[4*Re+1]=255*ut,_e[4*Re+2]=255*$e,_e[4*Re+3]=255*st}return _e}(G);Q=P.particlePositionRGBAImage=new s.r({width:G,height:G},pe)}let W=P.particleFramebuffer;W?W.width!==G&&(W.destroy(),W=P.particleFramebuffer=O.createFramebuffer(G,G,!0,null)):W=P.particleFramebuffer=O.createFramebuffer(G,G,!0,null);const te=[];for(const pe of z){const fe=M.getTile(pe);if(!(fe instanceof Xa))continue;const Te=X0(fe,V,P);if(!Te)continue;const _e=[fe.tileSize,fe.tileSize];let xe=P.tileFramebuffer;xe||(xe=P.tileFramebuffer=O.createFramebuffer(_e[0],_e[1],!0,null));let ge=fe.rasterParticleState;ge||(ge=fe.rasterParticleState=new W0(O,pe,_e,Q));const Re=ge.update(P.lastInvalidatedAt);ge.particleTextureDimension!==G&&ge.updateParticleTexture(pe,Q);const Fe=ge.targetColorTexture;ge.targetColorTexture=ge.backgroundColorTexture,ge.backgroundColorTexture=Fe;const rt=ge.particleTexture0;ge.particleTexture0=ge.particleTexture1,ge.particleTexture1=rt,te.push([pe,Te,ge,Re])}if(te.length===0)return;const ee=s.q.now(),le=P.previousDrawTimestamp?.001*(ee-P.previousDrawTimestamp):.0167;if(P.previousDrawTimestamp=ee,P.hasColorMap()){O.activeTexture.set(B.TEXTURE0+2);let pe=P.colorRampTexture;pe||(pe=P.colorRampTexture=new s.T(O,P.colorRamp,B.RGBA8)),pe.bind(B.LINEAR,B.CLAMP_TO_EDGE)}O.bindFramebuffer.set(P.tileFramebuffer.framebuffer),function(pe,fe,Te){const _e=pe.context,xe=_e.gl,ge=fe.tileFramebuffer;_e.activeTexture.set(xe.TEXTURE0);const Re={u_texture:0,u_opacity:1.05*(rt=fe.paint.get("raster-particle-fade-opacity-factor"))/(rt+.05)},Fe=pe.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var rt;for(const Ke of Te){const[,,ht,ut]=Ke;ge.colorAttachment.set(ht.targetColorTexture.texture),_e.viewport.set([0,0,ge.width,ge.height]),_e.clear({color:s.aj.transparent}),ut&&(ht.backgroundColorTexture.bind(xe.NEAREST,xe.CLAMP_TO_EDGE),Fe.draw(pe,xe.TRIANGLES,Ht.disabled,Kt.disabled,ni.alphaBlended,li.disabled,Re,fe.id,pe.viewportBuffer,pe.quadTriangleIndexBuffer,pe.viewportSegments))}}(w,P,te),function(pe,fe,Te,_e){const xe=pe.context,ge=xe.gl,Re=Te.tileFramebuffer,Fe=pe.transform.projection.name==="globe",rt=Te.paint.get("raster-particle-max-speed");for(const Ke of _e){const[ht,ut,$e]=Ke;xe.activeTexture.set(ge.TEXTURE0+0),ut.texture.bind(ge.LINEAR,ge.CLAMP_TO_EDGE),Re.colorAttachment.set($e.targetColorTexture.texture);const st=pe.getOrCreateProgram("rasterParticleDraw",{defines:ut.defines,overrideFog:!1});xe.activeTexture.set(ge.TEXTURE0+1);const xt=ut.scalarData?[]:[0,1,2,3].map(at=>s.d4[at](ht));xt.push(ht);const He=ht.canonical.x,ft=ht.canonical.y;for(const at of xt){const Mt=fe.getTile(Fe?at.wrapped():at);if(!Mt)continue;const _t=Mt.rasterParticleState;if(!_t)continue;const dt=at.canonical.x+(1<<at.canonical.z)*(at.wrap-ht.wrap),bt=at.canonical.y;_t.particleTexture0.bind(ge.NEAREST,ge.CLAMP_TO_EDGE);const It=aw(1,_t.particleTexture0.size[0],[dt-He,bt-ft],0,ut.texture.size,2,rt,ut.textureOffset,ut.scale,ut.offset);st.draw(pe,ge.POINTS,Ht.disabled,Kt.disabled,ni.alphaBlended,li.disabled,It,Te.id,_t.particleIndexBuffer,void 0,_t.particleSegment)}}}(w,M,P,te),O.bindFramebuffer.set(P.particleFramebuffer.framebuffer),function(pe,fe,Te,_e){const xe=pe.context,ge=xe.gl,Re=fe.paint.get("raster-particle-max-speed"),Fe=_e*fe.paint.get("raster-particle-speed-factor")*.15,rt=function(ht){return Math.pow(ht,6)}(.01+1*fe.paint.get("raster-particle-reset-rate-factor")),Ke=fe.particleFramebuffer;xe.viewport.set([0,0,Ke.width,Ke.height]);for(const ht of Te){const[,ut,$e]=ht;xe.activeTexture.set(ge.TEXTURE0+0),ut.texture.bind(ge.LINEAR,ge.CLAMP_TO_EDGE),xe.activeTexture.set(ge.TEXTURE0+1);const st=$e.particleTexture0;st.bind(ge.NEAREST,ge.CLAMP_TO_EDGE);const xt=ow(1,st.size[0],0,ut.texture.size,Re,Fe,rt,ut.textureOffset,ut.scale,ut.offset);Ke.colorAttachment.set($e.particleTexture1.texture),xe.clear({color:s.aj.transparent}),pe.getOrCreateProgram("rasterParticleUpdate",{defines:ut.defines}).draw(pe,ge.TRIANGLES,Ht.disabled,Kt.disabled,ni.unblended,li.disabled,xt,fe.id,pe.viewportBuffer,pe.quadTriangleIndexBuffer,pe.viewportSegments)}}(w,P,te,le)}(f,r,o,p),f.renderPass==="translucent"&&(function(w,M,P,z,O){const B=w.context,V=B.gl,G=M.getSource().tileSize,Q=5*(1-s.ac(s.bY,s.bY+1,w.transform.zoom))*G+P.paint.get("raster-particle-elevation"),W=!w.options.moving,te=w.transform.projection.name==="globe";if(!z.length)return;const[ee,le]=w.stencilConfigForOverlap(z),pe=[];te&&pe.push("PROJECTION_GLOBE_VIEW");const fe=w.stencilModeFor3D();for(const Te of le){const _e=Te.toUnwrapped(),xe=M.getTile(Te);if(!xe.rasterParticleState)continue;const ge=xe.rasterParticleState,Re=100;xe.registerFadeDuration(Re);const Fe=M.findLoadedParent(Te,0),rt=bd(xe,Fe,M,w.transform,Re);let Ke,ht;w.terrain&&w.terrain.prepareDrawTile(),B.activeTexture.set(V.TEXTURE0),ge.targetColorTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),B.activeTexture.set(V.TEXTURE1),Fe&&Fe.rasterParticleState?(Fe.rasterParticleState.targetColorTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),Ke=Math.pow(2,Fe.tileID.overscaledZ-xe.tileID.overscaledZ),ht=[xe.tileID.canonical.x*Ke%1,xe.tileID.canonical.y*Ke%1]):ge.targetColorTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE);const ut=te?Float32Array.from(w.transform.expandedFarZProjMatrix):w.transform.calculateProjMatrix(_e,W),$e=w.transform,st=Y0($e),xt=s.cE(Te.canonical),He=s.cF(xt.getCenter().lat);let ft,at,Mt,_t,dt;te?(ft=Float32Array.from(s.bb(s.cH(Te.canonical))),at=Float32Array.from($e.globeMatrix),Mt=Float32Array.from(s.cD($e)),_t=[s.at($e.center.lng),s.aA($e.center.lat)],dt=Float32Array.from(s.cG(Te.canonical,xt,He,$e.worldSize/$e._pixelsPerMercatorPixel))):(ft=new Float32Array(16),at=new Float32Array(9),Mt=new Float32Array(16),_t=[0,0],dt=new Float32Array(9));const bt=Cg(ut,ft,at,Mt,dt,ht||[0,0],s.ae(w.transform.zoom),_t,st,Ke||1,rt,Q),It=w.isTileAffectedByFog(Te),Ot=w.getOrCreateProgram("rasterParticle",{defines:pe,overrideFog:It});if(w.uploadCommonUniforms(B,Ot,_e),te){const jt=new Ht(V.LEQUAL,Ht.ReadOnly,w.depthRangeFor3D),ui=0,ti=w.globeSharedBuffers;if(ti){const[ri,fi,ki]=ti.getGridBuffers(He,ui!==0);Ot.draw(w,V.TRIANGLES,jt,fe,ni.alphaBlended,w.renderElevatedRasterBackface?li.frontCCW:li.backCCW,bt,P.id,ri,fi,ki)}}else{const jt=w.depthModeForSublayer(0,Ht.ReadOnly),ui=ee[Te.overscaledZ],{tileBoundsBuffer:ti,tileBoundsIndexBuffer:ri,tileBoundsSegments:fi}=w.getTileBoundsBuffers(xe);Ot.draw(w,V.TRIANGLES,jt,ui,ni.alphaBlended,li.disabled,bt,P.id,ti,ri,fi)}}w.resetStencilClippingMasks()}(f,r,o,p),f.style.map.triggerRepaint())},background:function(f,r,o,p){const _=o.paint.get("background-color"),x=o.paint.get("background-color-use-theme").constantOr("default")==="none",w=o.paint.get("background-opacity"),M=o.paint.get("background-emissive-strength"),P=o.paint.get("background-pitch-alignment")==="viewport";if(w===0)return;const z=f.context,O=z.gl,B=f.transform,V=B.tileSize,G=o.paint.get("background-pattern");let Q;if(G!==void 0&&(G===null||(Q=f.imageManager.getPattern(G.toString(),o.scope,f.style.getLut(o.scope)),!Q)))return;const W=!G&&_.a===1&&w===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==W)return;const te=Kt.disabled,ee=f.depthModeForSublayer(0,W==="opaque"?Ht.ReadWrite:Ht.ReadOnly),le=f.colorModeForDrapableLayerRenderPass(M),pe=G?"backgroundPattern":"background";let fe,Te=p;if(Te||(fe=f.getBackgroundTiles(),Te=Object.values(fe).map(_e=>_e.tileID)),G&&(z.activeTexture.set(O.TEXTURE0),f.imageManager.bind(f.context,o.scope)),P){const _e=f.getOrCreateProgram(pe,{overrideFog:!1,overrideRtt:!0}),xe=new Float32Array(s.ab.mat4.identity([])),ge=new s.aG(0,0,0,0,0),Re=G?$0(xe,M,w,f,0,o.scope,Q,P,{tileID:ge,tileSize:V}):Dg(xe,M,w,_.toRenderColor(x?null:o.lut));_e.draw(f,O.TRIANGLES,ee,te,le,li.disabled,Re,o.id,f.viewportBuffer,f.quadTriangleIndexBuffer,f.viewportSegments)}else for(const _e of Te){const xe=f.isTileAffectedByFog(_e),ge=f.getOrCreateProgram(pe,{overrideFog:xe}),Re=_e.toUnwrapped(),Fe=p?_e.projMatrix:f.transform.calculateProjMatrix(Re);f.prepareDrawTile();const rt=r?r.getTile(_e):fe?fe[_e.key]:new wo(_e,V,B.zoom,f),Ke=G?$0(Fe,M,w,f,0,o.scope,Q,P,{tileID:_e,tileSize:V}):Dg(Fe,M,w,_.toRenderColor(x?null:o.lut));f.uploadCommonUniforms(z,ge,Re);const{tileBoundsBuffer:ht,tileBoundsIndexBuffer:ut,tileBoundsSegments:$e}=f.getTileBoundsBuffers(rt);ge.draw(f,O.TRIANGLES,ee,te,le,li.disabled,Ke,o.id,ht,ut,$e)}},sky:function(f,r,o){const p=f._atmosphere?s.ae(f.transform.zoom):1,_=o.paint.get("sky-opacity")*p;if(_===0)return;const x=f.context,w=o.paint.get("sky-type"),M=new Ht(x.gl.LEQUAL,Ht.ReadOnly,[0,1]),P=f.frameCounter/1e3%1;w==="atmosphere"?f.renderPass==="offscreen"?o.needsSkyboxCapture(f)&&(function(z,O,B,V){const G=z.context,Q=G.gl;let W=O.skyboxFbo;if(!W){W=O.skyboxFbo=G.createFramebuffer(32,32,!0,null),O.skyboxGeometry=new Q0(G),O.skyboxTexture=G.gl.createTexture(),Q.bindTexture(Q.TEXTURE_CUBE_MAP,O.skyboxTexture),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_WRAP_S,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_WRAP_T,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_MIN_FILTER,Q.LINEAR),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_MAG_FILTER,Q.LINEAR);for(let pe=0;pe<6;++pe)Q.texImage2D(Q.TEXTURE_CUBE_MAP_POSITIVE_X+pe,0,Q.RGBA,32,32,0,Q.RGBA,Q.UNSIGNED_BYTE,null)}G.bindFramebuffer.set(W.framebuffer),G.viewport.set([0,0,32,32]);const te=O.getCenter(z,!0),ee=z.getOrCreateProgram("skyboxCapture"),le=new Float64Array(16);s.ab.mat4.identity(le),s.ab.mat4.rotateY(le,le,.5*-Math.PI),Nr(z,O,ee,le,te,0),s.ab.mat4.identity(le),s.ab.mat4.rotateY(le,le,.5*Math.PI),Nr(z,O,ee,le,te,1),s.ab.mat4.identity(le),s.ab.mat4.rotateX(le,le,.5*-Math.PI),Nr(z,O,ee,le,te,2),s.ab.mat4.identity(le),s.ab.mat4.rotateX(le,le,.5*Math.PI),Nr(z,O,ee,le,te,3),s.ab.mat4.identity(le),Nr(z,O,ee,le,te,4),s.ab.mat4.identity(le),s.ab.mat4.rotateY(le,le,Math.PI),Nr(z,O,ee,le,te,5),G.viewport.set([0,0,z.width,z.height])}(f,o),o.markSkyboxValid(f)):f.renderPass==="sky"&&function(z,O,B,V,G){const Q=z.context,W=Q.gl,te=z.transform,ee=z.getOrCreateProgram("skybox");Q.activeTexture.set(W.TEXTURE0),W.bindTexture(W.TEXTURE_CUBE_MAP,O.skyboxTexture);const le=((pe,fe,Te,_e,xe)=>({u_matrix:pe,u_sun_direction:fe,u_cubemap:0,u_opacity:_e,u_temporal_offset:xe}))(te.skyboxMatrix,O.getCenter(z,!1),0,V,G);z.uploadCommonUniforms(Q,ee),ee.draw(z,W.TRIANGLES,B,Kt.disabled,z.colorModeForRenderPass(),li.backCW,le,"skybox",O.skyboxGeometry.vertexBuffer,O.skyboxGeometry.indexBuffer,O.skyboxGeometry.segment)}(f,o,M,_,P):w==="gradient"&&f.renderPass==="sky"&&function(z,O,B,V,G){const Q=z.context,W=Q.gl,te=z.transform,ee=z.getOrCreateProgram("skyboxGradient");O.skyboxGeometry||(O.skyboxGeometry=new Q0(Q)),Q.activeTexture.set(W.TEXTURE0);let le=O.colorRampTexture;le||(le=O.colorRampTexture=new s.T(Q,O.colorRamp,W.RGBA8)),le.bind(W.LINEAR,W.CLAMP_TO_EDGE);const pe=((fe,Te,_e,xe,ge)=>({u_matrix:fe,u_color_ramp:0,u_center_direction:Te,u_radius:s.ai(_e),u_opacity:xe,u_temporal_offset:ge}))(te.skyboxMatrix,O.getCenter(z,!1),O.paint.get("sky-gradient-radius"),V,G);z.uploadCommonUniforms(Q,ee),ee.draw(z,W.TRIANGLES,B,Kt.disabled,z.colorModeForRenderPass(),li.backCW,pe,"skyboxGradient",O.skyboxGeometry.vertexBuffer,O.skyboxGeometry.indexBuffer,O.skyboxGeometry.segment)}(f,o,M,_,P)},debug:function(f,r,o,p,_,x){for(let w=0;w<o.length;w++)if(_){const z=new s.aj(p.r*.8,p.g*.8,p.b*.8,1);$l(f,r,o[w],p,-1,-1,x),$l(f,r,o[w],p,-1,1,x),$l(f,r,o[w],p,1,1,x),$l(f,r,o[w],p,1,-1,x),$l(f,r,o[w],z,0,0,x)}else $l(f,r,o[w],p,0,0,x)},custom:function(f,r,o,p){const _=f.context,x=o.implementation;if(!f.transform.projection.unsupportedLayers||!f.transform.projection.unsupportedLayers.includes("custom")||f.terrain&&(f.terrain.renderingToTexture||f.renderPass==="offscreen")&&o.isDraped(r)){if(f.renderPass==="offscreen"){const w=x.prerender;if(w){if(f.setCustomLayerDefaults(),_.setColorMode(f.colorModeForRenderPass()),f.transform.projection.name==="globe"){const M=f.transform.pointMerc;w.call(x,_.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),s.ae(f.transform.zoom),[M.x,M.y],f.transform.pixelsPerMeterRatio)}else w.call(x,_.gl,f.transform.customLayerMatrix());_.setDirty(),f.setBaseState()}}else if(f.renderPass==="translucent"){if(f.terrain&&f.terrain.renderingToTexture){const M=x.renderToTile;if(M){const P=p[0].canonical,z=new s.aa(P.x+p[0].wrap*(1<<P.z),P.y,P.z);_.setDepthMode(Ht.disabled),_.setStencilMode(Kt.disabled),_.setColorMode(f.colorModeForRenderPass()),f.setCustomLayerDefaults(),M.call(x,_.gl,z),_.setDirty(),f.setBaseState()}return}f.setCustomLayerDefaults(),_.setColorMode(f.colorModeForRenderPass()),_.setStencilMode(Kt.disabled);const w=x.renderingMode==="3d"?new Ht(f.context.gl.LEQUAL,Ht.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,Ht.ReadOnly);if(_.setDepthMode(w),f.transform.projection.name==="globe"){const M=f.transform.pointMerc;x.render(_.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),s.ae(f.transform.zoom),[M.x,M.y],f.transform.pixelsPerMeterRatio)}else x.render(_.gl,f.transform.customLayerMatrix());_.setDirty(),f.setBaseState(),_.bindFramebuffer.set(null)}}else s.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(f,r,o,p){if(f.renderPass==="opaque")return;const _=o.paint.get("model-opacity").constantOr(1);if(_===0)return;const x=o.paint.get("model-cast-shadows");if(f.renderPass==="shadow"&&(!x||f.terrain&&_<.65&&o._transitionablePaint._values["model-opacity"].value.expression instanceof s.a9))return;const w=f.shadowRenderer,M=o.paint.get("model-receive-shadows");w&&(w.useNormalOffset=!0,M||(w.enabled=!1));const P=()=>{w&&(w.useNormalOffset=!0,M||(w.enabled=!0))},z=r.getSource();if(f.renderPass==="light-beam"&&z.type!=="batched-model")return;if(z.type==="vector"||z.type==="geojson")return function(ee,le,pe,fe,Te){const _e=ee.transform;if(_e.projection.name!=="mercator")return void s.w(`Drawing 3D models for ${_e.projection.name} projection is not yet implemented`);const xe=_e.getFreeCameraOptions().position;if(!ee.modelManager)return;const ge=ee.modelManager;pe.modelManager=ge;const Re=ee.shadowRenderer;if(!pe._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Fe=pe._unevaluatedLayout._values["model-id"],rt=Object.assign({},pe.layout.get("model-id").parameters),Ke=ee.style.order.indexOf(pe.fqid);for(const ht of fe){const ut=le.getTile(ht).getBucket(pe);if(!ut||ut.projection.name!==_e.projection.name)continue;const $e=ut.getModelUris();$e&&!ut.modelsRequested&&(ge.addModelsFromBucket($e,Te),ut.modelsRequested=!0);const st=dp(ht,_e);rt.zoom=st;const xt=Fe.possiblyEvaluate(rt);if(So(ee,ut,ht),us.shadowUniformsInitialized=!1,us.useSingleShadowCascade=!!Re&&Re.getMaxCascadeForTile(ht.toUnwrapped())===0,ee.renderPass==="shadow"&&Re){if(ee.currentShadowCascade===1&&ut.isInsideFirstShadowMapFrustum)continue;const at=_e.calculatePosMatrix(ht.toUnwrapped(),_e.worldSize);if(us.tileMatrix.set(at),us.shadowTileMatrix=Float32Array.from(Re.calculateShadowPassMatrixFromMatrix(at)),us.aabb.min.fill(0),us.aabb.max[0]=us.aabb.max[1]=s.ag,us.aabb.max[2]=0,Ug(ut,us,ee,pe.scope))continue}const He=1<<ht.canonical.z,ft=[((xe.x-ht.wrap)*He-ht.canonical.x)*s.ag,(xe.y*He-ht.canonical.y)*s.ag,xe.z*He*s.ag];ee.conflationActive&&Object.keys(ut.instancesPerModel).length>0&&ee.style.isLayerClipped(pe,le.getSource())&&ut.updateReplacement(ht,ee.replacementSource,Ke,Te)&&(ut.uploaded=!1,ut.upload(ee.context));for(let at in ut.instancesPerModel){const Mt=ut.instancesPerModel[at];Mt.features.length>0&&(at=xt.evaluate(Mt.features[0].feature,{}));const _t=ge.getModel(at,Te);if(_t&&_t.uploaded)for(const dt of _t.nodes)Dd(ee,pe,dt,Mt,ft,ht,us)}}}(f,r,o,p,z.type==="vector"?o.scope:""),void P();if(!z.loaded())return;if(z.type==="batched-model")return function(ee,le,pe,fe){pe.resetLayerRenderingStats(ee);const Te=ee.context,_e=ee.transform,xe=ee.style.fog,ge=ee.shadowRenderer;if(_e.projection.name!=="mercator")return void s.w(`Drawing 3D landmark models for ${_e.projection.name} projection is not yet implemented`);const Re=ee.transform.getFreeCameraOptions().position,Fe=s.ab.vec3.scale([],[Re.x,Re.y,Re.z],ee.transform.worldSize),rt=s.ab.vec3.negate([],Fe),Ke=s.ab.mat4.identity([]),ht=s.dj(_e.center.lat,_e.zoom),ut=s.ab.mat4.fromScaling([],[1,1,1/ht]);s.ab.mat4.translate(Ke,Ke,rt);const $e=pe.paint.get("model-opacity").constantOr(1),st=new Ht(Te.gl.LEQUAL,Ht.ReadWrite,ee.depthRangeFor3D),xt=new Ht(Te.gl.LEQUAL,Ht.ReadOnly,ee.depthRangeFor3D),He=new s.cd([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),ft=ee.renderPass==="shadow",at=ft&&ge?ge.getCurrentCascadeFrustum():_e.getFrustum(_e.scaleZoom(_e.worldSize)),Mt=pe.paint.get("model-front-cutoff"),_t=Mt[2]<1,dt=Ul(ee,pe.paint.get("model-cutoff-fade-range")),bt=pe.getLayerRenderingStats();(function(It,Ot,jt,ui){const ti=It.terrain?It.terrain.exaggeration():0,ri=It.transform.zoom;for(const fi of ui){const ki=Ot.getTile(fi).getBucket(jt);ki&&(It.conflationActive&&ki.updateReplacement(fi,It.replacementSource),ki.evaluateScale(It,jt),It.terrain&&ti>0&&ki.elevationUpdate(It.terrain,ti,fi,jt.source),ki.needsReEvaluation(It,ri,jt)&&ki.evaluate(jt))}})(ee,le,pe,fe),function(){let It,Ot,jt;_t?(It=fe.length-1,Ot=-1,jt=-1):(It=0,Ot=fe.length,jt=1);const ui=new Float64Array(16),ti=s.ab.vec3.create(),ri=new s.P(0,0);for(let fi=It;fi!==Ot;fi+=jt){const ki=fe[fi],en=le.getTile(ki).getBucket(pe);if(!en||!en.uploaded)continue;let Bn=!1;ge&&(Bn=ge.getMaxCascadeForTile(ki.toUnwrapped())===0);const bn=_e.calculatePosMatrix(ki.toUnwrapped(),_e.worldSize),_i=en.modelTraits;!ft&&_t&&(s.ab.mat4.invert(ui,bn),s.ab.vec3.transformMat4(ti,Fe,ui),ri.x=ti[0],ri.y=ti[1]);const ji=[];for(const Xt of en.getNodesInfo()){if(Xt.hiddenByReplacement||!Xt.node.meshes)continue;const Di=Xt.node;let Zi=0;ee.terrain&&Di.elevation&&(Zi=Di.elevation*ee.terrain.exaggeration());const Yi=(()=>{const Bi=Xt.aabb;return He.min=[...Bi.min],He.max=[...Bi.max],He.min[2]+=Zi,He.max[2]+=Zi,s.ab.vec3.transformMat4(He.min,He.min,bn),s.ab.vec3.transformMat4(He.max,He.max,bn),He})(),On=Xt.evaluatedScale;if(On[0]<=1&&On[1]<=1&&On[2]<=1&&Yi.intersects(at)===0)continue;if(!ft&&_t){const Bi=.16666666666666666;Xt.cameraCollisionOpacity=Fe[0]>Yi.min[0]&&Fe[0]<Yi.max[0]&&Fe[1]>Yi.min[1]&&Fe[1]<Yi.max[1]&&Fe[2]*ht<Yi.max[2]&&Di.footprint&&s.bA(ri,Di.footprint)?Math.max(Xt.cameraCollisionOpacity-Bi,0):Math.min(1,Xt.cameraCollisionOpacity+Bi)}const Mr=[...bn],dr=Di.anchor?Di.anchor[0]:0,fr=Di.anchor?Di.anchor[1]:0;s.ab.mat4.translate(Mr,Mr,[dr*(On[0]-1),fr*(On[1]-1),Zi]),s.ab.vec3.exactEquals(On,s.dm)||s.ab.mat4.scale(Mr,Mr,On);const Ta=s.ab.mat4.multiply([],Mr,Di.matrix),hs=s.ab.mat4.multiply([],_e.expandedFarZProjMatrix,Ta),kn=s.ab.mat4.multiply([],_e.expandedFarZProjMatrix,Mr),hn=s.ab.vec4.transformMat4([],[dr,fr,Zi,1],hs)[2];Di.hidden=!1;let ln=$e;ft||(_t&&(ln*=Xt.cameraCollisionOpacity,ln*=jg(Mr,_e,Xt.aabb,Mt)),ln*=Nc(dt,hn)),ln!==0?ji.push({nodeInfo:Xt,depth:hn,opacity:ln,wvpForNode:hs,wvpForTile:kn,nodeModelMatrix:Ta,tileModelMatrix:Mr}):Di.hidden=!0}ft||ji.sort((Xt,Di)=>!_t||Xt.opacity===1&&Di.opacity===1?Xt.depth<Di.depth?-1:1:Xt.opacity===1?-1:Di.opacity===1?1:Xt.depth>Di.depth?-1:1);for(const Xt of ji){const Di=Xt.nodeInfo,Zi=Di.node;let Yi=s.ab.mat4.multiply([],ut,Xt.tileModelMatrix);s.ab.mat4.multiply(Yi,Ke,Yi);const On=s.ab.mat4.invert([],Yi);s.ab.mat4.transpose(On,On),s.ab.mat4.scale(On,On,Vg),Yi=s.ab.mat4.multiply(Yi,Yi,Zi.matrix);const Mr=ee.renderPass==="light-beam",dr=pe.paint.get("model-color-use-theme").constantOr("default")==="none",fr=_i&s.dp.HasMapboxMeshFeatures,Ta=fr?0:Di.evaluatedRMEA[0][2];for(let hs=0;hs<Zi.meshes.length;++hs){const kn=Zi.meshes[hs],hn=hs===Zi.lightMeshIndex;let ln=Xt.wvpForNode;if(hn){if(!Mr&&!ee.terrain&&ee.shadowRenderer){ee.currentLayer<ee.firstLightBeamLayer&&(ee.firstLightBeamLayer=ee.currentLayer);continue}ln=Xt.wvpForTile}else if(Mr)continue;const Bi={defines:[]},er=[];if(!ft&&ge&&(ge.useNormalOffset=!!kn.normalBuffer),$u(Bi.defines,er,kn,ee,dr?null:pe.lut),fr||Bi.defines.push("DIFFUSE_SHADED"),Bn&&Bi.defines.push("SHADOWS_SINGLE_CASCADE"),bt&&(ft?bt.numRenderedVerticesInShadowPass+=kn.vertexArray.length:bt.numRenderedVerticesInTransparentPass+=kn.vertexArray.length),ft){Rd(kn,Xt.nodeModelMatrix,ee,pe);continue}let Cr=null;if(xe){const Co=cl(Xt.nodeModelMatrix,ee.transform);if(Cr=new Float32Array(Co),_e.projection.name!=="globe"){const Fa=kn.aabb.min,Ea=kn.aabb.max,[qc,Ro]=xe.getOpacityForBounds(Co,Fa[0],Fa[1],Ea[0],Ea[1]);Bi.overrideFog=qc>=ve||Ro>=ve}}const un=kn.material;let ds;un.occlusionTexture&&un.occlusionTexture.offsetScale&&(ds=un.occlusionTexture.offsetScale,Bi.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const Na=ee.getOrCreateProgram("model",Bi);!ft&&ge&&ge.setupShadowsFromMatrix(Xt.tileModelMatrix,Na,ge.useNormalOffset),ee.uploadCommonUniforms(Te,Na,null,Cr);const sa=un.pbrMetallicRoughness;sa.metallicFactor=.9,sa.roughnessFactor=.5;const Fs=Sd(new Float32Array(ln),new Float32Array(Yi),new Float32Array(On),new Float32Array(Zi.matrix),ee,Xt.opacity,sa.baseColorFactor.toRenderColor(null),un.emissiveFactor,sa.metallicFactor,sa.roughnessFactor,un,Ta,pe,[0,0,0],ds);!hn&&(Di.hasTranslucentParts||Xt.opacity<1)&&Na.draw(ee,Te.gl.TRIANGLES,st,Kt.disabled,ni.disabled,li.backCCW,Fs,pe.id,kn.vertexBuffer,kn.indexBuffer,kn.segments,pe.paint,ee.transform.zoom,void 0,er),Na.draw(ee,Te.gl.TRIANGLES,hn?xt:st,Kt.disabled,hn||Xt.opacity<1||Di.hasTranslucentParts?ni.alphaBlended:ni.unblended,li.backCCW,Fs,pe.id,kn.vertexBuffer,kn.indexBuffer,kn.segments,pe.paint,ee.transform.zoom,void 0,er)}}}}()}(f,r,o,p),void P();if(z.type!=="model")return;const O=z.getModels(),B=[],V=f.transform.getFreeCameraOptions().position,G=s.ab.vec3.scale([],[V.x,V.y,V.z],f.transform.worldSize);s.ab.vec3.negate(G,G);const Q=[],W=[];let te=0;for(const ee of O){const le=o.paint.get("model-rotation").constantOr(null),pe=o.paint.get("model-scale").constantOr(null),fe=o.paint.get("model-translation").constantOr(null);ee.computeModelMatrix(f,le,pe,fe,!0,!0,!1);const Te=s.ab.mat4.identity([]),_e=s.dj(ee.position.lat,f.transform.zoom),xe=s.ab.mat4.fromScaling([],[1,1,1/_e]);s.ab.mat4.translate(Te,Te,G),B.push({zScaleMatrix:xe,negCameraPosMatrix:Te});for(const ge of ee.nodes)hp(f.transform,ge,ee.matrix,f.transform.expandedFarZProjMatrix,te,Q,W);te++}if(Q.sort((ee,le)=>le.depth-ee.depth),f.renderPass!=="shadow"){if(_===1)for(const ee of W)ul(ee,f,o,B[ee.modelIndex],Kt.disabled,f.colorModeForRenderPass());else{for(const ee of W)ul(ee,f,o,B[ee.modelIndex],Kt.disabled,ni.disabled);for(const ee of W)ul(ee,f,o,B[ee.modelIndex],f.stencilModeFor3D(),f.colorModeForRenderPass());f.resetStencilClippingMasks()}for(const ee of Q)ul(ee,f,o,B[ee.modelIndex],Kt.disabled,f.colorModeForRenderPass());P()}else{for(const ee of W)Rd(ee.mesh,ee.nodeModelMatrix,f,o);for(const ee of Q)Rd(ee.mesh,ee.nodeModelMatrix,f,o);P()}}},zd={line:function(f,r,o){if(f.hasElevatedBuckets=!1,f.hasNonElevatedBuckets=!1,f._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||f._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(r){const p=r.getVisibleCoordinates();for(const _ of p){const x=r.getTile(_).getBucket(f);if(x&&(x.hasZOffset?f.hasElevatedBuckets=!0:f.hasNonElevatedBuckets=!0,f.hasElevatedBuckets&&f.hasNonElevatedBuckets))break}}}else f.hasNonElevatedBuckets=!0},model:function(f,r,o){const p=r.getSource();if(!p.loaded())return;if(p.type==="vector"||p.type==="geojson")return void(o.modelManager&&o.modelManager.upload(o,p.type==="vector"?f.scope:""));if(p.type==="batched-model"||p.type!=="model")return;const _=p.getModels();for(const x of _)x.upload(o.context)},raster:function(f,r,o){const p=r.getSource();if(!(p instanceof qn&&p.loaded()))return;const _=f.sourceLayer||p.rasterLayerIds&&p.rasterLayerIds[0];if(!_)return;const x=f.paint.get("raster-array-band")||p.getInitialBand(_);if(x==null)return;const w=r.getIds().map(M=>r.getTileByID(M));for(const M of w)M.updateNeeded(_,x)&&p.prepareTile(M,_,x)},"raster-particle":function(f,r,o){const p=r.getSource();if(!(p instanceof qn&&p.loaded()))return;const _=f.sourceLayer||p.rasterLayerIds&&p.rasterLayerIds[0];if(!_)return;const x=f.paint.get("raster-particle-array-band")||p.getInitialBand(_);if(x==null)return;const w=r.getIds().map(M=>r.getTileByID(M));for(const M of w)M.updateNeeded(_,x)&&p.prepareTile(M,_,x)}};class Yg{constructor(r,o,p,_,x){this.context=new Og(r,o),this.transform=p,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=x,this._timeStamp=s.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const w=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const P of w)this._debugParams.enabledLayers[P]=!0;x.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),x.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),x.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),x.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),x.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),x.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const P of w)x.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],P);this.occlusionParams=new fp(x),this.setup(),this.numSublayers=Js.maxUnderzooming+Js.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new s.dv,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Ac(this),this._wireframeDebugCache=new qg,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const M=new s.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new s.T(this.context,M,r.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=_}updateTerrain(r,o){const p=!!r&&!!r.terrain&&this.transform.projection.supportsTerrain;if(!(p||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Nu(this,r));const _=this._terrain;this.transform.elevation=p?_:null,_.update(r,this.transform,o),this.transform.elevation&&!_.enabled&&(this.transform.elevation=null)}_updateFog(r){const o=r.fog;if(!o||this.transform.projection.name==="globe"||o.getOpacity(this.transform.pitch)<1||o.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[p,_]=o.getFovAdjustedRange(this.transform._fov);if(p>_)return void(this.transform.fogCullDistSq=null);const x=p+.78*(_-p);this.transform.fogCullDistSq=x*x}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(r){r&&!this._terrain&&(this._terrain=new Nu(this,this.style)),this._forceTerrainMode=r}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(r,o){if(this.width=r*s.q.devicePixelRatio,this.height=o*s.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style.order)this.style._mergedLayers[p].resize()}setup(){const r=this.context,o=new s.b4;o.emplaceBack(0,0),o.emplaceBack(s.ag,0),o.emplaceBack(0,s.ag),o.emplaceBack(s.ag,s.ag),this.tileExtentBuffer=r.createVertexBuffer(o,s.b6.members),this.tileExtentSegments=s.b7.simpleSegment(0,0,4,2);const p=new s.b4;p.emplaceBack(0,0),p.emplaceBack(s.ag,0),p.emplaceBack(0,s.ag),p.emplaceBack(s.ag,s.ag),this.debugBuffer=r.createVertexBuffer(p,s.b6.members),this.debugSegments=s.b7.simpleSegment(0,0,4,5);const _=new s.b4;_.emplaceBack(-1,-1),_.emplaceBack(1,-1),_.emplaceBack(-1,1),_.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(_,s.b6.members),this.viewportSegments=s.b7.simpleSegment(0,0,4,2);const x=new s.aT;x.emplaceBack(0,0,0,0),x.emplaceBack(s.ag,0,s.ag,0),x.emplaceBack(0,s.ag,0,s.ag),x.emplaceBack(s.ag,s.ag,s.ag,s.ag),this.mercatorBoundsBuffer=r.createVertexBuffer(x,s.b9.members),this.mercatorBoundsSegments=s.b7.simpleSegment(0,0,4,2);const w=new s.aU;w.emplaceBack(0,1,2),w.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(w);const M=new s.b5;for(const z of[0,1,3,2,0])M.emplaceBack(z);this.debugIndexBuffer=r.createIndexBuffer(M),this.emptyTexture=new s.T(r,new s.r({width:1,height:1},Uint8Array.of(0,0,0,0)),r.gl.RGBA8),this.identityMat=s.ab.mat4.create();const P=this.context.gl;this.stencilClearMode=new Kt({func:P.ALWAYS,mask:0},0,255,P.ZERO,P.ZERO,P.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(r){return r._makeTileBoundsBuffers(this.context,this.transform.projection),r._tileBoundsBuffer?{tileBoundsBuffer:r._tileBoundsBuffer,tileBoundsIndexBuffer:r._tileBoundsIndexBuffer,tileBoundsSegments:r._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const r=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,r.TRIANGLES,Ht.disabled,this.stencilClearMode,ni.disabled,li.disabled,Jf(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(r,o,p){if(!o||this.currentStencilSource===o.id||!r.isTileClipped()||!p||p.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let M=!1;for(const P of p)if(this._tileClippingMaskIDs[P.key]===void 0){M=!0;break}if(!M)return}this.currentStencilSource=o.id;const _=this.context,x=_.gl;this.nextStencilID+p.length>256&&this.clearStencil(),_.setColorMode(ni.disabled),_.setDepthMode(Ht.disabled);const w=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const M of p){const P=o.getTile(M),z=this._tileClippingMaskIDs[M.key]=this.nextStencilID++,{tileBoundsBuffer:O,tileBoundsIndexBuffer:B,tileBoundsSegments:V}=this.getTileBoundsBuffers(P);w.draw(this,x.TRIANGLES,Ht.disabled,new Kt({func:x.ALWAYS,mask:0},z,255,x.KEEP,x.KEEP,x.REPLACE),ni.disabled,li.disabled,Jf(M.projMatrix),"$clipping",O,B,V)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,o=this.context.gl;return new Kt({func:o.NOTEQUAL,mask:255},r,255,o.KEEP,o.KEEP,o.REPLACE)}stencilModeForClipping(r){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(r);const o=this.context.gl;return new Kt({func:o.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,o.KEEP,o.KEEP,o.REPLACE)}stencilConfigForOverlap(r){const o=this.context.gl,p=r.sort((w,M)=>M.overscaledZ-w.overscaledZ),_=p[p.length-1].overscaledZ,x=p[0].overscaledZ-_+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();const w={};for(let M=0;M<x;M++)w[M+_]=new Kt({func:o.GEQUAL,mask:255},M+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=x,[w,p]}return[{[_]:Kt.disabled},p]}colorModeForRenderPass(){const r=this.context.gl;return this._showOverdrawInspector?new ni([r.CONSTANT_COLOR,r.ONE,r.CONSTANT_COLOR,r.ONE],new s.aj(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?ni.unblended:ni.alphaBlended}colorModeForDrapableLayerRenderPass(r){const o=this.context.gl;return(()=>this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture)()&&this.renderPass==="translucent"?new ni([o.ONE,o.ONE_MINUS_SRC_ALPHA,o.CONSTANT_ALPHA,o.ONE_MINUS_SRC_ALPHA],new s.aj(0,0,0,r===void 0?0:r),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(r,o,p,_=!1){if(this.depthOcclusion)return new Ht(this.context.gl.GREATER,Ht.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!_)return Ht.disabled;const x=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new Ht(p||this.context.gl.LEQUAL,o,[x,x])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const r=this.context.gl,o=Math.ceil(this.width),p=Math.ceil(this.height),_=this.context.bindFramebuffer.get(),x=r.getParameter(r.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===o&&this.depthFBO.height===p||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),o!==0&&p!==0&&(this.depthFBO=new zg(this.context,o,p,!1,"texture"),this.depthTexture=new s.T(this.context,{width:o,height:p,data:null},r.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(_),r.bindTexture(r.TEXTURE_2D,x),this.depthFBO&&(r.bindFramebuffer(r.READ_FRAMEBUFFER,null),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),r.blitFramebuffer(0,0,o,p,0,0,o,p,r.DEPTH_BUFFER_BIT,r.NEAREST),r.bindFramebuffer(r.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((r,o)=>r+o/this._fpsHistory.length,0))}render(r,o){const p=s.q.now();this._dt=p-this._timeStamp,this._timeStamp=p,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=r.map.repaint,this.style=r,this.options=o;const _=this.style._mergedLayers,x=!(!this.terrain||!this.terrain.enabled),w=()=>this.style._getOrder(x).filter($e=>{const st=_[$e];return!(st.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[st.type]});let M=w(),P=!1,z=!1;for(const $e of M){const st=_[$e];st.type==="circle"&&(P=!0),st.type==="symbol"&&(st.hasInitialOcclusionOpacityProperties?z=!0:P=!0)}let O=M.map($e=>_[$e]);const B=this.style._mergedSourceCaches;this.imageManager=r.imageManager,this.modelManager=r.modelManager,this.symbolFadeChange=r.placement.symbolFadeChange(s.q.now()),this.imageManager.beginFrame();let V=0,G=!1;for(const $e in B){const st=B[$e];st.used&&(st.prepare(this.context),st.getSource().usedInConflation&&++V)}let Q=!1;for(const $e of O)$e.isHidden(this.transform.zoom)||($e.type==="clip"&&(Q=!0),this.prepareLayer($e));const W={},te={},ee={},le={},pe={};for(const $e in B){const st=B[$e];W[$e]=st.getVisibleCoordinates(),te[$e]=W[$e].slice().reverse(),ee[$e]=st.getVisibleCoordinates(!0).reverse(),le[$e]=st.getShadowCasterCoordinates(),pe[$e]=st.sortCoordinatesByDistance(W[$e])}const fe=$e=>{const st=this.style.getLayerSourceCache($e);return st&&st.used?st.getSource():null};if(V||Q||this._clippingActiveLastFrame){const $e=[],st=[];let xt=0;for(const He of O)this.isSourceForClippingOrConflation(He,fe(He))&&($e.push(He),st.push(xt)),xt++;if($e&&(Q||$e.length>1)||this._clippingActiveLastFrame){Q=!1;const He=[];for(let ft=0;ft<$e.length;ft++){const at=$e[ft],Mt=st[ft],_t=this.style.getLayerSourceCache(at);if(!_t||!_t.used||!_t.getSource().usedInConflation&&at.type!=="clip")continue;let dt=s.dx,bt=s.by.None;const It=[];let Ot=!0;if(at.type==="clip"){dt=Mt;for(const jt of at.layout.get("clip-layer-types"))bt|=jt==="model"?s.by.Model:jt==="symbol"?s.by.Symbol:s.by.FillExtrusion;for(const jt of at.layout.get("clip-layer-scope"))It.push(jt);at.isHidden(this.transform.zoom)?Ot=!1:Q=!0}Ot&&He.push({layer:at.fqid,cache:_t,order:dt,clipMask:bt,clipScope:It})}this.replacementSource.setSources(He),G=!0}}this._clippingActiveLastFrame=Q,G||this.replacementSource.clear(),this.conflationActive=G,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let $e=0;$e<O.length;$e++){const st=O[$e],xt=st.cutoffRange();if(this.longestCutoffRange=Math.max(xt,this.longestCutoffRange),xt>0){const He=fe(st);He&&(this.minCutoffZoom=Math.max(He.minzoom,this.minCutoffZoom)),st.minzoom&&(this.minCutoffZoom=Math.max(st.minzoom,this.minCutoffZoom))}st.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=$e),this._lastOcclusionLayer=$e)}const Te=this.style&&this.style.fog;Te?(this._fogVisible=Te.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=Te.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(ee),this.opaquePassCutoff=0,M=w(),O=M.map($e=>_[$e]));const _e=this._shadowRenderer;if(_e){_e.updateShadowParameters(this.transform,this.style.directionalLight);for(const $e in B)for(const st of W[$e]){let xt={min:0,max:0};this.terrain&&(xt=this.terrain.getMinMaxForTile(st)||xt),_e.addShadowReceiver(st.toUnwrapped(),xt.min,xt.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new s.dw(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new J0(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const xe=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),ge=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(xe&&!this._snow&&(this._snow=new Xg(this)),!xe&&this._snow&&(this._snow.destroy(),delete this._snow),ge&&!this._rain&&(this._rain=new Zu(this)),!ge&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),!rr.has(this.context.gl))return;this.renderPass="offscreen";for(const $e of O){const st=r.getLayerSourceCache($e);if(!$e.hasOffscreenPass()||$e.isHidden(this.transform.zoom))continue;const xt=st?te[st.id]:void 0;($e.type==="custom"||$e.type==="raster"||$e.type==="raster-particle"||$e.isSky()||xt&&xt.length)&&this.renderLayer(this,st,$e,xt)}this.depthRangeFor3D=[0,1-(O.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,le)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Re=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Fe=(()=>{if(o.showOverdrawInspector)return s.aj.black;const $e=this.style.fog;if($e&&this.transform.projection.supportsFog){const st=this.style.getLut($e.scope);if(!Re){const xt=$e.properties.get("color-use-theme")==="none",He=$e.properties.get("color").toRenderColor(xt?null:st).toArray01();return new s.aj(...He)}if(Re){const xt=$e.properties.get("space-color-use-theme")==="none",He=$e.properties.get("space-color").toRenderColor(xt?null:st).toArray01();return new s.aj(...He)}}return s.aj.transparent})();if(this.context.clear({color:Fe,depth:1}),this.clearStencil(),this._showOverdrawInspector=o.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Re&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=M.length-1;this.currentLayer>=0;this.currentLayer--){const $e=O[this.currentLayer],st=r.getLayerSourceCache($e);if($e.isSky())continue;const xt=st?($e.is3D()?pe:te)[st.id]:void 0;this._renderTileClippingMasks($e,st,xt),this.renderLayer(this,st,$e,xt)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Re&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||s.ae(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<M.length;this.currentLayer++){const $e=O[this.currentLayer],st=r.getLayerSourceCache($e);$e.isSky()&&this.renderLayer(this,st,$e,st?te[st.id]:void 0)}function rt($e,st){let xt;return st&&(xt=($e.type==="symbol"?ee:$e.is3D()?pe:te)[st.id]),xt}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<M.length;){const $e=O[this.currentLayer];if($e.type==="raster"||$e.type==="raster-particle"){const st=r.getLayerSourceCache($e);this.renderLayer(this,st,$e,rt($e,st))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Ke=0;_e&&(Ke=_e.getShadowCastingLayerCount());let ht=!1,ut=-1;for(let $e=0;$e<M.length;++$e){const st=O[$e];st.isHidden(this.transform.zoom)||st.is3D()&&(ut=$e)}for(z&&ut===-1&&(P=!0);this.currentLayer<M.length;){const $e=O[this.currentLayer],st=r.getLayerSourceCache($e);if($e.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped($e)){if($e.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(P&&!ht&&this.terrain&&!this.transform.isOrthographic&&(ht=!0,this.blitDepth()),z&&ut!==-1&&this.currentLayer===ut+1&&!this.transform.isOrthographic&&this.blitDepth(),$e.is3D()||this.terrain||this._renderTileClippingMasks($e,st,st?W[st.id]:void 0),this.renderLayer(this,st,$e,rt($e,st)),!this.terrain&&_e&&Ke>0&&$e.hasShadowPass()&&--Ke==0&&(_e.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const xt=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=xt;this.currentLayer++){const He=O[this.currentLayer];if(!He.hasLightBeamPass())continue;const ft=r.getLayerSourceCache(He);this.renderLayer(this,ft,He,ft?te[ft.id]:void 0)}this.currentLayer=xt,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const xt=this.currentLayer;this.depthOcclusion=!0;for(const He of this.layersWithOcclusionOpacity){this.currentLayer=He;const ft=O[this.currentLayer],at=r.getLayerSourceCache(ft),Mt=at?te[at.id]:void 0;ft.is3D()||this.terrain||this._renderTileClippingMasks(ft,at,at?W[at.id]:void 0),this.renderLayer(this,at,ft,Mt)}this.depthOcclusion=!1,this.currentLayer=xt,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let $e=null;O.forEach(st=>{const xt=r.getLayerSourceCache(st);xt&&!st.isHidden(this.transform.zoom)&&xt.getVisibleCoordinates().length&&(!$e||$e.getSource().maxzoom<xt.getSource().maxzoom)&&($e=xt)}),$e&&this.options.showTileBoundaries&&Ld.debug(this,$e,$e.getVisibleCoordinates(),s.aj.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Ld.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new s.aj(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function($e){const st=$e.transform.padding;Fg($e,$e.transform.height-(st.top||0),3,Hu),Fg($e,st.bottom||0,3,lw),Bg($e,st.left||0,3,cw),Bg($e,$e.transform.width-(st.right||0),3,K0);const xt=$e.transform.centerPoint;(function(He,ft,at,Mt){kc(He,ft-1,at-10,2,20,Mt),kc(He,ft-10,at-1,20,2,Mt)})($e,xt.x,$e.transform.height-xt.y,cp)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),G||(this.conflationActive=!1)}prepareLayer(r){this.gpuTimingStart(r);const{unsupportedLayers:o}=this.transform.projection,p=!o||!o.includes(r.type);if(zd[r.type]&&(p||this.terrain&&r.type==="custom")){const _=this.style.getLayerSourceCache(r);zd[r.type](r,_,this)}this.gpuTimingEnd()}renderLayer(r,o,p,_){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="sky"||p.type==="custom"||p.type==="model"||p.type==="raster"||p.type==="raster-particle"||_&&_.length)&&(this.id=p.id,this.gpuTimingStart(p),r.transform.projection.unsupportedLayers&&r.transform.projection.unsupportedLayers.includes(p.type)&&(!r.terrain||p.type!=="custom")||p.type==="clip"||Ld[p.type](r,o,p,_,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(r){if(!this.options.gpuTiming)return;const o=this.context.extTimerQuery,p=this.context.gl;let _=this.gpuTimers[r.id];_||(_=this.gpuTimers[r.id]={calls:0,cpuTime:0,query:p.createQuery()}),_.calls++,p.beginQuery(o.TIME_ELAPSED_EXT,_.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const r=this.context.extTimerQuery,o=this.context.gl,p=o.createQuery();this.deferredRenderGpuTimeQueries.push(p),o.beginQuery(r.TIME_ELAPSED_EXT,p)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const r=this.gpuTimers;return this.gpuTimers={},r}collectDeferredRenderGpuQueries(){const r=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],r}queryGpuTimers(r){const o={};for(const p in r){const _=r[p],x=this.context.extTimerQuery,w=x.getQueryParameter(_.query,this.context.gl.QUERY_RESULT)/1e6;x.deleteQueryEXT(_.query),o[p]=w}return o}queryGpuTimeDeferredRender(r){if(!this.options.gpuTimingDeferredRender)return 0;const o=this.context.gl;let p=0;for(const _ of r)p+=o.getQueryParameter(_,o.QUERY_RESULT)/1e6,o.deleteQuery(_);return p}translatePosMatrix(r,o,p,_,x){if(!p[0]&&!p[1])return r;const w=x?_==="map"?this.transform.angle:0:_==="viewport"?-this.transform.angle:0;if(w){const z=Math.sin(w),O=Math.cos(w);p=[p[0]*O-p[1]*z,p[0]*z+p[1]*O]}const M=[x?p[0]:s.ar(o,p[0],this.transform.zoom),x?p[1]:s.ar(o,p[1],this.transform.zoom),0],P=new Float32Array(16);return s.ab.mat4.translate(P,r,M),P}saveTileTexture(r){const o=r.size[0],p=this._tileTextures[o];p?p.push(r):this._tileTextures[o]=[r]}getTileTexture(r){const o=this._tileTextures[r];return o&&o.length>0?o.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(r,o,p){const _=p===void 0?this.terrain&&this.terrain.renderingToTexture:p,x=[];return this.style&&this.style.enable3dLights()&&(r==="globeRaster"||r==="terrainRaster"?(x.push("LIGHTING_3D_MODE"),x.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):_||x.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||x.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(x.push("TERRAIN"),this.linearFloatFilteringSupported()&&x.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&x.push("GLOBE"),!this._fogVisible||_||o!==void 0&&!o||x.push("FOG","FOG_DITHERING"),_&&x.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&x.push("OVERDRAW_INSPECTOR"),x}getOrCreateProgram(r,o){this.cache=this.cache||{};const p=o&&o.defines||[],_=o&&o.config,x=this.currentGlobalDefines(r,o&&o.overrideFog,o&&o.overrideRtt).concat(p),w=q0.cacheKey(Lu[r],r,x,_);return this.cache[w]||(this.cache[w]=new q0(this.context,r,Lu[r],_,Lg[r],x)),this.cache[w]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(r,o){if(this.style.enable3dLights()){const p=this.style.directionalLight,_=this.style.ambientLight;if(p&&_){const x=((w,M,P)=>{const z=w.properties.get("direction"),O=w.properties.get("color-use-theme")==="none",B=w.properties.get("color").toRenderColor(O?null:P.getLut(w.scope)).toArray01(),V=w.properties.get("intensity"),G=M.properties.get("color-use-theme")==="none",Q=M.properties.get("color").toRenderColor(G?null:P.getLut(M.scope)).toArray01(),W=M.properties.get("intensity"),te=[z.x,z.y,z.z],ee=s.cM(Q,W),le=s.cM(B,V);return{u_lighting_ambient_color:ee,u_lighting_directional_dir:te,u_lighting_directional_color:le,u_ground_radiance:nw(te,le,ee)}})(p,_,this.style);o.setLightsUniformValues(r,x)}}}uploadCommonUniforms(r,o,p,_,x){if(this.uploadCommonLightUniforms(r,o),this.terrain&&this.terrain.renderingToTexture)return;const w=this.style.fog;if(w){const M=w.getOpacity(this.transform.pitch),P=((z,O,B,V,G,Q,W,te,ee,le,pe,fe)=>{const Te=z.transform,_e=O.properties.get("color-use-theme")==="none",xe=O.properties.get("color").toRenderColor(_e?null:z.style.getLut(O.scope)).toArray01();xe[3]=V;const ge=z.frameCounter/1e3%1,[Re,Fe]=O.properties.get("vertical-range");return{u_fog_matrix:B?Te.calculateFogTileMatrix(B):fe||z.identityMat,u_fog_range:O.getFovAdjustedRange(Te._fov),u_fog_color:xe,u_fog_horizon_blend:O.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Re,Fe),Fe],u_fog_temporal_offset:ge,u_frustum_tl:G,u_frustum_tr:Q,u_frustum_br:W,u_frustum_bl:te,u_globe_pos:ee,u_globe_radius:le,u_viewport:pe,u_globe_transition:s.ae(Te.zoom),u_is_globe:+(Te.projection.name==="globe")}})(this,w,p,M,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*s.q.devicePixelRatio,this.transform.height*s.q.devicePixelRatio],_);o.setFogUniformValues(r,P)}x&&o.setCutoffUniformValues(r,x.uniformValues)}setTileLoadedFlag(r){this.tileLoaded=r}saveCanvasCopy(){const r=this.canvasCopy();r&&(this.frameCopies.push(r),this.tileLoaded=!1)}canvasCopy(){const r=this.context.gl,o=r.createTexture();return r.bindTexture(r.TEXTURE_2D,o),r.copyTexImage2D(r.TEXTURE_2D,0,r.RGBA,0,0,r.drawingBufferWidth,r.drawingBufferHeight,0),o}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const r=this.style&&this.style.fog;return!!r&&r.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const r=this._backgroundTiles,o=this._backgroundTiles={},p=this.transform.coveringTiles({tileSize:512});for(const _ of p)o[_.key]=r[_.key]||new wo(_,512,this.transform.tileZoom,this);return o}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(r,o){return!(!r.is3D()||r.type!=="clip"&&(r.minzoom&&r.minzoom>this.transform.zoom||(this.style._clipLayerPresent||r.sourceLayer!=="building")&&(!o||o.type!=="batched-model")))}isTileAffectedByFog(r){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let o=this._cachedTileFogOpacities[r.key];return o||(this._cachedTileFogOpacities[r.key]=o=this.style.fog.getOpacityForTile(r)),o[0]>=ve||o[1]>=ve}setupDepthForOcclusion(r,o,p){const _=this.context,x=_.gl,w=!!p;var M;p||(p={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),_.activeTexture.set(x.TEXTURE3),r&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),p.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],p.u_depth_range_unpack=[2/((M=this.depthRangeFor3D)[1]-M[0]),-1-2*M[0]/(M[1]-M[0])],p.u_occluder_half_size=.5*this.occlusionParams.occluderSize,p.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),_.activeTexture.set(x.TEXTURE0),w||o.setTerrainUniformValues(_,p)}}function gp(f,r){let o=!1,p=null;const _=()=>{p=null,o&&(f(),p=setTimeout(_,r),o=!1)};return()=>(o=!0,p||_(),p)}class ev{constructor(r){this._hashName=r&&encodeURIComponent(r),s.aP(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=gp(this._updateHashUnthrottled.bind(this),300)}addTo(r){return this._map=r,window.addEventListener("hashchange",this._onHashChange,!1),r.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const r=this._map;if(!r)return"";const o=Kg(r);if(this._hashName){const p=this._hashName;let _=!1;const x=location.hash.slice(1).split("&").map(w=>{const M=w.split("=")[0];return M===p?(_=!0,`${M}=${o}`):w}).filter(w=>w);return _||x.push(`${p}=${o}`),`#${x.join("&")}`}return`#${o}`}_getCurrentHash(){const r=location.hash.replace("#","");if(this._hashName){let o;return r.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(o=p)}),(o&&o[1]||"").split("/")}return r.split("/")}_onHashChange(){const r=this._map;if(!r)return!1;const o=this._getCurrentHash();if(o.length>=3&&!o.some(p=>isNaN(p))){const p=r.dragRotate.isEnabled()&&r.touchZoomRotate.isEnabled()?+(o[3]||0):r.getBearing();return r.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:p,pitch:+(o[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Kg(f,r){const o=f.getCenter(),p=Math.round(100*f.getZoom())/100,_=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,_),w=Math.round(o.lng*x)/x,M=Math.round(o.lat*x)/x,P=f.getBearing(),z=f.getPitch();let O=r?`/${w}/${M}/${p}`:`${p}/${M}/${w}`;return(P||z)&&(O+="/"+Math.round(10*P)/10),z&&(O+=`/${Math.round(z)}`),O}const Od={linearity:.3,easing:s.dy(0,0,.3,1)},tv=s.l({deceleration:2500,maxSpeed:1400},Od),iv=s.l({deceleration:20,maxSpeed:1400},Od),nv=s.l({deceleration:1e3,maxSpeed:360},Od),rv=s.l({deceleration:1e3,maxSpeed:90},Od);class sv{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.q.now(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,o=s.q.now();for(;r.length>0&&o-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const o={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:x}of this._inertiaBuffer)o.zoom+=x.zoomDelta||0,o.bearing+=x.bearingDelta||0,o.pitch+=x.pitchDelta||0,x.panDelta&&o.pan._add(x.panDelta),x.around&&(o.around=x.around),x.pinchAround&&(o.pinchAround=x.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(o.pan.mag()){const x=Nd(o.pan.mag(),p,s.l({},tv,r||{}));_.offset=o.pan.mult(x.amount/o.pan.mag()),_.center=this._map.transform.center,kd(_,x)}if(o.zoom){const x=Nd(o.zoom,p,iv);_.zoom=this._map.transform.zoom+x.amount,kd(_,x)}if(o.bearing){const x=Nd(o.bearing,p,nv);_.bearing=this._map.transform.bearing+s.aw(x.amount,-179,179),kd(_,x)}if(o.pitch){const x=Nd(o.pitch,p,rv);_.pitch=this._map.transform.pitch+x.amount,kd(_,x)}if(_.zoom||_.bearing){const x=o.pinchAround===void 0?o.around:o.pinchAround;_.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),_.noMoveStart=!0,_}}function kd(f,r){(!f.duration||f.duration<r.duration)&&(f.duration=r.duration,f.easing=r.easing)}function Nd(f,r,o){const{maxSpeed:p,linearity:_,deceleration:x}=o,w=s.aw(f*_/(r/1e3),-p,p),M=Math.abs(w)/(x*_);return{easing:o.easing,duration:1e3*M,amount:w*(M/2)}}class na extends s.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,o,p,_={}){const x=Ae(o.getCanvasContainer(),p),w=o.unproject(x);super(r,s.l({point:x,lngLat:w,originalEvent:p},_)),this._defaultPrevented=!1,this.target=o}}class Fd extends s.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,o,p){const _=r==="touchend"?p.changedTouches:p.touches,x=Ve(o.getCanvasContainer(),_),w=x.map(P=>o.unproject(P)),M=x.reduce((P,z,O,B)=>P.add(z.div(B.length)),new s.P(0,0));super(r,{points:x,point:M,lngLats:w,lngLat:o.unproject(M),originalEvent:p}),this._defaultPrevented=!1}}class av extends s.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,o){super("wheel",{originalEvent:o}),this._defaultPrevented=!1}}class hw{constructor(r,o){this._map=r,this._clickTolerance=o.clickTolerance}reset(){this._mousedownPos=void 0}wheel(r){return this._firePreventable(new av(this._map,r))}mousedown(r,o){return this._mousedownPos=o,this._firePreventable(new na(r.type,this._map,r))}mouseup(r){this._map.fire(new na(r.type,this._map,r))}preclick(r){const o=s.l({},r);o.type="preclick",this._map.fire(new na(o.type,this._map,o))}click(r,o){this._mousedownPos&&this._mousedownPos.dist(o)>=this._clickTolerance||(this.preclick(r),this._map.fire(new na(r.type,this._map,r)))}dblclick(r){return this._firePreventable(new na(r.type,this._map,r))}mouseover(r){this._map.fire(new na(r.type,this._map,r))}mouseout(r){this._map.fire(new na(r.type,this._map,r))}touchstart(r){return this._firePreventable(new Fd(r.type,this._map,r))}touchmove(r){this._map.fire(new Fd(r.type,this._map,r))}touchend(r){this._map.fire(new Fd(r.type,this._map,r))}touchcancel(r){this._map.fire(new Fd(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class dw{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(r){this._map.fire(new na(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new na("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._map.fire(new na(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class $n{constructor(r,o){this._map=r,this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=o.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,o){this.isEnabled()&&r.shiftKey&&r.button===0&&(We(),this._startPos=this._lastPos=o,this._active=!0)}mousemoveWindow(r,o){if(!this._active)return;const p=o,_=this._startPos,x=this._lastPos;if(!_||!x||x.equals(p)||!this._box&&p.dist(_)<this._clickTolerance)return;this._lastPos=p,this._box||(this._box=Xe("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",r));const w=Math.min(_.x,p.x),M=Math.max(_.x,p.x),P=Math.min(_.y,p.y),z=Math.max(_.y,p.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${w}px,${P}px)`,this._box.style.width=M-w+"px",this._box.style.height=z-P+"px")})}mouseupWindow(r,o){if(!this._active)return;const p=this._startPos,_=o;if(p&&r.button===0){if(this.reset(),we(),p.x!==_.x||p.y!==_.y)return this._map.fire(new s.z("boxzoomend",{originalEvent:r})),{cameraAnimation:x=>x.fitScreenCoordinates(p,_,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",r)}}keydown(r){this._active&&r.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",r))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Ct(),delete this._startPos,delete this._lastPos}_fireEvent(r,o){return this._map.fire(new s.z(r,{originalEvent:o}))}}function _p(f,r){const o={};for(let p=0;p<f.length;p++)o[f[p].identifier]=r[p];return o}class fw{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(r,o,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=r.timeStamp),p.length===this.numTouches&&(this.centroid=function(_){const x=new s.P(0,0);for(const w of _)x._add(w);return x.div(_.length)}(o),this.touches=_p(p,o)))}touchmove(r,o,p){if(this.aborted||!this.centroid)return;const _=_p(p,o);for(const x in this.touches){const w=_[x];(!w||w.dist(this.touches[x])>30)&&(this.aborted=!0)}}touchend(r,o,p){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class Qg{constructor(r){this.singleTap=new fw(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(r,o,p){this.singleTap.touchstart(r,o,p)}touchmove(r,o,p){this.singleTap.touchmove(r,o,p)}touchend(r,o,p){const _=this.singleTap.touchend(r,o,p);if(_){const x=r.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(_)<30;if(x&&w||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class Bd{constructor(){this._zoomIn=new Qg({numTouches:1,numTaps:2}),this._zoomOut=new Qg({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,o,p){this._zoomIn.touchstart(r,o,p),this._zoomOut.touchstart(r,o,p)}touchmove(r,o,p){this._zoomIn.touchmove(r,o,p),this._zoomOut.touchmove(r,o,p)}touchend(r,o,p){const _=this._zoomIn.touchend(r,o,p),x=this._zoomOut.touchend(r,o,p);return _?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()+1,around:w.unproject(_)},{originalEvent:r})}):x?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()-1,around:w.unproject(x)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const ov={0:1,2:2};class Vd{constructor(r){this.reset(),this._clickTolerance=r.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(r,o){return!1}_move(r,o){return{}}mousedown(r,o){if(this._lastPoint)return;const p=De(r);this._correctButton(r,p)&&(this._lastPoint=o,this._eventButton=p)}mousemoveWindow(r,o){const p=this._lastPoint;if(p){if(r.preventDefault(),this._eventButton!=null&&function(_,x){const w=ov[x];return _.buttons===void 0||(_.buttons&w)!==w}(r,this._eventButton))this.reset();else if(this._moved||!(o.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=o,this._move(p,o)}}mouseupWindow(r){this._lastPoint&&De(r)===this._eventButton&&(this._moved&&we(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class yp extends Vd{mousedown(r,o){super.mousedown(r,o),this._lastPoint&&(this._active=!0)}_correctButton(r,o){return o===0&&!r.ctrlKey}_move(r,o){return{around:o,panDelta:o.sub(r)}}}class Io extends Vd{_correctButton(r,o){return o===0&&r.ctrlKey||o===2}_move(r,o){const p=.8*(o.x-r.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(r){r.preventDefault()}}class Ud extends Vd{_correctButton(r,o){return o===0&&r.ctrlKey||o===2}_move(r,o){const p=-.5*(o.y-r.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(r){r.preventDefault()}}class Jn{constructor(r,o){this._map=r,this._el=r.getCanvasContainer(),this._minTouches=1,this._clickTolerance=o.clickTolerance||1,this.reset(),s.aP(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}touchstart(r,o,p){return this._calculateTransform(r,o,p)}touchmove(r,o,p){if(this._active&&!(p.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(p.length===1&&!s.dz())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return r.cancelable&&r.preventDefault(),this._calculateTransform(r,o,p)}}touchend(r,o,p){this._calculateTransform(r,o,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,o,p){p.length>0&&(this._active=!0);const _=_p(p,o),x=new s.P(0,0),w=new s.P(0,0);let M=0;for(const z in _){const O=_[z],B=this._touches[z];B&&(x._add(O),w._add(O.sub(B)),M++,_[z]=O)}if(this._touches=_,M<this._minTouches||!w.mag())return;const P=w.div(M);return this._sum._add(P),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(M),panDelta:P}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Xe("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class ka{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(r){}_move(r,o,p){return{}}touchstart(r,o,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([o[0],o[1]]))}touchmove(r,o,p){const _=this._firstTwoTouches;if(!_)return;r.preventDefault();const[x,w]=_,M=Wu(p,o,x),P=Wu(p,o,w);if(!M||!P)return;const z=this._aroundCenter?null:M.add(P).div(2);return this._move([M,P],z,r)}touchend(r,o,p){if(!this._firstTwoTouches)return;const[_,x]=this._firstTwoTouches,w=Wu(p,o,_),M=Wu(p,o,x);w&&M||(this._active&&we(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&r.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Wu(f,r,o){for(let p=0;p<f.length;p++)if(f[p].identifier===o)return r[p]}function jd(f,r){return Math.log(f/r)/Math.LN2}class lv extends ka{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,o){const p=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(jd(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:jd(this._distance,p),pinchAround:o}}}function cv(f,r){return 180*f.angleWith(r)/Math.PI}class qd extends ka{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,o){const p=this._vector;if(this._vector=r[0].sub(r[1]),p&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:cv(this._vector,p),pinchAround:o}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const o=25/(Math.PI*this._minDiameter)*360,p=this._startVector;if(!p)return!1;const _=cv(r,p);return Math.abs(_)<o}}function Jg(f){return Math.abs(f.y)>Math.abs(f.x)}class pw extends ka{constructor(r){super(),this._map=r}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(r){this._lastPoints=r,Jg(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,o,p){const _=this._lastPoints;if(!_)return;const x=r[0].sub(_[0]),w=r[1].sub(_[1]);return this._map._cooperativeGestures&&!s.dz()&&p.touches.length<3||(this._valid=this.gestureBeginsVertically(x,w,p.timeStamp),!this._valid)?void 0:(this._lastPoints=r,this._active=!0,{pitchDelta:(x.y+w.y)/2*-.5})}gestureBeginsVertically(r,o,p){if(this._valid!==void 0)return this._valid;const _=r.mag()>=2,x=o.mag()>=2;if(!_&&!x)return;if(!_||!x)return this._firstMove==null&&(this._firstMove=p),p-this._firstMove<100&&void 0;const w=r.y>0==o.y>0;return Jg(r)&&Jg(o)&&w}}const e_={panStep:100,bearingStep:15,pitchStep:10};class t_{constructor(){const r=e_;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let o=0,p=0,_=0,x=0,w=0;switch(r.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:r.shiftKey?p=-1:(r.preventDefault(),x=-1);break;case 39:r.shiftKey?p=1:(r.preventDefault(),x=1);break;case 38:r.shiftKey?_=1:(r.preventDefault(),w=-1);break;case 40:r.shiftKey?_=-1:(r.preventDefault(),w=1);break;default:return}return this._rotationDisabled&&(p=0,_=0),{cameraAnimation:M=>{const P=M.getZoom();M.easeTo({duration:300,easeId:"keyboardHandler",easing:Fc,zoom:o?Math.round(P)+o*(r.shiftKey?2:1):P,bearing:M.getBearing()+p*this._bearingStep,pitch:M.getPitch()+_*this._pitchStep,offset:[-x*this._panStep,-w*this._panStep],center:M.getCenter()},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Fc(f){return f*(2-f)}const Bc=4.000244140625,hl=1/450;class to{constructor(r,o){this._map=r,this._el=r.getCanvasContainer(),this._handler=o,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=hl,s.aP(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&r.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(r){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(r.ctrlKey||r.metaKey||this.isZooming()||s.dz()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let o=r.deltaMode===WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const p=s.q.now(),_=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,o!==0&&o%Bc==0?this._type="wheel":o!==0&&Math.abs(o)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=o,this._timeout=window.setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(_*o)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,o+=this._lastValue)),r.shiftKey&&o&&(o/=4),this._type&&(this._lastWheelEvent=r,this._delta-=o,this._active||this._start(r)),r.preventDefault()}_onTimeout(r){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(r)}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const o=Ae(this._el,r);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:o,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._map.transform;this._type==="wheel"&&r.projection.wrap&&(r._center.lng>=180||r._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const o=()=>r._terrainEnabled()&&this._aroundCoord?r.computeZoomRelativeTo(this._aroundCoord):r.zoom;if(this._delta!==0){const z=this._type==="wheel"&&Math.abs(this._delta)>Bc?this._wheelZoomRate:this._defaultZoomRate;let O=2/(1+Math.exp(-Math.abs(this._delta*z)));this._delta<0&&O!==0&&(O=1/O);const B=o(),V=Math.pow(2,B),G=typeof this._targetZoom=="number"?r.zoomScale(this._targetZoom):V;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(G*O))),this._type==="wheel"&&(this._startZoom=B,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const p=typeof this._targetZoom=="number"?this._targetZoom:o(),_=this._startZoom,x=this._easing;let w,M=!1;if(this._type==="wheel"&&_&&x){const z=Math.min((s.q.now()-this._lastWheelEventTime)/200,1),O=x(z);w=s.af(_,p,O),z<1?this._frameId||(this._frameId=!0):M=!0}else w=p,M=!0;this._active=!0,M&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let P=w-o();return P*this._lastDelta<0&&(P=0),{noInertia:!0,needsRenderFrame:!M,zoomDelta:P,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let o=s.dA;if(this._prevEase){const p=this._prevEase,_=(s.q.now()-p.start)/p.duration,x=p.easing(_+.01)-p.easing(_),w=.27/Math.sqrt(x*x+1e-4)*.01,M=Math.sqrt(.0729-w*w);o=s.dy(w,M,.25,1)}return this._prevEase={start:s.q.now(),duration:r,easing:o},o}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Xe("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Xl{constructor(r,o){this._clickZoom=r,this._tapZoom=o}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Vc{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(r,o){return r.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(r.shiftKey?-1:1),around:p.unproject(o)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Yl{constructor(){this._tap=new Qg({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(r,o,p){this._swipePoint||(this._tapTime&&r.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=o[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(r,o,p))}touchmove(r,o,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const _=o[0],x=_.y-this._swipePoint.y;return this._swipePoint=_,r.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(r,o,p)}touchend(r,o,p){this._tapTime?this._swipePoint&&p.length===0&&this.reset():this._tap.touchend(r,o,p)&&(this._tapTime=r.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class mw{constructor(r,o,p){this._el=r,this._mousePan=o,this._touchPan=p}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class gw{constructor(r,o,p){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=o,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class _w{constructor(r,o,p,_){this._el=r,this._touchZoom=o,this._touchRotate=p,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const vp=f=>f.zoom||f.drag||f.pitch||f.rotate;class uv extends s.z{}class ws{constructor(){this.constants=[1,1,.01],this.radius=0}setup(r,o){const p=s.ab.vec3.sub([],o,r);this.radius=s.ab.vec3.length(p[2]<0?s.ab.vec3.div([],p,this.constants):[p[0],p[1],0])}projectRay(r){s.ab.vec3.div(r,r,this.constants),s.ab.vec3.normalize(r,r),s.ab.vec3.mul(r,r,this.constants);const o=s.ab.vec3.scale([],r,this.radius);if(o[2]>0){const p=s.ab.vec3.scale([],[0,0,1],s.ab.vec3.dot(o,[0,0,1])),_=s.ab.vec3.scale([],s.ab.vec3.normalize([],[o[0],o[1],0]),this.radius),x=s.ab.vec3.add([],o,s.ab.vec3.scale([],s.ab.vec3.sub([],s.ab.vec3.add([],_,p),o),2));o[0]=x[0],o[1]=x[1]}return o}}function Xu(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class hv{constructor(r,o){this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new sv(r),this._bearingSnap=o.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new ws,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(o),s.aP(["handleEvent","handleWindowEvent"],this);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[_,x,w]of this._listeners){const M=_===document?this.handleWindowEvent:this.handleEvent;_.addEventListener(x,M,w)}}destroy(){for(const[r,o,p]of this._listeners){const _=r===document?this.handleWindowEvent:this.handleEvent;r.removeEventListener(o,_,p)}}_addDefaultHandlers(r){const o=this._map,p=o.getCanvasContainer();this._add("mapEvent",new hw(o,r));const _=o.boxZoom=new $n(o,r);this._add("boxZoom",_);const x=new Bd,w=new Vc;o.doubleClickZoom=new Xl(w,x),this._add("tapZoom",x),this._add("clickZoom",w);const M=new Yl;this._add("tapDragZoom",M);const P=o.touchPitch=new pw(o);this._add("touchPitch",P);const z=new Io(r),O=new Ud(r);o.dragRotate=new gw(r,z,O),this._add("mouseRotate",z,["mousePitch"]),this._add("mousePitch",O,["mouseRotate"]);const B=new yp(r),V=new Jn(o,r);o.dragPan=new mw(p,B,V),this._add("mousePan",B),this._add("touchPan",V,["touchZoom","touchRotate"]);const G=new qd,Q=new lv;o.touchZoomRotate=new _w(p,Q,G,M),this._add("touchRotate",G,["touchPan","touchZoom"]),this._add("touchZoom",Q,["touchPan","touchRotate"]),this._add("blockableMapEvent",new dw(o));const W=o.scrollZoom=new to(o,this);this._add("scrollZoom",W,["mousePan"]);const te=o.keyboard=new t_;this._add("keyboard",te);for(const ee of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])r.interactive&&r[ee]&&o[ee].enable(r[ee])}_add(r,o,p){this._handlers.push({handlerName:r,handler:o,allowed:p}),this._handlersById[r]=o}stop(r){if(!this._updatingCamera){for(const{handler:o}of this._handlers)o.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!vp(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(r,o,p){for(const _ in r)if(_!==p&&(!o||o.indexOf(_)<0))return!0;return!1}handleWindowEvent(r){this.handleEvent(r,`${r.type}Window`)}_getMapTouches(r){const o=[];for(const p of r)this._el.contains(p.target)&&o.push(p);return o}handleEvent(r,o){this._updatingCamera=!0;const p=r.type==="renderFrame",_=p?void 0:r,x={needsRenderFrame:!1},w={},M={},P=r.touches?this._getMapTouches(r.touches):void 0,z=P?Ve(this._el,P):p?void 0:Ae(this._el,r);for(const{handlerName:V,handler:G,allowed:Q}of this._handlers){if(!G.isEnabled())continue;let W;this._blockedByActive(M,Q,V)?G.reset():G[o||r.type]&&(W=G[o||r.type](r,z,P),this.mergeHandlerResult(x,w,W,V,_),W&&W.needsRenderFrame&&this._triggerRenderFrame()),(W||G.isActive())&&(M[V]=G)}const O={};for(const V in this._previousActiveHandlers)M[V]||(O[V]=_);this._previousActiveHandlers=M,(Object.keys(O).length||Xu(x))&&(this._changes.push([x,w,O]),this._triggerRenderFrame()),(Object.keys(M).length||Xu(x))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:B}=x;B&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],B(this._map))}mergeHandlerResult(r,o,p,_,x){if(!p)return;s.l(r,p);const w={handlerName:_,originalEvent:p.originalEvent||x};p.zoomDelta!==void 0&&(o.zoom=w),p.panDelta!==void 0&&(o.drag=w),p.pitchDelta!==void 0&&(o.pitch=w),p.bearingDelta!==void 0&&(o.rotate=w)}_applyChanges(){const r={},o={},p={};for(const[_,x,w]of this._changes)_.panDelta&&(r.panDelta=(r.panDelta||new s.P(0,0))._add(_.panDelta)),_.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+_.pitchDelta),_.around!==void 0&&(r.around=_.around),_.aroundCoord!==void 0&&(r.aroundCoord=_.aroundCoord),_.pinchAround!==void 0&&(r.pinchAround=_.pinchAround),_.noInertia&&(r.noInertia=_.noInertia),s.l(o,x),s.l(p,w);this._updateMapTransform(r,o,p),this._changes=[]}_updateMapTransform(r,o,p){const _=this._map,x=_.transform,w=le=>[le.x,le.y,le.z];if((le=>{const pe=this._eventsInProgress.drag;return pe&&!this._handlersById[pe.handlerName].isActive()})()&&!Xu(r)){const le=x.zoom;x.cameraElevationReference="sea",this._originalZoom!=null&&x._orthographicProjectionAtLowPitch&&x.projection.name!=="globe"&&x.pitch===0?(x.cameraElevationReference="ground",x.zoom=this._originalZoom):(x.recenterOnTerrain(),x.cameraElevationReference="ground"),le!==x.zoom&&this._map._update(!0)}if(x._isCameraConstrained&&_._stop(!0),!Xu(r))return void this._fireEvents(o,p,!0);let{panDelta:M,zoomDelta:P,bearingDelta:z,pitchDelta:O,around:B,aroundCoord:V,pinchAround:G}=r;x._isCameraConstrained&&(P>0&&(P=0),x._isCameraConstrained=!1),G!==void 0&&(B=G),(P||(le=>o[le]&&!this._eventsInProgress[le])("drag"))&&B&&(this._dragOrigin=w(x.pointCoordinate3D(B)),this._originalZoom=x.zoom,this._trackingEllipsoid.setup(x._camera.position,this._dragOrigin)),x.cameraElevationReference="sea",_._stop(!0),B=B||_.transform.centerPoint,z&&(x.bearing+=z),O&&(x.pitch+=O),x._updateCameraState();const Q=[0,0,0];if(M)if(x.projection.name==="mercator"){const le=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(B).dir),pe=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(B.sub(M)).dir);Q[0]=pe[0]-le[0],Q[1]=pe[1]-le[1]}else{const le=x.pointCoordinate(B);if(x.projection.name==="globe"){M=M.rotate(-x.angle);const pe=x._pixelsPerMercatorPixel/x.worldSize;Q[0]=-M.x*s.dB(s.aS(le.y))*pe,Q[1]=-M.y*s.dB(x.center.lat)*pe}else{const pe=x.pointCoordinate(B.sub(M));le&&pe&&(Q[0]=pe.x-le.x,Q[1]=pe.y-le.y)}}const W=x.zoom,te=[0,0,0];if(P){const le=w(V||x.pointCoordinate3D(B)),pe={dir:s.ab.vec3.normalize([],s.ab.vec3.sub([],le,x._camera.position))};if(pe.dir[2]<0){const fe=x.zoomDeltaToMovement(le,P);s.ab.vec3.scale(te,pe.dir,fe)}}const ee=s.ab.vec3.add(Q,Q,te);x._translateCameraConstrained(ee),P&&Math.abs(x.zoom-W)>1e-4&&x.recenterOnTerrain(),x.cameraElevationReference="ground",this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(o,p,!0)}_fireEvents(r,o,p){const _=vp(this._eventsInProgress),x=vp(r),w={};for(const O in r){const{originalEvent:B}=r[O];this._eventsInProgress[O]||(w[`${O}start`]=B),this._eventsInProgress[O]=r[O]}!_&&x&&this._fireEvent("movestart",x.originalEvent);for(const O in w)this._fireEvent(O,w[O]);x&&this._fireEvent("move",x.originalEvent);for(const O in r){const{originalEvent:B}=r[O];this._fireEvent(O,B)}const M={};let P;for(const O in this._eventsInProgress){const{handlerName:B,originalEvent:V}=this._eventsInProgress[O];this._handlersById[B].isActive()||(delete this._eventsInProgress[O],P=o[B]||V,M[`${O}end`]=P)}for(const O in M)this._fireEvent(O,M[O]);const z=vp(this._eventsInProgress);if(p&&(_||x)&&!z){this._updatingCamera=!0;const O=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),B=V=>V!==0&&-this._bearingSnap<V&&V<this._bearingSnap;O?(B(O.bearing||this._map.getBearing())&&(O.bearing=0),this._map.easeTo(O,{originalEvent:P})):(this._map.fire(new s.z("moveend",{originalEvent:P})),B(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(r,o){this._map.fire(new s.z(r,o?{originalEvent:o}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{this._frameId=void 0,this.handleEvent(new uv("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const dv="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Yu extends s.E{constructor(r,o){super(),this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=o.bearingSnap,this._respectPrefersReducedMotion=o.respectPrefersReducedMotion!==!1,s.aP(["_renderFrameCallback"],this)}getCenter(){return new s.bO(this.transform.center.lng,this.transform.center.lat)}setCenter(r,o){return this.jumpTo({center:r},o)}panBy(r,o,p){return r=s.P.convert(r).mult(-1),this.panTo(this.transform.center,s.l({offset:r},o),p)}panTo(r,o,p){return this.easeTo(s.l({center:r},o),p)}getZoom(){return this.transform.zoom}setZoom(r,o){return this.jumpTo({zoom:r},o),this}zoomTo(r,o,p){return this.easeTo(s.l({zoom:r},o),p)}zoomIn(r,o){return this.zoomTo(this.getZoom()+1,r,o),this}zoomOut(r,o){return this.zoomTo(this.getZoom()-1,r,o),this}getBearing(){return this.transform.bearing}setBearing(r,o){return this.jumpTo({bearing:r},o),this}getPadding(){return this.transform.padding}setPadding(r,o){return this.jumpTo({padding:r},o),this}rotateTo(r,o,p){return this.easeTo(s.l({bearing:r},o),p)}resetNorth(r,o){return this.rotateTo(0,s.l({duration:1e3},r),o),this}resetNorthPitch(r,o){return this.easeTo(s.l({bearing:0,pitch:0,duration:1e3},r),o),this}snapToNorth(r,o){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,o):this}getPitch(){return this.transform.pitch}setPitch(r,o){return this.jumpTo({pitch:r},o),this}cameraForBounds(r,o){r=s.az.convert(r);const p=o&&o.bearing||0,_=o&&o.pitch||0,x=r.getNorthWest(),w=r.getSouthEast();return this._cameraForBounds(this.transform,x,w,p,_,o)}_extendPadding(r){const o={top:0,right:0,bottom:0,left:0};return r==null?s.l({},o,this.transform.padding):typeof r=="number"?{top:r,bottom:r,right:r,left:r}:s.l({},o,r)}_extendCameraOptions(r){return(r=s.l({offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding=this._extendPadding(r.padding),r}_minimumAABBFrustumDistance(r,o){const p=o.max[0]-o.min[0],_=o.max[1]-o.min[1];return p/_>r.aspect?p/(2*Math.tan(.5*r.fovX)*r.aspect):_/(2*Math.tan(.5*r.fovY)*r.aspect)}_cameraForBoundsOnGlobe(r,o,p,_,x,w){const M=r.clone(),P=this._extendCameraOptions(w);M.bearing=_,M.pitch=x;const z=s.bO.convert(o),O=s.bO.convert(p),B=.5*(z.lat+O.lat),V=.5*(z.lng+O.lng),G=s.dC(B,V),Q=s.ab.vec3.normalize([],G),W=s.ab.vec3.normalize([],s.ab.vec3.cross([],Q,[0,1,0])),te=s.ab.vec3.cross([],W,Q),ee=[W[0],W[1],W[2],0,te[0],te[1],te[2],0,Q[0],Q[1],Q[2],0,0,0,0,1],le=[G,s.dC(z.lat,z.lng),s.dC(O.lat,z.lng),s.dC(O.lat,O.lng),s.dC(z.lat,O.lng),s.dC(B,z.lng),s.dC(B,O.lng),s.dC(z.lat,V),s.dC(O.lat,V)];let pe=s.cd.fromPoints(le.map(at=>[s.ab.vec3.dot(W,at),s.ab.vec3.dot(te,at),s.ab.vec3.dot(Q,at)]));const fe=s.ab.vec3.transformMat4([],pe.center,ee);s.ab.vec3.squaredLength(fe)===0&&s.ab.vec3.set(fe,0,0,1),s.ab.vec3.normalize(fe,fe),s.ab.vec3.scale(fe,fe,s.ax),M.center=s.dD(fe);const Te=M.getWorldToCameraMatrix(),_e=s.ab.mat4.invert(new Float64Array(16),Te);pe=s.cd.applyTransform(pe,s.ab.mat4.multiply([],Te,ee));const xe=this._extendAABB(pe,M,P,_);if(!xe)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");pe=xe,s.ab.vec3.transformMat4(fe,fe,Te);const ge=.5*(pe.max[2]-pe.min[2]),Re=this._minimumAABBFrustumDistance(M,pe),Fe=s.ab.vec3.scale([],[0,0,1],ge),rt=s.ab.vec3.add(Fe,fe,Fe),Ke=Re+(M.pitch===0?0:s.ab.vec3.distance(fe,rt)),ht=M.globeCenterInViewSpace,ut=s.ab.vec3.sub([],fe,[ht[0],ht[1],ht[2]]);s.ab.vec3.normalize(ut,ut),s.ab.vec3.scale(ut,ut,Ke);const $e=s.ab.vec3.add([],fe,ut);s.ab.vec3.transformMat4($e,$e,_e);const st=s.ds/s.ax,xt=s.ab.vec3.length($e),He=s.bH(Math.max(xt*st-s.ds,Number.EPSILON),0),ft=Math.min(M.zoomFromMercatorZAdjusted(He),P.maxZoom);return ft>.5*(s.c6+s.bY)?(M.setProjection({name:"mercator"}),M.zoom=ft,this._cameraForBounds(M,o,p,_,x,w)):{center:M.center,zoom:ft,bearing:_,pitch:x}}_extendAABB(r,o,p,_){const x=.5*((p.padding.left||0)+(p.padding.right||0)),w=.5*((p.padding.top||0)+(p.padding.bottom||0)),M=w,P=x,z=x,O=w,B=o.width-(P+z),V=o.height-(M+O),G=s.ab.vec3.sub([],r.max,r.min),Q=Math.min(B/G[0],V/G[1]),W=Math.min(o.scaleZoom(o.scale*Q),p.maxZoom);if(isNaN(W))return null;const te=o.scale/o.zoomScale(W),ee=new s.cd([r.min[0]-P*te,r.min[1]-O*te,r.min[2]],[r.max[0]+z*te,r.max[1]+M*te,r.max[2]]),le=(typeof p.offset.x=="number"&&typeof p.offset.y=="number"?new s.P(p.offset.x,p.offset.y):s.P.convert(p.offset)).rotate(-s.ai(_));return ee.center[0]-=le.x*te,ee.center[1]+=le.y*te,ee}queryTerrainElevation(r,o){const p=this.transform.elevation;return p?(o=s.l({},{exaggerated:!0},o),p.getAtPoint(s.aa.fromLngLat(r),null,o.exaggerated)):null}_cameraForBounds(r,o,p,_,x,w){if(r.projection.name==="globe")return this._cameraForBoundsOnGlobe(r,o,p,_,x,w);const M=r.clone(),P=this._extendCameraOptions(w);M.bearing=_,M.pitch=x;const z=s.bO.convert(o),O=s.bO.convert(p),B=new s.bO(z.lng,O.lat),V=new s.bO(O.lng,z.lat),G=M.project(z),Q=M.project(O),W=this.queryTerrainElevation(z),te=this.queryTerrainElevation(O),ee=this.queryTerrainElevation(B),le=this.queryTerrainElevation(V),pe=[[G.x,G.y,Math.min(W||0,te||0,ee||0,le||0)],[Q.x,Q.y,Math.max(W||0,te||0,ee||0,le||0)]];let fe=s.cd.fromPoints(pe);const Te=M.getWorldToCameraMatrix(),_e=s.ab.mat4.invert(new Float64Array(16),Te);fe=s.cd.applyTransform(fe,Te);const xe=this._extendAABB(fe,M,P,_);if(!xe)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");fe=xe;const ge=.5*s.ab.vec3.sub([],fe.max,fe.min)[2],Re=this._minimumAABBFrustumDistance(M,fe),Fe=[0,0,1,0];s.ab.vec4.transformMat4(Fe,Fe,Te),s.ab.vec4.normalize(Fe,Fe);const rt=s.ab.vec3.scale([],Fe,Re+ge),Ke=s.ab.vec3.add([],fe.center,rt);s.ab.vec3.transformMat4(fe.center,fe.center,_e),s.ab.vec3.transformMat4(Ke,Ke,_e);const ht=M.unproject(new s.P(fe.center[0],fe.center[1])),ut=s.dE(M.projection,ht),$e=Math.pow(2,ut),st=Math.min(M._zoomFromMercatorZ(Ke[2]*M.pixelsPerMeter*$e/M.worldSize),P.maxZoom);return M.mercatorFromTransition&&st<.5*(s.c6+s.bY)?(M.setProjection({name:"globe"}),M.zoom=st,this._cameraForBounds(M,o,p,_,x,w)):{center:ht,zoom:st,bearing:_,pitch:x}}fitBounds(r,o,p){const _=this.cameraForBounds(r,o);return this._fitInternal(_,o,p)}fitScreenCoordinates(r,o,p,_,x){const w=s.P.convert(r),M=s.P.convert(o),P=new s.P(Math.min(w.x,M.x),Math.min(w.y,M.y)),z=new s.P(Math.max(w.x,M.x),Math.max(w.y,M.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(w,M))return this;const O=this.transform.pointLocation3D(P),B=this.transform.pointLocation3D(z),V=this.transform.pointLocation3D(new s.P(P.x,z.y)),G=this.transform.pointLocation3D(new s.P(z.x,P.y)),Q=[Math.min(O.lng,B.lng,V.lng,G.lng),Math.min(O.lat,B.lat,V.lat,G.lat)],W=[Math.max(O.lng,B.lng,V.lng,G.lng),Math.max(O.lat,B.lat,V.lat,G.lat)],te=_&&_.pitch?_.pitch:this.getPitch(),ee=this._cameraForBounds(this.transform,Q,W,p,te,_);return this._fitInternal(ee,_,x)}_fitInternal(r,o,p){return r?(o=s.l(r,o)).linear?this.easeTo(o,p):this.flyTo(o,p):this}jumpTo(r,o){this.stop();const p=r.preloadOnly?this.transform.clone():this.transform;let _=!1,x=!1,w=!1;"zoom"in r&&p.zoom!==+r.zoom&&(_=!0,p.zoom=+r.zoom),r.center!==void 0&&(p.center=s.bO.convert(r.center)),"bearing"in r&&p.bearing!==+r.bearing&&(x=!0,p.bearing=+r.bearing),"pitch"in r&&p.pitch!==+r.pitch&&(w=!0,p.pitch=+r.pitch);const M=typeof r.padding=="number"?this._extendPadding(r.padding):r.padding;if(r.padding!=null&&!p.isPaddingEqual(M))if(r.retainPadding===!1){const P=p.clone();P.padding=M,p.setLocationAtPoint(p.center,P.centerPoint)}else p.padding=M;return r.preloadOnly?(this._preloadTiles(p),this):(this.fire(new s.z("movestart",o)).fire(new s.z("move",o)),_&&this.fire(new s.z("zoomstart",o)).fire(new s.z("zoom",o)).fire(new s.z("zoomend",o)),x&&this.fire(new s.z("rotatestart",o)).fire(new s.z("rotate",o)).fire(new s.z("rotateend",o)),w&&this.fire(new s.z("pitchstart",o)).fire(new s.z("pitch",o)).fire(new s.z("pitchend",o)),this.fire(new s.z("moveend",o)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.w(dv),this.transform.getFreeCameraOptions()}setFreeCameraOptions(r,o){const p=this.transform;if(!p.projection.supportsFreeCamera)return s.w(dv),this;this.stop();const _=p.zoom,x=p.pitch,w=p.bearing;p.setFreeCameraOptions(r);const M=_!==p.zoom,P=x!==p.pitch,z=w!==p.bearing;return this.fire(new s.z("movestart",o)).fire(new s.z("move",o)),M&&this.fire(new s.z("zoomstart",o)).fire(new s.z("zoom",o)).fire(new s.z("zoomend",o)),z&&this.fire(new s.z("rotatestart",o)).fire(new s.z("rotate",o)).fire(new s.z("rotateend",o)),P&&this.fire(new s.z("pitchstart",o)).fire(new s.z("pitch",o)).fire(new s.z("pitchend",o)),this.fire(new s.z("moveend",o)),this}easeTo(r,o){this._stop(!1,r.easeId),((r=s.l({offset:[0,0],duration:500,easing:s.dA},r)).animate===!1||this._prefersReducedMotion(r))&&(r.duration=0);const p=this.transform,_=this.getZoom(),x=this.getBearing(),w=this.getPitch(),M=this.getPadding(),P="zoom"in r?+r.zoom:_,z="bearing"in r?this._normalizeBearing(r.bearing,x):x,O="pitch"in r?+r.pitch:w,B=this._extendPadding(r.padding),V=s.P.convert(r.offset);let G,Q,W;if(p.projection.name==="globe"){const Fe=s.aa.fromLngLat(p.center),rt=V.rotate(-p.angle);Fe.x+=rt.x/p.worldSize,Fe.y+=rt.y/p.worldSize;const Ke=Fe.toLngLat(),ht=s.bO.convert(r.center||Ke);this._normalizeCenter(ht),G=p.centerPoint.add(rt),Q=new s.P(Fe.x,Fe.y).mult(p.worldSize),W=new s.P(s.at(ht.lng),s.aA(ht.lat)).mult(p.worldSize).sub(Q)}else{G=p.centerPoint.add(V);const Fe=p.pointLocation(G),rt=s.bO.convert(r.center||Fe);this._normalizeCenter(rt),Q=p.project(Fe),W=p.project(rt).sub(Q)}const te=p.zoomScale(P-_);let ee,le;r.around&&(ee=s.bO.convert(r.around),le=p.locationPoint(ee));const pe=this._zooming||P!==_,fe=this._rotating||x!==z,Te=this._pitching||O!==w,_e=!p.isPaddingEqual(B),xe=r.retainPadding===!1?p.clone():p,ge=Fe=>rt=>{if(pe&&(Fe.zoom=s.af(_,P,rt)),fe&&(Fe.bearing=s.af(x,z,rt)),Te&&(Fe.pitch=s.af(w,O,rt)),_e&&(xe.interpolatePadding(M,B,rt),G=xe.centerPoint.add(V)),ee)Fe.setLocationAtPoint(ee,le);else{const Ke=Fe.zoomScale(Fe.zoom-_),ht=P>_?Math.min(2,te):Math.max(.5,te),ut=Math.pow(ht,1-rt),$e=Fe.unproject(Q.add(W.mult(rt*ut)).mult(Ke));Fe.setLocationAtPoint(Fe.renderWorldCopies?$e.wrap():$e,G)}return r.preloadOnly||this._fireMoveEvents(o),Fe};if(r.preloadOnly){const Fe=this._emulate(ge,r.duration,p);return this._preloadTiles(Fe),this}const Re={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=pe,this._rotating=fe,this._pitching=Te,this._padding=_e,this._easeId=r.easeId,this._prepareEase(o,r.noMoveStart,Re),this._ease(ge(p),Fe=>{p.cameraElevationReference==="sea"&&p.recenterOnTerrain(),this._afterEase(o,Fe)},r),this}_prepareEase(r,o,p={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),o||p.moving||this.fire(new s.z("movestart",r)),this._zooming&&!p.zooming&&this.fire(new s.z("zoomstart",r)),this._rotating&&!p.rotating&&this.fire(new s.z("rotatestart",r)),this._pitching&&!p.pitching&&this.fire(new s.z("pitchstart",r))}_fireMoveEvents(r){this.fire(new s.z("move",r)),this._zooming&&this.fire(new s.z("zoom",r)),this._rotating&&this.fire(new s.z("rotate",r)),this._pitching&&this.fire(new s.z("pitch",r))}_afterEase(r,o){if(this._easeId&&o&&this._easeId===o)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const p=this._zooming,_=this._rotating,x=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new s.z("zoomend",r)),_&&this.fire(new s.z("rotateend",r)),x&&this.fire(new s.z("pitchend",r)),this.fire(new s.z("moveend",r))}flyTo(r,o){if(this._prefersReducedMotion(r)){const at=s.ay(r,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(at,o)}this.stop(),r=s.l({offset:[0,0],speed:1.2,curve:1.42,easing:s.dA},r);const p=this.transform,_=this.getZoom(),x=this.getBearing(),w=this.getPitch(),M=this.getPadding(),P="zoom"in r?s.aw(+r.zoom,p.minZoom,p.maxZoom):_,z="bearing"in r?this._normalizeBearing(r.bearing,x):x,O="pitch"in r?+r.pitch:w,B=this._extendPadding(r.padding),V=p.zoomScale(P-_),G=s.P.convert(r.offset);let Q=p.centerPoint.add(G);const W=p.pointLocation(Q),te=s.bO.convert(r.center||W);this._normalizeCenter(te);const ee=p.project(W),le=p.project(te).sub(ee);let pe=r.curve;const fe=Math.max(p.width,p.height),Te=fe/V,_e=le.mag();if("minZoom"in r){const at=s.aw(Math.min(r.minZoom,_,P),p.minZoom,p.maxZoom),Mt=fe/p.zoomScale(at-_);pe=Math.sqrt(Mt/_e*2)}const xe=pe*pe;function ge(at){const Mt=(Te*Te-fe*fe+(at?-1:1)*xe*xe*_e*_e)/(2*(at?Te:fe)*xe*_e);return Math.log(Math.sqrt(Mt*Mt+1)-Mt)}function Re(at){return(Math.exp(at)-Math.exp(-at))/2}function Fe(at){return(Math.exp(at)+Math.exp(-at))/2}const rt=ge(0);let Ke=function(at){return Fe(rt)/Fe(rt+pe*at)},ht=function(at){return fe*((Fe(rt)*(Re(Mt=rt+pe*at)/Fe(Mt))-Re(rt))/xe)/_e;var Mt},ut=(ge(1)-rt)/pe;if(Math.abs(_e)<1e-6||!isFinite(ut)){if(Math.abs(fe-Te)<1e-6)return this.easeTo(r,o);const at=Te<fe?-1:1;ut=Math.abs(Math.log(Te/fe))/pe,ht=function(){return 0},Ke=function(Mt){return Math.exp(at*pe*Mt)}}r.duration="duration"in r?+r.duration:1e3*ut/("screenSpeed"in r?+r.screenSpeed/pe:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0);const $e=x!==z,st=O!==w,xt=!p.isPaddingEqual(B),He=r.retainPadding===!1?p.clone():p,ft=at=>Mt=>{const _t=Mt*ut,dt=1/Ke(_t);at.zoom=Mt===1?P:_+at.scaleZoom(dt),$e&&(at.bearing=s.af(x,z,Mt)),st&&(at.pitch=s.af(w,O,Mt)),xt&&(He.interpolatePadding(M,B,Mt),Q=He.centerPoint.add(G));const bt=Mt===1?te:at.unproject(ee.add(le.mult(ht(_t))).mult(dt));return at.setLocationAtPoint(at.renderWorldCopies?bt.wrap():bt,Q),at._updateCameraOnTerrain(),r.preloadOnly||this._fireMoveEvents(o),at};if(r.preloadOnly){const at=this._emulate(ft,r.duration,p);return this._preloadTiles(at),this}return this._zooming=!0,this._rotating=$e,this._pitching=st,this._padding=xt,this._prepareEase(o,!1),this._ease(ft(p),()=>this._afterEase(o),r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(r){}_cancelRenderFrame(r){}_stop(r,o){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const p=this._onEaseEnd;this._onEaseEnd=void 0,p.call(this,o)}if(!r){const p=this.handlers;p&&p.stop(!1)}return this}_ease(r,o,p){p.animate===!1||p.duration===0?(r(1),o()):(this._easeStart=s.q.now(),this._easeOptions=p,this._onEaseFrame=r,this._onEaseEnd=o,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const r=Math.min((s.q.now()-this._easeStart)/this._easeOptions.duration,1),o=this._onEaseFrame;o&&o(this._easeOptions.easing(r)),r<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(r,o){r=s.bF(r,-180,180);const p=Math.abs(r-o);return Math.abs(r-360-o)<p&&(r-=360),Math.abs(r+360-o)<p&&(r+=360),r}_normalizeCenter(r){const o=this.transform;if(o.maxBounds||o.projection.name!=="globe"&&!o.renderWorldCopies)return;const p=r.lng-o.center.lng;r.lng+=p>180?-360:p<-180?360:0}_prefersReducedMotion(r){return this._respectPrefersReducedMotion&&s.q.prefersReducedMotion&&!(r&&r.essential)}_emulate(r,o,p){const _=Math.ceil(15*o/1e3),x=[],w=r(p.clone());for(let M=0;M<=_;M++){const P=w(M/_);x.push(P.clone())}return x}_preloadTiles(r,o){}}class xp{constructor(r={}){this.options=r,s.aP(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(r){const o=this.options&&this.options.compact,p=r._getUIString("AttributionControl.ToggleAttribution");this._map=r,this._container=Xe("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Xe("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",p);const _=Xe("span","mapboxgl-ctrl-icon",this._compactButton);return _.setAttribute("aria-hidden","true"),_.setAttribute("title",p),this._innerContainer=Xe("div","mapboxgl-ctrl-attrib-inner",this._container),o&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),o===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let r=this._editLink;r||(r=this._editLink=this._container.querySelector(".mapbox-improve-map"));const o=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.e.ACCESS_TOKEN}];if(r){const p=o.reduce((_,x,w)=>(x.value&&(_+=`${x.key}=${x.value}${w<o.length-1?"&":""}`),_),"?");r.href=`${s.e.FEEDBACK_URL}/${p}#${Kg(this._map,!0)}`,r.rel="noopener nofollow"}}_updateData(r){!r||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility"&&r.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let r=[];if(this._map.style.stylesheet){const _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}const o=this._map.style._mergedSourceCaches;for(const _ in o){const x=o[_];if(x.used){const w=x.getSource();w.attribution&&r.indexOf(w.attribution)<0&&r.push(w.attribution)}}r.sort((_,x)=>_.length-x.length),r=r.filter((_,x)=>{for(let w=x+1;w<r.length;w++)if(r[w].indexOf(_)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=[...this.options.customAttribution,...r]:r.unshift(this.options.customAttribution));const p=r.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,r.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class ba{constructor(){s.aP(["_updateLogo","_updateCompact"],this)}onAdd(r){this._map=r,this._container=Xe("div","mapboxgl-ctrl");const o=Xe("a","mapboxgl-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://www.mapbox.com/",o.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),o.setAttribute("rel","noopener nofollow"),this._container.appendChild(o),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(r){r&&r.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const r=this._map.style._sourceCaches;if(Object.entries(r).length===0)return!0;for(const o in r){const p=r[o].getSource();if(p.hasOwnProperty("mapbox_logo")&&!p.mapbox_logo)return!1}return!0}_updateCompact(){const r=this._container.children;if(r.length){const o=r[0];this._map.getCanvasContainer().offsetWidth<250?o.classList.add("mapboxgl-compact"):o.classList.remove("mapboxgl-compact")}}}class wa{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const o=++this._id;return this._queue.push({callback:r,id:o,cancelled:!1}),o}remove(r){const o=this._currentlyRunning,p=o?this._queue.concat(o):this._queue;for(const _ of p)if(_.id===r)return void(_.cancelled=!0)}run(r=0){const o=this._currentlyRunning=this._queue;this._queue=[];for(const p of o)if(!p.cancelled&&(p.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Ku{constructor(r){this.jumpTo(r)}getValue(r){if(r<=this._startTime)return this._start;if(r>=this._endTime)return this._end;const o=s.cB((r-this._startTime)/(this._endTime-this._startTime));return this._start*(1-o)+this._end*o}isEasing(r){return r>=this._startTime&&r<=this._endTime}jumpTo(r){this._startTime=-1/0,this._endTime=-1/0,this._start=r,this._end=r}easeTo(r,o,p){this._start=this.getValue(o),this._end=r,this._startTime=o,this._endTime=o+p}}const Uc={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class jc extends s.z{constructor(r,o,p,_){const{point:x,lngLat:w,originalEvent:M,target:P}=r;super(r.type,{point:x,lngLat:w,originalEvent:M,target:P}),this.preventDefault=()=>{r.preventDefault()},this.id=o,this.interaction=p,this.feature=_}}class i_{constructor(r){this.map=r,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(r,o){if(this.typeById.has(r))throw new Error(`Interaction id "${r}" already exists.`);const p=o.filter;let _=o.type;p&&this.filters.set(r,s.aZ(p)),_==="mouseover"&&(_="mouseenter"),_==="mouseout"&&(_="mouseleave");const x=this.interactionsByType.get(_)||new Map;_==="mouseenter"||_==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(r,o)):x.size===0&&this.map.on(_,this.handleType),x.size===0&&this.interactionsByType.set(_,x),x.set(r,o),this.typeById.set(r,_)}get(r){const o=this.typeById.get(r);if(!o)return;const p=this.interactionsByType.get(o);return p?p.get(r):void 0}remove(r){const o=this.typeById.get(r);if(!o)return;this.typeById.delete(r),this.filters.delete(r);const p=this.interactionsByType.get(o);p&&(p.delete(r),o==="mouseenter"||o==="mouseleave"?(this.delegatedInteractions.delete(r),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):p.size===0&&this.map.off(o,this.handleType))}queryTargets(r,o){const p=[];for(const[_,x]of o)x.target&&p.push({targetId:_,target:x.target,filter:this.filters.get(_)});return this.map.style.queryRenderedTargets(r,p,this.map.transform)}handleMove(r){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const o=this.queryTargets(r.point,Array.from(this.delegatedInteractions).reverse());o.length&&(r.type="mouseenter",this.handleType(r,o));const p=new Map;for(const[_,{feature:x}]of this.prevHoveredFeatures)this.hoveredFeatures.has(_)||p.set(x.id,x);p.size&&(r.type="mouseleave",this.handleType(r,Array.from(p.values())))}handleOut(r){const o=Array.from(this.hoveredFeatures.values()).map(({feature:p})=>p);o.length&&(r.type="mouseleave",this.handleType(r,o)),this.hoveredFeatures.clear()}handleType(r,o){const p=Array.from(this.interactionsByType.get(r.type)).reverse(),_=!!o;o=o||this.queryTargets(r.point,p);const x=r.type==="mouseenter";let w=!1;const M=new Set;for(const P of o){for(const[z,O]of p){if(!O.target)continue;const B=P.variants?P.variants[z]:null;if(B){for(const V of B){if(Za(V,P,M,z))continue;const G=new s.cw(P,V),Q=Dl(V,P,z);_&&(G.state=this.map.getFeatureState(G));const W=x?this.prevHoveredFeatures.get(Q):null,te=new jc(r,z,O,G),ee=W?W.stop:O.handler(te);if(x&&this.hoveredFeatures.set(Q,{feature:P,stop:ee}),ee!==!1){w=!0;break}}if(w)break}}if(w)break}if(!w)for(const[P,z]of p){const{handler:O,target:B}=z;if(!B&&O(new jc(r,P,z,null))!==!1)break}}}function Gi(f,r){if(Array.isArray(f)&&Array.isArray(r)){const o=new Set(f),p=new Set(r);return o.size===p.size&&f.every(_=>p.has(_))}return s.bn(f,r)}const Kl={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},yw={showCompass:!0,showZoom:!0,visualizePitch:!1};class vw{constructor(r,o,p=!1){this._clickTolerance=10,this.element=o,this.mouseRotate=new Io({clickTolerance:r.dragRotate._mouseRotate._clickTolerance}),this.map=r,p&&(this.mousePitch=new Ud({clickTolerance:r.dragRotate._mousePitch._clickTolerance})),s.aP(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),o.addEventListener("mousedown",this.mousedown),o.addEventListener("touchstart",this.touchstart,{passive:!1}),o.addEventListener("touchmove",this.touchmove),o.addEventListener("touchend",this.touchend),o.addEventListener("touchcancel",this.reset)}down(r,o){this.mouseRotate.mousedown(r,o),this.mousePitch&&this.mousePitch.mousedown(r,o),We()}move(r,o){const p=this.map,_=this.mouseRotate.mousemoveWindow(r,o),x=_&&_.bearingDelta;if(x&&p.setBearing(p.getBearing()+x),this.mousePitch){const w=this.mousePitch.mousemoveWindow(r,o),M=w&&w.pitchDelta;M&&p.setPitch(p.getPitch()+M)}}off(){const r=this.element;r.removeEventListener("mousedown",this.mousedown),r.removeEventListener("touchstart",this.touchstart,{passive:!1}),r.removeEventListener("touchmove",this.touchmove),r.removeEventListener("touchend",this.touchend),r.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Ct(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(r){this.down(s.l({},r,{ctrlKey:!0,preventDefault:()=>r.preventDefault()}),Ae(this.element,r)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(r){this.move(r,Ae(this.element,r))}mouseup(r){this.mouseRotate.mouseupWindow(r),this.mousePitch&&this.mousePitch.mouseupWindow(r),this.offTemp()}touchstart(r){r.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Ve(this.element,r.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>r.preventDefault()},this._startPos))}touchmove(r){r.targetTouches.length!==1?this.reset():(this._lastPos=Ve(this.element,r.targetTouches)[0],this.move({preventDefault:()=>r.preventDefault()},this._lastPos))}touchend(r){r.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function bp(f,r,o){if(f=new s.bO(f.lng,f.lat),r){const p=new s.bO(f.lng-360,f.lat),_=new s.bO(f.lng+360,f.lat),x=360*Math.ceil(Math.abs(f.lng-o.center.lng)/360),w=o.locationPoint(f).distSqr(r),M=r.x<0||r.y<0||r.x>o.width||r.y>o.height;o.locationPoint(p).distSqr(r)<w&&(M||Math.abs(p.lng-o.center.lng)<x)?f=p:o.locationPoint(_).distSqr(r)<w&&(M||Math.abs(_.lng-o.center.lng)<x)&&(f=_)}for(;Math.abs(f.lng-o.center.lng)>180;){const p=o.locationPoint(f);if(p.x>=0&&p.y>=0&&p.x<=o.width&&p.y<=o.height)break;f.lng>o.center.lng?f.lng-=360:f.lng+=360}return f}const Mo={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class io extends s.E{constructor(r,o){if(super(),(r instanceof HTMLElement||o)&&(r=s.l({element:r},o)),s.aP(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&r.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=r&&r.occludedOpacity||.2,r&&r.element)this._element=r.element,this._offset=s.P.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=Xe("div");const x=41,w=27,M=it("svg",{display:"block",height:x*this._scale+"px",width:w*this._scale+"px",viewBox:`0 0 ${w} ${x}`},this._element),P=it("radialGradient",{id:"shadowGradient"},it("defs",{},M));it("stop",{offset:"10%","stop-opacity":.4},P),it("stop",{offset:"100%","stop-opacity":.05},P),it("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},M),it("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},M),it("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},M),it("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},M),this._offset=s.P.convert(r&&r.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",x=>{x.preventDefault()}),this._element.addEventListener("mousedown",x=>{x.preventDefault()});const p=this._element.classList;for(const x in Mo)p.remove(`mapboxgl-marker-anchor-${x}`);p.add(`mapboxgl-marker-anchor-${this._anchor}`);const _=r&&r.className?r.className.trim().split(/\s+/):[];p.add(..._),this._popup=null}addTo(r){return r===this._map||(this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._updateMoving),r.on("moveend",this._update),r.on("remove",this._clearFadeTimer),r._addMarker(this),this.setDraggable(this._draggable),this._update(),r.on("click",this._onMapClick)),this}remove(){const r=this._map;return r&&(r.off("click",this._onMapClick),r.off("move",this._updateMoving),r.off("moveend",this._update),r.off("mousedown",this._addDragHandler),r.off("touchstart",this._addDragHandler),r.off("mouseup",this._onUp),r.off("touchend",this._onUp),r.off("mousemove",this._onMove),r.off("touchmove",this._onMove),r.off("remove",this._clearFadeTimer),r._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=s.bO.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const _=Math.sqrt(Math.pow(13.5,2)/2);r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_,-1*(38.1-13.5+_)],"bottom-right":[-_,-1*(38.1-13.5+_)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=r,r._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(r){const o=r.code,p=r.charCode||r.keyCode;o!=="Space"&&o!=="Enter"&&p!==32&&p!==13||this.togglePopup()}_onMapClick(r){const o=r.originalEvent.target,p=this._element;this._popup&&(o===p||p.contains(o))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const r=this._popup;return r?(r.isOpen()?(r.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(r.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const r=this._map,o=this._pos;if(!r||!o)return!1;const p=r.unproject(o),_=r.getFreeCameraOptions();if(!_.position)return!1;const x=_.position.toLngLat();return x.distanceTo(p)<.9*x.distanceTo(this._lngLat)}_evaluateOpacity(){const r=this._map;if(!r)return;const o=this._pos;if(!o||o.x<0||o.x>r.transform.width||o.y<0||o.y>r.transform.height)return void this._clearFadeTimer();const p=r.unproject(o);let _;r._showingGlobe()&&s.dH(r.transform,this._lngLat)?_=0:(_=1-r._queryFogOpacity(p),r.transform._terrainEnabled()&&r.getTerrain()&&this._behindTerrain()&&(_*=this._occludedOpacity)),this._element.style.opacity=`${_}`,this._element.style.pointerEvents=_>0?"auto":"none",this._popup&&this._popup._setOpacity(_),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const r=this._pos;if(!r||!this._map)return;const o=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${r.x}px,${r.y}px)
            ${Mo[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${o.x}px,${o.y}px)
        `}_calculateXYTransform(){const r=this._pos,o=this._map,p=this.getPitchAlignment();if(!o||!r||p!=="map")return"";if(!o._showingGlobe()){const P=o.getPitch();return P?`rotateX(${P}deg)`:""}const _=s.c4(s.dI(o.transform,this._lngLat)),x=r.sub(s.dJ(o.transform)),w=Math.abs(x.x)+Math.abs(x.y);if(w===0)return"";const M=_/w;return`rotateX(${-x.y*M}deg) rotateY(${x.x*M}deg)`}_calculateZTransform(){const r=this._pos,o=this._map;if(!o||!r)return"";let p=0;const _=this.getRotationAlignment();if(_==="map")if(o._showingGlobe()){const x=o.project(new s.bO(this._lngLat.lng,this._lngLat.lat+.001)),w=o.project(new s.bO(this._lngLat.lng,this._lngLat.lat-.001)).sub(x);p=s.c4(Math.atan2(w.y,w.x))-90}else p=-o.getBearing();else if(_==="horizon"){const x=s.ac(4,6,o.getZoom()),w=s.dJ(o.transform);w.y+=x*o.transform.height;const M=r.sub(w),P=s.c4(Math.atan2(M.y,M.x));p=(P>90?P-270:P+90)*(1-x)}return p+=this._rotation,p?`rotateZ(${p}deg)`:""}_update(r){cancelAnimationFrame(this._updateFrameId);const o=this._map;o&&(o.transform.renderWorldCopies&&(this._lngLat=bp(this._lngLat,this._pos,o.transform)),this._pos=o.project(this._lngLat),r===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),o._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(o._showingGlobe()||o.getTerrain()||o.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(r){return this._offset=s.P.convert(r),this._update(),this}addClassName(r){return this._element.classList.add(r),this}removeClassName(r){return this._element.classList.remove(r),this}toggleClassName(r){return this._element.classList.toggle(r)}_onMove(r){const o=this._map;if(!o)return;const p=this._pointerdownPos,_=this._positionDelta;if(p&&_){if(!this._isDragging){const x=this._clickTolerance||o._clickTolerance;if(r.point.dist(p)<x)return;this._isDragging=!0}this._pos=r.point.sub(_),this._lngLat=o.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.z("dragstart"))),this.fire(new s.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const r=this._map;r&&(r.off("mousemove",this._onMove),r.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new s.z("dragend")),this._state="inactive"}_addDragHandler(r){const o=this._map,p=this._pos;o&&p&&this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(p),this._pointerdownPos=r.point,this._state="pending",o.on("mousemove",this._onMove),o.on("touchmove",this._onMove),o.once("mouseup",this._onUp),o.once("touchend",this._onUp))}setDraggable(r){this._draggable=!!r;const o=this._map;return o&&(r?(o.on("mousedown",this._addDragHandler),o.on("touchstart",this._addDragHandler)):(o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(r){return this._occludedOpacity=r||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Ts={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},ra={maxWidth:100,unit:"metric"},Hr={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},fv={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Zn=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function n_(f=new s.P(0,0),r="bottom"){if(typeof f=="number"){const o=Math.round(Math.sqrt(.5*Math.pow(f,2)));switch(r){case"top":return new s.P(0,f);case"top-left":return new s.P(o,o);case"top-right":return new s.P(-o,o);case"bottom":return new s.P(0,-f);case"bottom-left":return new s.P(o,-o);case"bottom-right":return new s.P(-o,-o);case"left":return new s.P(f,0);case"right":return new s.P(-f,0)}return new s.P(0,0)}return f instanceof s.P||Array.isArray(f)?s.P.convert(f):s.P.convert(f[r]||[0,0])}return{version:N,supported:Ue.supported,setRTLTextPlugin:s.dK,getRTLTextPluginStatus:s.dL,Map:class extends Yu{constructor(f){K.mark(j.create);const r=f;if((f=s.l({},Kl,f)).minZoom!=null&&f.maxZoom!=null&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(f.minPitch!=null&&f.maxPitch!=null&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(f.minPitch!=null&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(f.maxPitch!=null&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(f.antialias&&s.dF(window)&&(f.antialias=!1,s.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new hd(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies),f),this._repaint=!!f.repaint,this._interactive=f.interactive,this._minTileCacheSize=f.minTileCacheSize,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=f.crossSourceCollisions,this._collectResourceTiming=f.collectResourceTiming,this._language=this._parseLanguage(f.language),this._worldview=f.worldview,this._renderTaskQueue=new wa,this._domRenderTaskQueue=new wa,this._controls=[],this._markers=[],this._popups=[],this._mapId=s.aV(),this._locale=s.l({},Uc,f.locale),this._clickTolerance=f.clickTolerance,this._cooperativeGestures=f.cooperativeGestures,this._performanceMetricsCollection=f.performanceMetricsCollection,this._tessellationStep=f.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=f.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Ku(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=f.scaleFactor,this._requestManager=new Or(f.transformRequest,f.accessToken,f.testMode),this._silenceAuthErrors=!!f.testMode,this._contextCreateOptions=f.contextCreateOptions?Object.assign({},f.contextCreateOptions):{},typeof f.container=="string"){const o=document.getElementById(f.container);if(!o)throw new Error(`Container '${f.container.toString()}' not found.`);this._container=o}else{if(!(f.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(this._container.childNodes.length>0&&s.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),f.maxBounds&&this.setMaxBounds(f.maxBounds),this._spriteFormat=f.spriteFormat,s.aP(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new Hg),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new hv(this,f),this._localFontFamily=f.localFontFamily,this._localIdeographFontFamily=f.localIdeographFontFamily,(f.style||!f.testMode)&&this.setStyle(f.style||s.e.DEFAULT_STYLE,{config:f.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),f.projection&&this.setProjection(f.projection),this.indoor=new og(this),f.hash&&(this._hash=new ev(typeof f.hash=="string"&&f.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){r.center==null&&r.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch});const o=f.bounds;o&&(this.resize(),this.fitBounds(o,s.l({},f.fitBoundsOptions,{duration:0})))}this.resize(),f.attributionControl&&this.addControl(new xp({customAttribution:f.customAttribution})),this._logoControl=new ba,this.addControl(this._logoControl,f.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",o=>{this._update(o.dataType==="style"),this.fire(new s.z(`${o.dataType}data`,o))}),this.on("dataloading",o=>{this.fire(new s.z(`${o.dataType}dataloading`,o))}),this._interactions=new i_(this)}_getMapId(){return this._mapId}addControl(f,r){if(r===void 0&&(r=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new s.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const o=f.onAdd(this);this._controls.push(f);const p=this._controlPositions[r];return r.indexOf("bottom")!==-1?p.insertBefore(o,p.firstChild):p.appendChild(o),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new s.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(f);return r>-1&&this._controls.splice(r,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(f){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const r=!this._moving;return r&&this.fire(new s.z("movestart",f)).fire(new s.z("move",f)),this.fire(new s.z("resize",f)),r&&this.fire(new s.z("moveend",f)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(f){return this.transform.setMaxBounds(s.az.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f?this.setZoom(f):this.fire(new s.z("zoomstart")).fire(new s.z("zoom")).fire(new s.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f?this.setZoom(f):this.fire(new s.z("zoomstart")).fire(new s.z("zoom")).fire(new s.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f?this.setPitch(f):this.fire(new s.z("pitchstart")).fire(new s.z("pitch")).fire(new s.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f?this.setPitch(f):this.fire(new s.z("pitchstart")).fire(new s.z("pitch")).fire(new s.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(f){return this._scaleFactor=f,this.painter.scaleFactor=f,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(r=>r.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(f){return f==="auto"?navigator.language:Array.isArray(f)?f.length===0?void 0:f.map(r=>r==="auto"?navigator.language:r):f}setLanguage(f){const r=this._parseLanguage(f);if(!this.style||r===this._language)return this;this._language=r,this.style.reloadSources();for(const o of this._controls)o._setLanguage&&o._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(f){return this.style&&f!==this._worldview?(this._worldview=f,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(f){return this._lazyInitEmptyStyle(),f?typeof f=="string"&&(f={name:f}):f=null,this._useExplicitProjection=!!f,this._prioritizeAndUpdateProjection(f,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const f=this.transform,r=f.projection.name;let o;r==="globe"&&f.zoom>=s.bY?(f.setMercatorFromTransition(),o=!0):r==="mercator"&&f.zoom<s.bY&&(f.setProjection({name:"globe"}),o=!0),o&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(f,r){return this._updateProjection(f||r||{name:"mercator"})}_updateProjection(f){let r;return r=f.name==="globe"&&this.transform.zoom>=s.bY?this.transform.setMercatorFromTransition():this.transform.setProjection(f),this.style.applyProjectionUpdate(),r&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(f){return this.transform.locationPoint3D(s.bO.convert(f))}unproject(f){return this.transform.pointLocation3D(s.P.convert(f))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(f,r,o){const p=_=>{let x=[];if(Array.isArray(r)){const w=r.filter(M=>this.getLayer(M));x=w.length?this.queryRenderedFeatures(_,{layers:w}):[]}else x=this.queryRenderedFeatures(_,{target:r});return x};if(f==="mouseenter"||f==="mouseover"){let _=!1;return{listener:o,targets:r,delegates:{mousemove:w=>{const M=p(w.point);M.length?_||(_=!0,o.call(this,new na(f,this,w.originalEvent,{features:M}))):_=!1},mouseout:()=>{_=!1}}}}if(f==="mouseleave"||f==="mouseout"){let _=!1;return{listener:o,targets:r,delegates:{mousemove:M=>{p(M.point).length?_=!0:_&&(_=!1,o.call(this,new na(f,this,M.originalEvent)))},mouseout:M=>{_&&(_=!1,o.call(this,new na(f,this,M.originalEvent)))}}}}{const _=x=>{const w=p(x.point);w.length&&(x.features=w,o.call(this,x),delete x.features)};return{listener:o,targets:r,delegates:{[f]:_}}}}on(f,r,o){if(typeof r=="function"||o===void 0)return super.on(f,r);if(typeof r=="string"&&(r=[r]),!this._areTargetsValid(r))return this;const p=this._createDelegatedListener(f,r,o);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(p);for(const _ in p.delegates)this.on(_,p.delegates[_]);return this}once(f,r,o){if(typeof r=="function"||o===void 0)return super.once(f,r);if(typeof r=="string"&&(r=[r]),!this._areTargetsValid(r))return this;const p=this._createDelegatedListener(f,r,o);for(const _ in p.delegates)this.once(_,p.delegates[_]);return this}off(f,r,o){if(typeof r=="function"||o===void 0)return super.off(f,r);if(typeof r=="string"&&(r=[r]),!this._areTargetsValid(r))return this;const p=this._delegatedListeners?this._delegatedListeners[f]:void 0;return p&&(_=>{for(let x=0;x<_.length;x++){const w=_[x];if(w.listener===o&&Gi(w.targets,r)){for(const M in w.delegates)this.off(M,w.delegates[M]);return _.splice(x,1),this}}})(p),this}queryRenderedFeatures(f,r){if(!this.style)return[];if(f===void 0||f instanceof s.P||Array.isArray(f)||r!==void 0||(r=f,f=void 0),f=f||[[0,0],[this.transform.width,this.transform.height]],!r){const x=this.style.queryRenderedFeatures(f,void 0,this.transform),w=this.style.queryRenderedFeatureset(f,void 0,this.transform);return x.concat(w)}let o=!0;if(r.target&&(o=this._isTargetValid(r.target),o&&!r.layers))return this.style.queryRenderedFeatureset(f,r,this.transform);let p=!0;if(r.layers&&Array.isArray(r.layers)){for(const x of r.layers)if(!this._isValidId(x)){p=!1;break}if(p&&!r.target)return this.style.queryRenderedFeatures(f,r,this.transform)}let _=[];return p&&(_=_.concat(this.style.queryRenderedFeatures(f,r,this.transform))),o&&(_=_.concat(this.style.queryRenderedFeatureset(f,r,this.transform))),_}querySourceFeatures(f,r){return!f||typeof f=="string"&&!this._isValidId(f)?[]:this.style.querySourceFeatures(f,r)}isPointOnSurface(f){const{name:r}=this.transform.projection;return r!=="globe"&&r!=="mercator"&&s.w(`${r} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(s.P.convert(f))}addInteraction(f,r){return this._interactions.add(f,r),this}removeInteraction(f){return this._interactions.remove(f),this}setStyle(f,r){return r=s.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},r),this.style&&f&&r.diff!==!1&&r.localFontFamily===this._localFontFamily&&r.localIdeographFontFamily===this._localIdeographFontFamily&&!r.config?(this.style._diffStyle(f,(o,p)=>{o?(s.w(`Unable to perform style diff: ${String(o.message||o.error||o)}. Rebuilding the style from scratch.`),this._updateStyle(f,r)):p&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._localFontFamily=r.localFontFamily,this._updateStyle(f,r))}_getUIString(f){const r=this._locale[f];if(r==null)throw new Error(`Missing UI string '${f}'`);return r}_updateStyle(f,r){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),f){const o=s.l({},r);r&&r.config&&(o.initialConfig=r.config,delete o.config),this.style=new Oa(this,o).load(f),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Oa(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(s.w("There is no style added to the map."),!1)}_isValidId(f){return f==null?(this.fire(new s.y(new Error("IDs can't be empty."))),!1):!s.cr(f)||(this.fire(new s.y(new Error(`IDs can't contain special symbols: "${f}".`))),!1)}_isTargetValid(f){return"featuresetId"in f?this._isValidId("importId"in f?f.importId:f.featuresetId):"layerId"in f&&this._isValidId(f.layerId)}_areTargetsValid(f){if(Array.isArray(f)){for(const r of f)if(!this._isValidId(r))return!1;return!0}return this._isTargetValid(f)}addSource(f,r){return this._isValidId(f)?(this._lazyInitEmptyStyle(),this.style.addSource(f,r),this._update(!0)):this}isSourceLoaded(f){return!!this._isValidId(f)&&!!this.style&&this.style._isSourceCacheLoaded(f)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(f,r,o){this._lazyInitEmptyStyle(),this.style.addSourceType(f,r,o)}removeSource(f){return this._isValidId(f)?(this.style.removeSource(f),this._updateTerrain(),this._update(!0)):this}getSource(f){return this._isValidId(f)?this.style.getOwnSource(f):null}addImage(f,r,{pixelRatio:o=1,sdf:p=!1,stretchX:_,stretchY:x,content:w}={}){if(this._lazyInitEmptyStyle(),r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap){const{width:M,height:P,data:z}=s.q.getImageData(r);this.style.addImage(f,{data:new s.r({width:M,height:P},z),pixelRatio:o,stretchX:_,stretchY:x,content:w,sdf:p,version:0,usvg:!1})}else if(r.width===void 0||r.height===void 0)this.fire(new s.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:M,height:P}=r,z=r;this.style.addImage(f,{data:new s.r({width:M,height:P},new Uint8Array(z.data)),pixelRatio:o,stretchX:_,stretchY:x,content:w,sdf:p,usvg:!1,version:0,userImage:z}),z.onAdd&&z.onAdd(this,f)}}updateImage(f,r){this._lazyInitEmptyStyle();const o=this.style.getImage(f);if(!o)return void this.fire(new s.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap?s.q.getImageData(r):r,{width:_,height:x,data:w}=p;if(_===void 0||x===void 0)return void this.fire(new s.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(_!==(o.usvg?o.icon.usvg_tree.width:o.data.width)||x!==(o.usvg?o.icon.usvg_tree.height:o.data.height))return void this.fire(new s.y(new Error(`The width and height of the updated image (${_}, ${x})
                must be that same as the previous version of the image
                (${o.data.width}, ${o.data.height})`)));const M=!(r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap);let P=!1;o.usvg?(o.data=new s.r({width:_,height:x},new Uint8Array(w)),o.usvg=!1,o.icon=void 0,P=!0):o.data.replace(w,M),this.style.updateImage(f,o,P)}hasImage(f){return f?!!this.style&&!!this.style.getImage(f):(this.fire(new s.y(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f,r){s.o(this._requestManager.transformRequest(f,s.R.Image),(o,p)=>{r(o,p instanceof HTMLImageElement?s.q.getImageData(p):p)})}listImages(){return this.style.listImages()}addModel(f,r){this._lazyInitEmptyStyle(),this.style.addModel(f,r)}hasModel(f){return f?this.style.hasModel(f):(this.fire(new s.y(new Error("Missing required model id"))),!1)}removeModel(f){this.style.removeModel(f)}listModels(){return this.style.listModels()}addLayer(f,r){return this._isValidId(f.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(f,r),this._update(!0)):this}getSlot(f){const r=this.getLayer(f);return r&&r.slot||null}setSlot(f,r){return this.style.setSlot(f,r),this.style.mergeLayers(),this._update(!0)}addImport(f,r){return this.style.addImport(f,r),this}updateImport(f,r){return typeof r!="string"&&r.id!==f?(this.removeImport(f),this.addImport(r)):(this.style.updateImport(f,r),this._update(!0))}removeImport(f){return this.style.removeImport(f),this}moveImport(f,r){return this.style.moveImport(f,r),this._update(!0)}moveLayer(f,r){return this._isValidId(f)?(this.style.moveLayer(f,r),this._update(!0)):this}removeLayer(f){return this._isValidId(f)?(this.style.removeLayer(f),this._update(!0)):this}getLayer(f){if(!this._isValidId(f))return null;const r=this.style.getOwnLayer(f);return r?r.type==="custom"?r.implementation:r.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(f,r,o){return this._isValidId(f)?(this.style.setLayerZoomRange(f,r,o),this._update(!0)):this}setFilter(f,r,o={}){return this._isValidId(f)?(this.style.setFilter(f,r,o),this._update(!0)):this}getFilter(f){return this._isValidId(f)?this.style.getFilter(f):null}setPaintProperty(f,r,o,p={}){return this._isValidId(f)?(this.style.setPaintProperty(f,r,o,p),this._update(!0)):this}getPaintProperty(f,r){return this._isValidId(f)?this.style.getPaintProperty(f,r):null}setLayoutProperty(f,r,o,p={}){return this._isValidId(f)?(this.style.setLayoutProperty(f,r,o,p),this._update(!0)):this}getLayoutProperty(f,r){return this._isValidId(f)?this.style.getLayoutProperty(f,r):null}getSchema(f){return this.style.getSchema(f)}setSchema(f,r){return this.style.setSchema(f,r),this._update(!0)}getConfig(f){return this.style.getConfig(f)}setConfig(f,r){return this.style.setConfig(f,r),this._update(!0)}getConfigProperty(f,r){return this.style.getConfigProperty(f,r)}setConfigProperty(f,r,o){return this.style.setConfigProperty(f,r,o),this._update(!0)}getFeaturesetDescriptors(f){return this.style.getFeaturesetDescriptors(f)}setLights(f){if(this._lazyInitEmptyStyle(),f&&f.length===1&&f[0].type==="flat"){const r=f[0];r.properties?this.style.setFlatLight(r.properties,r.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(f),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const f=this.style.getLights()||[];return f.length===0&&f.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),f}setLight(f,r={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:f}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(f){return this._lazyInitEmptyStyle(),!f&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(f),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(f){return this._lazyInitEmptyStyle(),this.style.setFog(f),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(f){return this._lazyInitEmptyStyle(),this.style.setSnow(f),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(f){return this._lazyInitEmptyStyle(),this.style.setRain(f),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(f){return this._lazyInitEmptyStyle(),this.style.setColorTheme(f),this._update(!0)}setImportColorTheme(f,r){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(f,r),this._update(!0)}setCamera(f){return this.style.setCamera(f),this._triggerCameraUpdate(f)}_triggerCameraUpdate(f){return this._update(this.transform.setOrthographicProjectionAtLowPitch(f["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(f){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.bO.convert(f),this.transform):0}setFeatureState(f,r){return f.source&&!this._isValidId(f.source)?this:(this.style.setFeatureState(f,r),this._update())}removeFeatureState(f,r){return f.source&&!this._isValidId(f.source)?this:(this.style.removeFeatureState(f,r),this._update())}getFeatureState(f){return f.source&&!this._isValidId(f.source)?null:this.style.getFeatureState(f)}_updateContainerDimensions(){if(!this._container)return;const f=this._container.getBoundingClientRect().width||400,r=this._container.getBoundingClientRect().height||300;let o,p,_,x=this._container;for(;x&&(!p||!_);){const w=window.getComputedStyle(x).transform;w&&w!=="none"&&(o=w.match(/matrix.*\((.+)\)/)[1].split(", "),o[0]&&o[0]!=="0"&&o[0]!=="1"&&(p=o[0]),o[3]&&o[3]!=="0"&&o[3]!=="1"&&(_=o[3])),x=x.parentElement}this._containerWidth=p?Math.abs(f/p):f,this._containerHeight=_?Math.abs(r/_):r}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const f=this._container;f.classList.add("mapboxgl-map"),(this._missingCSSCanary=Xe("div","mapboxgl-canary",f)).style.visibility="hidden",this._detectMissingCSS();const r=this._canvasContainer=Xe("div","mapboxgl-canvas-container",f);this._canvas=Xe("canvas","mapboxgl-canvas",r),this._interactive&&(r.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const o=this._controlContainer=Xe("div","mapboxgl-control-container",f),p=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(_=>{p[_]=Xe("div",`mapboxgl-ctrl-${_}`,o)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,r){const o=s.q.devicePixelRatio||1;this._canvas.width=o*Math.ceil(f),this._canvas.height=o*Math.ceil(r),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${r}px`}_addMarker(f){this._markers.push(f)}_removeMarker(f){const r=this._markers.indexOf(f);r!==-1&&this._markers.splice(r,1)}_addPopup(f){this._popups.push(f)}_removePopup(f){const r=this._popups.indexOf(f);r!==-1&&this._popups.splice(r,1)}_setupPainter(){const f=s.l({},Ue.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl2",f);r?(pa(r,!0),this.painter=new Yg(r,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp),this.on("data",o=>{o.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),s.m.testSupport(r)):this.fire(new s.y(new Error("Failed to initialize WebGL")))}_contextLost(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.z("webglcontextlost",{originalEvent:f}))}_contextRestored(f){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style.reloadModels(),this.style.clearSources(),this._update(),this.fire(new s.z("webglcontextrestored",{originalEvent:f}))}_onMapScroll(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_requestDomTask(f){!this.loaded()||this.loaded()&&!this.isMoving()?f():this._domRenderTaskQueue.add(f)}_render(f){let r;this.fire(new s.z("renderstart")),++this._frameId;const o=this.painter.context.extTimerQuery,p=s.q.now(),_=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(r=_.createQuery(),_.beginQuery(o.TIME_ELAPSED_EXT,r)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(f),this._domRenderTaskQueue.run(f),this._removed)return;this._updateProjectionTransition();const x=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const z=this.transform.zoom,O=this.transform.pitch,B=s.q.now(),V=new s.a8(z,{now:B,fadeDuration:x,pitch:O,transition:this.style.transition});this.style.update(V)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let w=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),w=this._updateAverageElevation(p),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):w=this._updateAverageElevation(p);const M=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,x,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),M&&(this._placementDirty=M.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:x,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,K.mark(j.load),this.fire(new s.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),r){const z=s.q.now()-p;_.endQuery(o.TIME_ELAPSED_EXT),setTimeout(()=>{const O=_.getQueryParameter(r,_.QUERY_RESULT)/1e6;_.deleteQuery(r),this.fire(new s.z("gpu-timing-frame",{cpuTime:z,gpuTime:O}))},50)}if(this.listens("gpu-timing-layer")){const z=this.painter.collectGpuTimers();setTimeout(()=>{const O=this.painter.queryGpuTimers(z);this.fire(new s.z("gpu-timing-layer",{layerTimes:O}))},50)}if(this.listens("gpu-timing-deferred-render")){const z=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const O=this.painter.queryGpuTimeDeferredRender(z);this.fire(new s.z("gpu-timing-deferred-render",{gpuTime:O}))},50)}const P=this._sourcesDirty||this._styleDirty||this._placementDirty||w;if(P||this._repaint)this.triggerRepaint();else{const z=this.idle();if(z&&(w=this._updateAverageElevation(p,!0)),w)this.triggerRepaint();else if(this._triggerFrame(!1),z&&(this.fire(new s.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const O=this._calculateSpeedIndex();this.fire(new s.z("speedindexcompleted",{speedIndex:O})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||P||(this._fullyLoaded=!0,K.mark(j.fullLoad),this._performanceMetricsCollection&&Rs(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(f){for(const r of this._markers)f&&!this.getRenderWorldCopies()&&(r._lngLat=r._lngLat.wrap()),r._update();for(const r of this._popups)!f||this.getRenderWorldCopies()||r._trackPointer||(r._lngLat=r._lngLat.wrap()),r._update()}_updateAverageElevation(f,r=!1){const o=_=>(this.transform.averageElevation=_,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&o(0);const p=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(p||(r||f-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(f)){const _=this.transform.averageElevation;let x=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(x)?x=0:this._averageElevationLastSampledAt=f;const w=Math.abs(_-x);if(w>1){if(this._isInitialLoad||p)return this._averageElevation.jumpTo(x),o(x);this._averageElevation.easeTo(x,f,300)}else if(w>1e-4)return this._averageElevation.jumpTo(x),o(x)}return!!this._averageElevation.isEasing(f)&&o(this._averageElevation.getValue(f))}_authenticate(){ke(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,f=>{if(f&&(f.message===Ye||f.status===401)){const r=this.painter.context.gl;pa(r,!1),this._logoControl instanceof ba&&this._logoControl._updateLogo(),r&&r.clear(r.DEPTH_BUFFER_BIT|r.COLOR_BUFFER_BIT|r.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Nn(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&Sr(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const f=this._isDragging();this.painter.updateTerrain(this.style,f)}_calculateSpeedIndex(){const f=this.painter.canvasCopy(),r=this.painter.getCanvasCopiesAndTimestamps();r.timeStamps.push(performance.now());const o=this.painter.context.gl,p=o.createFramebuffer();function _(x){o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,x,0);const w=new Uint8Array(o.drawingBufferWidth*o.drawingBufferHeight*4);return o.readPixels(0,0,o.drawingBufferWidth,o.drawingBufferHeight,o.RGBA,o.UNSIGNED_BYTE,w),w}return o.bindFramebuffer(o.FRAMEBUFFER,p),this._canvasPixelComparison(_(f),r.canvasCopies.map(_),r.timeStamps)}_canvasPixelComparison(f,r,o){let p=o[1]-o[0];const _=f.length/4;for(let x=0;x<r.length;x++){const w=r[x];let M=0;for(let P=0;P<w.length;P+=4)w[P]===f[P]&&w[P+1]===f[P+1]&&w[P+2]===f[P+2]&&w[P+3]===f[P+3]&&(M+=1);p+=(o[x+2]-o[x+1])*(1-M/_)}return p}remove(){this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),rr.delete(this.painter.context.gl),ss.remove(),$t.remove(),this._removed=!0,this.fire(new s.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(f){this._renderNextFrame=this._renderNextFrame||f,this.style&&!this._frame&&(this._frame=s.q.frame(r=>{const o=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,o&&this._render(r)}))}_preloadTiles(f){const r=this.style?this.style.getSourceCaches():[];return s.bl(r,(o,p)=>o._preloadTiles(f,p),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(f){this._trackResize&&this.resize({originalEvent:f})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(f){this._showParseStatus!==f&&(this._showParseStatus=f,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(f){this._showTerrainWireframe!==f&&(this._showTerrainWireframe=f,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(f){this._showLayers2DWireframe!==f&&(this._showLayers2DWireframe=f,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(f){this._showLayers3DWireframe!==f&&(this._showLayers3DWireframe=f,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(f){this._speedIndexTiming!==f&&(this._speedIndexTiming=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,this._tp.refreshUI(),f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(f){this._showTileAABBs!==f&&(this._showTileAABBs=f,this._tp.refreshUI(),f&&this._update())}_setCacheLimits(f,r){s.dG(f,r)}get version(){return N}},NavigationControl:class{constructor(f={}){this.options=s.l({},yw,f),this._container=Xe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(s.aP(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",r=>{this._map&&this._map.zoomIn({},{originalEvent:r})}),Xe("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",r=>{this._map&&this._map.zoomOut({},{originalEvent:r})}),Xe("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.aP(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",r=>{const o=this._map;o&&(this.options.visualizePitch?o.resetNorthPitch({},{originalEvent:r}):o.resetNorth({},{originalEvent:r}))}),this._compassIcon=Xe("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const f=this._map;if(!f)return;const r=f.getZoom(),o=r===f.getMaxZoom(),p=r===f.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())}_rotateCompassArrow(){const f=this._map;if(!f)return;const r=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(f.transform.pitch*(Math.PI/180)),.5)}) rotateX(${f.transform.pitch}deg) rotateZ(${f.transform.angle*(180/Math.PI)}deg)`:`rotate(${f.transform.angle*(180/Math.PI)}deg)`;f._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=r)})}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),f.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&f.on("pitch",this._rotateCompassArrow),f.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new vw(f,this._compass,this.options.visualizePitch)),this._container}onRemove(){const f=this._map;f&&(this._container.remove(),this.options.showZoom&&f.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&f.off("pitch",this._rotateCompassArrow),f.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(f,r){const o=Xe("button",f,this._container);return o.type="button",o.addEventListener("click",r),o}_setButtonTitle(f,r){if(!this._map)return;const o=this._map._getUIString(`NavigationControl.${r}`);f.setAttribute("aria-label",o),f.firstElementChild&&f.firstElementChild.setAttribute("title",o)}},GeolocateControl:class extends s.E{constructor(f={}){super();const r=navigator.geolocation;this.options=s.l({geolocation:r},Ts,f),s.aP(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=gp(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(f){return this._map=f,this._container=Xe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(f){const r=(o=!!this.options.geolocation)=>{this._supportsGeolocation=o,f(o)};this._supportsGeolocation!==void 0?f(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(o=>r(o.state!=="denied")).catch(()=>r()):r()}_isOutOfMapMaxBounds(f){const r=this._map.getMaxBounds(),o=f.coords;return!!r&&(o.longitude<r.getWest()||o.longitude>r.getEast()||o.latitude<r.getSouth()||o.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new s.z("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(f),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(f),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.z("geolocate",f)),this._finish()}}_updateCamera(f){const r=new s.bO(f.coords.longitude,f.coords.latitude),o=f.coords.accuracy,p=this._map.getBearing(),_=s.l({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(o),_,{geolocateSource:!0})}_updateMarker(f){if(f){const r=new s.bO(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const f=this._map.transform,r=s.bH(1,f._center.lat)*f.worldSize,o=Math.ceil(2*this._accuracy*r);this._circleElement.style.width=`${o}px`,this._circleElement.style.height=`${o}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(f){if(this._map){if(this.options.trackUserLocation)if(f.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(f.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.z("error",f)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(f){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=Xe("button","mapboxgl-ctrl-geolocate",this._container),Xe("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",f===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Xe("div","mapboxgl-user-location"),this._dotElement.appendChild(Xe("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Xe("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new io({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Xe("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new io({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||r.originalEvent&&r.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.z("trackuserlocationend")))})}}_onDeviceOrientation(f){this._userLocationDotMarker&&(f.webkitCompassHeading?this._heading=f.webkitCompassHeading:f.absolute===!0&&(this._heading=-1*f.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(f={maximumAge:6e5,timeout:0},this._noTimeout=!0):(f=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,f),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const f=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(r=>{r==="granted"&&f()}).catch(console.error):f()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:xp,ScaleControl:class{constructor(f={}){this.options=s.l({},ra,f),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),s.aP(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const f=this.options.maxWidth||100,r=this._map,o=r._containerHeight/2,p=r._containerWidth/2-f/2,_=r.unproject([p,o]),x=r.unproject([p+f,o]),w=_.distanceTo(x);if(this.options.unit==="imperial"){const M=3.2808*w;M>5280?this._setScale(f,M/5280,"mile"):this._setScale(f,M,"foot")}else this.options.unit==="nautical"?this._setScale(f,w/1852,"nautical-mile"):w>=1e3?this._setScale(f,w/1e3,"kilometer"):this._setScale(f,w,"meter")}_setScale(f,r,o){this._map._requestDomTask(()=>{const p=function(x){const w=Math.pow(10,`${Math.floor(x)}`.length-1);let M=x/w;return M=M>=10?10:M>=5?5:M>=3?3:M>=2?2:M>=1?1:function(P){const z=Math.pow(10,Math.ceil(-Math.log(P)/Math.LN10));return Math.round(P*z)/z}(M),w*M}(r),_=p/r;this._container.innerHTML=this._isNumberFormatSupported&&o!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:o}).format(p):`${p}&nbsp;${Hr[o]}`,this._container.style.width=f*_+"px"})}onAdd(f){return this._map=f,this._language=f.getLanguage(),this._container=Xe("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(f){this._language=f,this._update()}setUnit(f){this.options.unit=f,this._update()}},FullscreenControl:class{constructor(f={}){this._fullscreen=!1,f&&f.container&&(f.container instanceof HTMLElement?this._container=f.container:s.w("Full screen control 'container' must be a DOM element.")),s.aP(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=Xe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const f=this._fullscreenButton=Xe("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Xe("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",f)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends s.E{constructor(f){super(),this.options=s.l(Object.create(fv),f),s.aP(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(f&&f.className?f.className.trim().split(/\s+/):[])}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&f.on("preclick",this._onClose),this.options.closeOnMove&&f.on("move",this._onClose),f.on("remove",this.remove),this._update(),f._addPopup(this),this._focusFirstElement(),this._trackPointer?(f.on("mousemove",this._onMouseEvent),f.on("mouseup",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")):f.on("move",this._update),this.fire(new s.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const f=this._map;return f&&(f.off("move",this._update),f.off("move",this._onClose),f.off("preclick",this._onClose),f.off("click",this._onClose),f.off("remove",this.remove),f.off("mousemove",this._onMouseEvent),f.off("mouseup",this._onMouseEvent),f.off("drag",this._onMouseEvent),f._canvasContainer&&f._canvasContainer.classList.remove("mapboxgl-track-pointer"),f._removePopup(this),this._map=void 0),this.fire(new s.z("close")),this}getLngLat(){return this._lngLat}setLngLat(f){this._lngLat=s.bO.convert(f),this._pos=null,this._trackPointer=!1,this._update();const r=this._map;return r&&(r.on("move",this._update),r.off("mousemove",this._onMouseEvent),r._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const f=this._map;return f&&(f.off("move",this._update),f.on("mousemove",this._onMouseEvent),f.on("drag",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(document.createTextNode(f))}setHTML(f){const r=document.createDocumentFragment(),o=document.createElement("body");let p;for(o.innerHTML=f;p=o.firstChild,p;)r.appendChild(p);return this.setDOMContent(r)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){let r=this._content;if(r)for(;r.hasChildNodes();)r.firstChild&&r.removeChild(r.firstChild);else r=this._content=Xe("div","mapboxgl-popup-content",this._container||void 0);if(r.appendChild(f),this.options.closeButton){const o=this._closeButton=Xe("button","mapboxgl-popup-close-button",r);o.type="button",o.setAttribute("aria-label","Close popup"),o.innerHTML='<span aria-hidden="true">&#215;</span>',o.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(f){return this._classList.add(f),this._updateClassList(),this}removeClassName(f){return this._classList.delete(f),this._updateClassList(),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){let r;return this._classList.delete(f)?r=!1:(this._classList.add(f),r=!0),this._updateClassList(),r}_onMouseEvent(f){this._update(f.point)}_getAnchor(f){if(this.options.anchor)return this.options.anchor;const r=this._map,o=this._container,p=this._pos;if(!r||!o||!p)return"bottom";const _=o.offsetWidth,x=o.offsetHeight,w=p.x<_/2,M=p.x>r.transform.width-_/2;if(p.y+f<x)return w?"top-left":M?"top-right":"top";if(p.y>r.transform.height-x){if(w)return"bottom-left";if(M)return"bottom-right"}return w?"left":M?"right":"bottom"}_updateClassList(){const f=this._container;if(!f)return;const r=[...this._classList];r.push("mapboxgl-popup"),this._anchor&&r.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&r.push("mapboxgl-popup-track-pointer"),f.className=r.join(" ")}_update(f){const r=this._map,o=this._content;if(!r||!this._lngLat&&!this._trackPointer||!o)return;let p=this._container;if(p||(p=this._container=Xe("div","mapboxgl-popup",r.getContainer()),this._tip=Xe("div","mapboxgl-popup-tip",p),p.appendChild(o)),this.options.maxWidth&&p.style.maxWidth!==this.options.maxWidth&&(p.style.maxWidth=this.options.maxWidth),r.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=bp(this._lngLat,this._pos,r.transform)),!this._trackPointer||f){const _=this._pos=this._trackPointer&&f instanceof s.P?f:r.project(this._lngLat),x=n_(this.options.offset),w=this._anchor=this._getAnchor(x.y),M=n_(this.options.offset,w),P=_.add(M).round();r._requestDomTask(()=>{this._container&&w&&(this._container.style.transform=`${Mo[w]} translate(${P.x}px,${P.y}px)`)})}if(!this._marker&&r._showingGlobe()){const _=s.dH(r.transform,this._lngLat)?0:1;this._setOpacity(_)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(Zn);f&&f.focus()}_onClose(){this.remove()}_setOpacity(f){this._container&&(this._container.style.opacity=`${f}`),this._content&&(this._content.style.pointerEvents=f?"auto":"none")}},Marker:io,Style:Oa,LngLat:s.bO,LngLatBounds:s.az,Point:s.P,MercatorCoordinate:s.aa,FreeCameraOptions:Uf,Evented:s.E,config:s.e,prewarm:s.dM,clearPrewarmedResources:s.dN,get accessToken(){return s.e.ACCESS_TOKEN},set accessToken(f){s.e.ACCESS_TOKEN=f},get baseApiUrl(){return s.e.API_URL},set baseApiUrl(f){s.e.API_URL=f},get workerCount(){return s.dO.workerCount},set workerCount(f){s.dO.workerCount=f},get maxParallelImageRequests(){return s.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){s.e.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage(f){s.dP(f)},get workerUrl(){return s.dQ.workerUrl},set workerUrl(f){s.dQ.workerUrl=f},get workerClass(){return s.dQ.workerClass},set workerClass(f){s.dQ.workerClass=f},get workerParams(){return s.dQ.workerParams},set workerParams(f){s.dQ.workerParams=f},get dracoUrl(){return s.dR()},set dracoUrl(f){s.dS(f)},get meshoptUrl(){return s.dT()},set meshoptUrl(f){s.dU(f)},setNow:s.q.setNow,restoreNow:s.q.restoreNow}});var A=d;return A})})(sF);var KX=sF.exports;const Yx=tS(KX);Yx.accessToken="pk.eyJ1Ijoic2hhcmF0aDIiLCJhIjoiY203cmhjZTU2MThlajJsb3AwMTZpbzIwbyJ9.9Tq5vhVBdTTuayhzo4Zgcw";function oF({isOpen:t,onClose:e,pickup:n,dropoff:l}){const d=ot.useRef(null),y=ot.useRef(null),A=ot.useRef(null),s=ot.useRef(null),[N,j]=ot.useState(null),[K,se]=ot.useState(null),[ae,me]=ot.useState(!1),[Ue,Xe]=ot.useState(""),it={lat:37.7749,lng:-122.4194};ot.useEffect(()=>{if(!t)return;y.current=new Yx.Map({container:d.current,style:"mapbox://styles/mapbox/streets-v11",center:[(n==null?void 0:n.lng)??(l==null?void 0:l.lng)??it.lng,(n==null?void 0:n.lat)??(l==null?void 0:l.lat)??it.lat],zoom:12});const Ce=()=>{y.current.addControl(new Yx.NavigationControl),be()};return y.current.on("load",Ce),()=>{var We;(We=y.current)==null||We.remove()}},[t,n,l]),ot.useEffect(()=>{A.current=N,be()},[N]),ot.useEffect(()=>{s.current=K,be()},[K]);const be=()=>{const Ce=y.current,We=A.current,Ct=s.current;if(!Ce||!Ce.style||!Ce.style.loaded())return;Ce.getLayer("route-layer")&&Ce.removeLayer("route-layer"),Ce.getSource("route")&&Ce.removeSource("route"),Ce.getLayer("pickups-layer")&&Ce.removeLayer("pickups-layer"),Ce.getSource("pickups")&&Ce.removeSource("pickups"),Ce.getLayer("vehicle")&&Ce.removeLayer("vehicle"),Ce.getSource("vehicle")&&Ce.removeSource("vehicle"),We&&(Ce.addSource("route",{type:"geojson",data:{type:"Feature",geometry:We.geometry}}),Ce.addLayer({id:"route-layer",type:"line",source:"route",paint:{"line-color":"#0088FF","line-width":5}}));const Ut=[];n&&Ut.push({type:"Feature",geometry:{type:"Point",coordinates:[n.lng,n.lat]},properties:{title:"Pickup"}}),l&&Ut.push({type:"Feature",geometry:{type:"Point",coordinates:[l.lng,l.lat]},properties:{title:"Dropoff"}}),Ut.length>0&&(Ce.addSource("pickups",{type:"geojson",data:{type:"FeatureCollection",features:Ut}}),Ce.addLayer({id:"pickups-layer",type:"symbol",source:"pickups",layout:{"icon-image":"{title}-15","icon-allow-overlap":!0}})),Ct&&(Ce.addSource("vehicle",{type:"geojson",data:{type:"Feature",geometry:{type:"Point",coordinates:[Ct.lng,Ct.lat]}}}),Ce.addLayer({id:"vehicle",type:"symbol",source:"vehicle",layout:{"icon-image":"trucks-15"}}))},Ee=async()=>{me(!0),Xe(null);try{const We=await(await fetch(`https://api.mapbox.com/directions/v5/mapbox/driving/${n.lng},${n.lat};${l.lng},${l.lat}?geometries=geojson&access_token=${Yx.accessToken}`)).json();j(We.routes[0])}catch{Xe("Failed to fetch directions.")}finally{me(!1)}};return ot.useEffect(()=>{n&&l&&y.current&&Ee()},[n,l]),ot.useEffect(()=>{if(N){const{geometry:Ce}=N;let We=0;const Ct=setInterval(()=>{if(We<Ce.coordinates.length){const[Ut,we]=Ce.coordinates[We];se({lng:Ut,lat:we}),We++}else clearInterval(Ct)},2e3);return()=>clearInterval(Ct)}},[N]),J.jsx("div",{className:`fixed inset-0 ${t?"flex":"hidden"}`,children:t&&J.jsx("div",{className:"bg-black bg-opacity-50 flex justify-center items-center z-50",children:J.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg max-w-lg w-full",children:[J.jsx("div",{ref:d,className:"w-full h-96"}),J.jsxs("div",{className:"mt-4",children:[ae?J.jsx("p",{className:"text-center",children:"Loading..."}):Ue?J.jsx("p",{className:"text-red-500",children:Ue}):null,J.jsx("button",{className:"bg-red-500 text-white px-4 py-2 rounded hover:bg-red-700 float-right",onClick:e,children:"Close"})]})]})})})}const QX=(t,e)=>{if(!t)return null;const n=Wo(da(Pn,"approved_trips"),Ho("userId","==",t));return H1(n,l=>{const d=[];l.forEach(y=>{d.push({id:y.id,...y.data()})}),e(d)})};function JX({createdOrders:t,setFilterStatus:e,filterStatus:n,showRequests:l,setShowRequests:d}){var Mi,ai,pn;const{user:y}=Cl(),[A,s]=ot.useState(null),[N,j]=ot.useState(""),[K,se]=ot.useState({}),[ae,me]=ot.useState(null),[Ue,Xe]=ot.useState(!1),[it,be]=ot.useState(null),[Ee,Ce]=ot.useState(null),[We,Ct]=ot.useState(!1),[Ut,we]=ot.useState([]),[Ae,Ve]=ot.useState({}),[De,je]=ot.useState({}),pt=oi=>({Pending:"bg-yellow-100 text-yellow-800",Accepted:"bg-blue-100 text-blue-800","In Progress":"bg-purple-100 text-purple-800","Picked Up":"bg-indigo-100 text-indigo-800",Completed:"bg-green-100 text-green-800",Cancelled:"bg-red-100 text-red-800"})[oi]||"bg-gray-100 text-gray-800";ot.useEffect(()=>{if(t.length>0&&!l){const oi={};t.forEach(Wi=>{oi[Wi.id]=!1}),d(oi)}},[t,l,d]),ot.useEffect(()=>{if(y!=null&&y.uid){const oi=QX(y.uid,Wi=>{we(Wi)});return()=>{oi&&oi()}}},[y]);const Ye=oi=>typeof oi=="string"?oi:(oi==null?void 0:oi.travelerId)||(oi==null?void 0:oi.uid)||null;ot.useEffect(()=>{const oi=async Wi=>{const $t=Ye(Wi);if(!(!$t||Ae[$t]))try{const Nn=await Qh(Wo(da(Pn,"users"),Ho("uid","==",$t)));if(!Nn.empty){const _n=Nn.docs[0].data();Ve(Sr=>({...Sr,[$t]:{name:_n.fullName||"Unknown User",photoURL:_n.photoURL||null,email:_n.email||null,rating:_n.rating||0,trips:_n.completedTrips||0}}))}}catch(Nn){console.error("Error fetching traveler info:",Nn)}};Object.entries(l||{}).forEach(([Wi,$t])=>{var Nn;if($t){const _n=t.find(Sr=>Sr.id===Wi);(Nn=_n==null?void 0:_n.requestedTravelers)!=null&&Nn.length&&_n.requestedTravelers.forEach(Sr=>{oi(Sr)})}})},[l,t,Ae]);const Or=oi=>{d(Wi=>({...Wi,[oi]:!Wi[oi]}))},di=(oi,Wi)=>{Ce(oi),be(Wi),Ct(!0)},Qt=async()=>{try{if(!Ee||!it)return;je(Nn=>({...Nn,[Ee.id]:!0}));const oi=Ye(it),Wi=Gs(Pn,"delivery",Ee.id);await Fh(Wi,{assignedTraveller:oi,status:"Accepted",updatedAt:Hs()});const $t=Gs(Pn,"trips",`${Ee.id}_${oi}`);await Fh($t,{travelerId:oi,status:"Accepted",updatedAt:Hs()}),alert("Traveler approved successfully!"),Ct(!1),Ce(null),be(null)}catch(oi){console.error("Error approving traveler:",oi),alert(`Approval failed: ${oi.message}`)}finally{je(oi=>({...oi,[Ee==null?void 0:Ee.id]:!1}))}},Ai=async(oi,Wi)=>{try{if(!oi||!Wi)return;const $t=Ye(Wi);je(Sr=>({...Sr,[oi.id+$t]:!0}));const Nn=Gs(Pn,"orders",oi.id),_n=oi.requestedTravelers.filter(Sr=>Ye(Sr)!==$t);await Fh(Nn,{requestedTravelers:_n,updatedAt:Hs()}),alert("Request rejected successfully")}catch($t){console.error("Error rejecting traveler request:",$t),alert("Failed to reject request. Please try again.")}finally{je($t=>({...$t,[oi.id+travelerId]:!1}))}};return J.jsxs("div",{className:"p-6",children:[J.jsxs("div",{className:"flex justify-between items-center mb-6",children:[J.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"My Created Orders"}),J.jsxs("select",{value:n,onChange:oi=>e(oi.target.value),className:"bg-white border border-gray-300 text-gray-700 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[J.jsx("option",{value:"all",children:"All Status"}),J.jsx("option",{value:"Pending",children:"Pending"}),J.jsx("option",{value:"Accepted",children:"Accepted"}),J.jsx("option",{value:"In Progress",children:"In Progress"}),J.jsx("option",{value:"Completed",children:"Completed"}),J.jsx("option",{value:"Cancelled",children:"Cancelled"})]})]}),t.length===0?J.jsx("div",{className:"bg-white p-8 rounded-lg shadow text-center",children:J.jsx("p",{className:"text-gray-500",children:"No orders found"})}):J.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[J.jsxs("p",{className:"text-sm text-gray-500 mb-4",children:["Showing ",t.length," orders"]}),J.jsx("div",{className:"space-y-4",children:t.map(oi=>{var Wi,$t,Nn,_n,Sr,Cs,Rs;return J.jsxs("div",{className:"bg-gray-100 p-4 rounded-lg shadow-sm",children:[J.jsxs("div",{className:"flex items-center justify-between",children:[J.jsxs("div",{children:[J.jsx("p",{className:"text-lg font-medium",children:((Wi=oi.itemDetails)==null?void 0:Wi.title)||"Package"}),J.jsx("p",{className:"text-sm text-gray-500",children:((Nn=($t=oi.pickup)==null?void 0:$t.location)==null?void 0:Nn.address)||"Pickup Address"}),J.jsx("p",{className:"text-sm text-gray-500",children:((Sr=(_n=oi.dropoff)==null?void 0:_n.location)==null?void 0:Sr.address)||"Dropoff Address"})]}),J.jsx("div",{className:"text-right",children:J.jsx("span",{className:`inline-block px-2 py-1 text-xs rounded-full ${pt(oi.status)}`,children:oi.status})})]}),J.jsxs("div",{className:"mt-4 flex justify-between items-center",children:[((Cs=oi.requestedTravelers)==null?void 0:Cs.length)>0&&J.jsx("button",{onClick:()=>Or(oi.id),className:"text-indigo-600 hover:text-indigo-800 font-medium",children:l!=null&&l[oi.id]?"Hide Requests":`Show Requests (${oi.requestedTravelers.length})`}),oi.assignedTraveler&&J.jsxs("button",{onClick:()=>{var ss;s(Ye(oi.assignedTraveler)),j(((ss=oi.itemDetails)==null?void 0:ss.title)||"Package")},className:"relative bg-green-500 text-white px-4 py-2 text-sm rounded-lg shadow hover:bg-green-600 transition",children:["💬 Messages ",K[oi.id]>0&&J.jsx("span",{className:"ml-2 bg-red-600 text-white px-2 py-1 rounded-full text-xs",children:K[oi.id]})]}),J.jsx("button",{onClick:()=>{me(oi),Xe(!0)},className:"bg-blue-500 text-white px-4 py-2 text-sm rounded-lg shadow hover:bg-blue-600 transition",children:"🚚 Track"})]}),(l==null?void 0:l[oi.id])&&((Rs=oi.requestedTravelers)==null?void 0:Rs.length)>0&&J.jsxs("div",{className:"mt-4 border-t pt-4",children:[J.jsx("h3",{className:"text-md font-medium mb-2",children:"Delivery Requests"}),J.jsx("div",{className:"space-y-3",children:oi.requestedTravelers.map((ss,ke)=>{var pa,Zs,St,cr;const rr=Ye(ss);return J.jsxs("div",{className:"flex justify-between items-center bg-white p-3 rounded-md",children:[J.jsxs("div",{className:"flex items-center",children:[(pa=Ae[rr])!=null&&pa.photoURL?J.jsx("img",{src:Ae[rr].photoURL,alt:Ae[rr].name,className:"w-10 h-10 rounded-full mr-3"}):J.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-300 mr-3 flex items-center justify-center",children:J.jsx("span",{className:"text-gray-600",children:((St=(Zs=Ae[rr])==null?void 0:Zs.name)==null?void 0:St.charAt(0))||"U"})}),J.jsxs("div",{children:[J.jsx("p",{className:"font-medium",children:((cr=Ae[rr])==null?void 0:cr.name)||rr}),Ae[rr]&&J.jsxs("p",{className:"text-xs text-gray-500",children:["Rating: ⭐ ",Ae[rr].rating,"/5 • ",Ae[rr].trips," trips"]}),ss.requestedAt&&J.jsxs("p",{className:"text-xs text-gray-500",children:["Requested: ",new Date(ss.requestedAt.seconds*1e3).toLocaleString()]})]})]}),J.jsxs("div",{className:"flex space-x-2",children:[J.jsx("button",{onClick:()=>di(oi,ss),disabled:De[oi.id]||oi.status!=="Pending",className:`${oi.status!=="Pending"?"bg-gray-300 cursor-not-allowed":"bg-green-500 hover:bg-green-600"} text-white px-3 py-1 text-sm rounded transition`,children:De[oi.id]?"...":"Approve"}),J.jsx("button",{onClick:()=>Ai(oi,ss),disabled:De[oi.id+rr],className:"bg-red-100 text-red-800 px-3 py-1 text-sm rounded hover:bg-red-200 transition",children:De[oi.id+rr]?"...":"Reject"})]})]},`${rr}-${ke}`)})})]})]},oi.id)})})]}),A&&J.jsx(rF,{senderId:y.uid,travelerId:A,deliveryTitle:N,closeChat:()=>s(null)}),Ue&&ae&&J.jsx(oF,{isOpen:Ue,onClose:()=>Xe(!1),pickup:(Mi=ae.pickup)==null?void 0:Mi.location,dropoff:(ai=ae.dropoff)==null?void 0:ai.location}),We&&Ee&&it&&J.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50",children:J.jsxs("div",{className:"max-w-md w-full bg-white rounded-lg shadow-xl p-6",children:[J.jsx("h2",{className:"text-xl font-bold mb-4",children:"Approve Traveler"}),J.jsxs("p",{className:"mb-4",children:["Are you sure you want to approve ",J.jsx("strong",{children:((pn=Ae[Ye(it)])==null?void 0:pn.name)||Ye(it)})," to deliver your package?"]}),J.jsxs("div",{className:"flex justify-end space-x-3",children:[J.jsx("button",{onClick:()=>Ct(!1),className:"px-4 py-2 text-gray-700 bg-gray-200 rounded hover:bg-gray-300",children:"Cancel"}),J.jsx("button",{onClick:Qt,className:"px-4 py-2 text-white bg-green-500 rounded hover:bg-green-600",disabled:De[Ee.id],children:De[Ee.id]?"Approving...":"Approve Traveler"})]})]})})]})}function eY(){const{user:t}=Cl(),[e,n]=ot.useState([]),[l,d]=ot.useState(!0),[y,A]=ot.useState(null),[s,N]=ot.useState(""),[j,K]=ot.useState({});ot.useEffect(()=>{if(!(t!=null&&t.uid)){d(!1);return}const ae=async()=>{d(!0);try{const Ue=da(Pn,"trips"),Xe=Wo(Ue,Ho("userId","==",t.uid)),it=da(Pn,"delivery"),be=Wo(it,Ho("senderId","==",t.uid)),Ee=H1(Xe,async We=>{const Ct=await me(We);n(Ct),se(Ct)}),Ce=H1(be,async We=>{const Ct=We.docs.map(we=>({id:we.id,...we.data()})),Ut=e.map(we=>{const Ae=Ct.find(Ve=>Ve.id===we.deliveryId);return{...we,status:(Ae==null?void 0:Ae.status)||we.status}});n(Ut)});return()=>{Ee(),Ce()}}catch(Ue){console.error("Error setting up listeners:",Ue)}finally{d(!1)}},me=async Ue=>Promise.all(Ue.docs.map(async Xe=>{var We,Ct;const it=Xe.data();let be=null;try{be=await qb(it.userId)}catch(Ut){console.error("Error fetching user profile:",Ut)}let Ee=null,Ce=null;try{const Ut=Gs(Pn,"delivery",it.deliveryId),we=await fu(Ut);we.exists()&&(Ee=we.data(),Ce=Ee.senderId)}catch(Ut){console.error("Error fetching delivery details:",Ut)}return{id:Xe.id,...it,userName:(be==null?void 0:be.fullName)||"Unknown User",senderId:Ce||"N/A",requestedAt:it.requestedAt?new Date(it.requestedAt).toLocaleString():"N/A",updatedAt:it.updatedAt?new Date(it.updatedAt).toLocaleString():"N/A",deliveryTitle:((We=Ee==null?void 0:Ee.itemDetails)==null?void 0:We.title)||"No Title",deliveryDescription:((Ct=Ee==null?void 0:Ee.itemDetails)==null?void 0:Ct.description)||"No Description",status:(Ee==null?void 0:Ee.status)||"Pending"}})).then(Xe=>Xe.filter(it=>it.senderId!==t.uid&&it.status==="Pending"));ae()},[t==null?void 0:t.uid]);const se=async ae=>{try{const me={};for(const Ue of ae)if(Ue.senderId!==t.uid){const Xe=da(Pn,"messages"),it=Wo(Xe,Ho("read","==",!1),Ho("senderId","==",Ue.senderId)),be=await Qh(it);me[Ue.id]=be.size}K(me)}catch(me){console.error("Error fetching unread messages:",me)}};return J.jsxs("div",{className:"p-8 bg-gray-100 min-h-screen",children:[J.jsx("h1",{className:"text-3xl font-bold text-gray-800 mb-8 text-center",children:"📦 My Requested Trips"}),l?J.jsx("p",{className:"text-gray-500 text-center",children:"Loading..."}):e.length===0?J.jsx("p",{className:"text-gray-500 text-center",children:"No requested trips found"}):J.jsx("ul",{className:"space-y-6 max-w-3xl mx-auto",children:e.map(ae=>J.jsxs("li",{className:"bg-white p-6 rounded-lg shadow-md border border-gray-200 relative",children:[J.jsxs("div",{className:"mb-3",children:[J.jsx("h2",{className:"text-lg font-bold text-gray-900",children:ae.deliveryTitle}),J.jsx("p",{className:"text-sm text-gray-600",children:ae.deliveryDescription})]}),J.jsxs("div",{className:"border-t border-gray-300 pt-3 flex justify-between items-start",children:[J.jsxs("div",{className:"text-sm text-gray-700 space-y-1",children:[J.jsxs("p",{children:[J.jsx("span",{className:"font-medium text-gray-900",children:"Delivery ID:"})," ",ae.deliveryId]}),J.jsxs("p",{children:[J.jsx("span",{className:"font-medium text-gray-900",children:"Requested By:"})," ",ae.userName]})]}),ae.senderId!==t.uid?J.jsxs("button",{onClick:()=>{A(ae.senderId),N(ae.deliveryTitle)},className:"relative bg-blue-500 text-white px-3 py-1.5 text-sm rounded-lg shadow hover:bg-blue-600 transition",children:["💬 Chat",j[ae.id]>0&&J.jsx("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold px-2 py-0.5 rounded-full",children:j[ae.id]})]}):J.jsx("span",{className:"text-gray-500 text-sm",children:"You cannot chat with yourself"})]}),J.jsxs("div",{className:"mt-3 border-t border-gray-300 pt-3 flex justify-between text-xs text-gray-500",children:[J.jsx("span",{className:`px-3 py-1 rounded-full font-semibold text-xs ${ae.status==="Pending"?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-800"}`,children:ae.status}),J.jsxs("div",{className:"text-right",children:[J.jsxs("p",{children:["📅 Requested At: ",ae.requestedAt]}),J.jsxs("p",{children:["🕒 Updated At: ",ae.updatedAt]})]})]})]},ae.id))}),y&&y!==t.uid&&J.jsx(rF,{senderId:t.uid,travelerId:y,deliveryTitle:s,closeChat:()=>A(null)})]})}function tY(){const t=$m(),[e,n]=ot.useState(!1),[l,d]=ot.useState([]),y=["In Progress","Picked Up","Out for Delivery","Delivered"],A=async()=>{try{n(!0);const j=Wo(da(Pn,"trips"),Ho("status","!=","Delivered")),se=(await Qh(j)).docs.map(Xe=>({id:Xe.id,...Xe.data()})),ae=Wo(da(Pn,"delivery"),Ho("status","!=","Delivered")),Ue=(await Qh(ae)).docs.map(Xe=>({id:Xe.id,...Xe.data()}));d([...se,...Ue])}catch(j){console.error("Error fetching accepted orders:",j),alert("Failed to fetch accepted orders.")}finally{n(!1)}};ot.useEffect(()=>{A()},[]);const s=async(j,K)=>{try{n(!0);const se=Gs(Pn,"delivery",j),ae=await fu(se);if(!ae.exists()){alert(`Document with ID ${j} does not exist in delivery collection.`);return}const me=ae.data(),Ue=me.deliveryId,Xe=me.userId||me.senderId||me.userId,it=`${Ue}_${Xe}`,be=Gs(Pn,"trips",it),Ee=await fu(be);await Fh(se,{status:K,updatedAt:Hs()}),Ee.exists()?await Fh(be,{status:K,updatedAt:Hs()}):console.log(`Trip document with ID ${it} does not exist. Only delivery updated.`),alert("Status updated successfully!"),A()}catch(se){console.error("Update error:",se),alert(`Failed to update status: ${se.message}`)}finally{n(!1)}},N=async j=>{try{await s(j,"Delivered");const K=Gs(Pn,"delivery",j),se=await fu(K);if(!se.exists()){alert("Delivery document not found!");return}const ae=se.data().senderId,me=Gs(Pn,"reviews",j);await A0(me,{orderId:j,senderId:ae,status:"pending",createdAt:Hs()},{merge:!0}),alert("Delivery completed! Review form sent to sender."),t(`/review/${j}`)}catch(K){console.error("Completion error:",K),alert("Failed to complete delivery.")}};return J.jsxs("div",{className:"p-6",children:[J.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-6",children:"My Accepted Trips"}),e?J.jsx("div",{className:"bg-white p-8 rounded-lg shadow text-center",children:J.jsx("p",{className:"text-gray-500",children:"Loading..."})}):l.length===0?J.jsx("div",{className:"bg-white p-8 rounded-lg shadow text-center",children:J.jsx("p",{className:"text-gray-500",children:"No accepted trips found"})}):J.jsx("div",{className:"bg-white p-6 rounded-lg shadow overflow-hidden",children:J.jsx("div",{className:"space-y-4",children:l.map(j=>{var K,se,ae,me,Ue;return J.jsxs("div",{className:"bg-gray-100 p-4 rounded-lg shadow-sm",children:[J.jsxs("div",{className:"flex items-center justify-between",children:[J.jsxs("div",{children:[J.jsx("p",{className:"text-lg font-medium",children:((K=j.itemDetails)==null?void 0:K.title)||"Package"}),J.jsx("p",{className:"text-sm text-gray-500",children:((ae=(se=j.pickup)==null?void 0:se.location)==null?void 0:ae.address)||"Pickup Address"}),J.jsx("p",{className:"text-sm text-gray-500",children:((Ue=(me=j.dropoff)==null?void 0:me.location)==null?void 0:Ue.address)||"Dropoff Address"}),J.jsxs("p",{className:"text-sm text-gray-600",children:["📅 Estimated Delivery: ",j.eta||"N/A"]})]}),J.jsx("div",{className:"text-right",children:J.jsx("span",{className:`inline-block px-2 py-1 text-xs rounded-full ${j.status==="Delivered"?"bg-green-100 text-green-800":"bg-gray-200 text-gray-800"}`,children:j.status})})]}),J.jsxs("div",{className:"mt-4",children:[J.jsx("label",{className:"text-sm text-gray-600",children:"Update Status:"}),J.jsx("select",{value:j.status,onChange:Xe=>s(j.id,Xe.target.value),className:"w-full mt-2 p-2 border rounded-md",disabled:e,children:y.map(Xe=>J.jsx("option",{value:Xe,children:Xe},Xe))})]}),J.jsx("div",{className:"mt-4 flex justify-end",children:j.status==="Out for Delivery"&&J.jsx("button",{onClick:()=>N(j.id),className:"bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition",disabled:e,children:"✅ Complete Delivery"})})]},j.id)})})})]})}function iY(){return J.jsxs("div",{children:[J.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-6",children:"Messages"}),J.jsx("div",{className:"bg-white p-6 rounded-lg shadow overflow-hidden",children:J.jsx("p",{className:"text-gray-500",children:"Messages functionality coming soon!"})})]})}function nY(){return J.jsxs("div",{children:[J.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-6",children:"Settings"}),J.jsx("div",{className:"bg-white p-6 rounded-lg shadow overflow-hidden",children:J.jsx("p",{className:"text-gray-500",children:"Settings functionality coming soon!"})})]})}function rY({activeTab:t,setActiveTab:e}){var l,d,y;const{user:n}=Cl();return J.jsx("div",{className:"lg:col-span-1",children:J.jsxs("div",{className:"bg-white shadow rounded-lg overflow-hidden",children:[J.jsx("div",{className:"p-6 bg-gradient-to-r from-indigo-500 to-purple-600 text-white",children:J.jsxs("div",{className:"flex items-center space-x-4",children:[J.jsx("img",{src:`https://randomuser.me/api/portraits/${parseInt(n==null?void 0:n.uid,36)%2===0?"men":"women"}/${parseInt(n==null?void 0:n.uid,36)%99}.jpg`,alt:"Profile",className:"h-10 w-10 rounded-full border-2 border-white cursor-pointer"}),J.jsxs("div",{children:[J.jsx("h2",{className:"text-xl font-bold",children:(n==null?void 0:n.fullName)||"User"}),J.jsx("p",{className:"text-indigo-100",children:"ID Verified"})]})]})}),J.jsxs("div",{className:"p-4",children:[J.jsxs("div",{className:"mb-4",children:[J.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Trust Score"}),J.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5",children:J.jsx("div",{className:"bg-indigo-600 h-2.5 rounded-full",style:{width:`${(n==null?void 0:n.trustScore)||85}%`}})}),J.jsxs("p",{className:"text-right text-sm text-gray-500 mt-1",children:[(n==null?void 0:n.trustScore)||85,"%"]})]}),J.jsxs("div",{className:"mt-6 space-y-2",children:[J.jsxs("button",{onClick:()=>e("overview"),className:`w-full text-left px-4 py-2 rounded-lg flex items-center space-x-3 ${t==="overview"?"bg-indigo-50 text-indigo-700":"hover:bg-gray-50"}`,children:[J.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:J.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2v4l-4-4H9a1.994 1.994 0 01-1.414-.586m0 0L11 14h4a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2v4l.586-.586z"})}),J.jsx("span",{children:"Overview"})]}),J.jsxs("button",{onClick:()=>e("created"),className:`w-full text-left px-4 py-2 rounded-lg flex items-center space-x-3 ${t==="created"?"bg-indigo-50 text-indigo-700":"hover:bg-gray-50"}`,children:[J.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:J.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"})}),J.jsx("span",{children:"My Created Orders"}),J.jsx("span",{className:"ml-auto bg-indigo-100 text-indigo-800 text-xs font-semibold ",children:(l=n==null?void 0:n.createdOrders)==null?void 0:l.length})]}),J.jsxs("button",{onClick:()=>e("requested"),className:`w-full text-left px-4 py-2 rounded-lg flex items-center space-x-3 ${t==="requested"?"bg-indigo-50 text-indigo-700":"hover:bg-gray-50"}`,children:[J.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:J.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 4H6a2 2 0 00-2 2v12a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-2m-4-1v8m0 0l-4-4m4 4l4-4"})}),J.jsx("span",{children:"My Requested Trips"}),J.jsx("span",{className:"ml-auto bg-indigo-100 text-indigo-800 text-xs font-semibold ",children:(d=n==null?void 0:n.requestedOrders)==null?void 0:d.length})]}),J.jsxs("button",{onClick:()=>e("accepted"),className:`w-full text-left px-4 py-2 rounded-lg flex items-center space-x-3 ${t==="accepted"?"bg-indigo-50 text-indigo-700":"hover:bg-gray-50"}`,children:[J.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:J.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),J.jsx("span",{children:"My Accepted Trips"}),J.jsx("span",{className:"ml-auto bg-indigo-100 text-indigo-800 text-xs font-semibold ",children:(y=n==null?void 0:n.acceptedOrders)==null?void 0:y.length})]}),J.jsxs("button",{onClick:()=>e("messages"),className:`w-full text-left px-4 py-2 rounded-lg flex items-center space-x-3 ${t==="messages"?"bg-indigo-50 text-indigo-700":"hover:bg-gray-50"}`,children:[J.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:J.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"})}),J.jsx("span",{children:"Messages"}),J.jsx("span",{className:"ml-auto bg-red-100 text-red-800 text-xs font-semibold px-2.5 py-0.5 rounded-full",children:"3"})]}),J.jsxs("button",{onClick:()=>e("settings"),className:`w-full text-left px-4 py-2 rounded-lg flex items-center space-x-3 ${t==="settings"?"bg-indigo-50 text-indigo-700":"hover:bg-gray-50"}`,children:[J.jsxs("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[J.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),J.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),J.jsx("span",{children:"Settings"})]})]})]}),J.jsx("div",{className:"p-4 border-t",children:J.jsx("button",{className:"w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded transition",children:"Send a New Package"})})]})})}function sY(){const{user:t}=Cl(),[e,n]=ot.useState("overview"),[l,d]=ot.useState([]),[y,A]=ot.useState([]),[s,N]=ot.useState([]),[j,K]=ot.useState({}),[se,ae]=ot.useState({}),[me,Ue]=ot.useState(!0);ot.useState(85);const[Xe,it]=ot.useState("all");ot.useEffect(()=>{(async()=>{if(Ue(!0),t){const[We,Ct,Ut]=await Promise.all([tF(t.uid),CX(t.uid),RX(t.uid)]);d(We),A(Ct),N(Ut)}Ue(!1)})()},[t]),ot.useEffect(()=>{const Ce=async()=>{let We={};const Ct=l.filter(Ut=>Ut.requestedTravelers&&Ut.requestedTravelers.length>0);if(Ct.length>0){for(let Ut of Ct)for(let we of Ut.requestedTravelers)if(!We[we.travelerId]){const Ae=await qb(we.travelerId);We[we.travelerId]=Ae||{fullName:"Unknown User",profilePicture:"/default-avatar.png",rating:{overallRating:0,totalReviews:0}}}K(We)}};l.length>0&&Ce()},[l]);const be=async(Ce,We)=>{Ue(!0),(await PX(Ce,We)).success&&d(Ut=>Ut.map(we=>we.id===Ce?{...we,assignedTraveler:We,status:"Accepted"}:we)),Ue(!1)},Ee=async(Ce,We)=>{Ue(!0),(await LX(Ce,We)).success&&d(Ut=>Ut.map(we=>{var Ae;return{...we,requestedTravelers:(Ae=we.requestedTravelers)==null?void 0:Ae.filter(Ve=>Ve.travelerId!==We)}})),Ue(!1)};return J.jsx("div",{className:"min-h-screen bg-gray-50",children:J.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:J.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[J.jsx(rY,{activeTab:e,setActiveTab:n}),J.jsx("div",{className:"lg:col-span-3",children:me?J.jsx("div",{className:"flex justify-center items-center h-64",children:J.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"})}):J.jsxs(J.Fragment,{children:[e==="overview"&&J.jsx(ZX,{createdOrders:l,acceptedOrders:s}),e==="created"&&J.jsx(JX,{createdOrders:l,filterStatus:Xe,setFilterStatus:it,travelerProfiles:j,showRequests:se,setShowRequests:ae,handleAcceptTraveler:be,handleCancelTravelerRequest:Ee}),e==="requested"&&J.jsx(eY,{requestedOrders:y}),e==="accepted"&&J.jsx(tY,{acceptedOrders:s}),e==="messages"&&J.jsx(iY,{}),e==="settings"&&J.jsx(nY,{})]})})]})})})}function aY(){return J.jsxs(A8,{children:[J.jsx(oX,{}),J.jsx("div",{className:"p-6",children:J.jsxs(t8,{children:[J.jsx(Yc,{path:"/",element:J.jsx(cX,{})}),J.jsx(Yc,{path:"/available-deliveries",element:J.jsx(HX,{})}),J.jsx(Yc,{path:"/login",element:J.jsx(wX,{})}),J.jsx(Yc,{path:"/signup",element:J.jsx(SX,{})}),J.jsx(Yc,{path:"/user-dashboard",element:J.jsx(Sx,{children:J.jsx(sY,{})})}),J.jsx(Yc,{path:"/profile",element:J.jsx(Sx,{children:J.jsx(zX,{})})}),J.jsx(Yc,{path:"/create-delivery",element:J.jsx(Sx,{children:J.jsx($X,{})})}),J.jsx(Yc,{path:"/order-tracking",element:J.jsx(Sx,{children:J.jsx(oF,{})})})]})})]})}QU.createRoot(document.getElementById("root")).render(J.jsx(Sh.StrictMode,{children:J.jsx(aX,{children:J.jsx(aY,{})})}));
